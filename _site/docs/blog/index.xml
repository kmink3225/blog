<?xml version="1.0" encoding="UTF-8"?>
<rss  xmlns:atom="http://www.w3.org/2005/Atom" 
      xmlns:media="http://search.yahoo.com/mrss/" 
      xmlns:content="http://purl.org/rss/1.0/modules/content/" 
      xmlns:dc="http://purl.org/dc/elements/1.1/" 
      version="2.0">
<channel>
<title>Kwangmin Kim</title>
<link>kk3225.netlify.app/docs/blog/</link>
<atom:link href="kk3225.netlify.app/docs/blog/index.xml" rel="self" type="application/rss+xml"/>
<description>blog</description>
<generator>quarto-1.4.543</generator>
<lastBuildDate>Tue, 31 Dec 2109 15:00:00 GMT</lastBuildDate>
<item>
  <title>Data Governance</title>
  <dc:creator>Kwangmin Kim</dc:creator>
  <link>kk3225.netlify.app/docs/blog/posts/Governance/</link>
  <description><![CDATA[ 





<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="kk3225.netlify.app/images/governance/data_governance.png" class="img-fluid figure-img" style="width:50.0%"></p>
<figcaption>Governance</figcaption>
</figure>
</div>
<section id="data-governance" class="level1" data-number="1">
<h1 data-number="1"><span class="header-section-number">1</span> Data Governance</h1>
<section id="data-governance-basic-concept" class="level2" data-number="1.1">
<h2 data-number="1.1" class="anchored" data-anchor-id="data-governance-basic-concept"><span class="header-section-number">1.1</span> Data Governance Basic Concept</h2>
<ul>
<li>2024-08-01, <a href="../../../../docs/blog/posts/Governance/1.basis.html">Data Governance Basic Concepts, 거버넌스 기본 개념</a></li>
<li>2024-08-02, <a href="../../../../docs/blog/posts/Governance/2.task_process.html">Task Process, 업무 절차</a></li>
<li>2024-08-03, <a href="../../../../docs/blog/posts/Governance/3.architetucre.html">Data Architecture, 구조관리</a></li>
<li>0000-00-00, [Data Pipeline Design, 파이프라인 설계]</li>
<li>0000-00-00, [Data Storage, 저장소 관리]</li>
<li>0000-00-00, [Data Management Policy, 데이터 관리 정책]</li>
<li>0000-00-00, [Data Stewardship Model, 데이터 관리 모델]</li>
</ul>
</section>
<section id="data-modeling" class="level2" data-number="1.2">
<h2 data-number="1.2" class="anchored" data-anchor-id="data-modeling"><span class="header-section-number">1.2</span> Data Modeling</h2>
<ul>
<li>2024-08-04, <a href="../../../../docs/blog/posts/Governance/4-0.data_model.html">Data Model (1) - Basic Concept</a></li>
<li>2024-08-05, <a href="../../../../docs/blog/posts/Governance/4-1.data_model_database.html">Data Model (2) - Database Basis</a></li>
<li>2024-08-06, <a href="../../../../docs/blog/posts/Governance/4-2.data_model_sql.html">Data Model (3) - SQL Concept</a></li>
<li>2024-08-07, <a href="../../../../docs/blog/posts/Governance/4-3.data_model_schema.html">Data Model (4) - DB Design</a></li>
<li>2024-08-08, <a href="../../../../docs/blog/posts/Governance/4-4.data_model_requirements.html">Data Model (5) - Requirement Collection</a></li>
<li>2024-08-09, <a href="../../../../docs/blog/posts/Governance/4-5-0.data_model_conceptual.html">Data Model (6) - Conceptual Design</a></li>
<li>2024-08-10, <a href="../../../../docs/blog/posts/Governance/4-5-1.data_model_conceptual_ER_model.html">Data Model (7) - ER Modeling</a></li>
</ul>
<section id="data-standardization" class="level3" data-number="1.2.1">
<h3 data-number="1.2.1" class="anchored" data-anchor-id="data-standardization"><span class="header-section-number">1.2.1</span> Data Standardization</h3>
<ul>
<li>2024-08-11, <a href="../../../../docs/blog/posts/Governance/5-0-0.data_standard.html">Data Standardization - Basic Concept</a></li>
<li>2024-08-12, <a href="../../../../docs/blog/posts/Governance/5-0-1.stndrdztn_rule.ver1.0.0.html">Data Standardization - Standard Rules</a></li>
<li>2024-11-25, <a href="../../../../docs/blog/posts/Governance/5-0-2.terminology_hierarchy.html">Data Standardization - 용어 정리</a></li>
<li>2024-08-12, <a href="../../../../docs/blog/posts/Governance/5-1.data_word_dictionary.html">Data Standardization - 표준 단어 사전</a></li>
<li>2024-08-13, <a href="../../../../docs/blog/posts/Governance/5-2.data_word_domain.html">Data Standardization - 표준 도메인 사전</a></li>
<li>2024-08-14, <a href="../../../../docs/blog/posts/Governance/5-3.data_word_glossary.html">Data Standardization - 표준 용어 사전</a></li>
<li>2024-08-15, <a href="../../../../docs/blog/posts/Governance/5-4.data_code.html">Data Standardization - 표준 코드</a></li>
<li>2024-08-16, <a href="../../../../docs/blog/posts/Governance/6-0.data_registration_process.html">Data Standardization - 등록 프로세스</a></li>
<li>2024-08-17, <a href="../../../../docs/blog/posts/Governance/6-1.data_review_process.html">Data Standardization - 용어 검토 프로세스</a></li>
<li>2024-08-18, <a href="../../../../docs/blog/posts/Governance/6-2.data_code_registration.html">Data Standardization - 코드 등록 프로세스</a></li>
<li>2024-08-19, <a href="../../../../docs/blog/posts/Governance/8-0.data_quality_measures.html">Data Standardization - 데이터 품질 측정</a></li>
</ul>
</section>
<section id="data-quality" class="level3" data-number="1.2.2">
<h3 data-number="1.2.2" class="anchored" data-anchor-id="data-quality"><span class="header-section-number">1.2.2</span> Data Quality</h3>
<ul>
<li>0000-00-00, [Data Quality Control Process, 데이터 품질 절차]</li>
<li>0000-00-00, [Data Quality Measurement, 데이터 품질 측정]</li>
<li>0000-00-00, [Data Validation, 데이터 품질 검증]</li>
</ul>
</section>
<section id="etc." class="level3" data-number="1.2.3">
<h3 data-number="1.2.3" class="anchored" data-anchor-id="etc."><span class="header-section-number">1.2.3</span> etc.</h3>
<ul>
<li>0000-00-00, [Data Governance Solutions, 데이터 관리 솔루션]</li>
<li>0000-00-00, [Metadata Management, 메타데이터 관리]</li>
<li>0000-00-00, [Data Integration, 데이터 통합]</li>
<li>0000-00-00, [Data Security, 데이터 보안]</li>
</ul>


</section>
</section>
</section>

 ]]></description>
  <category>Data Governance</category>
  <guid>kk3225.netlify.app/docs/blog/posts/Governance/</guid>
  <pubDate>Tue, 31 Dec 2109 15:00:00 GMT</pubDate>
</item>
<item>
  <title>Epidemiology</title>
  <dc:creator>Kwangmin Kim</dc:creator>
  <link>kk3225.netlify.app/docs/blog/posts/Experimentation/Epidemiology/</link>
  <description><![CDATA[ 





<section id="contents" class="level1" data-number="1">
<h1 data-number="1"><span class="header-section-number">1</span> Contents</h1>
<section id="learning-path-for-experimentation" class="level2" data-number="1.1">
<h2 data-number="1.1" class="anchored" data-anchor-id="learning-path-for-experimentation"><span class="header-section-number">1.1</span> Learning Path for Experimentation</h2>
<p><strong>Priority Topics for Experimentation:</strong> 1. <strong>Experimental Studies → RCT</strong> (A/B Testing 직접 원형) 2. <strong>Causal Inference</strong> (전체 섹션 - 실험의 이론적 기초) 3. <strong>Effect Modification</strong> (Heterogeneous Treatment Effects) 4. <strong>Sample Size and Power</strong> (실험 설계 필수) 5. <strong>Propensity Score Methods</strong> (Observational causal inference)</p>
<p><strong>Recommended Study Order:</strong></p>
<p>Phase 1 (1-2주): Foundations + Study Designs → Focus on RCT and experimental principles</p>
<p>Phase 2 (1주): Measures of Association and Impact → Effect measures calculation practice</p>
<p>Phase 3 (2주): Causal Inference ⭐ → DAG practice, Counterfactual framework → Most critical for experimentation</p>
<p>Phase 4 (1주): Bias and Confounding + Study Fundamentals → Sample size calculations → Validity considerations</p>
<p>Phase 5 (선택): Advanced Topics → As needed for specific applications</p>
</section>
<section id="foundations" class="level2" data-number="1.2">
<h2 data-number="1.2" class="anchored" data-anchor-id="foundations"><span class="header-section-number">1.2</span> Foundations</h2>
<ul>
<li>1111-11-11, <a href="./foundations/concepts.qmd">Epidemiologic Concepts</a>
<ul>
<li>1111-11-11, <a href="./foundations/incidence_prevalence.qmd">Incidence vs.&nbsp;Prevalence (발생률 vs.&nbsp;유병률)</a></li>
<li>1111-11-11, <a href="./foundations/population_at_risk.qmd">Population at Risk (위험인구)</a></li>
<li>1111-11-11, <a href="./foundations/exposure_outcome.qmd">Exposure and Outcome (노출과 결과)</a></li>
</ul></li>
<li>1111-11-11, <a href="./foundations/framework.qmd">Study Design Framework (연구설계 프레임워크)</a>
<ul>
<li>1111-11-11, <a href="./foundations/descriptive_analytical.qmd">Descriptive vs.&nbsp;Analytical Studies (기술 vs.&nbsp;분석 연구)</a></li>
<li>1111-11-11, <a href="./foundations/observational_experimental.qmd">Observational vs.&nbsp;Experimental Studies (관찰 vs.&nbsp;실험 연구)</a></li>
<li>1111-11-11, <a href="./foundations/time_relationship.qmd">Time Relationship (시간적 관계)</a></li>
</ul></li>
</ul>
</section>
<section id="study-designs" class="level2" data-number="1.3">
<h2 data-number="1.3" class="anchored" data-anchor-id="study-designs"><span class="header-section-number">1.3</span> Study Designs</h2>
<ul>
<li>2023-02-27, Types of Study Designs in Epidemiology
<ul>
<li>1111-11-11, Descriptive Studies (기술연구)
<ul>
<li>1111-11-11, <a href="./descriptive/case_reports.qmd">Case Reports and Case Series (증례보고 및 증례군)</a></li>
<li>1111-11-11, <a href="./descriptive/ecological.qmd">Ecological Studies (생태학적 연구)</a></li>
</ul></li>
<li>1111-11-11, Observational Analytical Studies (관찰 분석연구)
<ul>
<li>1111-11-11, <a href="./observational/cross_sectional.qmd">Cross-sectional Studies (단면연구)</a></li>
<li>1111-11-11, <a href="./observational/case_control.qmd">Case-control Studies (환자-대조군 연구)</a></li>
<li>1111-11-11, <a href="./observational/cohort.qmd">Cohort Studies (코호트 연구)</a>
<ul>
<li>1111-11-11, <a href="./observational/cohort_prospective.qmd">Prospective Cohort (전향적 코호트)</a></li>
<li>1111-11-11, <a href="./observational/cohort_retrospective.qmd">Retrospective Cohort (후향적 코호트)</a></li>
</ul></li>
</ul></li>
<li>1111-11-11, Experimental Studies (실험연구) ⭐
<ul>
<li>1111-11-11, <a href="./experimental/rct.qmd">Randomized Controlled Trial (무작위 대조 시험)</a> ⭐</li>
<li>1111-11-11, <a href="./experimental/quasi_experimental.qmd">Quasi-experimental Studies (준실험 연구)</a></li>
<li>1111-11-11, <a href="./experimental/before_after.qmd">Before-after Studies (전후 연구)</a></li>
<li>1111-11-11, <a href="./experimental/factorial_design.qmd">Factorial Design (요인 설계)</a></li>
</ul></li>
<li>1111-11-11, Evidence Synthesis (근거 통합)
<ul>
<li>1111-11-11, <a href="./synthesis/systematic_review.qmd">Systematic Reviews (체계적 문헌고찰)</a></li>
<li>1111-11-11, <a href="./synthesis/meta_analysis.qmd">Meta-analyses (메타분석)</a></li>
</ul></li>
</ul></li>
</ul>
</section>
<section id="measures-of-association-and-impact" class="level2" data-number="1.4">
<h2 data-number="1.4" class="anchored" data-anchor-id="measures-of-association-and-impact"><span class="header-section-number">1.4</span> Measures of Association and Impact</h2>
<ul>
<li>2023-05-23, <a href="./measures_overview.qmd">Measures in Epidemiology</a>
<ul>
<li>1111-11-11, Contingency Tables and Basic Measures (분할표와 기본 측정)
<ul>
<li>1111-11-11, <a href="./measures/contingency_table.qmd">2x2 Contingency Tables (2x2 분할표)</a></li>
<li>1111-11-11, <a href="./measures/risk_rate_odds.qmd">Risk, Rate, and Odds (위험, 비율, 오즈)</a></li>
</ul></li>
<li>1111-11-11, Measures of Association (연관성 지표)
<ul>
<li>1111-11-11, <a href="./measures/relative_risk.qmd">Relative Risk (상대위험도)</a></li>
<li>1111-11-11, <a href="./measures/odds_ratio.qmd">Odds Ratio (오즈비)</a></li>
<li>1111-11-11, <a href="./measures/rate_ratio.qmd">Rate Ratio (비율비)</a></li>
</ul></li>
<li>1111-11-11, Measures of Effect (효과 지표)
<ul>
<li>1111-11-11, <a href="./measures/risk_difference.qmd">Risk Difference (위험차이)</a></li>
<li>1111-11-11, <a href="./measures/rrr.qmd">Relative Risk Reduction (상대위험감소)</a></li>
<li>1111-11-11, <a href="./measures/arr.qmd">Absolute Risk Reduction (절대위험감소)</a></li>
<li>1111-11-11, <a href="./measures/nnt.qmd">Number Needed to Treat (치료필요수)</a></li>
</ul></li>
<li>1111-11-11, Measures of Impact (영향 지표)
<ul>
<li>1111-11-11, <a href="./measures/attributable_risk.qmd">Attributable Risk (기여위험도)</a></li>
<li>1111-11-11, <a href="./measures/ar_percent.qmd">Attributable Risk Percent (기여위험분율)</a></li>
<li>1111-11-11, <a href="./measures/population_attributable_risk.qmd">Population Attributable Risk (인구기여위험도)</a></li>
<li>1111-11-11, <a href="./measures/par_percent.qmd">Population Attributable Risk Percent (인구기여위험분율)</a></li>
</ul></li>
<li>1111-11-11, Statistical Inference (통계적 추론)
<ul>
<li>1111-11-11, <a href="./measures/confidence_intervals.qmd">Confidence Intervals (신뢰구간)</a></li>
<li>1111-11-11, <a href="./measures/hypothesis_testing.qmd">Hypothesis Testing (가설 검정)</a></li>
<li>1111-11-11, <a href="./measures/p_values.qmd">p-values and Interpretation (p-값과 해석)</a></li>
</ul></li>
</ul></li>
</ul>
</section>
<section id="causal-inference" class="level2" data-number="1.5">
<h2 data-number="1.5" class="anchored" data-anchor-id="causal-inference"><span class="header-section-number">1.5</span> Causal Inference ⭐</h2>
<ul>
<li>1111-11-11, <a href="./causation/index.qmd">Causation in Epidemiology (역학에서의 인과관계)</a>
<ul>
<li>1111-11-11, Causation Concepts (인과관계 개념)
<ul>
<li>1111-11-11, <a href="./causation/necessary_sufficient.qmd">Necessary vs.&nbsp;Sufficient Causes (필요조건 vs.&nbsp;충분조건)</a></li>
<li>1111-11-11, <a href="./causation/component_causes.qmd">Component Causes (구성요인)</a></li>
<li>1111-11-11, <a href="./causation/induction_period.qmd">Induction Period (유도기간)</a></li>
</ul></li>
<li>1111-11-11, <a href="./causation/bradford_hill.qmd">Bradford Hill Criteria (Bradford Hill 기준)</a>
<ul>
<li>1111-11-11, <a href="./causation/strength.qmd">Strength of Association (연관성의 강도)</a></li>
<li>1111-11-11, <a href="./causation/consistency.qmd">Consistency and Replication (일관성과 재현성)</a></li>
<li>1111-11-11, <a href="./causation/specificity.qmd">Specificity (특이성)</a></li>
<li>1111-11-11, <a href="./causation/temporality.qmd">Temporality (시간적 선후관계)</a></li>
<li>1111-11-11, <a href="./causation/dose_response.qmd">Biological Gradient (생물학적 기울기)</a></li>
<li>1111-11-11, <a href="./causation/plausibility.qmd">Plausibility and Coherence (개연성과 일관성)</a></li>
<li>1111-11-11, <a href="./causation/experiment_analogy.qmd">Experiment and Analogy (실험과 유추)</a></li>
</ul></li>
<li>1111-11-11, <a href="./causation/counterfactual.qmd">Counterfactual Framework (반사실적 프레임워크)</a> ⭐
<ul>
<li>1111-11-11, <a href="./causation/potential_outcomes.qmd">Potential Outcomes (잠재결과)</a></li>
<li>1111-11-11, <a href="./causation/ate.qmd">Average Treatment Effect (평균 처치효과)</a></li>
<li>1111-11-11, <a href="./causation/sutva.qmd">SUTVA (안정단위처치값 가정)</a></li>
</ul></li>
<li>1111-11-11, <a href="./causation/dag.qmd">Directed Acyclic Graphs (방향성 비순환 그래프)</a> ⭐
<ul>
<li>1111-11-11, <a href="./causation/causal_pathways.qmd">Causal Pathways (인과 경로)</a></li>
<li>1111-11-11, <a href="./causation/confounding_paths.qmd">Confounding Paths (교란 경로)</a></li>
<li>1111-11-11, <a href="./causation/colliders.qmd">Colliders and Selection Bias (충돌자와 선택 편향)</a></li>
<li>1111-11-11, <a href="./causation/d_separation.qmd">d-separation (d-분리)</a></li>
</ul></li>
<li>1111-11-11, <a href="./causation/propensity_score.qmd">Propensity Score Methods (성향점수 방법)</a>
<ul>
<li>1111-11-11, <a href="./causation/ps_matching.qmd">Propensity Score Matching (성향점수 매칭)</a></li>
<li>1111-11-11, <a href="./causation/iptw.qmd">Inverse Probability Weighting (역확률 가중)</a></li>
<li>1111-11-11, <a href="./causation/ps_stratification.qmd">Propensity Score Stratification (성향점수 층화)</a></li>
<li>1111-11-11, <a href="./causation/ps_adjustment.qmd">Covariate Adjustment (공변량 조정)</a></li>
</ul></li>
</ul></li>
</ul>
</section>
<section id="bias-and-confounding" class="level2" data-number="1.6">
<h2 data-number="1.6" class="anchored" data-anchor-id="bias-and-confounding"><span class="header-section-number">1.6</span> Bias and Confounding</h2>
<ul>
<li>1111-11-11, <a href="./bias/index.qmd">Bias in Epidemiologic Studies (역학 연구의 편향)</a>
<ul>
<li>1111-11-11, Types of Bias (편향의 종류)
<ul>
<li>1111-11-11, <a href="./bias/selection_bias.qmd">Selection Bias (선택 편향)</a></li>
<li>1111-11-11, <a href="./bias/information_bias.qmd">Information Bias (정보 편향)</a></li>
<li>1111-11-11, <a href="./bias/misclassification.qmd">Misclassification Bias (오분류 편향)</a>
<ul>
<li>1111-11-11, <a href="./bias/nondifferential.qmd">Non-differential Misclassification (비차별적 오분류)</a></li>
<li>1111-11-11, <a href="./bias/differential.qmd">Differential Misclassification (차별적 오분류)</a></li>
</ul></li>
</ul></li>
</ul></li>
<li>1111-11-11, <a href="./confounding/index.qmd">Confounding (교란)</a>
<ul>
<li>1111-11-11, <a href="./confounding/definition.qmd">Definition and Criteria (정의와 기준)</a></li>
<li>1111-11-11, <a href="./confounding/positive_negative.qmd">Positive vs.&nbsp;Negative Confounding (양성 vs.&nbsp;음성 교란)</a></li>
<li>1111-11-11, <a href="./confounding/residual.qmd">Residual Confounding (잔여 교란)</a></li>
</ul></li>
<li>1111-11-11, <a href="./effect_modification/index.qmd">Effect Modification (효과 수정)</a> ⭐
<ul>
<li>1111-11-11, <a href="./effect_modification/vs_confounding.qmd">vs.&nbsp;Confounding (교란과의 구분)</a></li>
<li>1111-11-11, <a href="./effect_modification/statistical_interaction.qmd">Statistical Interaction (통계적 상호작용)</a></li>
<li>1111-11-11, <a href="./effect_modification/biological_interaction.qmd">Biological Interaction (생물학적 상호작용)</a></li>
</ul></li>
<li>1111-11-11, <a href="./control/index.qmd">Control Methods (통제 방법)</a>
<ul>
<li>1111-11-11, Design Stage Methods (설계 단계 방법)
<ul>
<li>1111-11-11, <a href="./control/restriction.qmd">Restriction (제한)</a></li>
<li>1111-11-11, <a href="./control/matching.qmd">Matching (매칭)</a></li>
</ul></li>
<li>1111-11-11, Analysis Stage Methods (분석 단계 방법)
<ul>
<li>1111-11-11, <a href="./control/stratification.qmd">Stratification Analysis (층화 분석)</a></li>
<li>1111-11-11, <a href="./control/standardization.qmd">Standardization (표준화)</a></li>
<li>1111-11-11, <a href="./control/regression_adjustment.qmd">Regression Adjustment (회귀 조정)</a></li>
</ul></li>
</ul></li>
</ul>
</section>
<section id="study-design-fundamentals" class="level2" data-number="1.7">
<h2 data-number="1.7" class="anchored" data-anchor-id="study-design-fundamentals"><span class="header-section-number">1.7</span> Study Design Fundamentals</h2>
<ul>
<li>1111-11-11, <a href="./fundamentals/sample_size_power.qmd">Sample Size and Power (표본 크기와 검정력)</a> ⭐
<ul>
<li>1111-11-11, <a href="./fundamentals/type1_error.qmd">Type I Error (1종 오류, α)</a></li>
<li>1111-11-11, <a href="./fundamentals/type2_error.qmd">Type II Error (2종 오류, β)</a></li>
<li>1111-11-11, <a href="./fundamentals/power.qmd">Statistical Power (통계적 검정력, 1-β)</a></li>
<li>1111-11-11, <a href="./fundamentals/effect_size.qmd">Effect Size (효과 크기)</a></li>
<li>1111-11-11, <a href="./fundamentals/sample_size_calc.qmd">Sample Size Calculation (표본 크기 계산)</a></li>
</ul></li>
<li>1111-11-11, <a href="./fundamentals/randomization.qmd">Randomization Methods (무작위 배정 방법)</a>
<ul>
<li>1111-11-11, <a href="./fundamentals/simple_random.qmd">Simple Randomization (단순 무작위배정)</a></li>
<li>1111-11-11, <a href="./fundamentals/block_random.qmd">Block Randomization (블록 무작위배정)</a></li>
<li>1111-11-11, <a href="./fundamentals/stratified_random.qmd">Stratified Randomization (층화 무작위배정)</a></li>
</ul></li>
<li>1111-11-11, <a href="./fundamentals/validity.qmd">Validity in Epidemiologic Studies (역학 연구의 타당도)</a>
<ul>
<li>1111-11-11, <a href="./fundamentals/internal_validity.qmd">Internal Validity (내적 타당도)</a></li>
<li>1111-11-11, <a href="./fundamentals/external_validity.qmd">External Validity (외적 타당도)</a></li>
<li>1111-11-11, <a href="./fundamentals/construct_validity.qmd">Construct Validity (구성 타당도)</a></li>
</ul></li>
</ul>
</section>
<section id="screening-and-diagnostic-tests" class="level2" data-number="1.8">
<h2 data-number="1.8" class="anchored" data-anchor-id="screening-and-diagnostic-tests"><span class="header-section-number">1.8</span> Screening and Diagnostic Tests</h2>
<ul>
<li>1111-11-11, <a href="./screening/index.qmd">Evaluation of Diagnostic Tests (진단검사 평가)</a>
<ul>
<li>1111-11-11, Test Performance Measures (검사 성능 지표)
<ul>
<li>1111-11-11, <a href="./screening/sensitivity.qmd">Sensitivity (민감도, True Positive Rate)</a></li>
<li>1111-11-11, <a href="./screening/specificity.qmd">Specificity (특이도, True Negative Rate)</a></li>
<li>1111-11-11, <a href="./screening/ppv.qmd">Positive Predictive Value (양성 예측도, PPV)</a></li>
<li>1111-11-11, <a href="./screening/npv.qmd">Negative Predictive Value (음성 예측도, NPV)</a></li>
</ul></li>
<li>1111-11-11, <a href="./screening/likelihood_ratios.qmd">Likelihood Ratios (우도비)</a>
<ul>
<li>1111-11-11, <a href="./screening/lr_positive.qmd">Positive Likelihood Ratio (양성 우도비, LR+)</a></li>
<li>1111-11-11, <a href="./screening/lr_negative.qmd">Negative Likelihood Ratio (음성 우도비, LR-)</a></li>
<li>1111-11-11, <a href="./screening/pretest_posttest.qmd">Pre-test to Post-test Probability (사전-사후 확률)</a></li>
</ul></li>
<li>1111-11-11, Trade-offs and Optimization (상충관계와 최적화)
<ul>
<li>1111-11-11, <a href="./screening/roc_curve.qmd">ROC Curve (ROC 곡선)</a></li>
<li>1111-11-11, <a href="./screening/auc.qmd">Area Under Curve (곡선하면적, AUC)</a></li>
<li>1111-11-11, <a href="./screening/cutpoint.qmd">Optimal Cut-point Selection (최적 절단값 선택)</a></li>
</ul></li>
<li>1111-11-11, <a href="./screening/bayesian.qmd">Bayesian Interpretation (베이지안 해석)</a>
<ul>
<li>1111-11-11, <a href="./screening/bayes_theorem.qmd">Bayes’ Theorem Connection (베이즈 정리와의 연결)</a></li>
</ul></li>
</ul></li>
</ul>
</section>
<section id="survival-analysis" class="level2" data-number="1.9">
<h2 data-number="1.9" class="anchored" data-anchor-id="survival-analysis"><span class="header-section-number">1.9</span> Survival Analysis</h2>
<ul>
<li>1111-11-11, <a href="./survival/index.qmd">Time-to-Event Analysis (시간-사건 분석)</a>
<ul>
<li>1111-11-11, Basic Concepts (기본 개념)
<ul>
<li>1111-11-11, <a href="./survival/censoring.qmd">Censoring (중도절단)</a></li>
<li>1111-11-11, <a href="./survival/survival_function.qmd">Survival Function (생존함수)</a></li>
<li>1111-11-11, <a href="./survival/hazard_function.qmd">Hazard Function (위험함수)</a></li>
</ul></li>
<li>1111-11-11, <a href="./survival/kaplan_meier.qmd">Kaplan-Meier Method (Kaplan-Meier 방법)</a>
<ul>
<li>1111-11-11, <a href="./survival/nonparametric.qmd">Non-parametric Estimation (비모수 추정)</a></li>
<li>1111-11-11, <a href="./survival/logrank_test.qmd">Log-rank Test (로그순위 검정)</a></li>
</ul></li>
<li>1111-11-11, <a href="./survival/cox_model.qmd">Cox Proportional Hazards Model (Cox 비례위험모형)</a>
<ul>
<li>1111-11-11, <a href="./survival/semiparametric.qmd">Semi-parametric Model (준모수 모형)</a></li>
<li>1111-11-11, <a href="./survival/hazard_ratio.qmd">Hazard Ratio (위험비)</a></li>
<li>1111-11-11, <a href="./survival/ph_assumption.qmd">Proportional Hazards Assumption (비례위험 가정)</a></li>
</ul></li>
<li>1111-11-11, Advanced Survival Topics (고급 생존분석 주제)
<ul>
<li>1111-11-11, <a href="./survival/competing_risks.qmd">Competing Risks (경쟁위험)</a></li>
<li>1111-11-11, <a href="./survival/recurrent_events.qmd">Recurrent Events (반복사건)</a></li>
</ul></li>
</ul></li>
</ul>
</section>
<section id="advanced-topics" class="level2" data-number="1.10">
<h2 data-number="1.10" class="anchored" data-anchor-id="advanced-topics"><span class="header-section-number">1.10</span> Advanced Topics</h2>
<ul>
<li>1111-11-11, <a href="./advanced/designs/index.qmd">Advanced Study Designs (고급 연구설계)</a>
<ul>
<li>1111-11-11, <a href="./advanced/designs/cluster_rct.qmd">Cluster Randomized Trials (군집 무작위 시험)</a></li>
<li>1111-11-11, <a href="./advanced/designs/stepped_wedge.qmd">Stepped Wedge Designs (단계적 쐐기 설계)</a></li>
<li>1111-11-11, <a href="./advanced/designs/adaptive.qmd">Adaptive Designs (적응형 설계)</a></li>
<li>1111-11-11, <a href="./advanced/designs/platform_trials.qmd">Platform Trials (플랫폼 시험)</a></li>
</ul></li>
<li>1111-11-11, <a href="./advanced/causal/index.qmd">Advanced Causal Methods (고급 인과추론 방법)</a>
<ul>
<li>1111-11-11, <a href="./advanced/causal/instrumental_variables.qmd">Instrumental Variables (도구변수)</a></li>
<li>1111-11-11, <a href="./advanced/causal/rdd.qmd">Regression Discontinuity Design (회귀불연속 설계)</a></li>
<li>1111-11-11, <a href="./advanced/causal/did.qmd">Difference-in-Differences (이중차분법)</a></li>
<li>1111-11-11, <a href="./advanced/causal/synthetic_control.qmd">Synthetic Control Methods (합성 통제 방법)</a></li>
</ul></li>
<li>1111-11-11, <a href="./advanced/stats/index.qmd">Advanced Statistical Methods (고급 통계 방법)</a>
<ul>
<li>1111-11-11, <a href="./advanced/stats/multilevel_modeling.qmd">Multilevel/Hierarchical Modeling (다층/계층 모델링)</a></li>
<li>1111-11-11, <a href="./advanced/stats/meta_analysis.qmd">Meta-analysis (메타분석)</a>
<ul>
<li>1111-11-11, <a href="./advanced/stats/fixed_effects.qmd">Fixed Effects Model (고정효과 모형)</a></li>
<li>1111-11-11, <a href="./advanced/stats/random_effects.qmd">Random Effects Model (무선효과 모형)</a></li>
<li>1111-11-11, <a href="./advanced/stats/meta_regression.qmd">Meta-regression (메타회귀분석)</a></li>
</ul></li>
<li>1111-11-11, <a href="./advanced/stats/missing_data.qmd">Missing Data Methods (결측치 처리 방법)</a>
<ul>
<li>1111-11-11, <a href="./advanced/stats/missing_mechanisms.qmd">MCAR, MAR, MNAR (결측 메커니즘)</a></li>
<li>1111-11-11, <a href="./advanced/stats/multiple_imputation.qmd">Multiple Imputation (다중대체)</a></li>
</ul></li>
<li>1111-11-11, <a href="./advanced/stats/measurement_error.qmd">Measurement Error Models (측정 오차 모형)</a></li>
</ul></li>
<li>1111-11-11, <a href="./advanced/special/index.qmd">Special Topics (특수 주제)</a>
<ul>
<li>1111-11-11, <a href="./advanced/special/time_varying_confounding.qmd">Time-varying Confounding (시간가변 교란)</a></li>
<li>1111-11-11, <a href="./advanced/special/mediation.qmd">Mediation Analysis (매개분석)</a></li>
<li>1111-11-11, <a href="./advanced/special/g_methods.qmd">G-methods (G-방법)</a>
<ul>
<li>1111-11-11, <a href="./advanced/special/g_computation.qmd">G-computation (G-계산)</a></li>
<li>1111-11-11, <a href="./advanced/special/ipw.qmd">Inverse Probability Weighting (역확률 가중)</a></li>
<li>1111-11-11, <a href="./advanced/special/g_estimation.qmd">G-estimation (G-추정)</a></li>
</ul></li>
<li>1111-11-11, <a href="./advanced/special/sensitivity_analysis.qmd">Sensitivity Analysis (민감도 분석)</a></li>
</ul></li>
</ul>


</section>
</section>

 ]]></description>
  <category>Epidemiology</category>
  <guid>kk3225.netlify.app/docs/blog/posts/Experimentation/Epidemiology/</guid>
  <pubDate>Sun, 28 Feb 2100 15:00:00 GMT</pubDate>
</item>
<item>
  <title>Mathematics</title>
  <dc:creator>Kwangmin Kim</dc:creator>
  <link>kk3225.netlify.app/docs/blog/posts/Math/</link>
  <description><![CDATA[ 





<section id="contents" class="level1" data-number="1">

<section id="basic" class="level2" data-number="1.1">

<ul>
<li>2023-03-24, <a href="./variables/index.qmd">Variable types</a></li>
<li>1111-11-11, <a href="./function/index.qmd">Function</a>
<ul>
<li>2023-01-31, <a href="../../../../docs/blog/posts/Math/function/univariable_scalar_function.html">Function (1) - Univariable Scalar Function (One to One)</a></li>
<li>2023-01-31, <a href="../../../../docs/blog/posts/Math/function/multivariable_scalar_function.html">Function (2) - Multi-variable Scalar Function (Many to One)</a></li>
<li>2023-01-31, <a href="../../../../docs/blog/posts/Math/function/univariable_vector_function.html">Function (3) - Univariable Vector Function (One to Many)</a></li>
<li>2023-01-31, <a href="../../../../docs/blog/posts/Math/function/mutivariable_vector_function.html">Function (4) - Multi-variable Vector Function (Many to Many)</a></li>
<li>2023-02-18, <a href="../../../../docs/blog/posts/Math/function/composite_function.html">Function (5) - Composite Function</a></li>
</ul></li>
<li>2023-02-18, <a href="./transformation/index.qmd">Transformations of Functions</a></li>
<li>1111-11-11, Vector &amp; Matrix</li>
<li>2023-03-15, <a href="./epsilon_delta/">Limit, <img src="https://latex.codecogs.com/png.latex?%5Cepsilon-%5Cdelta"> Method</a></li>
<li>Differentiation
<ul>
<li>2023-02-04, <a href="./differentiation/2023-02-04_uni_derivative.qmd">Derivative (1) - Univariable Scalar Funtion</a></li>
<li>1111-11-11, <a href="./differentiation/2023-02-10_composite_partial_derivative.qmd">Derivative (2) - Chain Rule &amp; Partial Derivative</a></li>
<li>1111-11-11, Derivative (3) - Higher Order Derivative</li>
<li>1111-11-11, Derivative (4) - Mean Value Theorem</li>
<li>1111-11-11, Derivative (5) - Gradient</li>
</ul></li>
<li>2023-03-15, <a href="./taylor_series/index.qmd">Talyer’s Series</a></li>
<li>1111-11-11, Gradient Direction</li>
<li>1111-11-11, Random Variable</li>
<li>1111-11-11, Probability Distribution</li>
<li>1111-11-11, Information Theory - Entropy</li>
<li>1111-11-11,</li>
<li>1111-11-11,</li>
<li>1111-11-11,</li>
<li>1111-11-11,</li>
</ul>
</section>
<section id="linear-algebra" class="level2" data-number="1.2">

<ul>
<li>2023-03-30, <a href="../../../../docs/blog/posts/Math/linear_algebra/01.basic_vector.html">Basic Vector(1) - Vector Operations</a></li>
<li>2023-03-30, <a href="../../../../docs/blog/posts/Math/linear_algebra/02.norm_dot-product.html">Basic Vector(2) - Vector Norm and Dot Product”</a></li>
<li>2023-03-30, <a href="../../../../docs/blog/posts/Math/linear_algebra/03.vector_equation.html">Basic Vector(3) - Vector Equation</a></li>
<li>2023-03-30, Basic Matrix(1) - Matrix Operation</li>
<li>2023-03-30, Basic Matrix(2) - Matrix Multiplication</li>
<li>2023-03-30, <a href="../../../../docs/blog/posts/Math/linear_algebra/06.system_of_lineqr_equations.html">Basic Matrix(3) - System of Linear Equations</a></li>
<li>2023-03-30, <a href="../../../../docs/blog/posts/Math/linear_algebra/09.special_matrix.html">Basic Matrix(4) - Special Matrix</a></li>
<li>2023-04-14, [Lineqr Equations]</li>
<li>2023-04-14, [Vector Space and Subspaces]</li>
<li>2023-04-21, [Orthogonality]</li>
<li>1111-11-11, [Determinants]</li>
<li>1111-11-11, [Eigen Value &amp; Eigen Vector]</li>
<li>1111-11-11, [Linear Transformations]</li>
<li>1111-11-11, Basis, Dimension, &amp; Rank</li>
<li>1111-11-11,</li>
<li>1111-11-11, Eigen Decomposition</li>
<li>1111-11-11, Singular Value Decomposition (SVD)</li>
<li>1111-11-11, Group</li>
<li>1111-11-11, Rotation &amp; Group</li>
<li>2023-04-02, <a href="./linear_algebra/quadratic_form.qmd">Matrix Transformation (5) - Quadratic Form</a></li>
<li>2023-04-02, <a href="../../../../docs/blog/posts/Math/linear_algebra/derivative_matrix_vector.html">Matrix Calculus (1) - Quadratic Form</a></li>
<li>1111-11-11,</li>
<li>1111-11-11,</li>
<li>1111-11-11,</li>
</ul>
</section>
<section id="optimization" class="level2" data-number="1.3">

<ul>
<li>2023-03-23, <a href="./optimization/minimizer.qmd">Minimizer &amp; Minimum</a></li>
<li>1111-11-11, Convex Set</li>
<li>1111-11-11, Convex Function</li>
<li>1111-11-11, Unconstrained Optimization</li>
<li>1111-11-11, Non-linear Least Square</li>
<li>1111-11-11, Largrange Multiplier Method
<ul>
<li>1111-11-11, Largrange Primal Function</li>
<li>1111-11-11, Largrange Dual Function</li>
<li>1111-11-11, KKT conditions</li>
</ul></li>
<li>1111-11-11, Gradient Descent Optimizers</li>
<li>1111-11-11,</li>
<li>1111-11-11,</li>
<li>1111-11-11,</li>
<li>1111-11-11,</li>
<li>1111-11-11,</li>
<li>1111-11-11,</li>
</ul>


</section>
</section>

 ]]></description>
  <category>Mathematics</category>
  <guid>kk3225.netlify.app/docs/blog/posts/Math/</guid>
  <pubDate>Sun, 28 Feb 2100 15:00:00 GMT</pubDate>
</item>
<item>
  <title>Physical Architecture 설계하는 방법</title>
  <dc:creator>Kwangmin Kim</dc:creator>
  <link>kk3225.netlify.app/docs/blog/posts/Engineering/System/Archi_Design/physical_design.html</link>
  <description><![CDATA[ 





<section id="physical-architecture의-정의" class="level2" data-number="1">
<h2 data-number="1" class="anchored" data-anchor-id="physical-architecture의-정의"><span class="header-section-number">1</span> Physical Architecture의 정의</h2>
<p>Physical Architecture는 Logical Architecture를 구체적인 기술 스택과 인프라로 구현하는 설계 계층이다. 실제 배포, 운영, 모니터링이 가능한 형태로 정의된다.</p>
<p><strong>핵심 특징:</strong></p>
<ul>
<li><strong>기술 명시</strong>: 프로그래밍 언어, 프레임워크, 데이터베이스, 클라우드 서비스 구체화</li>
<li><strong>인프라 정의</strong>: 서버, 네트워크, 스토리지 구조 명시</li>
<li><strong>배포 단위</strong>: 컨테이너, 마이크로서비스, 서버리스 등 배포 형태</li>
<li><strong>운영 고려</strong>: 모니터링, 로깅, 스케일링, 재해 복구 전략</li>
<li><strong>비용 및 성능</strong>: 실제 리소스 할당, 예상 비용</li>
<li><strong>개발팀 지향</strong>: 구현 팀이 직접 따를 수 있는 명확한 지침</li>
</ul>
<section id="세-계층의-최종-비교" class="level3" data-number="1.1">
<h3 data-number="1.1" class="anchored" data-anchor-id="세-계층의-최종-비교"><span class="header-section-number">1.1</span> 세 계층의 최종 비교</h3>
<table class="table">
<colgroup>
<col style="width: 16%">
<col style="width: 30%">
<col style="width: 25%">
<col style="width: 27%">
</colgroup>
<thead>
<tr class="header">
<th>측면</th>
<th>Conceptual</th>
<th>Logical</th>
<th>Physical</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td><strong>대상</strong></td>
<td>모든 이해관계자</td>
<td>개발팀, 아키텍트</td>
<td>개발팀, DevOps팀</td>
</tr>
<tr class="even">
<td><strong>추상화</strong></td>
<td>매우 높음</td>
<td>중간</td>
<td>낮음 (구체적)</td>
</tr>
<tr class="odd">
<td><strong>기술</strong></td>
<td>없음</td>
<td>독립적</td>
<td>명시적</td>
</tr>
<tr class="even">
<td><strong>예: 저장소</strong></td>
<td>“저장소”</td>
<td>“Relational DB + Cache Layer”</td>
<td>“PostgreSQL 14 + Redis 7”</td>
</tr>
<tr class="odd">
<td><strong>예: 통신</strong></td>
<td>“데이터 전달”</td>
<td>“REST API”</td>
<td>“FastAPI + gRPC”</td>
</tr>
<tr class="even">
<td><strong>초점</strong></td>
<td>무엇을</td>
<td>어떻게 (기술 중립)</td>
<td>무엇으로</td>
</tr>
<tr class="odd">
<td><strong>산출물</strong></td>
<td>개념도</td>
<td>모듈 명세서</td>
<td>배포 가이드</td>
</tr>
</tbody>
</table>
</section>
</section>
<section id="physical-architecture-설계-단계" class="level2" data-number="2">
<h2 data-number="2" class="anchored" data-anchor-id="physical-architecture-설계-단계"><span class="header-section-number">2</span> Physical Architecture 설계 단계</h2>
<section id="기술-스택-선택-전-고려사항" class="level3" data-number="2.1">
<h3 data-number="2.1" class="anchored" data-anchor-id="기술-스택-선택-전-고려사항"><span class="header-section-number">2.1</span> 기술 스택 선택 전 고려사항</h3>
<p>Physical 설계를 시작하기 전에 다음을 검토해야 한다:</p>
<ul>
<li><strong>조직의 기술 역량</strong>: 팀이 보유한 기술 경험과 학습 곡선</li>
<li><strong>프로젝트 특성</strong>: 시스템의 복잡도, 규모, 기간</li>
<li><strong>성능 요구사항</strong>: 응답시간, 처리량, 동시성 목표</li>
<li><strong>운영 환경</strong>: 온프레미스 vs 클라우드, 멀티클라우드 전략</li>
<li><strong>비용 제약</strong>: 초기 투자, 운영 비용</li>
<li><strong>지속 가능성</strong>: 커뮤니티 지원, 장기 유지보수성</li>
</ul>
</section>
<section id="기술-스택-선택-프레임워크" class="level3" data-number="2.2">
<h3 data-number="2.2" class="anchored" data-anchor-id="기술-스택-선택-프레임워크"><span class="header-section-number">2.2</span> 기술 스택 선택 프레임워크</h3>
<p>각 Logical 모듈에 대해 기술을 선택할 때는 다음 기준으로 평가한다:</p>
<p><strong>평가 기준:</strong></p>
<ol type="1">
<li><strong>기능성 (Functionality)</strong>: 요구사항을 충족하는가?</li>
<li><strong>성능 (Performance)</strong>: 성능 목표를 달성할 수 있는가?</li>
<li><strong>확장성 (Scalability)</strong>: 수평/수직 확장이 가능한가?</li>
<li><strong>운영성 (Operability)</strong>: 배포, 모니터링, 유지보수가 쉬운가?</li>
<li><strong>비용 (Cost)</strong>: 라이선스, 인프라, 인력 비용이 적절한가?</li>
<li><strong>에코시스템 (Ecosystem)</strong>: 라이브러리, 도구, 커뮤니티가 활발한가?</li>
<li><strong>보안 (Security)</strong>: 보안 기능과 업데이트 지원이 충분한가?</li>
<li><strong>학습곡선 (Learning Curve)</strong>: 팀이 얼마나 빨리 습득할 수 있는가?</li>
</ol>
<p><strong>선택 매트릭스 예시:</strong></p>
<table class="table">
<thead>
<tr class="header">
<th>기술</th>
<th>기능</th>
<th>성능</th>
<th>확장</th>
<th>운영</th>
<th>비용</th>
<th>에코</th>
<th>보안</th>
<th>학습</th>
<th>총점</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td>PostgreSQL</td>
<td>9</td>
<td>8</td>
<td>8</td>
<td>9</td>
<td>10</td>
<td>10</td>
<td>9</td>
<td>8</td>
<td>8.6</td>
</tr>
<tr class="even">
<td>MongoDB</td>
<td>8</td>
<td>7</td>
<td>9</td>
<td>7</td>
<td>8</td>
<td>9</td>
<td>7</td>
<td>8</td>
<td>7.9</td>
</tr>
<tr class="odd">
<td>Elasticsearch</td>
<td>9</td>
<td>9</td>
<td>9</td>
<td>8</td>
<td>6</td>
<td>9</td>
<td>8</td>
<td>7</td>
<td>8.1</td>
</tr>
</tbody>
</table>
</section>
<section id="계층별-기술-선택" class="level3" data-number="2.3">
<h3 data-number="2.3" class="anchored" data-anchor-id="계층별-기술-선택"><span class="header-section-number">2.3</span> 계층별 기술 선택</h3>
<section id="프레젠테이션-계층-presentation-layer" class="level4" data-number="2.3.1">
<h4 data-number="2.3.1" class="anchored" data-anchor-id="프레젠테이션-계층-presentation-layer"><span class="header-section-number">2.3.1</span> 프레젠테이션 계층 (Presentation Layer)</h4>
<pre><code>Logical Module: ChatInterface, APIGateway, Dashboard

선택 가능 기술:
- Frontend: React, Vue, Angular, Svelte
- Backend Framework: FastAPI, Flask, Django (Python)
                     Spring Boot (Java)
                     Express, NestJS (Node.js)
- API Gateway: Kong, AWS API Gateway, Nginx
- WebSocket: Socket.io, WebSocket (native)</code></pre>
<p><strong>선택 예시: Python 기반 빠른 개발</strong></p>
<pre><code>Chat Interface: 
  - Frontend: React + TypeScript
  - Backend: FastAPI
  - WebSocket: WebSocket (native) or Socket.io
  
API Gateway:
  - Nginx (경량) or Kong (기능 풍부)

Dashboard:
  - Frontend: Streamlit (프로토타입) or React
  - Backend: FastAPI</code></pre>
<p><strong>선택 예시: Java 엔터프라이즈 환경</strong></p>
<pre><code>Chat Interface:
  - Frontend: React or Angular
  - Backend: Spring Boot
  - WebSocket: Spring WebSocket
  
API Gateway:
  - Spring Cloud Gateway or Kong
  
Dashboard:
  - Frontend: Angular
  - Backend: Spring Boot</code></pre>
</section>
<section id="애플리케이션-계층-application-layer" class="level4" data-number="2.3.2">
<h4 data-number="2.3.2" class="anchored" data-anchor-id="애플리케이션-계층-application-layer"><span class="header-section-number">2.3.2</span> 애플리케이션 계층 (Application Layer)</h4>
<pre><code>Logical Module: RequestHandler, Orchestration, QueryProcessor, ReasoningEngine

선택 가능 기술:
- 오케스트레이션: 커스텀 로직, Celery (Python), Akka (Java)
- 비동기 처리: AsyncIO (Python), CompletableFuture (Java)
- 워크플로우 엔진: Apache Airflow, Temporal, AWS Step Functions
- 메시지 큐: RabbitMQ, Apache Kafka, AWS SQS</code></pre>
<p><strong>선택 예시: Python + LangChain RAG</strong></p>
<pre><code>QueryProcessor:
  - LangChain (파이썬 라이브러리)
  - Custom Python 클래스
  
ReasoningEngine:
  - LangChain Agent
  - LLM 호출 (OpenAI API, Anthropic API)
  
Orchestration:
  - 커스텀 Python 로직 or Celery (분산 작업)</code></pre>
<p><strong>선택 예시: Java 엔터프라이즈 오케스트레이션</strong></p>
<pre><code>RequestHandler:
  - Spring Controller
  
Orchestration:
  - Spring Cloud Task
  - Temporal (복잡한 워크플로우)
  
MessagingQueue:
  - RabbitMQ or Apache Kafka</code></pre>
</section>
<section id="데이터-계층-data-layer" class="level4" data-number="2.3.3">
<h4 data-number="2.3.3" class="anchored" data-anchor-id="데이터-계층-data-layer"><span class="header-section-number">2.3.3</span> 데이터 계층 (Data Layer)</h4>
<pre><code>Logical Module: VectorStore, TextRepository, MetadataRepository, CacheLayer

선택 가능 기술:

벡터 저장소:
  - FAISS (로컬, 인메모리)
  - Chroma (오픈소스, 경량)
  - Weaviate (프로덕션용)
  - Milvus (고성능)
  - Pinecone (클라우드 SaaS)
  - Azure Cognitive Search (클라우드)

텍스트 저장소:
  - PostgreSQL + pgvector (벡터 지원)
  - Elasticsearch (검색 최적화)
  - MongoDB (유연한 스키마)
  - Azure Cosmos DB

메타데이터 저장소:
  - PostgreSQL
  - Redis (빠른 접근)
  - DynamoDB (AWS)

캐시 계층:
  - Redis
  - Memcached
  - Local In-Memory Cache</code></pre>
<p><strong>선택 예시: 빠른 프로토타입</strong></p>
<pre><code>Vector Store:
  - FAISS (로컬) or Chroma (간단한 배포)
  
Text Repository:
  - PostgreSQL with full-text search
  
Metadata Repository:
  - PostgreSQL의 같은 인스턴스
  
Cache Layer:
  - Redis (선택사항, 필요시)</code></pre>
<p><strong>선택 예시: 프로덕션 고성능 시스템</strong></p>
<pre><code>Vector Store:
  - Milvus (클러스터 구성)
  or Pinecone (완전 관리형)
  
Text Repository:
  - Elasticsearch (검색 성능)
  + PostgreSQL (트랜잭션)
  
Metadata Repository:
  - PostgreSQL
  
Cache Layer:
  - Redis Cluster (고가용성)</code></pre>
</section>
</section>
</section>
<section id="physical-architecture-다이어그램" class="level2" data-number="3">
<h2 data-number="3" class="anchored" data-anchor-id="physical-architecture-다이어그램"><span class="header-section-number">3</span> Physical Architecture 다이어그램</h2>
<section id="배포-아키텍처-다이어그램" class="level3" data-number="3.1">
<h3 data-number="3.1" class="anchored" data-anchor-id="배포-아키텍처-다이어그램"><span class="header-section-number">3.1</span> 배포 아키텍처 다이어그램</h3>
<pre><code>┌─────────────────────────────────────────────────────────────┐
│                         인터넷                               │
└────────────────┬────────────────────────────────────────────┘
                 │
        ┌────────▼────────┐
        │  Load Balancer  │ (Nginx / AWS ALB)
        │  (포트 443)     │
        └────────┬────────┘
                 │
        ┌────────▼────────────────────────┐
        │   Kubernetes Cluster            │
        │   (또는 EC2 / App Service)      │
        │                                 │
        │  ┌─────────────────────────┐   │
        │  │  Frontend Pods          │   │
        │  │  (React + Nginx)        │   │
        │  │  - 2 replicas           │   │
        │  └────────┬────────────────┘   │
        │           │                    │
        │  ┌────────▼────────────────┐   │
        │  │  API Service Pods       │   │
        │  │  (FastAPI)              │   │
        │  │  - 3 replicas           │   │
        │  └────────┬────────────────┘   │
        │           │                    │
        │  ┌────────▼────────────────┐   │
        │  │  Worker Pods            │   │
        │  │  (RAG Processing)       │   │
        │  │  - 2 replicas           │   │
        │  └────────┬────────────────┘   │
        │           │                    │
        └───────────┼────────────────────┘
                    │
        ┌───────────┴───────────┬──────────────┬─────────────┐
        │                       │              │             │
    ┌───▼──────┐       ┌───────▼─────┐  ┌───▼────┐  ┌──────▼─────┐
    │PostgreSQL│       │   Milvus    │  │ Redis  │  │ S3 Storage │
    │  + PgVec │       │  (Vector DB)│  │ Cache  │  │ (Raw Data) │
    └──────────┘       └─────────────┘  └────────┘  └────────────┘
        (Metadata)</code></pre>
</section>
<section id="컨테이너-구성-예시" class="level3" data-number="3.2">
<h3 data-number="3.2" class="anchored" data-anchor-id="컨테이너-구성-예시"><span class="header-section-number">3.2</span> 컨테이너 구성 예시</h3>
<pre><code>Docker Image 1: frontend
  - Base: node:18-alpine
  - Content: React App + Nginx
  - Size: ~150MB
  - Registry: ECR / Docker Hub

Docker Image 2: api-service
  - Base: python:3.11-slim
  - Content: FastAPI application
  - Dependencies: LangChain, openai, pydantic
  - Size: ~800MB
  - Registry: ECR / Docker Hub

Docker Image 3: worker
  - Base: python:3.11-slim
  - Content: RAG worker process
  - Dependencies: LangChain, Celery, milvus-sdk
  - Size: ~900MB
  - Registry: ECR / Docker Hub

Docker Image 4: vector-db
  - Base: milvusdb/milvus:latest
  - Content: Milvus vector database
  - Ports: 19530 (gRPC), 9091 (HTTP)
  - Volumes: /var/lib/milvus (persistent)

Docker Image 5: postgres
  - Base: postgres:15-alpine
  - Extensions: pgvector
  - Ports: 5432
  - Volumes: /var/lib/postgresql/data

Docker Image 6: redis
  - Base: redis:7-alpine
  - Ports: 6379
  - Volumes: /data (persistence)</code></pre>
</section>
<section id="네트워크-토폴로지" class="level3" data-number="3.3">
<h3 data-number="3.3" class="anchored" data-anchor-id="네트워크-토폴로지"><span class="header-section-number">3.3</span> 네트워크 토폴로지</h3>
<pre><code>외부 트래픽
    │
    ▼
┌─────────────────┐
│  CDN / CloudFront│ (정적 콘텐츠)
└────────┬────────┘
         │
         ▼
    ┌─────────────┐
    │Load Balancer│
    └─────┬───────┘
          │
     ┌────┴────────────────────┐
     │                         │
     ▼                         ▼
 ┌────────┐              ┌────────────┐
 │ Public │              │Private Network
 │Subnets │              │(DB, Cache) │
 │        │              │            │
 │Frontend│              │ PostgreSQL │
 │Pods    │◄────────────▶│ Milvus    │
 │        │              │ Redis     │
 └────────┘              └────────────┘
     │                         │
     │     External Storage   │
     │     (S3/Blob Storage)   │
     └─────────────┬───────────┘
                   │
               ┌───▼────┐
               │ Backup │
               └────────┘</code></pre>
</section>
<section id="프로젝트-예시" class="level3" data-number="3.4">
<h3 data-number="3.4" class="anchored" data-anchor-id="프로젝트-예시"><span class="header-section-number">3.4</span> 프로젝트 예시</h3>
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="kk3225.netlify.app/docs/blog/posts/Engineering/System/Archi_Design/sw_physical_architecture.png" class="img-fluid figure-img"></p>
<figcaption>SW Architecture 예시</figcaption>
</figure>
</div>
</section>
</section>
<section id="배포-옵션-선택" class="level2" data-number="4">
<h2 data-number="4" class="anchored" data-anchor-id="배포-옵션-선택"><span class="header-section-number">4</span> 배포 옵션 선택</h2>
<section id="옵션-1-로컬-개발-환경" class="level3" data-number="4.1">
<h3 data-number="4.1" class="anchored" data-anchor-id="옵션-1-로컬-개발-환경"><span class="header-section-number">4.1</span> 옵션 1: 로컬 개발 환경</h3>
<div class="sourceCode" id="cb13" style="background: #f1f3f5;"><pre class="sourceCode numberSource yaml number-lines code-with-copy"><code class="sourceCode yaml"><span id="cb13-1"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># docker-compose.yml</span></span>
<span id="cb13-2"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">version</span><span class="kw" style="color: #003B4F;
background-color: null;
font-style: inherit;">:</span><span class="at" style="color: #657422;
background-color: null;
font-style: inherit;"> </span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">'3.8'</span></span>
<span id="cb13-3"></span>
<span id="cb13-4"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">services</span><span class="kw" style="color: #003B4F;
background-color: null;
font-style: inherit;">:</span></span>
<span id="cb13-5"><span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">  </span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">frontend</span><span class="kw" style="color: #003B4F;
background-color: null;
font-style: inherit;">:</span></span>
<span id="cb13-6"><span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">    </span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">build</span><span class="kw" style="color: #003B4F;
background-color: null;
font-style: inherit;">:</span><span class="at" style="color: #657422;
background-color: null;
font-style: inherit;"> ./frontend</span></span>
<span id="cb13-7"><span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">    </span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">ports</span><span class="kw" style="color: #003B4F;
background-color: null;
font-style: inherit;">:</span></span>
<span id="cb13-8"><span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">      </span><span class="kw" style="color: #003B4F;
background-color: null;
font-style: inherit;">-</span><span class="at" style="color: #657422;
background-color: null;
font-style: inherit;"> </span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"3000:3000"</span></span>
<span id="cb13-9"><span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">    </span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">environment</span><span class="kw" style="color: #003B4F;
background-color: null;
font-style: inherit;">:</span></span>
<span id="cb13-10"><span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">      </span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">REACT_APP_API_URL</span><span class="kw" style="color: #003B4F;
background-color: null;
font-style: inherit;">:</span><span class="at" style="color: #657422;
background-color: null;
font-style: inherit;"> http://localhost:8000</span></span>
<span id="cb13-11"></span>
<span id="cb13-12"><span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">  </span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">api</span><span class="kw" style="color: #003B4F;
background-color: null;
font-style: inherit;">:</span></span>
<span id="cb13-13"><span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">    </span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">build</span><span class="kw" style="color: #003B4F;
background-color: null;
font-style: inherit;">:</span><span class="at" style="color: #657422;
background-color: null;
font-style: inherit;"> ./backend</span></span>
<span id="cb13-14"><span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">    </span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">ports</span><span class="kw" style="color: #003B4F;
background-color: null;
font-style: inherit;">:</span></span>
<span id="cb13-15"><span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">      </span><span class="kw" style="color: #003B4F;
background-color: null;
font-style: inherit;">-</span><span class="at" style="color: #657422;
background-color: null;
font-style: inherit;"> </span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"8000:8000"</span></span>
<span id="cb13-16"><span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">    </span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">environment</span><span class="kw" style="color: #003B4F;
background-color: null;
font-style: inherit;">:</span></span>
<span id="cb13-17"><span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">      </span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">DATABASE_URL</span><span class="kw" style="color: #003B4F;
background-color: null;
font-style: inherit;">:</span><span class="at" style="color: #657422;
background-color: null;
font-style: inherit;"> postgresql://user:password@postgres:5432/rag_db</span></span>
<span id="cb13-18"><span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">      </span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">REDIS_URL</span><span class="kw" style="color: #003B4F;
background-color: null;
font-style: inherit;">:</span><span class="at" style="color: #657422;
background-color: null;
font-style: inherit;"> redis://redis:6379</span></span>
<span id="cb13-19"><span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">      </span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">MILVUS_HOST</span><span class="kw" style="color: #003B4F;
background-color: null;
font-style: inherit;">:</span><span class="at" style="color: #657422;
background-color: null;
font-style: inherit;"> milvus</span></span>
<span id="cb13-20"><span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">      </span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">OPENAI_API_KEY</span><span class="kw" style="color: #003B4F;
background-color: null;
font-style: inherit;">:</span><span class="at" style="color: #657422;
background-color: null;
font-style: inherit;"> ${OPENAI_API_KEY}</span></span>
<span id="cb13-21"><span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">    </span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">depends_on</span><span class="kw" style="color: #003B4F;
background-color: null;
font-style: inherit;">:</span></span>
<span id="cb13-22"><span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">      </span><span class="kw" style="color: #003B4F;
background-color: null;
font-style: inherit;">-</span><span class="at" style="color: #657422;
background-color: null;
font-style: inherit;"> postgres</span></span>
<span id="cb13-23"><span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">      </span><span class="kw" style="color: #003B4F;
background-color: null;
font-style: inherit;">-</span><span class="at" style="color: #657422;
background-color: null;
font-style: inherit;"> redis</span></span>
<span id="cb13-24"><span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">      </span><span class="kw" style="color: #003B4F;
background-color: null;
font-style: inherit;">-</span><span class="at" style="color: #657422;
background-color: null;
font-style: inherit;"> milvus</span></span>
<span id="cb13-25"></span>
<span id="cb13-26"><span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">  </span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">postgres</span><span class="kw" style="color: #003B4F;
background-color: null;
font-style: inherit;">:</span></span>
<span id="cb13-27"><span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">    </span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">image</span><span class="kw" style="color: #003B4F;
background-color: null;
font-style: inherit;">:</span><span class="at" style="color: #657422;
background-color: null;
font-style: inherit;"> postgres:15-alpine</span></span>
<span id="cb13-28"><span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">    </span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">environment</span><span class="kw" style="color: #003B4F;
background-color: null;
font-style: inherit;">:</span></span>
<span id="cb13-29"><span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">      </span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">POSTGRES_PASSWORD</span><span class="kw" style="color: #003B4F;
background-color: null;
font-style: inherit;">:</span><span class="at" style="color: #657422;
background-color: null;
font-style: inherit;"> password</span></span>
<span id="cb13-30"><span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">      </span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">POSTGRES_DB</span><span class="kw" style="color: #003B4F;
background-color: null;
font-style: inherit;">:</span><span class="at" style="color: #657422;
background-color: null;
font-style: inherit;"> rag_db</span></span>
<span id="cb13-31"><span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">    </span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">volumes</span><span class="kw" style="color: #003B4F;
background-color: null;
font-style: inherit;">:</span></span>
<span id="cb13-32"><span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">      </span><span class="kw" style="color: #003B4F;
background-color: null;
font-style: inherit;">-</span><span class="at" style="color: #657422;
background-color: null;
font-style: inherit;"> postgres_data:/var/lib/postgresql/data</span></span>
<span id="cb13-33"><span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">    </span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">ports</span><span class="kw" style="color: #003B4F;
background-color: null;
font-style: inherit;">:</span></span>
<span id="cb13-34"><span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">      </span><span class="kw" style="color: #003B4F;
background-color: null;
font-style: inherit;">-</span><span class="at" style="color: #657422;
background-color: null;
font-style: inherit;"> </span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"5432:5432"</span></span>
<span id="cb13-35"></span>
<span id="cb13-36"><span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">  </span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">redis</span><span class="kw" style="color: #003B4F;
background-color: null;
font-style: inherit;">:</span></span>
<span id="cb13-37"><span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">    </span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">image</span><span class="kw" style="color: #003B4F;
background-color: null;
font-style: inherit;">:</span><span class="at" style="color: #657422;
background-color: null;
font-style: inherit;"> redis:7-alpine</span></span>
<span id="cb13-38"><span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">    </span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">ports</span><span class="kw" style="color: #003B4F;
background-color: null;
font-style: inherit;">:</span></span>
<span id="cb13-39"><span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">      </span><span class="kw" style="color: #003B4F;
background-color: null;
font-style: inherit;">-</span><span class="at" style="color: #657422;
background-color: null;
font-style: inherit;"> </span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"6379:6379"</span></span>
<span id="cb13-40"><span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">    </span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">volumes</span><span class="kw" style="color: #003B4F;
background-color: null;
font-style: inherit;">:</span></span>
<span id="cb13-41"><span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">      </span><span class="kw" style="color: #003B4F;
background-color: null;
font-style: inherit;">-</span><span class="at" style="color: #657422;
background-color: null;
font-style: inherit;"> redis_data:/data</span></span>
<span id="cb13-42"></span>
<span id="cb13-43"><span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">  </span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">milvus</span><span class="kw" style="color: #003B4F;
background-color: null;
font-style: inherit;">:</span></span>
<span id="cb13-44"><span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">    </span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">image</span><span class="kw" style="color: #003B4F;
background-color: null;
font-style: inherit;">:</span><span class="at" style="color: #657422;
background-color: null;
font-style: inherit;"> milvusdb/milvus:latest</span></span>
<span id="cb13-45"><span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">    </span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">environment</span><span class="kw" style="color: #003B4F;
background-color: null;
font-style: inherit;">:</span></span>
<span id="cb13-46"><span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">      </span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">COMMON_STORAGETYPE</span><span class="kw" style="color: #003B4F;
background-color: null;
font-style: inherit;">:</span><span class="at" style="color: #657422;
background-color: null;
font-style: inherit;"> local</span></span>
<span id="cb13-47"><span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">    </span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">ports</span><span class="kw" style="color: #003B4F;
background-color: null;
font-style: inherit;">:</span></span>
<span id="cb13-48"><span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">      </span><span class="kw" style="color: #003B4F;
background-color: null;
font-style: inherit;">-</span><span class="at" style="color: #657422;
background-color: null;
font-style: inherit;"> </span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"19530:19530"</span></span>
<span id="cb13-49"><span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">      </span><span class="kw" style="color: #003B4F;
background-color: null;
font-style: inherit;">-</span><span class="at" style="color: #657422;
background-color: null;
font-style: inherit;"> </span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"9091:9091"</span></span>
<span id="cb13-50"><span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">    </span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">volumes</span><span class="kw" style="color: #003B4F;
background-color: null;
font-style: inherit;">:</span></span>
<span id="cb13-51"><span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">      </span><span class="kw" style="color: #003B4F;
background-color: null;
font-style: inherit;">-</span><span class="at" style="color: #657422;
background-color: null;
font-style: inherit;"> milvus_data:/var/lib/milvus</span></span>
<span id="cb13-52"></span>
<span id="cb13-53"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">volumes</span><span class="kw" style="color: #003B4F;
background-color: null;
font-style: inherit;">:</span></span>
<span id="cb13-54"><span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">  </span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">postgres_data</span><span class="kw" style="color: #003B4F;
background-color: null;
font-style: inherit;">:</span></span>
<span id="cb13-55"><span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">  </span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">redis_data</span><span class="kw" style="color: #003B4F;
background-color: null;
font-style: inherit;">:</span></span>
<span id="cb13-56"><span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">  </span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">milvus_data</span><span class="kw" style="color: #003B4F;
background-color: null;
font-style: inherit;">:</span></span></code></pre></div>
</section>
<section id="옵션-2-kubernetes-클러스터-프로덕션" class="level3" data-number="4.2">
<h3 data-number="4.2" class="anchored" data-anchor-id="옵션-2-kubernetes-클러스터-프로덕션"><span class="header-section-number">4.2</span> 옵션 2: Kubernetes 클러스터 (프로덕션)</h3>
<div class="sourceCode" id="cb14" style="background: #f1f3f5;"><pre class="sourceCode numberSource yaml number-lines code-with-copy"><code class="sourceCode yaml"><span id="cb14-1"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># kubernetes deployment</span></span>
<span id="cb14-2"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">apiVersion</span><span class="kw" style="color: #003B4F;
background-color: null;
font-style: inherit;">:</span><span class="at" style="color: #657422;
background-color: null;
font-style: inherit;"> apps/v1</span></span>
<span id="cb14-3"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">kind</span><span class="kw" style="color: #003B4F;
background-color: null;
font-style: inherit;">:</span><span class="at" style="color: #657422;
background-color: null;
font-style: inherit;"> Deployment</span></span>
<span id="cb14-4"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">metadata</span><span class="kw" style="color: #003B4F;
background-color: null;
font-style: inherit;">:</span></span>
<span id="cb14-5"><span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">  </span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">name</span><span class="kw" style="color: #003B4F;
background-color: null;
font-style: inherit;">:</span><span class="at" style="color: #657422;
background-color: null;
font-style: inherit;"> api-service</span></span>
<span id="cb14-6"><span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">  </span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">namespace</span><span class="kw" style="color: #003B4F;
background-color: null;
font-style: inherit;">:</span><span class="at" style="color: #657422;
background-color: null;
font-style: inherit;"> rag-system</span></span>
<span id="cb14-7"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">spec</span><span class="kw" style="color: #003B4F;
background-color: null;
font-style: inherit;">:</span></span>
<span id="cb14-8"><span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">  </span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">replicas</span><span class="kw" style="color: #003B4F;
background-color: null;
font-style: inherit;">:</span><span class="at" style="color: #657422;
background-color: null;
font-style: inherit;"> </span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">3</span></span>
<span id="cb14-9"><span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">  </span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">selector</span><span class="kw" style="color: #003B4F;
background-color: null;
font-style: inherit;">:</span></span>
<span id="cb14-10"><span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">    </span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">matchLabels</span><span class="kw" style="color: #003B4F;
background-color: null;
font-style: inherit;">:</span></span>
<span id="cb14-11"><span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">      </span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">app</span><span class="kw" style="color: #003B4F;
background-color: null;
font-style: inherit;">:</span><span class="at" style="color: #657422;
background-color: null;
font-style: inherit;"> api-service</span></span>
<span id="cb14-12"><span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">  </span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">template</span><span class="kw" style="color: #003B4F;
background-color: null;
font-style: inherit;">:</span></span>
<span id="cb14-13"><span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">    </span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">metadata</span><span class="kw" style="color: #003B4F;
background-color: null;
font-style: inherit;">:</span></span>
<span id="cb14-14"><span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">      </span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">labels</span><span class="kw" style="color: #003B4F;
background-color: null;
font-style: inherit;">:</span></span>
<span id="cb14-15"><span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">        </span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">app</span><span class="kw" style="color: #003B4F;
background-color: null;
font-style: inherit;">:</span><span class="at" style="color: #657422;
background-color: null;
font-style: inherit;"> api-service</span></span>
<span id="cb14-16"><span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">    </span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">spec</span><span class="kw" style="color: #003B4F;
background-color: null;
font-style: inherit;">:</span></span>
<span id="cb14-17"><span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">      </span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">containers</span><span class="kw" style="color: #003B4F;
background-color: null;
font-style: inherit;">:</span></span>
<span id="cb14-18"><span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">      </span><span class="kw" style="color: #003B4F;
background-color: null;
font-style: inherit;">-</span><span class="at" style="color: #657422;
background-color: null;
font-style: inherit;"> </span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">name</span><span class="kw" style="color: #003B4F;
background-color: null;
font-style: inherit;">:</span><span class="at" style="color: #657422;
background-color: null;
font-style: inherit;"> api</span></span>
<span id="cb14-19"><span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">        </span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">image</span><span class="kw" style="color: #003B4F;
background-color: null;
font-style: inherit;">:</span><span class="at" style="color: #657422;
background-color: null;
font-style: inherit;"> my-registry.azurecr.io/api-service:1.0.0</span></span>
<span id="cb14-20"><span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">        </span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">ports</span><span class="kw" style="color: #003B4F;
background-color: null;
font-style: inherit;">:</span></span>
<span id="cb14-21"><span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">        </span><span class="kw" style="color: #003B4F;
background-color: null;
font-style: inherit;">-</span><span class="at" style="color: #657422;
background-color: null;
font-style: inherit;"> </span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">containerPort</span><span class="kw" style="color: #003B4F;
background-color: null;
font-style: inherit;">:</span><span class="at" style="color: #657422;
background-color: null;
font-style: inherit;"> </span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">8000</span></span>
<span id="cb14-22"><span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">        </span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">resources</span><span class="kw" style="color: #003B4F;
background-color: null;
font-style: inherit;">:</span></span>
<span id="cb14-23"><span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">          </span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">requests</span><span class="kw" style="color: #003B4F;
background-color: null;
font-style: inherit;">:</span></span>
<span id="cb14-24"><span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">            </span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">memory</span><span class="kw" style="color: #003B4F;
background-color: null;
font-style: inherit;">:</span><span class="at" style="color: #657422;
background-color: null;
font-style: inherit;"> </span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"512Mi"</span></span>
<span id="cb14-25"><span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">            </span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">cpu</span><span class="kw" style="color: #003B4F;
background-color: null;
font-style: inherit;">:</span><span class="at" style="color: #657422;
background-color: null;
font-style: inherit;"> </span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"500m"</span></span>
<span id="cb14-26"><span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">          </span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">limits</span><span class="kw" style="color: #003B4F;
background-color: null;
font-style: inherit;">:</span></span>
<span id="cb14-27"><span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">            </span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">memory</span><span class="kw" style="color: #003B4F;
background-color: null;
font-style: inherit;">:</span><span class="at" style="color: #657422;
background-color: null;
font-style: inherit;"> </span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"1Gi"</span></span>
<span id="cb14-28"><span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">            </span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">cpu</span><span class="kw" style="color: #003B4F;
background-color: null;
font-style: inherit;">:</span><span class="at" style="color: #657422;
background-color: null;
font-style: inherit;"> </span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"1000m"</span></span>
<span id="cb14-29"><span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">        </span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">env</span><span class="kw" style="color: #003B4F;
background-color: null;
font-style: inherit;">:</span></span>
<span id="cb14-30"><span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">        </span><span class="kw" style="color: #003B4F;
background-color: null;
font-style: inherit;">-</span><span class="at" style="color: #657422;
background-color: null;
font-style: inherit;"> </span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">name</span><span class="kw" style="color: #003B4F;
background-color: null;
font-style: inherit;">:</span><span class="at" style="color: #657422;
background-color: null;
font-style: inherit;"> DATABASE_URL</span></span>
<span id="cb14-31"><span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">          </span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">valueFrom</span><span class="kw" style="color: #003B4F;
background-color: null;
font-style: inherit;">:</span></span>
<span id="cb14-32"><span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">            </span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">secretKeyRef</span><span class="kw" style="color: #003B4F;
background-color: null;
font-style: inherit;">:</span></span>
<span id="cb14-33"><span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">              </span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">name</span><span class="kw" style="color: #003B4F;
background-color: null;
font-style: inherit;">:</span><span class="at" style="color: #657422;
background-color: null;
font-style: inherit;"> db-credentials</span></span>
<span id="cb14-34"><span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">              </span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">key</span><span class="kw" style="color: #003B4F;
background-color: null;
font-style: inherit;">:</span><span class="at" style="color: #657422;
background-color: null;
font-style: inherit;"> url</span></span>
<span id="cb14-35"><span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">        </span><span class="kw" style="color: #003B4F;
background-color: null;
font-style: inherit;">-</span><span class="at" style="color: #657422;
background-color: null;
font-style: inherit;"> </span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">name</span><span class="kw" style="color: #003B4F;
background-color: null;
font-style: inherit;">:</span><span class="at" style="color: #657422;
background-color: null;
font-style: inherit;"> OPENAI_API_KEY</span></span>
<span id="cb14-36"><span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">          </span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">valueFrom</span><span class="kw" style="color: #003B4F;
background-color: null;
font-style: inherit;">:</span></span>
<span id="cb14-37"><span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">            </span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">secretKeyRef</span><span class="kw" style="color: #003B4F;
background-color: null;
font-style: inherit;">:</span></span>
<span id="cb14-38"><span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">              </span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">name</span><span class="kw" style="color: #003B4F;
background-color: null;
font-style: inherit;">:</span><span class="at" style="color: #657422;
background-color: null;
font-style: inherit;"> openai-key</span></span>
<span id="cb14-39"><span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">              </span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">key</span><span class="kw" style="color: #003B4F;
background-color: null;
font-style: inherit;">:</span><span class="at" style="color: #657422;
background-color: null;
font-style: inherit;"> key</span></span>
<span id="cb14-40"><span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">        </span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">livenessProbe</span><span class="kw" style="color: #003B4F;
background-color: null;
font-style: inherit;">:</span></span>
<span id="cb14-41"><span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">          </span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">httpGet</span><span class="kw" style="color: #003B4F;
background-color: null;
font-style: inherit;">:</span></span>
<span id="cb14-42"><span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">            </span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">path</span><span class="kw" style="color: #003B4F;
background-color: null;
font-style: inherit;">:</span><span class="at" style="color: #657422;
background-color: null;
font-style: inherit;"> /health</span></span>
<span id="cb14-43"><span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">            </span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">port</span><span class="kw" style="color: #003B4F;
background-color: null;
font-style: inherit;">:</span><span class="at" style="color: #657422;
background-color: null;
font-style: inherit;"> </span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">8000</span></span>
<span id="cb14-44"><span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">          </span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">initialDelaySeconds</span><span class="kw" style="color: #003B4F;
background-color: null;
font-style: inherit;">:</span><span class="at" style="color: #657422;
background-color: null;
font-style: inherit;"> </span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">30</span></span>
<span id="cb14-45"><span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">          </span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">periodSeconds</span><span class="kw" style="color: #003B4F;
background-color: null;
font-style: inherit;">:</span><span class="at" style="color: #657422;
background-color: null;
font-style: inherit;"> </span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">10</span></span>
<span id="cb14-46"><span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">        </span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">readinessProbe</span><span class="kw" style="color: #003B4F;
background-color: null;
font-style: inherit;">:</span></span>
<span id="cb14-47"><span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">          </span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">httpGet</span><span class="kw" style="color: #003B4F;
background-color: null;
font-style: inherit;">:</span></span>
<span id="cb14-48"><span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">            </span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">path</span><span class="kw" style="color: #003B4F;
background-color: null;
font-style: inherit;">:</span><span class="at" style="color: #657422;
background-color: null;
font-style: inherit;"> /ready</span></span>
<span id="cb14-49"><span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">            </span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">port</span><span class="kw" style="color: #003B4F;
background-color: null;
font-style: inherit;">:</span><span class="at" style="color: #657422;
background-color: null;
font-style: inherit;"> </span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">8000</span></span>
<span id="cb14-50"><span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">          </span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">initialDelaySeconds</span><span class="kw" style="color: #003B4F;
background-color: null;
font-style: inherit;">:</span><span class="at" style="color: #657422;
background-color: null;
font-style: inherit;"> </span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">5</span></span>
<span id="cb14-51"><span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">          </span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">periodSeconds</span><span class="kw" style="color: #003B4F;
background-color: null;
font-style: inherit;">:</span><span class="at" style="color: #657422;
background-color: null;
font-style: inherit;"> </span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">5</span></span>
<span id="cb14-52"><span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">      </span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">affinity</span><span class="kw" style="color: #003B4F;
background-color: null;
font-style: inherit;">:</span></span>
<span id="cb14-53"><span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">        </span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">podAntiAffinity</span><span class="kw" style="color: #003B4F;
background-color: null;
font-style: inherit;">:</span></span>
<span id="cb14-54"><span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">          </span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">preferredDuringSchedulingIgnoredDuringExecution</span><span class="kw" style="color: #003B4F;
background-color: null;
font-style: inherit;">:</span></span>
<span id="cb14-55"><span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">          </span><span class="kw" style="color: #003B4F;
background-color: null;
font-style: inherit;">-</span><span class="at" style="color: #657422;
background-color: null;
font-style: inherit;"> </span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">weight</span><span class="kw" style="color: #003B4F;
background-color: null;
font-style: inherit;">:</span><span class="at" style="color: #657422;
background-color: null;
font-style: inherit;"> </span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">100</span></span>
<span id="cb14-56"><span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">            </span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">podAffinityTerm</span><span class="kw" style="color: #003B4F;
background-color: null;
font-style: inherit;">:</span></span>
<span id="cb14-57"><span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">              </span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">labelSelector</span><span class="kw" style="color: #003B4F;
background-color: null;
font-style: inherit;">:</span></span>
<span id="cb14-58"><span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">                </span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">matchExpressions</span><span class="kw" style="color: #003B4F;
background-color: null;
font-style: inherit;">:</span></span>
<span id="cb14-59"><span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">                </span><span class="kw" style="color: #003B4F;
background-color: null;
font-style: inherit;">-</span><span class="at" style="color: #657422;
background-color: null;
font-style: inherit;"> </span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">key</span><span class="kw" style="color: #003B4F;
background-color: null;
font-style: inherit;">:</span><span class="at" style="color: #657422;
background-color: null;
font-style: inherit;"> app</span></span>
<span id="cb14-60"><span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">                  </span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">operator</span><span class="kw" style="color: #003B4F;
background-color: null;
font-style: inherit;">:</span><span class="at" style="color: #657422;
background-color: null;
font-style: inherit;"> In</span></span>
<span id="cb14-61"><span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">                  </span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">values</span><span class="kw" style="color: #003B4F;
background-color: null;
font-style: inherit;">:</span></span>
<span id="cb14-62"><span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">                  </span><span class="kw" style="color: #003B4F;
background-color: null;
font-style: inherit;">-</span><span class="at" style="color: #657422;
background-color: null;
font-style: inherit;"> api-service</span></span>
<span id="cb14-63"><span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">              </span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">topologyKey</span><span class="kw" style="color: #003B4F;
background-color: null;
font-style: inherit;">:</span><span class="at" style="color: #657422;
background-color: null;
font-style: inherit;"> kubernetes.io/hostname</span></span>
<span id="cb14-64"></span>
<span id="cb14-65"><span class="pp" style="color: #AD0000;
background-color: null;
font-style: inherit;">---</span></span>
<span id="cb14-66"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">apiVersion</span><span class="kw" style="color: #003B4F;
background-color: null;
font-style: inherit;">:</span><span class="at" style="color: #657422;
background-color: null;
font-style: inherit;"> v1</span></span>
<span id="cb14-67"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">kind</span><span class="kw" style="color: #003B4F;
background-color: null;
font-style: inherit;">:</span><span class="at" style="color: #657422;
background-color: null;
font-style: inherit;"> Service</span></span>
<span id="cb14-68"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">metadata</span><span class="kw" style="color: #003B4F;
background-color: null;
font-style: inherit;">:</span></span>
<span id="cb14-69"><span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">  </span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">name</span><span class="kw" style="color: #003B4F;
background-color: null;
font-style: inherit;">:</span><span class="at" style="color: #657422;
background-color: null;
font-style: inherit;"> api-service</span></span>
<span id="cb14-70"><span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">  </span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">namespace</span><span class="kw" style="color: #003B4F;
background-color: null;
font-style: inherit;">:</span><span class="at" style="color: #657422;
background-color: null;
font-style: inherit;"> rag-system</span></span>
<span id="cb14-71"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">spec</span><span class="kw" style="color: #003B4F;
background-color: null;
font-style: inherit;">:</span></span>
<span id="cb14-72"><span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">  </span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">type</span><span class="kw" style="color: #003B4F;
background-color: null;
font-style: inherit;">:</span><span class="at" style="color: #657422;
background-color: null;
font-style: inherit;"> LoadBalancer</span></span>
<span id="cb14-73"><span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">  </span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">selector</span><span class="kw" style="color: #003B4F;
background-color: null;
font-style: inherit;">:</span></span>
<span id="cb14-74"><span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">    </span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">app</span><span class="kw" style="color: #003B4F;
background-color: null;
font-style: inherit;">:</span><span class="at" style="color: #657422;
background-color: null;
font-style: inherit;"> api-service</span></span>
<span id="cb14-75"><span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">  </span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">ports</span><span class="kw" style="color: #003B4F;
background-color: null;
font-style: inherit;">:</span></span>
<span id="cb14-76"><span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">  </span><span class="kw" style="color: #003B4F;
background-color: null;
font-style: inherit;">-</span><span class="at" style="color: #657422;
background-color: null;
font-style: inherit;"> </span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">protocol</span><span class="kw" style="color: #003B4F;
background-color: null;
font-style: inherit;">:</span><span class="at" style="color: #657422;
background-color: null;
font-style: inherit;"> TCP</span></span>
<span id="cb14-77"><span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">    </span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">port</span><span class="kw" style="color: #003B4F;
background-color: null;
font-style: inherit;">:</span><span class="at" style="color: #657422;
background-color: null;
font-style: inherit;"> </span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">80</span></span>
<span id="cb14-78"><span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">    </span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">targetPort</span><span class="kw" style="color: #003B4F;
background-color: null;
font-style: inherit;">:</span><span class="at" style="color: #657422;
background-color: null;
font-style: inherit;"> </span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">8000</span></span></code></pre></div>
</section>
<section id="옵션-3-클라우드-관리형-서비스" class="level3" data-number="4.3">
<h3 data-number="4.3" class="anchored" data-anchor-id="옵션-3-클라우드-관리형-서비스"><span class="header-section-number">4.3</span> 옵션 3: 클라우드 관리형 서비스</h3>
<p><strong>AWS 기반:</strong></p>
<pre><code>- Frontend: CloudFront + S3 + Lambda@Edge
- API: ECS/Fargate with Application Load Balancer
- Vector DB: Pinecone (관리형) 또는 SageMaker Vector Store
- Text DB: RDS PostgreSQL
- Cache: ElastiCache Redis
- Monitoring: CloudWatch + X-Ray
- Storage: S3</code></pre>
<p><strong>Azure 기반:</strong></p>
<pre><code>- Frontend: Azure Static Web Apps
- API: App Service 또는 Container Instances
- Vector DB: Azure Cognitive Search
- Text DB: Azure Database for PostgreSQL
- Cache: Azure Cache for Redis
- Monitoring: Application Insights
- Storage: Blob Storage</code></pre>
<p><strong>GCP 기반:</strong></p>
<pre><code>- Frontend: Cloud Storage + CDN
- API: Cloud Run 또는 App Engine
- Vector DB: Vertex AI Vector Search
- Text DB: Cloud SQL (PostgreSQL)
- Cache: Memorystore (Redis)
- Monitoring: Cloud Logging + Cloud Trace
- Storage: Cloud Storage</code></pre>
</section>
</section>
<section id="physical-architecture-명세서" class="level2" data-number="5">
<h2 data-number="5" class="anchored" data-anchor-id="physical-architecture-명세서"><span class="header-section-number">5</span> Physical Architecture 명세서</h2>
<section id="서버-요구사항" class="level3" data-number="5.1">
<h3 data-number="5.1" class="anchored" data-anchor-id="서버-요구사항"><span class="header-section-number">5.1</span> 서버 요구사항</h3>
<pre><code>API Service Pod:
  CPU: 1000m (1 vCPU)
  Memory: 1Gi
  Disk: 20Gi (ephemeral)
  Network: 1 Gbps
  
Worker Pod:
  CPU: 2000m (2 vCPU)
  Memory: 2Gi
  Disk: 50Gi (ephemeral)
  Network: 1 Gbps

PostgreSQL:
  CPU: 2000m (2 vCPU)
  Memory: 4Gi
  Disk: 500Gi (persistent, SSD)
  Network: 1 Gbps
  High Availability: 2 replicas + 1 standby

Milvus Vector DB:
  CPU: 4000m (4 vCPU)
  Memory: 8Gi
  Disk: 1Ti (persistent, SSD)
  Network: 10 Gbps (권장)
  Replication: 3

Redis Cache:
  CPU: 1000m (1 vCPU)
  Memory: 8Gi
  Disk: 100Gi (persistent)
  Network: 1 Gbps
  Cluster: 3 nodes</code></pre>
</section>
<section id="네트워크-구성" class="level3" data-number="5.2">
<h3 data-number="5.2" class="anchored" data-anchor-id="네트워크-구성"><span class="header-section-number">5.2</span> 네트워크 구성</h3>
<pre><code>방화벽 규칙:

Ingress:
  - 443 (HTTPS): 외부 → Load Balancer (모든 트래픽)
  - 80 (HTTP): 외부 → Load Balancer (HTTPS 리다이렉트)

Internal (VPC/VNet 내부):
  - 8000: API Service pods
  - 5432: PostgreSQL
  - 19530: Milvus gRPC
  - 9091: Milvus HTTP
  - 6379: Redis
  - 9090: Prometheus (모니터링)

Egress:
  - 443: OpenAI API (외부 인터넷)
  - 25, 587: Email 서비스 (알림용)</code></pre>
</section>
<section id="보안-구성" class="level3" data-number="5.3">
<h3 data-number="5.3" class="anchored" data-anchor-id="보안-구성"><span class="header-section-number">5.3</span> 보안 구성</h3>
<pre><code>SSL/TLS:
  - 인증서: Let's Encrypt (자동 갱신)
  - TLS 버전: 1.2 이상
  - 암호화 알고리즘: TLS_ECDHE_RSA_WITH_AES_256_GCM_SHA384
  
데이터 암호화:
  - 전송 중: TLS 1.2+
  - 저장: Database encryption (모든 DB)
  - API Keys: AWS Secrets Manager / Azure Key Vault

접근 제어:
  - 인증: OAuth 2.0 / JWT
  - 인가: RBAC (Role-Based Access Control)
  - 감사: 모든 API 호출 로깅
  
DDoS 방어:
  - AWS Shield / Azure DDoS Protection
  - Rate limiting: 100 req/sec per IP</code></pre>
</section>
<section id="모니터링-및-로깅" class="level3" data-number="5.4">
<h3 data-number="5.4" class="anchored" data-anchor-id="모니터링-및-로깅"><span class="header-section-number">5.4</span> 모니터링 및 로깅</h3>
<pre><code>메트릭 수집:
  - 도구: Prometheus + Grafana
  - 수집 대상:
    - API 응답시간 (p50, p95, p99)
    - 데이터베이스 쿼리 시간
    - 벡터 검색 지연시간
    - 캐시 히트율
    - CPU, 메모리, 디스크 사용률
    - 네트워크 대역폭

로그 수집:
  - 도구: ELK Stack (Elasticsearch + Logstash + Kibana) 또는 Azure Monitor
  - 수집 대상:
    - 애플리케이션 로그 (DEBUG, INFO, WARNING, ERROR)
    - 접근 로그 (HTTP 요청)
    - 데이터베이스 쿼리 로그
    - 에러 추적 (Sentry)

알림:
  - 임계값 초과 시 Slack/Email 알림
  - 에러율 &gt; 1% → 즉시 알림
  - 응답시간 p95 &gt; 2초 → 경고
  - 디스크 사용량 &gt; 80% → 경고</code></pre>
</section>
<section id="재해-복구-dr-계획" class="level3" data-number="5.5">
<h3 data-number="5.5" class="anchored" data-anchor-id="재해-복구-dr-계획"><span class="header-section-number">5.5</span> 재해 복구 (DR) 계획</h3>
<pre><code>Backup 전략:
  - 데이터베이스: 1시간마다 스냅샷
  - 벡터 DB: 4시간마다 스냅샷
  - 백업 저장소: 다른 리전 (지역 중복)
  - 보관 기간: 30일

복구 목표 (RTO/RPO):
  - RTO (복구시간): 1시간
  - RPO (데이터손실범위): 1시간

페일오버:
  - Active-Standby 구성 (자동 페일오버)
  - Health check: 30초마다
  - 페일오버 시간: &lt; 2분

테스트:
  - 월 1회 DR 드릴 실시
  - 복구 절차 문서화 및 검증</code></pre>
</section>
</section>
<section id="physical-architecture-체크리스트" class="level2" data-number="6">
<h2 data-number="6" class="anchored" data-anchor-id="physical-architecture-체크리스트"><span class="header-section-number">6</span> Physical Architecture 체크리스트</h2>
<section id="기술-스택" class="level3" data-number="6.1">
<h3 data-number="6.1" class="anchored" data-anchor-id="기술-스택"><span class="header-section-number">6.1</span> 기술 스택</h3>
<ul class="task-list">
<li><label><input type="checkbox">모든 Logical 모듈에 구체적인 기술이 할당되었는가?</label></li>
<li><label><input type="checkbox">기술 선택이 성능 요구사항을 만족하는가?</label></li>
<li><label><input type="checkbox">기술 선택이 확장성 요구사항을 만족하는가?</label></li>
<li><label><input type="checkbox">팀이 선택한 기술을 지원할 역량이 있는가?</label></li>
<li><label><input type="checkbox">기술 간 호환성이 검증되었는가?</label></li>
</ul>
</section>
<section id="인프라-설계" class="level3" data-number="6.2">
<h3 data-number="6.2" class="anchored" data-anchor-id="인프라-설계"><span class="header-section-number">6.2</span> 인프라 설계</h3>
<ul class="task-list">
<li><label><input type="checkbox">배포 환경이 명확하게 정의되었는가? (K8s, 클라우드, 온프레미스)</label></li>
<li><label><input type="checkbox">리소스 요구사항이 정량화되었는가? (CPU, 메모리, 디스크)</label></li>
<li><label><input type="checkbox">스케일링 전략이 정의되었는가? (수평/수직)</label></li>
<li><label><input type="checkbox">네트워크 토폴로지가 설계되었는가?</label></li>
<li><label><input type="checkbox">방화벽 규칙이 정의되었는가?</label></li>
</ul>
</section>
<section id="배포-및-운영" class="level3" data-number="6.3">
<h3 data-number="6.3" class="anchored" data-anchor-id="배포-및-운영"><span class="header-section-number">6.3</span> 배포 및 운영</h3>
<ul class="task-list">
<li><label><input type="checkbox">CI/CD 파이프라인이 정의되었는가?</label></li>
<li><label><input type="checkbox">컨테이너/이미지 전략이 정의되었는가?</label></li>
<li><label><input type="checkbox">버전 관리 전략이 있는가?</label></li>
<li><label><input type="checkbox">배포 절차가 문서화되었는가?</label></li>
<li><label><input type="checkbox">롤백 절차가 준비되었는가?</label></li>
</ul>
</section>
<section id="모니터링-및-로깅-1" class="level3" data-number="6.4">
<h3 data-number="6.4" class="anchored" data-anchor-id="모니터링-및-로깅-1"><span class="header-section-number">6.4</span> 모니터링 및 로깅</h3>
<ul class="task-list">
<li><label><input type="checkbox">모니터링 대상 메트릭이 정의되었는가?</label></li>
<li><label><input type="checkbox">로깅 전략이 정의되었는가? (레벨, 보관, 검색)</label></li>
<li><label><input type="checkbox">알림 규칙이 설정되었는가?</label></li>
<li><label><input type="checkbox">대시보드가 준비되었는가?</label></li>
<li><label><input type="checkbox">로그 보관 기간이 정해졌는가?</label></li>
</ul>
</section>
<section id="보안" class="level3" data-number="6.5">
<h3 data-number="6.5" class="anchored" data-anchor-id="보안"><span class="header-section-number">6.5</span> 보안</h3>
<ul class="task-list">
<li><label><input type="checkbox">SSL/TLS 인증서 전략이 있는가?</label></li>
<li><label><input type="checkbox">데이터 암호화 전략이 정의되었는가?</label></li>
<li><label><input type="checkbox">접근 제어 메커니즘이 설계되었는가?</label></li>
<li><label><input type="checkbox">감사 로깅이 활성화되었는가?</label></li>
<li><label><input type="checkbox">보안 검토가 수행되었는가?</label></li>
</ul>
</section>
<section id="재해-복구" class="level3" data-number="6.6">
<h3 data-number="6.6" class="anchored" data-anchor-id="재해-복구"><span class="header-section-number">6.6</span> 재해 복구</h3>
<ul class="task-list">
<li><label><input type="checkbox">Backup 전략이 수립되었는가?</label></li>
<li><label><input type="checkbox">RTO/RPO가 정의되었는가?</label></li>
<li><label><input type="checkbox">페일오버 절차가 준비되었는가?</label></li>
<li><label><input type="checkbox">DR 테스트 계획이 있는가?</label></li>
<li><label><input type="checkbox">복구 절차가 문서화되었는가?</label></li>
</ul>
</section>
<section id="비용-최적화" class="level3" data-number="6.7">
<h3 data-number="6.7" class="anchored" data-anchor-id="비용-최적화"><span class="header-section-number">6.7</span> 비용 최적화</h3>
<ul class="task-list">
<li><label><input type="checkbox">리소스 요청/제한이 최적화되었는가?</label></li>
<li><label><input type="checkbox">자동 스케일링이 설정되었는가?</label></li>
<li><label><input type="checkbox">예상 월 비용이 계산되었는가?</label></li>
<li><label><input type="checkbox">비용 절감 기회가 검토되었는가?</label></li>
</ul>
</section>
</section>
<section id="실제-예시-rag-시스템-physical-architecture" class="level2" data-number="7">
<h2 data-number="7" class="anchored" data-anchor-id="실제-예시-rag-시스템-physical-architecture"><span class="header-section-number">7</span> 실제 예시: RAG 시스템 Physical Architecture</h2>
<section id="프로토타입-로컬-개발" class="level3" data-number="7.1">
<h3 data-number="7.1" class="anchored" data-anchor-id="프로토타입-로컬-개발"><span class="header-section-number">7.1</span> 프로토타입 (로컬 개발)</h3>
<pre><code>기술 스택:
  - Frontend: React 18 + TypeScript
  - Backend: FastAPI (Python 3.11)
  - Vector DB: Chroma (로컬, 인메모리)
  - Text DB: SQLite (프로토타입)
  - Cache: Python 딕셔너리 (인메모리)
  
배포: docker-compose (로컬)
  - 3개 컨테이너 (Frontend, API, Vector DB)
  - 통신: localhost:8000
  
리소스:
  - CPU: 4 cores
  - RAM: 8GB
  - Storage: 50GB
  
성능 목표:
  - 응답시간: &lt; 500ms
  - 동시 사용자: 1-5명</code></pre>
</section>
<section id="mvp-초기-프로덕션" class="level3" data-number="7.2">
<h3 data-number="7.2" class="anchored" data-anchor-id="mvp-초기-프로덕션"><span class="header-section-number">7.2</span> MVP (초기 프로덕션)</h3>
<pre><code>기술 스택:
  - Frontend: React 18 + Vercel 배포
  - Backend: FastAPI (Python 3.11) on AWS ECS
  - Vector DB: Chroma (Persistent)
  - Text DB: RDS PostgreSQL (db.t3.micro)
  - Cache: ElastiCache Redis (cache.t3.micro)
  
배포: AWS
  - ECS Fargate (1 vCPU, 2GB RAM, 2 tasks)
  - Application Load Balancer
  - RDS Single-AZ
  
리소스 (월 비용 예상):
  - Frontend 호스팅: $0 (Vercel Free)
  - ECS Fargate: $50 (compute)
  - RDS PostgreSQL: $20 (db.t3.micro)
  - ElastiCache Redis: $15 (cache.t3.micro)
  - Data Transfer: $10
  - 총 약 $95/월
  
성능 목표:
  - 응답시간: &lt; 1초 (p95)
  - 동시 사용자: 10-50명
  - 처리량: 100 req/sec</code></pre>
</section>
<section id="엔터프라이즈-프로덕션" class="level3" data-number="7.3">
<h3 data-number="7.3" class="anchored" data-anchor-id="엔터프라이즈-프로덕션"><span class="header-section-number">7.3</span> 엔터프라이즈 프로덕션</h3>
<pre><code>기술 스택:
  - Frontend: React 18 + Azure Static Web Apps
  - Backend: Spring Boot on Azure Container Instances
  - Vector DB: Milvus (3-node cluster)
  - Text DB: Azure Database for PostgreSQL (Flexible Server)
  - Cache: Azure Cache for Redis (Standard C1)
  - Orchestration: Azure Container Registry + GitHub Actions
  
배포: Azure Kubernetes Service (AKS)
  - 3 node cluster (VM 크기: Standard_D4s_v3)
  - API replicas: 3 (1 vCPU, 2GB each)
  - Worker replicas: 2 (2 vCPU, 4GB each)
  - Ingress: Application Gateway
  
리소스 (월 비용 예상):
  - AKS cluster: $200 (노드)
  - Managed disks: $100
  - PostgreSQL: $150 (Flexible Server)
  - Redis: $100 (Standard)
  - Milvus: $300 (managed)
  - Monitoring/Logging: $50
  - 총 약 $900/월
  
성능 목표:
  - 응답시간: &lt; 200ms (p95)
  - 동시 사용자: 1000+명
  - 처리량: 1000 req/sec
  - 가용성: 99.9%
  - RTO: 1 hour
  - RPO: 1 hour</code></pre>
</section>
</section>
<section id="physical-배포-체크리스트" class="level2" data-number="8">
<h2 data-number="8" class="anchored" data-anchor-id="physical-배포-체크리스트"><span class="header-section-number">8</span> Physical 배포 체크리스트</h2>
<p>배포 전 최종 확인:</p>
<section id="프리플라이트-체크" class="level3" data-number="8.1">
<h3 data-number="8.1" class="anchored" data-anchor-id="프리플라이트-체크"><span class="header-section-number">8.1</span> 프리플라이트 체크</h3>
<ul class="task-list">
<li><label><input type="checkbox">모든 환경 변수가 설정되었는가?</label></li>
<li><label><input type="checkbox">데이터베이스 마이그레이션이 적용되었는가?</label></li>
<li><label><input type="checkbox">SSL 인증서가 유효한가?</label></li>
<li><label><input type="checkbox">방화벽 규칙이 적용되었는가?</label></li>
<li><label><input type="checkbox">백업이 활성화되었는가?</label></li>
</ul>
</section>
<section id="배포-검증" class="level3" data-number="8.2">
<h3 data-number="8.2" class="anchored" data-anchor-id="배포-검증"><span class="header-section-number">8.2</span> 배포 검증</h3>
<ul class="task-list">
<li><label><input type="checkbox">Health check 엔드포인트가 정상 응답하는가?</label></li>
<li><label><input type="checkbox">데이터베이스 연결이 정상인가?</label></li>
<li><label><input type="checkbox">외부 API (OpenAI 등)가 접근 가능한가?</label></li>
<li><label><input type="checkbox">모니터링 에이전트가 정상 작동하는가?</label></li>
</ul>
</section>
<section id="운영-준비" class="level3" data-number="8.3">
<h3 data-number="8.3" class="anchored" data-anchor-id="운영-준비"><span class="header-section-number">8.3</span> 운영 준비</h3>
<ul class="task-list">
<li><label><input type="checkbox">모니터링 대시보드가 준비되었는가?</label></li>
<li><label><input type="checkbox">알림 채널이 정상 작동하는가?</label></li>
<li><label><input type="checkbox">문서가 최신화되었는가?</label></li>
<li><label><input type="checkbox">온콜(On-call) 로테이션이 설정되었는가?</label></li>
<li><label><input type="checkbox">Runbook이 준비되었는가?</label></li>
</ul>
</section>
</section>
<section id="정리" class="level2" data-number="9">
<h2 data-number="9" class="anchored" data-anchor-id="정리"><span class="header-section-number">9</span> 정리</h2>
<p>Physical Architecture는:</p>
<ol type="1">
<li><strong>기술 구체화</strong>: Logical을 실제 구현 가능한 형태로 변환</li>
<li><strong>배포 가능</strong>: 개발팀이 직접 배포하고 운영 가능</li>
<li><strong>비용 최적화</strong>: 리소스와 비용을 명확하게 정량화</li>
<li><strong>운영성</strong>: 모니터링, 로깅, 확장 전략 포함</li>
<li><strong>문서화</strong>: 개발팀이 따를 수 있는 명확한 가이드</li>
</ol>
<p>Conceptual → Logical → Physical 세 계층을 거쳐 설계하면, 최상위 비즈니스 요구사항부터 최하위 구현 세부사항까지 일관되고 체계적인 아키텍처를 구축할 수 있다.</p>


</section>

 ]]></description>
  <category>Engineering</category>
  <category>Architecture</category>
  <guid>kk3225.netlify.app/docs/blog/posts/Engineering/System/Archi_Design/physical_design.html</guid>
  <pubDate>Sun, 16 Nov 2025 15:00:00 GMT</pubDate>
</item>
<item>
  <title>Logical Architecture 설계하는 방법</title>
  <dc:creator>Kwangmin Kim</dc:creator>
  <link>kk3225.netlify.app/docs/blog/posts/Engineering/System/Archi_Design/logical_design.html</link>
  <description><![CDATA[ 





<section id="logical-architecture의-정의" class="level2" data-number="1">
<h2 data-number="1" class="anchored" data-anchor-id="logical-architecture의-정의"><span class="header-section-number">1</span> Logical Architecture의 정의</h2>
<p>Logical Architecture는 Conceptual Architecture를 <strong>구체화한 설계 계층</strong>으로, 여전히 <strong>기술 스택 독립적</strong>이지만 구현 수준의 세부사항을 포함한다.</p>
<p><strong>핵심 특징:</strong></p>
<ul>
<li><strong>기술 중립적</strong>: 특정 도구나 프로그래밍 언어를 명시하지 않음</li>
<li><strong>구현 지향적</strong>: 실제 개발에 필요한 모듈, 인터페이스, 데이터 구조 정의</li>
<li><strong>상세한 데이터 흐름</strong>: 각 단계에서의 입출력 데이터 명시</li>
<li><strong>모듈 간 계약</strong>: API 계약, 데이터 형식, 상태 관리 정의</li>
<li><strong>확장성과 유지보수성</strong>: 향후 기술 변경 시 영향을 최소화</li>
</ul>
<section id="conceptual-vs-logical-vs-physical-비교" class="level3" data-number="1.1">
<h3 data-number="1.1" class="anchored" data-anchor-id="conceptual-vs-logical-vs-physical-비교"><span class="header-section-number">1.1</span> Conceptual vs Logical vs Physical 비교</h3>
<table class="table">
<colgroup>
<col style="width: 16%">
<col style="width: 30%">
<col style="width: 25%">
<col style="width: 27%">
</colgroup>
<thead>
<tr class="header">
<th>측면</th>
<th>Conceptual</th>
<th>Logical</th>
<th>Physical</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td><strong>추상화 수준</strong></td>
<td>매우 높음</td>
<td>중간</td>
<td>낮음</td>
</tr>
<tr class="even">
<td><strong>기술 명시</strong></td>
<td>없음</td>
<td>없음 (독립적)</td>
<td>구체적</td>
</tr>
<tr class="odd">
<td><strong>대상 청중</strong></td>
<td>모든 이해관계자</td>
<td>개발팀, 아키텍트</td>
<td>개발팀</td>
</tr>
<tr class="even">
<td><strong>초점</strong></td>
<td>“무엇을”</td>
<td>“어떻게” (기술 중립)</td>
<td>“무엇으로”</td>
</tr>
<tr class="odd">
<td><strong>예시: 데이터 저장</strong></td>
<td>“저장소”</td>
<td>“Relational DB + Cache Layer”</td>
<td>“PostgreSQL + Redis”</td>
</tr>
</tbody>
</table>
</section>
</section>
<section id="logical-architecture-설계-단계" class="level2" data-number="2">
<h2 data-number="2" class="anchored" data-anchor-id="logical-architecture-설계-단계"><span class="header-section-number">2</span> Logical Architecture 설계 단계</h2>
<section id="conceptual-architecture-재검토" class="level3" data-number="2.1">
<h3 data-number="2.1" class="anchored" data-anchor-id="conceptual-architecture-재검토"><span class="header-section-number">2.1</span> Conceptual Architecture 재검토</h3>
<p>Logical 설계를 시작하기 전에:</p>
<ul>
<li><strong>각 컴포넌트의 책임</strong> 명확화</li>
<li><strong>데이터 입출력</strong> 재확인</li>
<li><strong>성능 요구사항</strong> 파악 (처리량, 지연시간)</li>
<li><strong>확장성 요구사항</strong> 정의 (수평/수직 확장 가능성)</li>
</ul>
</section>
<section id="모듈-분해-module-decomposition" class="level3" data-number="2.2">
<h3 data-number="2.2" class="anchored" data-anchor-id="모듈-분해-module-decomposition"><span class="header-section-number">2.2</span> 모듈 분해 (Module Decomposition)</h3>
<p>각 Conceptual 컴포넌트를 <strong>논리적 모듈</strong>로 세분화한다.</p>
<p><strong>원칙:</strong></p>
<ul>
<li><strong>단일 책임</strong>: 각 모듈은 하나의 명확한 역할</li>
<li><strong>높은 응집도</strong>: 관련 기능을 한 모듈에 그룹화</li>
<li><strong>낮은 결합도</strong>: 모듈 간 의존성 최소화</li>
</ul>
<p><strong>예시: 데이터 Ingestion 컴포넌트 분해</strong></p>
<pre><code>Conceptual: "Data Ingestion"
     ↓
Logical Modules:
  ├── Source Connector (다양한 소스 연결)
  ├── Data Validator (데이터 검증)
  ├── Data Transformer (형식 변환)
  └── Error Handler (오류 처리 및 재시도)</code></pre>
</section>
<section id="데이터-구조-정의" class="level3" data-number="2.3">
<h3 data-number="2.3" class="anchored" data-anchor-id="데이터-구조-정의"><span class="header-section-number">2.3</span> 데이터 구조 정의</h3>
<p>각 모듈 간에 주고받는 <strong>데이터 형식</strong>을 정의한다.</p>
<p><strong>정의 내용:</strong></p>
<ul>
<li><strong>데이터 엔티티</strong>: 주요 데이터 객체의 구조</li>
<li><strong>메타데이터</strong>: 데이터 출처, 생성 시간, 버전 등</li>
<li><strong>상태 정보</strong>: 처리 상태, 에러 정보</li>
</ul>
<p><strong>예시 데이터 구조:</strong></p>
<pre><code>Raw Data Input:
{
  source_id: string,
  content: bytes,
  mime_type: string,
  timestamp: datetime,
  metadata: object
}

Validated Data:
{
  validated_content: string,
  validation_status: "SUCCESS" | "WARNING" | "FAILED",
  issues: list[ValidationIssue],
  processed_timestamp: datetime
}

Transformed Data:
{
  standardized_format: object,
  schema_version: string,
  transformation_rules: list[string],
  data_quality_score: float
}</code></pre>
</section>
<section id="모듈-간-인터페이스-정의" class="level3" data-number="2.4">
<h3 data-number="2.4" class="anchored" data-anchor-id="모듈-간-인터페이스-정의"><span class="header-section-number">2.4</span> 모듈 간 인터페이스 정의</h3>
<p><strong>API 계약</strong> 정의: 각 모듈이 받고 내보내는 데이터와 동작</p>
<pre><code>Module: SourceConnector
Input: ConnectionConfig
Output: RawDataStream
Operations:
  - connect(config) -&gt; Connection
  - fetch(query) -&gt; RawData[]
  - disconnect() -&gt; void
  - on_error(handler) -&gt; void

Module: DataValidator
Input: RawData
Output: ValidationResult
Operations:
  - validate(raw_data) -&gt; ValidationResult
  - get_schema() -&gt; DataSchema
  - register_validator(validator_func) -&gt; void</code></pre>
</section>
<section id="상태-관리-및-흐름-제어" class="level3" data-number="2.5">
<h3 data-number="2.5" class="anchored" data-anchor-id="상태-관리-및-흐름-제어"><span class="header-section-number">2.5</span> 상태 관리 및 흐름 제어</h3>
<p>각 단계에서의 <strong>상태 전이</strong>를 정의한다.</p>
<pre><code>Processing Pipeline States:

INITIATED → INGESTING → VALIDATING → TRANSFORMING → STORING → COMPLETED
              ↓            ↓            ↓             ↓
            FAILED (any stage)
              ↓
            ERROR_HANDLING
              ↓
            RETRY or ABANDONED</code></pre>
</section>
</section>
<section id="logical-architecture-표현-방법" class="level2" data-number="3">
<h2 data-number="3" class="anchored" data-anchor-id="logical-architecture-표현-방법"><span class="header-section-number">3</span> Logical Architecture 표현 방법</h2>
<section id="계층-아키텍처-다이어그램" class="level3" data-number="3.1">
<h3 data-number="3.1" class="anchored" data-anchor-id="계층-아키텍처-다이어그램"><span class="header-section-number">3.1</span> 계층 아키텍처 다이어그램</h3>
<pre><code>┌─────────────────────────────────────────────────────────────┐
│                      Presentation Layer                     │
│  ┌──────────────┐  ┌──────────────┐  ┌──────────────┐      │
│  │Chat Interface│  │    API       │  │  Dashboard   │      │
│  └──────┬───────┘  └──────┬───────┘  └──────┬───────┘      │
└─────────┼─────────────────┼─────────────────┼──────────────┘
          │                 │                 │
┌─────────┴─────────────────┴─────────────────┴──────────────┐
│                    Application Layer                       │
│  ┌──────────────────────────────────────────────────────┐  │
│  │         Request Handler / Orchestration Layer        │  │
│  └────────┬────────────────────────────────────────┬────┘  │
└───────────┼────────────────────────────────────────┼────────┘
            │                                        │
┌───────────┴────────────────────────────────────────┴────────┐
│                   Business Logic Layer                      │
│  ┌──────────────┐  ┌──────────────┐  ┌──────────────┐     │
│  │Query Engine  │  │Retrieval Mgr │  │Response Gen  │     │
│  └──────┬───────┘  └──────┬───────┘  └──────┬───────┘     │
└─────────┼─────────────────┼─────────────────┼──────────────┘
          │                 │                 │
┌─────────┴─────────────────┴─────────────────┴──────────────┐
│                   Data Layer                               │
│  ┌──────────────┐  ┌──────────────┐  ┌──────────────┐     │
│  │Vector Store  │  │Data Cache    │  │Metadata DB   │     │
│  │Repository    │  │Layer         │  │Repository    │     │
│  └──────────────┘  └──────────────┘  └──────────────┘     │
└─────────────────────────────────────────────────────────────┘</code></pre>
</section>
<section id="모듈-상호작용-다이어그램" class="level3" data-number="3.2">
<h3 data-number="3.2" class="anchored" data-anchor-id="모듈-상호작용-다이어그램"><span class="header-section-number">3.2</span> 모듈 상호작용 다이어그램</h3>
<pre><code>┌─────────────────────────────────────────────────────────────┐
│              Logical Module Interaction                      │
└─────────────────────────────────────────────────────────────┘

User Query
    │
    ▼
┌──────────────────────┐
│ Request Dispatcher   │ ◄── Routes request to appropriate handler
└──────────┬───────────┘
           │
    ┌──────┴──────┐
    │             │
    ▼             ▼
┌─────────────┐ ┌─────────────────────┐
│Query Parser │ │Intent Classifier    │
└──────┬──────┘ └──────────┬──────────┘
       │                   │
       └───────┬───────────┘
               ▼
        ┌──────────────┐
        │Query Encoder │ ◄── Convert to vector representation
        └──────┬───────┘
               │
               ▼
        ┌──────────────────────┐
        │Vector Search Engine  │ ◄── Query against vector store
        └──────┬───────────────┘
               │
        ┌──────┴──────────────────┐
        │                         │
        ▼                         ▼
    ┌─────────────┐        ┌──────────────┐
    │Vector Store │        │Metadata Repo │ ◄── Fetch context
    └─────────────┘        └──────────────┘
        │                         │
        └──────┬──────────────────┘
               ▼
        ┌──────────────────────┐
        │Context Aggregator    │ ◄── Combine retrieved info
        └──────┬───────────────┘
               │
               ▼
        ┌──────────────────────┐
        │Reasoning Engine      │ ◄── Apply business logic
        └──────┬───────────────┘
               │
               ▼
        ┌──────────────────────┐
        │Response Composer     │ ◄── Format response
        └──────┬───────────────┘
               │
               ▼
        ┌──────────────────────┐
        │Output Formatter      │ ◄── Prepare for delivery
        └──────┬───────────────┘
               │
               ▼
            Response</code></pre>
</section>
<section id="데이터-흐름-및-상태-다이어그램" class="level3" data-number="3.3">
<h3 data-number="3.3" class="anchored" data-anchor-id="데이터-흐름-및-상태-다이어그램"><span class="header-section-number">3.3</span> 데이터 흐름 및 상태 다이어그램</h3>
<pre><code>Data Processing Pipeline - Logical View

Source Data
    │
    ▼
┌──────────────────────────────────┐
│ Source Connector                 │
│ (Read from various sources)      │
│ Status: CONNECTING → READING     │
└──────────┬───────────────────────┘
           │ RawDataStream
           ▼
┌──────────────────────────────────┐
│ Data Validator                   │
│ (Schema check, completeness)     │
│ Status: VALIDATING               │
└──────────┬───────────────────────┘
           │
      ┌────┴────┐
      │          │
      ▼ PASS     ▼ FAIL
   ┌────┐    ┌──────────────┐
   │    │    │Error Handler │
   │    │    └──────────────┘
   │    │
   ▼    │ (retry or skip)
┌──────────────────────────────────┐
│ Data Transformer                 │
│ (Normalize, enrich, clean)       │
│ Status: TRANSFORMING             │
└──────────┬───────────────────────┘
           │ TransformedData
           ▼
┌──────────────────────────────────┐
│ Embedding Generator              │
│ (Create vector representations)  │
│ Status: EMBEDDING                │
└──────────┬───────────────────────┘
           │ (Data + Embeddings)
           ▼
┌──────────────────────────────────┐
│ Storage Coordinator              │
│ (Write to appropriate stores)    │
│ Status: STORING                  │
└──────────┬───────────────────────┘
           │
        ┌──┴──┬────────┐
        ▼     ▼        ▼
   ┌─────┐ ┌────┐ ┌────────┐
   │Vector│ │Text│ │Metadata│
   │Store │ │ DB │ │  DB    │
   └─────┘ └────┘ └────────┘

Status: COMPLETED</code></pre>
</section>
<section id="시퀀스-다이어그램-특정-시나리오" class="level3" data-number="3.4">
<h3 data-number="3.4" class="anchored" data-anchor-id="시퀀스-다이어그램-특정-시나리오"><span class="header-section-number">3.4</span> 시퀀스 다이어그램 (특정 시나리오)</h3>
<pre><code>User        Request      Query        Vector      Storage
            Dispatcher   Processor    Search      Layer
 │              │            │          │           │
 │─query──────▶│             │          │           │
 │              │─parse─────▶│          │           │
 │              │            │─encode──▶│           │
 │              │            │          │─search──▶│
 │              │            │          │◀─results─│
 │              │◀───────────┼──────────┤          │
 │◀────response─│            │          │          │
 │              │            │          │          │</code></pre>
</section>
</section>
<section id="실제-예시-rag-시스템의-logical-architecture" class="level2" data-number="4">
<h2 data-number="4" class="anchored" data-anchor-id="실제-예시-rag-시스템의-logical-architecture"><span class="header-section-number">4</span> 실제 예시: RAG 시스템의 Logical Architecture</h2>
<section id="conceptual에서-logical로의-전환" class="level3" data-number="4.1">
<h3 data-number="4.1" class="anchored" data-anchor-id="conceptual에서-logical로의-전환"><span class="header-section-number">4.1</span> Conceptual에서 Logical로의 전환</h3>
<pre><code>Conceptual Components → Logical Modules

1. Data Ingestion
   └─ Logical Modules:
      ├── SourceConnector
      ├── DocumentParser
      ├── ImageAnalyzer
      └── DataValidator

2. Storage Repository
   └─ Logical Modules:
      ├── TextRepository
      ├── VectorRepository
      ├── MetadataRepository
      └── CacheLayer

3. Retrieval Engine
   └─ Logical Modules:
      ├── QueryEncoder
      ├── VectorSearcher
      ├── TextSearcher
      ├── ResultRanker
      └── ContextAggregator

4. Response Generation
   └─ Logical Modules:
      ├── ReasoningEngine
      ├── ResponseComposer
      └── OutputFormatter

5. User Interface
   └─ Logical Modules:
      ├── APIGateway
      ├── ChatInterface
      └── DashboardService</code></pre>
</section>
<section id="프로젝트-예시" class="level3" data-number="4.2">
<h3 data-number="4.2" class="anchored" data-anchor-id="프로젝트-예시"><span class="header-section-number">4.2</span> 프로젝트 예시</h3>
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="kk3225.netlify.app/docs/blog/posts/Engineering/System/Archi_Design/sw_logical_architecture.png" class="img-fluid figure-img"></p>
<figcaption>SW Architecture 예시</figcaption>
</figure>
</div>
</section>
<section id="핵심-모듈-정의" class="level3" data-number="4.3">
<h3 data-number="4.3" class="anchored" data-anchor-id="핵심-모듈-정의"><span class="header-section-number">4.3</span> 핵심 모듈 정의</h3>
<p><strong>Module: SourceConnector</strong></p>
<pre><code>Responsibility: 다양한 소스에서 원본 데이터 수집

Input Configuration:
{
  source_type: "github" | "local_files" | "api",
  source_path: string,
  filter_rules: list[FilterRule],
  batch_size: integer
}

Output Stream:
RawDataItem {
  id: string (unique identifier),
  content: bytes,
  source: string,
  mime_type: string,
  timestamp: datetime,
  metadata: object
}

Key Operations:
  - open_connection(config) → Connection
  - read_batch() → RawDataItem[]
  - close_connection() → void
  
Error Handling:
  - Connection failures → Retry with backoff
  - Incomplete reads → Queue for retry
  - Invalid data → Log and continue</code></pre>
<p><strong>Module: VectorSearcher</strong></p>
<pre><code>Responsibility: 의미 기반 벡터 검색

Input Query:
{
  query_vector: float[],    // embedding representation
  top_k: integer,           // number of results
  filters: object,          // optional metadata filters
  similarity_threshold: float
}

Output Results:
SearchResult {
  id: string,
  content: string,
  similarity_score: float,  // 0.0 to 1.0
  metadata: object,
  rank: integer
}

Key Operations:
  - index_vectors(vectors: Vector[]) → void
  - search(query_vector, top_k) → SearchResult[]
  - filter_results(results, filters) → SearchResult[]
  
Performance Requirements:
  - Latency: &lt; 100ms per query
  - Throughput: 1000 queries/sec</code></pre>
<p><strong>Module: ResponseComposer</strong></p>
<pre><code>Responsibility: 관련 정보를 바탕으로 자연어 응답 생성

Input Context:
{
  user_query: string,
  retrieved_contexts: list[Context],  // Retrieved from search
  reasoning_result: object,
  response_style: "summary" | "detailed" | "structured"
}

Output Response:
{
  response_text: string,
  confidence_score: float,
  sources_cited: list[Source],
  follow_up_questions: list[string]
}

Key Operations:
  - compose_response(context, style) → Response
  - rank_context_by_relevance(contexts) → Context[]
  - generate_citations(contexts) → Citation[]
  
Quality Metrics:
  - Response coherence
  - Source relevance
  - Citation accuracy</code></pre>
</section>
<section id="모듈-간-인터페이스" class="level3" data-number="4.4">
<h3 data-number="4.4" class="anchored" data-anchor-id="모듈-간-인터페이스"><span class="header-section-number">4.4</span> 모듈 간 인터페이스</h3>
<p><strong>Interface: DataStream</strong></p>
<pre><code>from Module: SourceConnector
to Module: DataValidator

Protocol: Streaming (async pull-based)

Message Format:
{
  id: string,
  data: bytes,
  metadata: {
    source: string,
    timestamp: datetime,
    chunk_size: integer
  }
}

Error Handling:
- On validation failure → Send to ErrorHandler
- On timeout → Retry or abandon</code></pre>
<p><strong>Interface: SearchQuery</strong></p>
<pre><code>from Module: QueryEncoder
to Module: VectorSearcher

Protocol: Request-Response (sync)

Request:
{
  query_embedding: float[],
  top_k: integer = 10,
  filters: object = {}
}

Response:
{
  status: "success" | "error",
  results: SearchResult[],
  query_time_ms: integer,
  result_count: integer
}</code></pre>
</section>
</section>
<section id="logical-architecture-설계-체크리스트" class="level2" data-number="5">
<h2 data-number="5" class="anchored" data-anchor-id="logical-architecture-설계-체크리스트"><span class="header-section-number">5</span> Logical Architecture 설계 체크리스트</h2>
<p>설계 완료 전에 확인할 사항:</p>
<section id="모듈-설계" class="level3" data-number="5.1">
<h3 data-number="5.1" class="anchored" data-anchor-id="모듈-설계"><span class="header-section-number">5.1</span> 모듈 설계</h3>
<ul class="task-list">
<li><label><input type="checkbox">모든 Conceptual 컴포넌트가 Logical 모듈로 분해되었는가?</label></li>
<li><label><input type="checkbox">각 모듈의 책임이 명확하고 단일한가?</label></li>
<li><label><input type="checkbox">모듈 간 응집도가 높고 결합도가 낮은가?</label></li>
<li><label><input type="checkbox">각 모듈의 경계(boundary)가 명확하게 정의되었는가?</label></li>
</ul>
</section>
<section id="데이터-구조" class="level3" data-number="5.2">
<h3 data-number="5.2" class="anchored" data-anchor-id="데이터-구조"><span class="header-section-number">5.2</span> 데이터 구조</h3>
<ul class="task-list">
<li><label><input type="checkbox">각 모듈이 주고받는 데이터 형식이 정의되었는가?</label></li>
<li><label><input type="checkbox">데이터 구조가 확장 가능한가 (필드 추가 등)?</label></li>
<li><label><input type="checkbox">메타데이터가 충분히 포함되어 있는가?</label></li>
<li><label><input type="checkbox">버전 관리 전략이 있는가?</label></li>
</ul>
</section>
<section id="인터페이스-및-계약" class="level3" data-number="5.3">
<h3 data-number="5.3" class="anchored" data-anchor-id="인터페이스-및-계약"><span class="header-section-number">5.3</span> 인터페이스 및 계약</h3>
<ul class="task-list">
<li><label><input type="checkbox">모든 모듈 간 인터페이스가 정의되었는가?</label></li>
<li><label><input type="checkbox">API 계약이 명확하고 일관성 있는가?</label></li>
<li><label><input type="checkbox">에러 처리 메커니즘이 정의되었는가?</label></li>
<li><label><input type="checkbox">타임아웃, 재시도 정책이 정의되었는가?</label></li>
</ul>
</section>
<section id="성능-및-확장성" class="level3" data-number="5.4">
<h3 data-number="5.4" class="anchored" data-anchor-id="성능-및-확장성"><span class="header-section-number">5.4</span> 성능 및 확장성</h3>
<ul class="task-list">
<li><label><input type="checkbox">각 모듈의 성능 요구사항이 정의되었는가?</label></li>
<li><label><input type="checkbox">병목 가능성이 식별되었는가?</label></li>
<li><label><input type="checkbox">수평/수직 확장 전략이 있는가?</label></li>
<li><label><input type="checkbox">캐싱 전략이 정의되었는가?</label></li>
</ul>
</section>
<section id="신뢰성-및-복구력" class="level3" data-number="5.5">
<h3 data-number="5.5" class="anchored" data-anchor-id="신뢰성-및-복구력"><span class="header-section-number">5.5</span> 신뢰성 및 복구력</h3>
<ul class="task-list">
<li><label><input type="checkbox">장애 모드(failure modes)가 식별되었는가?</label></li>
<li><label><input type="checkbox">에러 처리 흐름이 모든 모듈에서 정의되었는가?</label></li>
<li><label><input type="checkbox">재시도 정책과 보상 트랜잭션이 있는가?</label></li>
<li><label><input type="checkbox">로깅 및 모니터링 포인트가 정의되었는가?</label></li>
</ul>
</section>
<section id="보안" class="level3" data-number="5.6">
<h3 data-number="5.6" class="anchored" data-anchor-id="보안"><span class="header-section-number">5.6</span> 보안</h3>
<ul class="task-list">
<li><label><input type="checkbox">모듈 간 데이터 전달 시 보안 고려사항이 있는가?</label></li>
<li><label><input type="checkbox">인증/인가가 필요한 모듈이 식별되었는가?</label></li>
<li><label><input type="checkbox">민감한 데이터 처리 방식이 정의되었는가?</label></li>
</ul>
</section>
</section>
<section id="logical-architecture-문서화" class="level2" data-number="6">
<h2 data-number="6" class="anchored" data-anchor-id="logical-architecture-문서화"><span class="header-section-number">6</span> Logical Architecture 문서화</h2>
<section id="필수-문서-요소" class="level3" data-number="6.1">
<h3 data-number="6.1" class="anchored" data-anchor-id="필수-문서-요소"><span class="header-section-number">6.1</span> 필수 문서 요소</h3>
<pre><code>1. Architecture Overview Diagram
   - 모든 모듈 시각화
   - 모듈 간 관계

2. Module Specification
   - 각 모듈의 책임
   - 입출력 데이터 정의
   - 주요 알고리즘/로직

3. Interface Definition
   - 모듈 간 API 계약
   - 데이터 형식 스키마
   - 통신 프로토콜

4. Data Flow Diagrams
   - 주요 시나리오별 흐름
   - 상태 전이
   - 에러 흐름

5. Non-Functional Requirements
   - 성능: 지연시간, 처리량
   - 확장성: 동시성, 데이터 크기
   - 신뢰성: 가용성, 복구 시간
   - 보안: 암호화, 접근 제어

6. Deployment Considerations
   - 모듈 배포 단위
   - 의존성 관리
   - 버전 호환성</code></pre>
</section>
<section id="문서-템플릿" class="level3" data-number="6.2">
<h3 data-number="6.2" class="anchored" data-anchor-id="문서-템플릿"><span class="header-section-number">6.2</span> 문서 템플릿</h3>
<div class="sourceCode" id="cb16" style="background: #f1f3f5;"><pre class="sourceCode numberSource markdown number-lines code-with-copy"><code class="sourceCode markdown"><span id="cb16-1"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;"># Module: [ModuleName]</span></span>
<span id="cb16-2"></span>
<span id="cb16-3"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">## Purpose</span></span>
<span id="cb16-4"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">[</span><span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">모듈의 목적과 책임</span><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">]</span></span>
<span id="cb16-5"></span>
<span id="cb16-6"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">## Input</span></span></code></pre></div>
<p>[입력 데이터 구조]</p>
<pre><code>
## Output</code></pre>
<p>[출력 데이터 구조]</p>
<pre><code>
## Key Operations
- [Operation 1]: [설명]
- [Operation 2]: [설명]

## Dependencies
- [Dependency 1]
- [Dependency 2]

## Error Handling
- [Error Scenario 1]: [대응 방식]
- [Error Scenario 2]: [대응 방식]

## Performance Requirements
- Latency: [목표값]
- Throughput: [목표값]

## Scalability
- Horizontal: [가능 여부]
- Vertical: [가능 여부]

## Testing Strategy
- Unit tests: [테스트 항목]
- Integration tests: [테스트 항목]</code></pre>
</section>
</section>
<section id="logical에서-physical로의-전환" class="level2" data-number="7">
<h2 data-number="7" class="anchored" data-anchor-id="logical에서-physical로의-전환"><span class="header-section-number">7</span> Logical에서 Physical로의 전환</h2>
<p>Logical Architecture가 완성되면 다음 단계:</p>
<p><strong>구체화되는 항목:</strong></p>
<pre><code>Logical                          Physical
─────────────────────────────────────────────

VectorSearcher          →    Elasticsearch / FAISS / Milvus
MetadataRepository      →    PostgreSQL / MongoDB
CacheLayer              →    Redis / Memcached
ResponseComposer        →    Python FastAPI + Jinja2
APIGateway              →    Kong / AWS API Gateway</code></pre>
<p><strong>변화:</strong></p>
<ul>
<li>구체적 기술 스택 선택</li>
<li>인프라 배포 구조 정의</li>
<li>네트워킹, 리소스 할당</li>
<li>CI/CD 파이프라인 설계</li>
</ul>
</section>
<section id="정리" class="level2" data-number="8">
<h2 data-number="8" class="anchored" data-anchor-id="정리"><span class="header-section-number">8</span> 정리</h2>
<p>Logical Architecture는:</p>
<ol type="1">
<li><strong>기술 중립성</strong> 유지하면서도 <strong>구현 수준</strong>의 세부사항 정의</li>
<li><strong>모듈화된 설계</strong>로 확장성과 유지보수성 확보</li>
<li><strong>명확한 인터페이스</strong> 정의로 팀 간 커뮤니케이션 효율화</li>
<li><strong>성능, 확장성, 신뢰성</strong> 요구사항을 구체적으로 반영</li>
<li><strong>Physical 설계</strong>를 위한 견고한 기반 제공</li>
</ol>
<p>Conceptual → Logical → Physical 순서로 설계하면, 각 단계에서 기술적 결정의 이유를 명확히 할 수 있으며, 변경사항에 유연하게 대응할 수 있다.</p>


</section>

 ]]></description>
  <category>Engineering</category>
  <category>Architecture</category>
  <guid>kk3225.netlify.app/docs/blog/posts/Engineering/System/Archi_Design/logical_design.html</guid>
  <pubDate>Sat, 15 Nov 2025 15:00:00 GMT</pubDate>
</item>
<item>
  <title>Conceptual Architecture 그리는 방법</title>
  <dc:creator>Kwangmin Kim</dc:creator>
  <link>kk3225.netlify.app/docs/blog/posts/Engineering/System/Archi_Design/conceptual_dsign.html</link>
  <description><![CDATA[ 





<section id="conceptual-architecture의-정의" class="level2" data-number="1">
<h2 data-number="1" class="anchored" data-anchor-id="conceptual-architecture의-정의"><span class="header-section-number">1</span> Conceptual Architecture의 정의</h2>
<p>Conceptual Architecture는 시스템 설계의 첫 번째 추상화 계층으로, <strong>비즈니스 요구사항</strong>을 기술 구현 없이 고수준의 개념으로 표현</p>
<p><strong>핵심 특징:</strong></p>
<ul>
<li>기술 스택 미포함: 어떤 도구를 사용할지 정하지 않음</li>
<li>비즈니스 로직 중심: “무엇을 해야 하는가”에 집중</li>
<li>이해관계자 소통: 기술팀과 비즈니스팀 모두 이해 가능</li>
<li>추상적 컴포넌트: “데이터 소스”, “처리 엔진”, “저장소” 등 범용 용어 사용</li>
</ul>
</section>
<section id="conceptual-architecture-작성-단계" class="level2" data-number="2">
<h2 data-number="2" class="anchored" data-anchor-id="conceptual-architecture-작성-단계"><span class="header-section-number">2</span> Conceptual Architecture 작성 단계</h2>
<section id="요구사항-정의" class="level3" data-number="2.1">
<h3 data-number="2.1" class="anchored" data-anchor-id="요구사항-정의"><span class="header-section-number">2.1</span> 요구사항 정의</h3>
<ul>
<li><strong>목표</strong>: 시스템이 해결할 비즈니스 문제가 무엇인가?</li>
<li><strong>입력</strong>: 어떤 데이터가 들어오는가?</li>
<li><strong>출력</strong>: 어떤 결과가 나가야 하는가?</li>
<li><strong>주요 기능</strong>: 시스템이 수행해야 할 핵심 작업은 무엇인가?</li>
</ul>
<p><strong>예시: RAG 기반 코드 분석 시스템</strong></p>
<ul>
<li><strong>목표</strong>: 비기술 이해관계자가 GitHub 저장소의 코드와 알고리즘을 이해하도록 지원</li>
<li><strong>입력</strong>: 소스 코드, 문서, 플로우차트 이미지</li>
<li><strong>출력</strong>: 자연어 설명, 요약, 답변</li>
<li><strong>핵심 기능</strong>: 문서화, 의미 검색, 자동 요약, 질문 응답</li>
</ul>
</section>
<section id="주요-컴포넌트-식별" class="level3" data-number="2.2">
<h3 data-number="2.2" class="anchored" data-anchor-id="주요-컴포넌트-식별"><span class="header-section-number">2.2</span> 주요 컴포넌트 식별</h3>
<ul>
<li>시스템을 구성하는 <strong>논리적 단위</strong>를 식별</li>
<li>구체적 기술이 아닌 기능 기반으로 명명</li>
</ul>
<p><strong>일반적인 패턴:</strong></p>
<table class="table">
<colgroup>
<col style="width: 33%">
<col style="width: 33%">
<col style="width: 33%">
</colgroup>
<thead>
<tr class="header">
<th>컴포넌트 역할</th>
<th>설명</th>
<th>예시</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td><strong>Source/Input</strong></td>
<td>데이터 입력 지점</td>
<td>GitHub Repository, Document Files</td>
</tr>
<tr class="even">
<td><strong>Processing</strong></td>
<td>핵심 처리 로직</td>
<td>Data Parsing, Embedding Generation</td>
</tr>
<tr class="odd">
<td><strong>Storage</strong></td>
<td>데이터 저장소</td>
<td>Knowledge Base, Metadata Repository</td>
</tr>
<tr class="even">
<td><strong>Retrieval</strong></td>
<td>정보 검색</td>
<td>Search Engine, Query Processor</td>
</tr>
<tr class="odd">
<td><strong>Output/Service</strong></td>
<td>사용자 인터페이스</td>
<td>API, Chat Interface, Dashboard</td>
</tr>
</tbody>
</table>
</section>
<section id="데이터-흐름-정의" class="level3" data-number="2.3">
<h3 data-number="2.3" class="anchored" data-anchor-id="데이터-흐름-정의"><span class="header-section-number">2.3</span> 데이터 흐름 정의</h3>
<p>컴포넌트 간의 <strong>데이터 이동</strong> 경로를 단계별로 표현</p>
<pre><code>Source → Ingestion → Processing → Storage → Retrieval → Response Generation → Output</code></pre>
<p>각 단계에서:</p>
<ul>
<li>어떤 데이터가 입력되는가?</li>
<li>어떤 변환이 일어나는가?</li>
<li>어떤 데이터가 출력되는가?</li>
</ul>
</section>
<section id="상호작용-패턴-정의" class="level3" data-number="2.4">
<h3 data-number="2.4" class="anchored" data-anchor-id="상호작용-패턴-정의"><span class="header-section-number">2.4</span> 상호작용 패턴 정의</h3>
<p>컴포넌트 간의 <strong>통신 방식</strong>을 정의합니다:</p>
<ul>
<li><strong>동기식</strong>: 요청-응답 (Synchronous)</li>
<li><strong>비동기식</strong>: 이벤트 기반 (Asynchronous)</li>
<li><strong>배치</strong>: 주기적 처리 (Batch Processing)</li>
</ul>
</section>
</section>
<section id="conceptual-architecture-시각화-방법" class="level2" data-number="3">
<h2 data-number="3" class="anchored" data-anchor-id="conceptual-architecture-시각화-방법"><span class="header-section-number">3</span> Conceptual Architecture 시각화 방법</h2>
<section id="블록-다이어그램-가장-기본적" class="level3" data-number="3.1">
<h3 data-number="3.1" class="anchored" data-anchor-id="블록-다이어그램-가장-기본적"><span class="header-section-number">3.1</span> 블록 다이어그램 (가장 기본적)</h3>
<pre><code>┌─────────────────────────────────────────────────────────┐
│                  Conceptual Architecture                │
└─────────────────────────────────────────────────────────┘

   ┌──────────┐         ┌──────────┐         ┌──────────┐
   │  Source  │────────▶│Processing│────────▶│ Storage  │
   │   Data   │         │  Engine  │         │Repository│
   └──────────┘         └──────────┘         └──────────┘
                              ▲                    │
                              │                    │
                              │                    ▼
                        ┌──────────┐         ┌──────────┐
                        │  Query   │◀────────│Retrieval │
                        │Processor │         │  Engine  │
                        └──────────┘         └──────────┘
                              │
                              ▼
                        ┌──────────────┐
                        │    Output    │
                        │ (API/Chat UI)│
                        └──────────────┘</code></pre>
</section>
<section id="데이터-흐름-다이어그램-swimlane" class="level3" data-number="3.2">
<h3 data-number="3.2" class="anchored" data-anchor-id="데이터-흐름-다이어그램-swimlane"><span class="header-section-number">3.2</span> 데이터 흐름 다이어그램 (Swimlane)</h3>
<pre><code>User/System    │    System Core         │    External
               │                        │
Request ──────▶│ ┌──────────────────┐  │
               │ │  Request Handler │  │
               │ └────────┬─────────┘  │
               │          ▼            │
               │ ┌──────────────────┐  │
               │ │  Data Processor  │  │
               │ └────────┬─────────┘  │
               │          ▼            │
               │ ┌──────────────────┐  │  ┌──────────┐
               │ │ Search/Retrieve  │──▶│ Knowledge│
               │ └────────┬─────────┘  │  │   Base   │
               │          ▼            │  └──────────┘
               │ ┌──────────────────┐  │
               │ │Generate Response │  │
               │ └────────┬─────────┘  │
               │          ▼            │
Response ◀─────│ ┌──────────────────┐  │
               │ │Output Formatter  │  │
               │ └──────────────────┘  │</code></pre>
</section>
<section id="컴포넌트-상호작용-테이블" class="level3" data-number="3.3">
<h3 data-number="3.3" class="anchored" data-anchor-id="컴포넌트-상호작용-테이블"><span class="header-section-number">3.3</span> 컴포넌트 상호작용 테이블</h3>
<table class="table">
<colgroup>
<col style="width: 25%">
<col style="width: 16%">
<col style="width: 16%">
<col style="width: 16%">
<col style="width: 25%">
</colgroup>
<thead>
<tr class="header">
<th>컴포넌트</th>
<th>입력</th>
<th>처리</th>
<th>출력</th>
<th>상호작용</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td>Data Ingestion</td>
<td>Raw Files</td>
<td>Parse &amp; Validate</td>
<td>Standardized Data</td>
<td>→ Processing</td>
</tr>
<tr class="even">
<td>Processing</td>
<td>Standardized Data</td>
<td>Transform &amp; Enrich</td>
<td>Processed Data</td>
<td>→ Storage</td>
</tr>
<tr class="odd">
<td>Storage</td>
<td>Processed Data</td>
<td>Index &amp; Organize</td>
<td>Indexed Data</td>
<td>← Retrieval</td>
</tr>
<tr class="even">
<td>Retrieval</td>
<td>Query</td>
<td>Search &amp; Rank</td>
<td>Relevant Data</td>
<td>→ Response Gen</td>
</tr>
<tr class="odd">
<td>Response Gen</td>
<td>Relevant Data</td>
<td>Format &amp; Compose</td>
<td>Natural Language</td>
<td>→ Output</td>
</tr>
</tbody>
</table>
</section>
</section>
<section id="실제-예시-rag-시스템의-conceptual-architecture" class="level2" data-number="4">
<h2 data-number="4" class="anchored" data-anchor-id="실제-예시-rag-시스템의-conceptual-architecture"><span class="header-section-number">4</span> 실제 예시: RAG 시스템의 Conceptual Architecture</h2>
<section id="시스템-목표" class="level3" data-number="4.1">
<h3 data-number="4.1" class="anchored" data-anchor-id="시스템-목표"><span class="header-section-number">4.1</span> 시스템 목표</h3>
<p>비기술 이해관계자가 복잡한 소스 코드와 알고리즘 문서를 자연어로 이해할 수 있도록 지원하는 AI 기반 질문응답 시스템.</p>
</section>
<section id="주요-컴포넌트" class="level3" data-number="4.2">
<h3 data-number="4.2" class="anchored" data-anchor-id="주요-컴포넌트"><span class="header-section-number">4.2</span> 주요 컴포넌트</h3>
<pre><code>1. 소스 수집 (Source Collection)
   - GitHub 코드 저장소
   - 마크다운 문서
   - 플로우차트 이미지

2. 데이터 준비 (Data Preparation)
   - 텍스트 추출 및 파싱
   - 이미지 분석 및 OCR
   - 메타데이터 추출

3. 지식 저장소 (Knowledge Repository)
   - 구조화된 데이터 저장
   - 임베딩 벡터 저장
   - 메타데이터 관리

4. 검색 및 검색 (Retrieval &amp; Search)
   - 의미 기반 검색
   - 컨텍스트 관련성 판단
   - 결과 순위 지정

5. 응답 생성 (Response Generation)
   - 관련 컨텍스트 결합
   - 자연어 응답 생성
   - 출력 포맷팅

6. 사용자 인터페이스 (User Interface)
   - 채팅 인터페이스
   - REST API
   - 대시보드</code></pre>
</section>
<section id="데이터-흐름-및-상호작용" class="level3" data-number="4.3">
<h3 data-number="4.3" class="anchored" data-anchor-id="데이터-흐름-및-상호작용"><span class="header-section-number">4.3</span> 데이터 흐름 및 상호작용</h3>
<pre><code>┌─────────────────────────────────────────────────────────────────────┐
│                    RAG System - Conceptual Architecture              │
└─────────────────────────────────────────────────────────────────────┘

GitHub Repo ─┐
             │
Documents ───┼──▶ ┌──────────────┐      ┌─────────────────┐
             │    │   Ingestion  │─────▶│  Knowledge      │
Images ──────┘    │   &amp; Parsing  │      │  Repository     │
                  └──────────────┘      │  (with vectors) │
                                        └────────┬────────┘
                                                 │
                  ┌──────────────┐              │
                  │   User Query │              │
                  └──────┬───────┘              │
                         │                      │
                         ▼                      │
                  ┌──────────────┐              │
                  │Query Encoder │              │
                  └──────┬───────┘              │
                         │                      │
                         ▼                      ▼
                  ┌──────────────────────────────────┐
                  │  Semantic Search &amp; Retrieval     │
                  └──────────────┬───────────────────┘
                                 │
                                 ▼
                  ┌──────────────────────────────────┐
                  │  Context Aggregation             │
                  └──────────────┬───────────────────┘
                                 │
                                 ▼
                  ┌──────────────────────────────────┐
                  │  Response Generation             │
                  │  (Reasoning + Composition)       │
                  └──────────────┬───────────────────┘
                                 │
                                 ▼
                  ┌──────────────────────────────────┐
                  │  Output Formatting               │
                  │  (Natural Language Response)     │
                  └──────────────────────────────────┘</code></pre>
</section>
</section>
<section id="conceptual-architecture-작성-체크리스트" class="level2" data-number="5">
<h2 data-number="5" class="anchored" data-anchor-id="conceptual-architecture-작성-체크리스트"><span class="header-section-number">5</span> Conceptual Architecture 작성 체크리스트</h2>
<p>Conceptual Architecture를 완성하기 전에 확인할 사항:</p>
<ul class="task-list">
<li><label><input type="checkbox">시스템의 최종 목표가 명확하게 표현되었는가?</label></li>
<li><label><input type="checkbox">모든 주요 컴포넌트가 식별되었는가?</label></li>
<li><label><input type="checkbox">각 컴포넌트의 역할이 기술 독립적으로 표현되었는가?</label></li>
<li><label><input type="checkbox">데이터 흐름이 시작부터 끝까지 연결되어 있는가?</label></li>
<li><label><input type="checkbox">외부 시스템/이해관계자와의 상호작용이 표현되었는가?</label></li>
<li><label><input type="checkbox">비기술팀도 이해할 수 있는 용어를 사용했는가?</label></li>
<li><label><input type="checkbox">모호한 부분이 제거되었는가?</label></li>
</ul>
</section>
<section id="conceptual에서-logical으로의-전환" class="level2" data-number="6">
<h2 data-number="6" class="anchored" data-anchor-id="conceptual에서-logical으로의-전환"><span class="header-section-number">6</span> Conceptual에서 Logical으로의 전환</h2>
<p>Conceptual Architecture가 완성되면, 다음 단계에서 Logical Architecture로 전환:</p>
<p><strong>변화:</strong></p>
<ul>
<li>추상적 “Processing Engine” → 구체적 “Data Transformation Pipeline”, “Feature Engineering Module”</li>
<li>추상적 “Storage” → 구체적 “Vector Store”, “Relational Database”, “Document Store”</li>
<li>데이터 구조 정의: 스키마, 인터페이스 계약</li>
<li>모듈 간 통신 프로토콜 정의</li>
</ul>
<p><strong>예시:</strong></p>
<pre><code>Conceptual: "Query Processor" 
Logical: "Embedding Generator" + "Similarity Search Engine" + "Ranking Module"</code></pre>
</section>
<section id="정리" class="level2" data-number="7">
<h2 data-number="7" class="anchored" data-anchor-id="정리"><span class="header-section-number">7</span> 정리</h2>
<p>Conceptual Architecture는:</p>
<ol type="1">
<li><strong>비즈니스 관점</strong> 중심의 고수준 설계</li>
<li><strong>기술 중립적</strong>이지만 기능적으로 명확</li>
<li><strong>이해관계자 커뮤니케이션</strong> 도구</li>
<li><strong>Logical 및 Physical</strong> 설계의 기초</li>
</ol>
<p>이를 체계적으로 작성하면 후속 설계 단계가 명확해지고, 팀 전체가 같은 비전을 공유할 수 있다.</p>


</section>

 ]]></description>
  <category>Engineering</category>
  <category>Architecture</category>
  <guid>kk3225.netlify.app/docs/blog/posts/Engineering/System/Archi_Design/conceptual_dsign.html</guid>
  <pubDate>Fri, 14 Nov 2025 15:00:00 GMT</pubDate>
</item>
<item>
  <title>Functional Data Analysis</title>
  <dc:creator>Kwangmin Kim</dc:creator>
  <link>kk3225.netlify.app/docs/blog/posts/Statistics/FDA/</link>
  <description><![CDATA[ 





<section id="introduction-and-representation" class="level3" data-number="0.0.1">
<h3 data-number="0.0.1" class="anchored" data-anchor-id="introduction-and-representation"><span class="header-section-number">0.0.1</span> Introduction and Representation</h3>
<ul>
<li>2025-11-18, <a href="../2025-11-18_functional_data/index.qmd">What is Functional Data</a></li>
<li>2025-11-19, <a href="../2025-11-19_basis_functions/index.qmd">Basis Function Expansions</a></li>
<li>2025-11-20, <a href="../2025-11-20_bsplines/index.qmd">B-splines</a></li>
<li>2025-11-21, <a href="../2025-11-21_fourier_basis/index.qmd">Fourier Basis</a></li>
<li>2025-11-22, <a href="../2025-11-22_wavelets/index.qmd">Wavelets Basis</a></li>
<li>2025-11-23, <a href="../2025-11-23_smoothing/index.qmd">Smoothing and Roughness Penalty</a></li>
<li>2025-11-24, <a href="../2025-11-24_cv_smoothing/index.qmd">Cross-Validation for Smoothing Parameter</a></li>
</ul>
</section>
<section id="descriptive-statistics" class="level3" data-number="0.0.2">
<h3 data-number="0.0.2" class="anchored" data-anchor-id="descriptive-statistics"><span class="header-section-number">0.0.2</span> Descriptive Statistics</h3>
<ul>
<li>2025-11-25, <a href="../2025-11-25_functional_mean/index.qmd">Functional Mean</a></li>
<li>2025-11-26, <a href="../2025-11-26_functional_variance/index.qmd">Functional Variance</a></li>
<li>2025-11-27, <a href="../2025-11-27_covariance_function/index.qmd">Covariance Function</a></li>
<li>2025-11-28, <a href="../2025-11-28_cross_covariance/index.qmd">Cross-Covariance Function</a></li>
<li>2025-11-29, <a href="../2025-11-29_functional_boxplot/index.qmd">Functional Boxplot</a></li>
<li>2025-11-30, <a href="../2025-11-30_band_depth/index.qmd">Band Depth</a></li>
<li>2025-12-01, <a href="../2025-12-01_modified_band_depth/index.qmd">Modified Band Depth</a></li>
</ul>
</section>
<section id="functional-principal-component-analysis" class="level3" data-number="0.0.3">
<h3 data-number="0.0.3" class="anchored" data-anchor-id="functional-principal-component-analysis"><span class="header-section-number">0.0.3</span> Functional Principal Component Analysis</h3>
<ul>
<li>2025-12-02, <a href="../2025-12-02_karhunen_loeve/index.qmd">Karhunen-Loève Expansion</a></li>
<li>2025-12-03, <a href="../2025-12-03_eigenfunction/index.qmd">Eigenfunction and Eigenvalue</a></li>
<li>2025-12-04, <a href="../2025-12-04_pc_scores/index.qmd">Principal Component Scores</a></li>
<li>2025-12-05, <a href="../2025-12-05_variance_explained/index.qmd">Variance Explained</a></li>
<li>2025-12-06, <a href="../2025-12-06_scree_plot/index.qmd">Scree Plot</a></li>
<li>2025-12-07, <a href="../2025-12-07_pc_interpretation/index.qmd">PC Score Interpretation</a></li>
<li>2025-12-08, <a href="../2025-12-08_dimension_reduction/index.qmd">Dimension Reduction with FPCA</a></li>
</ul>
</section>
<section id="curve-registration" class="level3" data-number="0.0.4">
<h3 data-number="0.0.4" class="anchored" data-anchor-id="curve-registration"><span class="header-section-number">0.0.4</span> Curve Registration</h3>
<ul>
<li>2025-12-09, <a href="../2025-12-09_phase_amplitude/index.qmd">Phase and Amplitude Variation</a></li>
<li>2025-12-10, <a href="../2025-12-10_warping_function/index.qmd">Time Warping Function</a></li>
<li>2025-12-11, <a href="../2025-12-11_landmark_registration/index.qmd">Landmark Registration</a></li>
<li>2025-12-12, <a href="../2025-12-12_continuous_registration/index.qmd">Continuous Registration</a></li>
<li>2025-12-13, <a href="../2025-12-13_fisher_rao/index.qmd">Fisher-Rao Metric</a></li>
<li>2025-12-14, <a href="../2025-12-14_srvf/index.qmd">Square-Root Velocity Function (SRVF)</a></li>
<li>2025-12-15, <a href="../2025-12-15_registration_effects/index.qmd">Registration Effects on Mean and Variance</a></li>
</ul>
</section>
<section id="core-methods" class="level2" data-number="0.1">
<h2 data-number="0.1" class="anchored" data-anchor-id="core-methods"><span class="header-section-number">0.1</span> Core Methods</h2>
<section id="functional-regression---basics" class="level3" data-number="0.1.1">
<h3 data-number="0.1.1" class="anchored" data-anchor-id="functional-regression---basics"><span class="header-section-number">0.1.1</span> Functional Regression - Basics</h3>
<ul>
<li>2025-12-16, <a href="../2025-12-16_functional_linear_model/index.qmd">Functional Linear Model</a></li>
<li>2025-12-17, <a href="../2025-12-17_scalar_on_function/index.qmd">Scalar-on-Function Regression</a></li>
<li>2025-12-18, <a href="../2025-12-18_coeff_estimation/index.qmd">Regression Coefficient Function Estimation</a></li>
<li>2025-12-19, <a href="../2025-12-19_coeff_inference/index.qmd">Coefficient Function Inference</a></li>
<li>2025-12-20, <a href="../2025-12-20_function_on_scalar/index.qmd">Function-on-Scalar Regression</a></li>
<li>2025-12-21, <a href="../2025-12-21_function_on_function/index.qmd">Function-on-Function Regression</a></li>
<li>2025-12-22, <a href="../2025-12-22_bivariate_coeff/index.qmd">Bivariate Coefficient Function</a></li>
</ul>
</section>
<section id="functional-regression---advanced" class="level3" data-number="0.1.2">
<h3 data-number="0.1.2" class="anchored" data-anchor-id="functional-regression---advanced"><span class="header-section-number">0.1.2</span> Functional Regression - Advanced</h3>
<ul>
<li>2025-12-23, <a href="../2025-12-23_ridge_regression/index.qmd">Ridge Regression for Functional Data</a></li>
<li>2025-12-24, <a href="../2025-12-24_lasso/index.qmd">Lasso for Functional Data</a></li>
<li>2025-12-25, <a href="../2025-12-25_group_lasso/index.qmd">Group Lasso</a></li>
<li>2025-12-26, <a href="../2025-12-26_elastic_net/index.qmd">Elastic Net for Functional Data</a></li>
<li>2025-12-27, <a href="../2025-12-27_variable_selection/index.qmd">Variable Selection in Functional Regression</a></li>
<li>2025-12-28, <a href="../2025-12-28_functional_additive/index.qmd">Functional Additive Models</a></li>
<li>2025-12-29, <a href="../2025-12-29_functional_glm/index.qmd">Functional Generalized Linear Models</a></li>
</ul>
</section>
<section id="multivariate-functional-data" class="level3" data-number="0.1.3">
<h3 data-number="0.1.3" class="anchored" data-anchor-id="multivariate-functional-data"><span class="header-section-number">0.1.3</span> Multivariate Functional Data</h3>
<ul>
<li>2025-12-30, <a href="../2025-12-30_multivariate_concept/index.qmd">Multivariate Functional Data Concept</a></li>
<li>2025-12-31, <a href="../2025-12-31_multivariate_covariance/index.qmd">Multivariate Covariance Operator</a></li>
<li>2026-01-01, <a href="../2026-01-01_mfpca/index.qmd">Multivariate FPCA (MFPCA)</a></li>
<li>2026-01-02, <a href="../2026-01-02_jive/index.qmd">Joint and Individual Variation (JIVE)</a></li>
<li>2026-01-03, <a href="../2026-01-03_functional_cca/index.qmd">Canonical Correlation Analysis for Functional Data</a></li>
<li>2026-01-04, <a href="../2026-01-04_multivariate_regression/index.qmd">Multivariate Functional Regression</a></li>
<li>2026-01-05, <a href="../2026-01-05_tensor_product/index.qmd">Tensor Product Basis</a></li>
</ul>
</section>
<section id="hypothesis-testing" class="level3" data-number="0.1.4">
<h3 data-number="0.1.4" class="anchored" data-anchor-id="hypothesis-testing"><span class="header-section-number">0.1.4</span> Hypothesis Testing</h3>
<ul>
<li>2026-01-06, <a href="../2026-01-06_pointwise_testing/index.qmd">Pointwise Testing</a></li>
<li>2026-01-07, <a href="../2026-01-07_multiple_testing/index.qmd">Multiple Testing Correction</a></li>
<li>2026-01-08, <a href="../2026-01-08_global_testing/index.qmd">Global Testing</a></li>
<li>2026-01-09, <a href="../2026-01-09_functional_anova/index.qmd">Functional ANOVA</a></li>
<li>2026-01-10, <a href="../2026-01-10_permutation_tests/index.qmd">Permutation Tests for Functional Data</a></li>
<li>2026-01-11, <a href="../2026-01-11_functional_bootstrap/index.qmd">Bootstrap for Functional Data</a></li>
<li>2026-01-12, <a href="../2026-01-12_confidence_bands/index.qmd">Simultaneous Confidence Bands</a></li>
</ul>
</section>
</section>
<section id="advanced-topics" class="level2" data-number="0.2">
<h2 data-number="0.2" class="anchored" data-anchor-id="advanced-topics"><span class="header-section-number">0.2</span> Advanced Topics</h2>
<section id="classification-and-clustering" class="level3" data-number="0.2.1">
<h3 data-number="0.2.1" class="anchored" data-anchor-id="classification-and-clustering"><span class="header-section-number">0.2.1</span> Classification and Clustering</h3>
<ul>
<li>2026-01-13, <a href="../2026-01-13_functional_discriminant/index.qmd">Functional Discriminant Analysis</a></li>
<li>2026-01-14, <a href="../2026-01-14_functional_logistic/index.qmd">Functional Logistic Regression</a></li>
<li>2026-01-15, <a href="../2026-01-15_functional_kmeans/index.qmd">Functional K-means</a></li>
<li>2026-01-16, <a href="../2026-01-16_hierarchical_clustering/index.qmd">Functional Hierarchical Clustering</a></li>
<li>2026-01-17, <a href="../2026-01-17_model_based_clustering/index.qmd">Model-Based Clustering</a></li>
<li>2026-01-18, <a href="../2026-01-18_mixture_models/index.qmd">Functional Mixture Models</a></li>
<li>2026-01-19, <a href="../2026-01-19_distance_metrics/index.qmd">Distance Metrics for Functional Data</a></li>
</ul>
</section>
<section id="sparse-and-longitudinal-data" class="level3" data-number="0.2.2">
<h3 data-number="0.2.2" class="anchored" data-anchor-id="sparse-and-longitudinal-data"><span class="header-section-number">0.2.2</span> Sparse and Longitudinal Data</h3>
<ul>
<li>2026-01-20, <a href="../2026-01-20_sparse_functional/index.qmd">Sparse Functional Data</a></li>
<li>2026-01-21, <a href="../2026-01-21_pace/index.qmd">PACE (Principal Analysis by Conditional Expectation)</a></li>
<li>2026-01-22, <a href="../2026-01-22_local_polynomial/index.qmd">Local Polynomial Smoothing</a></li>
<li>2026-01-23, <a href="../2026-01-23_functional_mixed/index.qmd">Functional Mixed Models</a></li>
<li>2026-01-24, <a href="../2026-01-24_subject_specific/index.qmd">Subject-Specific Curves</a></li>
<li>2026-01-25, <a href="../2026-01-25_population_inference/index.qmd">Population-Level Inference</a></li>
<li>2026-01-26, <a href="../2026-01-26_random_effects/index.qmd">Functional Random Effects</a></li>
</ul>
</section>
<section id="time-series-and-dynamics" class="level3" data-number="0.2.3">
<h3 data-number="0.2.3" class="anchored" data-anchor-id="time-series-and-dynamics"><span class="header-section-number">0.2.3</span> Time Series and Dynamics</h3>
<ul>
<li>2026-01-27, <a href="../2026-01-27_functional_time_series/index.qmd">Functional Time Series</a></li>
<li>2026-01-28, <a href="../2026-01-28_far_models/index.qmd">Functional Autoregressive Models (FAR)</a></li>
<li>2026-01-29, <a href="../2026-01-29_fma_models/index.qmd">Functional Moving Average Models</a></li>
<li>2026-01-30, <a href="../2026-01-30_forecasting/index.qmd">Forecasting with Functional Data</a></li>
<li>2026-01-31, <a href="../2026-01-31_dynamic_fpca/index.qmd">Dynamic Functional Principal Components</a></li>
<li>2026-02-01, <a href="../2026-02-01_state_space/index.qmd">State Space Models for Functional Data</a></li>
<li>2026-02-02, <a href="../2026-02-02_kalman_filter/index.qmd">Functional Kalman Filter</a></li>
</ul>
</section>
<section id="advanced-topics-and-extensions" class="level3" data-number="0.2.4">
<h3 data-number="0.2.4" class="anchored" data-anchor-id="advanced-topics-and-extensions"><span class="header-section-number">0.2.4</span> Advanced Topics and Extensions</h3>
<ul>
<li>2026-02-03, <a href="../2026-02-03_manifolds/index.qmd">Functional Data on Manifolds</a></li>
<li>2026-02-04, <a href="../2026-02-04_hilbert_spaces/index.qmd">Functional Data in Hilbert Spaces</a></li>
<li>2026-02-05, <a href="../2026-02-05_rkhs/index.qmd">Reproducing Kernel Hilbert Spaces (RKHS)</a></li>
<li>2026-02-06, <a href="../2026-02-06_gaussian_process/index.qmd">Gaussian Process Regression</a></li>
<li>2026-02-07, <a href="../2026-02-07_bayesian_fda/index.qmd">Bayesian Functional Data Analysis</a></li>
<li>2026-02-08, <a href="../2026-02-08_functional_nn/index.qmd">Functional Neural Networks</a></li>
<li>2026-02-09, <a href="../2026-02-09_deep_learning/index.qmd">Deep Learning for Functional Data</a></li>
</ul>
</section>
</section>
<section id="supplementary-topics" class="level2" data-number="0.3">
<h2 data-number="0.3" class="anchored" data-anchor-id="supplementary-topics"><span class="header-section-number">0.3</span> Supplementary Topics</h2>
<section id="computational-methods" class="level3" data-number="0.3.1">
<h3 data-number="0.3.1" class="anchored" data-anchor-id="computational-methods"><span class="header-section-number">0.3.1</span> Computational Methods</h3>
<ul>
<li>1111-11-11, <a href="../numerical_integration/index.qmd">Numerical Integration for Functional Data</a></li>
<li>1111-11-11, <a href="../discretization/index.qmd">Discretization Methods</a></li>
<li>1111-11-11, <a href="../efficient_covariance/index.qmd">Efficient Computation of Covariance Operators</a></li>
<li>1111-11-11, <a href="../parallel_computing/index.qmd">Parallel Computing for FDA</a></li>
</ul>
</section>
<section id="software-and-tools" class="level3" data-number="0.3.2">
<h3 data-number="0.3.2" class="anchored" data-anchor-id="software-and-tools"><span class="header-section-number">0.3.2</span> Software and Tools</h3>
<ul>
<li>1111-11-11, <a href="../r_fda/index.qmd">R Package: fda</a></li>
<li>1111-11-11, <a href="../r_refund/index.qmd">R Package: refund</a></li>
<li>1111-11-11, <a href="../r_fdapace/index.qmd">R Package: fdapace</a></li>
<li>1111-11-11, <a href="../r_fdasrvf/index.qmd">R Package: fdasrvf</a></li>
<li>1111-11-11, <a href="../python_skfda/index.qmd">Python: scikit-fda</a></li>
</ul>
</section>
<section id="applications-optional" class="level3" data-number="0.3.3">
<h3 data-number="0.3.3" class="anchored" data-anchor-id="applications-optional"><span class="header-section-number">0.3.3</span> Applications (Optional)</h3>
<ul>
<li>1111-11-11, <a href="../applications_biomedical/index.qmd">FDA in Biomedical Sciences</a></li>
<li>1111-11-11, <a href="../applications_environmental/index.qmd">FDA in Environmental Sciences</a></li>
<li>1111-11-11, <a href="../applications_finance/index.qmd">FDA in Economics and Finance</a></li>
<li>1111-11-11, <a href="../applications_image/index.qmd">FDA in Image Analysis</a></li>
</ul>
</section>
</section>
<section id="연구-분야-기획" class="level2" data-number="0.4">
<h2 data-number="0.4" class="anchored" data-anchor-id="연구-분야-기획"><span class="header-section-number">0.4</span> 연구 분야 기획</h2>
<section id="최종-목표" class="level3" data-number="0.4.1">
<h3 data-number="0.4.1" class="anchored" data-anchor-id="최종-목표"><span class="header-section-number">0.4.1</span> 최종 목표</h3>
<p>RT-PCR 증폭 곡선 분석을 위한 FDA 핵심 개념 습득 및 실전 적용 능력 확보</p>
<ol type="1">
<li><strong>이론 40% + 구현 60%</strong>: 매 주제마다 R/Python 구현 필수</li>
<li><strong>RT-PCR 중심</strong>: 추상적 이론보다 실제 응용 위주</li>
<li><strong>점진적 심화</strong>: 기초 → 중급 → 고급 → 응용 순서 엄수</li>
</ol>
</section>
</section>
<section id="주차별-시간-배분" class="level2" data-number="0.5">
<h2 data-number="0.5" class="anchored" data-anchor-id="주차별-시간-배분"><span class="header-section-number">0.5</span> 주차별 시간 배분</h2>
<ul>
<li><strong>Month 1</strong>: 기초 개념 및 탐색적 분석 (56시간)</li>
<li><strong>Month 2</strong>: 핵심 방법론 (FPCA, Registration) (56시간)<br>
</li>
<li><strong>Month 3</strong>: 고급 주제 및 RT-PCR 프로젝트 (56시간)</li>
</ul>
</section>
<section id="month-1-기초-개념-및-탐색적-분석" class="level1" data-number="1">
<h1 data-number="1"><span class="header-section-number">1</span> Month 1: 기초 개념 및 탐색적 분석</h1>
<section id="week-1-fda-개념-및-데이터-표현-14시간" class="level2" data-number="1.1">
<h2 data-number="1.1" class="anchored" data-anchor-id="week-1-fda-개념-및-데이터-표현-14시간"><span class="header-section-number">1.1</span> Week 1: FDA 개념 및 데이터 표현 (14시간)</h2>
<section id="함수형-데이터의-정의와-특성" class="level3" data-number="1.1.1">
<h3 data-number="1.1.1" class="anchored" data-anchor-id="함수형-데이터의-정의와-특성"><span class="header-section-number">1.1.1</span> 함수형 데이터의 정의와 특성</h3>
<ul>
<li>2025-11-18, <a href="../2025-11-18_fda_intro/index.qmd">함수형 데이터란 무엇인가</a>
<ul>
<li>이산 측정값 vs 연속 함수의 차이</li>
<li>FDA가 필요한 이유: RT-PCR 곡선이 함수인 이유</li>
<li>실습: 45개 사이클 RFU 데이터를 함수로 시각화</li>
</ul></li>
<li>2025-11-19, <a href="../2025-11-19_fda_representation/index.qmd">함수형 데이터의 표현 방법</a>
<ul>
<li>기저 함수(Basis Functions): B-spline, Fourier, Wavelets</li>
<li>평활화(Smoothing): 거칠기 페널티(Roughness Penalty)</li>
<li>실습: RT-PCR 곡선을 B-spline으로 스무딩 (fda 패키지)</li>
</ul></li>
</ul>
</section>
<section id="탐색적-함수형-데이터-분석" class="level3" data-number="1.1.2">
<h3 data-number="1.1.2" class="anchored" data-anchor-id="탐색적-함수형-데이터-분석"><span class="header-section-number">1.1.2</span> 탐색적 함수형 데이터 분석</h3>
<ul>
<li>2025-11-20, <a href="../2025-11-20_fda_mean_variance/index.qmd">함수형 평균과 분산</a>
<ul>
<li>점별(pointwise) 평균 함수: <img src="https://latex.codecogs.com/png.latex?%5Cbar%7BX%7D(t)%20=%20E%5BX(t)%5D"></li>
<li>공분산 함수: <img src="https://latex.codecogs.com/png.latex?Cov(X(s),%20X(t))"></li>
<li>실습: 100개 RT-PCR 곡선의 평균 곡선 및 공분산 히트맵</li>
</ul></li>
<li>2025-11-21, <a href="../2025-11-21_functional_boxplot/index.qmd">함수형 박스플롯과 이상치 탐지</a>
<ul>
<li>함수적 깊이(Functional Depth): Band Depth, Modified Band Depth</li>
<li>Sun &amp; Genton (2011) 방법론</li>
<li>실습: RT-PCR 곡선 중 이상치 자동 탐지</li>
</ul></li>
</ul>
</section>
<section id="주간-프로젝트-6시간" class="level3" data-number="1.1.3">
<h3 data-number="1.1.3" class="anchored" data-anchor-id="주간-프로젝트-6시간"><span class="header-section-number">1.1.3</span> 주간 프로젝트 (6시간)</h3>
<ul>
<li>2025-11-22~23, <a href="../2025-11-23_week1_project/index.qmd">RT-PCR 데이터 탐색적 분석 리포트</a>
<ul>
<li>실제 RT-PCR 데이터셋 로드 및 전처리</li>
<li>스무딩 파라미터 선택 (GCV, Cross-validation)</li>
<li>평균 곡선, 신뢰 밴드, 이상치 시각화</li>
<li>정상 vs 비정상 곡선 육안 비교</li>
</ul></li>
</ul>
<p><strong>핵심 참고문헌:</strong> - Ramsay &amp; Silverman (2005), <em>Functional Data Analysis</em>, Chapter 1-3 - <code>fda</code> R 패키지 튜토리얼</p>
</section>
</section>
<section id="week-2-함수형-회귀-분석-기초-14시간" class="level2" data-number="1.2">
<h2 data-number="1.2" class="anchored" data-anchor-id="week-2-함수형-회귀-분석-기초-14시간"><span class="header-section-number">1.2</span> Week 2: 함수형 회귀 분석 기초 (14시간)</h2>
<section id="함수-스칼라-회귀" class="level3" data-number="1.2.1">
<h3 data-number="1.2.1" class="anchored" data-anchor-id="함수-스칼라-회귀"><span class="header-section-number">1.2.1</span> 함수-스칼라 회귀</h3>
<ul>
<li>2025-11-25, <a href="../2025-11-25_functional_regression/index.qmd">Functional Linear Model 이론</a>
<ul>
<li>스칼라 반응 변수, 함수 예측 변수: <img src="https://latex.codecogs.com/png.latex?Y%20=%20%5Cint%20X(t)%5Cbeta(t)dt%20+%20%5Cepsilon"></li>
<li>회귀 계수 함수 <img src="https://latex.codecogs.com/png.latex?%5Cbeta(t)">의 추정</li>
<li>실습: RT-PCR 곡선으로 초기 농도(log scale) 예측</li>
</ul></li>
<li>2025-11-26, <a href="../2025-11-26_coeff_interpretation/index.qmd">회귀 계수 함수의 해석</a>
<ul>
<li><img src="https://latex.codecogs.com/png.latex?%5Cbeta(t)">의 의미: 어느 사이클이 정량에 중요한가?</li>
<li>신뢰 구간 및 유의성 검정</li>
<li>실습: 증폭 효율이 다른 그룹 간 <img src="https://latex.codecogs.com/png.latex?%5Cbeta(t)"> 비교</li>
</ul></li>
</ul>
</section>
<section id="스칼라-함수-회귀-및-함수-함수-회귀" class="level3" data-number="1.2.2">
<h3 data-number="1.2.2" class="anchored" data-anchor-id="스칼라-함수-회귀-및-함수-함수-회귀"><span class="header-section-number">1.2.2</span> 스칼라-함수 회귀 및 함수-함수 회귀</h3>
<ul>
<li>2025-11-27, <a href="../2025-11-27_scalar_on_function/index.qmd">Scalar-on-Function Regression</a>
<ul>
<li>예측 변수는 스칼라, 반응 변수는 함수</li>
<li>실습: 초기 농도 → 예상 증폭 곡선 생성</li>
</ul></li>
<li>2025-11-28, <a href="../2025-11-28_function_on_function/index.qmd">Function-on-Function Regression 소개</a>
<ul>
<li>두 함수 간 관계 모델링</li>
<li>실습: 채널 1 곡선 → 채널 2 곡선 예측 (멀티플렉스)</li>
</ul></li>
</ul>
</section>
<section id="주간-프로젝트-6시간-1" class="level3" data-number="1.2.3">
<h3 data-number="1.2.3" class="anchored" data-anchor-id="주간-프로젝트-6시간-1"><span class="header-section-number">1.2.3</span> 주간 프로젝트 (6시간)</h3>
<ul>
<li>2025-11-29~30, <a href="../2025-11-30_week2_project/index.qmd">증폭 효율 프로파일링 파일럿</a>
<ul>
<li>RT-PCR 곡선 → 초기 농도 회귀 모델 구축</li>
<li>기존 <img src="https://latex.codecogs.com/png.latex?C_T"> 기반 선형 회귀와 성능 비교 (<img src="https://latex.codecogs.com/png.latex?R%5E2">, RMSE)</li>
<li><img src="https://latex.codecogs.com/png.latex?%5Cbeta(t)"> 시각화 및 해석: 어느 사이클이 중요한가?</li>
</ul></li>
</ul>
<p><strong>핵심 참고문헌:</strong> - Reiss et al.&nbsp;(2017), <em>Methods for Scalar-on-Function Regression</em> - <code>refund</code> R 패키지 (Regression with Functional Data)</p>
</section>
</section>
<section id="week-3-곡선-정렬-curve-registration-14시간" class="level2" data-number="1.3">
<h2 data-number="1.3" class="anchored" data-anchor-id="week-3-곡선-정렬-curve-registration-14시간"><span class="header-section-number">1.3</span> Week 3: 곡선 정렬 (Curve Registration) (14시간)</h2>
<section id="registration의-필요성과-개념" class="level3" data-number="1.3.1">
<h3 data-number="1.3.1" class="anchored" data-anchor-id="registration의-필요성과-개념"><span class="header-section-number">1.3.1</span> Registration의 필요성과 개념</h3>
<ul>
<li>2025-12-02, <a href="../2025-12-02_phase_amplitude/index.qmd">Phase Variation vs Amplitude Variation</a>
<ul>
<li>왜 곡선을 정렬해야 하는가?</li>
<li>RT-PCR에서의 의미: 증폭 시작 시점 차이 vs 증폭량 차이</li>
<li>실습: 인위적으로 shift된 곡선의 평균 문제 시연</li>
</ul></li>
<li>2025-12-03, <a href="../2025-12-03_landmark_registration/index.qmd">Landmark Registration</a>
<ul>
<li>특징점 기반 정렬 (예: inflection point, maximum derivative)</li>
<li>시간 왜곡 함수(Time Warping Function) <img src="https://latex.codecogs.com/png.latex?h(t)"></li>
<li>실습: RT-PCR 곡선의 변곡점을 정렬</li>
</ul></li>
</ul>
</section>
<section id="continuous-registration" class="level3" data-number="1.3.2">
<h3 data-number="1.3.2" class="anchored" data-anchor-id="continuous-registration"><span class="header-section-number">1.3.2</span> Continuous Registration</h3>
<ul>
<li>2025-12-04, <a href="../2025-12-04_continuous_registration/index.qmd">Continuous Registration 이론</a>
<ul>
<li>Fisher-Rao metric, Square-Root Velocity Function (SRVF)</li>
<li>최적 정렬 문제: <img src="https://latex.codecogs.com/png.latex?%5Cmin%20%5Cint%20%5BX_i(h_i(t))%20-%20%5Cmu(t)%5D%5E2%20dt"></li>
<li>실습: <code>fdasrvf</code> 패키지로 자동 정렬</li>
</ul></li>
<li>2025-12-05, <a href="../2025-12-05_post_registration/index.qmd">Registration 후 분석 전략</a>
<ul>
<li>정렬된 곡선의 평균 vs 원본 곡선의 평균</li>
<li>Phase variation과 Amplitude variation 분리 분석</li>
<li>실습: 복제 실험 곡선 정렬 후 통합</li>
</ul></li>
</ul>
</section>
<section id="주간-프로젝트-6시간-2" class="level3" data-number="1.3.3">
<h3 data-number="1.3.3" class="anchored" data-anchor-id="주간-프로젝트-6시간-2"><span class="header-section-number">1.3.3</span> 주간 프로젝트 (6시간)</h3>
<ul>
<li>2025-12-06~07, <a href="../2025-12-07_week3_project/index.qmd">기술적 복제 곡선 통합 프로젝트</a>
<ul>
<li>3-5개 복제 RT-PCR 곡선 정렬</li>
<li>Phase variation (피펫팅 오차) vs Amplitude variation (억제제) 정량화</li>
<li>정렬 전/후 <img src="https://latex.codecogs.com/png.latex?C_T"> 표준편차 비교</li>
</ul></li>
</ul>
<p><strong>핵심 참고문헌:</strong> - Marron et al.&nbsp;(2015), <em>Functional Data Analysis of Amplitude and Phase Variation</em> - Tucker et al.&nbsp;(2013), <em>Generative Models for Functional Data using Phase and Amplitude Separation</em></p>
</section>
</section>
<section id="week-4-함수-주성분-분석-fpca-기초-14시간" class="level2" data-number="1.4">
<h2 data-number="1.4" class="anchored" data-anchor-id="week-4-함수-주성분-분석-fpca-기초-14시간"><span class="header-section-number">1.4</span> Week 4: 함수 주성분 분석 (FPCA) 기초 (14시간)</h2>
<section id="fpca-이론" class="level3" data-number="1.4.1">
<h3 data-number="1.4.1" class="anchored" data-anchor-id="fpca-이론"><span class="header-section-number">1.4.1</span> FPCA 이론</h3>
<ul>
<li>2025-12-09, <a href="../2025-12-09_fpca_theory/index.qmd">FPCA의 수학적 기초</a>
<ul>
<li>Karhunen-Loève 전개: <img src="https://latex.codecogs.com/png.latex?X(t)%20=%20%5Cmu(t)%20+%20%5Csum_%7Bk=1%7D%5E%7B%5Cinfty%7D%20%5Cxi_k%20%5Cphi_k(t)"></li>
<li>고유함수 <img src="https://latex.codecogs.com/png.latex?%5Cphi_k(t)">와 주성분 점수 <img src="https://latex.codecogs.com/png.latex?%5Cxi_k"></li>
<li>분산 설명률: <img src="https://latex.codecogs.com/png.latex?%5Clambda_k%20/%20%5Csum%20%5Clambda_k"></li>
<li>실습: 장난감 데이터로 FPCA 직관 이해</li>
</ul></li>
<li>2025-12-10, <a href="../2025-12-10_fpca_computation/index.qmd">FPCA 계산 방법</a>
<ul>
<li>공분산 연산자의 고유값 분해</li>
<li>수치적 구현: <code>pca.fd()</code> 함수</li>
<li>실습: RT-PCR 곡선에 FPCA 적용, scree plot</li>
</ul></li>
</ul>
</section>
<section id="fpca-해석-및-활용" class="level3" data-number="1.4.2">
<h3 data-number="1.4.2" class="anchored" data-anchor-id="fpca-해석-및-활용"><span class="header-section-number">1.4.2</span> FPCA 해석 및 활용</h3>
<ul>
<li>2025-12-11, <a href="../2025-12-11_fpca_interpretation/index.qmd">주성분의 해석</a>
<ul>
<li>PC1: 전체 증폭 수준</li>
<li>PC2: 증폭 속도</li>
<li>PC3: 후기 플래토 형태</li>
<li>실습: 각 PC에 <img src="https://latex.codecogs.com/png.latex?%5Cpm%202%5Csigma"> 변동 시각화</li>
</ul></li>
<li>2025-12-12, <a href="../2025-12-12_fpca_classification/index.qmd">FPCA 기반 분류 및 회귀</a>
<ul>
<li>주성분 점수를 특징으로 사용: <img src="https://latex.codecogs.com/png.latex?%5Cxi_1,%20%5Cxi_2,%20...,%20%5Cxi_K"></li>
<li>Logistic regression, Random Forest 결합</li>
<li>실습: 정상/비정상 RT-PCR 곡선 분류</li>
</ul></li>
</ul>
</section>
<section id="주간-프로젝트-6시간-3" class="level3" data-number="1.4.3">
<h3 data-number="1.4.3" class="anchored" data-anchor-id="주간-프로젝트-6시간-3"><span class="header-section-number">1.4.3</span> 주간 프로젝트 (6시간)</h3>
<ul>
<li>2025-12-13~14, <a href="../2025-12-14_week4_project/index.qmd">RT-PCR 곡선 자동 분류 시스템</a>
<ul>
<li>300개 곡선 (정상 200, 비정상 100)에 FPCA 적용</li>
<li>상위 3-5개 PC 점수로 분류 모델 학습</li>
<li>ROC curve, Confusion matrix로 성능 평가</li>
<li>어떤 PC가 정상/비정상 구분에 기여하는지 해석</li>
</ul></li>
</ul>
<p><strong>핵심 참고문헌:</strong> - Ramsay &amp; Silverman (2005), Chapter 7-8 - Yao et al.&nbsp;(2005), <em>Functional Data Analysis for Sparse Longitudinal Data</em></p>
</section>
</section>
</section>
<section id="month-2-핵심-방법론-심화" class="level1" data-number="2">
<h1 data-number="2"><span class="header-section-number">2</span> Month 2: 핵심 방법론 심화</h1>
<section id="week-5-다변량-fpca-및-공통-주성분-14시간" class="level2" data-number="2.1">
<h2 data-number="2.1" class="anchored" data-anchor-id="week-5-다변량-fpca-및-공통-주성분-14시간"><span class="header-section-number">2.1</span> Week 5: 다변량 FPCA 및 공통 주성분 (14시간)</h2>
<section id="다변량-함수형-데이터" class="level3" data-number="2.1.1">
<h3 data-number="2.1.1" class="anchored" data-anchor-id="다변량-함수형-데이터"><span class="header-section-number">2.1.1</span> 다변량 함수형 데이터</h3>
<ul>
<li>2025-12-16, <a href="../2025-12-16_multivariate_fda/index.qmd">Multivariate Functional Data 개념</a>
<ul>
<li><img src="https://latex.codecogs.com/png.latex?p">개 채널의 동시 관측: <img src="https://latex.codecogs.com/png.latex?%5Cmathbf%7BX%7D(t)%20=%20%5BX_1(t),%20...,%20X_p(t)%5D%5ET"></li>
<li>RT-PCR 멀티플렉스: 5개 파장대 곡선</li>
<li>실습: 2채널 동시 시각화</li>
</ul></li>
<li>2025-12-17, <a href="../2025-12-17_mfpca/index.qmd">Multivariate FPCA (MFPCA)</a>
<ul>
<li>교차 공분산 함수: <img src="https://latex.codecogs.com/png.latex?Cov(X_i(s),%20X_j(t))"></li>
<li>공통 고유함수와 채널별 로딩</li>
<li>실습: <code>MFPCA</code> 패키지 사용</li>
</ul></li>
</ul>
</section>
<section id="형광-간섭-분석-응용" class="level3" data-number="2.1.2">
<h3 data-number="2.1.2" class="anchored" data-anchor-id="형광-간섭-분석-응용"><span class="header-section-number">2.1.2</span> 형광 간섭 분석 응용</h3>
<ul>
<li>2025-12-18, <a href="../2025-12-18_interference_mfpca/index.qmd">간섭 패턴의 MFPCA 분해</a>
<ul>
<li>공통 변동(간섭) vs 개별 변동(생물학적 신호)</li>
<li>실습: 5채널 RT-PCR 데이터에 MFPCA 적용</li>
</ul></li>
<li>2025-12-19, <a href="../2025-12-19_signal_deconvolution/index.qmd">신호 디컨볼루션 구현</a>
<ul>
<li>간섭 제거 알고리즘 설계</li>
<li>실습: 보정 전/후 SNR 비교</li>
</ul></li>
</ul>
</section>
<section id="주간-프로젝트-6시간-4" class="level3" data-number="2.1.3">
<h3 data-number="2.1.3" class="anchored" data-anchor-id="주간-프로젝트-6시간-4"><span class="header-section-number">2.1.3</span> 주간 프로젝트 (6시간)</h3>
<ul>
<li>2025-12-20~21, <a href="../2025-12-21_week5_project/index.qmd">멀티플렉스 간섭 제거 파일럿</a>
<ul>
<li>실제 5-plex RT-PCR 데이터 준비</li>
<li>MFPCA로 간섭 패턴 추출 및 제거</li>
<li>단일 채널 “순수” 신호와 비교 검증</li>
</ul></li>
</ul>
<p><strong>핵심 참고문헌:</strong> - Happ &amp; Greven (2018), <em>Multivariate Functional Principal Component Analysis</em> - Kayano &amp; Konishi (2009), <em>Sparse Functional Principal Component Analysis</em></p>
</section>
</section>
<section id="week-6-함수형-회귀-심화-및-변수-선택-14시간" class="level2" data-number="2.2">
<h2 data-number="2.2" class="anchored" data-anchor-id="week-6-함수형-회귀-심화-및-변수-선택-14시간"><span class="header-section-number">2.2</span> Week 6: 함수형 회귀 심화 및 변수 선택 (14시간)</h2>
<section id="정규화-및-변수-선택" class="level3" data-number="2.2.1">
<h3 data-number="2.2.1" class="anchored" data-anchor-id="정규화-및-변수-선택"><span class="header-section-number">2.2.1</span> 정규화 및 변수 선택</h3>
<ul>
<li>2025-12-23, <a href="../2025-12-23_penalized_regression/index.qmd">Ridge &amp; Lasso for Functional Regression</a>
<ul>
<li><img src="https://latex.codecogs.com/png.latex?L_2"> 페널티: Ridge regression</li>
<li><img src="https://latex.codecogs.com/png.latex?L_1"> 페널티: Lasso, 희소성(Sparsity) 유도</li>
<li>실습: 어느 사이클이 정량에 중요한지 자동 선택</li>
</ul></li>
<li>2025-12-24, <a href="../2025-12-24_group_lasso/index.qmd">Group Lasso for Functional Data</a>
<ul>
<li>기저 함수 계수를 그룹으로 페널티</li>
<li>실습: <code>refund</code> 패키지의 <code>pfr()</code> 함수</li>
</ul></li>
</ul>
</section>
<section id="비선형-함수-회귀" class="level3" data-number="2.2.2">
<h3 data-number="2.2.2" class="anchored" data-anchor-id="비선형-함수-회귀"><span class="header-section-number">2.2.2</span> 비선형 함수 회귀</h3>
<ul>
<li>2025-12-26, <a href="../2025-12-26_fgam/index.qmd">Functional Generalized Additive Models (FGAM)</a>
<ul>
<li>비선형 함수-스칼라 관계</li>
<li>Smooth 함수의 합: <img src="https://latex.codecogs.com/png.latex?Y%20=%20%5Csum_j%20s_j(%5Cint%20X(t)%5Cbeta_j(t)dt)"></li>
<li>실습: RT-PCR 곡선의 비선형 효과 모델링</li>
</ul></li>
<li>2025-12-27, <a href="../2025-12-27_functional_rf/index.qmd">Functional Random Forest</a>
<ul>
<li>FPCA 점수를 특징으로 Random Forest 학습</li>
<li>변수 중요도: 어느 PC가 가장 중요한가?</li>
<li>실습: <code>randomForest</code> + FPCA 결합</li>
</ul></li>
</ul>
</section>
<section id="주간-프로젝트-6시간-5" class="level3" data-number="2.2.3">
<h3 data-number="2.2.3" class="anchored" data-anchor-id="주간-프로젝트-6시간-5"><span class="header-section-number">2.2.3</span> 주간 프로젝트 (6시간)</h3>
<ul>
<li>2025-12-28~29, <a href="../2025-12-29_week6_project/index.qmd">증폭 효율 예측 모델 고도화</a>
<ul>
<li>비선형 효과 고려한 함수 회귀</li>
<li>변수 선택으로 핵심 사이클 구간 식별</li>
<li>교차 검증으로 일반화 성능 평가</li>
</ul></li>
</ul>
<p><strong>핵심 참고문헌:</strong> - Goldsmith et al.&nbsp;(2011), <em>Penalized Functional Regression</em> - Scheipl et al.&nbsp;(2015), <em>Functional Additive Mixed Models</em></p>
</section>
</section>
<section id="week-7-함수형-시계열-및-동적-예측-14시간" class="level2" data-number="2.3">
<h2 data-number="2.3" class="anchored" data-anchor-id="week-7-함수형-시계열-및-동적-예측-14시간"><span class="header-section-number">2.3</span> Week 7: 함수형 시계열 및 동적 예측 (14시간)</h2>
<section id="함수형-시계열-분석" class="level3" data-number="2.3.1">
<h3 data-number="2.3.1" class="anchored" data-anchor-id="함수형-시계열-분석"><span class="header-section-number">2.3.1</span> 함수형 시계열 분석</h3>
<ul>
<li>2025-12-30, <a href="../2025-12-30_functional_time_series/index.qmd">Functional Time Series 개념</a>
<ul>
<li>함수의 시간적 의존성: <img src="https://latex.codecogs.com/png.latex?X_t(s)"></li>
<li>RT-PCR 응용: 사이클 진행 중 실시간 예측</li>
<li>실습: 부분 곡선 시각화</li>
</ul></li>
<li>2025-12-31, <a href="../2025-12-31_far_model/index.qmd">Functional Autoregression (FAR)</a>
<ul>
<li>FAR(1) 모델: <img src="https://latex.codecogs.com/png.latex?X_t(s)%20=%20%5Cint%20%5CPsi(s,u)X_%7Bt-1%7D(u)du%20+%20%5Cepsilon_t(s)"></li>
<li>실습: 사이클 1-20 → 사이클 21-45 예측</li>
</ul></li>
</ul>
</section>
<section id="실시간-모니터링-응용" class="level3" data-number="2.3.2">
<h3 data-number="2.3.2" class="anchored" data-anchor-id="실시간-모니터링-응용"><span class="header-section-number">2.3.2</span> 실시간 모니터링 응용</h3>
<ul>
<li>2026-01-02, <a href="../2026-01-02_dynamic_fpca/index.qmd">동적 함수 주성분 분석</a>
<ul>
<li>사이클이 진행됨에 따라 업데이트되는 FPCA</li>
<li>온라인 이상치 탐지</li>
<li>실습: 사이클 15, 20, 25에서의 PC 점수 추적</li>
</ul></li>
<li>2026-01-03, <a href="../2026-01-03_early_prediction/index.qmd">조기 실패 예측 알고리즘</a>
<ul>
<li>부분 곡선으로 최종 성공/실패 예측</li>
<li>Logistic regression with partial functional predictors</li>
<li>실습: 사이클 20에서 최종 결과 예측 정확도</li>
</ul></li>
</ul>
</section>
<section id="주간-프로젝트-6시간-6" class="level3" data-number="2.3.3">
<h3 data-number="2.3.3" class="anchored" data-anchor-id="주간-프로젝트-6시간-6"><span class="header-section-number">2.3.3</span> 주간 프로젝트 (6시간)</h3>
<ul>
<li>2026-01-04~05, <a href="../2026-01-05_week7_project/index.qmd">실시간 품질 모니터링 시스템 프로토타입</a>
<ul>
<li>사이클 15, 20, 25에서 성공 확률 계산</li>
<li>정상 경로 이탈 감지 알고리즘</li>
<li>실시간 대시보드 시각화 (Shiny app)</li>
</ul></li>
</ul>
<p><strong>핵심 참고문헌:</strong> - Hörmann &amp; Kokoszka (2010), <em>Weakly Dependent Functional Data</em> - Aue et al.&nbsp;(2015), <em>Prediction in Functional Linear Regression</em></p>
</section>
</section>
<section id="week-8-함수형-anova-및-검정-14시간" class="level2" data-number="2.4">
<h2 data-number="2.4" class="anchored" data-anchor-id="week-8-함수형-anova-및-검정-14시간"><span class="header-section-number">2.4</span> Week 8: 함수형 ANOVA 및 검정 (14시간)</h2>
<section id="함수형-데이터의-검정" class="level3" data-number="2.4.1">
<h3 data-number="2.4.1" class="anchored" data-anchor-id="함수형-데이터의-검정"><span class="header-section-number">2.4.1</span> 함수형 데이터의 검정</h3>
<ul>
<li>2026-01-06, <a href="../2026-01-06_functional_testing/index.qmd">Pointwise vs Global Testing</a>
<ul>
<li>점별 검정의 다중 비교 문제</li>
<li>전역(Global) 검정: 곡선 전체가 다른가?</li>
<li>실습: 두 그룹 RT-PCR 곡선 비교</li>
</ul></li>
<li>2026-01-07, <a href="../2026-01-07_functional_anova/index.qmd">Functional ANOVA</a>
<ul>
<li><img src="https://latex.codecogs.com/png.latex?F">-통계량의 함수형 확장</li>
<li>Permutation test for functional data</li>
<li>실습: 억제제 유/무 그룹 간 곡선 차이 검정</li>
</ul></li>
</ul>
</section>
<section id="비모수적-검정" class="level3" data-number="2.4.2">
<h3 data-number="2.4.2" class="anchored" data-anchor-id="비모수적-검정"><span class="header-section-number">2.4.2</span> 비모수적 검정</h3>
<ul>
<li>2026-01-09, <a href="../2026-01-09_functional_bootstrap/index.qmd">Bootstrap for Functional Data</a>
<ul>
<li>함수형 데이터의 resampling</li>
<li>신뢰 구간 및 검정 통계량 추정</li>
<li>실습: 평균 함수의 bootstrap 신뢰 밴드</li>
</ul></li>
<li>2026-01-10, <a href="../2026-01-10_two_sample_test/index.qmd">Two-Sample Tests</a>
<ul>
<li>Hotelling’s <img src="https://latex.codecogs.com/png.latex?T%5E2"> 검정의 함수형 버전</li>
<li>L2 distance 기반 검정</li>
<li>실습: 정상 vs 억제 샘플 곡선 비교</li>
</ul></li>
</ul>
</section>
<section id="주간-프로젝트-6시간-7" class="level3" data-number="2.4.3">
<h3 data-number="2.4.3" class="anchored" data-anchor-id="주간-프로젝트-6시간-7"><span class="header-section-number">2.4.3</span> 주간 프로젝트 (6시간)</h3>
<ul>
<li>2026-01-11~12, <a href="../2026-01-12_week8_project/index.qmd">억제제 영향 정량화 연구</a>
<ul>
<li>다양한 억제제 농도별 RT-PCR 곡선 수집</li>
<li>Functional ANOVA로 농도 효과 검정</li>
<li>억제 패턴의 시각적 특성 추출 및 라이브러리 구축</li>
</ul></li>
</ul>
<p><strong>핵심 참고문헌:</strong> - Zhang (2013), <em>Hypothesis Testing in Functional Linear Models</em> - Cuevas et al.&nbsp;(2004), <em>An ANOVA Test for Functional Data</em></p>
</section>
</section>
</section>
<section id="month-3-고급-주제-및-응용-프로젝트" class="level1" data-number="3">
<h1 data-number="3"><span class="header-section-number">3</span> Month 3: 고급 주제 및 응용 프로젝트</h1>
<section id="week-9-고급-fpca-및-희소-함수형-데이터-14시간" class="level2" data-number="3.1">
<h2 data-number="3.1" class="anchored" data-anchor-id="week-9-고급-fpca-및-희소-함수형-데이터-14시간"><span class="header-section-number">3.1</span> Week 9: 고급 FPCA 및 희소 함수형 데이터 (14시간)</h2>
<section id="sparse-functional-data" class="level3" data-number="3.1.1">
<h3 data-number="3.1.1" class="anchored" data-anchor-id="sparse-functional-data"><span class="header-section-number">3.1.1</span> Sparse Functional Data</h3>
<ul>
<li>2026-01-13, <a href="../2026-01-13_sparse_fda/index.qmd">Sparse &amp; Irregular Observations</a>
<ul>
<li>모든 시점에서 관측되지 않은 경우</li>
<li>PACE (Principal Analysis by Conditional Expectation) 방법</li>
<li>실습: <code>fdapace</code> 패키지 사용</li>
</ul></li>
<li>2026-01-14, <a href="../2026-01-14_sparse_fpca_app/index.qmd">Sparse FPCA Applications</a>
<ul>
<li>RT-PCR 결측 사이클 처리</li>
<li>실습: 일부 사이클 누락된 곡선 복원</li>
</ul></li>
</ul>
</section>
<section id="함수형-군집-분석" class="level3" data-number="3.1.2">
<h3 data-number="3.1.2" class="anchored" data-anchor-id="함수형-군집-분석"><span class="header-section-number">3.1.2</span> 함수형 군집 분석</h3>
<ul>
<li>2026-01-16, <a href="../2026-01-16_functional_kmeans/index.qmd">Functional K-means Clustering</a>
<ul>
<li><img src="https://latex.codecogs.com/png.latex?L_2"> 거리 기반 군집화</li>
<li>실습: RT-PCR 곡선 패턴별 자동 그룹화</li>
</ul></li>
<li>2026-01-17, <a href="../2026-01-17_model_based_clustering/index.qmd">Model-based Functional Clustering</a>
<ul>
<li>Functional mixture models</li>
<li>실습: <code>funHDDC</code> 패키지로 곡선 유형 분류</li>
</ul></li>
</ul>
</section>
<section id="주간-프로젝트-6시간-8" class="level3" data-number="3.1.3">
<h3 data-number="3.1.3" class="anchored" data-anchor-id="주간-프로젝트-6시간-8"><span class="header-section-number">3.1.3</span> 주간 프로젝트 (6시간)</h3>
<ul>
<li>2026-01-18~19, <a href="../2026-01-19_week9_project/index.qmd">비정형 곡선 자동 분류 시스템</a>
<ul>
<li>500개 RT-PCR 곡선 (정상, 지연, 플랫, 이중 증폭 등)</li>
<li>비지도 학습으로 자연스러운 그룹 발견</li>
<li>각 클러스터의 특성 해석 및 라벨링</li>
</ul></li>
</ul>
<p><strong>핵심 참고문헌:</strong> - Yao et al.&nbsp;(2005), <em>Functional Data Analysis for Sparse Longitudinal Data</em> - Jacques &amp; Preda (2014), <em>Model-based Clustering for Multivariate Functional Data</em></p>
</section>
</section>
<section id="week-10-딥러닝과-fda-결합-선택적-14시간" class="level2" data-number="3.2">
<h2 data-number="3.2" class="anchored" data-anchor-id="week-10-딥러닝과-fda-결합-선택적-14시간"><span class="header-section-number">3.2</span> Week 10: 딥러닝과 FDA 결합 (선택적) (14시간)</h2>
<section id="functional-neural-networks" class="level3" data-number="3.2.1">
<h3 data-number="3.2.1" class="anchored" data-anchor-id="functional-neural-networks"><span class="header-section-number">3.2.1</span> Functional Neural Networks</h3>
<ul>
<li>2026-01-20, <a href="../2026-01-20_functional_nn/index.qmd">Neural Networks for Functional Data</a>
<ul>
<li>CNN의 함수형 데이터 적용</li>
<li>1D convolution for RT-PCR curves</li>
<li>실습: Keras로 곡선 분류기 구축</li>
</ul></li>
<li>2026-01-21, <a href="../2026-01-21_functional_autoencoder/index.qmd">Functional Autoencoders</a>
<ul>
<li>비선형 차원 축소</li>
<li>FPCA vs Autoencoder 비교</li>
<li>실습: PyTorch로 RT-PCR 곡선 인코더</li>
</ul></li>
</ul>
</section>
<section id="대안-베이지안-fda-딥러닝-대신-선택-가능" class="level3" data-number="3.2.2">
<h3 data-number="3.2.2" class="anchored" data-anchor-id="대안-베이지안-fda-딥러닝-대신-선택-가능"><span class="header-section-number">3.2.2</span> 대안: 베이지안 FDA (딥러닝 대신 선택 가능)</h3>
<ul>
<li>2026-01-20, <a href="../2026-01-20_bayesian_fda/index.qmd">Bayesian Functional Regression</a>
<ul>
<li>계수 함수의 사후 분포</li>
<li>MCMC 샘플링</li>
<li>실습: <code>brms</code> 패키지 활용</li>
</ul></li>
<li>2026-01-21, <a href="../2026-01-21_gp_fda/index.qmd">Gaussian Process for Functional Data</a>
<ul>
<li>GP prior for smooth functions</li>
<li>실습: <code>GPfit</code> 패키지로 RT-PCR 곡선 모델링</li>
</ul></li>
</ul>
</section>
<section id="주간-프로젝트-6시간-9" class="level3" data-number="3.2.3">
<h3 data-number="3.2.3" class="anchored" data-anchor-id="주간-프로젝트-6시간-9"><span class="header-section-number">3.2.3</span> 주간 프로젝트 (6시간)</h3>
<ul>
<li>2026-01-23~24, <a href="../2026-01-24_week10_project/index.qmd">고급 분류 모델 벤치마크</a>
<ul>
<li>FPCA + Logistic vs CNN vs Functional Random Forest</li>
<li>성능, 해석 가능성, 계산 비용 비교</li>
<li>실전 배포 관점에서 최적 방법 선택</li>
</ul></li>
</ul>
<p><strong>핵심 참고문헌:</strong> - Wang et al.&nbsp;(2016), <em>Functional Data Analysis</em> - Rahman et al.&nbsp;(2019), <em>Deep Learning for Time Series Classification</em></p>
</section>
</section>
<section id="week-11-통합-프로젝트-i---증폭-효율-프로파일링-14시간" class="level2" data-number="3.3">
<h2 data-number="3.3" class="anchored" data-anchor-id="week-11-통합-프로젝트-i---증폭-효율-프로파일링-14시간"><span class="header-section-number">3.3</span> Week 11: 통합 프로젝트 I - 증폭 효율 프로파일링 (14시간)</h2>
<section id="프로젝트-설계-및-데이터-수집" class="level3" data-number="3.3.1">
<h3 data-number="3.3.1" class="anchored" data-anchor-id="프로젝트-설계-및-데이터-수집"><span class="header-section-number">3.3.1</span> 프로젝트 설계 및 데이터 수집</h3>
<ul>
<li>2026-01-27, <a href="../2026-01-27_project1_setup/index.qmd">프로젝트 목표 및 데이터 준비</a>
<ul>
<li>연구 질문 정의</li>
<li>최소 500개 다양한 RT-PCR 곡선 수집</li>
<li>데이터 품질 점검 및 전처리</li>
</ul></li>
</ul>
</section>
<section id="분석-파이프라인-구축" class="level3" data-number="3.3.2">
<h3 data-number="3.3.2" class="anchored" data-anchor-id="분석-파이프라인-구축"><span class="header-section-number">3.3.2</span> 분석 파이프라인 구축</h3>
<ul>
<li>2026-01-28~29, <a href="../2026-01-29_efficiency_estimation/index.qmd">증폭 효율 함수 추정</a>
<ul>
<li>사이클별 증폭률 계산 및 스무딩</li>
<li>FPCA로 효율 패턴 분류</li>
<li>효율 보정된 정량 알고리즘 구현</li>
</ul></li>
</ul>
</section>
<section id="성능-평가-및-검증" class="level3" data-number="3.3.3">
<h3 data-number="3.3.3" class="anchored" data-anchor-id="성능-평가-및-검증"><span class="header-section-number">3.3.3</span> 성능 평가 및 검증</h3>
<ul>
<li>2026-01-30~31, <a href="../2026-01-31_comparison/index.qmd">기존 방법과 비교 분석</a>
<ul>
<li><img src="https://latex.codecogs.com/png.latex?C_T"> 기반 vs FDA 기반 정량 정확도</li>
<li>CV (변동계수) 감소율 계산</li>
<li>통계적 유의성 검정</li>
</ul></li>
</ul>
</section>
<section id="결과-정리-및-해석" class="level3" data-number="3.3.4">
<h3 data-number="3.3.4" class="anchored" data-anchor-id="결과-정리-및-해석"><span class="header-section-number">3.3.4</span> 결과 정리 및 해석</h3>
<ul>
<li>2026-02-01~02, <a href="../2026-02-02_project1_report/index.qmd">분석 리포트 작성</a>
<ul>
<li>주요 발견 사항 정리</li>
<li>시각화: 효율 프로파일, 보정 효과</li>
<li>한계점 및 향후 연구 방향</li>
</ul></li>
</ul>
</section>
</section>
<section id="week-12-통합-프로젝트-ii---다중-복제-메타-분석-14시간" class="level2" data-number="3.4">
<h2 data-number="3.4" class="anchored" data-anchor-id="week-12-통합-프로젝트-ii---다중-복제-메타-분석-14시간"><span class="header-section-number">3.4</span> Week 12: 통합 프로젝트 II - 다중 복제 메타 분석 (14시간)</h2>
<section id="프로젝트-설계" class="level3" data-number="3.4.1">
<h3 data-number="3.4.1" class="anchored" data-anchor-id="프로젝트-설계"><span class="header-section-number">3.4.1</span> 프로젝트 설계</h3>
<ul>
<li>2026-02-03, <a href="../2026-02-03_project2_setup/index.qmd">연구 설계 및 데이터 구조</a>
<ul>
<li>기술적 복제 3-5개씩 100개 샘플</li>
<li>복제 품질 평가 메트릭 정의</li>
</ul></li>
</ul>
</section>
<section id="곡선-정렬-및-통합" class="level3" data-number="3.4.2">
<h3 data-number="3.4.2" class="anchored" data-anchor-id="곡선-정렬-및-통합"><span class="header-section-number">3.4.2</span> 곡선 정렬 및 통합</h3>
<ul>
<li>2026-02-04~05, <a href="../2026-02-05_registration_project/index.qmd">Registration 및 변동성 분해</a>
<ul>
<li>Landmark vs Continuous registration 비교</li>
<li>Amplitude vs Phase variation 정량화</li>
<li>통합 대표 곡선 생성</li>
</ul></li>
</ul>
</section>
<section id="품질-스코어-시스템-개발" class="level3" data-number="3.4.3">
<h3 data-number="3.4.3" class="anchored" data-anchor-id="품질-스코어-시스템-개발"><span class="header-section-number">3.4.3</span> 품질 스코어 시스템 개발</h3>
<ul>
<li>2026-02-06~07, <a href="../2026-02-07_quality_score/index.qmd">Replication Quality Score</a>
<ul>
<li>함수적 일치도 측정 알고리즘</li>
<li>0-100점 스코어링 시스템</li>
<li>임계값 설정 (재실험 기준)</li>
</ul></li>
</ul>
</section>
<section id="최종-결과-및-발표-자료" class="level3" data-number="3.4.4">
<h3 data-number="3.4.4" class="anchored" data-anchor-id="최종-결과-및-발표-자료"><span class="header-section-number">3.4.4</span> 최종 결과 및 발표 자료</h3>
<ul>
<li>2026-02-08~09, <a href="../2026-02-09_final_presentation/index.qmd">프로젝트 완성 및 프레젠테이션</a>
<ul>
<li>두 프로젝트 통합 요약</li>
<li>비즈니스 임팩트 정량화</li>
<li>향후 배포 계획 수립</li>
</ul></li>
</ul>
</section>
</section>
</section>
<section id="보충-자료-및-도구" class="level1" data-number="4">
<h1 data-number="4"><span class="header-section-number">4</span> 보충 자료 및 도구</h1>
<section id="필수-소프트웨어-및-패키지" class="level2" data-number="4.1">
<h2 data-number="4.1" class="anchored" data-anchor-id="필수-소프트웨어-및-패키지"><span class="header-section-number">4.1</span> 필수 소프트웨어 및 패키지</h2>
<section id="r-패키지" class="level3" data-number="4.1.1">
<h3 data-number="4.1.1" class="anchored" data-anchor-id="r-패키지"><span class="header-section-number">4.1.1</span> R 패키지</h3>
<ul>
<li><code>fda</code>: 기본 FDA 기능</li>
<li><code>refund</code>: 함수형 회귀</li>
<li><code>fdapace</code>: Sparse functional data</li>
<li><code>fdasrvf</code>: Registration</li>
<li><code>funHDDC</code>: 함수형 군집화</li>
<li><code>MFPCA</code>: 다변량 FPCA</li>
</ul>
</section>
<section id="python-패키지" class="level3" data-number="4.1.2">
<h3 data-number="4.1.2" class="anchored" data-anchor-id="python-패키지"><span class="header-section-number">4.1.2</span> Python 패키지</h3>
<ul>
<li><code>scikit-fda</code>: FDA in Python</li>
<li><code>sktime</code>: 시계열 및 함수형 데이터</li>
<li><code>PyTorch/Keras</code>: 딥러닝 (선택적)</li>
</ul>
</section>
</section>
<section id="핵심-참고-도서" class="level2" data-number="4.2">
<h2 data-number="4.2" class="anchored" data-anchor-id="핵심-참고-도서"><span class="header-section-number">4.2</span> 핵심 참고 도서</h2>
<ol type="1">
<li><strong>Ramsay &amp; Silverman (2005)</strong>, <em>Functional Data Analysis (2nd ed.)</em>
<ul>
<li>FDA의 바이블, 이론과 응용 모두 포괄</li>
</ul></li>
<li><strong>Kokoszka &amp; Reimherr (2017)</strong>, <em>Introduction to Functional Data Analysis</em>
<ul>
<li>현대적 관점, 실습 중심</li>
</ul></li>
<li><strong>Hsing &amp; Eubank (2015)</strong>, <em>Theoretical Foundations of Functional Data Analysis</em>
<ul>
<li>수학적 엄밀성 (선택적 심화)</li>
</ul></li>
</ol>
</section>
<section id="온라인-자료" class="level2" data-number="4.3">
<h2 data-number="4.3" class="anchored" data-anchor-id="온라인-자료"><span class="header-section-number">4.3</span> 온라인 자료</h2>
<ul>
<li><a href="https://www.psych.mcgill.ca/misc/fda/">FDA with R Tutorial</a></li>
<li><a href="https://www.coursera.org/learn/functional-data-analysis">Coursera: Functional Data Analysis</a></li>
<li><a href="https://github.com/functionaldata">GitHub: FDA Examples</a></li>
</ul>
</section>
</section>
<section id="학습-점검-체크리스트" class="level1" data-number="5">
<h1 data-number="5"><span class="header-section-number">5</span> 학습 점검 체크리스트</h1>
<section id="month-1-종료-시점" class="level2" data-number="5.1">
<h2 data-number="5.1" class="anchored" data-anchor-id="month-1-종료-시점"><span class="header-section-number">5.1</span> Month 1 종료 시점</h2>
<ul class="task-list">
<li><label><input type="checkbox">RT-PCR 곡선을 B-spline으로 스무딩할 수 있다</label></li>
<li><label><input type="checkbox">함수적 평균, 공분산을 계산하고 시각화할 수 있다</label></li>
<li><label><input type="checkbox">FPCA를 수행하고 주성분을 해석할 수 있다</label></li>
<li><label><input type="checkbox">곡선을 정렬(registration)하고 그 효과를 설명할 수 있다</label></li>
</ul>
</section>
<section id="month-2-종료-시점" class="level2" data-number="5.2">
<h2 data-number="5.2" class="anchored" data-anchor-id="month-2-종료-시점"><span class="header-section-number">5.2</span> Month 2 종료 시점</h2>
<ul class="task-list">
<li><label><input type="checkbox">함수-스칼라 회귀 모델을 구축하고 <img src="https://latex.codecogs.com/png.latex?%5Cbeta(t)">를 해석할 수 있다</label></li>
<li><label><input type="checkbox">다변량 FPCA로 멀티플렉스 데이터를 분석할 수 있다</label></li>
<li><label><input type="checkbox">부분 곡선으로 최종 결과를 예측할 수 있다</label></li>
<li><label><input type="checkbox">Functional ANOVA로 그룹 간 차이를 검정할 수 있다</label></li>
</ul>
</section>
<section id="month-3-종료-시점" class="level2" data-number="5.3">
<h2 data-number="5.3" class="anchored" data-anchor-id="month-3-종료-시점"><span class="header-section-number">5.3</span> Month 3 종료 시점</h2>
<ul class="task-list">
<li><label><input type="checkbox">증폭 효율 프로파일링 파이프라인을 구축했다</label></li>
<li><label><input type="checkbox">다중 복제 메타 분석 시스템을 개발했다</label></li>
<li><label><input type="checkbox">기존 방법 대비 정량적 개선을 입증했다</label></li>
<li><label><input type="checkbox">FDA 지식을 실제 RT-PCR 문제에 적용할 수 있다</label></li>
</ul>
</section>
</section>
<section id="성공을-위한-tips" class="level1" data-number="6">
<h1 data-number="6"><span class="header-section-number">6</span> 성공을 위한 Tips</h1>
<section id="이론과-실습의-균형" class="level2" data-number="6.1">
<h2 data-number="6.1" class="anchored" data-anchor-id="이론과-실습의-균형"><span class="header-section-number">6.1</span> 이론과 실습의 균형</h2>
<ul>
<li>매일 1시간 이론 학습 → 1시간 코딩 실습</li>
<li>이론만 보지 말고 <strong>반드시 손으로 구현</strong></li>
</ul>
</section>
<section id="점진적-난이도-상승" class="level2" data-number="6.2">
<h2 data-number="6.2" class="anchored" data-anchor-id="점진적-난이도-상승"><span class="header-section-number">6.2</span> 점진적 난이도 상승</h2>
<ul>
<li>처음부터 완벽하게 이해하려 하지 말 것</li>
<li>개념의 80%만 이해하고 다음으로 진행</li>
<li>나중에 돌아와서 깊이 있게 재학습</li>
</ul>
</section>
<section id="실제-데이터-중심" class="level2" data-number="6.3">
<h2 data-number="6.3" class="anchored" data-anchor-id="실제-데이터-중심"><span class="header-section-number">6.3</span> 실제 데이터 중심</h2>
<ul>
<li>가능한 한 빨리 실제 RT-PCR 데이터 확보</li>
<li>모든 이론을 RT-PCR 맥락에서 재해석</li>
<li>“이게 우리 문제에 왜 필요한가?” 항상 자문</li>
</ul>
</section>
<section id="커뮤니티-활용" class="level2" data-number="6.4">
<h2 data-number="6.4" class="anchored" data-anchor-id="커뮤니티-활용"><span class="header-section-number">6.4</span> 커뮤니티 활용</h2>
<ul>
<li>R-help, Cross Validated (Stack Exchange) 적극 활용</li>
<li>FDA 관련 논문의 코드 저장소 탐색</li>
<li>막히면 24시간 이상 혼자 고민하지 말고 질문</li>
</ul>
</section>
<section id="문서화-습관" class="level2" data-number="6.5">
<h2 data-number="6.5" class="anchored" data-anchor-id="문서화-습관"><span class="header-section-number">6.5</span> 문서화 습관</h2>
<ul>
<li>모든 분석을 Quarto/R Markdown으로 기록</li>
<li>나중에 블로그 포스트로 변환 가능</li>
<li>“미래의 나”를 위한 설명 작성</li>
</ul>
<p><strong>3개월 후, 당신은 RT-PCR FDA 전문가가 되어 있을 것입니다!</strong> ```</p>


</section>
</section>

 ]]></description>
  <category>Statistics</category>
  <category>Functional Data Analysis</category>
  <category>Time Series</category>
  <guid>kk3225.netlify.app/docs/blog/posts/Statistics/FDA/</guid>
  <pubDate>Fri, 14 Nov 2025 15:00:00 GMT</pubDate>
</item>
<item>
  <title>Experimentation</title>
  <dc:creator>Kwangmin Kim</dc:creator>
  <link>kk3225.netlify.app/docs/blog/posts/Experimentation/</link>
  <description><![CDATA[ 





<section id="experimentation" class="level1" data-number="1">
<h1 data-number="1"><span class="header-section-number">1</span> Experimentation</h1>
<ul>
<li>실험 설계와 인과추론의 체계적 이해를 위한 구조화된 학습 경로를 제시</li>
<li>Epidemiology 기반 지식을 활용하여 A/B Testing과 Multi-Armed Bandit을 포함한 Experimentation 전반을 학습할 수 있도록 구성</li>
</ul>
<section id="experimentation-하위구조" class="level2" data-number="1.1">
<h2 data-number="1.1" class="anchored" data-anchor-id="experimentation-하위구조"><span class="header-section-number">1.1</span> Experimentation 하위구조</h2>
<ul>
<li>Experimentation
<ul>
<li>Epidemiolog</li>
<li>AB_test</li>
<li>Fundamentals</li>
<li>MAB (Multi-Armed Badit)</li>
<li>Causal_inference</li>
<li>Advanced</li>
<li>Platform</li>
</ul></li>
</ul>
</section>
<section id="learning-path" class="level2" data-number="1.2">
<h2 data-number="1.2" class="anchored" data-anchor-id="learning-path"><span class="header-section-number">1.2</span> Learning Path</h2>
<p>이 학습 경로는 <strong>Epidemiology → Classical A/B Testing → Multi-Armed Bandits → Advanced Methods</strong> 순서로 실험 설계와 인과추론을 체계적으로 학습하도록 설계</p>
<section id="core-concepts-connection-map" class="level3" data-number="1.2.1">
<h3 data-number="1.2.1" class="anchored" data-anchor-id="core-concepts-connection-map"><span class="header-section-number">1.2.1</span> Core Concepts Connection Map</h3>
<pre><code>Epidemiology RCT → A/B Testing → Sequential Testing → Adaptive Testing → MAB
       ↓              ↓                                        ↓
Causal Inference → DAG/SUTVA ────────────────────→ Interference Handling
       ↓              ↓                                        ↓
Effect Measures → Lift/Uplift ──────────────────→ Heterogeneous TE
       ↓
Sample Size → Power Analysis → Sequential Monitoring → Variance Reduction</code></pre>
</section>
<section id="key-mathematical-connections" class="level3" data-number="1.2.2">
<h3 data-number="1.2.2" class="anchored" data-anchor-id="key-mathematical-connections"><span class="header-section-number">1.2.2</span> Key Mathematical Connections</h3>
<table class="caption-top table">
<thead>
<tr class="header">
<th>Epidemiology</th>
<th>Experimentation</th>
<th>수식</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td>Relative Risk</td>
<td>Lift</td>
<td><img src="https://latex.codecogs.com/png.latex?%5Cfrac%7BP(Y=1%7CT=1)%7D%7BP(Y=1%7CT=0)%7D"></td>
</tr>
<tr class="even">
<td>Risk Difference</td>
<td>Absolute Uplift</td>
<td><img src="https://latex.codecogs.com/png.latex?P(Y=1%7CT=1)%20-%20P(Y=1%7CT=0)"></td>
</tr>
<tr class="odd">
<td>NNT</td>
<td>Number to Convert</td>
<td><img src="https://latex.codecogs.com/png.latex?%5Cfrac%7B1%7D%7BRD%7D"></td>
</tr>
<tr class="even">
<td>Effect Modification</td>
<td>HTE</td>
<td><img src="https://latex.codecogs.com/png.latex?E%5BY(1)-Y(0)%7CX%5D"></td>
</tr>
</tbody>
</table>
</section>
<section id="recommended-study-time" class="level3" data-number="1.2.3">
<h3 data-number="1.2.3" class="anchored" data-anchor-id="recommended-study-time"><span class="header-section-number">1.2.3</span> Recommended Study Time</h3>
<pre><code>Phase 1: 1-2개월 (주 10-15시간)
  - Epidemiology: 2-3주
  - Statistics: 1주
  - Classical A/B: 2-3주

Phase 2: 2-3개월 (주 10-15시간)
  - Advanced A/B: 2-3주
  - Causal Inference: 3-4주 ⭐ (가장 중요)
  - MAB Fundamentals: 2주
  - Classical Algorithms: 2-3주

Phase 3: 2-3개월 (주 8-12시간)
  - HTE: 2-3주
  - Variance Reduction: 2주
  - Advanced Bandits: 3-4주
  - Practical Challenges: 2-3주

Phase 4: 지속적 (프로젝트 기반)
  - Platform: 필요시
  - Applications: 도메인별
  - Research: 관심분야별</code></pre>
</section>
</section>
<section id="foundations-1-2개월" class="level2" data-number="1.3">
<h2 data-number="1.3" class="anchored" data-anchor-id="foundations-1-2개월"><span class="header-section-number">1.3</span> Foundations (1-2개월)</h2>
<section id="epidemiology-foundations" class="level3" data-number="1.3.1">
<h3 data-number="1.3.1" class="anchored" data-anchor-id="epidemiology-foundations"><span class="header-section-number">1.3.1</span> Epidemiology Foundations</h3>
<p>RCT(무작위 대조 시험)는 A/B Testing의 직접적 원형이며, 인과추론의 수학적 프레임워크(Potential Outcomes, SUTVA)가 실험 설계의 이론적 기초를 제공한다. 역학의 effect measures(RR, RD, NNT)는 디지털 실험의 lift와 uplift 지표로 직접 대응되며, bias와 confounding 개념은 실험의 타당도를 판단하는 핵심 도구다. Sample size와 power 계산은 모든 실험 설계의 출발점이다.</p>
<ul>
<li><a href="../../../../docs/blog/posts/Experimentation/Epidemiology/index.html">Epidemiology Overview</a> ⭐
<ul>
<li>Study Design Framework
<ul>
<li>1111-11-11, <a href="./Epidemiology/experimental/rct.qmd">Randomized Controlled Trial (무작위 대조 시험)</a> ⭐</li>
<li>1111-11-11, <a href="./Epidemiology/experimental/quasi_experimental.qmd">Quasi-experimental Studies (준실험 연구)</a></li>
<li>1111-11-11, <a href="./Epidemiology/experimental/factorial_design.qmd">Factorial Design (요인 설계)</a></li>
</ul></li>
<li>Measures of Association and Impact
<ul>
<li>1111-11-11, <a href="./Epidemiology/measures/relative_risk.qmd">Relative Risk and Risk Difference</a></li>
<li>1111-11-11, <a href="./Epidemiology/measures/effect_size.qmd">Effect Size Measures</a></li>
<li>1111-11-11, <a href="./Epidemiology/measures/nnt.qmd">Number Needed to Treat</a></li>
</ul></li>
<li>Bias and Confounding
<ul>
<li>1111-11-11, <a href="./Epidemiology/bias/selection_bias.qmd">Selection Bias</a></li>
<li>1111-11-11, <a href="./Epidemiology/bias/information_bias.qmd">Information Bias</a></li>
<li>1111-11-11, <a href="./Epidemiology/confounding/index.qmd">Confounding and Control</a></li>
</ul></li>
<li>Study Design Fundamentals
<ul>
<li>1111-11-11, <a href="./Epidemiology/fundamentals/sample_size_power.qmd">Sample Size and Power</a> ⭐</li>
<li>1111-11-11, <a href="./Epidemiology/fundamentals/randomization.qmd">Randomization Methods</a> ⭐</li>
</ul></li>
</ul></li>
</ul>
</section>
<section id="statistical-foundations" class="level3" data-number="1.3.2">
<h3 data-number="1.3.2" class="anchored" data-anchor-id="statistical-foundations"><span class="header-section-number">1.3.2</span> Statistical Foundations</h3>
<p>가설 검정의 Type I/II 오류와 statistical power 개념은 실험 결과 해석의 필수 요소다. Multiple testing problem은 여러 지표를 동시에 평가하거나 중간 결과를 확인할 때 발생하는 false positive를 통제하는 방법을 제공한다. Effect size와 MDE(최소감지효과) 이해 없이는 실무적으로 의미 있는 실험 설계가 불가능하다.</p>
<ul>
<li><a href="./Fundamentals/statistics.qmd">Statistical Foundations for Experimentation</a>
<ul>
<li>1111-11-11, <a href="./Fundamentals/hypothesis_testing.qmd">Hypothesis Testing Framework</a>
<ul>
<li>1111-11-11, Type I and Type II Errors (1종·2종 오류)</li>
<li>1111-11-11, Statistical Power (검정력)</li>
<li>1111-11-11, p-values and Significance (p-값과 유의성)</li>
</ul></li>
<li>1111-11-11, <a href="./Fundamentals/effect_size.qmd">Effect Size and Practical Significance</a>
<ul>
<li>1111-11-11, Minimum Detectable Effect (MDE, 최소감지효과)</li>
<li>1111-11-11, Cohen’s d and Standardized Effect Sizes</li>
</ul></li>
<li>1111-11-11, <a href="./Fundamentals/multiple_testing.qmd">Multiple Testing Problem</a>
<ul>
<li>1111-11-11, Family-wise Error Rate (FWER)</li>
<li>1111-11-11, False Discovery Rate (FDR)</li>
<li>1111-11-11, Bonferroni and Holm Corrections</li>
</ul></li>
<li>1111-11-11, <a href="./Fundamentals/confidence_intervals.qmd">Confidence Intervals</a>
<ul>
<li>1111-11-11, Interpretation and Common Mistakes</li>
<li>1111-11-11, Bootstrap Methods</li>
</ul></li>
</ul></li>
</ul>
</section>
<section id="classical-ab-testing-fundamentals" class="level3" data-number="1.3.3">
<h3 data-number="1.3.3" class="anchored" data-anchor-id="classical-ab-testing-fundamentals"><span class="header-section-number">1.3.3</span> Classical A/B Testing Fundamentals</h3>
<p>디지털 제품에서 RCT 원리를 적용하는 구체적 방법론이다. Randomization unit 선택, traffic allocation, metric selection 등 실무적 의사결정 프레임워크를 제공한다. Fixed-horizon testing의 원칙과 “peeking problem”을 이해해야 sequential testing과 MAB의 필요성을 정확히 파악할 수 있다. 대부분의 실무 실험이 이 방법으로 진행되므로 가장 실용적이다.</p>
<ul>
<li><a href="./AB_test/index.qmd">Classical A/B Testing</a> ⭐
<ul>
<li>1111-11-11, <a href="./AB_test/design_principles.qmd">A/B Test Design Principles</a>
<ul>
<li>1111-11-11, Hypothesis Formulation (가설 수립)</li>
<li>1111-11-11, Metric Selection (지표 선택)</li>
<li>1111-11-11, Randomization Unit (무작위 배정 단위)</li>
<li>1111-11-11, Traffic Allocation (트래픽 할당)</li>
</ul></li>
<li>1111-11-11, <a href="./AB_test/sample_size.qmd">Sample Size Calculation</a> ⭐
<ul>
<li>1111-11-11, Power Analysis for A/B Tests</li>
<li>1111-11-11, Continuous vs.&nbsp;Binary Metrics</li>
<li>1111-11-11, Unequal Allocation</li>
</ul></li>
<li>1111-11-11, <a href="./AB_test/randomization.qmd">Randomization Strategies</a>
<ul>
<li>1111-11-11, Simple Randomization</li>
<li>1111-11-11, Stratified Randomization</li>
<li>1111-11-11, Consistent Hashing</li>
</ul></li>
<li>1111-11-11, <a href="./AB_test/analysis.qmd">Analysis Methods</a>
<ul>
<li>1111-11-11, t-tests and z-tests</li>
<li>1111-11-11, Chi-square Tests</li>
<li>1111-11-11, Non-parametric Tests (Mann-Whitney)</li>
</ul></li>
<li>1111-11-11, <a href="./AB_test/duration.qmd">Duration and Stopping Rules</a>
<ul>
<li>1111-11-11, Fixed Horizon Testing</li>
<li>1111-11-11, When to Stop (언제 중단할 것인가)</li>
<li>1111-11-11, Peeking Problem (중간확인 문제)</li>
</ul></li>
</ul></li>
</ul>
</section>
</section>
<section id="core-methods-2-3개월" class="level2" data-number="1.4">
<h2 data-number="1.4" class="anchored" data-anchor-id="core-methods-2-3개월"><span class="header-section-number">1.4</span> Core Methods (2-3개월)</h2>
<section id="advanced-ab-testing" class="level3" data-number="1.4.1">
<h3 data-number="1.4.1" class="anchored" data-anchor-id="advanced-ab-testing"><span class="header-section-number">1.4.1</span> Advanced A/B Testing</h3>
<p>Sequential testing은 실험 진행 중 중간 결과를 확인하면서도 Type I 오류를 통제하는 방법으로, 실무에서 가장 많이 요구되는 기술이다. Bayesian A/B testing은 “승률 확률” 같은 비즈니스 친화적 해석을 제공한다. Multi-variate testing은 여러 요소의 상호작용 효과를 동시에 평가할 수 있어 복잡한 제품 최적화에 필수적이다.</p>
<ul>
<li><a href="./AB_test/advanced/index.qmd">Advanced A/B Testing Techniques</a>
<ul>
<li>1111-11-11, <a href="./AB_test/advanced/sequential.qmd">Sequential Testing</a> ⭐
<ul>
<li>1111-11-11, Group Sequential Designs (그룹순차설계)</li>
<li>1111-11-11, Sequential Probability Ratio Test (SPRT)</li>
<li>1111-11-11, Alpha Spending Functions</li>
<li>1111-11-11, Always-Valid Inference</li>
</ul></li>
<li>1111-11-11, <a href="./AB_test/advanced/bayesian.qmd">Bayesian A/B Testing</a>
<ul>
<li>1111-11-11, Prior Distribution Selection (사전분포 선택)</li>
<li>1111-11-11, Posterior Probability (사후확률)</li>
<li>1111-11-11, Credible Intervals (신용구간)</li>
<li>1111-11-11, Probability of Being Best</li>
</ul></li>
<li>1111-11-11, <a href="./AB_test/advanced/multivariate.qmd">Multi-variate Testing</a>
<ul>
<li>1111-11-11, Full Factorial Designs (완전요인설계)</li>
<li>1111-11-11, Fractional Factorial Designs (부분요인설계)</li>
<li>1111-11-11, Interaction Effects (상호작용효과)</li>
</ul></li>
<li>1111-11-11, <a href="./AB_test/advanced/aa_testing.qmd">A/A Testing</a>
<ul>
<li>1111-11-11, Platform Validation</li>
<li>1111-11-11, Sample Ratio Mismatch (SRM) Detection</li>
</ul></li>
</ul></li>
</ul>
</section>
<section id="causal-inference-framework" class="level3" data-number="1.4.2">
<h3 data-number="1.4.2" class="anchored" data-anchor-id="causal-inference-framework"><span class="header-section-number">1.4.2</span> Causal Inference Framework</h3>
<p>Potential outcomes와 DAG는 “왜 무작위 배정이 중요한가”, “어떤 변수를 통제해야 하는가”에 대한 수학적으로 엄밀한 답을 제공한다. SUTVA 위반(network effects, spillover)은 디지털 실험에서 흔히 발생하며, 이를 감지하고 처리하는 방법이 필요하다. HTE(heterogeneous treatment effects) 분석의 이론적 기초가 되어 “어떤 사용자에게 효과적인가”를 과학적으로 답할 수 있게 한다.</p>
<ul>
<li><a href="./Causal_inference/index.qmd">Causal Inference for Experimentation</a> ⭐
<ul>
<li>1111-11-11, <a href="./Causal_inference/potential_outcomes.qmd">Potential Outcomes Framework</a> ⭐
<ul>
<li>1111-11-11, Rubin Causal Model (루빈 인과 모형)</li>
<li>1111-11-11, Average Treatment Effect (ATE, 평균처치효과)</li>
<li>1111-11-11, CATE and ITE (조건부·개별 처치효과)</li>
<li>1111-11-11, SUTVA (안정단위처치값 가정)</li>
</ul></li>
<li>1111-11-11, <a href="./Causal_inference/dag.qmd">Directed Acyclic Graphs</a> ⭐
<ul>
<li>1111-11-11, Causal Pathways (인과경로)</li>
<li>1111-11-11, Confounding Paths (교란경로)</li>
<li>1111-11-11, Colliders and Selection Bias (충돌자와 선택편향)</li>
<li>1111-11-11, d-separation (d-분리)</li>
<li>1111-11-11, Backdoor and Frontdoor Criteria</li>
</ul></li>
<li>1111-11-11, <a href="./Causal_inference/assignment.qmd">Assignment Mechanisms</a>
<ul>
<li>1111-11-11, Intent-to-Treat (ITT) Analysis</li>
<li>1111-11-11, Per-Protocol Analysis</li>
<li>1111-11-11, As-Treated Analysis</li>
<li>1111-11-11, Complier Average Causal Effect (CACE)</li>
</ul></li>
<li>1111-11-11, <a href="./Causal_inference/interference.qmd">Interference and Spillover</a>
<ul>
<li>1111-11-11, Network Effects (네트워크 효과)</li>
<li>1111-11-11, Cluster Randomization (군집 무작위배정)</li>
<li>1111-11-11, Switchback Experiments</li>
<li>1111-11-11, Geo-experiments</li>
</ul></li>
</ul></li>
</ul>
</section>
<section id="multi-armed-bandit-fundamentals" class="level3" data-number="1.4.3">
<h3 data-number="1.4.3" class="anchored" data-anchor-id="multi-armed-bandit-fundamentals"><span class="header-section-number">1.4.3</span> Multi-Armed Bandit Fundamentals</h3>
<p>A/B Testing이 “학습 후 의사결정”이라면, MAB는 “학습과 최적화를 동시에” 수행한다. Exploration-exploitation trade-off는 제한된 자원(트래픽)으로 최대 성과를 내는 전략의 핵심이다. Regret 개념은 “실험 비용”을 수학적으로 정량화하여 알고리즘 간 비교를 가능하게 한다.</p>
<ul>
<li><a href="./MAB/index.qmd">Multi-Armed Bandits Overview</a> ⭐
<ul>
<li>1111-11-11, <a href="./MAB/formulation.qmd">MAB Problem Formulation</a>
<ul>
<li>1111-11-11, Exploration vs.&nbsp;Exploitation Trade-off</li>
<li>1111-11-11, Regret Definition (후회 정의)
<ul>
<li>Cumulative Regret (누적 후회)</li>
<li>Simple Regret (단순 후회)</li>
</ul></li>
<li>1111-11-11, Reward Distributions (보상 분포)</li>
<li>1111-11-11, Stationarity Assumptions (정상성 가정)</li>
</ul></li>
<li>1111-11-11, <a href="./MAB/metrics.qmd">Performance Metrics</a>
<ul>
<li>1111-11-11, Expected Cumulative Regret</li>
<li>1111-11-11, Best Arm Identification</li>
<li>1111-11-11, Sample Complexity</li>
<li>1111-11-11, Convergence Rates</li>
</ul></li>
</ul></li>
</ul>
</section>
<section id="classical-mab-algorithms" class="level3" data-number="1.4.4">
<h3 data-number="1.4.4" class="anchored" data-anchor-id="classical-mab-algorithms"><span class="header-section-number">1.4.4</span> Classical MAB Algorithms</h3>
<p>Epsilon-greedy는 가장 단순하지만 exploration 비율을 수동으로 조정해야 하는 한계가 있다. UCB는 불확실성을 자동으로 정량화하여 exploration을 관리하며, 이론적 regret bound가 증명되었다. Thompson Sampling은 1933년 의학 실험을 위해 개발된 알고리즘으로, 실무에서 가장 성능이 좋고 구현이 간단하여 광범위하게 사용된다.</p>
<ul>
<li><a href="./MAB/classical/index.qmd">Classical Bandit Algorithms</a>
<ul>
<li>1111-11-11, <a href="./MAB/classical/epsilon_greedy.qmd">Epsilon-Greedy Methods</a>
<ul>
<li>1111-11-11, Fixed Epsilon Strategy</li>
<li>1111-11-11, Decaying Epsilon Strategy</li>
<li>1111-11-11, Theoretical Regret Bounds</li>
</ul></li>
<li>1111-11-11, <a href="./MAB/classical/ucb.qmd">Upper Confidence Bound (UCB)</a>
<ul>
<li>1111-11-11, UCB1 Algorithm</li>
<li>1111-11-11, UCB-Tuned</li>
<li>1111-11-11, Bayesian UCB</li>
<li>1111-11-11, KL-UCB</li>
</ul></li>
<li>1111-11-11, <a href="./MAB/classical/thompson_sampling.qmd">Thompson Sampling</a> ⭐
<ul>
<li>1111-11-11, Beta-Bernoulli Thompson Sampling</li>
<li>1111-11-11, Gaussian Thompson Sampling</li>
<li>1111-11-11, Theoretical Properties</li>
<li>1111-11-11, Historical Context (의학 실험 기원)</li>
</ul></li>
</ul></li>
</ul>
</section>
<section id="mab-vs.-ab-testing" class="level3" data-number="1.4.5">
<h3 data-number="1.4.5" class="anchored" data-anchor-id="mab-vs.-ab-testing"><span class="header-section-number">1.4.5</span> MAB vs.&nbsp;A/B Testing</h3>
<p>두 방법의 trade-off를 이해해야 상황에 맞는 선택이 가능하다. A/B Testing은 statistical validity가 명확하고 효과 크기를 정확히 추정하지만, MAB는 실험 중 기회비용을 최소화한다. 비즈니스 목표(정확한 측정 vs.&nbsp;빠른 최적화), 트래픽 규모, 의사결정 맥락에 따라 최적 방법이 달라진다.</p>
</section>
</section>
<section id="advanced-applications-2-3개월" class="level2" data-number="1.5">
<h2 data-number="1.5" class="anchored" data-anchor-id="advanced-applications-2-3개월"><span class="header-section-number">1.5</span> Advanced Applications (2-3개월)</h2>
<section id="heterogeneous-treatment-effects" class="level3" data-number="1.5.1">
<h3 data-number="1.5.1" class="anchored" data-anchor-id="heterogeneous-treatment-effects"><span class="header-section-number">1.5.1</span> Heterogeneous Treatment Effects</h3>
<p>“평균적으로 효과가 있다”는 것과 “모든 사용자에게 효과가 있다”는 것은 다르다. HTE 분석을 통해 어떤 사용자 세그먼트에서 효과가 크고 작은지 파악할 수 있다. Causal forests와 meta-learners 같은 ML 방법은 수백 개의 특성 조합에서 효과 패턴을 자동으로 발견한다. 개인화 전략 수립의 과학적 기반이 된다.</p>
<ul>
<li>1111-11-11, <a href="./MAB/comparison.qmd">When to Use MAB vs.&nbsp;A/B Testing</a> ⭐
<ul>
<li>1111-11-11, Trade-offs and Decision Framework</li>
<li>1111-11-11, Statistical Validity Considerations</li>
<li>1111-11-11, Business Context and Goals</li>
<li>1111-11-11, Hybrid Approaches</li>
</ul></li>
<li><a href="./Causal_inference/hte/index.qmd">Heterogeneous Treatment Effects</a> ⭐
<ul>
<li>1111-11-11, <a href="./Causal_inference/hte/subgroup.qmd">Subgroup Analysis</a>
<ul>
<li>1111-11-11, Pre-specified Subgroups</li>
<li>1111-11-11, Multiple Comparison Corrections</li>
<li>1111-11-11, Statistical vs.&nbsp;Practical Significance</li>
</ul></li>
<li>1111-11-11, <a href="./Causal_inference/hte/effect_modification.qmd">Effect Modification Analysis</a>
<ul>
<li>1111-11-11, Interaction Terms (상호작용항)</li>
<li>1111-11-11, Stratified Analysis (층화분석)</li>
</ul></li>
<li>1111-11-11, <a href="./Causal_inference/hte/ml_methods.qmd">Machine Learning Methods</a>
<ul>
<li>1111-11-11, Causal Forests</li>
<li>1111-11-11, Meta-learners (S-, T-, X-learner)</li>
<li>1111-11-11, Double Machine Learning (DML)</li>
<li>1111-11-11, BART (Bayesian Additive Regression Trees)</li>
</ul></li>
</ul></li>
</ul>
</section>
<section id="variance-reduction-techniques" class="level3" data-number="1.5.2">
<h3 data-number="1.5.2" class="anchored" data-anchor-id="variance-reduction-techniques"><span class="header-section-number">1.5.2</span> Variance Reduction Techniques</h3>
<p>동일한 sample size로 더 정확한 추정이 가능하면, 실험 기간을 단축하거나 더 작은 효과를 감지할 수 있다. CUPED는 실험 전 데이터(baseline)를 활용해 분산을 최대 50% 이상 줄일 수 있어 실무에서 표준 기법이 되었다. Stratification과 regression adjustment는 역학에서 검증된 방법으로, 디지털 실험에 직접 적용 가능하다.</p>
<ul>
<li><a href="./Advanced/variance_reduction/index.qmd">Variance Reduction Methods</a> ⭐
<ul>
<li>1111-11-11, <a href="./Advanced/variance_reduction/pre_experiment.qmd">Pre-experiment Methods</a>
<ul>
<li>1111-11-11, Stratification (층화)</li>
<li>1111-11-11, Matched Pair Design (대응설계)</li>
<li>1111-11-11, Blocking (블록화)</li>
</ul></li>
<li>1111-11-11, <a href="./Advanced/variance_reduction/post_experiment.qmd">Post-experiment Methods</a>
<ul>
<li>1111-11-11, CUPED (Controlled-experiment Using Pre-Experiment Data) ⭐</li>
<li>1111-11-11, CUPAC (CUPED with Asymptotic Confidence)</li>
<li>1111-11-11, Regression Adjustment (회귀조정)</li>
<li>1111-11-11, Difference-in-Differences (이중차분법)</li>
</ul></li>
</ul></li>
</ul>
</section>
<section id="contextual-and-advanced-bandits" class="level3" data-number="1.5.3">
<h3 data-number="1.5.3" class="anchored" data-anchor-id="contextual-and-advanced-bandits"><span class="header-section-number">1.5.3</span> Contextual and Advanced Bandits</h3>
<p>Contextual bandits는 사용자 특성(context)을 고려해 개인화된 의사결정을 내린다. Non-stationary bandits는 시간에 따라 최적 선택지가 변하는 현실을 반영한다. 추천 시스템, 동적 가격 책정, 개인화 마케팅 등 복잡한 실무 문제에 적용된다.</p>
<ul>
<li><a href="./MAB/advanced/index.qmd">Advanced Bandit Methods</a>
<ul>
<li>1111-11-11, <a href="./MAB/advanced/contextual.qmd">Contextual Bandits</a>
<ul>
<li>1111-11-11, Linear Contextual Bandits</li>
<li>1111-11-11, LinUCB Algorithm</li>
<li>1111-11-11, Neural Bandits</li>
<li>1111-11-11, Policy Gradient Methods</li>
</ul></li>
<li>1111-11-11, <a href="./MAB/advanced/non_stationary.qmd">Non-stationary Bandits</a>
<ul>
<li>1111-11-11, Sliding Window Approaches</li>
<li>1111-11-11, Discounted Rewards</li>
<li>1111-11-11, Change Detection Methods</li>
<li>1111-11-11, Switching Bandits</li>
</ul></li>
<li>1111-11-11, <a href="./MAB/advanced/structured.qmd">Structured Bandits</a>
<ul>
<li>1111-11-11, Combinatorial Bandits</li>
<li>1111-11-11, Dueling Bandits</li>
<li>1111-11-11, Ranking Bandits</li>
</ul></li>
</ul></li>
</ul>
</section>
<section id="practical-implementation-challenges" class="level3" data-number="1.5.4">
<h3 data-number="1.5.4" class="anchored" data-anchor-id="practical-implementation-challenges"><span class="header-section-number">1.5.4</span> Practical Implementation Challenges</h3>
<p>이론적으로 완벽한 실험도 실무에서는 metric 정의, novelty effects, network interference, SRM 등 다양한 문제에 직면한다. 이러한 문제들을 감지하고 완화하는 방법을 모르면 잘못된 의사결정으로 이어진다. North star metric과 guardrail metric 설정은 실험 프로그램의 성공을 좌우한다.</p>
<ul>
<li><a href="./Advanced/practical/index.qmd">Practical Experimentation Challenges</a>
<ul>
<li>1111-11-11, <a href="./Advanced/practical/metrics.qmd">Metric Design</a>
<ul>
<li>1111-11-11, North Star Metrics (핵심지표)</li>
<li>1111-11-11, Proxy Metrics (대리지표)</li>
<li>1111-11-11, Guardrail Metrics (가드레일지표)</li>
<li>1111-11-11, Long-term vs.&nbsp;Short-term Metrics</li>
</ul></li>
<li>1111-11-11, <a href="./Advanced/practical/novelty_effects.qmd">Novelty and Primacy Effects</a>
<ul>
<li>1111-11-11, Detection Methods</li>
<li>1111-11-11, Mitigation Strategies</li>
</ul></li>
<li>1111-11-11, <a href="./Advanced/practical/interference.qmd">Network Effects and Interference</a>
<ul>
<li>1111-11-11, Detection of SUTVA Violations</li>
<li>1111-11-11, Cluster-based Approaches</li>
<li>1111-11-11, Graph Cluster Randomization</li>
</ul></li>
<li>1111-11-11, <a href="./Advanced/practical/srm.qmd">Sample Ratio Mismatch</a>
<ul>
<li>1111-11-11, Detection Methods</li>
<li>1111-11-11, Root Cause Analysis</li>
<li>1111-11-11, Prevention Strategies</li>
</ul></li>
</ul></li>
</ul>
</section>
</section>
<section id="platform-and-specialization-지속적" class="level2" data-number="1.6">
<h2 data-number="1.6" class="anchored" data-anchor-id="platform-and-specialization-지속적"><span class="header-section-number">1.6</span> Platform and Specialization (지속적)</h2>
<section id="experimentation-platform-architecture" class="level4" data-number="1.6.0.1">
<h4 data-number="1.6.0.1" class="anchored" data-anchor-id="experimentation-platform-architecture"><span class="header-section-number">1.6.0.1</span> Experimentation Platform Architecture</h4>
<p>실험이 일회성이 아닌 조직의 표준 프로세스가 되려면 확장 가능한 인프라가 필요하다. Assignment service, logging, analysis engine의 설계는 실험의 신뢰성과 효율성을 결정한다. Feature flag integration과 auto-stopping 같은 자동화는 실험 운영 비용을 획기적으로 줄인다.</p>
<ul>
<li><a href="./Platform/index.qmd">Platform Design and Infrastructure</a>
<ul>
<li>1111-11-11, <a href="./Platform/components.qmd">Core Components</a>
<ul>
<li>1111-11-11, Assignment Service (배정 서비스)</li>
<li>1111-11-11, Logging and Tracking (로깅과 추적)</li>
<li>1111-11-11, Analysis Engine (분석 엔진)</li>
<li>1111-11-11, Reporting Dashboard (보고 대시보드)</li>
</ul></li>
<li>1111-11-11, <a href="./Platform/technical.qmd">Technical Considerations</a>
<ul>
<li>1111-11-11, Consistent Hashing for Assignment</li>
<li>1111-11-11, Experiment Overlap and Orthogonality</li>
<li>1111-11-11, Feature Flag Integration</li>
<li>1111-11-11, A/A Testing for Validation</li>
</ul></li>
<li>1111-11-11, <a href="./Platform/automation.qmd">Scale and Automation</a>
<ul>
<li>1111-11-11, Auto-stopping Rules (자동중단규칙)</li>
<li>1111-11-11, Winner Selection Algorithms</li>
<li>1111-11-11, Multi-objective Optimization</li>
</ul></li>
</ul></li>
</ul>
</section>
<section id="domain-specific-applications" class="level3" data-number="1.6.1">
<h3 data-number="1.6.1" class="anchored" data-anchor-id="domain-specific-applications"><span class="header-section-number">1.6.1</span> Domain-Specific Applications</h3>
<p>제품 최적화, 마케팅, 의료 등 도메인마다 고유한 제약과 요구사항이 있다. Healthcare의 경우 FDA guidance를 따라야 하며, marketplace 실험은 양면 시장의 특성을 고려해야 한다. 도메인 특화 지식이 실험 설계의 성공 여부를 결정한다.</p>
<ul>
<li><a href="./Advanced/applications/index.qmd">Industry Applications</a>
<ul>
<li>1111-11-11, <a href="./Advanced/applications/product.qmd">Product Optimization</a>
<ul>
<li>1111-11-11, UI/UX Experiments</li>
<li>1111-11-11, Recommendation System Testing</li>
<li>1111-11-11, Search Ranking Experiments</li>
</ul></li>
<li>1111-11-11, <a href="./Advanced/applications/growth.qmd">Growth and Marketing</a>
<ul>
<li>1111-11-11, Conversion Funnel Optimization</li>
<li>1111-11-11, Pricing Experiments</li>
<li>1111-11-11, Email and Notification Testing</li>
</ul></li>
<li>1111-11-11, <a href="./Advanced/applications/healthcare.qmd">Healthcare Applications</a>
<ul>
<li>1111-11-11, Adaptive Clinical Trials</li>
<li>1111-11-11, Response-Adaptive Randomization</li>
<li>1111-11-11, Platform Trials</li>
<li>1111-11-11, Regulatory Considerations (FDA Guidance)</li>
</ul></li>
</ul></li>
</ul>
</section>
<section id="research-frontiers" class="level3" data-number="1.6.2">
<h3 data-number="1.6.2" class="anchored" data-anchor-id="research-frontiers"><span class="header-section-number">1.6.2</span> Research Frontiers</h3>
<p>RL과의 통합, differential privacy, causal discovery 등은 차세대 실험 방법론이다. Off-policy evaluation은 과거 실험 데이터로 새로운 정책을 평가할 수 있게 하여 실험 비용을 줄인다. 이 분야의 최신 연구를 추적하면 경쟁 우위를 확보할 수 있다.</p>
<ul>
<li><a href="./Advanced/research/index.qmd">Emerging Topics and Research</a>
<ul>
<li>1111-11-11, <a href="./Advanced/research/rl.qmd">Reinforcement Learning Integration</a>
<ul>
<li>1111-11-11, Bandits as RL Problems</li>
<li>1111-11-11, Deep RL for Experimentation</li>
<li>1111-11-11, Off-policy Evaluation</li>
</ul></li>
<li>1111-11-11, <a href="./Advanced/research/privacy.qmd">Privacy-Preserving Experiments</a>
<ul>
<li>1111-11-11, Differential Privacy in Experiments</li>
<li>1111-11-11, Federated A/B Testing</li>
</ul></li>
<li>1111-11-11, <a href="./Advanced/research/causal_discovery.qmd">Causal Discovery</a>
<ul>
<li>1111-11-11, Constraint-based Methods</li>
<li>1111-11-11, Score-based Methods</li>
<li>1111-11-11, Experimentation for Graph Learning</li>
</ul></li>
</ul></li>
</ul>
</section>
</section>
<section id="references" class="level2" data-number="1.7">
<h2 data-number="1.7" class="anchored" data-anchor-id="references"><span class="header-section-number">1.7</span> References</h2>
<p><strong>Books:</strong> - Kohavi, Tang, and Xu (2020). “Trustworthy Online Controlled Experiments” - Lattimore and Szepesvári (2020). “Bandit Algorithms” - Imbens and Rubin (2015). “Causal Inference for Statistics, Social, and Biomedical Sciences” - Pearl and Mackenzie (2018). “The Book of Why”</p>
<p><strong>Papers:</strong> - Thompson (1933). “On the likelihood that one unknown probability exceeds another” - Auer et al.&nbsp;(2002). “Finite-time analysis of the multiarmed bandit problem” - Deng et al.&nbsp;(2013). “Improving the Sensitivity of Online Controlled Experiments by Utilizing Pre-Experiment Data” (CUPED)</p>
<p><strong>Online Courses:</strong> - Stanford CS234: Reinforcement Learning - MIT 6.S897: Machine Learning for Healthcare</p>


</section>
</section>

 ]]></description>
  <category>Experimentation</category>
  <guid>kk3225.netlify.app/docs/blog/posts/Experimentation/</guid>
  <pubDate>Sun, 09 Nov 2025 15:00:00 GMT</pubDate>
</item>
<item>
  <title>End-to-End Azure RAG</title>
  <dc:creator>Kwangmin Kim</dc:creator>
  <link>kk3225.netlify.app/docs/blog/posts/RAG/13-Cloud-RAG/09-End-to-End-Azure-RAG.html</link>
  <description><![CDATA[ 





<section id="전체-아키텍처" class="level2" data-number="1">
<h2 data-number="1" class="anchored" data-anchor-id="전체-아키텍처"><span class="header-section-number">1</span> 전체 아키텍처</h2>
<p>지금까지 학습한 Azure RAG 컴포넌트를 통합한 엔터프라이즈 아키텍처다.</p>
<section id="시스템-구성도" class="level3" data-number="1.1">
<h3 data-number="1.1" class="anchored" data-anchor-id="시스템-구성도"><span class="header-section-number">1.1</span> 시스템 구성도</h3>
<div class="sourceCode" id="cb1" style="background: #f1f3f5;"><pre class="sourceCode numberSource mermaid number-lines code-with-copy"><code class="sourceCode"><span id="cb1-1">graph TB</span>
<span id="cb1-2">    subgraph "Data Ingestion"</span>
<span id="cb1-3">        A[Document Upload] --&gt; B[Azure Blob Storage]</span>
<span id="cb1-4">        B --&gt; C[Document Intelligence]</span>
<span id="cb1-5">        C --&gt; D[Text Extraction]</span>
<span id="cb1-6">    end</span>
<span id="cb1-7">    </span>
<span id="cb1-8">    subgraph "Embedding &amp; Indexing"</span>
<span id="cb1-9">        D --&gt; E[Azure OpenAI Embeddings]</span>
<span id="cb1-10">        E --&gt; F[Azure AI Search]</span>
<span id="cb1-11">        F --&gt; G[Vector Store]</span>
<span id="cb1-12">    end</span>
<span id="cb1-13">    </span>
<span id="cb1-14">    subgraph "RAG Engine"</span>
<span id="cb1-15">        H[User Query] --&gt; I[Query Embeddings]</span>
<span id="cb1-16">        I --&gt; J[Retriever]</span>
<span id="cb1-17">        J --&gt; K[LangGraph Workflow]</span>
<span id="cb1-18">        K --&gt; L[Azure OpenAI GPT-4o]</span>
<span id="cb1-19">        L --&gt; M[Response]</span>
<span id="cb1-20">    end</span>
<span id="cb1-21">    </span>
<span id="cb1-22">    subgraph "Deployment"</span>
<span id="cb1-23">        N[Azure Functions] --&gt; O[API Gateway]</span>
<span id="cb1-24">        P[Azure Container Apps] --&gt; O</span>
<span id="cb1-25">        O --&gt; Q[Application Gateway]</span>
<span id="cb1-26">    end</span>
<span id="cb1-27">    </span>
<span id="cb1-28">    subgraph "Monitoring"</span>
<span id="cb1-29">        R[Application Insights]</span>
<span id="cb1-30">        S[Log Analytics]</span>
<span id="cb1-31">        T[Azure Monitor]</span>
<span id="cb1-32">    end</span>
<span id="cb1-33">    </span>
<span id="cb1-34">    G --&gt; J</span>
<span id="cb1-35">    M --&gt; O</span>
<span id="cb1-36">    O --&gt; R</span>
<span id="cb1-37">    O --&gt; S</span>
<span id="cb1-38">    N --&gt; T</span>
<span id="cb1-39">    P --&gt; T</span></code></pre></div>
</section>
<section id="핵심-컴포넌트" class="level3" data-number="1.2">
<h3 data-number="1.2" class="anchored" data-anchor-id="핵심-컴포넌트"><span class="header-section-number">1.2</span> 핵심 컴포넌트</h3>
<table class="caption-top table">
<thead>
<tr class="header">
<th>계층</th>
<th>Azure 서비스</th>
<th>역할</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td><strong>저장소</strong></td>
<td>Blob Storage</td>
<td>원본 문서 저장</td>
</tr>
<tr class="even">
<td><strong>전처리</strong></td>
<td>Document Intelligence</td>
<td>OCR, 레이아웃 분석</td>
</tr>
<tr class="odd">
<td><strong>임베딩</strong></td>
<td>Azure OpenAI (Embeddings)</td>
<td>텍스트 → 벡터 변환</td>
</tr>
<tr class="even">
<td><strong>검색</strong></td>
<td>Azure AI Search</td>
<td>벡터 저장 및 검색</td>
</tr>
<tr class="odd">
<td><strong>RAG</strong></td>
<td>LangGraph</td>
<td>검색-생성 워크플로우</td>
</tr>
<tr class="even">
<td><strong>LLM</strong></td>
<td>Azure OpenAI (GPT-4o)</td>
<td>답변 생성</td>
</tr>
<tr class="odd">
<td><strong>배포</strong></td>
<td>Functions/Container Apps</td>
<td>API 서빙</td>
</tr>
<tr class="even">
<td><strong>모니터링</strong></td>
<td>Application Insights</td>
<td>로그, 메트릭, 추적</td>
</tr>
</tbody>
</table>
</section>
</section>
<section id="인프라-구성" class="level2" data-number="2">
<h2 data-number="2" class="anchored" data-anchor-id="인프라-구성"><span class="header-section-number">2</span> 인프라 구성</h2>
<section id="전체-리소스-배포" class="level3" data-number="2.1">
<h3 data-number="2.1" class="anchored" data-anchor-id="전체-리소스-배포"><span class="header-section-number">2.1</span> 전체 리소스 배포</h3>
<p><strong>deploy.bicep:</strong></p>
<div class="sourceCode" id="cb2" style="background: #f1f3f5;"><pre class="sourceCode numberSource bicep number-lines code-with-copy"><code class="sourceCode"><span id="cb2-1">param location string = resourceGroup().location</span>
<span id="cb2-2">param projectName string = 'rag-prod'</span>
<span id="cb2-3"></span>
<span id="cb2-4">// Storage Account</span>
<span id="cb2-5">resource storageAccount 'Microsoft.Storage/storageAccounts@2023-01-01' = {</span>
<span id="cb2-6">  name: 'st${projectName}'</span>
<span id="cb2-7">  location: location</span>
<span id="cb2-8">  sku: {</span>
<span id="cb2-9">    name: 'Standard_LRS'</span>
<span id="cb2-10">  }</span>
<span id="cb2-11">  kind: 'StorageV2'</span>
<span id="cb2-12">  properties: {</span>
<span id="cb2-13">    accessTier: 'Hot'</span>
<span id="cb2-14">    supportsHttpsTrafficOnly: true</span>
<span id="cb2-15">    minimumTlsVersion: 'TLS1_2'</span>
<span id="cb2-16">  }</span>
<span id="cb2-17">}</span>
<span id="cb2-18"></span>
<span id="cb2-19">// Document Intelligence</span>
<span id="cb2-20">resource documentIntelligence 'Microsoft.CognitiveServices/accounts@2023-05-01' = {</span>
<span id="cb2-21">  name: 'di-${projectName}'</span>
<span id="cb2-22">  location: location</span>
<span id="cb2-23">  sku: {</span>
<span id="cb2-24">    name: 'S0'</span>
<span id="cb2-25">  }</span>
<span id="cb2-26">  kind: 'FormRecognizer'</span>
<span id="cb2-27">  properties: {</span>
<span id="cb2-28">    customSubDomainName: 'di-${projectName}'</span>
<span id="cb2-29">    publicNetworkAccess: 'Enabled'</span>
<span id="cb2-30">  }</span>
<span id="cb2-31">}</span>
<span id="cb2-32"></span>
<span id="cb2-33">// Azure OpenAI</span>
<span id="cb2-34">resource openai 'Microsoft.CognitiveServices/accounts@2023-05-01' = {</span>
<span id="cb2-35">  name: 'openai-${projectName}'</span>
<span id="cb2-36">  location: location</span>
<span id="cb2-37">  sku: {</span>
<span id="cb2-38">    name: 'S0'</span>
<span id="cb2-39">  }</span>
<span id="cb2-40">  kind: 'OpenAI'</span>
<span id="cb2-41">  properties: {</span>
<span id="cb2-42">    customSubDomainName: 'openai-${projectName}'</span>
<span id="cb2-43">    publicNetworkAccess: 'Enabled'</span>
<span id="cb2-44">  }</span>
<span id="cb2-45">}</span>
<span id="cb2-46"></span>
<span id="cb2-47">// Azure AI Search</span>
<span id="cb2-48">resource search 'Microsoft.Search/searchServices@2023-11-01' = {</span>
<span id="cb2-49">  name: 'search-${projectName}'</span>
<span id="cb2-50">  location: location</span>
<span id="cb2-51">  sku: {</span>
<span id="cb2-52">    name: 'standard'</span>
<span id="cb2-53">  }</span>
<span id="cb2-54">  properties: {</span>
<span id="cb2-55">    replicaCount: 1</span>
<span id="cb2-56">    partitionCount: 1</span>
<span id="cb2-57">    hostingMode: 'default'</span>
<span id="cb2-58">  }</span>
<span id="cb2-59">}</span>
<span id="cb2-60"></span>
<span id="cb2-61">// Container Apps Environment</span>
<span id="cb2-62">resource containerAppEnv 'Microsoft.App/managedEnvironments@2023-05-01' = {</span>
<span id="cb2-63">  name: 'cae-${projectName}'</span>
<span id="cb2-64">  location: location</span>
<span id="cb2-65">  properties: {</span>
<span id="cb2-66">    appLogsConfiguration: {</span>
<span id="cb2-67">      destination: 'log-analytics'</span>
<span id="cb2-68">      logAnalyticsConfiguration: {</span>
<span id="cb2-69">        customerId: logAnalytics.properties.customerId</span>
<span id="cb2-70">        sharedKey: logAnalytics.listKeys().primarySharedKey</span>
<span id="cb2-71">      }</span>
<span id="cb2-72">    }</span>
<span id="cb2-73">  }</span>
<span id="cb2-74">}</span>
<span id="cb2-75"></span>
<span id="cb2-76">// Log Analytics</span>
<span id="cb2-77">resource logAnalytics 'Microsoft.OperationalInsights/workspaces@2022-10-01' = {</span>
<span id="cb2-78">  name: 'law-${projectName}'</span>
<span id="cb2-79">  location: location</span>
<span id="cb2-80">  properties: {</span>
<span id="cb2-81">    sku: {</span>
<span id="cb2-82">      name: 'PerGB2018'</span>
<span id="cb2-83">    }</span>
<span id="cb2-84">    retentionInDays: 30</span>
<span id="cb2-85">  }</span>
<span id="cb2-86">}</span>
<span id="cb2-87"></span>
<span id="cb2-88">// Application Insights</span>
<span id="cb2-89">resource appInsights 'Microsoft.Insights/components@2020-02-02' = {</span>
<span id="cb2-90">  name: 'appi-${projectName}'</span>
<span id="cb2-91">  location: location</span>
<span id="cb2-92">  kind: 'web'</span>
<span id="cb2-93">  properties: {</span>
<span id="cb2-94">    Application_Type: 'web'</span>
<span id="cb2-95">    WorkspaceResourceId: logAnalytics.id</span>
<span id="cb2-96">  }</span>
<span id="cb2-97">}</span>
<span id="cb2-98"></span>
<span id="cb2-99">// Container Registry</span>
<span id="cb2-100">resource containerRegistry 'Microsoft.ContainerRegistry/registries@2023-07-01' = {</span>
<span id="cb2-101">  name: 'acr${projectName}'</span>
<span id="cb2-102">  location: location</span>
<span id="cb2-103">  sku: {</span>
<span id="cb2-104">    name: 'Basic'</span>
<span id="cb2-105">  }</span>
<span id="cb2-106">  properties: {</span>
<span id="cb2-107">    adminUserEnabled: true</span>
<span id="cb2-108">  }</span>
<span id="cb2-109">}</span>
<span id="cb2-110"></span>
<span id="cb2-111">output storageAccountName string = storageAccount.name</span>
<span id="cb2-112">output documentIntelligenceEndpoint string = documentIntelligence.properties.endpoint</span>
<span id="cb2-113">output openaiEndpoint string = openai.properties.endpoint</span>
<span id="cb2-114">output searchEndpoint string = search.properties.endpoint</span>
<span id="cb2-115">output containerRegistryName string = containerRegistry.name</span>
<span id="cb2-116">output appInsightsConnectionString string = appInsights.properties.ConnectionString</span></code></pre></div>
</section>
<section id="배포-실행" class="level3" data-number="2.2">
<h3 data-number="2.2" class="anchored" data-anchor-id="배포-실행"><span class="header-section-number">2.2</span> 배포 실행</h3>
<div class="sourceCode" id="cb3" style="background: #f1f3f5;"><pre class="sourceCode numberSource bash number-lines code-with-copy"><code class="sourceCode bash"><span id="cb3-1"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># 리소스 그룹 생성</span></span>
<span id="cb3-2"><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">az</span> group create <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">--name</span> rg-rag-prod <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">--location</span> koreacentral</span>
<span id="cb3-3"></span>
<span id="cb3-4"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># Bicep 배포</span></span>
<span id="cb3-5"><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">az</span> deployment group create <span class="dt" style="color: #AD0000;
background-color: null;
font-style: inherit;">\</span></span>
<span id="cb3-6">  <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">--resource-group</span> rg-rag-prod <span class="dt" style="color: #AD0000;
background-color: null;
font-style: inherit;">\</span></span>
<span id="cb3-7">  <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">--template-file</span> deploy.bicep <span class="dt" style="color: #AD0000;
background-color: null;
font-style: inherit;">\</span></span>
<span id="cb3-8">  <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">--parameters</span> projectName=ragprod</span>
<span id="cb3-9"></span>
<span id="cb3-10"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># 배포 출력 확인</span></span>
<span id="cb3-11"><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">az</span> deployment group show <span class="dt" style="color: #AD0000;
background-color: null;
font-style: inherit;">\</span></span>
<span id="cb3-12">  <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">--resource-group</span> rg-rag-prod <span class="dt" style="color: #AD0000;
background-color: null;
font-style: inherit;">\</span></span>
<span id="cb3-13">  <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">--name</span> deploy <span class="dt" style="color: #AD0000;
background-color: null;
font-style: inherit;">\</span></span>
<span id="cb3-14">  <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">--query</span> properties.outputs</span></code></pre></div>
</section>
<section id="환경-변수-통합-관리" class="level3" data-number="2.3">
<h3 data-number="2.3" class="anchored" data-anchor-id="환경-변수-통합-관리"><span class="header-section-number">2.3</span> 환경 변수 통합 관리</h3>
<p><strong>.env:</strong></p>
<div class="sourceCode" id="cb4" style="background: #f1f3f5;"><pre class="sourceCode numberSource bash number-lines code-with-copy"><code class="sourceCode bash"><span id="cb4-1"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># Storage</span></span>
<span id="cb4-2"><span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">AZURE_STORAGE_CONNECTION_STRING</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"DefaultEndpointsProtocol=https;AccountName=stragprod;..."</span></span>
<span id="cb4-3"><span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">AZURE_STORAGE_CONTAINER</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"documents"</span></span>
<span id="cb4-4"></span>
<span id="cb4-5"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># Document Intelligence</span></span>
<span id="cb4-6"><span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">AZURE_DOCUMENT_INTELLIGENCE_ENDPOINT</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"https://di-ragprod.cognitiveservices.azure.com/"</span></span>
<span id="cb4-7"><span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">AZURE_DOCUMENT_INTELLIGENCE_KEY</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"your-key"</span></span>
<span id="cb4-8"></span>
<span id="cb4-9"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># Azure OpenAI</span></span>
<span id="cb4-10"><span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">AZURE_OPENAI_ENDPOINT</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"https://openai-ragprod.openai.azure.com/"</span></span>
<span id="cb4-11"><span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">AZURE_OPENAI_API_KEY</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"your-key"</span></span>
<span id="cb4-12"><span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">AZURE_OPENAI_DEPLOYMENT_EMBEDDINGS</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"text-embedding-3-small"</span></span>
<span id="cb4-13"><span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">AZURE_OPENAI_DEPLOYMENT_LLM</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"gpt-4o"</span></span>
<span id="cb4-14"><span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">AZURE_OPENAI_API_VERSION</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"2024-02-01"</span></span>
<span id="cb4-15"></span>
<span id="cb4-16"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># Azure AI Search</span></span>
<span id="cb4-17"><span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">AZURE_SEARCH_ENDPOINT</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"https://search-ragprod.search.windows.net"</span></span>
<span id="cb4-18"><span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">AZURE_SEARCH_API_KEY</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"your-key"</span></span>
<span id="cb4-19"><span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">AZURE_SEARCH_INDEX_NAME</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"rag-documents"</span></span>
<span id="cb4-20"></span>
<span id="cb4-21"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># Application Insights</span></span>
<span id="cb4-22"><span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">APPLICATIONINSIGHTS_CONNECTION_STRING</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"InstrumentationKey=..."</span></span>
<span id="cb4-23"></span>
<span id="cb4-24"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># API Configuration</span></span>
<span id="cb4-25"><span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">API_RATE_LIMIT</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span>100</span>
<span id="cb4-26"><span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">API_TIMEOUT</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span>300</span>
<span id="cb4-27"><span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">MAX_TOKENS</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span>1000</span></code></pre></div>
</section>
</section>
<section id="데이터-파이프라인" class="level2" data-number="3">
<h2 data-number="3" class="anchored" data-anchor-id="데이터-파이프라인"><span class="header-section-number">3</span> 데이터 파이프라인</h2>
<section id="문서-처리-워크플로우" class="level3" data-number="3.1">
<h3 data-number="3.1" class="anchored" data-anchor-id="문서-처리-워크플로우"><span class="header-section-number">3.1</span> 문서 처리 워크플로우</h3>
<div class="sourceCode" id="cb5" style="background: #f1f3f5;"><pre class="sourceCode numberSource python number-lines code-with-copy"><code class="sourceCode python"><span id="cb5-1"><span class="im" style="color: #00769E;
background-color: null;
font-style: inherit;">import</span> os</span>
<span id="cb5-2"><span class="im" style="color: #00769E;
background-color: null;
font-style: inherit;">from</span> azure.storage.blob <span class="im" style="color: #00769E;
background-color: null;
font-style: inherit;">import</span> BlobServiceClient</span>
<span id="cb5-3"><span class="im" style="color: #00769E;
background-color: null;
font-style: inherit;">from</span> azure.ai.formrecognizer <span class="im" style="color: #00769E;
background-color: null;
font-style: inherit;">import</span> DocumentAnalysisClient</span>
<span id="cb5-4"><span class="im" style="color: #00769E;
background-color: null;
font-style: inherit;">from</span> azure.core.credentials <span class="im" style="color: #00769E;
background-color: null;
font-style: inherit;">import</span> AzureKeyCredential</span>
<span id="cb5-5"><span class="im" style="color: #00769E;
background-color: null;
font-style: inherit;">from</span> langchain_openai <span class="im" style="color: #00769E;
background-color: null;
font-style: inherit;">import</span> AzureOpenAIEmbeddings</span>
<span id="cb5-6"><span class="im" style="color: #00769E;
background-color: null;
font-style: inherit;">from</span> langchain_community.vectorstores.azuresearch <span class="im" style="color: #00769E;
background-color: null;
font-style: inherit;">import</span> AzureSearch</span>
<span id="cb5-7"><span class="im" style="color: #00769E;
background-color: null;
font-style: inherit;">from</span> langchain_text_splitters <span class="im" style="color: #00769E;
background-color: null;
font-style: inherit;">import</span> RecursiveCharacterTextSplitter</span>
<span id="cb5-8"><span class="im" style="color: #00769E;
background-color: null;
font-style: inherit;">import</span> logging</span>
<span id="cb5-9"></span>
<span id="cb5-10"><span class="kw" style="color: #003B4F;
background-color: null;
font-style: inherit;">class</span> DocumentProcessor:</span>
<span id="cb5-11">    <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">"""엔드투엔드 문서 처리 파이프라인"""</span></span>
<span id="cb5-12">    </span>
<span id="cb5-13">    <span class="kw" style="color: #003B4F;
background-color: null;
font-style: inherit;">def</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">__init__</span>(<span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">self</span>):</span>
<span id="cb5-14">        <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># Blob Storage</span></span>
<span id="cb5-15">        <span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">self</span>.blob_client <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> BlobServiceClient.from_connection_string(</span>
<span id="cb5-16">            os.getenv(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"AZURE_STORAGE_CONNECTION_STRING"</span>)</span>
<span id="cb5-17">        )</span>
<span id="cb5-18">        <span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">self</span>.container_name <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> os.getenv(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"AZURE_STORAGE_CONTAINER"</span>)</span>
<span id="cb5-19">        </span>
<span id="cb5-20">        <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># Document Intelligence</span></span>
<span id="cb5-21">        <span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">self</span>.doc_intelligence <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> DocumentAnalysisClient(</span>
<span id="cb5-22">            endpoint<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span>os.getenv(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"AZURE_DOCUMENT_INTELLIGENCE_ENDPOINT"</span>),</span>
<span id="cb5-23">            credential<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span>AzureKeyCredential(os.getenv(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"AZURE_DOCUMENT_INTELLIGENCE_KEY"</span>))</span>
<span id="cb5-24">        )</span>
<span id="cb5-25">        </span>
<span id="cb5-26">        <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># Embeddings</span></span>
<span id="cb5-27">        <span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">self</span>.embeddings <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> AzureOpenAIEmbeddings(</span>
<span id="cb5-28">            azure_deployment<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span>os.getenv(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"AZURE_OPENAI_DEPLOYMENT_EMBEDDINGS"</span>),</span>
<span id="cb5-29">            openai_api_version<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span>os.getenv(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"AZURE_OPENAI_API_VERSION"</span>),</span>
<span id="cb5-30">            azure_endpoint<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span>os.getenv(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"AZURE_OPENAI_ENDPOINT"</span>),</span>
<span id="cb5-31">            api_key<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span>os.getenv(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"AZURE_OPENAI_API_KEY"</span>)</span>
<span id="cb5-32">        )</span>
<span id="cb5-33">        </span>
<span id="cb5-34">        <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># Vector Store</span></span>
<span id="cb5-35">        <span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">self</span>.vector_store <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> AzureSearch(</span>
<span id="cb5-36">            azure_search_endpoint<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span>os.getenv(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"AZURE_SEARCH_ENDPOINT"</span>),</span>
<span id="cb5-37">            azure_search_key<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span>os.getenv(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"AZURE_SEARCH_API_KEY"</span>),</span>
<span id="cb5-38">            index_name<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span>os.getenv(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"AZURE_SEARCH_INDEX_NAME"</span>),</span>
<span id="cb5-39">            embedding_function<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span><span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">self</span>.embeddings.embed_query</span>
<span id="cb5-40">        )</span>
<span id="cb5-41">        </span>
<span id="cb5-42">        <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># Text Splitter</span></span>
<span id="cb5-43">        <span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">self</span>.text_splitter <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> RecursiveCharacterTextSplitter(</span>
<span id="cb5-44">            chunk_size<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1000</span>,</span>
<span id="cb5-45">            chunk_overlap<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">200</span>,</span>
<span id="cb5-46">            length_function<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span><span class="bu" style="color: null;
background-color: null;
font-style: inherit;">len</span></span>
<span id="cb5-47">        )</span>
<span id="cb5-48">        </span>
<span id="cb5-49">        logging.info(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"문서 처리 파이프라인 초기화 완료"</span>)</span>
<span id="cb5-50">    </span>
<span id="cb5-51">    <span class="kw" style="color: #003B4F;
background-color: null;
font-style: inherit;">def</span> process_document(<span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">self</span>, blob_name: <span class="bu" style="color: null;
background-color: null;
font-style: inherit;">str</span>) <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">-&gt;</span> <span class="bu" style="color: null;
background-color: null;
font-style: inherit;">dict</span>:</span>
<span id="cb5-52">        <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">"""단일 문서 처리"""</span></span>
<span id="cb5-53">        logging.info(<span class="ss" style="color: #20794D;
background-color: null;
font-style: inherit;">f"문서 처리 시작: </span><span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">{</span>blob_name<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">}</span><span class="ss" style="color: #20794D;
background-color: null;
font-style: inherit;">"</span>)</span>
<span id="cb5-54">        </span>
<span id="cb5-55">        <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># 1. Blob에서 문서 다운로드</span></span>
<span id="cb5-56">        blob_client <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> <span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">self</span>.blob_client.get_blob_client(</span>
<span id="cb5-57">            container<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span><span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">self</span>.container_name,</span>
<span id="cb5-58">            blob<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span>blob_name</span>
<span id="cb5-59">        )</span>
<span id="cb5-60">        blob_data <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> blob_client.download_blob().readall()</span>
<span id="cb5-61">        </span>
<span id="cb5-62">        <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># 2. Document Intelligence로 텍스트 추출</span></span>
<span id="cb5-63">        poller <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> <span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">self</span>.doc_intelligence.begin_analyze_document(</span>
<span id="cb5-64">            <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"prebuilt-document"</span>,</span>
<span id="cb5-65">            document<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span>blob_data</span>
<span id="cb5-66">        )</span>
<span id="cb5-67">        result <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> poller.result()</span>
<span id="cb5-68">        </span>
<span id="cb5-69">        extracted_text <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">""</span></span>
<span id="cb5-70">        <span class="cf" style="color: #003B4F;
background-color: null;
font-style: inherit;">for</span> page <span class="kw" style="color: #003B4F;
background-color: null;
font-style: inherit;">in</span> result.pages:</span>
<span id="cb5-71">            <span class="cf" style="color: #003B4F;
background-color: null;
font-style: inherit;">for</span> line <span class="kw" style="color: #003B4F;
background-color: null;
font-style: inherit;">in</span> page.lines:</span>
<span id="cb5-72">                extracted_text <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+=</span> line.content <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"</span><span class="ch" style="color: #20794D;
background-color: null;
font-style: inherit;">\n</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"</span></span>
<span id="cb5-73">        </span>
<span id="cb5-74">        logging.info(<span class="ss" style="color: #20794D;
background-color: null;
font-style: inherit;">f"텍스트 추출 완료: </span><span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">{</span><span class="bu" style="color: null;
background-color: null;
font-style: inherit;">len</span>(extracted_text)<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">}</span><span class="ss" style="color: #20794D;
background-color: null;
font-style: inherit;"> 문자"</span>)</span>
<span id="cb5-75">        </span>
<span id="cb5-76">        <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># 3. 텍스트 분할</span></span>
<span id="cb5-77">        chunks <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> <span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">self</span>.text_splitter.split_text(extracted_text)</span>
<span id="cb5-78">        logging.info(<span class="ss" style="color: #20794D;
background-color: null;
font-style: inherit;">f"청크 생성: </span><span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">{</span><span class="bu" style="color: null;
background-color: null;
font-style: inherit;">len</span>(chunks)<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">}</span><span class="ss" style="color: #20794D;
background-color: null;
font-style: inherit;">개"</span>)</span>
<span id="cb5-79">        </span>
<span id="cb5-80">        <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># 4. 메타데이터 생성</span></span>
<span id="cb5-81">        <span class="im" style="color: #00769E;
background-color: null;
font-style: inherit;">from</span> langchain_core.documents <span class="im" style="color: #00769E;
background-color: null;
font-style: inherit;">import</span> Document</span>
<span id="cb5-82">        documents <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> []</span>
<span id="cb5-83">        <span class="cf" style="color: #003B4F;
background-color: null;
font-style: inherit;">for</span> i, chunk <span class="kw" style="color: #003B4F;
background-color: null;
font-style: inherit;">in</span> <span class="bu" style="color: null;
background-color: null;
font-style: inherit;">enumerate</span>(chunks):</span>
<span id="cb5-84">            doc <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> Document(</span>
<span id="cb5-85">                page_content<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span>chunk,</span>
<span id="cb5-86">                metadata<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span>{</span>
<span id="cb5-87">                    <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"source"</span>: blob_name,</span>
<span id="cb5-88">                    <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"chunk_id"</span>: i,</span>
<span id="cb5-89">                    <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"total_chunks"</span>: <span class="bu" style="color: null;
background-color: null;
font-style: inherit;">len</span>(chunks),</span>
<span id="cb5-90">                    <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"blob_url"</span>: blob_client.url</span>
<span id="cb5-91">                }</span>
<span id="cb5-92">            )</span>
<span id="cb5-93">            documents.append(doc)</span>
<span id="cb5-94">        </span>
<span id="cb5-95">        <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># 5. 벡터 저장소에 업로드</span></span>
<span id="cb5-96">        ids <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> <span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">self</span>.vector_store.add_documents(documents)</span>
<span id="cb5-97">        logging.info(<span class="ss" style="color: #20794D;
background-color: null;
font-style: inherit;">f"벡터 저장 완료: </span><span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">{</span><span class="bu" style="color: null;
background-color: null;
font-style: inherit;">len</span>(ids)<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">}</span><span class="ss" style="color: #20794D;
background-color: null;
font-style: inherit;">개 문서"</span>)</span>
<span id="cb5-98">        </span>
<span id="cb5-99">        <span class="cf" style="color: #003B4F;
background-color: null;
font-style: inherit;">return</span> {</span>
<span id="cb5-100">            <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"blob_name"</span>: blob_name,</span>
<span id="cb5-101">            <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"chunks"</span>: <span class="bu" style="color: null;
background-color: null;
font-style: inherit;">len</span>(chunks),</span>
<span id="cb5-102">            <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"vector_ids"</span>: ids,</span>
<span id="cb5-103">            <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"status"</span>: <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"success"</span></span>
<span id="cb5-104">        }</span>
<span id="cb5-105">    </span>
<span id="cb5-106">    <span class="kw" style="color: #003B4F;
background-color: null;
font-style: inherit;">def</span> process_all_documents(<span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">self</span>):</span>
<span id="cb5-107">        <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">"""컨테이너의 모든 문서 처리"""</span></span>
<span id="cb5-108">        container_client <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> <span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">self</span>.blob_client.get_container_client(</span>
<span id="cb5-109">            <span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">self</span>.container_name</span>
<span id="cb5-110">        )</span>
<span id="cb5-111">        </span>
<span id="cb5-112">        results <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> []</span>
<span id="cb5-113">        <span class="cf" style="color: #003B4F;
background-color: null;
font-style: inherit;">for</span> blob <span class="kw" style="color: #003B4F;
background-color: null;
font-style: inherit;">in</span> container_client.list_blobs():</span>
<span id="cb5-114">            <span class="cf" style="color: #003B4F;
background-color: null;
font-style: inherit;">try</span>:</span>
<span id="cb5-115">                result <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> <span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">self</span>.process_document(blob.name)</span>
<span id="cb5-116">                results.append(result)</span>
<span id="cb5-117">            <span class="cf" style="color: #003B4F;
background-color: null;
font-style: inherit;">except</span> <span class="pp" style="color: #AD0000;
background-color: null;
font-style: inherit;">Exception</span> <span class="im" style="color: #00769E;
background-color: null;
font-style: inherit;">as</span> e:</span>
<span id="cb5-118">                logging.error(<span class="ss" style="color: #20794D;
background-color: null;
font-style: inherit;">f"문서 처리 실패 (</span><span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">{</span>blob<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">.</span>name<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">}</span><span class="ss" style="color: #20794D;
background-color: null;
font-style: inherit;">): </span><span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">{</span><span class="bu" style="color: null;
background-color: null;
font-style: inherit;">str</span>(e)<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">}</span><span class="ss" style="color: #20794D;
background-color: null;
font-style: inherit;">"</span>)</span>
<span id="cb5-119">                results.append({</span>
<span id="cb5-120">                    <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"blob_name"</span>: blob.name,</span>
<span id="cb5-121">                    <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"status"</span>: <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"failed"</span>,</span>
<span id="cb5-122">                    <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"error"</span>: <span class="bu" style="color: null;
background-color: null;
font-style: inherit;">str</span>(e)</span>
<span id="cb5-123">                })</span>
<span id="cb5-124">        </span>
<span id="cb5-125">        <span class="cf" style="color: #003B4F;
background-color: null;
font-style: inherit;">return</span> results</span></code></pre></div>
</section>
<section id="batch-처리-azure-functions" class="level3" data-number="3.2">
<h3 data-number="3.2" class="anchored" data-anchor-id="batch-처리-azure-functions"><span class="header-section-number">3.2</span> Batch 처리 (Azure Functions)</h3>
<p><strong>function_app.py:</strong></p>
<div class="sourceCode" id="cb6" style="background: #f1f3f5;"><pre class="sourceCode numberSource python number-lines code-with-copy"><code class="sourceCode python"><span id="cb6-1"><span class="im" style="color: #00769E;
background-color: null;
font-style: inherit;">import</span> azure.functions <span class="im" style="color: #00769E;
background-color: null;
font-style: inherit;">as</span> func</span>
<span id="cb6-2"><span class="im" style="color: #00769E;
background-color: null;
font-style: inherit;">import</span> logging</span>
<span id="cb6-3"><span class="im" style="color: #00769E;
background-color: null;
font-style: inherit;">from</span> document_processor <span class="im" style="color: #00769E;
background-color: null;
font-style: inherit;">import</span> DocumentProcessor</span>
<span id="cb6-4"></span>
<span id="cb6-5">app <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> func.FunctionApp()</span>
<span id="cb6-6"></span>
<span id="cb6-7"><span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">@app.blob_trigger</span>(</span>
<span id="cb6-8">    arg_name<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"myblob"</span>,</span>
<span id="cb6-9">    path<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"documents/</span><span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">{name}</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"</span>,</span>
<span id="cb6-10">    connection<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"AzureWebJobsStorage"</span></span>
<span id="cb6-11">)</span>
<span id="cb6-12"><span class="kw" style="color: #003B4F;
background-color: null;
font-style: inherit;">def</span> blob_trigger_process(myblob: func.InputStream):</span>
<span id="cb6-13">    <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">"""Blob 업로드 시 자동 처리"""</span></span>
<span id="cb6-14">    logging.info(<span class="ss" style="color: #20794D;
background-color: null;
font-style: inherit;">f"새 문서 감지: </span><span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">{</span>myblob<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">.</span>name<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">}</span><span class="ss" style="color: #20794D;
background-color: null;
font-style: inherit;">"</span>)</span>
<span id="cb6-15">    </span>
<span id="cb6-16">    processor <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> DocumentProcessor()</span>
<span id="cb6-17">    <span class="cf" style="color: #003B4F;
background-color: null;
font-style: inherit;">try</span>:</span>
<span id="cb6-18">        result <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> processor.process_document(myblob.name)</span>
<span id="cb6-19">        logging.info(<span class="ss" style="color: #20794D;
background-color: null;
font-style: inherit;">f"처리 완료: </span><span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">{</span>result<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">}</span><span class="ss" style="color: #20794D;
background-color: null;
font-style: inherit;">"</span>)</span>
<span id="cb6-20">    <span class="cf" style="color: #003B4F;
background-color: null;
font-style: inherit;">except</span> <span class="pp" style="color: #AD0000;
background-color: null;
font-style: inherit;">Exception</span> <span class="im" style="color: #00769E;
background-color: null;
font-style: inherit;">as</span> e:</span>
<span id="cb6-21">        logging.error(<span class="ss" style="color: #20794D;
background-color: null;
font-style: inherit;">f"처리 실패: </span><span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">{</span><span class="bu" style="color: null;
background-color: null;
font-style: inherit;">str</span>(e)<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">}</span><span class="ss" style="color: #20794D;
background-color: null;
font-style: inherit;">"</span>)</span>
<span id="cb6-22">        <span class="cf" style="color: #003B4F;
background-color: null;
font-style: inherit;">raise</span></span>
<span id="cb6-23"></span>
<span id="cb6-24"><span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">@app.timer_trigger</span>(</span>
<span id="cb6-25">    arg_name<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"timer"</span>,</span>
<span id="cb6-26">    schedule<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"0 0 2 * * *"</span>  <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># 매일 새벽 2시</span></span>
<span id="cb6-27">)</span>
<span id="cb6-28"><span class="kw" style="color: #003B4F;
background-color: null;
font-style: inherit;">def</span> scheduled_reindex(timer: func.TimerRequest):</span>
<span id="cb6-29">    <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">"""정기적인 재색인"""</span></span>
<span id="cb6-30">    logging.info(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"정기 재색인 시작"</span>)</span>
<span id="cb6-31">    </span>
<span id="cb6-32">    processor <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> DocumentProcessor()</span>
<span id="cb6-33">    results <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> processor.process_all_documents()</span>
<span id="cb6-34">    </span>
<span id="cb6-35">    success <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> <span class="bu" style="color: null;
background-color: null;
font-style: inherit;">sum</span>(<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span> <span class="cf" style="color: #003B4F;
background-color: null;
font-style: inherit;">for</span> r <span class="kw" style="color: #003B4F;
background-color: null;
font-style: inherit;">in</span> results <span class="cf" style="color: #003B4F;
background-color: null;
font-style: inherit;">if</span> r[<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"status"</span>] <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">==</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"success"</span>)</span>
<span id="cb6-36">    failed <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> <span class="bu" style="color: null;
background-color: null;
font-style: inherit;">len</span>(results) <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">-</span> success</span>
<span id="cb6-37">    </span>
<span id="cb6-38">    logging.info(<span class="ss" style="color: #20794D;
background-color: null;
font-style: inherit;">f"재색인 완료: 성공 </span><span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">{</span>success<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">}</span><span class="ss" style="color: #20794D;
background-color: null;
font-style: inherit;">, 실패 </span><span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">{</span>failed<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">}</span><span class="ss" style="color: #20794D;
background-color: null;
font-style: inherit;">"</span>)</span></code></pre></div>
</section>
</section>
<section id="rag-시스템-통합" class="level2" data-number="4">
<h2 data-number="4" class="anchored" data-anchor-id="rag-시스템-통합"><span class="header-section-number">4</span> RAG 시스템 통합</h2>
<section id="langgraph-워크플로우" class="level3" data-number="4.1">
<h3 data-number="4.1" class="anchored" data-anchor-id="langgraph-워크플로우"><span class="header-section-number">4.1</span> LangGraph 워크플로우</h3>
<div class="sourceCode" id="cb7" style="background: #f1f3f5;"><pre class="sourceCode numberSource python number-lines code-with-copy"><code class="sourceCode python"><span id="cb7-1"><span class="im" style="color: #00769E;
background-color: null;
font-style: inherit;">from</span> typing <span class="im" style="color: #00769E;
background-color: null;
font-style: inherit;">import</span> TypedDict, List</span>
<span id="cb7-2"><span class="im" style="color: #00769E;
background-color: null;
font-style: inherit;">from</span> langgraph.graph <span class="im" style="color: #00769E;
background-color: null;
font-style: inherit;">import</span> StateGraph, END</span>
<span id="cb7-3"><span class="im" style="color: #00769E;
background-color: null;
font-style: inherit;">from</span> langchain_core.documents <span class="im" style="color: #00769E;
background-color: null;
font-style: inherit;">import</span> Document</span>
<span id="cb7-4"><span class="im" style="color: #00769E;
background-color: null;
font-style: inherit;">from</span> langchain_openai <span class="im" style="color: #00769E;
background-color: null;
font-style: inherit;">import</span> AzureChatOpenAI</span>
<span id="cb7-5"><span class="im" style="color: #00769E;
background-color: null;
font-style: inherit;">from</span> langchain_core.prompts <span class="im" style="color: #00769E;
background-color: null;
font-style: inherit;">import</span> ChatPromptTemplate</span>
<span id="cb7-6"><span class="im" style="color: #00769E;
background-color: null;
font-style: inherit;">from</span> langchain_core.output_parsers <span class="im" style="color: #00769E;
background-color: null;
font-style: inherit;">import</span> StrOutputParser</span>
<span id="cb7-7"><span class="im" style="color: #00769E;
background-color: null;
font-style: inherit;">import</span> logging</span>
<span id="cb7-8"></span>
<span id="cb7-9"><span class="kw" style="color: #003B4F;
background-color: null;
font-style: inherit;">class</span> RAGState(TypedDict):</span>
<span id="cb7-10">    <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">"""RAG 상태"""</span></span>
<span id="cb7-11">    question: <span class="bu" style="color: null;
background-color: null;
font-style: inherit;">str</span></span>
<span id="cb7-12">    context: List[Document]</span>
<span id="cb7-13">    answer: <span class="bu" style="color: null;
background-color: null;
font-style: inherit;">str</span></span>
<span id="cb7-14">    retrieval_success: <span class="bu" style="color: null;
background-color: null;
font-style: inherit;">bool</span></span>
<span id="cb7-15">    confidence: <span class="bu" style="color: null;
background-color: null;
font-style: inherit;">float</span></span>
<span id="cb7-16"></span>
<span id="cb7-17"><span class="kw" style="color: #003B4F;
background-color: null;
font-style: inherit;">class</span> ProductionRAGSystem:</span>
<span id="cb7-18">    <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">"""프로덕션급 RAG 시스템"""</span></span>
<span id="cb7-19">    </span>
<span id="cb7-20">    <span class="kw" style="color: #003B4F;
background-color: null;
font-style: inherit;">def</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">__init__</span>(<span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">self</span>):</span>
<span id="cb7-21">        <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># Vector Store (이미 초기화된 것 사용)</span></span>
<span id="cb7-22">        processor <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> DocumentProcessor()</span>
<span id="cb7-23">        <span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">self</span>.retriever <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> processor.vector_store.as_retriever(</span>
<span id="cb7-24">            search_type<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"similarity"</span>,</span>
<span id="cb7-25">            search_kwargs<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span>{<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"k"</span>: <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">5</span>}</span>
<span id="cb7-26">        )</span>
<span id="cb7-27">        </span>
<span id="cb7-28">        <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># LLM</span></span>
<span id="cb7-29">        <span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">self</span>.llm <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> AzureChatOpenAI(</span>
<span id="cb7-30">            azure_deployment<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span>os.getenv(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"AZURE_OPENAI_DEPLOYMENT_LLM"</span>),</span>
<span id="cb7-31">            openai_api_version<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span>os.getenv(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"AZURE_OPENAI_API_VERSION"</span>),</span>
<span id="cb7-32">            azure_endpoint<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span>os.getenv(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"AZURE_OPENAI_ENDPOINT"</span>),</span>
<span id="cb7-33">            api_key<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span>os.getenv(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"AZURE_OPENAI_API_KEY"</span>),</span>
<span id="cb7-34">            temperature<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">0</span>,</span>
<span id="cb7-35">            max_tokens<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span><span class="bu" style="color: null;
background-color: null;
font-style: inherit;">int</span>(os.getenv(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"MAX_TOKENS"</span>, <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1000</span>))</span>
<span id="cb7-36">        )</span>
<span id="cb7-37">        </span>
<span id="cb7-38">        <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># Prompt</span></span>
<span id="cb7-39">        <span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">self</span>.prompt <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> ChatPromptTemplate.from_template(</span>
<span id="cb7-40">            <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"""다음 컨텍스트를 참고하여 질문에 답변하세요.</span></span>
<span id="cb7-41"></span>
<span id="cb7-42"><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">## 지침:</span></span>
<span id="cb7-43"><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">1. 컨텍스트에 있는 정보만 사용하세요</span></span>
<span id="cb7-44"><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">2. 확실하지 않으면 "잘 모르겠습니다"라고 답하세요</span></span>
<span id="cb7-45"><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">3. 한국어로 답변하세요</span></span>
<span id="cb7-46"><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">4. 출처를 명시하세요</span></span>
<span id="cb7-47"></span>
<span id="cb7-48"><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">## 컨텍스트:</span></span>
<span id="cb7-49"><span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">{context}</span></span>
<span id="cb7-50"></span>
<span id="cb7-51"><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">## 질문:</span></span>
<span id="cb7-52"><span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">{question}</span></span>
<span id="cb7-53"></span>
<span id="cb7-54"><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">## 답변:"""</span></span>
<span id="cb7-55">        )</span>
<span id="cb7-56">        </span>
<span id="cb7-57">        <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># Workflow</span></span>
<span id="cb7-58">        <span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">self</span>.workflow <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> <span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">self</span>._build_workflow()</span>
<span id="cb7-59">        <span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">self</span>.app <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> <span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">self</span>.workflow.<span class="bu" style="color: null;
background-color: null;
font-style: inherit;">compile</span>()</span>
<span id="cb7-60">        </span>
<span id="cb7-61">        logging.info(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"RAG 시스템 초기화 완료"</span>)</span>
<span id="cb7-62">    </span>
<span id="cb7-63">    <span class="kw" style="color: #003B4F;
background-color: null;
font-style: inherit;">def</span> _build_workflow(<span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">self</span>):</span>
<span id="cb7-64">        <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">"""LangGraph 워크플로우 구성"""</span></span>
<span id="cb7-65">        workflow <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> StateGraph(RAGState)</span>
<span id="cb7-66">        </span>
<span id="cb7-67">        <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># Nodes</span></span>
<span id="cb7-68">        workflow.add_node(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"retrieve"</span>, <span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">self</span>._retrieve)</span>
<span id="cb7-69">        workflow.add_node(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"generate"</span>, <span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">self</span>._generate)</span>
<span id="cb7-70">        workflow.add_node(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"evaluate"</span>, <span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">self</span>._evaluate)</span>
<span id="cb7-71">        workflow.add_node(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"fallback"</span>, <span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">self</span>._fallback)</span>
<span id="cb7-72">        </span>
<span id="cb7-73">        <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># Edges</span></span>
<span id="cb7-74">        workflow.set_entry_point(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"retrieve"</span>)</span>
<span id="cb7-75">        workflow.add_conditional_edges(</span>
<span id="cb7-76">            <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"retrieve"</span>,</span>
<span id="cb7-77">            <span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">self</span>._should_generate,</span>
<span id="cb7-78">            {</span>
<span id="cb7-79">                <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"generate"</span>: <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"generate"</span>,</span>
<span id="cb7-80">                <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"fallback"</span>: <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"fallback"</span></span>
<span id="cb7-81">            }</span>
<span id="cb7-82">        )</span>
<span id="cb7-83">        workflow.add_edge(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"generate"</span>, <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"evaluate"</span>)</span>
<span id="cb7-84">        workflow.add_conditional_edges(</span>
<span id="cb7-85">            <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"evaluate"</span>,</span>
<span id="cb7-86">            <span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">self</span>._should_retry,</span>
<span id="cb7-87">            {</span>
<span id="cb7-88">                <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"end"</span>: END,</span>
<span id="cb7-89">                <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"fallback"</span>: <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"fallback"</span></span>
<span id="cb7-90">            }</span>
<span id="cb7-91">        )</span>
<span id="cb7-92">        workflow.add_edge(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"fallback"</span>, END)</span>
<span id="cb7-93">        </span>
<span id="cb7-94">        <span class="cf" style="color: #003B4F;
background-color: null;
font-style: inherit;">return</span> workflow</span>
<span id="cb7-95">    </span>
<span id="cb7-96">    <span class="kw" style="color: #003B4F;
background-color: null;
font-style: inherit;">def</span> _retrieve(<span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">self</span>, state: RAGState) <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">-&gt;</span> RAGState:</span>
<span id="cb7-97">        <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">"""문서 검색"""</span></span>
<span id="cb7-98">        logging.info(<span class="ss" style="color: #20794D;
background-color: null;
font-style: inherit;">f"검색 중: </span><span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">{</span>state[<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">'question'</span>]<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">}</span><span class="ss" style="color: #20794D;
background-color: null;
font-style: inherit;">"</span>)</span>
<span id="cb7-99">        </span>
<span id="cb7-100">        docs <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> <span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">self</span>.retriever.invoke(state[<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"question"</span>])</span>
<span id="cb7-101">        </span>
<span id="cb7-102">        <span class="cf" style="color: #003B4F;
background-color: null;
font-style: inherit;">return</span> {</span>
<span id="cb7-103">            <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">**</span>state,</span>
<span id="cb7-104">            <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"context"</span>: docs,</span>
<span id="cb7-105">            <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"retrieval_success"</span>: <span class="bu" style="color: null;
background-color: null;
font-style: inherit;">len</span>(docs) <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">&gt;</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">0</span></span>
<span id="cb7-106">        }</span>
<span id="cb7-107">    </span>
<span id="cb7-108">    <span class="kw" style="color: #003B4F;
background-color: null;
font-style: inherit;">def</span> _generate(<span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">self</span>, state: RAGState) <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">-&gt;</span> RAGState:</span>
<span id="cb7-109">        <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">"""답변 생성"""</span></span>
<span id="cb7-110">        logging.info(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"답변 생성 중"</span>)</span>
<span id="cb7-111">        </span>
<span id="cb7-112">        context_text <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"</span><span class="ch" style="color: #20794D;
background-color: null;
font-style: inherit;">\n\n</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"</span>.join([</span>
<span id="cb7-113">            <span class="ss" style="color: #20794D;
background-color: null;
font-style: inherit;">f"[출처: </span><span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">{</span>doc<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">.</span>metadata<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">.</span>get(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">'source'</span>, <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">'Unknown'</span>)<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">}</span><span class="ss" style="color: #20794D;
background-color: null;
font-style: inherit;">]</span><span class="ch" style="color: #20794D;
background-color: null;
font-style: inherit;">\n</span><span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">{</span>doc<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">.</span>page_content<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">}</span><span class="ss" style="color: #20794D;
background-color: null;
font-style: inherit;">"</span></span>
<span id="cb7-114">            <span class="cf" style="color: #003B4F;
background-color: null;
font-style: inherit;">for</span> doc <span class="kw" style="color: #003B4F;
background-color: null;
font-style: inherit;">in</span> state[<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"context"</span>]</span>
<span id="cb7-115">        ])</span>
<span id="cb7-116">        </span>
<span id="cb7-117">        chain <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> <span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">self</span>.prompt <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">|</span> <span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">self</span>.llm <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">|</span> StrOutputParser()</span>
<span id="cb7-118">        answer <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> chain.invoke({</span>
<span id="cb7-119">            <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"context"</span>: context_text,</span>
<span id="cb7-120">            <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"question"</span>: state[<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"question"</span>]</span>
<span id="cb7-121">        })</span>
<span id="cb7-122">        </span>
<span id="cb7-123">        <span class="cf" style="color: #003B4F;
background-color: null;
font-style: inherit;">return</span> {</span>
<span id="cb7-124">            <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">**</span>state,</span>
<span id="cb7-125">            <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"answer"</span>: answer</span>
<span id="cb7-126">        }</span>
<span id="cb7-127">    </span>
<span id="cb7-128">    <span class="kw" style="color: #003B4F;
background-color: null;
font-style: inherit;">def</span> _evaluate(<span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">self</span>, state: RAGState) <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">-&gt;</span> RAGState:</span>
<span id="cb7-129">        <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">"""답변 품질 평가"""</span></span>
<span id="cb7-130">        <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># 간단한 휴리스틱 평가</span></span>
<span id="cb7-131">        answer <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> state[<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"answer"</span>]</span>
<span id="cb7-132">        </span>
<span id="cb7-133">        <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># 길이 체크</span></span>
<span id="cb7-134">        <span class="cf" style="color: #003B4F;
background-color: null;
font-style: inherit;">if</span> <span class="bu" style="color: null;
background-color: null;
font-style: inherit;">len</span>(answer) <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">&lt;</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">10</span>:</span>
<span id="cb7-135">            confidence <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> <span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">0.3</span></span>
<span id="cb7-136">        <span class="cf" style="color: #003B4F;
background-color: null;
font-style: inherit;">elif</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"잘 모르겠습니다"</span> <span class="kw" style="color: #003B4F;
background-color: null;
font-style: inherit;">in</span> answer <span class="kw" style="color: #003B4F;
background-color: null;
font-style: inherit;">or</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"확실하지 않습니다"</span> <span class="kw" style="color: #003B4F;
background-color: null;
font-style: inherit;">in</span> answer:</span>
<span id="cb7-137">            confidence <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> <span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">0.5</span></span>
<span id="cb7-138">        <span class="cf" style="color: #003B4F;
background-color: null;
font-style: inherit;">else</span>:</span>
<span id="cb7-139">            confidence <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> <span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">0.8</span></span>
<span id="cb7-140">        </span>
<span id="cb7-141">        logging.info(<span class="ss" style="color: #20794D;
background-color: null;
font-style: inherit;">f"답변 신뢰도: </span><span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">{</span>confidence<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">}</span><span class="ss" style="color: #20794D;
background-color: null;
font-style: inherit;">"</span>)</span>
<span id="cb7-142">        </span>
<span id="cb7-143">        <span class="cf" style="color: #003B4F;
background-color: null;
font-style: inherit;">return</span> {</span>
<span id="cb7-144">            <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">**</span>state,</span>
<span id="cb7-145">            <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"confidence"</span>: confidence</span>
<span id="cb7-146">        }</span>
<span id="cb7-147">    </span>
<span id="cb7-148">    <span class="kw" style="color: #003B4F;
background-color: null;
font-style: inherit;">def</span> _fallback(<span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">self</span>, state: RAGState) <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">-&gt;</span> RAGState:</span>
<span id="cb7-149">        <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">"""대체 응답"""</span></span>
<span id="cb7-150">        logging.warning(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"대체 응답 사용"</span>)</span>
<span id="cb7-151">        </span>
<span id="cb7-152">        <span class="cf" style="color: #003B4F;
background-color: null;
font-style: inherit;">return</span> {</span>
<span id="cb7-153">            <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">**</span>state,</span>
<span id="cb7-154">            <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"answer"</span>: <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"죄송합니다. 관련 정보를 찾지 못했습니다. 다른 질문을 해주시겠어요?"</span>,</span>
<span id="cb7-155">            <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"confidence"</span>: <span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">0.0</span></span>
<span id="cb7-156">        }</span>
<span id="cb7-157">    </span>
<span id="cb7-158">    <span class="kw" style="color: #003B4F;
background-color: null;
font-style: inherit;">def</span> _should_generate(<span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">self</span>, state: RAGState) <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">-&gt;</span> <span class="bu" style="color: null;
background-color: null;
font-style: inherit;">str</span>:</span>
<span id="cb7-159">        <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">"""생성 여부 결정"""</span></span>
<span id="cb7-160">        <span class="cf" style="color: #003B4F;
background-color: null;
font-style: inherit;">return</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"generate"</span> <span class="cf" style="color: #003B4F;
background-color: null;
font-style: inherit;">if</span> state[<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"retrieval_success"</span>] <span class="cf" style="color: #003B4F;
background-color: null;
font-style: inherit;">else</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"fallback"</span></span>
<span id="cb7-161">    </span>
<span id="cb7-162">    <span class="kw" style="color: #003B4F;
background-color: null;
font-style: inherit;">def</span> _should_retry(<span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">self</span>, state: RAGState) <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">-&gt;</span> <span class="bu" style="color: null;
background-color: null;
font-style: inherit;">str</span>:</span>
<span id="cb7-163">        <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">"""재시도 여부 결정"""</span></span>
<span id="cb7-164">        <span class="cf" style="color: #003B4F;
background-color: null;
font-style: inherit;">return</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"end"</span> <span class="cf" style="color: #003B4F;
background-color: null;
font-style: inherit;">if</span> state[<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"confidence"</span>] <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">&gt;=</span> <span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">0.6</span> <span class="cf" style="color: #003B4F;
background-color: null;
font-style: inherit;">else</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"fallback"</span></span>
<span id="cb7-165">    </span>
<span id="cb7-166">    <span class="kw" style="color: #003B4F;
background-color: null;
font-style: inherit;">def</span> query(<span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">self</span>, question: <span class="bu" style="color: null;
background-color: null;
font-style: inherit;">str</span>) <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">-&gt;</span> <span class="bu" style="color: null;
background-color: null;
font-style: inherit;">dict</span>:</span>
<span id="cb7-167">        <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">"""RAG 쿼리 실행"""</span></span>
<span id="cb7-168">        initial_state <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> RAGState(</span>
<span id="cb7-169">            question<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span>question,</span>
<span id="cb7-170">            context<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span>[],</span>
<span id="cb7-171">            answer<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">""</span>,</span>
<span id="cb7-172">            retrieval_success<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span><span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">False</span>,</span>
<span id="cb7-173">            confidence<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span><span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">0.0</span></span>
<span id="cb7-174">        )</span>
<span id="cb7-175">        </span>
<span id="cb7-176">        final_state <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> <span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">self</span>.app.invoke(initial_state)</span>
<span id="cb7-177">        </span>
<span id="cb7-178">        <span class="cf" style="color: #003B4F;
background-color: null;
font-style: inherit;">return</span> {</span>
<span id="cb7-179">            <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"question"</span>: question,</span>
<span id="cb7-180">            <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"answer"</span>: final_state[<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"answer"</span>],</span>
<span id="cb7-181">            <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"confidence"</span>: final_state[<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"confidence"</span>],</span>
<span id="cb7-182">            <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"sources"</span>: [</span>
<span id="cb7-183">                doc.metadata.get(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"source"</span>, <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Unknown"</span>)</span>
<span id="cb7-184">                <span class="cf" style="color: #003B4F;
background-color: null;
font-style: inherit;">for</span> doc <span class="kw" style="color: #003B4F;
background-color: null;
font-style: inherit;">in</span> final_state[<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"context"</span>]</span>
<span id="cb7-185">            ]</span>
<span id="cb7-186">        }</span></code></pre></div>
</section>
</section>
<section id="api-서버-배포" class="level2" data-number="5">
<h2 data-number="5" class="anchored" data-anchor-id="api-서버-배포"><span class="header-section-number">5</span> API 서버 배포</h2>
<section id="fastapi-통합" class="level3" data-number="5.1">
<h3 data-number="5.1" class="anchored" data-anchor-id="fastapi-통합"><span class="header-section-number">5.1</span> FastAPI 통합</h3>
<p><strong>main.py:</strong></p>
<div class="sourceCode" id="cb8" style="background: #f1f3f5;"><pre class="sourceCode numberSource python number-lines code-with-copy"><code class="sourceCode python"><span id="cb8-1"><span class="im" style="color: #00769E;
background-color: null;
font-style: inherit;">from</span> fastapi <span class="im" style="color: #00769E;
background-color: null;
font-style: inherit;">import</span> FastAPI, HTTPException, Depends</span>
<span id="cb8-2"><span class="im" style="color: #00769E;
background-color: null;
font-style: inherit;">from</span> fastapi.middleware.cors <span class="im" style="color: #00769E;
background-color: null;
font-style: inherit;">import</span> CORSMiddleware</span>
<span id="cb8-3"><span class="im" style="color: #00769E;
background-color: null;
font-style: inherit;">from</span> pydantic <span class="im" style="color: #00769E;
background-color: null;
font-style: inherit;">import</span> BaseModel</span>
<span id="cb8-4"><span class="im" style="color: #00769E;
background-color: null;
font-style: inherit;">from</span> typing <span class="im" style="color: #00769E;
background-color: null;
font-style: inherit;">import</span> Optional</span>
<span id="cb8-5"><span class="im" style="color: #00769E;
background-color: null;
font-style: inherit;">import</span> os</span>
<span id="cb8-6"><span class="im" style="color: #00769E;
background-color: null;
font-style: inherit;">import</span> logging</span>
<span id="cb8-7"><span class="im" style="color: #00769E;
background-color: null;
font-style: inherit;">from</span> prometheus_client <span class="im" style="color: #00769E;
background-color: null;
font-style: inherit;">import</span> Counter, Histogram, generate_latest</span>
<span id="cb8-8"><span class="im" style="color: #00769E;
background-color: null;
font-style: inherit;">from</span> fastapi.responses <span class="im" style="color: #00769E;
background-color: null;
font-style: inherit;">import</span> Response</span>
<span id="cb8-9"><span class="im" style="color: #00769E;
background-color: null;
font-style: inherit;">import</span> time</span>
<span id="cb8-10"></span>
<span id="cb8-11"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># 메트릭</span></span>
<span id="cb8-12">REQUEST_COUNT <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> Counter(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">'rag_requests_total'</span>, <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">'Total RAG requests'</span>)</span>
<span id="cb8-13">REQUEST_DURATION <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> Histogram(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">'rag_request_duration_seconds'</span>, <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">'RAG request duration'</span>)</span>
<span id="cb8-14">ERROR_COUNT <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> Counter(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">'rag_errors_total'</span>, <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">'Total RAG errors'</span>)</span>
<span id="cb8-15"></span>
<span id="cb8-16">app <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> FastAPI(</span>
<span id="cb8-17">    title<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Production RAG API"</span>,</span>
<span id="cb8-18">    version<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"1.0.0"</span>,</span>
<span id="cb8-19">    description<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Azure 기반 프로덕션급 RAG API"</span></span>
<span id="cb8-20">)</span>
<span id="cb8-21"></span>
<span id="cb8-22"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># CORS</span></span>
<span id="cb8-23">app.add_middleware(</span>
<span id="cb8-24">    CORSMiddleware,</span>
<span id="cb8-25">    allow_origins<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span>[<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"*"</span>],</span>
<span id="cb8-26">    allow_credentials<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span><span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">True</span>,</span>
<span id="cb8-27">    allow_methods<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span>[<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"*"</span>],</span>
<span id="cb8-28">    allow_headers<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span>[<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"*"</span>],</span>
<span id="cb8-29">)</span>
<span id="cb8-30"></span>
<span id="cb8-31"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># RAG 시스템 (전역)</span></span>
<span id="cb8-32">rag_system <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> <span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">None</span></span>
<span id="cb8-33"></span>
<span id="cb8-34"><span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">@app.on_event</span>(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"startup"</span>)</span>
<span id="cb8-35"><span class="cf" style="color: #003B4F;
background-color: null;
font-style: inherit;">async</span> <span class="kw" style="color: #003B4F;
background-color: null;
font-style: inherit;">def</span> startup_event():</span>
<span id="cb8-36">    <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">"""애플리케이션 시작 시 초기화"""</span></span>
<span id="cb8-37">    <span class="kw" style="color: #003B4F;
background-color: null;
font-style: inherit;">global</span> rag_system</span>
<span id="cb8-38">    logging.info(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"RAG 시스템 초기화 중..."</span>)</span>
<span id="cb8-39">    rag_system <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> ProductionRAGSystem()</span>
<span id="cb8-40">    logging.info(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"RAG 시스템 초기화 완료"</span>)</span>
<span id="cb8-41"></span>
<span id="cb8-42"><span class="kw" style="color: #003B4F;
background-color: null;
font-style: inherit;">class</span> QueryRequest(BaseModel):</span>
<span id="cb8-43">    question: <span class="bu" style="color: null;
background-color: null;
font-style: inherit;">str</span></span>
<span id="cb8-44">    include_sources: <span class="bu" style="color: null;
background-color: null;
font-style: inherit;">bool</span> <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> <span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">True</span></span>
<span id="cb8-45"></span>
<span id="cb8-46"><span class="kw" style="color: #003B4F;
background-color: null;
font-style: inherit;">class</span> QueryResponse(BaseModel):</span>
<span id="cb8-47">    question: <span class="bu" style="color: null;
background-color: null;
font-style: inherit;">str</span></span>
<span id="cb8-48">    answer: <span class="bu" style="color: null;
background-color: null;
font-style: inherit;">str</span></span>
<span id="cb8-49">    confidence: <span class="bu" style="color: null;
background-color: null;
font-style: inherit;">float</span></span>
<span id="cb8-50">    sources: Optional[<span class="bu" style="color: null;
background-color: null;
font-style: inherit;">list</span>] <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> <span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">None</span></span>
<span id="cb8-51">    duration_ms: <span class="bu" style="color: null;
background-color: null;
font-style: inherit;">int</span></span>
<span id="cb8-52"></span>
<span id="cb8-53"><span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">@app.get</span>(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"/"</span>)</span>
<span id="cb8-54"><span class="cf" style="color: #003B4F;
background-color: null;
font-style: inherit;">async</span> <span class="kw" style="color: #003B4F;
background-color: null;
font-style: inherit;">def</span> root():</span>
<span id="cb8-55">    <span class="cf" style="color: #003B4F;
background-color: null;
font-style: inherit;">return</span> {</span>
<span id="cb8-56">        <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"service"</span>: <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Production RAG API"</span>,</span>
<span id="cb8-57">        <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"version"</span>: <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"1.0.0"</span>,</span>
<span id="cb8-58">        <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"status"</span>: <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"running"</span></span>
<span id="cb8-59">    }</span>
<span id="cb8-60"></span>
<span id="cb8-61"><span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">@app.get</span>(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"/health"</span>)</span>
<span id="cb8-62"><span class="cf" style="color: #003B4F;
background-color: null;
font-style: inherit;">async</span> <span class="kw" style="color: #003B4F;
background-color: null;
font-style: inherit;">def</span> health():</span>
<span id="cb8-63">    <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">"""Health check"""</span></span>
<span id="cb8-64">    <span class="cf" style="color: #003B4F;
background-color: null;
font-style: inherit;">return</span> {<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"status"</span>: <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"healthy"</span>}</span>
<span id="cb8-65"></span>
<span id="cb8-66"><span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">@app.get</span>(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"/metrics"</span>)</span>
<span id="cb8-67"><span class="cf" style="color: #003B4F;
background-color: null;
font-style: inherit;">async</span> <span class="kw" style="color: #003B4F;
background-color: null;
font-style: inherit;">def</span> metrics():</span>
<span id="cb8-68">    <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">"""Prometheus 메트릭"""</span></span>
<span id="cb8-69">    <span class="cf" style="color: #003B4F;
background-color: null;
font-style: inherit;">return</span> Response(generate_latest(), media_type<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"text/plain"</span>)</span>
<span id="cb8-70"></span>
<span id="cb8-71"><span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">@app.post</span>(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"/query"</span>, response_model<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span>QueryResponse)</span>
<span id="cb8-72"><span class="cf" style="color: #003B4F;
background-color: null;
font-style: inherit;">async</span> <span class="kw" style="color: #003B4F;
background-color: null;
font-style: inherit;">def</span> query(request: QueryRequest):</span>
<span id="cb8-73">    <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">"""RAG 쿼리"""</span></span>
<span id="cb8-74">    REQUEST_COUNT.inc()</span>
<span id="cb8-75">    start_time <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> time.time()</span>
<span id="cb8-76">    </span>
<span id="cb8-77">    <span class="cf" style="color: #003B4F;
background-color: null;
font-style: inherit;">try</span>:</span>
<span id="cb8-78">        result <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> rag_system.query(request.question)</span>
<span id="cb8-79">        </span>
<span id="cb8-80">        duration_ms <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> <span class="bu" style="color: null;
background-color: null;
font-style: inherit;">int</span>((time.time() <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">-</span> start_time) <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">*</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1000</span>)</span>
<span id="cb8-81">        REQUEST_DURATION.observe(time.time() <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">-</span> start_time)</span>
<span id="cb8-82">        </span>
<span id="cb8-83">        response <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> QueryResponse(</span>
<span id="cb8-84">            question<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span>request.question,</span>
<span id="cb8-85">            answer<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span>result[<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"answer"</span>],</span>
<span id="cb8-86">            confidence<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span>result[<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"confidence"</span>],</span>
<span id="cb8-87">            sources<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span>result[<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"sources"</span>] <span class="cf" style="color: #003B4F;
background-color: null;
font-style: inherit;">if</span> request.include_sources <span class="cf" style="color: #003B4F;
background-color: null;
font-style: inherit;">else</span> <span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">None</span>,</span>
<span id="cb8-88">            duration_ms<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span>duration_ms</span>
<span id="cb8-89">        )</span>
<span id="cb8-90">        </span>
<span id="cb8-91">        logging.info(<span class="ss" style="color: #20794D;
background-color: null;
font-style: inherit;">f"쿼리 완료: </span><span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">{</span>duration_ms<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">}</span><span class="ss" style="color: #20794D;
background-color: null;
font-style: inherit;">ms, 신뢰도: </span><span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">{</span>result[<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">'confidence'</span>]<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">}</span><span class="ss" style="color: #20794D;
background-color: null;
font-style: inherit;">"</span>)</span>
<span id="cb8-92">        </span>
<span id="cb8-93">        <span class="cf" style="color: #003B4F;
background-color: null;
font-style: inherit;">return</span> response</span>
<span id="cb8-94">    </span>
<span id="cb8-95">    <span class="cf" style="color: #003B4F;
background-color: null;
font-style: inherit;">except</span> <span class="pp" style="color: #AD0000;
background-color: null;
font-style: inherit;">Exception</span> <span class="im" style="color: #00769E;
background-color: null;
font-style: inherit;">as</span> e:</span>
<span id="cb8-96">        ERROR_COUNT.inc()</span>
<span id="cb8-97">        logging.error(<span class="ss" style="color: #20794D;
background-color: null;
font-style: inherit;">f"쿼리 실패: </span><span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">{</span><span class="bu" style="color: null;
background-color: null;
font-style: inherit;">str</span>(e)<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">}</span><span class="ss" style="color: #20794D;
background-color: null;
font-style: inherit;">"</span>)</span>
<span id="cb8-98">        <span class="cf" style="color: #003B4F;
background-color: null;
font-style: inherit;">raise</span> HTTPException(status_code<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">500</span>, detail<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span><span class="bu" style="color: null;
background-color: null;
font-style: inherit;">str</span>(e))</span>
<span id="cb8-99"></span>
<span id="cb8-100"><span class="cf" style="color: #003B4F;
background-color: null;
font-style: inherit;">if</span> <span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">__name__</span> <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">==</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"__main__"</span>:</span>
<span id="cb8-101">    <span class="im" style="color: #00769E;
background-color: null;
font-style: inherit;">import</span> uvicorn</span>
<span id="cb8-102">    uvicorn.run(app, host<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"0.0.0.0"</span>, port<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">8000</span>)</span></code></pre></div>
</section>
<section id="container-배포" class="level3" data-number="5.2">
<h3 data-number="5.2" class="anchored" data-anchor-id="container-배포"><span class="header-section-number">5.2</span> Container 배포</h3>
<div class="sourceCode" id="cb9" style="background: #f1f3f5;"><pre class="sourceCode numberSource bash number-lines code-with-copy"><code class="sourceCode bash"><span id="cb9-1"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># 이미지 빌드</span></span>
<span id="cb9-2"><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">docker</span> build <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">-t</span> rag-api-prod:latest .</span>
<span id="cb9-3"></span>
<span id="cb9-4"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># ACR 푸시</span></span>
<span id="cb9-5"><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">az</span> acr login <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">--name</span> acrragprod</span>
<span id="cb9-6"><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">docker</span> tag rag-api-prod:latest acrragprod.azurecr.io/rag-api-prod:latest</span>
<span id="cb9-7"><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">docker</span> push acrragprod.azurecr.io/rag-api-prod:latest</span>
<span id="cb9-8"></span>
<span id="cb9-9"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># Container App 배포</span></span>
<span id="cb9-10"><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">az</span> containerapp create <span class="dt" style="color: #AD0000;
background-color: null;
font-style: inherit;">\</span></span>
<span id="cb9-11">  <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">--name</span> ca-rag-prod <span class="dt" style="color: #AD0000;
background-color: null;
font-style: inherit;">\</span></span>
<span id="cb9-12">  <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">--resource-group</span> rg-rag-prod <span class="dt" style="color: #AD0000;
background-color: null;
font-style: inherit;">\</span></span>
<span id="cb9-13">  <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">--environment</span> cae-ragprod <span class="dt" style="color: #AD0000;
background-color: null;
font-style: inherit;">\</span></span>
<span id="cb9-14">  <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">--image</span> acrragprod.azurecr.io/rag-api-prod:latest <span class="dt" style="color: #AD0000;
background-color: null;
font-style: inherit;">\</span></span>
<span id="cb9-15">  <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">--target-port</span> 8000 <span class="dt" style="color: #AD0000;
background-color: null;
font-style: inherit;">\</span></span>
<span id="cb9-16">  <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">--ingress</span> external <span class="dt" style="color: #AD0000;
background-color: null;
font-style: inherit;">\</span></span>
<span id="cb9-17">  <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">--min-replicas</span> 1 <span class="dt" style="color: #AD0000;
background-color: null;
font-style: inherit;">\</span></span>
<span id="cb9-18">  <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">--max-replicas</span> 10 <span class="dt" style="color: #AD0000;
background-color: null;
font-style: inherit;">\</span></span>
<span id="cb9-19">  <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">--cpu</span> 2.0 <span class="dt" style="color: #AD0000;
background-color: null;
font-style: inherit;">\</span></span>
<span id="cb9-20">  <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">--memory</span> 4.0Gi <span class="dt" style="color: #AD0000;
background-color: null;
font-style: inherit;">\</span></span>
<span id="cb9-21">  <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">--env-vars-file</span> env.yaml</span></code></pre></div>
</section>
</section>
<section id="모니터링-및-관측성" class="level2" data-number="6">
<h2 data-number="6" class="anchored" data-anchor-id="모니터링-및-관측성"><span class="header-section-number">6</span> 모니터링 및 관측성</h2>
<section id="application-insights-통합" class="level3" data-number="6.1">
<h3 data-number="6.1" class="anchored" data-anchor-id="application-insights-통합"><span class="header-section-number">6.1</span> Application Insights 통합</h3>
<div class="sourceCode" id="cb10" style="background: #f1f3f5;"><pre class="sourceCode numberSource python number-lines code-with-copy"><code class="sourceCode python"><span id="cb10-1"><span class="im" style="color: #00769E;
background-color: null;
font-style: inherit;">from</span> opencensus.ext.azure.log_exporter <span class="im" style="color: #00769E;
background-color: null;
font-style: inherit;">import</span> AzureLogHandler</span>
<span id="cb10-2"><span class="im" style="color: #00769E;
background-color: null;
font-style: inherit;">from</span> opencensus.ext.azure <span class="im" style="color: #00769E;
background-color: null;
font-style: inherit;">import</span> metrics_exporter</span>
<span id="cb10-3"><span class="im" style="color: #00769E;
background-color: null;
font-style: inherit;">from</span> opencensus.stats <span class="im" style="color: #00769E;
background-color: null;
font-style: inherit;">import</span> aggregation <span class="im" style="color: #00769E;
background-color: null;
font-style: inherit;">as</span> aggregation_module</span>
<span id="cb10-4"><span class="im" style="color: #00769E;
background-color: null;
font-style: inherit;">from</span> opencensus.stats <span class="im" style="color: #00769E;
background-color: null;
font-style: inherit;">import</span> measure <span class="im" style="color: #00769E;
background-color: null;
font-style: inherit;">as</span> measure_module</span>
<span id="cb10-5"><span class="im" style="color: #00769E;
background-color: null;
font-style: inherit;">from</span> opencensus.stats <span class="im" style="color: #00769E;
background-color: null;
font-style: inherit;">import</span> stats <span class="im" style="color: #00769E;
background-color: null;
font-style: inherit;">as</span> stats_module</span>
<span id="cb10-6"><span class="im" style="color: #00769E;
background-color: null;
font-style: inherit;">from</span> opencensus.stats <span class="im" style="color: #00769E;
background-color: null;
font-style: inherit;">import</span> view <span class="im" style="color: #00769E;
background-color: null;
font-style: inherit;">as</span> view_module</span>
<span id="cb10-7"><span class="im" style="color: #00769E;
background-color: null;
font-style: inherit;">from</span> opencensus.tags <span class="im" style="color: #00769E;
background-color: null;
font-style: inherit;">import</span> tag_map <span class="im" style="color: #00769E;
background-color: null;
font-style: inherit;">as</span> tag_map_module</span>
<span id="cb10-8"></span>
<span id="cb10-9"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># Application Insights 설정</span></span>
<span id="cb10-10">logger <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> logging.getLogger(<span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">__name__</span>)</span>
<span id="cb10-11">logger.addHandler(AzureLogHandler(</span>
<span id="cb10-12">    connection_string<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span>os.getenv(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"APPLICATIONINSIGHTS_CONNECTION_STRING"</span>)</span>
<span id="cb10-13">))</span>
<span id="cb10-14"></span>
<span id="cb10-15"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># 커스텀 메트릭</span></span>
<span id="cb10-16">stats <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> stats_module.stats</span>
<span id="cb10-17">view_manager <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> stats.view_manager</span>
<span id="cb10-18">stats_recorder <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> stats.stats_recorder</span>
<span id="cb10-19"></span>
<span id="cb10-20"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># 메트릭 정의</span></span>
<span id="cb10-21">rag_latency_measure <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> measure_module.MeasureFloat(</span>
<span id="cb10-22">    <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"rag_latency"</span>,</span>
<span id="cb10-23">    <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"RAG query latency"</span>,</span>
<span id="cb10-24">    <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"ms"</span></span>
<span id="cb10-25">)</span>
<span id="cb10-26"></span>
<span id="cb10-27">rag_latency_view <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> view_module.View(</span>
<span id="cb10-28">    <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"rag_latency_view"</span>,</span>
<span id="cb10-29">    <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"distribution of RAG latencies"</span>,</span>
<span id="cb10-30">    [],</span>
<span id="cb10-31">    rag_latency_measure,</span>
<span id="cb10-32">    aggregation_module.DistributionAggregation([<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">10</span>, <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">50</span>, <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">100</span>, <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">500</span>, <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1000</span>, <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">5000</span>])</span>
<span id="cb10-33">)</span>
<span id="cb10-34"></span>
<span id="cb10-35">view_manager.register_view(rag_latency_view)</span>
<span id="cb10-36"></span>
<span id="cb10-37"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># 메트릭 Exporter</span></span>
<span id="cb10-38">exporter <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> metrics_exporter.new_metrics_exporter(</span>
<span id="cb10-39">    connection_string<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span>os.getenv(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"APPLICATIONINSIGHTS_CONNECTION_STRING"</span>)</span>
<span id="cb10-40">)</span>
<span id="cb10-41">view_manager.register_exporter(exporter)</span>
<span id="cb10-42"></span>
<span id="cb10-43"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># 사용</span></span>
<span id="cb10-44"><span class="kw" style="color: #003B4F;
background-color: null;
font-style: inherit;">def</span> query_with_metrics(question: <span class="bu" style="color: null;
background-color: null;
font-style: inherit;">str</span>):</span>
<span id="cb10-45">    start <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> time.time()</span>
<span id="cb10-46">    </span>
<span id="cb10-47">    <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># RAG 실행</span></span>
<span id="cb10-48">    result <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> rag_system.query(question)</span>
<span id="cb10-49">    </span>
<span id="cb10-50">    <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># 메트릭 기록</span></span>
<span id="cb10-51">    latency_ms <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> (time.time() <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">-</span> start) <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">*</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1000</span></span>
<span id="cb10-52">    mmap <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> stats_recorder.new_measurement_map()</span>
<span id="cb10-53">    tmap <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> tag_map_module.TagMap()</span>
<span id="cb10-54">    </span>
<span id="cb10-55">    mmap.measure_float_put(rag_latency_measure, latency_ms)</span>
<span id="cb10-56">    mmap.record(tmap)</span>
<span id="cb10-57">    </span>
<span id="cb10-58">    <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># 로그</span></span>
<span id="cb10-59">    logger.info(</span>
<span id="cb10-60">        <span class="ss" style="color: #20794D;
background-color: null;
font-style: inherit;">f"RAG Query"</span>,</span>
<span id="cb10-61">        extra<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span>{</span>
<span id="cb10-62">            <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"custom_dimensions"</span>: {</span>
<span id="cb10-63">                <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"question_length"</span>: <span class="bu" style="color: null;
background-color: null;
font-style: inherit;">len</span>(question),</span>
<span id="cb10-64">                <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"answer_length"</span>: <span class="bu" style="color: null;
background-color: null;
font-style: inherit;">len</span>(result[<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"answer"</span>]),</span>
<span id="cb10-65">                <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"confidence"</span>: result[<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"confidence"</span>],</span>
<span id="cb10-66">                <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"latency_ms"</span>: latency_ms</span>
<span id="cb10-67">            }</span>
<span id="cb10-68">        }</span>
<span id="cb10-69">    )</span>
<span id="cb10-70">    </span>
<span id="cb10-71">    <span class="cf" style="color: #003B4F;
background-color: null;
font-style: inherit;">return</span> result</span></code></pre></div>
</section>
<section id="kusto-쿼리" class="level3" data-number="6.2">
<h3 data-number="6.2" class="anchored" data-anchor-id="kusto-쿼리"><span class="header-section-number">6.2</span> Kusto 쿼리</h3>
<p><strong>응답 시간 분석:</strong></p>
<div class="sourceCode" id="cb11" style="background: #f1f3f5;"><pre class="sourceCode numberSource kusto number-lines code-with-copy"><code class="sourceCode"><span id="cb11-1">customMetrics</span>
<span id="cb11-2">| where name == "rag_request_duration_seconds"</span>
<span id="cb11-3">| summarize </span>
<span id="cb11-4">    P50=percentile(value, 50),</span>
<span id="cb11-5">    P95=percentile(value, 95),</span>
<span id="cb11-6">    P99=percentile(value, 99),</span>
<span id="cb11-7">    Avg=avg(value)</span>
<span id="cb11-8">  by bin(timestamp, 5m)</span>
<span id="cb11-9">| render timechart</span></code></pre></div>
<p><strong>오류율 모니터링:</strong></p>
<div class="sourceCode" id="cb12" style="background: #f1f3f5;"><pre class="sourceCode numberSource kusto number-lines code-with-copy"><code class="sourceCode"><span id="cb12-1">customMetrics</span>
<span id="cb12-2">| where name in ("rag_requests_total", "rag_errors_total")</span>
<span id="cb12-3">| summarize </span>
<span id="cb12-4">    Total=sumif(value, name == "rag_requests_total"),</span>
<span id="cb12-5">    Errors=sumif(value, name == "rag_errors_total")</span>
<span id="cb12-6">  by bin(timestamp, 5m)</span>
<span id="cb12-7">| extend ErrorRate = (Errors * 100.0 / Total)</span>
<span id="cb12-8">| project timestamp, ErrorRate</span>
<span id="cb12-9">| render timechart</span></code></pre></div>
<p><strong>사용자 쿼리 분석:</strong></p>
<div class="sourceCode" id="cb13" style="background: #f1f3f5;"><pre class="sourceCode numberSource kusto number-lines code-with-copy"><code class="sourceCode"><span id="cb13-1">traces</span>
<span id="cb13-2">| where customDimensions.question_length &gt; 0</span>
<span id="cb13-3">| summarize </span>
<span id="cb13-4">    Count=count(),</span>
<span id="cb13-5">    AvgLength=avg(toint(customDimensions.question_length)),</span>
<span id="cb13-6">    AvgConfidence=avg(todouble(customDimensions.confidence))</span>
<span id="cb13-7">  by bin(timestamp, 1h)</span>
<span id="cb13-8">| render timechart</span></code></pre></div>
</section>
</section>
<section id="성능-최적화" class="level2" data-number="7">
<h2 data-number="7" class="anchored" data-anchor-id="성능-최적화"><span class="header-section-number">7</span> 성능 최적화</h2>
<section id="캐싱-전략" class="level3" data-number="7.1">
<h3 data-number="7.1" class="anchored" data-anchor-id="캐싱-전략"><span class="header-section-number">7.1</span> 캐싱 전략</h3>
<div class="sourceCode" id="cb14" style="background: #f1f3f5;"><pre class="sourceCode numberSource python number-lines code-with-copy"><code class="sourceCode python"><span id="cb14-1"><span class="im" style="color: #00769E;
background-color: null;
font-style: inherit;">import</span> redis</span>
<span id="cb14-2"><span class="im" style="color: #00769E;
background-color: null;
font-style: inherit;">import</span> json</span>
<span id="cb14-3"><span class="im" style="color: #00769E;
background-color: null;
font-style: inherit;">import</span> hashlib</span>
<span id="cb14-4"></span>
<span id="cb14-5"><span class="kw" style="color: #003B4F;
background-color: null;
font-style: inherit;">class</span> CachedRAGSystem(ProductionRAGSystem):</span>
<span id="cb14-6">    <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">"""캐시가 통합된 RAG 시스템"""</span></span>
<span id="cb14-7">    </span>
<span id="cb14-8">    <span class="kw" style="color: #003B4F;
background-color: null;
font-style: inherit;">def</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">__init__</span>(<span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">self</span>):</span>
<span id="cb14-9">        <span class="bu" style="color: null;
background-color: null;
font-style: inherit;">super</span>().<span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">__init__</span>()</span>
<span id="cb14-10">        <span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">self</span>.redis_client <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> redis.Redis(</span>
<span id="cb14-11">            host<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span>os.getenv(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"REDIS_HOST"</span>, <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"localhost"</span>),</span>
<span id="cb14-12">            port<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span><span class="bu" style="color: null;
background-color: null;
font-style: inherit;">int</span>(os.getenv(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"REDIS_PORT"</span>, <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">6379</span>)),</span>
<span id="cb14-13">            decode_responses<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span><span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">True</span></span>
<span id="cb14-14">        )</span>
<span id="cb14-15">        <span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">self</span>.cache_ttl <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">3600</span>  <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># 1시간</span></span>
<span id="cb14-16">    </span>
<span id="cb14-17">    <span class="kw" style="color: #003B4F;
background-color: null;
font-style: inherit;">def</span> _get_cache_key(<span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">self</span>, question: <span class="bu" style="color: null;
background-color: null;
font-style: inherit;">str</span>) <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">-&gt;</span> <span class="bu" style="color: null;
background-color: null;
font-style: inherit;">str</span>:</span>
<span id="cb14-18">        <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">"""질문을 캐시 키로 변환"""</span></span>
<span id="cb14-19">        <span class="cf" style="color: #003B4F;
background-color: null;
font-style: inherit;">return</span> <span class="ss" style="color: #20794D;
background-color: null;
font-style: inherit;">f"rag:</span><span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">{</span>hashlib<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">.</span>md5(question.encode())<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">.</span>hexdigest()<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">}</span><span class="ss" style="color: #20794D;
background-color: null;
font-style: inherit;">"</span></span>
<span id="cb14-20">    </span>
<span id="cb14-21">    <span class="kw" style="color: #003B4F;
background-color: null;
font-style: inherit;">def</span> query(<span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">self</span>, question: <span class="bu" style="color: null;
background-color: null;
font-style: inherit;">str</span>) <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">-&gt;</span> <span class="bu" style="color: null;
background-color: null;
font-style: inherit;">dict</span>:</span>
<span id="cb14-22">        <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">"""캐시 우선 쿼리"""</span></span>
<span id="cb14-23">        cache_key <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> <span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">self</span>._get_cache_key(question)</span>
<span id="cb14-24">        </span>
<span id="cb14-25">        <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># 캐시 확인</span></span>
<span id="cb14-26">        cached <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> <span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">self</span>.redis_client.get(cache_key)</span>
<span id="cb14-27">        <span class="cf" style="color: #003B4F;
background-color: null;
font-style: inherit;">if</span> cached:</span>
<span id="cb14-28">            logging.info(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"캐시 히트"</span>)</span>
<span id="cb14-29">            <span class="cf" style="color: #003B4F;
background-color: null;
font-style: inherit;">return</span> json.loads(cached)</span>
<span id="cb14-30">        </span>
<span id="cb14-31">        <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># RAG 실행</span></span>
<span id="cb14-32">        result <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> <span class="bu" style="color: null;
background-color: null;
font-style: inherit;">super</span>().query(question)</span>
<span id="cb14-33">        </span>
<span id="cb14-34">        <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># 캐시 저장</span></span>
<span id="cb14-35">        <span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">self</span>.redis_client.setex(</span>
<span id="cb14-36">            cache_key,</span>
<span id="cb14-37">            <span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">self</span>.cache_ttl,</span>
<span id="cb14-38">            json.dumps(result)</span>
<span id="cb14-39">        )</span>
<span id="cb14-40">        </span>
<span id="cb14-41">        <span class="cf" style="color: #003B4F;
background-color: null;
font-style: inherit;">return</span> result</span></code></pre></div>
</section>
<section id="배치-처리" class="level3" data-number="7.2">
<h3 data-number="7.2" class="anchored" data-anchor-id="배치-처리"><span class="header-section-number">7.2</span> 배치 처리</h3>
<div class="sourceCode" id="cb15" style="background: #f1f3f5;"><pre class="sourceCode numberSource python number-lines code-with-copy"><code class="sourceCode python"><span id="cb15-1"><span class="im" style="color: #00769E;
background-color: null;
font-style: inherit;">from</span> typing <span class="im" style="color: #00769E;
background-color: null;
font-style: inherit;">import</span> List</span>
<span id="cb15-2"></span>
<span id="cb15-3"><span class="kw" style="color: #003B4F;
background-color: null;
font-style: inherit;">def</span> batch_query(questions: List[<span class="bu" style="color: null;
background-color: null;
font-style: inherit;">str</span>], batch_size: <span class="bu" style="color: null;
background-color: null;
font-style: inherit;">int</span> <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">10</span>) <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">-&gt;</span> List[<span class="bu" style="color: null;
background-color: null;
font-style: inherit;">dict</span>]:</span>
<span id="cb15-4">    <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">"""배치 쿼리 처리"""</span></span>
<span id="cb15-5">    results <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> []</span>
<span id="cb15-6">    </span>
<span id="cb15-7">    <span class="cf" style="color: #003B4F;
background-color: null;
font-style: inherit;">for</span> i <span class="kw" style="color: #003B4F;
background-color: null;
font-style: inherit;">in</span> <span class="bu" style="color: null;
background-color: null;
font-style: inherit;">range</span>(<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">0</span>, <span class="bu" style="color: null;
background-color: null;
font-style: inherit;">len</span>(questions), batch_size):</span>
<span id="cb15-8">        batch <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> questions[i:i<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span>batch_size]</span>
<span id="cb15-9">        </span>
<span id="cb15-10">        <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># 병렬 임베딩</span></span>
<span id="cb15-11">        embeddings <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> processor.embeddings.embed_documents(batch)</span>
<span id="cb15-12">        </span>
<span id="cb15-13">        <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># 배치 검색</span></span>
<span id="cb15-14">        <span class="cf" style="color: #003B4F;
background-color: null;
font-style: inherit;">for</span> question, embedding <span class="kw" style="color: #003B4F;
background-color: null;
font-style: inherit;">in</span> <span class="bu" style="color: null;
background-color: null;
font-style: inherit;">zip</span>(batch, embeddings):</span>
<span id="cb15-15">            docs <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> vector_store.similarity_search_by_vector(</span>
<span id="cb15-16">                embedding,</span>
<span id="cb15-17">                k<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">5</span></span>
<span id="cb15-18">            )</span>
<span id="cb15-19">            </span>
<span id="cb15-20">            <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># 답변 생성</span></span>
<span id="cb15-21">            answer <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> llm.invoke(...)</span>
<span id="cb15-22">            </span>
<span id="cb15-23">            results.append({</span>
<span id="cb15-24">                <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"question"</span>: question,</span>
<span id="cb15-25">                <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"answer"</span>: answer</span>
<span id="cb15-26">            })</span>
<span id="cb15-27">    </span>
<span id="cb15-28">    <span class="cf" style="color: #003B4F;
background-color: null;
font-style: inherit;">return</span> results</span></code></pre></div>
</section>
</section>
<section id="보안-강화" class="level2" data-number="8">
<h2 data-number="8" class="anchored" data-anchor-id="보안-강화"><span class="header-section-number">8</span> 보안 강화</h2>
<section id="managed-identity-전환" class="level3" data-number="8.1">
<h3 data-number="8.1" class="anchored" data-anchor-id="managed-identity-전환"><span class="header-section-number">8.1</span> Managed Identity 전환</h3>
<div class="sourceCode" id="cb16" style="background: #f1f3f5;"><pre class="sourceCode numberSource python number-lines code-with-copy"><code class="sourceCode python"><span id="cb16-1"><span class="im" style="color: #00769E;
background-color: null;
font-style: inherit;">from</span> azure.identity <span class="im" style="color: #00769E;
background-color: null;
font-style: inherit;">import</span> DefaultAzureCredential</span>
<span id="cb16-2"></span>
<span id="cb16-3">credential <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> DefaultAzureCredential()</span>
<span id="cb16-4"></span>
<span id="cb16-5"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># Azure OpenAI</span></span>
<span id="cb16-6">llm <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> AzureChatOpenAI(</span>
<span id="cb16-7">    azure_deployment<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"gpt-4o"</span>,</span>
<span id="cb16-8">    azure_endpoint<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span>os.getenv(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"AZURE_OPENAI_ENDPOINT"</span>),</span>
<span id="cb16-9">    azure_ad_token_provider<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span><span class="kw" style="color: #003B4F;
background-color: null;
font-style: inherit;">lambda</span>: credential.get_token(</span>
<span id="cb16-10">        <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"https://cognitiveservices.azure.com/.default"</span></span>
<span id="cb16-11">    ).token</span>
<span id="cb16-12">)</span>
<span id="cb16-13"></span>
<span id="cb16-14"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># Azure Search</span></span>
<span id="cb16-15"><span class="im" style="color: #00769E;
background-color: null;
font-style: inherit;">from</span> azure.search.documents <span class="im" style="color: #00769E;
background-color: null;
font-style: inherit;">import</span> SearchClient</span>
<span id="cb16-16"></span>
<span id="cb16-17">search_client <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> SearchClient(</span>
<span id="cb16-18">    endpoint<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span>os.getenv(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"AZURE_SEARCH_ENDPOINT"</span>),</span>
<span id="cb16-19">    index_name<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span>os.getenv(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"AZURE_SEARCH_INDEX_NAME"</span>),</span>
<span id="cb16-20">    credential<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span>credential</span>
<span id="cb16-21">)</span></code></pre></div>
</section>
<section id="api-인증" class="level3" data-number="8.2">
<h3 data-number="8.2" class="anchored" data-anchor-id="api-인증"><span class="header-section-number">8.2</span> API 인증</h3>
<div class="sourceCode" id="cb17" style="background: #f1f3f5;"><pre class="sourceCode numberSource python number-lines code-with-copy"><code class="sourceCode python"><span id="cb17-1"><span class="im" style="color: #00769E;
background-color: null;
font-style: inherit;">from</span> fastapi <span class="im" style="color: #00769E;
background-color: null;
font-style: inherit;">import</span> Security, HTTPException</span>
<span id="cb17-2"><span class="im" style="color: #00769E;
background-color: null;
font-style: inherit;">from</span> fastapi.security <span class="im" style="color: #00769E;
background-color: null;
font-style: inherit;">import</span> HTTPBearer, HTTPAuthorizationCredentials</span>
<span id="cb17-3"><span class="im" style="color: #00769E;
background-color: null;
font-style: inherit;">import</span> jwt</span>
<span id="cb17-4"></span>
<span id="cb17-5">security <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> HTTPBearer()</span>
<span id="cb17-6"></span>
<span id="cb17-7"><span class="kw" style="color: #003B4F;
background-color: null;
font-style: inherit;">def</span> verify_token(credentials: HTTPAuthorizationCredentials <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> Security(security)):</span>
<span id="cb17-8">    <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">"""JWT 토큰 검증"""</span></span>
<span id="cb17-9">    token <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> credentials.credentials</span>
<span id="cb17-10">    </span>
<span id="cb17-11">    <span class="cf" style="color: #003B4F;
background-color: null;
font-style: inherit;">try</span>:</span>
<span id="cb17-12">        payload <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> jwt.decode(</span>
<span id="cb17-13">            token,</span>
<span id="cb17-14">            os.getenv(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"JWT_SECRET"</span>),</span>
<span id="cb17-15">            algorithms<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span>[<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"HS256"</span>]</span>
<span id="cb17-16">        )</span>
<span id="cb17-17">        <span class="cf" style="color: #003B4F;
background-color: null;
font-style: inherit;">return</span> payload</span>
<span id="cb17-18">    <span class="cf" style="color: #003B4F;
background-color: null;
font-style: inherit;">except</span> jwt.ExpiredSignatureError:</span>
<span id="cb17-19">        <span class="cf" style="color: #003B4F;
background-color: null;
font-style: inherit;">raise</span> HTTPException(status_code<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">401</span>, detail<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"토큰 만료"</span>)</span>
<span id="cb17-20">    <span class="cf" style="color: #003B4F;
background-color: null;
font-style: inherit;">except</span> jwt.InvalidTokenError:</span>
<span id="cb17-21">        <span class="cf" style="color: #003B4F;
background-color: null;
font-style: inherit;">raise</span> HTTPException(status_code<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">401</span>, detail<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"유효하지 않은 토큰"</span>)</span>
<span id="cb17-22"></span>
<span id="cb17-23"><span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">@app.post</span>(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"/query"</span>)</span>
<span id="cb17-24"><span class="cf" style="color: #003B4F;
background-color: null;
font-style: inherit;">async</span> <span class="kw" style="color: #003B4F;
background-color: null;
font-style: inherit;">def</span> query(request: QueryRequest, user<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span>Depends(verify_token)):</span>
<span id="cb17-25">    <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">"""인증된 쿼리"""</span></span>
<span id="cb17-26">    logging.info(<span class="ss" style="color: #20794D;
background-color: null;
font-style: inherit;">f"사용자 </span><span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">{</span>user[<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">'sub'</span>]<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">}</span><span class="ss" style="color: #20794D;
background-color: null;
font-style: inherit;"> 쿼리"</span>)</span>
<span id="cb17-27">    <span class="cf" style="color: #003B4F;
background-color: null;
font-style: inherit;">return</span> rag_system.query(request.question)</span></code></pre></div>
</section>
</section>
<section id="비용-최적화" class="level2" data-number="9">
<h2 data-number="9" class="anchored" data-anchor-id="비용-최적화"><span class="header-section-number">9</span> 비용 최적화</h2>
<section id="월별-비용-추정" class="level3" data-number="9.1">
<h3 data-number="9.1" class="anchored" data-anchor-id="월별-비용-추정"><span class="header-section-number">9.1</span> 월별 비용 추정</h3>
<table class="caption-top table">
<colgroup>
<col style="width: 25%">
<col style="width: 19%">
<col style="width: 25%">
<col style="width: 29%">
</colgroup>
<thead>
<tr class="header">
<th>서비스</th>
<th>사양</th>
<th>사용량</th>
<th>월 비용</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td><strong>Blob Storage</strong></td>
<td>Standard LRS</td>
<td>100GB</td>
<td>$2.00</td>
</tr>
<tr class="even">
<td><strong>Document Intelligence</strong></td>
<td>S0</td>
<td>1,000 페이지</td>
<td>$10.00</td>
</tr>
<tr class="odd">
<td><strong>Azure OpenAI (Embeddings)</strong></td>
<td>text-embedding-3-small</td>
<td>10M 토큰</td>
<td>$1.00</td>
</tr>
<tr class="even">
<td><strong>Azure OpenAI (LLM)</strong></td>
<td>GPT-4o</td>
<td>1M in, 500K out</td>
<td>$12.50</td>
</tr>
<tr class="odd">
<td><strong>Azure AI Search</strong></td>
<td>Standard S1</td>
<td>1 SU</td>
<td>$250.00</td>
</tr>
<tr class="even">
<td><strong>Container Apps</strong></td>
<td>1 vCPU, 2GB</td>
<td>1 인스턴스 항상 실행</td>
<td>$77.00</td>
</tr>
<tr class="odd">
<td><strong>Application Insights</strong></td>
<td>-</td>
<td>5GB 로그</td>
<td>$12.50</td>
</tr>
<tr class="even">
<td><strong>Log Analytics</strong></td>
<td>-</td>
<td>5GB 저장</td>
<td>$12.50</td>
</tr>
<tr class="odd">
<td><strong>총 비용</strong></td>
<td></td>
<td></td>
<td><strong>$377.50/월</strong></td>
</tr>
</tbody>
</table>
</section>
<section id="비용-절감-팁" class="level3" data-number="9.2">
<h3 data-number="9.2" class="anchored" data-anchor-id="비용-절감-팁"><span class="header-section-number">9.2</span> 비용 절감 팁</h3>
<ol type="1">
<li><strong>Azure AI Search 최적화</strong></li>
</ol>
<div class="sourceCode" id="cb18" style="background: #f1f3f5;"><pre class="sourceCode numberSource bash number-lines code-with-copy"><code class="sourceCode bash"><span id="cb18-1"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># 개발 환경: Basic 사용 (월 $75)</span></span>
<span id="cb18-2"><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">az</span> search service update <span class="dt" style="color: #AD0000;
background-color: null;
font-style: inherit;">\</span></span>
<span id="cb18-3">  <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">--name</span> search-rag-dev <span class="dt" style="color: #AD0000;
background-color: null;
font-style: inherit;">\</span></span>
<span id="cb18-4">  <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">--resource-group</span> rg-rag-dev <span class="dt" style="color: #AD0000;
background-color: null;
font-style: inherit;">\</span></span>
<span id="cb18-5">  <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">--sku</span> basic</span></code></pre></div>
<ol start="2" type="1">
<li><strong>Container Apps 스케일링</strong></li>
</ol>
<div class="sourceCode" id="cb19" style="background: #f1f3f5;"><pre class="sourceCode numberSource bash number-lines code-with-copy"><code class="sourceCode bash"><span id="cb19-1"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># 오프피크 시간에 0으로 스케일</span></span>
<span id="cb19-2"><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">az</span> containerapp update <span class="dt" style="color: #AD0000;
background-color: null;
font-style: inherit;">\</span></span>
<span id="cb19-3">  <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">--name</span> ca-rag-prod <span class="dt" style="color: #AD0000;
background-color: null;
font-style: inherit;">\</span></span>
<span id="cb19-4">  <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">--resource-group</span> rg-rag-prod <span class="dt" style="color: #AD0000;
background-color: null;
font-style: inherit;">\</span></span>
<span id="cb19-5">  <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">--min-replicas</span> 0</span></code></pre></div>
<ol start="3" type="1">
<li><strong>캐싱으로 OpenAI 호출 감소</strong></li>
</ol>
<ul>
<li>Redis 캐시로 중복 쿼리 방지</li>
<li>예상 절감: 월 $5-10</li>
</ul>
<ol start="4" type="1">
<li><strong>Blob Storage 라이프사이클 정책</strong></li>
</ol>
<div class="sourceCode" id="cb20" style="background: #f1f3f5;"><pre class="sourceCode numberSource bash number-lines code-with-copy"><code class="sourceCode bash"><span id="cb20-1"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># 90일 후 Cool tier로 이동</span></span>
<span id="cb20-2"><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">az</span> storage account management-policy create <span class="dt" style="color: #AD0000;
background-color: null;
font-style: inherit;">\</span></span>
<span id="cb20-3">  <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">--account-name</span> stragprod <span class="dt" style="color: #AD0000;
background-color: null;
font-style: inherit;">\</span></span>
<span id="cb20-4">  <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">--policy</span> @lifecycle-policy.json</span></code></pre></div>
</section>
</section>
<section id="배포-체크리스트" class="level2" data-number="10">
<h2 data-number="10" class="anchored" data-anchor-id="배포-체크리스트"><span class="header-section-number">10</span> 배포 체크리스트</h2>
<section id="프로덕션-배포-전" class="level3" data-number="10.1">
<h3 data-number="10.1" class="anchored" data-anchor-id="프로덕션-배포-전"><span class="header-section-number">10.1</span> 프로덕션 배포 전</h3>
<ul class="task-list">
<li><label><input type="checkbox">모든 환경 변수가 Key Vault에 저장됨</label></li>
<li><label><input type="checkbox">Managed Identity 구성 완료</label></li>
<li><label><input type="checkbox">Application Insights 통합 및 테스트</label></li>
<li><label><input type="checkbox">로그 쿼리 알림 설정</label></li>
<li><label><input type="checkbox">API 인증/인가 구현</label></li>
<li><label><input type="checkbox">Rate limiting 설정</label></li>
<li><label><input type="checkbox">CORS 정책 확인</label></li>
<li><label><input type="checkbox">Health check 엔드포인트 구현</label></li>
<li><label><input type="checkbox">에러 처리 및 재시도 로직</label></li>
<li><label><input type="checkbox">캐싱 전략 구현</label></li>
<li><label><input type="checkbox">Blue-Green 배포 설정</label></li>
<li><label><input type="checkbox">백업 및 복구 계획</label></li>
<li><label><input type="checkbox">부하 테스트 완료</label></li>
<li><label><input type="checkbox">보안 스캔 통과</label></li>
<li><label><input type="checkbox">문서화 완료</label></li>
</ul>
</section>
</section>
<section id="참고-자료" class="level2" data-number="11">
<h2 data-number="11" class="anchored" data-anchor-id="참고-자료"><span class="header-section-number">11</span> 참고 자료</h2>
<section id="공식-문서" class="level3" data-number="11.1">
<h3 data-number="11.1" class="anchored" data-anchor-id="공식-문서"><span class="header-section-number">11.1</span> 공식 문서</h3>
<ul>
<li><a href="https://learn.microsoft.com/en-us/azure/architecture/ai-ml/guide/rag/rag-solution-design-and-evaluation-guide">Azure Architecture Center - RAG</a></li>
<li><a href="https://learn.microsoft.com/en-us/azure/ai-services/openai/concepts/best-practices">Azure OpenAI Best Practices</a></li>
<li><a href="https://python.langchain.com/docs/integrations/platforms/microsoft">LangChain Azure Integration</a></li>
</ul>
</section>
<section id="github-샘플" class="level3" data-number="11.2">
<h3 data-number="11.2" class="anchored" data-anchor-id="github-샘플"><span class="header-section-number">11.2</span> GitHub 샘플</h3>
<ul>
<li><a href="https://github.com/Azure-Samples/azure-search-openai-demo">Azure Search OpenAI Demo</a></li>
<li><a href="https://github.com/Azure-Samples/azure-openai-rag-workshop">Enterprise RAG</a></li>
</ul>
</section>
</section>
<section id="다음-단계" class="level2" data-number="12">
<h2 data-number="12" class="anchored" data-anchor-id="다음-단계"><span class="header-section-number">12</span> 다음 단계</h2>
<p>이제 완전한 Azure RAG 시스템을 구축했다. 지속적인 개선을 위해 다음을 고려하자:</p>
<ol type="1">
<li><strong>모니터링 강화</strong>: 사용자 피드백 수집, A/B 테스트</li>
<li><strong>고급 RAG 패턴</strong>: Self-RAG, Corrective RAG, Adaptive RAG</li>
<li><strong>다국어 지원</strong>: 언어별 임베딩 모델</li>
<li><strong>멀티모달</strong>: 이미지, 테이블 처리</li>
<li><strong>에이전트 통합</strong>: LangGraph로 복잡한 워크플로우</li>
</ol>


</section>

 ]]></description>
  <category>AI</category>
  <category>RAG</category>
  <category>Azure</category>
  <category>MLOps</category>
  <guid>kk3225.netlify.app/docs/blog/posts/RAG/13-Cloud-RAG/09-End-to-End-Azure-RAG.html</guid>
  <pubDate>Sun, 09 Nov 2025 15:00:00 GMT</pubDate>
</item>
<item>
  <title>Azure Container Apps</title>
  <dc:creator>Kwangmin Kim</dc:creator>
  <link>kk3225.netlify.app/docs/blog/posts/RAG/13-Cloud-RAG/08-Azure-Container-Apps.html</link>
  <description><![CDATA[ 





<section id="azure-container-apps란" class="level2" data-number="1">
<h2 data-number="1" class="anchored" data-anchor-id="azure-container-apps란"><span class="header-section-number">1</span> Azure Container Apps란?</h2>
<p>Azure Container Apps는 서버리스 컨테이너 플랫폼으로, Kubernetes 복잡도 없이 컨테이너를 실행할 수 있다.</p>
<p><strong>주요 특징:</strong> - Kubernetes 기반이지만 관리 불필요 - HTTPS Ingress 자동 구성 - Dapr 통합 - KEDA 기반 자동 스케일링 - Revision 관리 (Blue-Green 배포)</p>
<p><strong>Azure Functions와 비교:</strong></p>
<table class="caption-top table">
<thead>
<tr class="header">
<th>항목</th>
<th>Functions</th>
<th>Container Apps</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td><strong>실행 시간</strong></td>
<td>최대 10분</td>
<td>무제한</td>
</tr>
<tr class="even">
<td><strong>Cold Start</strong></td>
<td>3-5초</td>
<td>1-2초</td>
</tr>
<tr class="odd">
<td><strong>커스터마이징</strong></td>
<td>제한적</td>
<td>완전 제어</td>
</tr>
<tr class="even">
<td><strong>WebSocket</strong></td>
<td>불가</td>
<td>가능</td>
</tr>
<tr class="odd">
<td><strong>최소 인스턴스</strong></td>
<td>0 (Consumption)</td>
<td>0~30</td>
</tr>
<tr class="even">
<td><strong>비용</strong></td>
<td>실행 시간 기반</td>
<td>vCPU/메모리 시간</td>
</tr>
</tbody>
</table>
<p><strong>Container Apps 권장 시나리오:</strong> - 실행 시간 &gt; 10분 - WebSocket 또는 gRPC 필요 - 복잡한 종속성 - 지속적인 백그라운드 작업 - Multi-container (사이드카 패턴)</p>
</section>
<section id="환경-설정" class="level2" data-number="2">
<h2 data-number="2" class="anchored" data-anchor-id="환경-설정"><span class="header-section-number">2</span> 환경 설정</h2>
<section id="docker-설치" class="level3" data-number="2.1">
<h3 data-number="2.1" class="anchored" data-anchor-id="docker-설치"><span class="header-section-number">2.1</span> Docker 설치</h3>
<p><strong>Windows:</strong></p>
<div class="sourceCode" id="cb1" style="background: #f1f3f5;"><pre class="sourceCode numberSource powershell number-lines code-with-copy"><code class="sourceCode powershell"><span id="cb1-1"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># Docker Desktop 설치</span></span>
<span id="cb1-2">winget install Docker<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">.</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">DockerDesktop</span></span></code></pre></div>
<p><strong>macOS:</strong></p>
<div class="sourceCode" id="cb2" style="background: #f1f3f5;"><pre class="sourceCode numberSource bash number-lines code-with-copy"><code class="sourceCode bash"><span id="cb2-1"><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">brew</span> install <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">--cask</span> docker</span></code></pre></div>
<p><strong>Linux:</strong></p>
<div class="sourceCode" id="cb3" style="background: #f1f3f5;"><pre class="sourceCode numberSource bash number-lines code-with-copy"><code class="sourceCode bash"><span id="cb3-1"><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">curl</span> <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">-fsSL</span> https://get.docker.com <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">-o</span> get-docker.sh</span>
<span id="cb3-2"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">sudo</span> sh get-docker.sh</span></code></pre></div>
</section>
<section id="azure-cli-확장" class="level3" data-number="2.2">
<h3 data-number="2.2" class="anchored" data-anchor-id="azure-cli-확장"><span class="header-section-number">2.2</span> Azure CLI 확장</h3>
<div class="sourceCode" id="cb4" style="background: #f1f3f5;"><pre class="sourceCode numberSource bash number-lines code-with-copy"><code class="sourceCode bash"><span id="cb4-1"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># Container Apps 확장 설치</span></span>
<span id="cb4-2"><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">az</span> extension add <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">--name</span> containerapp <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">--upgrade</span></span>
<span id="cb4-3"></span>
<span id="cb4-4"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># 확인</span></span>
<span id="cb4-5"><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">az</span> containerapp <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">--version</span></span></code></pre></div>
</section>
</section>
<section id="dockerfile-작성" class="level2" data-number="3">
<h2 data-number="3" class="anchored" data-anchor-id="dockerfile-작성"><span class="header-section-number">3</span> Dockerfile 작성</h2>
<section id="프로젝트-구조" class="level3" data-number="3.1">
<h3 data-number="3.1" class="anchored" data-anchor-id="프로젝트-구조"><span class="header-section-number">3.1</span> 프로젝트 구조</h3>
<pre><code>rag-container/
├── app/
│   ├── __init__.py
│   ├── main.py
│   └── rag.py
├── Dockerfile
├── requirements.txt
└── .dockerignore</code></pre>
</section>
<section id="requirements.txt" class="level3" data-number="3.2">
<h3 data-number="3.2" class="anchored" data-anchor-id="requirements.txt"><span class="header-section-number">3.2</span> requirements.txt</h3>
<div class="sourceCode" id="cb6" style="background: #f1f3f5;"><pre class="sourceCode numberSource txt number-lines code-with-copy"><code class="sourceCode default"><span id="cb6-1">fastapi==0.109.0</span>
<span id="cb6-2">uvicorn[standard]==0.27.0</span>
<span id="cb6-3">langchain==0.1.6</span>
<span id="cb6-4">langchain-openai==0.0.5</span>
<span id="cb6-5">langchain-community==0.0.20</span>
<span id="cb6-6">azure-search-documents==11.4.0</span>
<span id="cb6-7">azure-identity==1.15.0</span>
<span id="cb6-8">python-dotenv==1.0.0</span></code></pre></div>
</section>
<section id="appmain.py" class="level3" data-number="3.3">
<h3 data-number="3.3" class="anchored" data-anchor-id="appmain.py"><span class="header-section-number">3.3</span> app/main.py</h3>
<div class="sourceCode" id="cb7" style="background: #f1f3f5;"><pre class="sourceCode numberSource python number-lines code-with-copy"><code class="sourceCode python"><span id="cb7-1"><span class="im" style="color: #00769E;
background-color: null;
font-style: inherit;">from</span> fastapi <span class="im" style="color: #00769E;
background-color: null;
font-style: inherit;">import</span> FastAPI, HTTPException</span>
<span id="cb7-2"><span class="im" style="color: #00769E;
background-color: null;
font-style: inherit;">from</span> pydantic <span class="im" style="color: #00769E;
background-color: null;
font-style: inherit;">import</span> BaseModel</span>
<span id="cb7-3"><span class="im" style="color: #00769E;
background-color: null;
font-style: inherit;">import</span> os</span>
<span id="cb7-4"><span class="im" style="color: #00769E;
background-color: null;
font-style: inherit;">from</span> app.rag <span class="im" style="color: #00769E;
background-color: null;
font-style: inherit;">import</span> RAGSystem</span>
<span id="cb7-5"></span>
<span id="cb7-6">app <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> FastAPI(title<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"RAG API"</span>, version<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"1.0.0"</span>)</span>
<span id="cb7-7"></span>
<span id="cb7-8"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># RAG 시스템 초기화</span></span>
<span id="cb7-9">rag <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> RAGSystem()</span>
<span id="cb7-10"></span>
<span id="cb7-11"><span class="kw" style="color: #003B4F;
background-color: null;
font-style: inherit;">class</span> QueryRequest(BaseModel):</span>
<span id="cb7-12">    question: <span class="bu" style="color: null;
background-color: null;
font-style: inherit;">str</span></span>
<span id="cb7-13">    top_k: <span class="bu" style="color: null;
background-color: null;
font-style: inherit;">int</span> <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">3</span></span>
<span id="cb7-14"></span>
<span id="cb7-15"><span class="kw" style="color: #003B4F;
background-color: null;
font-style: inherit;">class</span> QueryResponse(BaseModel):</span>
<span id="cb7-16">    question: <span class="bu" style="color: null;
background-color: null;
font-style: inherit;">str</span></span>
<span id="cb7-17">    answer: <span class="bu" style="color: null;
background-color: null;
font-style: inherit;">str</span></span>
<span id="cb7-18">    sources: <span class="bu" style="color: null;
background-color: null;
font-style: inherit;">list</span>[<span class="bu" style="color: null;
background-color: null;
font-style: inherit;">str</span>]</span>
<span id="cb7-19"></span>
<span id="cb7-20"><span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">@app.get</span>(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"/"</span>)</span>
<span id="cb7-21"><span class="cf" style="color: #003B4F;
background-color: null;
font-style: inherit;">async</span> <span class="kw" style="color: #003B4F;
background-color: null;
font-style: inherit;">def</span> root():</span>
<span id="cb7-22">    <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">"""Health check"""</span></span>
<span id="cb7-23">    <span class="cf" style="color: #003B4F;
background-color: null;
font-style: inherit;">return</span> {<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"status"</span>: <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"healthy"</span>, <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"service"</span>: <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"RAG API"</span>}</span>
<span id="cb7-24"></span>
<span id="cb7-25"><span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">@app.get</span>(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"/health"</span>)</span>
<span id="cb7-26"><span class="cf" style="color: #003B4F;
background-color: null;
font-style: inherit;">async</span> <span class="kw" style="color: #003B4F;
background-color: null;
font-style: inherit;">def</span> health():</span>
<span id="cb7-27">    <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">"""Health probe endpoint"""</span></span>
<span id="cb7-28">    <span class="cf" style="color: #003B4F;
background-color: null;
font-style: inherit;">try</span>:</span>
<span id="cb7-29">        <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># 컴포넌트 상태 확인</span></span>
<span id="cb7-30">        <span class="cf" style="color: #003B4F;
background-color: null;
font-style: inherit;">if</span> rag.is_initialized():</span>
<span id="cb7-31">            <span class="cf" style="color: #003B4F;
background-color: null;
font-style: inherit;">return</span> {<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"status"</span>: <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"healthy"</span>}</span>
<span id="cb7-32">        <span class="cf" style="color: #003B4F;
background-color: null;
font-style: inherit;">else</span>:</span>
<span id="cb7-33">            <span class="cf" style="color: #003B4F;
background-color: null;
font-style: inherit;">return</span> {<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"status"</span>: <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"initializing"</span>}</span>
<span id="cb7-34">    <span class="cf" style="color: #003B4F;
background-color: null;
font-style: inherit;">except</span> <span class="pp" style="color: #AD0000;
background-color: null;
font-style: inherit;">Exception</span> <span class="im" style="color: #00769E;
background-color: null;
font-style: inherit;">as</span> e:</span>
<span id="cb7-35">        <span class="cf" style="color: #003B4F;
background-color: null;
font-style: inherit;">return</span> {<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"status"</span>: <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"unhealthy"</span>, <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"error"</span>: <span class="bu" style="color: null;
background-color: null;
font-style: inherit;">str</span>(e)}</span>
<span id="cb7-36"></span>
<span id="cb7-37"><span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">@app.post</span>(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"/query"</span>, response_model<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span>QueryResponse)</span>
<span id="cb7-38"><span class="cf" style="color: #003B4F;
background-color: null;
font-style: inherit;">async</span> <span class="kw" style="color: #003B4F;
background-color: null;
font-style: inherit;">def</span> query(request: QueryRequest):</span>
<span id="cb7-39">    <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">"""RAG 쿼리 엔드포인트"""</span></span>
<span id="cb7-40">    <span class="cf" style="color: #003B4F;
background-color: null;
font-style: inherit;">try</span>:</span>
<span id="cb7-41">        result <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> rag.query(</span>
<span id="cb7-42">            question<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span>request.question,</span>
<span id="cb7-43">            top_k<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span>request.top_k</span>
<span id="cb7-44">        )</span>
<span id="cb7-45">        <span class="cf" style="color: #003B4F;
background-color: null;
font-style: inherit;">return</span> QueryResponse(</span>
<span id="cb7-46">            question<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span>request.question,</span>
<span id="cb7-47">            answer<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span>result[<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"answer"</span>],</span>
<span id="cb7-48">            sources<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span>result[<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"sources"</span>]</span>
<span id="cb7-49">        )</span>
<span id="cb7-50">    <span class="cf" style="color: #003B4F;
background-color: null;
font-style: inherit;">except</span> <span class="pp" style="color: #AD0000;
background-color: null;
font-style: inherit;">Exception</span> <span class="im" style="color: #00769E;
background-color: null;
font-style: inherit;">as</span> e:</span>
<span id="cb7-51">        <span class="cf" style="color: #003B4F;
background-color: null;
font-style: inherit;">raise</span> HTTPException(status_code<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">500</span>, detail<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span><span class="bu" style="color: null;
background-color: null;
font-style: inherit;">str</span>(e))</span>
<span id="cb7-52"></span>
<span id="cb7-53"><span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">@app.post</span>(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"/stream"</span>)</span>
<span id="cb7-54"><span class="cf" style="color: #003B4F;
background-color: null;
font-style: inherit;">async</span> <span class="kw" style="color: #003B4F;
background-color: null;
font-style: inherit;">def</span> stream_query(request: QueryRequest):</span>
<span id="cb7-55">    <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">"""스트리밍 응답"""</span></span>
<span id="cb7-56">    <span class="im" style="color: #00769E;
background-color: null;
font-style: inherit;">from</span> fastapi.responses <span class="im" style="color: #00769E;
background-color: null;
font-style: inherit;">import</span> StreamingResponse</span>
<span id="cb7-57">    </span>
<span id="cb7-58">    <span class="cf" style="color: #003B4F;
background-color: null;
font-style: inherit;">async</span> <span class="kw" style="color: #003B4F;
background-color: null;
font-style: inherit;">def</span> generate():</span>
<span id="cb7-59">        <span class="cf" style="color: #003B4F;
background-color: null;
font-style: inherit;">async</span> <span class="cf" style="color: #003B4F;
background-color: null;
font-style: inherit;">for</span> chunk <span class="kw" style="color: #003B4F;
background-color: null;
font-style: inherit;">in</span> rag.stream_query(request.question):</span>
<span id="cb7-60">            <span class="cf" style="color: #003B4F;
background-color: null;
font-style: inherit;">yield</span> <span class="ss" style="color: #20794D;
background-color: null;
font-style: inherit;">f"data: </span><span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">{</span>chunk<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">}</span><span class="ch" style="color: #20794D;
background-color: null;
font-style: inherit;">\n\n</span><span class="ss" style="color: #20794D;
background-color: null;
font-style: inherit;">"</span></span>
<span id="cb7-61">    </span>
<span id="cb7-62">    <span class="cf" style="color: #003B4F;
background-color: null;
font-style: inherit;">return</span> StreamingResponse(generate(), media_type<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"text/event-stream"</span>)</span></code></pre></div>
</section>
<section id="apprag.py" class="level3" data-number="3.4">
<h3 data-number="3.4" class="anchored" data-anchor-id="apprag.py"><span class="header-section-number">3.4</span> app/rag.py</h3>
<div class="sourceCode" id="cb8" style="background: #f1f3f5;"><pre class="sourceCode numberSource python number-lines code-with-copy"><code class="sourceCode python"><span id="cb8-1"><span class="im" style="color: #00769E;
background-color: null;
font-style: inherit;">import</span> os</span>
<span id="cb8-2"><span class="im" style="color: #00769E;
background-color: null;
font-style: inherit;">from</span> langchain_openai <span class="im" style="color: #00769E;
background-color: null;
font-style: inherit;">import</span> AzureOpenAIEmbeddings, AzureChatOpenAI</span>
<span id="cb8-3"><span class="im" style="color: #00769E;
background-color: null;
font-style: inherit;">from</span> langchain_community.vectorstores.azuresearch <span class="im" style="color: #00769E;
background-color: null;
font-style: inherit;">import</span> AzureSearch</span>
<span id="cb8-4"><span class="im" style="color: #00769E;
background-color: null;
font-style: inherit;">from</span> langchain_core.prompts <span class="im" style="color: #00769E;
background-color: null;
font-style: inherit;">import</span> ChatPromptTemplate</span>
<span id="cb8-5"><span class="im" style="color: #00769E;
background-color: null;
font-style: inherit;">from</span> langchain_core.output_parsers <span class="im" style="color: #00769E;
background-color: null;
font-style: inherit;">import</span> StrOutputParser</span>
<span id="cb8-6"><span class="im" style="color: #00769E;
background-color: null;
font-style: inherit;">from</span> langchain_core.runnables <span class="im" style="color: #00769E;
background-color: null;
font-style: inherit;">import</span> RunnablePassthrough</span>
<span id="cb8-7"></span>
<span id="cb8-8"><span class="kw" style="color: #003B4F;
background-color: null;
font-style: inherit;">class</span> RAGSystem:</span>
<span id="cb8-9">    <span class="kw" style="color: #003B4F;
background-color: null;
font-style: inherit;">def</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">__init__</span>(<span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">self</span>):</span>
<span id="cb8-10">        <span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">self</span>._initialized <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> <span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">False</span></span>
<span id="cb8-11">        <span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">self</span>._init_components()</span>
<span id="cb8-12">    </span>
<span id="cb8-13">    <span class="kw" style="color: #003B4F;
background-color: null;
font-style: inherit;">def</span> _init_components(<span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">self</span>):</span>
<span id="cb8-14">        <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">"""RAG 컴포넌트 초기화"""</span></span>
<span id="cb8-15">        <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># Embeddings</span></span>
<span id="cb8-16">        <span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">self</span>.embeddings <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> AzureOpenAIEmbeddings(</span>
<span id="cb8-17">            azure_deployment<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"text-embedding-3-small"</span>,</span>
<span id="cb8-18">            openai_api_version<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span>os.getenv(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"AZURE_OPENAI_API_VERSION"</span>),</span>
<span id="cb8-19">            azure_endpoint<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span>os.getenv(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"AZURE_OPENAI_ENDPOINT"</span>),</span>
<span id="cb8-20">            api_key<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span>os.getenv(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"AZURE_OPENAI_API_KEY"</span>)</span>
<span id="cb8-21">        )</span>
<span id="cb8-22">        </span>
<span id="cb8-23">        <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># Vector Store</span></span>
<span id="cb8-24">        <span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">self</span>.vector_store <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> AzureSearch(</span>
<span id="cb8-25">            azure_search_endpoint<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span>os.getenv(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"AZURE_SEARCH_ENDPOINT"</span>),</span>
<span id="cb8-26">            azure_search_key<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span>os.getenv(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"AZURE_SEARCH_API_KEY"</span>),</span>
<span id="cb8-27">            index_name<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span>os.getenv(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"AZURE_SEARCH_INDEX_NAME"</span>),</span>
<span id="cb8-28">            embedding_function<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span><span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">self</span>.embeddings.embed_query</span>
<span id="cb8-29">        )</span>
<span id="cb8-30">        </span>
<span id="cb8-31">        <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># LLM</span></span>
<span id="cb8-32">        <span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">self</span>.llm <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> AzureChatOpenAI(</span>
<span id="cb8-33">            azure_deployment<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span>os.getenv(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"AZURE_OPENAI_DEPLOYMENT"</span>),</span>
<span id="cb8-34">            openai_api_version<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span>os.getenv(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"AZURE_OPENAI_API_VERSION"</span>),</span>
<span id="cb8-35">            azure_endpoint<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span>os.getenv(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"AZURE_OPENAI_ENDPOINT"</span>),</span>
<span id="cb8-36">            api_key<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span>os.getenv(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"AZURE_OPENAI_API_KEY"</span>),</span>
<span id="cb8-37">            temperature<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">0</span></span>
<span id="cb8-38">        )</span>
<span id="cb8-39">        </span>
<span id="cb8-40">        <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># Retriever</span></span>
<span id="cb8-41">        <span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">self</span>.retriever <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> <span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">self</span>.vector_store.as_retriever(</span>
<span id="cb8-42">            search_kwargs<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span>{<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"k"</span>: <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">3</span>}</span>
<span id="cb8-43">        )</span>
<span id="cb8-44">        </span>
<span id="cb8-45">        <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># Prompt</span></span>
<span id="cb8-46">        prompt <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> ChatPromptTemplate.from_template(</span>
<span id="cb8-47">            <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"""다음 컨텍스트를 참고하여 질문에 답변하세요.</span></span>
<span id="cb8-48"></span>
<span id="cb8-49"><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">컨텍스트:</span></span>
<span id="cb8-50"><span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">{context}</span></span>
<span id="cb8-51"></span>
<span id="cb8-52"><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">질문: </span><span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">{question}</span></span>
<span id="cb8-53"></span>
<span id="cb8-54"><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">답변:"""</span></span>
<span id="cb8-55">        )</span>
<span id="cb8-56">        </span>
<span id="cb8-57">        <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># RAG Chain</span></span>
<span id="cb8-58">        <span class="kw" style="color: #003B4F;
background-color: null;
font-style: inherit;">def</span> format_docs(docs):</span>
<span id="cb8-59">            <span class="cf" style="color: #003B4F;
background-color: null;
font-style: inherit;">return</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"</span><span class="ch" style="color: #20794D;
background-color: null;
font-style: inherit;">\n\n</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"</span>.join([doc.page_content <span class="cf" style="color: #003B4F;
background-color: null;
font-style: inherit;">for</span> doc <span class="kw" style="color: #003B4F;
background-color: null;
font-style: inherit;">in</span> docs])</span>
<span id="cb8-60">        </span>
<span id="cb8-61">        <span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">self</span>.rag_chain <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> (</span>
<span id="cb8-62">            {<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"context"</span>: <span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">self</span>.retriever <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">|</span> format_docs, <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"question"</span>: RunnablePassthrough()}</span>
<span id="cb8-63">            <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">|</span> prompt</span>
<span id="cb8-64">            <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">|</span> <span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">self</span>.llm</span>
<span id="cb8-65">            <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">|</span> StrOutputParser()</span>
<span id="cb8-66">        )</span>
<span id="cb8-67">        </span>
<span id="cb8-68">        <span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">self</span>._initialized <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> <span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">True</span></span>
<span id="cb8-69">    </span>
<span id="cb8-70">    <span class="kw" style="color: #003B4F;
background-color: null;
font-style: inherit;">def</span> is_initialized(<span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">self</span>) <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">-&gt;</span> <span class="bu" style="color: null;
background-color: null;
font-style: inherit;">bool</span>:</span>
<span id="cb8-71">        <span class="cf" style="color: #003B4F;
background-color: null;
font-style: inherit;">return</span> <span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">self</span>._initialized</span>
<span id="cb8-72">    </span>
<span id="cb8-73">    <span class="kw" style="color: #003B4F;
background-color: null;
font-style: inherit;">def</span> query(<span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">self</span>, question: <span class="bu" style="color: null;
background-color: null;
font-style: inherit;">str</span>, top_k: <span class="bu" style="color: null;
background-color: null;
font-style: inherit;">int</span> <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">3</span>) <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">-&gt;</span> <span class="bu" style="color: null;
background-color: null;
font-style: inherit;">dict</span>:</span>
<span id="cb8-74">        <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">"""RAG 쿼리 실행"""</span></span>
<span id="cb8-75">        <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># 문서 검색</span></span>
<span id="cb8-76">        docs <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> <span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">self</span>.retriever.invoke(question)</span>
<span id="cb8-77">        </span>
<span id="cb8-78">        <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># 답변 생성</span></span>
<span id="cb8-79">        answer <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> <span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">self</span>.rag_chain.invoke(question)</span>
<span id="cb8-80">        </span>
<span id="cb8-81">        <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># 출처 추출</span></span>
<span id="cb8-82">        sources <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> [doc.metadata.get(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"source"</span>, <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Unknown"</span>) <span class="cf" style="color: #003B4F;
background-color: null;
font-style: inherit;">for</span> doc <span class="kw" style="color: #003B4F;
background-color: null;
font-style: inherit;">in</span> docs]</span>
<span id="cb8-83">        </span>
<span id="cb8-84">        <span class="cf" style="color: #003B4F;
background-color: null;
font-style: inherit;">return</span> {</span>
<span id="cb8-85">            <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"answer"</span>: answer,</span>
<span id="cb8-86">            <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"sources"</span>: sources</span>
<span id="cb8-87">        }</span>
<span id="cb8-88">    </span>
<span id="cb8-89">    <span class="cf" style="color: #003B4F;
background-color: null;
font-style: inherit;">async</span> <span class="kw" style="color: #003B4F;
background-color: null;
font-style: inherit;">def</span> stream_query(<span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">self</span>, question: <span class="bu" style="color: null;
background-color: null;
font-style: inherit;">str</span>):</span>
<span id="cb8-90">        <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">"""스트리밍 쿼리"""</span></span>
<span id="cb8-91">        <span class="cf" style="color: #003B4F;
background-color: null;
font-style: inherit;">async</span> <span class="cf" style="color: #003B4F;
background-color: null;
font-style: inherit;">for</span> chunk <span class="kw" style="color: #003B4F;
background-color: null;
font-style: inherit;">in</span> <span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">self</span>.rag_chain.astream(question):</span>
<span id="cb8-92">            <span class="cf" style="color: #003B4F;
background-color: null;
font-style: inherit;">yield</span> chunk</span></code></pre></div>
</section>
<section id="dockerfile" class="level3" data-number="3.5">
<h3 data-number="3.5" class="anchored" data-anchor-id="dockerfile"><span class="header-section-number">3.5</span> Dockerfile</h3>
<div class="sourceCode" id="cb9" style="background: #f1f3f5;"><pre class="sourceCode numberSource dockerfile number-lines code-with-copy"><code class="sourceCode dockerfile"><span id="cb9-1"><span class="kw" style="color: #003B4F;
background-color: null;
font-style: inherit;">FROM</span> python:3.11-slim</span>
<span id="cb9-2"></span>
<span id="cb9-3"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># 작업 디렉토리</span></span>
<span id="cb9-4"><span class="kw" style="color: #003B4F;
background-color: null;
font-style: inherit;">WORKDIR</span> /app</span>
<span id="cb9-5"></span>
<span id="cb9-6"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># 시스템 패키지 업데이트</span></span>
<span id="cb9-7"><span class="kw" style="color: #003B4F;
background-color: null;
font-style: inherit;">RUN</span> <span class="ex" style="color: null;
background-color: null;
font-style: inherit;">apt-get</span> update <span class="kw" style="color: #003B4F;
background-color: null;
font-style: inherit;">&amp;&amp;</span> <span class="ex" style="color: null;
background-color: null;
font-style: inherit;">apt-get</span> install <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">-y</span> <span class="dt" style="color: #AD0000;
background-color: null;
font-style: inherit;">\</span></span>
<span id="cb9-8">    build-essential <span class="dt" style="color: #AD0000;
background-color: null;
font-style: inherit;">\</span></span>
<span id="cb9-9">    curl <span class="dt" style="color: #AD0000;
background-color: null;
font-style: inherit;">\</span></span>
<span id="cb9-10">    <span class="kw" style="color: #003B4F;
background-color: null;
font-style: inherit;">&amp;&amp;</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">rm</span> <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">-rf</span> /var/lib/apt/lists/<span class="pp" style="color: #AD0000;
background-color: null;
font-style: inherit;">*</span></span>
<span id="cb9-11"></span>
<span id="cb9-12"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># Python 종속성 설치</span></span>
<span id="cb9-13"><span class="kw" style="color: #003B4F;
background-color: null;
font-style: inherit;">COPY</span> requirements.txt .</span>
<span id="cb9-14"><span class="kw" style="color: #003B4F;
background-color: null;
font-style: inherit;">RUN</span> <span class="ex" style="color: null;
background-color: null;
font-style: inherit;">pip</span> install <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">--no-cache-dir</span> <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">-r</span> requirements.txt</span>
<span id="cb9-15"></span>
<span id="cb9-16"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># 애플리케이션 코드 복사</span></span>
<span id="cb9-17"><span class="kw" style="color: #003B4F;
background-color: null;
font-style: inherit;">COPY</span> ./app ./app</span>
<span id="cb9-18"></span>
<span id="cb9-19"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># 포트 노출</span></span>
<span id="cb9-20"><span class="kw" style="color: #003B4F;
background-color: null;
font-style: inherit;">EXPOSE</span> 8000</span>
<span id="cb9-21"></span>
<span id="cb9-22"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># Health check</span></span>
<span id="cb9-23"><span class="kw" style="color: #003B4F;
background-color: null;
font-style: inherit;">HEALTHCHECK</span> <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">--interval=30s</span> <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">--timeout=3s</span> <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">--start-period=5s</span> <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">--retries=3</span> \</span>
<span id="cb9-24">  <span class="kw" style="color: #003B4F;
background-color: null;
font-style: inherit;">CMD</span> <span class="ex" style="color: null;
background-color: null;
font-style: inherit;">curl</span> <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">-f</span> http://localhost:8000/health <span class="kw" style="color: #003B4F;
background-color: null;
font-style: inherit;">||</span> <span class="bu" style="color: null;
background-color: null;
font-style: inherit;">exit</span> 1</span>
<span id="cb9-25"></span>
<span id="cb9-26"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># 애플리케이션 실행</span></span>
<span id="cb9-27"><span class="kw" style="color: #003B4F;
background-color: null;
font-style: inherit;">CMD</span> [<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"uvicorn"</span>, <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"app.main:app"</span>, <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"--host"</span>, <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"0.0.0.0"</span>, <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"--port"</span>, <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"8000"</span>]</span></code></pre></div>
</section>
<section id="dockerignore" class="level3" data-number="3.6">
<h3 data-number="3.6" class="anchored" data-anchor-id="dockerignore"><span class="header-section-number">3.6</span> .dockerignore</h3>
<pre><code>__pycache__
*.pyc
*.pyo
*.pyd
.Python
env/
venv/
.venv/
.git
.gitignore
.dockerignore
Dockerfile
README.md
.env</code></pre>
</section>
</section>
<section id="로컬-테스트" class="level2" data-number="4">
<h2 data-number="4" class="anchored" data-anchor-id="로컬-테스트"><span class="header-section-number">4</span> 로컬 테스트</h2>
<section id="docker-빌드-및-실행" class="level3" data-number="4.1">
<h3 data-number="4.1" class="anchored" data-anchor-id="docker-빌드-및-실행"><span class="header-section-number">4.1</span> Docker 빌드 및 실행</h3>
<div class="sourceCode" id="cb11" style="background: #f1f3f5;"><pre class="sourceCode numberSource bash number-lines code-with-copy"><code class="sourceCode bash"><span id="cb11-1"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># 이미지 빌드</span></span>
<span id="cb11-2"><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">docker</span> build <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">-t</span> rag-api:latest .</span>
<span id="cb11-3"></span>
<span id="cb11-4"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># 로컬 실행</span></span>
<span id="cb11-5"><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">docker</span> run <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">-p</span> 8000:8000 <span class="dt" style="color: #AD0000;
background-color: null;
font-style: inherit;">\</span></span>
<span id="cb11-6">  <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">-e</span> AZURE_OPENAI_ENDPOINT=<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"https://openai-rag.openai.azure.com/"</span> <span class="dt" style="color: #AD0000;
background-color: null;
font-style: inherit;">\</span></span>
<span id="cb11-7">  <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">-e</span> AZURE_OPENAI_API_KEY=<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"your-key"</span> <span class="dt" style="color: #AD0000;
background-color: null;
font-style: inherit;">\</span></span>
<span id="cb11-8">  <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">-e</span> AZURE_OPENAI_DEPLOYMENT=<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"gpt-4o"</span> <span class="dt" style="color: #AD0000;
background-color: null;
font-style: inherit;">\</span></span>
<span id="cb11-9">  <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">-e</span> AZURE_OPENAI_API_VERSION=<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"2024-02-01"</span> <span class="dt" style="color: #AD0000;
background-color: null;
font-style: inherit;">\</span></span>
<span id="cb11-10">  <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">-e</span> AZURE_SEARCH_ENDPOINT=<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"https://search-rag.search.windows.net"</span> <span class="dt" style="color: #AD0000;
background-color: null;
font-style: inherit;">\</span></span>
<span id="cb11-11">  <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">-e</span> AZURE_SEARCH_API_KEY=<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"your-key"</span> <span class="dt" style="color: #AD0000;
background-color: null;
font-style: inherit;">\</span></span>
<span id="cb11-12">  <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">-e</span> AZURE_SEARCH_INDEX_NAME=<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"rag-documents"</span> <span class="dt" style="color: #AD0000;
background-color: null;
font-style: inherit;">\</span></span>
<span id="cb11-13">  rag-api:latest</span>
<span id="cb11-14"></span>
<span id="cb11-15"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># Health check</span></span>
<span id="cb11-16"><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">curl</span> http://localhost:8000/health</span>
<span id="cb11-17"></span>
<span id="cb11-18"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># 쿼리 테스트</span></span>
<span id="cb11-19"><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">curl</span> <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">-X</span> POST http://localhost:8000/query <span class="dt" style="color: #AD0000;
background-color: null;
font-style: inherit;">\</span></span>
<span id="cb11-20">  <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">-H</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Content-Type: application/json"</span> <span class="dt" style="color: #AD0000;
background-color: null;
font-style: inherit;">\</span></span>
<span id="cb11-21">  <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">-d</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">'{"question": "Azure AI Search란?"}'</span></span></code></pre></div>
</section>
<section id="docker-compose.yml-개발용" class="level3" data-number="4.2">
<h3 data-number="4.2" class="anchored" data-anchor-id="docker-compose.yml-개발용"><span class="header-section-number">4.2</span> docker-compose.yml (개발용)</h3>
<div class="sourceCode" id="cb12" style="background: #f1f3f5;"><pre class="sourceCode numberSource yaml number-lines code-with-copy"><code class="sourceCode yaml"><span id="cb12-1"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">version</span><span class="kw" style="color: #003B4F;
background-color: null;
font-style: inherit;">:</span><span class="at" style="color: #657422;
background-color: null;
font-style: inherit;"> </span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">'3.8'</span></span>
<span id="cb12-2"></span>
<span id="cb12-3"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">services</span><span class="kw" style="color: #003B4F;
background-color: null;
font-style: inherit;">:</span></span>
<span id="cb12-4"><span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">  </span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">rag-api</span><span class="kw" style="color: #003B4F;
background-color: null;
font-style: inherit;">:</span></span>
<span id="cb12-5"><span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">    </span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">build</span><span class="kw" style="color: #003B4F;
background-color: null;
font-style: inherit;">:</span><span class="at" style="color: #657422;
background-color: null;
font-style: inherit;"> .</span></span>
<span id="cb12-6"><span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">    </span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">ports</span><span class="kw" style="color: #003B4F;
background-color: null;
font-style: inherit;">:</span></span>
<span id="cb12-7"><span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">      </span><span class="kw" style="color: #003B4F;
background-color: null;
font-style: inherit;">-</span><span class="at" style="color: #657422;
background-color: null;
font-style: inherit;"> </span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"8000:8000"</span></span>
<span id="cb12-8"><span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">    </span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">environment</span><span class="kw" style="color: #003B4F;
background-color: null;
font-style: inherit;">:</span></span>
<span id="cb12-9"><span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">      </span><span class="kw" style="color: #003B4F;
background-color: null;
font-style: inherit;">-</span><span class="at" style="color: #657422;
background-color: null;
font-style: inherit;"> AZURE_OPENAI_ENDPOINT=${AZURE_OPENAI_ENDPOINT}</span></span>
<span id="cb12-10"><span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">      </span><span class="kw" style="color: #003B4F;
background-color: null;
font-style: inherit;">-</span><span class="at" style="color: #657422;
background-color: null;
font-style: inherit;"> AZURE_OPENAI_API_KEY=${AZURE_OPENAI_API_KEY}</span></span>
<span id="cb12-11"><span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">      </span><span class="kw" style="color: #003B4F;
background-color: null;
font-style: inherit;">-</span><span class="at" style="color: #657422;
background-color: null;
font-style: inherit;"> AZURE_OPENAI_DEPLOYMENT=${AZURE_OPENAI_DEPLOYMENT}</span></span>
<span id="cb12-12"><span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">      </span><span class="kw" style="color: #003B4F;
background-color: null;
font-style: inherit;">-</span><span class="at" style="color: #657422;
background-color: null;
font-style: inherit;"> AZURE_OPENAI_API_VERSION=2024-02-01</span></span>
<span id="cb12-13"><span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">      </span><span class="kw" style="color: #003B4F;
background-color: null;
font-style: inherit;">-</span><span class="at" style="color: #657422;
background-color: null;
font-style: inherit;"> AZURE_SEARCH_ENDPOINT=${AZURE_SEARCH_ENDPOINT}</span></span>
<span id="cb12-14"><span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">      </span><span class="kw" style="color: #003B4F;
background-color: null;
font-style: inherit;">-</span><span class="at" style="color: #657422;
background-color: null;
font-style: inherit;"> AZURE_SEARCH_API_KEY=${AZURE_SEARCH_API_KEY}</span></span>
<span id="cb12-15"><span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">      </span><span class="kw" style="color: #003B4F;
background-color: null;
font-style: inherit;">-</span><span class="at" style="color: #657422;
background-color: null;
font-style: inherit;"> AZURE_SEARCH_INDEX_NAME=${AZURE_SEARCH_INDEX_NAME}</span></span>
<span id="cb12-16"><span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">    </span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">volumes</span><span class="kw" style="color: #003B4F;
background-color: null;
font-style: inherit;">:</span></span>
<span id="cb12-17"><span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">      </span><span class="kw" style="color: #003B4F;
background-color: null;
font-style: inherit;">-</span><span class="at" style="color: #657422;
background-color: null;
font-style: inherit;"> ./app:/app/app</span></span>
<span id="cb12-18"><span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">    </span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">command</span><span class="kw" style="color: #003B4F;
background-color: null;
font-style: inherit;">:</span><span class="at" style="color: #657422;
background-color: null;
font-style: inherit;"> uvicorn app.main:app --host 0.0.0.0 --port 8000 --reload</span></span></code></pre></div>
<p>실행:</p>
<div class="sourceCode" id="cb13" style="background: #f1f3f5;"><pre class="sourceCode numberSource bash number-lines code-with-copy"><code class="sourceCode bash"><span id="cb13-1"><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">docker-compose</span> up</span></code></pre></div>
</section>
</section>
<section id="azure-container-registry" class="level2" data-number="5">
<h2 data-number="5" class="anchored" data-anchor-id="azure-container-registry"><span class="header-section-number">5</span> Azure Container Registry</h2>
<section id="acr-생성" class="level3" data-number="5.1">
<h3 data-number="5.1" class="anchored" data-anchor-id="acr-생성"><span class="header-section-number">5.1</span> ACR 생성</h3>
<div class="sourceCode" id="cb14" style="background: #f1f3f5;"><pre class="sourceCode numberSource bash number-lines code-with-copy"><code class="sourceCode bash"><span id="cb14-1"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># 리소스 그룹 생성</span></span>
<span id="cb14-2"><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">az</span> group create <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">--name</span> rg-rag-prod <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">--location</span> koreacentral</span>
<span id="cb14-3"></span>
<span id="cb14-4"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># Container Registry 생성</span></span>
<span id="cb14-5"><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">az</span> acr create <span class="dt" style="color: #AD0000;
background-color: null;
font-style: inherit;">\</span></span>
<span id="cb14-6">  <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">--resource-group</span> rg-rag-prod <span class="dt" style="color: #AD0000;
background-color: null;
font-style: inherit;">\</span></span>
<span id="cb14-7">  <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">--name</span> acrragprod <span class="dt" style="color: #AD0000;
background-color: null;
font-style: inherit;">\</span></span>
<span id="cb14-8">  <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">--sku</span> Basic <span class="dt" style="color: #AD0000;
background-color: null;
font-style: inherit;">\</span></span>
<span id="cb14-9">  <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">--location</span> koreacentral</span>
<span id="cb14-10"></span>
<span id="cb14-11"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># ACR 로그인</span></span>
<span id="cb14-12"><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">az</span> acr login <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">--name</span> acrragprod</span></code></pre></div>
</section>
<section id="이미지-푸시" class="level3" data-number="5.2">
<h3 data-number="5.2" class="anchored" data-anchor-id="이미지-푸시"><span class="header-section-number">5.2</span> 이미지 푸시</h3>
<div class="sourceCode" id="cb15" style="background: #f1f3f5;"><pre class="sourceCode numberSource bash number-lines code-with-copy"><code class="sourceCode bash"><span id="cb15-1"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># 이미지 태깅</span></span>
<span id="cb15-2"><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">docker</span> tag rag-api:latest acrragprod.azurecr.io/rag-api:latest</span>
<span id="cb15-3"><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">docker</span> tag rag-api:latest acrragprod.azurecr.io/rag-api:v1.0.0</span>
<span id="cb15-4"></span>
<span id="cb15-5"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># 이미지 푸시</span></span>
<span id="cb15-6"><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">docker</span> push acrragprod.azurecr.io/rag-api:latest</span>
<span id="cb15-7"><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">docker</span> push acrragprod.azurecr.io/rag-api:v1.0.0</span>
<span id="cb15-8"></span>
<span id="cb15-9"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># 이미지 확인</span></span>
<span id="cb15-10"><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">az</span> acr repository list <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">--name</span> acrragprod <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">--output</span> table</span>
<span id="cb15-11"><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">az</span> acr repository show-tags <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">--name</span> acrragprod <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">--repository</span> rag-api <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">--output</span> table</span></code></pre></div>
</section>
</section>
<section id="container-apps-environment" class="level2" data-number="6">
<h2 data-number="6" class="anchored" data-anchor-id="container-apps-environment"><span class="header-section-number">6</span> Container Apps Environment</h2>
<section id="environment-생성" class="level3" data-number="6.1">
<h3 data-number="6.1" class="anchored" data-anchor-id="environment-생성"><span class="header-section-number">6.1</span> Environment 생성</h3>
<div class="sourceCode" id="cb16" style="background: #f1f3f5;"><pre class="sourceCode numberSource bash number-lines code-with-copy"><code class="sourceCode bash"><span id="cb16-1"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># Log Analytics Workspace 생성</span></span>
<span id="cb16-2"><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">az</span> monitor log-analytics workspace create <span class="dt" style="color: #AD0000;
background-color: null;
font-style: inherit;">\</span></span>
<span id="cb16-3">  <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">--resource-group</span> rg-rag-prod <span class="dt" style="color: #AD0000;
background-color: null;
font-style: inherit;">\</span></span>
<span id="cb16-4">  <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">--workspace-name</span> law-rag-prod <span class="dt" style="color: #AD0000;
background-color: null;
font-style: inherit;">\</span></span>
<span id="cb16-5">  <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">--location</span> koreacentral</span>
<span id="cb16-6"></span>
<span id="cb16-7"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># Workspace ID 조회</span></span>
<span id="cb16-8"><span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">WORKSPACE_ID</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span><span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">$(</span><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">az</span> monitor log-analytics workspace show <span class="dt" style="color: #AD0000;
background-color: null;
font-style: inherit;">\</span></span>
<span id="cb16-9">  <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">--resource-group</span> rg-rag-prod <span class="dt" style="color: #AD0000;
background-color: null;
font-style: inherit;">\</span></span>
<span id="cb16-10">  <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">--workspace-name</span> law-rag-prod <span class="dt" style="color: #AD0000;
background-color: null;
font-style: inherit;">\</span></span>
<span id="cb16-11">  <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">--query</span> customerId <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">-o</span> tsv<span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">)</span></span>
<span id="cb16-12"></span>
<span id="cb16-13"><span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">WORKSPACE_KEY</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span><span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">$(</span><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">az</span> monitor log-analytics workspace get-shared-keys <span class="dt" style="color: #AD0000;
background-color: null;
font-style: inherit;">\</span></span>
<span id="cb16-14">  <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">--resource-group</span> rg-rag-prod <span class="dt" style="color: #AD0000;
background-color: null;
font-style: inherit;">\</span></span>
<span id="cb16-15">  <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">--workspace-name</span> law-rag-prod <span class="dt" style="color: #AD0000;
background-color: null;
font-style: inherit;">\</span></span>
<span id="cb16-16">  <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">--query</span> primarySharedKey <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">-o</span> tsv<span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">)</span></span>
<span id="cb16-17"></span>
<span id="cb16-18"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># Container Apps Environment 생성</span></span>
<span id="cb16-19"><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">az</span> containerapp env create <span class="dt" style="color: #AD0000;
background-color: null;
font-style: inherit;">\</span></span>
<span id="cb16-20">  <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">--name</span> cae-rag-prod <span class="dt" style="color: #AD0000;
background-color: null;
font-style: inherit;">\</span></span>
<span id="cb16-21">  <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">--resource-group</span> rg-rag-prod <span class="dt" style="color: #AD0000;
background-color: null;
font-style: inherit;">\</span></span>
<span id="cb16-22">  <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">--location</span> koreacentral <span class="dt" style="color: #AD0000;
background-color: null;
font-style: inherit;">\</span></span>
<span id="cb16-23">  <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">--logs-workspace-id</span> <span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">$WORKSPACE_ID</span> <span class="dt" style="color: #AD0000;
background-color: null;
font-style: inherit;">\</span></span>
<span id="cb16-24">  <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">--logs-workspace-key</span> <span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">$WORKSPACE_KEY</span></span></code></pre></div>
</section>
</section>
<section id="container-app-배포" class="level2" data-number="7">
<h2 data-number="7" class="anchored" data-anchor-id="container-app-배포"><span class="header-section-number">7</span> Container App 배포</h2>
<section id="acr-통합" class="level3" data-number="7.1">
<h3 data-number="7.1" class="anchored" data-anchor-id="acr-통합"><span class="header-section-number">7.1</span> ACR 통합</h3>
<div class="sourceCode" id="cb17" style="background: #f1f3f5;"><pre class="sourceCode numberSource bash number-lines code-with-copy"><code class="sourceCode bash"><span id="cb17-1"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># ACR Admin 활성화</span></span>
<span id="cb17-2"><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">az</span> acr update <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">--name</span> acrragprod <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">--admin-enabled</span> true</span>
<span id="cb17-3"></span>
<span id="cb17-4"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># ACR 자격 증명 조회</span></span>
<span id="cb17-5"><span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">ACR_USERNAME</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span><span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">$(</span><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">az</span> acr credential show <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">--name</span> acrragprod <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">--query</span> username <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">-o</span> tsv<span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">)</span></span>
<span id="cb17-6"><span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">ACR_PASSWORD</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span><span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">$(</span><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">az</span> acr credential show <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">--name</span> acrragprod <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">--query</span> passwords<span class="pp" style="color: #AD0000;
background-color: null;
font-style: inherit;">[</span><span class="ss" style="color: #20794D;
background-color: null;
font-style: inherit;">0</span><span class="pp" style="color: #AD0000;
background-color: null;
font-style: inherit;">]</span>.value <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">-o</span> tsv<span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">)</span></span></code></pre></div>
</section>
<section id="container-app-생성" class="level3" data-number="7.2">
<h3 data-number="7.2" class="anchored" data-anchor-id="container-app-생성"><span class="header-section-number">7.2</span> Container App 생성</h3>
<div class="sourceCode" id="cb18" style="background: #f1f3f5;"><pre class="sourceCode numberSource bash number-lines code-with-copy"><code class="sourceCode bash"><span id="cb18-1"><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">az</span> containerapp create <span class="dt" style="color: #AD0000;
background-color: null;
font-style: inherit;">\</span></span>
<span id="cb18-2">  <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">--name</span> ca-rag-api <span class="dt" style="color: #AD0000;
background-color: null;
font-style: inherit;">\</span></span>
<span id="cb18-3">  <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">--resource-group</span> rg-rag-prod <span class="dt" style="color: #AD0000;
background-color: null;
font-style: inherit;">\</span></span>
<span id="cb18-4">  <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">--environment</span> cae-rag-prod <span class="dt" style="color: #AD0000;
background-color: null;
font-style: inherit;">\</span></span>
<span id="cb18-5">  <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">--image</span> acrragprod.azurecr.io/rag-api:latest <span class="dt" style="color: #AD0000;
background-color: null;
font-style: inherit;">\</span></span>
<span id="cb18-6">  <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">--target-port</span> 8000 <span class="dt" style="color: #AD0000;
background-color: null;
font-style: inherit;">\</span></span>
<span id="cb18-7">  <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">--ingress</span> external <span class="dt" style="color: #AD0000;
background-color: null;
font-style: inherit;">\</span></span>
<span id="cb18-8">  <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">--registry-server</span> acrragprod.azurecr.io <span class="dt" style="color: #AD0000;
background-color: null;
font-style: inherit;">\</span></span>
<span id="cb18-9">  <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">--registry-username</span> <span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">$ACR_USERNAME</span> <span class="dt" style="color: #AD0000;
background-color: null;
font-style: inherit;">\</span></span>
<span id="cb18-10">  <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">--registry-password</span> <span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">$ACR_PASSWORD</span> <span class="dt" style="color: #AD0000;
background-color: null;
font-style: inherit;">\</span></span>
<span id="cb18-11">  <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">--cpu</span> 1.0 <span class="dt" style="color: #AD0000;
background-color: null;
font-style: inherit;">\</span></span>
<span id="cb18-12">  <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">--memory</span> 2.0Gi <span class="dt" style="color: #AD0000;
background-color: null;
font-style: inherit;">\</span></span>
<span id="cb18-13">  <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">--min-replicas</span> 0 <span class="dt" style="color: #AD0000;
background-color: null;
font-style: inherit;">\</span></span>
<span id="cb18-14">  <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">--max-replicas</span> 10 <span class="dt" style="color: #AD0000;
background-color: null;
font-style: inherit;">\</span></span>
<span id="cb18-15">  <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">--env-vars</span> <span class="dt" style="color: #AD0000;
background-color: null;
font-style: inherit;">\</span></span>
<span id="cb18-16">    AZURE_OPENAI_ENDPOINT=<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"https://openai-rag.openai.azure.com/"</span> <span class="dt" style="color: #AD0000;
background-color: null;
font-style: inherit;">\</span></span>
<span id="cb18-17">    AZURE_OPENAI_DEPLOYMENT=<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"gpt-4o"</span> <span class="dt" style="color: #AD0000;
background-color: null;
font-style: inherit;">\</span></span>
<span id="cb18-18">    AZURE_OPENAI_API_VERSION=<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"2024-02-01"</span> <span class="dt" style="color: #AD0000;
background-color: null;
font-style: inherit;">\</span></span>
<span id="cb18-19">    AZURE_SEARCH_ENDPOINT=<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"https://search-rag.search.windows.net"</span> <span class="dt" style="color: #AD0000;
background-color: null;
font-style: inherit;">\</span></span>
<span id="cb18-20">    AZURE_SEARCH_INDEX_NAME=<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"rag-documents"</span> <span class="dt" style="color: #AD0000;
background-color: null;
font-style: inherit;">\</span></span>
<span id="cb18-21">  <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">--secrets</span> <span class="dt" style="color: #AD0000;
background-color: null;
font-style: inherit;">\</span></span>
<span id="cb18-22">    azure-openai-key=<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"your-openai-key"</span> <span class="dt" style="color: #AD0000;
background-color: null;
font-style: inherit;">\</span></span>
<span id="cb18-23">    azure-search-key=<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"your-search-key"</span> <span class="dt" style="color: #AD0000;
background-color: null;
font-style: inherit;">\</span></span>
<span id="cb18-24">  <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">--secret-env-vars</span> <span class="dt" style="color: #AD0000;
background-color: null;
font-style: inherit;">\</span></span>
<span id="cb18-25">    AZURE_OPENAI_API_KEY=azure-openai-key <span class="dt" style="color: #AD0000;
background-color: null;
font-style: inherit;">\</span></span>
<span id="cb18-26">    AZURE_SEARCH_API_KEY=azure-search-key</span></code></pre></div>
</section>
<section id="fqdn-확인" class="level3" data-number="7.3">
<h3 data-number="7.3" class="anchored" data-anchor-id="fqdn-확인"><span class="header-section-number">7.3</span> FQDN 확인</h3>
<div class="sourceCode" id="cb19" style="background: #f1f3f5;"><pre class="sourceCode numberSource bash number-lines code-with-copy"><code class="sourceCode bash"><span id="cb19-1"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># Container App FQDN 조회</span></span>
<span id="cb19-2"><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">az</span> containerapp show <span class="dt" style="color: #AD0000;
background-color: null;
font-style: inherit;">\</span></span>
<span id="cb19-3">  <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">--name</span> ca-rag-api <span class="dt" style="color: #AD0000;
background-color: null;
font-style: inherit;">\</span></span>
<span id="cb19-4">  <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">--resource-group</span> rg-rag-prod <span class="dt" style="color: #AD0000;
background-color: null;
font-style: inherit;">\</span></span>
<span id="cb19-5">  <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">--query</span> properties.configuration.ingress.fqdn <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">-o</span> tsv</span>
<span id="cb19-6"></span>
<span id="cb19-7"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># 출력: ca-rag-api.politebeach-12345678.koreacentral.azurecontainerapps.io</span></span></code></pre></div>
</section>
<section id="배포-테스트" class="level3" data-number="7.4">
<h3 data-number="7.4" class="anchored" data-anchor-id="배포-테스트"><span class="header-section-number">7.4</span> 배포 테스트</h3>
<div class="sourceCode" id="cb20" style="background: #f1f3f5;"><pre class="sourceCode numberSource bash number-lines code-with-copy"><code class="sourceCode bash"><span id="cb20-1"><span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">FQDN</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span><span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">$(</span><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">az</span> containerapp show <span class="dt" style="color: #AD0000;
background-color: null;
font-style: inherit;">\</span></span>
<span id="cb20-2">  <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">--name</span> ca-rag-api <span class="dt" style="color: #AD0000;
background-color: null;
font-style: inherit;">\</span></span>
<span id="cb20-3">  <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">--resource-group</span> rg-rag-prod <span class="dt" style="color: #AD0000;
background-color: null;
font-style: inherit;">\</span></span>
<span id="cb20-4">  <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">--query</span> properties.configuration.ingress.fqdn <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">-o</span> tsv<span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">)</span></span>
<span id="cb20-5"></span>
<span id="cb20-6"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># Health check</span></span>
<span id="cb20-7"><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">curl</span> https://<span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">$FQDN</span>/health</span>
<span id="cb20-8"></span>
<span id="cb20-9"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># 쿼리 테스트</span></span>
<span id="cb20-10"><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">curl</span> <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">-X</span> POST https://<span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">$FQDN</span>/query <span class="dt" style="color: #AD0000;
background-color: null;
font-style: inherit;">\</span></span>
<span id="cb20-11">  <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">-H</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Content-Type: application/json"</span> <span class="dt" style="color: #AD0000;
background-color: null;
font-style: inherit;">\</span></span>
<span id="cb20-12">  <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">-d</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">'{"question": "Azure Container Apps란?"}'</span></span></code></pre></div>
</section>
</section>
<section id="스케일링-전략" class="level2" data-number="8">
<h2 data-number="8" class="anchored" data-anchor-id="스케일링-전략"><span class="header-section-number">8</span> 스케일링 전략</h2>
<section id="http-기반-스케일링" class="level3" data-number="8.1">
<h3 data-number="8.1" class="anchored" data-anchor-id="http-기반-스케일링"><span class="header-section-number">8.1</span> HTTP 기반 스케일링</h3>
<div class="sourceCode" id="cb21" style="background: #f1f3f5;"><pre class="sourceCode numberSource bash number-lines code-with-copy"><code class="sourceCode bash"><span id="cb21-1"><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">az</span> containerapp update <span class="dt" style="color: #AD0000;
background-color: null;
font-style: inherit;">\</span></span>
<span id="cb21-2">  <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">--name</span> ca-rag-api <span class="dt" style="color: #AD0000;
background-color: null;
font-style: inherit;">\</span></span>
<span id="cb21-3">  <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">--resource-group</span> rg-rag-prod <span class="dt" style="color: #AD0000;
background-color: null;
font-style: inherit;">\</span></span>
<span id="cb21-4">  <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">--min-replicas</span> 1 <span class="dt" style="color: #AD0000;
background-color: null;
font-style: inherit;">\</span></span>
<span id="cb21-5">  <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">--max-replicas</span> 10 <span class="dt" style="color: #AD0000;
background-color: null;
font-style: inherit;">\</span></span>
<span id="cb21-6">  <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">--scale-rule-name</span> http-rule <span class="dt" style="color: #AD0000;
background-color: null;
font-style: inherit;">\</span></span>
<span id="cb21-7">  <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">--scale-rule-type</span> http <span class="dt" style="color: #AD0000;
background-color: null;
font-style: inherit;">\</span></span>
<span id="cb21-8">  <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">--scale-rule-http-concurrency</span> 50</span></code></pre></div>
<p><strong>설정 의미:</strong> - <code>min-replicas 1</code>: 항상 1개 인스턴스 유지 (Cold Start 방지) - <code>max-replicas 10</code>: 최대 10개까지 확장 - <code>http-concurrency 50</code>: 동시 요청 50개당 1개 인스턴스 추가</p>
</section>
<section id="cpu메모리-기반-스케일링" class="level3" data-number="8.2">
<h3 data-number="8.2" class="anchored" data-anchor-id="cpu메모리-기반-스케일링"><span class="header-section-number">8.2</span> CPU/메모리 기반 스케일링</h3>
<div class="sourceCode" id="cb22" style="background: #f1f3f5;"><pre class="sourceCode numberSource bash number-lines code-with-copy"><code class="sourceCode bash"><span id="cb22-1"><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">az</span> containerapp update <span class="dt" style="color: #AD0000;
background-color: null;
font-style: inherit;">\</span></span>
<span id="cb22-2">  <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">--name</span> ca-rag-api <span class="dt" style="color: #AD0000;
background-color: null;
font-style: inherit;">\</span></span>
<span id="cb22-3">  <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">--resource-group</span> rg-rag-prod <span class="dt" style="color: #AD0000;
background-color: null;
font-style: inherit;">\</span></span>
<span id="cb22-4">  <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">--scale-rule-name</span> cpu-rule <span class="dt" style="color: #AD0000;
background-color: null;
font-style: inherit;">\</span></span>
<span id="cb22-5">  <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">--scale-rule-type</span> cpu <span class="dt" style="color: #AD0000;
background-color: null;
font-style: inherit;">\</span></span>
<span id="cb22-6">  <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">--scale-rule-metadata</span> type=Utilization value=70</span></code></pre></div>
</section>
<section id="커스텀-메트릭-스케일링-keda" class="level3" data-number="8.3">
<h3 data-number="8.3" class="anchored" data-anchor-id="커스텀-메트릭-스케일링-keda"><span class="header-section-number">8.3</span> 커스텀 메트릭 스케일링 (KEDA)</h3>
<p><strong>YAML 정의:</strong></p>
<div class="sourceCode" id="cb23" style="background: #f1f3f5;"><pre class="sourceCode numberSource yaml number-lines code-with-copy"><code class="sourceCode yaml"><span id="cb23-1"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">scaleRules</span><span class="kw" style="color: #003B4F;
background-color: null;
font-style: inherit;">:</span></span>
<span id="cb23-2"><span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">  </span><span class="kw" style="color: #003B4F;
background-color: null;
font-style: inherit;">-</span><span class="at" style="color: #657422;
background-color: null;
font-style: inherit;"> </span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">name</span><span class="kw" style="color: #003B4F;
background-color: null;
font-style: inherit;">:</span><span class="at" style="color: #657422;
background-color: null;
font-style: inherit;"> queue-based-scaling</span></span>
<span id="cb23-3"><span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">    </span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">custom</span><span class="kw" style="color: #003B4F;
background-color: null;
font-style: inherit;">:</span></span>
<span id="cb23-4"><span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">      </span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">type</span><span class="kw" style="color: #003B4F;
background-color: null;
font-style: inherit;">:</span><span class="at" style="color: #657422;
background-color: null;
font-style: inherit;"> azure-queue</span></span>
<span id="cb23-5"><span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">      </span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">metadata</span><span class="kw" style="color: #003B4F;
background-color: null;
font-style: inherit;">:</span></span>
<span id="cb23-6"><span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">        </span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">queueName</span><span class="kw" style="color: #003B4F;
background-color: null;
font-style: inherit;">:</span><span class="at" style="color: #657422;
background-color: null;
font-style: inherit;"> rag-requests</span></span>
<span id="cb23-7"><span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">        </span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">queueLength</span><span class="kw" style="color: #003B4F;
background-color: null;
font-style: inherit;">:</span><span class="at" style="color: #657422;
background-color: null;
font-style: inherit;"> </span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"5"</span></span>
<span id="cb23-8"><span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">        </span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">accountName</span><span class="kw" style="color: #003B4F;
background-color: null;
font-style: inherit;">:</span><span class="at" style="color: #657422;
background-color: null;
font-style: inherit;"> stragprod</span></span>
<span id="cb23-9"><span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">      </span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">auth</span><span class="kw" style="color: #003B4F;
background-color: null;
font-style: inherit;">:</span></span>
<span id="cb23-10"><span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">        </span><span class="kw" style="color: #003B4F;
background-color: null;
font-style: inherit;">-</span><span class="at" style="color: #657422;
background-color: null;
font-style: inherit;"> </span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">secretRef</span><span class="kw" style="color: #003B4F;
background-color: null;
font-style: inherit;">:</span><span class="at" style="color: #657422;
background-color: null;
font-style: inherit;"> queue-connection</span></span>
<span id="cb23-11"><span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">          </span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">triggerParameter</span><span class="kw" style="color: #003B4F;
background-color: null;
font-style: inherit;">:</span><span class="at" style="color: #657422;
background-color: null;
font-style: inherit;"> connection</span></span></code></pre></div>
</section>
</section>
<section id="revision-관리" class="level2" data-number="9">
<h2 data-number="9" class="anchored" data-anchor-id="revision-관리"><span class="header-section-number">9</span> Revision 관리</h2>
<section id="blue-green-배포" class="level3" data-number="9.1">
<h3 data-number="9.1" class="anchored" data-anchor-id="blue-green-배포"><span class="header-section-number">9.1</span> Blue-Green 배포</h3>
<div class="sourceCode" id="cb24" style="background: #f1f3f5;"><pre class="sourceCode numberSource bash number-lines code-with-copy"><code class="sourceCode bash"><span id="cb24-1"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># 새 Revision 배포 (트래픽 0%)</span></span>
<span id="cb24-2"><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">az</span> containerapp update <span class="dt" style="color: #AD0000;
background-color: null;
font-style: inherit;">\</span></span>
<span id="cb24-3">  <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">--name</span> ca-rag-api <span class="dt" style="color: #AD0000;
background-color: null;
font-style: inherit;">\</span></span>
<span id="cb24-4">  <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">--resource-group</span> rg-rag-prod <span class="dt" style="color: #AD0000;
background-color: null;
font-style: inherit;">\</span></span>
<span id="cb24-5">  <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">--image</span> acrragprod.azurecr.io/rag-api:v2.0.0 <span class="dt" style="color: #AD0000;
background-color: null;
font-style: inherit;">\</span></span>
<span id="cb24-6">  <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">--revision-suffix</span> v2</span>
<span id="cb24-7"></span>
<span id="cb24-8"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># Revision 목록 확인</span></span>
<span id="cb24-9"><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">az</span> containerapp revision list <span class="dt" style="color: #AD0000;
background-color: null;
font-style: inherit;">\</span></span>
<span id="cb24-10">  <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">--name</span> ca-rag-api <span class="dt" style="color: #AD0000;
background-color: null;
font-style: inherit;">\</span></span>
<span id="cb24-11">  <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">--resource-group</span> rg-rag-prod <span class="dt" style="color: #AD0000;
background-color: null;
font-style: inherit;">\</span></span>
<span id="cb24-12">  <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">--output</span> table</span>
<span id="cb24-13"></span>
<span id="cb24-14"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># 트래픽 분할 (50:50)</span></span>
<span id="cb24-15"><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">az</span> containerapp ingress traffic set <span class="dt" style="color: #AD0000;
background-color: null;
font-style: inherit;">\</span></span>
<span id="cb24-16">  <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">--name</span> ca-rag-api <span class="dt" style="color: #AD0000;
background-color: null;
font-style: inherit;">\</span></span>
<span id="cb24-17">  <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">--resource-group</span> rg-rag-prod <span class="dt" style="color: #AD0000;
background-color: null;
font-style: inherit;">\</span></span>
<span id="cb24-18">  <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">--revision-weight</span> ca-rag-api--v1=50 ca-rag-api--v2=50</span>
<span id="cb24-19"></span>
<span id="cb24-20"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># 100% v2로 전환</span></span>
<span id="cb24-21"><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">az</span> containerapp ingress traffic set <span class="dt" style="color: #AD0000;
background-color: null;
font-style: inherit;">\</span></span>
<span id="cb24-22">  <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">--name</span> ca-rag-api <span class="dt" style="color: #AD0000;
background-color: null;
font-style: inherit;">\</span></span>
<span id="cb24-23">  <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">--resource-group</span> rg-rag-prod <span class="dt" style="color: #AD0000;
background-color: null;
font-style: inherit;">\</span></span>
<span id="cb24-24">  <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">--revision-weight</span> ca-rag-api--v2=100</span>
<span id="cb24-25"></span>
<span id="cb24-26"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># 이전 Revision 비활성화</span></span>
<span id="cb24-27"><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">az</span> containerapp revision deactivate <span class="dt" style="color: #AD0000;
background-color: null;
font-style: inherit;">\</span></span>
<span id="cb24-28">  <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">--name</span> ca-rag-api <span class="dt" style="color: #AD0000;
background-color: null;
font-style: inherit;">\</span></span>
<span id="cb24-29">  <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">--resource-group</span> rg-rag-prod <span class="dt" style="color: #AD0000;
background-color: null;
font-style: inherit;">\</span></span>
<span id="cb24-30">  <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">--revision</span> ca-rag-api--v1</span></code></pre></div>
</section>
<section id="롤백" class="level3" data-number="9.2">
<h3 data-number="9.2" class="anchored" data-anchor-id="롤백"><span class="header-section-number">9.2</span> 롤백</h3>
<div class="sourceCode" id="cb25" style="background: #f1f3f5;"><pre class="sourceCode numberSource bash number-lines code-with-copy"><code class="sourceCode bash"><span id="cb25-1"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># 즉시 롤백</span></span>
<span id="cb25-2"><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">az</span> containerapp ingress traffic set <span class="dt" style="color: #AD0000;
background-color: null;
font-style: inherit;">\</span></span>
<span id="cb25-3">  <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">--name</span> ca-rag-api <span class="dt" style="color: #AD0000;
background-color: null;
font-style: inherit;">\</span></span>
<span id="cb25-4">  <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">--resource-group</span> rg-rag-prod <span class="dt" style="color: #AD0000;
background-color: null;
font-style: inherit;">\</span></span>
<span id="cb25-5">  <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">--revision-weight</span> ca-rag-api--v1=100</span></code></pre></div>
</section>
</section>
<section id="멀티-컨테이너-사이드카" class="level2" data-number="10">
<h2 data-number="10" class="anchored" data-anchor-id="멀티-컨테이너-사이드카"><span class="header-section-number">10</span> 멀티 컨테이너 (사이드카)</h2>
<section id="redis-캐시-사이드카" class="level3" data-number="10.1">
<h3 data-number="10.1" class="anchored" data-anchor-id="redis-캐시-사이드카"><span class="header-section-number">10.1</span> Redis 캐시 사이드카</h3>
<p><strong>containerapp.yaml:</strong></p>
<div class="sourceCode" id="cb26" style="background: #f1f3f5;"><pre class="sourceCode numberSource yaml number-lines code-with-copy"><code class="sourceCode yaml"><span id="cb26-1"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">properties</span><span class="kw" style="color: #003B4F;
background-color: null;
font-style: inherit;">:</span></span>
<span id="cb26-2"><span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">  </span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">template</span><span class="kw" style="color: #003B4F;
background-color: null;
font-style: inherit;">:</span></span>
<span id="cb26-3"><span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">    </span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">containers</span><span class="kw" style="color: #003B4F;
background-color: null;
font-style: inherit;">:</span></span>
<span id="cb26-4"><span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">      </span><span class="kw" style="color: #003B4F;
background-color: null;
font-style: inherit;">-</span><span class="at" style="color: #657422;
background-color: null;
font-style: inherit;"> </span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">name</span><span class="kw" style="color: #003B4F;
background-color: null;
font-style: inherit;">:</span><span class="at" style="color: #657422;
background-color: null;
font-style: inherit;"> rag-api</span></span>
<span id="cb26-5"><span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">        </span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">image</span><span class="kw" style="color: #003B4F;
background-color: null;
font-style: inherit;">:</span><span class="at" style="color: #657422;
background-color: null;
font-style: inherit;"> acrragprod.azurecr.io/rag-api:latest</span></span>
<span id="cb26-6"><span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">        </span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">env</span><span class="kw" style="color: #003B4F;
background-color: null;
font-style: inherit;">:</span></span>
<span id="cb26-7"><span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">          </span><span class="kw" style="color: #003B4F;
background-color: null;
font-style: inherit;">-</span><span class="at" style="color: #657422;
background-color: null;
font-style: inherit;"> </span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">name</span><span class="kw" style="color: #003B4F;
background-color: null;
font-style: inherit;">:</span><span class="at" style="color: #657422;
background-color: null;
font-style: inherit;"> REDIS_HOST</span></span>
<span id="cb26-8"><span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">            </span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">value</span><span class="kw" style="color: #003B4F;
background-color: null;
font-style: inherit;">:</span><span class="at" style="color: #657422;
background-color: null;
font-style: inherit;"> localhost</span></span>
<span id="cb26-9"><span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">          </span><span class="kw" style="color: #003B4F;
background-color: null;
font-style: inherit;">-</span><span class="at" style="color: #657422;
background-color: null;
font-style: inherit;"> </span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">name</span><span class="kw" style="color: #003B4F;
background-color: null;
font-style: inherit;">:</span><span class="at" style="color: #657422;
background-color: null;
font-style: inherit;"> REDIS_PORT</span></span>
<span id="cb26-10"><span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">            </span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">value</span><span class="kw" style="color: #003B4F;
background-color: null;
font-style: inherit;">:</span><span class="at" style="color: #657422;
background-color: null;
font-style: inherit;"> </span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"6379"</span></span>
<span id="cb26-11"><span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">        </span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">resources</span><span class="kw" style="color: #003B4F;
background-color: null;
font-style: inherit;">:</span></span>
<span id="cb26-12"><span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">          </span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">cpu</span><span class="kw" style="color: #003B4F;
background-color: null;
font-style: inherit;">:</span><span class="at" style="color: #657422;
background-color: null;
font-style: inherit;"> </span><span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">1.0</span></span>
<span id="cb26-13"><span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">          </span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">memory</span><span class="kw" style="color: #003B4F;
background-color: null;
font-style: inherit;">:</span><span class="at" style="color: #657422;
background-color: null;
font-style: inherit;"> 2.0Gi</span></span>
<span id="cb26-14"><span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">      </span></span>
<span id="cb26-15"><span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">      </span><span class="kw" style="color: #003B4F;
background-color: null;
font-style: inherit;">-</span><span class="at" style="color: #657422;
background-color: null;
font-style: inherit;"> </span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">name</span><span class="kw" style="color: #003B4F;
background-color: null;
font-style: inherit;">:</span><span class="at" style="color: #657422;
background-color: null;
font-style: inherit;"> redis</span></span>
<span id="cb26-16"><span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">        </span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">image</span><span class="kw" style="color: #003B4F;
background-color: null;
font-style: inherit;">:</span><span class="at" style="color: #657422;
background-color: null;
font-style: inherit;"> redis:7-alpine</span></span>
<span id="cb26-17"><span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">        </span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">resources</span><span class="kw" style="color: #003B4F;
background-color: null;
font-style: inherit;">:</span></span>
<span id="cb26-18"><span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">          </span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">cpu</span><span class="kw" style="color: #003B4F;
background-color: null;
font-style: inherit;">:</span><span class="at" style="color: #657422;
background-color: null;
font-style: inherit;"> </span><span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">0.5</span></span>
<span id="cb26-19"><span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">          </span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">memory</span><span class="kw" style="color: #003B4F;
background-color: null;
font-style: inherit;">:</span><span class="at" style="color: #657422;
background-color: null;
font-style: inherit;"> 1.0Gi</span></span></code></pre></div>
<p>배포:</p>
<div class="sourceCode" id="cb27" style="background: #f1f3f5;"><pre class="sourceCode numberSource bash number-lines code-with-copy"><code class="sourceCode bash"><span id="cb27-1"><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">az</span> containerapp create <span class="dt" style="color: #AD0000;
background-color: null;
font-style: inherit;">\</span></span>
<span id="cb27-2">  <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">--name</span> ca-rag-with-cache <span class="dt" style="color: #AD0000;
background-color: null;
font-style: inherit;">\</span></span>
<span id="cb27-3">  <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">--resource-group</span> rg-rag-prod <span class="dt" style="color: #AD0000;
background-color: null;
font-style: inherit;">\</span></span>
<span id="cb27-4">  <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">--environment</span> cae-rag-prod <span class="dt" style="color: #AD0000;
background-color: null;
font-style: inherit;">\</span></span>
<span id="cb27-5">  <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">--yaml</span> containerapp.yaml</span></code></pre></div>
</section>
<section id="캐시-통합-코드" class="level3" data-number="10.2">
<h3 data-number="10.2" class="anchored" data-anchor-id="캐시-통합-코드"><span class="header-section-number">10.2</span> 캐시 통합 코드</h3>
<div class="sourceCode" id="cb28" style="background: #f1f3f5;"><pre class="sourceCode numberSource python number-lines code-with-copy"><code class="sourceCode python"><span id="cb28-1"><span class="im" style="color: #00769E;
background-color: null;
font-style: inherit;">import</span> redis</span>
<span id="cb28-2"><span class="im" style="color: #00769E;
background-color: null;
font-style: inherit;">from</span> functools <span class="im" style="color: #00769E;
background-color: null;
font-style: inherit;">import</span> lru_cache</span>
<span id="cb28-3"></span>
<span id="cb28-4"><span class="kw" style="color: #003B4F;
background-color: null;
font-style: inherit;">class</span> RAGSystemWithCache(RAGSystem):</span>
<span id="cb28-5">    <span class="kw" style="color: #003B4F;
background-color: null;
font-style: inherit;">def</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">__init__</span>(<span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">self</span>):</span>
<span id="cb28-6">        <span class="bu" style="color: null;
background-color: null;
font-style: inherit;">super</span>().<span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">__init__</span>()</span>
<span id="cb28-7">        <span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">self</span>.redis_client <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> redis.Redis(</span>
<span id="cb28-8">            host<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span>os.getenv(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"REDIS_HOST"</span>, <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"localhost"</span>),</span>
<span id="cb28-9">            port<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span><span class="bu" style="color: null;
background-color: null;
font-style: inherit;">int</span>(os.getenv(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"REDIS_PORT"</span>, <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">6379</span>)),</span>
<span id="cb28-10">            decode_responses<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span><span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">True</span></span>
<span id="cb28-11">        )</span>
<span id="cb28-12">    </span>
<span id="cb28-13">    <span class="kw" style="color: #003B4F;
background-color: null;
font-style: inherit;">def</span> query(<span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">self</span>, question: <span class="bu" style="color: null;
background-color: null;
font-style: inherit;">str</span>, top_k: <span class="bu" style="color: null;
background-color: null;
font-style: inherit;">int</span> <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">3</span>) <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">-&gt;</span> <span class="bu" style="color: null;
background-color: null;
font-style: inherit;">dict</span>:</span>
<span id="cb28-14">        <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># 캐시 확인</span></span>
<span id="cb28-15">        cache_key <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> <span class="ss" style="color: #20794D;
background-color: null;
font-style: inherit;">f"rag:</span><span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">{</span>question<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">}</span><span class="ss" style="color: #20794D;
background-color: null;
font-style: inherit;">"</span></span>
<span id="cb28-16">        cached <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> <span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">self</span>.redis_client.get(cache_key)</span>
<span id="cb28-17">        </span>
<span id="cb28-18">        <span class="cf" style="color: #003B4F;
background-color: null;
font-style: inherit;">if</span> cached:</span>
<span id="cb28-19">            <span class="cf" style="color: #003B4F;
background-color: null;
font-style: inherit;">return</span> json.loads(cached)</span>
<span id="cb28-20">        </span>
<span id="cb28-21">        <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># RAG 실행</span></span>
<span id="cb28-22">        result <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> <span class="bu" style="color: null;
background-color: null;
font-style: inherit;">super</span>().query(question, top_k)</span>
<span id="cb28-23">        </span>
<span id="cb28-24">        <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># 캐시 저장 (10분)</span></span>
<span id="cb28-25">        <span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">self</span>.redis_client.setex(cache_key, <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">600</span>, json.dumps(result))</span>
<span id="cb28-26">        </span>
<span id="cb28-27">        <span class="cf" style="color: #003B4F;
background-color: null;
font-style: inherit;">return</span> result</span></code></pre></div>
</section>
</section>
<section id="모니터링" class="level2" data-number="11">
<h2 data-number="11" class="anchored" data-anchor-id="모니터링"><span class="header-section-number">11</span> 모니터링</h2>
<section id="application-insights-통합" class="level3" data-number="11.1">
<h3 data-number="11.1" class="anchored" data-anchor-id="application-insights-통합"><span class="header-section-number">11.1</span> Application Insights 통합</h3>
<div class="sourceCode" id="cb29" style="background: #f1f3f5;"><pre class="sourceCode numberSource bash number-lines code-with-copy"><code class="sourceCode bash"><span id="cb29-1"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># Application Insights 생성</span></span>
<span id="cb29-2"><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">az</span> monitor app-insights component create <span class="dt" style="color: #AD0000;
background-color: null;
font-style: inherit;">\</span></span>
<span id="cb29-3">  <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">--app</span> rag-api-insights <span class="dt" style="color: #AD0000;
background-color: null;
font-style: inherit;">\</span></span>
<span id="cb29-4">  <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">--location</span> koreacentral <span class="dt" style="color: #AD0000;
background-color: null;
font-style: inherit;">\</span></span>
<span id="cb29-5">  <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">--resource-group</span> rg-rag-prod <span class="dt" style="color: #AD0000;
background-color: null;
font-style: inherit;">\</span></span>
<span id="cb29-6">  <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">--workspace</span> law-rag-prod</span>
<span id="cb29-7"></span>
<span id="cb29-8"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># Instrumentation Key 조회</span></span>
<span id="cb29-9"><span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">INSTRUMENTATION_KEY</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span><span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">$(</span><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">az</span> monitor app-insights component show <span class="dt" style="color: #AD0000;
background-color: null;
font-style: inherit;">\</span></span>
<span id="cb29-10">  <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">--app</span> rag-api-insights <span class="dt" style="color: #AD0000;
background-color: null;
font-style: inherit;">\</span></span>
<span id="cb29-11">  <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">--resource-group</span> rg-rag-prod <span class="dt" style="color: #AD0000;
background-color: null;
font-style: inherit;">\</span></span>
<span id="cb29-12">  <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">--query</span> instrumentationKey <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">-o</span> tsv<span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">)</span></span>
<span id="cb29-13"></span>
<span id="cb29-14"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># Container App 업데이트</span></span>
<span id="cb29-15"><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">az</span> containerapp update <span class="dt" style="color: #AD0000;
background-color: null;
font-style: inherit;">\</span></span>
<span id="cb29-16">  <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">--name</span> ca-rag-api <span class="dt" style="color: #AD0000;
background-color: null;
font-style: inherit;">\</span></span>
<span id="cb29-17">  <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">--resource-group</span> rg-rag-prod <span class="dt" style="color: #AD0000;
background-color: null;
font-style: inherit;">\</span></span>
<span id="cb29-18">  <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">--set-env-vars</span> APPLICATIONINSIGHTS_CONNECTION_STRING=<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"InstrumentationKey=</span><span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">$INSTRUMENTATION_KEY</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"</span></span></code></pre></div>
</section>
<section id="opentelemetry-계측" class="level3" data-number="11.2">
<h3 data-number="11.2" class="anchored" data-anchor-id="opentelemetry-계측"><span class="header-section-number">11.2</span> OpenTelemetry 계측</h3>
<p><strong>requirements.txt 추가:</strong></p>
<div class="sourceCode" id="cb30" style="background: #f1f3f5;"><pre class="sourceCode numberSource txt number-lines code-with-copy"><code class="sourceCode default"><span id="cb30-1">opentelemetry-api==1.21.0</span>
<span id="cb30-2">opentelemetry-sdk==1.21.0</span>
<span id="cb30-3">opentelemetry-instrumentation-fastapi==0.42b0</span>
<span id="cb30-4">azure-monitor-opentelemetry-exporter==1.0.0b21</span></code></pre></div>
<p><strong>main.py 수정:</strong></p>
<div class="sourceCode" id="cb31" style="background: #f1f3f5;"><pre class="sourceCode numberSource python number-lines code-with-copy"><code class="sourceCode python"><span id="cb31-1"><span class="im" style="color: #00769E;
background-color: null;
font-style: inherit;">from</span> opentelemetry <span class="im" style="color: #00769E;
background-color: null;
font-style: inherit;">import</span> trace</span>
<span id="cb31-2"><span class="im" style="color: #00769E;
background-color: null;
font-style: inherit;">from</span> opentelemetry.sdk.trace <span class="im" style="color: #00769E;
background-color: null;
font-style: inherit;">import</span> TracerProvider</span>
<span id="cb31-3"><span class="im" style="color: #00769E;
background-color: null;
font-style: inherit;">from</span> opentelemetry.sdk.trace.export <span class="im" style="color: #00769E;
background-color: null;
font-style: inherit;">import</span> BatchSpanProcessor</span>
<span id="cb31-4"><span class="im" style="color: #00769E;
background-color: null;
font-style: inherit;">from</span> azure.monitor.opentelemetry.exporter <span class="im" style="color: #00769E;
background-color: null;
font-style: inherit;">import</span> AzureMonitorTraceExporter</span>
<span id="cb31-5"><span class="im" style="color: #00769E;
background-color: null;
font-style: inherit;">from</span> opentelemetry.instrumentation.fastapi <span class="im" style="color: #00769E;
background-color: null;
font-style: inherit;">import</span> FastAPIInstrumentor</span>
<span id="cb31-6"></span>
<span id="cb31-7"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># Tracer 설정</span></span>
<span id="cb31-8">trace.set_tracer_provider(TracerProvider())</span>
<span id="cb31-9">tracer <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> trace.get_tracer(<span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">__name__</span>)</span>
<span id="cb31-10"></span>
<span id="cb31-11">exporter <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> AzureMonitorTraceExporter.from_connection_string(</span>
<span id="cb31-12">    os.getenv(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"APPLICATIONINSIGHTS_CONNECTION_STRING"</span>)</span>
<span id="cb31-13">)</span>
<span id="cb31-14">trace.get_tracer_provider().add_span_processor(</span>
<span id="cb31-15">    BatchSpanProcessor(exporter)</span>
<span id="cb31-16">)</span>
<span id="cb31-17"></span>
<span id="cb31-18"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># FastAPI 자동 계측</span></span>
<span id="cb31-19">app <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> FastAPI()</span>
<span id="cb31-20">FastAPIInstrumentor.instrument_app(app)</span>
<span id="cb31-21"></span>
<span id="cb31-22"><span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">@app.post</span>(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"/query"</span>)</span>
<span id="cb31-23"><span class="cf" style="color: #003B4F;
background-color: null;
font-style: inherit;">async</span> <span class="kw" style="color: #003B4F;
background-color: null;
font-style: inherit;">def</span> query(request: QueryRequest):</span>
<span id="cb31-24">    <span class="cf" style="color: #003B4F;
background-color: null;
font-style: inherit;">with</span> tracer.start_as_current_span(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"rag_query"</span>) <span class="im" style="color: #00769E;
background-color: null;
font-style: inherit;">as</span> span:</span>
<span id="cb31-25">        span.set_attribute(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"question.length"</span>, <span class="bu" style="color: null;
background-color: null;
font-style: inherit;">len</span>(request.question))</span>
<span id="cb31-26">        result <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> rag.query(request.question)</span>
<span id="cb31-27">        span.set_attribute(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"answer.length"</span>, <span class="bu" style="color: null;
background-color: null;
font-style: inherit;">len</span>(result[<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"answer"</span>]))</span>
<span id="cb31-28">        <span class="cf" style="color: #003B4F;
background-color: null;
font-style: inherit;">return</span> result</span></code></pre></div>
</section>
<section id="로그-쿼리" class="level3" data-number="11.3">
<h3 data-number="11.3" class="anchored" data-anchor-id="로그-쿼리"><span class="header-section-number">11.3</span> 로그 쿼리</h3>
<div class="sourceCode" id="cb32" style="background: #f1f3f5;"><pre class="sourceCode numberSource kusto number-lines code-with-copy"><code class="sourceCode"><span id="cb32-1">// Container App 로그</span>
<span id="cb32-2">ContainerAppConsoleLogs_CL</span>
<span id="cb32-3">| where ContainerAppName_s == "ca-rag-api"</span>
<span id="cb32-4">| where TimeGenerated &gt; ago(1h)</span>
<span id="cb32-5">| order by TimeGenerated desc</span>
<span id="cb32-6">| take 100</span>
<span id="cb32-7"></span>
<span id="cb32-8">// 시스템 로그</span>
<span id="cb32-9">ContainerAppSystemLogs_CL</span>
<span id="cb32-10">| where ContainerAppName_s == "ca-rag-api"</span>
<span id="cb32-11">| where TimeGenerated &gt; ago(1h)</span>
<span id="cb32-12">| project TimeGenerated, Log_s</span>
<span id="cb32-13"></span>
<span id="cb32-14">// HTTP 요청 분석</span>
<span id="cb32-15">requests</span>
<span id="cb32-16">| where cloud_RoleName == "ca-rag-api"</span>
<span id="cb32-17">| summarize </span>
<span id="cb32-18">    Count=count(),</span>
<span id="cb32-19">    AvgDuration=avg(duration),</span>
<span id="cb32-20">    P95Duration=percentile(duration, 95)</span>
<span id="cb32-21">  by bin(timestamp, 5m)</span>
<span id="cb32-22">| render timechart</span></code></pre></div>
</section>
</section>
<section id="cicd-파이프라인" class="level2" data-number="12">
<h2 data-number="12" class="anchored" data-anchor-id="cicd-파이프라인"><span class="header-section-number">12</span> CI/CD 파이프라인</h2>
<section id="github-actions" class="level3" data-number="12.1">
<h3 data-number="12.1" class="anchored" data-anchor-id="github-actions"><span class="header-section-number">12.1</span> GitHub Actions</h3>
<p><strong>.github/workflows/deploy.yml:</strong></p>
<div class="sourceCode" id="cb33" style="background: #f1f3f5;"><pre class="sourceCode numberSource yaml number-lines code-with-copy"><code class="sourceCode yaml"><span id="cb33-1"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">name</span><span class="kw" style="color: #003B4F;
background-color: null;
font-style: inherit;">:</span><span class="at" style="color: #657422;
background-color: null;
font-style: inherit;"> Build and Deploy to Azure Container Apps</span></span>
<span id="cb33-2"></span>
<span id="cb33-3"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">on</span><span class="kw" style="color: #003B4F;
background-color: null;
font-style: inherit;">:</span></span>
<span id="cb33-4"><span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">  </span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">push</span><span class="kw" style="color: #003B4F;
background-color: null;
font-style: inherit;">:</span></span>
<span id="cb33-5"><span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">    </span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">branches</span><span class="kw" style="color: #003B4F;
background-color: null;
font-style: inherit;">:</span></span>
<span id="cb33-6"><span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">      </span><span class="kw" style="color: #003B4F;
background-color: null;
font-style: inherit;">-</span><span class="at" style="color: #657422;
background-color: null;
font-style: inherit;"> main</span></span>
<span id="cb33-7"></span>
<span id="cb33-8"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">env</span><span class="kw" style="color: #003B4F;
background-color: null;
font-style: inherit;">:</span></span>
<span id="cb33-9"><span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">  </span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">AZURE_CONTAINER_REGISTRY</span><span class="kw" style="color: #003B4F;
background-color: null;
font-style: inherit;">:</span><span class="at" style="color: #657422;
background-color: null;
font-style: inherit;"> acrragprod</span></span>
<span id="cb33-10"><span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">  </span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">CONTAINER_APP_NAME</span><span class="kw" style="color: #003B4F;
background-color: null;
font-style: inherit;">:</span><span class="at" style="color: #657422;
background-color: null;
font-style: inherit;"> ca-rag-api</span></span>
<span id="cb33-11"><span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">  </span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">RESOURCE_GROUP</span><span class="kw" style="color: #003B4F;
background-color: null;
font-style: inherit;">:</span><span class="at" style="color: #657422;
background-color: null;
font-style: inherit;"> rg-rag-prod</span></span>
<span id="cb33-12"><span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">  </span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">IMAGE_NAME</span><span class="kw" style="color: #003B4F;
background-color: null;
font-style: inherit;">:</span><span class="at" style="color: #657422;
background-color: null;
font-style: inherit;"> rag-api</span></span>
<span id="cb33-13"></span>
<span id="cb33-14"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">jobs</span><span class="kw" style="color: #003B4F;
background-color: null;
font-style: inherit;">:</span></span>
<span id="cb33-15"><span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">  </span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">build-and-deploy</span><span class="kw" style="color: #003B4F;
background-color: null;
font-style: inherit;">:</span></span>
<span id="cb33-16"><span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">    </span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">runs-on</span><span class="kw" style="color: #003B4F;
background-color: null;
font-style: inherit;">:</span><span class="at" style="color: #657422;
background-color: null;
font-style: inherit;"> ubuntu-latest</span></span>
<span id="cb33-17"><span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">    </span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">steps</span><span class="kw" style="color: #003B4F;
background-color: null;
font-style: inherit;">:</span></span>
<span id="cb33-18"><span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">      </span><span class="kw" style="color: #003B4F;
background-color: null;
font-style: inherit;">-</span><span class="at" style="color: #657422;
background-color: null;
font-style: inherit;"> </span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">name</span><span class="kw" style="color: #003B4F;
background-color: null;
font-style: inherit;">:</span><span class="at" style="color: #657422;
background-color: null;
font-style: inherit;"> Checkout code</span></span>
<span id="cb33-19"><span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">        </span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">uses</span><span class="kw" style="color: #003B4F;
background-color: null;
font-style: inherit;">:</span><span class="at" style="color: #657422;
background-color: null;
font-style: inherit;"> actions/checkout@v4</span></span>
<span id="cb33-20"><span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">      </span></span>
<span id="cb33-21"><span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">      </span><span class="kw" style="color: #003B4F;
background-color: null;
font-style: inherit;">-</span><span class="at" style="color: #657422;
background-color: null;
font-style: inherit;"> </span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">name</span><span class="kw" style="color: #003B4F;
background-color: null;
font-style: inherit;">:</span><span class="at" style="color: #657422;
background-color: null;
font-style: inherit;"> Login to Azure</span></span>
<span id="cb33-22"><span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">        </span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">uses</span><span class="kw" style="color: #003B4F;
background-color: null;
font-style: inherit;">:</span><span class="at" style="color: #657422;
background-color: null;
font-style: inherit;"> azure/login@v1</span></span>
<span id="cb33-23"><span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">        </span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">with</span><span class="kw" style="color: #003B4F;
background-color: null;
font-style: inherit;">:</span></span>
<span id="cb33-24"><span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">          </span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">creds</span><span class="kw" style="color: #003B4F;
background-color: null;
font-style: inherit;">:</span><span class="at" style="color: #657422;
background-color: null;
font-style: inherit;"> ${{ secrets.AZURE_CREDENTIALS }}</span></span>
<span id="cb33-25"><span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">      </span></span>
<span id="cb33-26"><span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">      </span><span class="kw" style="color: #003B4F;
background-color: null;
font-style: inherit;">-</span><span class="at" style="color: #657422;
background-color: null;
font-style: inherit;"> </span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">name</span><span class="kw" style="color: #003B4F;
background-color: null;
font-style: inherit;">:</span><span class="at" style="color: #657422;
background-color: null;
font-style: inherit;"> Login to ACR</span></span>
<span id="cb33-27"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">        run</span><span class="kw" style="color: #003B4F;
background-color: null;
font-style: inherit;">: </span><span class="ch" style="color: #20794D;
background-color: null;
font-style: inherit;">|</span></span>
<span id="cb33-28">          az acr login --name ${{ env.AZURE_CONTAINER_REGISTRY }}</span>
<span id="cb33-29"><span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">      </span></span>
<span id="cb33-30"><span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">      </span><span class="kw" style="color: #003B4F;
background-color: null;
font-style: inherit;">-</span><span class="at" style="color: #657422;
background-color: null;
font-style: inherit;"> </span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">name</span><span class="kw" style="color: #003B4F;
background-color: null;
font-style: inherit;">:</span><span class="at" style="color: #657422;
background-color: null;
font-style: inherit;"> Build and push image</span></span>
<span id="cb33-31"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">        run</span><span class="kw" style="color: #003B4F;
background-color: null;
font-style: inherit;">: </span><span class="ch" style="color: #20794D;
background-color: null;
font-style: inherit;">|</span></span>
<span id="cb33-32">          IMAGE_TAG=${{ env.AZURE_CONTAINER_REGISTRY }}.azurecr.io/${{ env.IMAGE_NAME }}:${{ github.sha }}</span>
<span id="cb33-33">          docker build -t $IMAGE_TAG .</span>
<span id="cb33-34">          docker push $IMAGE_TAG</span>
<span id="cb33-35"><span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">      </span></span>
<span id="cb33-36"><span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">      </span><span class="kw" style="color: #003B4F;
background-color: null;
font-style: inherit;">-</span><span class="at" style="color: #657422;
background-color: null;
font-style: inherit;"> </span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">name</span><span class="kw" style="color: #003B4F;
background-color: null;
font-style: inherit;">:</span><span class="at" style="color: #657422;
background-color: null;
font-style: inherit;"> Deploy to Container Apps</span></span>
<span id="cb33-37"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">        run</span><span class="kw" style="color: #003B4F;
background-color: null;
font-style: inherit;">: </span><span class="ch" style="color: #20794D;
background-color: null;
font-style: inherit;">|</span></span>
<span id="cb33-38">          az containerapp update \</span>
<span id="cb33-39">            --name ${{ env.CONTAINER_APP_NAME }} \</span>
<span id="cb33-40">            --resource-group ${{ env.RESOURCE_GROUP }} \</span>
<span id="cb33-41">            --image ${{ env.AZURE_CONTAINER_REGISTRY }}.azurecr.io/${{ env.IMAGE_NAME }}:${{ github.sha }}</span></code></pre></div>
</section>
</section>
<section id="보안" class="level2" data-number="13">
<h2 data-number="13" class="anchored" data-anchor-id="보안"><span class="header-section-number">13</span> 보안</h2>
<section id="managed-identity" class="level3" data-number="13.1">
<h3 data-number="13.1" class="anchored" data-anchor-id="managed-identity"><span class="header-section-number">13.1</span> Managed Identity</h3>
<div class="sourceCode" id="cb34" style="background: #f1f3f5;"><pre class="sourceCode numberSource bash number-lines code-with-copy"><code class="sourceCode bash"><span id="cb34-1"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># System-assigned identity 활성화</span></span>
<span id="cb34-2"><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">az</span> containerapp identity assign <span class="dt" style="color: #AD0000;
background-color: null;
font-style: inherit;">\</span></span>
<span id="cb34-3">  <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">--name</span> ca-rag-api <span class="dt" style="color: #AD0000;
background-color: null;
font-style: inherit;">\</span></span>
<span id="cb34-4">  <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">--resource-group</span> rg-rag-prod <span class="dt" style="color: #AD0000;
background-color: null;
font-style: inherit;">\</span></span>
<span id="cb34-5">  <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">--system-assigned</span></span>
<span id="cb34-6"></span>
<span id="cb34-7"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># Principal ID 조회</span></span>
<span id="cb34-8"><span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">PRINCIPAL_ID</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span><span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">$(</span><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">az</span> containerapp identity show <span class="dt" style="color: #AD0000;
background-color: null;
font-style: inherit;">\</span></span>
<span id="cb34-9">  <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">--name</span> ca-rag-api <span class="dt" style="color: #AD0000;
background-color: null;
font-style: inherit;">\</span></span>
<span id="cb34-10">  <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">--resource-group</span> rg-rag-prod <span class="dt" style="color: #AD0000;
background-color: null;
font-style: inherit;">\</span></span>
<span id="cb34-11">  <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">--query</span> principalId <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">-o</span> tsv<span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">)</span></span>
<span id="cb34-12"></span>
<span id="cb34-13"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># Azure OpenAI 권한 부여</span></span>
<span id="cb34-14"><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">az</span> role assignment create <span class="dt" style="color: #AD0000;
background-color: null;
font-style: inherit;">\</span></span>
<span id="cb34-15">  <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">--assignee</span> <span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">$PRINCIPAL_ID</span> <span class="dt" style="color: #AD0000;
background-color: null;
font-style: inherit;">\</span></span>
<span id="cb34-16">  <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">--role</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Cognitive Services OpenAI User"</span> <span class="dt" style="color: #AD0000;
background-color: null;
font-style: inherit;">\</span></span>
<span id="cb34-17">  <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">--scope</span> /subscriptions/{subscription-id}/resourceGroups/rg-rag-prod/providers/Microsoft.CognitiveServices/accounts/openai-rag-prod</span>
<span id="cb34-18"></span>
<span id="cb34-19"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># Azure Search 권한 부여</span></span>
<span id="cb34-20"><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">az</span> role assignment create <span class="dt" style="color: #AD0000;
background-color: null;
font-style: inherit;">\</span></span>
<span id="cb34-21">  <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">--assignee</span> <span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">$PRINCIPAL_ID</span> <span class="dt" style="color: #AD0000;
background-color: null;
font-style: inherit;">\</span></span>
<span id="cb34-22">  <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">--role</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Search Index Data Reader"</span> <span class="dt" style="color: #AD0000;
background-color: null;
font-style: inherit;">\</span></span>
<span id="cb34-23">  <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">--scope</span> /subscriptions/{subscription-id}/resourceGroups/rg-rag-prod/providers/Microsoft.Search/searchServices/search-rag-prod</span></code></pre></div>
</section>
<section id="defaultazurecredential-사용" class="level3" data-number="13.2">
<h3 data-number="13.2" class="anchored" data-anchor-id="defaultazurecredential-사용"><span class="header-section-number">13.2</span> DefaultAzureCredential 사용</h3>
<div class="sourceCode" id="cb35" style="background: #f1f3f5;"><pre class="sourceCode numberSource python number-lines code-with-copy"><code class="sourceCode python"><span id="cb35-1"><span class="im" style="color: #00769E;
background-color: null;
font-style: inherit;">from</span> azure.identity <span class="im" style="color: #00769E;
background-color: null;
font-style: inherit;">import</span> DefaultAzureCredential</span>
<span id="cb35-2"></span>
<span id="cb35-3">credential <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> DefaultAzureCredential()</span>
<span id="cb35-4"></span>
<span id="cb35-5"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># OpenAI (Managed Identity)</span></span>
<span id="cb35-6">llm <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> AzureChatOpenAI(</span>
<span id="cb35-7">    azure_deployment<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"gpt-4o"</span>,</span>
<span id="cb35-8">    azure_endpoint<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span>os.getenv(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"AZURE_OPENAI_ENDPOINT"</span>),</span>
<span id="cb35-9">    azure_ad_token_provider<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span><span class="kw" style="color: #003B4F;
background-color: null;
font-style: inherit;">lambda</span>: credential.get_token(</span>
<span id="cb35-10">        <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"https://cognitiveservices.azure.com/.default"</span></span>
<span id="cb35-11">    ).token</span>
<span id="cb35-12">)</span>
<span id="cb35-13"></span>
<span id="cb35-14"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># Azure Search (Managed Identity)</span></span>
<span id="cb35-15"><span class="im" style="color: #00769E;
background-color: null;
font-style: inherit;">from</span> azure.search.documents <span class="im" style="color: #00769E;
background-color: null;
font-style: inherit;">import</span> SearchClient</span>
<span id="cb35-16"></span>
<span id="cb35-17">search_client <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> SearchClient(</span>
<span id="cb35-18">    endpoint<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span>os.getenv(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"AZURE_SEARCH_ENDPOINT"</span>),</span>
<span id="cb35-19">    index_name<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span>os.getenv(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"AZURE_SEARCH_INDEX_NAME"</span>),</span>
<span id="cb35-20">    credential<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span>credential</span>
<span id="cb35-21">)</span></code></pre></div>
</section>
<section id="네트워크-보안" class="level3" data-number="13.3">
<h3 data-number="13.3" class="anchored" data-anchor-id="네트워크-보안"><span class="header-section-number">13.3</span> 네트워크 보안</h3>
<div class="sourceCode" id="cb36" style="background: #f1f3f5;"><pre class="sourceCode numberSource bash number-lines code-with-copy"><code class="sourceCode bash"><span id="cb36-1"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># VNET 통합</span></span>
<span id="cb36-2"><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">az</span> containerapp env create <span class="dt" style="color: #AD0000;
background-color: null;
font-style: inherit;">\</span></span>
<span id="cb36-3">  <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">--name</span> cae-rag-secure <span class="dt" style="color: #AD0000;
background-color: null;
font-style: inherit;">\</span></span>
<span id="cb36-4">  <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">--resource-group</span> rg-rag-prod <span class="dt" style="color: #AD0000;
background-color: null;
font-style: inherit;">\</span></span>
<span id="cb36-5">  <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">--location</span> koreacentral <span class="dt" style="color: #AD0000;
background-color: null;
font-style: inherit;">\</span></span>
<span id="cb36-6">  <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">--infrastructure-subnet-resource-id</span> /subscriptions/{sub-id}/resourceGroups/rg-rag-prod/providers/Microsoft.Network/virtualNetworks/vnet-rag/subnets/subnet-containerapp</span>
<span id="cb36-7"></span>
<span id="cb36-8"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># Internal Ingress (Private)</span></span>
<span id="cb36-9"><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">az</span> containerapp create <span class="dt" style="color: #AD0000;
background-color: null;
font-style: inherit;">\</span></span>
<span id="cb36-10">  <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">--name</span> ca-rag-internal <span class="dt" style="color: #AD0000;
background-color: null;
font-style: inherit;">\</span></span>
<span id="cb36-11">  <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">--resource-group</span> rg-rag-prod <span class="dt" style="color: #AD0000;
background-color: null;
font-style: inherit;">\</span></span>
<span id="cb36-12">  <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">--environment</span> cae-rag-secure <span class="dt" style="color: #AD0000;
background-color: null;
font-style: inherit;">\</span></span>
<span id="cb36-13">  <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">--image</span> acrragprod.azurecr.io/rag-api:latest <span class="dt" style="color: #AD0000;
background-color: null;
font-style: inherit;">\</span></span>
<span id="cb36-14">  <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">--ingress</span> internal <span class="dt" style="color: #AD0000;
background-color: null;
font-style: inherit;">\</span></span>
<span id="cb36-15">  <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">--target-port</span> 8000</span></code></pre></div>
</section>
</section>
<section id="비용-최적화" class="level2" data-number="14">
<h2 data-number="14" class="anchored" data-anchor-id="비용-최적화"><span class="header-section-number">14</span> 비용 최적화</h2>
<section id="가격-구조" class="level3" data-number="14.1">
<h3 data-number="14.1" class="anchored" data-anchor-id="가격-구조"><span class="header-section-number">14.1</span> 가격 구조</h3>
<p><strong>Container Apps 비용:</strong> - vCPU: $0.000024/초 ($0.0864/vCPU-시간) - 메모리: $0.0000027/GB-초 ($0.00972/GB-시간) - 요청: 첫 200만 건 무료, 이후 $0.40/100만 건</p>
<p><strong>예시 계산</strong> (1 vCPU, 2GB, min=1, max=10):</p>
<p><strong>시나리오 1: 낮은 트래픽</strong> - 평균 인스턴스: 1개 - 월간 시간: 730시간 - vCPU 비용: 1 × 730 × $0.0864 = $63.07 - 메모리 비용: 2GB × 730 × $0.00972 = $14.19 - <strong>총 비용</strong>: ~$77/월</p>
<p><strong>시나리오 2: 중간 트래픽</strong> - 평균 인스턴스: 3개 - 월간 시간: 730시간 - vCPU 비용: 3 × 730 × $0.0864 = $189.22 - 메모리 비용: 3 × 2GB × 730 × $0.00972 = $42.57 - <strong>총 비용</strong>: ~$232/월</p>
</section>
<section id="비용-절감-팁" class="level3" data-number="14.2">
<h3 data-number="14.2" class="anchored" data-anchor-id="비용-절감-팁"><span class="header-section-number">14.2</span> 비용 절감 팁</h3>
<ol type="1">
<li><strong>min-replicas 조정</strong></li>
</ol>
<div class="sourceCode" id="cb37" style="background: #f1f3f5;"><pre class="sourceCode numberSource bash number-lines code-with-copy"><code class="sourceCode bash"><span id="cb37-1"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># 오프피크에 0으로 설정 (Cold Start 허용)</span></span>
<span id="cb37-2"><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">az</span> containerapp update <span class="dt" style="color: #AD0000;
background-color: null;
font-style: inherit;">\</span></span>
<span id="cb37-3">  <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">--name</span> ca-rag-api <span class="dt" style="color: #AD0000;
background-color: null;
font-style: inherit;">\</span></span>
<span id="cb37-4">  <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">--resource-group</span> rg-rag-prod <span class="dt" style="color: #AD0000;
background-color: null;
font-style: inherit;">\</span></span>
<span id="cb37-5">  <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">--min-replicas</span> 0</span></code></pre></div>
<ol start="2" type="1">
<li><strong>리소스 최적화</strong></li>
</ol>
<div class="sourceCode" id="cb38" style="background: #f1f3f5;"><pre class="sourceCode numberSource bash number-lines code-with-copy"><code class="sourceCode bash"><span id="cb38-1"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># 필요한 최소 리소스만 할당</span></span>
<span id="cb38-2"><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">az</span> containerapp update <span class="dt" style="color: #AD0000;
background-color: null;
font-style: inherit;">\</span></span>
<span id="cb38-3">  <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">--name</span> ca-rag-api <span class="dt" style="color: #AD0000;
background-color: null;
font-style: inherit;">\</span></span>
<span id="cb38-4">  <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">--resource-group</span> rg-rag-prod <span class="dt" style="color: #AD0000;
background-color: null;
font-style: inherit;">\</span></span>
<span id="cb38-5">  <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">--cpu</span> 0.5 <span class="dt" style="color: #AD0000;
background-color: null;
font-style: inherit;">\</span></span>
<span id="cb38-6">  <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">--memory</span> 1.0Gi</span></code></pre></div>
<ol start="3" type="1">
<li><strong>Consumption Plan 사용</strong></li>
</ol>
<div class="sourceCode" id="cb39" style="background: #f1f3f5;"><pre class="sourceCode numberSource bash number-lines code-with-copy"><code class="sourceCode bash"><span id="cb39-1"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># Consumption 환경 (더 저렴)</span></span>
<span id="cb39-2"><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">az</span> containerapp env create <span class="dt" style="color: #AD0000;
background-color: null;
font-style: inherit;">\</span></span>
<span id="cb39-3">  <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">--name</span> cae-rag-consumption <span class="dt" style="color: #AD0000;
background-color: null;
font-style: inherit;">\</span></span>
<span id="cb39-4">  <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">--resource-group</span> rg-rag-prod <span class="dt" style="color: #AD0000;
background-color: null;
font-style: inherit;">\</span></span>
<span id="cb39-5">  <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">--location</span> koreacentral <span class="dt" style="color: #AD0000;
background-color: null;
font-style: inherit;">\</span></span>
<span id="cb39-6">  <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">--enable-workload-profiles</span> false</span></code></pre></div>
</section>
</section>
<section id="참고-자료" class="level2" data-number="15">
<h2 data-number="15" class="anchored" data-anchor-id="참고-자료"><span class="header-section-number">15</span> 참고 자료</h2>
<section id="공식-문서" class="level3" data-number="15.1">
<h3 data-number="15.1" class="anchored" data-anchor-id="공식-문서"><span class="header-section-number">15.1</span> 공식 문서</h3>
<ul>
<li><a href="https://learn.microsoft.com/en-us/azure/container-apps/">Azure Container Apps</a></li>
<li><a href="https://azure.microsoft.com/en-us/pricing/details/container-apps/">Container Apps 가격</a></li>
<li><a href="https://keda.sh/docs/scalers/">KEDA Scalers</a></li>
</ul>
</section>
</section>
<section id="다음-단계" class="level2" data-number="16">
<h2 data-number="16" class="anchored" data-anchor-id="다음-단계"><span class="header-section-number">16</span> 다음 단계</h2>
<p>컨테이너 배포가 완료되었다면, 이제 전체 시스템을 통합하자:</p>
<p>👉 <a href="../../../../../docs/blog/posts/RAG/13-Cloud-RAG/09-End-to-End-Azure-RAG.html">09-End-to-End-Azure-RAG.qmd</a> - End-to-End Azure RAG 시스템 구축</p>


</section>

 ]]></description>
  <category>AI</category>
  <category>RAG</category>
  <category>Azure</category>
  <guid>kk3225.netlify.app/docs/blog/posts/RAG/13-Cloud-RAG/08-Azure-Container-Apps.html</guid>
  <pubDate>Sat, 08 Nov 2025 15:00:00 GMT</pubDate>
</item>
<item>
  <title>Azure Functions Apps</title>
  <dc:creator>Kwangmin Kim</dc:creator>
  <link>kk3225.netlify.app/docs/blog/posts/RAG/13-Cloud-RAG/07-Azure-Functions-Apps.html</link>
  <description><![CDATA[ 





<section id="azure-functions란" class="level2" data-number="1">
<h2 data-number="1" class="anchored" data-anchor-id="azure-functions란"><span class="header-section-number">1</span> Azure Functions란?</h2>
<p>Azure Functions는 서버리스 컴퓨팅 플랫폼으로, 인프라 관리 없이 코드를 실행할 수 있다.</p>
<p><strong>서버리스 장점:</strong> - 인프라 관리 불필요 - 자동 스케일링 - 사용한 만큼만 과금 - 이벤트 기반 실행</p>
<p><strong>RAG 시스템 배포에 적합한 경우:</strong> - 간헐적인 요청 (일 100~1000건) - 트래픽 변동이 큼 - 빠른 배포 필요 - 비용 최적화 중요</p>
</section>
<section id="azure-functions-vs-container-apps" class="level2" data-number="2">
<h2 data-number="2" class="anchored" data-anchor-id="azure-functions-vs-container-apps"><span class="header-section-number">2</span> Azure Functions vs Container Apps</h2>
<table class="caption-top table">
<thead>
<tr class="header">
<th>항목</th>
<th>Azure Functions</th>
<th>Container Apps</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td><strong>아키텍처</strong></td>
<td>서버리스 함수</td>
<td>컨테이너 기반</td>
</tr>
<tr class="even">
<td><strong>확장</strong></td>
<td>자동 (초 단위)</td>
<td>자동 (분 단위)</td>
</tr>
<tr class="odd">
<td><strong>Cold Start</strong></td>
<td>있음 (3-5초)</td>
<td>있음 (1-2초)</td>
</tr>
<tr class="even">
<td><strong>최대 실행 시간</strong></td>
<td>10분</td>
<td>무제한</td>
</tr>
<tr class="odd">
<td><strong>비용</strong></td>
<td>실행 시간 기반</td>
<td>vCPU/메모리 기반</td>
</tr>
<tr class="even">
<td><strong>권장 사용</strong></td>
<td>간헐적 요청</td>
<td>지속적 서비스</td>
</tr>
</tbody>
</table>
<p><strong>Azure Functions 권장</strong>: 트래픽이 적거나 불규칙한 경우 <strong>Container Apps 권장</strong>: 지속적인 트래픽, WebSocket 필요</p>
</section>
<section id="환경-설정" class="level2" data-number="3">
<h2 data-number="3" class="anchored" data-anchor-id="환경-설정"><span class="header-section-number">3</span> 환경 설정</h2>
<section id="azure-functions-core-tools-설치" class="level3" data-number="3.1">
<h3 data-number="3.1" class="anchored" data-anchor-id="azure-functions-core-tools-설치"><span class="header-section-number">3.1</span> Azure Functions Core Tools 설치</h3>
<p><strong>Windows (PowerShell):</strong></p>
<div class="sourceCode" id="cb1" style="background: #f1f3f5;"><pre class="sourceCode numberSource powershell number-lines code-with-copy"><code class="sourceCode powershell"><span id="cb1-1"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># Chocolatey로 설치</span></span>
<span id="cb1-2">choco install azure-functions-core-tools-4</span>
<span id="cb1-3"></span>
<span id="cb1-4"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># 또는 npm으로 설치</span></span>
<span id="cb1-5">npm install <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">-</span>g azure-functions-core-tools@<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">4</span></span></code></pre></div>
<p><strong>macOS:</strong></p>
<div class="sourceCode" id="cb2" style="background: #f1f3f5;"><pre class="sourceCode numberSource bash number-lines code-with-copy"><code class="sourceCode bash"><span id="cb2-1"><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">brew</span> tap azure/functions</span>
<span id="cb2-2"><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">brew</span> install azure-functions-core-tools@4</span></code></pre></div>
<p><strong>Linux:</strong></p>
<div class="sourceCode" id="cb3" style="background: #f1f3f5;"><pre class="sourceCode numberSource bash number-lines code-with-copy"><code class="sourceCode bash"><span id="cb3-1"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">wget</span> <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">-q</span> https://packages.microsoft.com/config/ubuntu/20.04/packages-microsoft-prod.deb</span>
<span id="cb3-2"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">sudo</span> dpkg <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">-i</span> packages-microsoft-prod.deb</span>
<span id="cb3-3"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">sudo</span> apt-get update</span>
<span id="cb3-4"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">sudo</span> apt-get install azure-functions-core-tools-4</span></code></pre></div>
</section>
<section id="python-환경" class="level3" data-number="3.2">
<h3 data-number="3.2" class="anchored" data-anchor-id="python-환경"><span class="header-section-number">3.2</span> Python 환경</h3>
<div class="sourceCode" id="cb4" style="background: #f1f3f5;"><pre class="sourceCode numberSource bash number-lines code-with-copy"><code class="sourceCode bash"><span id="cb4-1"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># Python 3.9, 3.10, 3.11 지원</span></span>
<span id="cb4-2"><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">python</span> <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">--version</span></span>
<span id="cb4-3"></span>
<span id="cb4-4"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># 가상환경 생성</span></span>
<span id="cb4-5"><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">python</span> <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">-m</span> venv .venv</span>
<span id="cb4-6"><span class="bu" style="color: null;
background-color: null;
font-style: inherit;">source</span> .venv/bin/activate  <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># Linux/macOS</span></span>
<span id="cb4-7"><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">.venv\Scripts\activate</span>     <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># Windows</span></span>
<span id="cb4-8"></span>
<span id="cb4-9"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># 필수 패키지</span></span>
<span id="cb4-10"><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">pip</span> install azure-functions</span>
<span id="cb4-11"><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">pip</span> install langchain-openai</span>
<span id="cb4-12"><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">pip</span> install langchain-community</span>
<span id="cb4-13"><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">pip</span> install azure-search-documents</span>
<span id="cb4-14"><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">pip</span> install python-dotenv</span></code></pre></div>
</section>
</section>
<section id="functions-프로젝트-생성" class="level2" data-number="4">
<h2 data-number="4" class="anchored" data-anchor-id="functions-프로젝트-생성"><span class="header-section-number">4</span> Functions 프로젝트 생성</h2>
<section id="프로젝트-초기화" class="level3" data-number="4.1">
<h3 data-number="4.1" class="anchored" data-anchor-id="프로젝트-초기화"><span class="header-section-number">4.1</span> 프로젝트 초기화</h3>
<div class="sourceCode" id="cb5" style="background: #f1f3f5;"><pre class="sourceCode numberSource bash number-lines code-with-copy"><code class="sourceCode bash"><span id="cb5-1"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># 새 프로젝트 생성</span></span>
<span id="cb5-2"><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">func</span> init rag-function-app <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">--python</span></span>
<span id="cb5-3"></span>
<span id="cb5-4"><span class="bu" style="color: null;
background-color: null;
font-style: inherit;">cd</span> rag-function-app</span>
<span id="cb5-5"></span>
<span id="cb5-6"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># HTTP 트리거 함수 생성</span></span>
<span id="cb5-7"><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">func</span> new <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">--name</span> rag-query <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">--template</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"HTTP trigger"</span> <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">--authlevel</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"function"</span></span></code></pre></div>
<p><strong>생성된 구조:</strong></p>
<pre><code>rag-function-app/
├── rag-query/
│   ├── __init__.py
│   └── function.json
├── host.json
├── local.settings.json
└── requirements.txt</code></pre>
</section>
<section id="requirements.txt" class="level3" data-number="4.2">
<h3 data-number="4.2" class="anchored" data-anchor-id="requirements.txt"><span class="header-section-number">4.2</span> requirements.txt</h3>
<div class="sourceCode" id="cb7" style="background: #f1f3f5;"><pre class="sourceCode numberSource txt number-lines code-with-copy"><code class="sourceCode default"><span id="cb7-1">azure-functions</span>
<span id="cb7-2">langchain-openai</span>
<span id="cb7-3">langchain-community</span>
<span id="cb7-4">azure-search-documents</span>
<span id="cb7-5">python-dotenv</span>
<span id="cb7-6">tiktoken</span></code></pre></div>
</section>
<section id="local.settings.json" class="level3" data-number="4.3">
<h3 data-number="4.3" class="anchored" data-anchor-id="local.settings.json"><span class="header-section-number">4.3</span> local.settings.json</h3>
<div class="sourceCode" id="cb8" style="background: #f1f3f5;"><pre class="sourceCode numberSource json number-lines code-with-copy"><code class="sourceCode json"><span id="cb8-1"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">{</span></span>
<span id="cb8-2">  <span class="dt" style="color: #AD0000;
background-color: null;
font-style: inherit;">"IsEncrypted"</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">:</span> <span class="kw" style="color: #003B4F;
background-color: null;
font-style: inherit;">false</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">,</span></span>
<span id="cb8-3">  <span class="dt" style="color: #AD0000;
background-color: null;
font-style: inherit;">"Values"</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">:</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">{</span></span>
<span id="cb8-4">    <span class="dt" style="color: #AD0000;
background-color: null;
font-style: inherit;">"AzureWebJobsStorage"</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">:</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">""</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">,</span></span>
<span id="cb8-5">    <span class="dt" style="color: #AD0000;
background-color: null;
font-style: inherit;">"FUNCTIONS_WORKER_RUNTIME"</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">:</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"python"</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">,</span></span>
<span id="cb8-6">    <span class="dt" style="color: #AD0000;
background-color: null;
font-style: inherit;">"AZURE_OPENAI_ENDPOINT"</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">:</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"https://openai-rag-prod.openai.azure.com/"</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">,</span></span>
<span id="cb8-7">    <span class="dt" style="color: #AD0000;
background-color: null;
font-style: inherit;">"AZURE_OPENAI_API_KEY"</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">:</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"your-key"</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">,</span></span>
<span id="cb8-8">    <span class="dt" style="color: #AD0000;
background-color: null;
font-style: inherit;">"AZURE_OPENAI_DEPLOYMENT"</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">:</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"gpt-4o"</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">,</span></span>
<span id="cb8-9">    <span class="dt" style="color: #AD0000;
background-color: null;
font-style: inherit;">"AZURE_OPENAI_API_VERSION"</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">:</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"2024-02-01"</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">,</span></span>
<span id="cb8-10">    <span class="dt" style="color: #AD0000;
background-color: null;
font-style: inherit;">"AZURE_SEARCH_ENDPOINT"</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">:</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"https://search-rag-prod.search.windows.net"</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">,</span></span>
<span id="cb8-11">    <span class="dt" style="color: #AD0000;
background-color: null;
font-style: inherit;">"AZURE_SEARCH_API_KEY"</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">:</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"your-key"</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">,</span></span>
<span id="cb8-12">    <span class="dt" style="color: #AD0000;
background-color: null;
font-style: inherit;">"AZURE_SEARCH_INDEX_NAME"</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">:</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"rag-documents"</span></span>
<span id="cb8-13">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">}</span></span>
<span id="cb8-14"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">}</span></span></code></pre></div>
</section>
</section>
<section id="rag-함수-구현" class="level2" data-number="5">
<h2 data-number="5" class="anchored" data-anchor-id="rag-함수-구현"><span class="header-section-number">5</span> RAG 함수 구현</h2>
<section id="rag-queryinit.py" class="level3" data-number="5.1">
<h3 data-number="5.1" class="anchored" data-anchor-id="rag-queryinit.py"><span class="header-section-number">5.1</span> rag-query/<strong>init</strong>.py</h3>
<div class="sourceCode" id="cb9" style="background: #f1f3f5;"><pre class="sourceCode numberSource python number-lines code-with-copy"><code class="sourceCode python"><span id="cb9-1"><span class="im" style="color: #00769E;
background-color: null;
font-style: inherit;">import</span> azure.functions <span class="im" style="color: #00769E;
background-color: null;
font-style: inherit;">as</span> func</span>
<span id="cb9-2"><span class="im" style="color: #00769E;
background-color: null;
font-style: inherit;">import</span> logging</span>
<span id="cb9-3"><span class="im" style="color: #00769E;
background-color: null;
font-style: inherit;">import</span> json</span>
<span id="cb9-4"><span class="im" style="color: #00769E;
background-color: null;
font-style: inherit;">import</span> os</span>
<span id="cb9-5"><span class="im" style="color: #00769E;
background-color: null;
font-style: inherit;">from</span> langchain_openai <span class="im" style="color: #00769E;
background-color: null;
font-style: inherit;">import</span> AzureOpenAIEmbeddings, AzureChatOpenAI</span>
<span id="cb9-6"><span class="im" style="color: #00769E;
background-color: null;
font-style: inherit;">from</span> langchain_community.vectorstores.azuresearch <span class="im" style="color: #00769E;
background-color: null;
font-style: inherit;">import</span> AzureSearch</span>
<span id="cb9-7"><span class="im" style="color: #00769E;
background-color: null;
font-style: inherit;">from</span> langchain_core.prompts <span class="im" style="color: #00769E;
background-color: null;
font-style: inherit;">import</span> ChatPromptTemplate</span>
<span id="cb9-8"><span class="im" style="color: #00769E;
background-color: null;
font-style: inherit;">from</span> langchain_core.output_parsers <span class="im" style="color: #00769E;
background-color: null;
font-style: inherit;">import</span> StrOutputParser</span>
<span id="cb9-9"><span class="im" style="color: #00769E;
background-color: null;
font-style: inherit;">from</span> langchain_core.runnables <span class="im" style="color: #00769E;
background-color: null;
font-style: inherit;">import</span> RunnablePassthrough</span>
<span id="cb9-10"></span>
<span id="cb9-11"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># 환경 변수 로드</span></span>
<span id="cb9-12">AZURE_OPENAI_ENDPOINT <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> os.getenv(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"AZURE_OPENAI_ENDPOINT"</span>)</span>
<span id="cb9-13">AZURE_OPENAI_API_KEY <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> os.getenv(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"AZURE_OPENAI_API_KEY"</span>)</span>
<span id="cb9-14">AZURE_OPENAI_DEPLOYMENT <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> os.getenv(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"AZURE_OPENAI_DEPLOYMENT"</span>)</span>
<span id="cb9-15">AZURE_OPENAI_API_VERSION <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> os.getenv(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"AZURE_OPENAI_API_VERSION"</span>)</span>
<span id="cb9-16">AZURE_SEARCH_ENDPOINT <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> os.getenv(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"AZURE_SEARCH_ENDPOINT"</span>)</span>
<span id="cb9-17">AZURE_SEARCH_API_KEY <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> os.getenv(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"AZURE_SEARCH_API_KEY"</span>)</span>
<span id="cb9-18">AZURE_SEARCH_INDEX_NAME <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> os.getenv(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"AZURE_SEARCH_INDEX_NAME"</span>)</span>
<span id="cb9-19"></span>
<span id="cb9-20"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># 전역 초기화 (Cold Start 최적화)</span></span>
<span id="cb9-21">embeddings <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> <span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">None</span></span>
<span id="cb9-22">vector_store <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> <span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">None</span></span>
<span id="cb9-23">llm <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> <span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">None</span></span>
<span id="cb9-24">rag_chain <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> <span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">None</span></span>
<span id="cb9-25"></span>
<span id="cb9-26"><span class="kw" style="color: #003B4F;
background-color: null;
font-style: inherit;">def</span> init_rag_components():</span>
<span id="cb9-27">    <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">"""RAG 컴포넌트 초기화 (한 번만 실행)"""</span></span>
<span id="cb9-28">    <span class="kw" style="color: #003B4F;
background-color: null;
font-style: inherit;">global</span> embeddings, vector_store, llm, rag_chain</span>
<span id="cb9-29">    </span>
<span id="cb9-30">    <span class="cf" style="color: #003B4F;
background-color: null;
font-style: inherit;">if</span> rag_chain <span class="kw" style="color: #003B4F;
background-color: null;
font-style: inherit;">is</span> <span class="kw" style="color: #003B4F;
background-color: null;
font-style: inherit;">not</span> <span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">None</span>:</span>
<span id="cb9-31">        <span class="cf" style="color: #003B4F;
background-color: null;
font-style: inherit;">return</span>  <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># 이미 초기화됨</span></span>
<span id="cb9-32">    </span>
<span id="cb9-33">    logging.info(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"RAG 컴포넌트 초기화 중..."</span>)</span>
<span id="cb9-34">    </span>
<span id="cb9-35">    <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># Embeddings</span></span>
<span id="cb9-36">    embeddings <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> AzureOpenAIEmbeddings(</span>
<span id="cb9-37">        azure_deployment<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"text-embedding-3-small"</span>,</span>
<span id="cb9-38">        openai_api_version<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span>AZURE_OPENAI_API_VERSION,</span>
<span id="cb9-39">        azure_endpoint<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span>AZURE_OPENAI_ENDPOINT,</span>
<span id="cb9-40">        api_key<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span>AZURE_OPENAI_API_KEY</span>
<span id="cb9-41">    )</span>
<span id="cb9-42">    </span>
<span id="cb9-43">    <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># Vector Store</span></span>
<span id="cb9-44">    vector_store <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> AzureSearch(</span>
<span id="cb9-45">        azure_search_endpoint<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span>AZURE_SEARCH_ENDPOINT,</span>
<span id="cb9-46">        azure_search_key<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span>AZURE_SEARCH_API_KEY,</span>
<span id="cb9-47">        index_name<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span>AZURE_SEARCH_INDEX_NAME,</span>
<span id="cb9-48">        embedding_function<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span>embeddings.embed_query</span>
<span id="cb9-49">    )</span>
<span id="cb9-50">    </span>
<span id="cb9-51">    <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># LLM</span></span>
<span id="cb9-52">    llm <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> AzureChatOpenAI(</span>
<span id="cb9-53">        azure_deployment<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span>AZURE_OPENAI_DEPLOYMENT,</span>
<span id="cb9-54">        openai_api_version<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span>AZURE_OPENAI_API_VERSION,</span>
<span id="cb9-55">        azure_endpoint<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span>AZURE_OPENAI_ENDPOINT,</span>
<span id="cb9-56">        api_key<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span>AZURE_OPENAI_API_KEY,</span>
<span id="cb9-57">        temperature<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">0</span></span>
<span id="cb9-58">    )</span>
<span id="cb9-59">    </span>
<span id="cb9-60">    <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># Retriever</span></span>
<span id="cb9-61">    retriever <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> vector_store.as_retriever(search_kwargs<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span>{<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"k"</span>: <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">3</span>})</span>
<span id="cb9-62">    </span>
<span id="cb9-63">    <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># Prompt</span></span>
<span id="cb9-64">    prompt <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> ChatPromptTemplate.from_template(</span>
<span id="cb9-65">        <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"""다음 컨텍스트를 참고하여 질문에 답변하세요.</span></span>
<span id="cb9-66"></span>
<span id="cb9-67"><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">컨텍스트:</span></span>
<span id="cb9-68"><span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">{context}</span></span>
<span id="cb9-69"></span>
<span id="cb9-70"><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">질문: </span><span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">{question}</span></span>
<span id="cb9-71"></span>
<span id="cb9-72"><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">답변:"""</span></span>
<span id="cb9-73">    )</span>
<span id="cb9-74">    </span>
<span id="cb9-75">    <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># RAG Chain</span></span>
<span id="cb9-76">    <span class="kw" style="color: #003B4F;
background-color: null;
font-style: inherit;">def</span> format_docs(docs):</span>
<span id="cb9-77">        <span class="cf" style="color: #003B4F;
background-color: null;
font-style: inherit;">return</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"</span><span class="ch" style="color: #20794D;
background-color: null;
font-style: inherit;">\n\n</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"</span>.join([doc.page_content <span class="cf" style="color: #003B4F;
background-color: null;
font-style: inherit;">for</span> doc <span class="kw" style="color: #003B4F;
background-color: null;
font-style: inherit;">in</span> docs])</span>
<span id="cb9-78">    </span>
<span id="cb9-79">    rag_chain <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> (</span>
<span id="cb9-80">        {<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"context"</span>: retriever <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">|</span> format_docs, <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"question"</span>: RunnablePassthrough()}</span>
<span id="cb9-81">        <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">|</span> prompt</span>
<span id="cb9-82">        <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">|</span> llm</span>
<span id="cb9-83">        <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">|</span> StrOutputParser()</span>
<span id="cb9-84">    )</span>
<span id="cb9-85">    </span>
<span id="cb9-86">    logging.info(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"RAG 컴포넌트 초기화 완료"</span>)</span>
<span id="cb9-87"></span>
<span id="cb9-88"><span class="kw" style="color: #003B4F;
background-color: null;
font-style: inherit;">def</span> main(req: func.HttpRequest) <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">-&gt;</span> func.HttpResponse:</span>
<span id="cb9-89">    <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">"""HTTP 트리거 함수"""</span></span>
<span id="cb9-90">    logging.info(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">'RAG 쿼리 요청 수신'</span>)</span>
<span id="cb9-91">    </span>
<span id="cb9-92">    <span class="cf" style="color: #003B4F;
background-color: null;
font-style: inherit;">try</span>:</span>
<span id="cb9-93">        <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># RAG 컴포넌트 초기화</span></span>
<span id="cb9-94">        init_rag_components()</span>
<span id="cb9-95">        </span>
<span id="cb9-96">        <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># 요청 파싱</span></span>
<span id="cb9-97">        <span class="cf" style="color: #003B4F;
background-color: null;
font-style: inherit;">try</span>:</span>
<span id="cb9-98">            req_body <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> req.get_json()</span>
<span id="cb9-99">            question <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> req_body.get(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">'question'</span>)</span>
<span id="cb9-100">        <span class="cf" style="color: #003B4F;
background-color: null;
font-style: inherit;">except</span> <span class="pp" style="color: #AD0000;
background-color: null;
font-style: inherit;">ValueError</span>:</span>
<span id="cb9-101">            question <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> req.params.get(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">'question'</span>)</span>
<span id="cb9-102">        </span>
<span id="cb9-103">        <span class="cf" style="color: #003B4F;
background-color: null;
font-style: inherit;">if</span> <span class="kw" style="color: #003B4F;
background-color: null;
font-style: inherit;">not</span> question:</span>
<span id="cb9-104">            <span class="cf" style="color: #003B4F;
background-color: null;
font-style: inherit;">return</span> func.HttpResponse(</span>
<span id="cb9-105">                json.dumps({<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"error"</span>: <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"질문을 입력해주세요"</span>}),</span>
<span id="cb9-106">                mimetype<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"application/json"</span>,</span>
<span id="cb9-107">                status_code<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">400</span></span>
<span id="cb9-108">            )</span>
<span id="cb9-109">        </span>
<span id="cb9-110">        <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># RAG 실행</span></span>
<span id="cb9-111">        logging.info(<span class="ss" style="color: #20794D;
background-color: null;
font-style: inherit;">f"질문: </span><span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">{</span>question<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">}</span><span class="ss" style="color: #20794D;
background-color: null;
font-style: inherit;">"</span>)</span>
<span id="cb9-112">        answer <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> rag_chain.invoke(question)</span>
<span id="cb9-113">        </span>
<span id="cb9-114">        <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># 응답 반환</span></span>
<span id="cb9-115">        response <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> {</span>
<span id="cb9-116">            <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"question"</span>: question,</span>
<span id="cb9-117">            <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"answer"</span>: answer,</span>
<span id="cb9-118">            <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"status"</span>: <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"success"</span></span>
<span id="cb9-119">        }</span>
<span id="cb9-120">        </span>
<span id="cb9-121">        <span class="cf" style="color: #003B4F;
background-color: null;
font-style: inherit;">return</span> func.HttpResponse(</span>
<span id="cb9-122">            json.dumps(response, ensure_ascii<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span><span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">False</span>),</span>
<span id="cb9-123">            mimetype<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"application/json"</span>,</span>
<span id="cb9-124">            status_code<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">200</span></span>
<span id="cb9-125">        )</span>
<span id="cb9-126">    </span>
<span id="cb9-127">    <span class="cf" style="color: #003B4F;
background-color: null;
font-style: inherit;">except</span> <span class="pp" style="color: #AD0000;
background-color: null;
font-style: inherit;">Exception</span> <span class="im" style="color: #00769E;
background-color: null;
font-style: inherit;">as</span> e:</span>
<span id="cb9-128">        logging.error(<span class="ss" style="color: #20794D;
background-color: null;
font-style: inherit;">f"오류 발생: </span><span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">{</span><span class="bu" style="color: null;
background-color: null;
font-style: inherit;">str</span>(e)<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">}</span><span class="ss" style="color: #20794D;
background-color: null;
font-style: inherit;">"</span>)</span>
<span id="cb9-129">        <span class="cf" style="color: #003B4F;
background-color: null;
font-style: inherit;">return</span> func.HttpResponse(</span>
<span id="cb9-130">            json.dumps({<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"error"</span>: <span class="bu" style="color: null;
background-color: null;
font-style: inherit;">str</span>(e)}),</span>
<span id="cb9-131">            mimetype<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"application/json"</span>,</span>
<span id="cb9-132">            status_code<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">500</span></span>
<span id="cb9-133">        )</span></code></pre></div>
</section>
<section id="function.json" class="level3" data-number="5.2">
<h3 data-number="5.2" class="anchored" data-anchor-id="function.json"><span class="header-section-number">5.2</span> function.json</h3>
<div class="sourceCode" id="cb10" style="background: #f1f3f5;"><pre class="sourceCode numberSource json number-lines code-with-copy"><code class="sourceCode json"><span id="cb10-1"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">{</span></span>
<span id="cb10-2">  <span class="dt" style="color: #AD0000;
background-color: null;
font-style: inherit;">"scriptFile"</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">:</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"__init__.py"</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">,</span></span>
<span id="cb10-3">  <span class="dt" style="color: #AD0000;
background-color: null;
font-style: inherit;">"bindings"</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">:</span> <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">[</span></span>
<span id="cb10-4">    <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">{</span></span>
<span id="cb10-5">      <span class="dt" style="color: #AD0000;
background-color: null;
font-style: inherit;">"authLevel"</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">:</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"function"</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">,</span></span>
<span id="cb10-6">      <span class="dt" style="color: #AD0000;
background-color: null;
font-style: inherit;">"type"</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">:</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"httpTrigger"</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">,</span></span>
<span id="cb10-7">      <span class="dt" style="color: #AD0000;
background-color: null;
font-style: inherit;">"direction"</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">:</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"in"</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">,</span></span>
<span id="cb10-8">      <span class="dt" style="color: #AD0000;
background-color: null;
font-style: inherit;">"name"</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">:</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"req"</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">,</span></span>
<span id="cb10-9">      <span class="dt" style="color: #AD0000;
background-color: null;
font-style: inherit;">"methods"</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">:</span> <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">[</span></span>
<span id="cb10-10">        <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"get"</span><span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">,</span></span>
<span id="cb10-11">        <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"post"</span></span>
<span id="cb10-12">      <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">]</span></span>
<span id="cb10-13">    <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">}</span><span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">,</span></span>
<span id="cb10-14">    <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">{</span></span>
<span id="cb10-15">      <span class="dt" style="color: #AD0000;
background-color: null;
font-style: inherit;">"type"</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">:</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"http"</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">,</span></span>
<span id="cb10-16">      <span class="dt" style="color: #AD0000;
background-color: null;
font-style: inherit;">"direction"</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">:</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"out"</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">,</span></span>
<span id="cb10-17">      <span class="dt" style="color: #AD0000;
background-color: null;
font-style: inherit;">"name"</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">:</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"$return"</span></span>
<span id="cb10-18">    <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">}</span></span>
<span id="cb10-19">  <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">]</span></span>
<span id="cb10-20"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">}</span></span></code></pre></div>
</section>
</section>
<section id="로컬-테스트" class="level2" data-number="6">
<h2 data-number="6" class="anchored" data-anchor-id="로컬-테스트"><span class="header-section-number">6</span> 로컬 테스트</h2>
<section id="로컬-실행" class="level3" data-number="6.1">
<h3 data-number="6.1" class="anchored" data-anchor-id="로컬-실행"><span class="header-section-number">6.1</span> 로컬 실행</h3>
<div class="sourceCode" id="cb11" style="background: #f1f3f5;"><pre class="sourceCode numberSource bash number-lines code-with-copy"><code class="sourceCode bash"><span id="cb11-1"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># Functions 앱 시작</span></span>
<span id="cb11-2"><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">func</span> start</span></code></pre></div>
<p>출력:</p>
<pre><code>Functions:
        rag-query: [GET,POST] http://localhost:7071/api/rag-query</code></pre>
</section>
<section id="curl-테스트" class="level3" data-number="6.2">
<h3 data-number="6.2" class="anchored" data-anchor-id="curl-테스트"><span class="header-section-number">6.2</span> cURL 테스트</h3>
<div class="sourceCode" id="cb13" style="background: #f1f3f5;"><pre class="sourceCode numberSource bash number-lines code-with-copy"><code class="sourceCode bash"><span id="cb13-1"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># POST 요청</span></span>
<span id="cb13-2"><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">curl</span> <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">-X</span> POST http://localhost:7071/api/rag-query <span class="dt" style="color: #AD0000;
background-color: null;
font-style: inherit;">\</span></span>
<span id="cb13-3">  <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">-H</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Content-Type: application/json"</span> <span class="dt" style="color: #AD0000;
background-color: null;
font-style: inherit;">\</span></span>
<span id="cb13-4">  <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">-d</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">'{"question": "Azure AI Search란 무엇인가?"}'</span></span>
<span id="cb13-5"></span>
<span id="cb13-6"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># GET 요청</span></span>
<span id="cb13-7"><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">curl</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"http://localhost:7071/api/rag-query?question=Azure+AI+Search란+무엇인가?"</span></span></code></pre></div>
</section>
<section id="python으로-테스트" class="level3" data-number="6.3">
<h3 data-number="6.3" class="anchored" data-anchor-id="python으로-테스트"><span class="header-section-number">6.3</span> Python으로 테스트</h3>
<div class="sourceCode" id="cb14" style="background: #f1f3f5;"><pre class="sourceCode numberSource python number-lines code-with-copy"><code class="sourceCode python"><span id="cb14-1"><span class="im" style="color: #00769E;
background-color: null;
font-style: inherit;">import</span> requests</span>
<span id="cb14-2"><span class="im" style="color: #00769E;
background-color: null;
font-style: inherit;">import</span> json</span>
<span id="cb14-3"></span>
<span id="cb14-4">url <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"http://localhost:7071/api/rag-query"</span></span>
<span id="cb14-5">data <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> {<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"question"</span>: <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Azure AI Search란 무엇인가?"</span>}</span>
<span id="cb14-6"></span>
<span id="cb14-7">response <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> requests.post(url, json<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span>data)</span>
<span id="cb14-8">result <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> response.json()</span>
<span id="cb14-9"></span>
<span id="cb14-10"><span class="bu" style="color: null;
background-color: null;
font-style: inherit;">print</span>(<span class="ss" style="color: #20794D;
background-color: null;
font-style: inherit;">f"질문: </span><span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">{</span>result[<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">'question'</span>]<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">}</span><span class="ss" style="color: #20794D;
background-color: null;
font-style: inherit;">"</span>)</span>
<span id="cb14-11"><span class="bu" style="color: null;
background-color: null;
font-style: inherit;">print</span>(<span class="ss" style="color: #20794D;
background-color: null;
font-style: inherit;">f"답변: </span><span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">{</span>result[<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">'answer'</span>]<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">}</span><span class="ss" style="color: #20794D;
background-color: null;
font-style: inherit;">"</span>)</span></code></pre></div>
</section>
</section>
<section id="azure-배포" class="level2" data-number="7">
<h2 data-number="7" class="anchored" data-anchor-id="azure-배포"><span class="header-section-number">7</span> Azure 배포</h2>
<section id="function-app-리소스-생성" class="level3" data-number="7.1">
<h3 data-number="7.1" class="anchored" data-anchor-id="function-app-리소스-생성"><span class="header-section-number">7.1</span> Function App 리소스 생성</h3>
<div class="sourceCode" id="cb15" style="background: #f1f3f5;"><pre class="sourceCode numberSource bash number-lines code-with-copy"><code class="sourceCode bash"><span id="cb15-1"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># 리소스 그룹 생성</span></span>
<span id="cb15-2"><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">az</span> group create <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">--name</span> rg-rag-prod <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">--location</span> koreacentral</span>
<span id="cb15-3"></span>
<span id="cb15-4"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># Storage Account 생성 (Functions 필수)</span></span>
<span id="cb15-5"><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">az</span> storage account create <span class="dt" style="color: #AD0000;
background-color: null;
font-style: inherit;">\</span></span>
<span id="cb15-6">  <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">--name</span> stragprod <span class="dt" style="color: #AD0000;
background-color: null;
font-style: inherit;">\</span></span>
<span id="cb15-7">  <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">--resource-group</span> rg-rag-prod <span class="dt" style="color: #AD0000;
background-color: null;
font-style: inherit;">\</span></span>
<span id="cb15-8">  <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">--location</span> koreacentral <span class="dt" style="color: #AD0000;
background-color: null;
font-style: inherit;">\</span></span>
<span id="cb15-9">  <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">--sku</span> Standard_LRS</span>
<span id="cb15-10"></span>
<span id="cb15-11"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># Function App 생성 (Python 3.11)</span></span>
<span id="cb15-12"><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">az</span> functionapp create <span class="dt" style="color: #AD0000;
background-color: null;
font-style: inherit;">\</span></span>
<span id="cb15-13">  <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">--resource-group</span> rg-rag-prod <span class="dt" style="color: #AD0000;
background-color: null;
font-style: inherit;">\</span></span>
<span id="cb15-14">  <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">--consumption-plan-location</span> koreacentral <span class="dt" style="color: #AD0000;
background-color: null;
font-style: inherit;">\</span></span>
<span id="cb15-15">  <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">--runtime</span> python <span class="dt" style="color: #AD0000;
background-color: null;
font-style: inherit;">\</span></span>
<span id="cb15-16">  <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">--runtime-version</span> 3.11 <span class="dt" style="color: #AD0000;
background-color: null;
font-style: inherit;">\</span></span>
<span id="cb15-17">  <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">--functions-version</span> 4 <span class="dt" style="color: #AD0000;
background-color: null;
font-style: inherit;">\</span></span>
<span id="cb15-18">  <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">--name</span> func-rag-prod <span class="dt" style="color: #AD0000;
background-color: null;
font-style: inherit;">\</span></span>
<span id="cb15-19">  <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">--storage-account</span> stragprod <span class="dt" style="color: #AD0000;
background-color: null;
font-style: inherit;">\</span></span>
<span id="cb15-20">  <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">--os-type</span> Linux</span></code></pre></div>
</section>
<section id="환경-변수-설정" class="level3" data-number="7.2">
<h3 data-number="7.2" class="anchored" data-anchor-id="환경-변수-설정"><span class="header-section-number">7.2</span> 환경 변수 설정</h3>
<div class="sourceCode" id="cb16" style="background: #f1f3f5;"><pre class="sourceCode numberSource bash number-lines code-with-copy"><code class="sourceCode bash"><span id="cb16-1"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># Application Settings 설정</span></span>
<span id="cb16-2"><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">az</span> functionapp config appsettings set <span class="dt" style="color: #AD0000;
background-color: null;
font-style: inherit;">\</span></span>
<span id="cb16-3">  <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">--name</span> func-rag-prod <span class="dt" style="color: #AD0000;
background-color: null;
font-style: inherit;">\</span></span>
<span id="cb16-4">  <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">--resource-group</span> rg-rag-prod <span class="dt" style="color: #AD0000;
background-color: null;
font-style: inherit;">\</span></span>
<span id="cb16-5">  <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">--settings</span> <span class="dt" style="color: #AD0000;
background-color: null;
font-style: inherit;">\</span></span>
<span id="cb16-6">    AZURE_OPENAI_ENDPOINT=<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"https://openai-rag-prod.openai.azure.com/"</span> <span class="dt" style="color: #AD0000;
background-color: null;
font-style: inherit;">\</span></span>
<span id="cb16-7">    AZURE_OPENAI_API_KEY=<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"your-key"</span> <span class="dt" style="color: #AD0000;
background-color: null;
font-style: inherit;">\</span></span>
<span id="cb16-8">    AZURE_OPENAI_DEPLOYMENT=<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"gpt-4o"</span> <span class="dt" style="color: #AD0000;
background-color: null;
font-style: inherit;">\</span></span>
<span id="cb16-9">    AZURE_OPENAI_API_VERSION=<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"2024-02-01"</span> <span class="dt" style="color: #AD0000;
background-color: null;
font-style: inherit;">\</span></span>
<span id="cb16-10">    AZURE_SEARCH_ENDPOINT=<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"https://search-rag-prod.search.windows.net"</span> <span class="dt" style="color: #AD0000;
background-color: null;
font-style: inherit;">\</span></span>
<span id="cb16-11">    AZURE_SEARCH_API_KEY=<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"your-key"</span> <span class="dt" style="color: #AD0000;
background-color: null;
font-style: inherit;">\</span></span>
<span id="cb16-12">    AZURE_SEARCH_INDEX_NAME=<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"rag-documents"</span></span></code></pre></div>
</section>
<section id="배포" class="level3" data-number="7.3">
<h3 data-number="7.3" class="anchored" data-anchor-id="배포"><span class="header-section-number">7.3</span> 배포</h3>
<div class="sourceCode" id="cb17" style="background: #f1f3f5;"><pre class="sourceCode numberSource bash number-lines code-with-copy"><code class="sourceCode bash"><span id="cb17-1"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># Azure에 배포</span></span>
<span id="cb17-2"><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">func</span> azure functionapp publish func-rag-prod</span>
<span id="cb17-3"></span>
<span id="cb17-4"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># 배포 완료 후 URL 확인</span></span>
<span id="cb17-5"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># https://func-rag-prod.azurewebsites.net/api/rag-query</span></span></code></pre></div>
</section>
<section id="배포-테스트" class="level3" data-number="7.4">
<h3 data-number="7.4" class="anchored" data-anchor-id="배포-테스트"><span class="header-section-number">7.4</span> 배포 테스트</h3>
<div class="sourceCode" id="cb18" style="background: #f1f3f5;"><pre class="sourceCode numberSource bash number-lines code-with-copy"><code class="sourceCode bash"><span id="cb18-1"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># Function Key 조회</span></span>
<span id="cb18-2"><span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">FUNCTION_KEY</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span><span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">$(</span><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">az</span> functionapp keys list <span class="dt" style="color: #AD0000;
background-color: null;
font-style: inherit;">\</span></span>
<span id="cb18-3">  <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">--name</span> func-rag-prod <span class="dt" style="color: #AD0000;
background-color: null;
font-style: inherit;">\</span></span>
<span id="cb18-4">  <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">--resource-group</span> rg-rag-prod <span class="dt" style="color: #AD0000;
background-color: null;
font-style: inherit;">\</span></span>
<span id="cb18-5">  <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">--query</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"functionKeys.default"</span> <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">-o</span> tsv<span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">)</span></span>
<span id="cb18-6"></span>
<span id="cb18-7"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># API 호출</span></span>
<span id="cb18-8"><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">curl</span> <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">-X</span> POST https://func-rag-prod.azurewebsites.net/api/rag-query<span class="pp" style="color: #AD0000;
background-color: null;
font-style: inherit;">?</span>code=<span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">$FUNCTION_KEY</span> <span class="dt" style="color: #AD0000;
background-color: null;
font-style: inherit;">\</span></span>
<span id="cb18-9">  <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">-H</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Content-Type: application/json"</span> <span class="dt" style="color: #AD0000;
background-color: null;
font-style: inherit;">\</span></span>
<span id="cb18-10">  <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">-d</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">'{"question": "Azure AI Search란?"}'</span></span></code></pre></div>
</section>
</section>
<section id="cold-start-최적화" class="level2" data-number="8">
<h2 data-number="8" class="anchored" data-anchor-id="cold-start-최적화"><span class="header-section-number">8</span> Cold Start 최적화</h2>
<section id="premium-plan" class="level3" data-number="8.1">
<h3 data-number="8.1" class="anchored" data-anchor-id="premium-plan"><span class="header-section-number">8.1</span> Premium Plan</h3>
<p>Consumption Plan의 Cold Start를 개선하려면 Premium Plan으로 변경한다.</p>
<div class="sourceCode" id="cb19" style="background: #f1f3f5;"><pre class="sourceCode numberSource bash number-lines code-with-copy"><code class="sourceCode bash"><span id="cb19-1"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># Premium Plan 생성</span></span>
<span id="cb19-2"><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">az</span> functionapp plan create <span class="dt" style="color: #AD0000;
background-color: null;
font-style: inherit;">\</span></span>
<span id="cb19-3">  <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">--resource-group</span> rg-rag-prod <span class="dt" style="color: #AD0000;
background-color: null;
font-style: inherit;">\</span></span>
<span id="cb19-4">  <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">--name</span> plan-rag-premium <span class="dt" style="color: #AD0000;
background-color: null;
font-style: inherit;">\</span></span>
<span id="cb19-5">  <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">--location</span> koreacentral <span class="dt" style="color: #AD0000;
background-color: null;
font-style: inherit;">\</span></span>
<span id="cb19-6">  <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">--sku</span> EP1 <span class="dt" style="color: #AD0000;
background-color: null;
font-style: inherit;">\</span></span>
<span id="cb19-7">  <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">--is-linux</span></span>
<span id="cb19-8"></span>
<span id="cb19-9"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># Function App을 Premium Plan으로 변경</span></span>
<span id="cb19-10"><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">az</span> functionapp update <span class="dt" style="color: #AD0000;
background-color: null;
font-style: inherit;">\</span></span>
<span id="cb19-11">  <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">--name</span> func-rag-prod <span class="dt" style="color: #AD0000;
background-color: null;
font-style: inherit;">\</span></span>
<span id="cb19-12">  <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">--resource-group</span> rg-rag-prod <span class="dt" style="color: #AD0000;
background-color: null;
font-style: inherit;">\</span></span>
<span id="cb19-13">  <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">--plan</span> plan-rag-premium</span></code></pre></div>
<p><strong>Premium Plan 장점:</strong> - Always-on (Cold Start 없음) - VNET 통합 - 더 많은 메모리/CPU</p>
<p><strong>비용</strong>: ~$146/월 (EP1)</p>
</section>
<section id="컴포넌트-재사용" class="level3" data-number="8.2">
<h3 data-number="8.2" class="anchored" data-anchor-id="컴포넌트-재사용"><span class="header-section-number">8.2</span> 컴포넌트 재사용</h3>
<p>전역 변수로 컴포넌트를 캐싱하여 재초기화를 방지한다.</p>
<div class="sourceCode" id="cb20" style="background: #f1f3f5;"><pre class="sourceCode numberSource python number-lines code-with-copy"><code class="sourceCode python"><span id="cb20-1"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># 전역 초기화 (함수 외부)</span></span>
<span id="cb20-2">embeddings <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> <span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">None</span></span>
<span id="cb20-3">vector_store <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> <span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">None</span></span>
<span id="cb20-4"></span>
<span id="cb20-5"><span class="kw" style="color: #003B4F;
background-color: null;
font-style: inherit;">def</span> init_components():</span>
<span id="cb20-6">    <span class="kw" style="color: #003B4F;
background-color: null;
font-style: inherit;">global</span> embeddings, vector_store</span>
<span id="cb20-7">    <span class="cf" style="color: #003B4F;
background-color: null;
font-style: inherit;">if</span> embeddings <span class="kw" style="color: #003B4F;
background-color: null;
font-style: inherit;">is</span> <span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">None</span>:</span>
<span id="cb20-8">        embeddings <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> AzureOpenAIEmbeddings(...)</span>
<span id="cb20-9">        vector_store <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> AzureSearch(...)</span></code></pre></div>
</section>
</section>
<section id="스트리밍-응답" class="level2" data-number="9">
<h2 data-number="9" class="anchored" data-anchor-id="스트리밍-응답"><span class="header-section-number">9</span> 스트리밍 응답</h2>
<p>Azure Functions는 기본적으로 스트리밍을 지원하지 않지만, Server-Sent Events (SSE)로 구현 가능하다.</p>
<section id="sse-함수" class="level3" data-number="9.1">
<h3 data-number="9.1" class="anchored" data-anchor-id="sse-함수"><span class="header-section-number">9.1</span> SSE 함수</h3>
<div class="sourceCode" id="cb21" style="background: #f1f3f5;"><pre class="sourceCode numberSource python number-lines code-with-copy"><code class="sourceCode python"><span id="cb21-1"><span class="im" style="color: #00769E;
background-color: null;
font-style: inherit;">import</span> asyncio</span>
<span id="cb21-2"></span>
<span id="cb21-3"><span class="cf" style="color: #003B4F;
background-color: null;
font-style: inherit;">async</span> <span class="kw" style="color: #003B4F;
background-color: null;
font-style: inherit;">def</span> main(req: func.HttpRequest) <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">-&gt;</span> func.HttpResponse:</span>
<span id="cb21-4">    <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">"""스트리밍 응답"""</span></span>
<span id="cb21-5">    question <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> req.get_json().get(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">'question'</span>)</span>
<span id="cb21-6">    </span>
<span id="cb21-7">    <span class="cf" style="color: #003B4F;
background-color: null;
font-style: inherit;">async</span> <span class="kw" style="color: #003B4F;
background-color: null;
font-style: inherit;">def</span> generate():</span>
<span id="cb21-8">        <span class="cf" style="color: #003B4F;
background-color: null;
font-style: inherit;">yield</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"data: "</span> <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span> json.dumps({<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"type"</span>: <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"start"</span>}) <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"</span><span class="ch" style="color: #20794D;
background-color: null;
font-style: inherit;">\n\n</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"</span></span>
<span id="cb21-9">        </span>
<span id="cb21-10">        <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># 스트리밍 실행</span></span>
<span id="cb21-11">        <span class="cf" style="color: #003B4F;
background-color: null;
font-style: inherit;">async</span> <span class="cf" style="color: #003B4F;
background-color: null;
font-style: inherit;">for</span> chunk <span class="kw" style="color: #003B4F;
background-color: null;
font-style: inherit;">in</span> streaming_llm.astream(question):</span>
<span id="cb21-12">            <span class="cf" style="color: #003B4F;
background-color: null;
font-style: inherit;">yield</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"data: "</span> <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span> json.dumps({</span>
<span id="cb21-13">                <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"type"</span>: <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"chunk"</span>,</span>
<span id="cb21-14">                <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"content"</span>: chunk.content</span>
<span id="cb21-15">            }) <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"</span><span class="ch" style="color: #20794D;
background-color: null;
font-style: inherit;">\n\n</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"</span></span>
<span id="cb21-16">        </span>
<span id="cb21-17">        <span class="cf" style="color: #003B4F;
background-color: null;
font-style: inherit;">yield</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"data: "</span> <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span> json.dumps({<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"type"</span>: <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"end"</span>}) <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"</span><span class="ch" style="color: #20794D;
background-color: null;
font-style: inherit;">\n\n</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"</span></span>
<span id="cb21-18">    </span>
<span id="cb21-19">    <span class="cf" style="color: #003B4F;
background-color: null;
font-style: inherit;">return</span> func.HttpResponse(</span>
<span id="cb21-20">        generate(),</span>
<span id="cb21-21">        mimetype<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"text/event-stream"</span></span>
<span id="cb21-22">    )</span></code></pre></div>
</section>
</section>
<section id="모니터링" class="level2" data-number="10">
<h2 data-number="10" class="anchored" data-anchor-id="모니터링"><span class="header-section-number">10</span> 모니터링</h2>
<section id="application-insights" class="level3" data-number="10.1">
<h3 data-number="10.1" class="anchored" data-anchor-id="application-insights"><span class="header-section-number">10.1</span> Application Insights</h3>
<p>Application Insights는 자동으로 활성화된다.</p>
<p><strong>로그 확인:</strong></p>
<div class="sourceCode" id="cb22" style="background: #f1f3f5;"><pre class="sourceCode numberSource bash number-lines code-with-copy"><code class="sourceCode bash"><span id="cb22-1"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># Azure Portal에서 확인</span></span>
<span id="cb22-2"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># Function App → Application Insights → Logs</span></span>
<span id="cb22-3"></span>
<span id="cb22-4"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># 예시 쿼리</span></span>
<span id="cb22-5"><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">traces</span></span>
<span id="cb22-6"><span class="kw" style="color: #003B4F;
background-color: null;
font-style: inherit;">|</span> <span class="ex" style="color: null;
background-color: null;
font-style: inherit;">where</span> message contains <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"RAG"</span></span>
<span id="cb22-7"><span class="kw" style="color: #003B4F;
background-color: null;
font-style: inherit;">|</span> <span class="ex" style="color: null;
background-color: null;
font-style: inherit;">order</span> by timestamp desc</span>
<span id="cb22-8"><span class="kw" style="color: #003B4F;
background-color: null;
font-style: inherit;">|</span> <span class="ex" style="color: null;
background-color: null;
font-style: inherit;">take</span> 100</span></code></pre></div>
</section>
<section id="커스텀-메트릭" class="level3" data-number="10.2">
<h3 data-number="10.2" class="anchored" data-anchor-id="커스텀-메트릭"><span class="header-section-number">10.2</span> 커스텀 메트릭</h3>
<div class="sourceCode" id="cb23" style="background: #f1f3f5;"><pre class="sourceCode numberSource python number-lines code-with-copy"><code class="sourceCode python"><span id="cb23-1"><span class="im" style="color: #00769E;
background-color: null;
font-style: inherit;">from</span> applicationinsights <span class="im" style="color: #00769E;
background-color: null;
font-style: inherit;">import</span> TelemetryClient</span>
<span id="cb23-2"></span>
<span id="cb23-3">tc <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> TelemetryClient(os.getenv(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"APPINSIGHTS_INSTRUMENTATIONKEY"</span>))</span>
<span id="cb23-4"></span>
<span id="cb23-5"><span class="kw" style="color: #003B4F;
background-color: null;
font-style: inherit;">def</span> main(req: func.HttpRequest) <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">-&gt;</span> func.HttpResponse:</span>
<span id="cb23-6">    start_time <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> time.time()</span>
<span id="cb23-7">    </span>
<span id="cb23-8">    <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># RAG 실행</span></span>
<span id="cb23-9">    answer <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> rag_chain.invoke(question)</span>
<span id="cb23-10">    </span>
<span id="cb23-11">    <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># 메트릭 전송</span></span>
<span id="cb23-12">    duration <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> time.time() <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">-</span> start_time</span>
<span id="cb23-13">    tc.track_metric(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"RAGQueryDuration"</span>, duration)</span>
<span id="cb23-14">    tc.track_event(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"RAGQuery"</span>, {<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"question_length"</span>: <span class="bu" style="color: null;
background-color: null;
font-style: inherit;">len</span>(question)})</span>
<span id="cb23-15">    tc.flush()</span>
<span id="cb23-16">    </span>
<span id="cb23-17">    <span class="cf" style="color: #003B4F;
background-color: null;
font-style: inherit;">return</span> func.HttpResponse(...)</span></code></pre></div>
</section>
</section>
<section id="cors-설정" class="level2" data-number="11">
<h2 data-number="11" class="anchored" data-anchor-id="cors-설정"><span class="header-section-number">11</span> CORS 설정</h2>
<p>웹 앱에서 API를 호출하려면 CORS 설정이 필요하다.</p>
<div class="sourceCode" id="cb24" style="background: #f1f3f5;"><pre class="sourceCode numberSource bash number-lines code-with-copy"><code class="sourceCode bash"><span id="cb24-1"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># CORS 허용</span></span>
<span id="cb24-2"><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">az</span> functionapp cors add <span class="dt" style="color: #AD0000;
background-color: null;
font-style: inherit;">\</span></span>
<span id="cb24-3">  <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">--name</span> func-rag-prod <span class="dt" style="color: #AD0000;
background-color: null;
font-style: inherit;">\</span></span>
<span id="cb24-4">  <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">--resource-group</span> rg-rag-prod <span class="dt" style="color: #AD0000;
background-color: null;
font-style: inherit;">\</span></span>
<span id="cb24-5">  <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">--allowed-origins</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"https://your-app.com"</span></span>
<span id="cb24-6"></span>
<span id="cb24-7"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># 모든 오리진 허용 (개발 환경)</span></span>
<span id="cb24-8"><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">az</span> functionapp cors add <span class="dt" style="color: #AD0000;
background-color: null;
font-style: inherit;">\</span></span>
<span id="cb24-9">  <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">--name</span> func-rag-prod <span class="dt" style="color: #AD0000;
background-color: null;
font-style: inherit;">\</span></span>
<span id="cb24-10">  <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">--resource-group</span> rg-rag-prod <span class="dt" style="color: #AD0000;
background-color: null;
font-style: inherit;">\</span></span>
<span id="cb24-11">  <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">--allowed-origins</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"*"</span></span></code></pre></div>
</section>
<section id="보안" class="level2" data-number="12">
<h2 data-number="12" class="anchored" data-anchor-id="보안"><span class="header-section-number">12</span> 보안</h2>
<section id="managed-identity" class="level3" data-number="12.1">
<h3 data-number="12.1" class="anchored" data-anchor-id="managed-identity"><span class="header-section-number">12.1</span> Managed Identity</h3>
<p>API 키 대신 Managed Identity를 사용한다.</p>
<div class="sourceCode" id="cb25" style="background: #f1f3f5;"><pre class="sourceCode numberSource bash number-lines code-with-copy"><code class="sourceCode bash"><span id="cb25-1"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># Managed Identity 활성화</span></span>
<span id="cb25-2"><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">az</span> functionapp identity assign <span class="dt" style="color: #AD0000;
background-color: null;
font-style: inherit;">\</span></span>
<span id="cb25-3">  <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">--name</span> func-rag-prod <span class="dt" style="color: #AD0000;
background-color: null;
font-style: inherit;">\</span></span>
<span id="cb25-4">  <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">--resource-group</span> rg-rag-prod</span>
<span id="cb25-5"></span>
<span id="cb25-6"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># Azure OpenAI에 권한 부여</span></span>
<span id="cb25-7"><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">az</span> role assignment create <span class="dt" style="color: #AD0000;
background-color: null;
font-style: inherit;">\</span></span>
<span id="cb25-8">  <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">--assignee</span> <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">&lt;</span>managed-identity-principal-id<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">&gt;</span> <span class="dt" style="color: #AD0000;
background-color: null;
font-style: inherit;">\</span></span>
<span id="cb25-9">  <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">--role</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Cognitive Services OpenAI User"</span> <span class="dt" style="color: #AD0000;
background-color: null;
font-style: inherit;">\</span></span>
<span id="cb25-10">  <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">--scope</span> <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">&lt;</span>azure-openai-resource-id<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">&gt;</span></span></code></pre></div>
</section>
<section id="key-vault-통합" class="level3" data-number="12.2">
<h3 data-number="12.2" class="anchored" data-anchor-id="key-vault-통합"><span class="header-section-number">12.2</span> Key Vault 통합</h3>
<div class="sourceCode" id="cb26" style="background: #f1f3f5;"><pre class="sourceCode numberSource bash number-lines code-with-copy"><code class="sourceCode bash"><span id="cb26-1"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># Key Vault 생성</span></span>
<span id="cb26-2"><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">az</span> keyvault create <span class="dt" style="color: #AD0000;
background-color: null;
font-style: inherit;">\</span></span>
<span id="cb26-3">  <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">--name</span> kv-rag-prod <span class="dt" style="color: #AD0000;
background-color: null;
font-style: inherit;">\</span></span>
<span id="cb26-4">  <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">--resource-group</span> rg-rag-prod <span class="dt" style="color: #AD0000;
background-color: null;
font-style: inherit;">\</span></span>
<span id="cb26-5">  <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">--location</span> koreacentral</span>
<span id="cb26-6"></span>
<span id="cb26-7"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># 비밀 저장</span></span>
<span id="cb26-8"><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">az</span> keyvault secret set <span class="dt" style="color: #AD0000;
background-color: null;
font-style: inherit;">\</span></span>
<span id="cb26-9">  <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">--vault-name</span> kv-rag-prod <span class="dt" style="color: #AD0000;
background-color: null;
font-style: inherit;">\</span></span>
<span id="cb26-10">  <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">--name</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"AzureOpenAIKey"</span> <span class="dt" style="color: #AD0000;
background-color: null;
font-style: inherit;">\</span></span>
<span id="cb26-11">  <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">--value</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"your-key"</span></span>
<span id="cb26-12"></span>
<span id="cb26-13"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># Function App에서 참조</span></span>
<span id="cb26-14"><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">az</span> functionapp config appsettings set <span class="dt" style="color: #AD0000;
background-color: null;
font-style: inherit;">\</span></span>
<span id="cb26-15">  <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">--name</span> func-rag-prod <span class="dt" style="color: #AD0000;
background-color: null;
font-style: inherit;">\</span></span>
<span id="cb26-16">  <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">--resource-group</span> rg-rag-prod <span class="dt" style="color: #AD0000;
background-color: null;
font-style: inherit;">\</span></span>
<span id="cb26-17">  <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">--settings</span> <span class="dt" style="color: #AD0000;
background-color: null;
font-style: inherit;">\</span></span>
<span id="cb26-18">    AZURE_OPENAI_API_KEY=<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"@Microsoft.KeyVault(SecretUri=https://kv-rag-prod.vault.azure.net/secrets/AzureOpenAIKey/)"</span></span></code></pre></div>
</section>
</section>
<section id="비용-최적화" class="level2" data-number="13">
<h2 data-number="13" class="anchored" data-anchor-id="비용-최적화"><span class="header-section-number">13</span> 비용 최적화</h2>
<section id="consumption-plan-비용" class="level3" data-number="13.1">
<h3 data-number="13.1" class="anchored" data-anchor-id="consumption-plan-비용"><span class="header-section-number">13.1</span> Consumption Plan 비용</h3>
<p><strong>계산식:</strong> - 실행 시간: $0.000016/GB-초 - 요청: $0.20/100만 요청</p>
<p><strong>예시</strong> (월 10,000 요청, 각 5초, 1.5GB 메모리): - 실행 비용: 10,000 × 5초 × 1.5GB × $0.000016 = $1.20 - 요청 비용: 10,000 / 1,000,000 × $0.20 = $0.002 - <strong>총 비용</strong>: ~$1.20/월</p>
<p><strong>무료 할당량:</strong> - 매월 400,000 GB-초 무료 - 매월 1,000,000 요청 무료</p>
</section>
</section>
<section id="참고-자료" class="level2" data-number="14">
<h2 data-number="14" class="anchored" data-anchor-id="참고-자료"><span class="header-section-number">14</span> 참고 자료</h2>
<section id="공식-문서" class="level3" data-number="14.1">
<h3 data-number="14.1" class="anchored" data-anchor-id="공식-문서"><span class="header-section-number">14.1</span> 공식 문서</h3>
<ul>
<li><a href="https://learn.microsoft.com/en-us/azure/azure-functions/functions-reference-python">Azure Functions Python</a></li>
<li><a href="https://azure.microsoft.com/en-us/pricing/details/functions/">Functions 가격</a></li>
</ul>
</section>
</section>
<section id="다음-단계" class="level2" data-number="15">
<h2 data-number="15" class="anchored" data-anchor-id="다음-단계"><span class="header-section-number">15</span> 다음 단계</h2>
<p>서버리스 배포가 완료되었다면, 이제 컨테이너 기반 배포를 살펴보자:</p>
<p>👉 <a href="../../../../../docs/blog/posts/RAG/13-Cloud-RAG/08-Azure-Container-Apps.html">08-Azure-Container-Apps.qmd</a> - Azure Container Apps를 활용한 컨테이너 배포</p>


</section>

 ]]></description>
  <category>AI</category>
  <category>RAG</category>
  <category>Azure</category>
  <guid>kk3225.netlify.app/docs/blog/posts/RAG/13-Cloud-RAG/07-Azure-Functions-Apps.html</guid>
  <pubDate>Fri, 07 Nov 2025 15:00:00 GMT</pubDate>
</item>
<item>
  <title>Azure OpenAI LLM</title>
  <dc:creator>Kwangmin Kim</dc:creator>
  <link>kk3225.netlify.app/docs/blog/posts/RAG/13-Cloud-RAG/06-Azure-OpenAI-LLM.html</link>
  <description><![CDATA[ 





<section id="azure-openai-llm이란" class="level2" data-number="1">
<h2 data-number="1" class="anchored" data-anchor-id="azure-openai-llm이란"><span class="header-section-number">1</span> Azure OpenAI LLM이란?</h2>
<p>Azure OpenAI Service는 OpenAI의 강력한 언어 모델을 Azure 클라우드에서 제공하는 엔터프라이즈급 서비스다.</p>
<p><strong>RAG 시스템에서의 역할:</strong> - 검색된 문서를 컨텍스트로 활용 - 자연어 답변 생성 - 컨텍스트 기반 추론 - 한국어 지원</p>
<p><strong>엔터프라이즈 장점:</strong> - 99.9% SLA 보장 - 데이터 주권 (한국 리전) - Private Endpoint 지원 - RBAC 기반 접근 제어</p>
</section>
<section id="azure-openai-모델" class="level2" data-number="2">
<h2 data-number="2" class="anchored" data-anchor-id="azure-openai-모델"><span class="header-section-number">2</span> Azure OpenAI 모델</h2>
<section id="gpt-4-turbo-권장" class="level3" data-number="2.1">
<h3 data-number="2.1" class="anchored" data-anchor-id="gpt-4-turbo-권장"><span class="header-section-number">2.1</span> GPT-4 Turbo (권장)</h3>
<p><strong>출시</strong>: 2024년 4월</p>
<p><strong>사양:</strong> - 컨텍스트 윈도우: 128K 토큰 - 출력 토큰: 4,096 - 가격: $10 / 1M 입력 토큰, $30 / 1M 출력 토큰</p>
<p><strong>특징:</strong> - <strong>최고 성능</strong> (복잡한 추론) - JSON 모드 지원 - 함수 호출 - 비전 (이미지 이해)</p>
<p><strong>RAG 권장</strong>: ✅ 높은 정확도 필요 시</p>
</section>
<section id="gpt-4o-최신" class="level3" data-number="2.2">
<h3 data-number="2.2" class="anchored" data-anchor-id="gpt-4o-최신"><span class="header-section-number">2.2</span> GPT-4o (최신)</h3>
<p><strong>출시</strong>: 2024년 5월</p>
<p><strong>사양:</strong> - 컨텍스트 윈도우: 128K 토큰 - 출력 토큰: 4,096 - 가격: $5 / 1M 입력 토큰, $15 / 1M 출력 토큰 (GPT-4 대비 <strong>50% 저렴</strong>)</p>
<p><strong>특징:</strong> - GPT-4 수준 성능 - <strong>2배 빠른 속도</strong> - 멀티모달 (텍스트, 이미지, 오디오) - 향상된 한국어 지원</p>
<p><strong>RAG 권장</strong>: ✅ <strong>최선의 선택</strong> (성능 + 비용)</p>
</section>
<section id="gpt-3.5-turbo" class="level3" data-number="2.3">
<h3 data-number="2.3" class="anchored" data-anchor-id="gpt-3.5-turbo"><span class="header-section-number">2.3</span> GPT-3.5 Turbo</h3>
<p><strong>사양:</strong> - 컨텍스트 윈도우: 16K 토큰 - 가격: $0.50 / 1M 입력 토큰, $1.50 / 1M 출력 토큰</p>
<p><strong>특징:</strong> - 빠른 응답 속도 - 낮은 비용 - 간단한 질문에 적합</p>
<p><strong>RAG 권장</strong>: 단순 FAQ 또는 개발/테스트 환경</p>
</section>
<section id="모델-비교" class="level3" data-number="2.4">
<h3 data-number="2.4" class="anchored" data-anchor-id="모델-비교"><span class="header-section-number">2.4</span> 모델 비교</h3>
<table class="table">
<colgroup>
<col style="width: 10%">
<col style="width: 16%">
<col style="width: 17%">
<col style="width: 17%">
<col style="width: 10%">
<col style="width: 10%">
<col style="width: 16%">
</colgroup>
<thead>
<tr class="header">
<th>모델</th>
<th>컨텍스트</th>
<th>입력 가격</th>
<th>출력 가격</th>
<th>성능</th>
<th>속도</th>
<th>RAG 권장</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td><strong>GPT-4o</strong></td>
<td>128K</td>
<td>$5/1M</td>
<td>$15/1M</td>
<td>⭐⭐⭐⭐⭐</td>
<td>⚡⚡⚡</td>
<td>✅ <strong>최고</strong></td>
</tr>
<tr class="even">
<td>GPT-4 Turbo</td>
<td>128K</td>
<td>$10/1M</td>
<td>$30/1M</td>
<td>⭐⭐⭐⭐⭐</td>
<td>⚡⚡</td>
<td>고정밀도</td>
</tr>
<tr class="odd">
<td>GPT-3.5 Turbo</td>
<td>16K</td>
<td>$0.50/1M</td>
<td>$1.50/1M</td>
<td>⭐⭐⭐</td>
<td>⚡⚡⚡</td>
<td>개발용</td>
</tr>
</tbody>
</table>
</section>
</section>
<section id="환경-설정" class="level2" data-number="3">
<h2 data-number="3" class="anchored" data-anchor-id="환경-설정"><span class="header-section-number">3</span> 환경 설정</h2>
<section id="azure-openai-리소스-생성" class="level3" data-number="3.1">
<h3 data-number="3.1" class="anchored" data-anchor-id="azure-openai-리소스-생성"><span class="header-section-number">3.1</span> Azure OpenAI 리소스 생성</h3>
<div class="sourceCode" id="cb1" style="background: #f1f3f5;"><pre class="sourceCode numberSource bash number-lines code-with-copy"><code class="sourceCode bash"><span id="cb1-1"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># Azure OpenAI 리소스 생성</span></span>
<span id="cb1-2"><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">az</span> cognitiveservices account create <span class="dt" style="color: #AD0000;
background-color: null;
font-style: inherit;">\</span></span>
<span id="cb1-3">    <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">--name</span> openai-rag-prod <span class="dt" style="color: #AD0000;
background-color: null;
font-style: inherit;">\</span></span>
<span id="cb1-4">    <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">--resource-group</span> rg-rag-prod <span class="dt" style="color: #AD0000;
background-color: null;
font-style: inherit;">\</span></span>
<span id="cb1-5">    <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">--kind</span> OpenAI <span class="dt" style="color: #AD0000;
background-color: null;
font-style: inherit;">\</span></span>
<span id="cb1-6">    <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">--sku</span> S0 <span class="dt" style="color: #AD0000;
background-color: null;
font-style: inherit;">\</span></span>
<span id="cb1-7">    <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">--location</span> eastus</span>
<span id="cb1-8"></span>
<span id="cb1-9"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># 키 조회</span></span>
<span id="cb1-10"><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">az</span> cognitiveservices account keys list <span class="dt" style="color: #AD0000;
background-color: null;
font-style: inherit;">\</span></span>
<span id="cb1-11">    <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">--name</span> openai-rag-prod <span class="dt" style="color: #AD0000;
background-color: null;
font-style: inherit;">\</span></span>
<span id="cb1-12">    <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">--resource-group</span> rg-rag-prod</span></code></pre></div>
</section>
<section id="모델-배포" class="level3" data-number="3.2">
<h3 data-number="3.2" class="anchored" data-anchor-id="모델-배포"><span class="header-section-number">3.2</span> 모델 배포</h3>
<p>Azure OpenAI Studio에서: 1. “배포” → “+ 배포 만들기” 2. 모델 선택: <strong>gpt-4o</strong> 3. 배포 이름: <code>gpt-4o</code> 4. TPM: 80K (분당 토큰 제한)</p>
</section>
<section id="환경-변수" class="level3" data-number="3.3">
<h3 data-number="3.3" class="anchored" data-anchor-id="환경-변수"><span class="header-section-number">3.3</span> 환경 변수</h3>
<p><code>.env</code> 파일:</p>
<pre><code>AZURE_OPENAI_ENDPOINT=https://openai-rag-prod.openai.azure.com/
AZURE_OPENAI_API_KEY=your-key-here
AZURE_OPENAI_DEPLOYMENT=gpt-4o
AZURE_OPENAI_API_VERSION=2024-02-01</code></pre>
</section>
</section>
<section id="기본-사용법" class="level2" data-number="4">
<h2 data-number="4" class="anchored" data-anchor-id="기본-사용법"><span class="header-section-number">4</span> 기본 사용법</h2>
<section id="azurechatopenai-초기화" class="level3" data-number="4.1">
<h3 data-number="4.1" class="anchored" data-anchor-id="azurechatopenai-초기화"><span class="header-section-number">4.1</span> AzureChatOpenAI 초기화</h3>
<div id="9740977f" class="cell" data-execution_count="2">
<details class="code-fold">
<summary>코드</summary>
<div class="sourceCode cell-code" id="cb3" style="background: #f1f3f5;"><pre class="sourceCode numberSource python number-lines code-with-copy"><code class="sourceCode python"><span id="cb3-1"><span class="im" style="color: #00769E;
background-color: null;
font-style: inherit;">from</span> langchain_openai <span class="im" style="color: #00769E;
background-color: null;
font-style: inherit;">import</span> AzureChatOpenAI</span>
<span id="cb3-2"><span class="im" style="color: #00769E;
background-color: null;
font-style: inherit;">from</span> dotenv <span class="im" style="color: #00769E;
background-color: null;
font-style: inherit;">import</span> load_dotenv</span>
<span id="cb3-3"><span class="im" style="color: #00769E;
background-color: null;
font-style: inherit;">import</span> os</span>
<span id="cb3-4"></span>
<span id="cb3-5">load_dotenv()</span>
<span id="cb3-6"></span>
<span id="cb3-7">llm <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> AzureChatOpenAI(</span>
<span id="cb3-8">    azure_deployment<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span>os.getenv(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"AZURE_OPENAI_DEPLOYMENT"</span>),</span>
<span id="cb3-9">    openai_api_version<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span>os.getenv(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"AZURE_OPENAI_API_VERSION"</span>),</span>
<span id="cb3-10">    azure_endpoint<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span>os.getenv(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"AZURE_OPENAI_ENDPOINT"</span>),</span>
<span id="cb3-11">    api_key<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span>os.getenv(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"AZURE_OPENAI_API_KEY"</span>),</span>
<span id="cb3-12">    temperature<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">0</span>,  <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># 결정적 출력</span></span>
<span id="cb3-13">    max_tokens<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1000</span>  <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># 최대 출력 길이</span></span>
<span id="cb3-14">)</span>
<span id="cb3-15"></span>
<span id="cb3-16"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># 테스트</span></span>
<span id="cb3-17">response <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> llm.invoke(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Azure OpenAI란 무엇인가?"</span>)</span>
<span id="cb3-18"><span class="bu" style="color: null;
background-color: null;
font-style: inherit;">print</span>(response.content)</span></code></pre></div>
</details>
</div>
</section>
<section id="메시지-형식" class="level3" data-number="4.2">
<h3 data-number="4.2" class="anchored" data-anchor-id="메시지-형식"><span class="header-section-number">4.2</span> 메시지 형식</h3>
<div id="bcdbe944" class="cell" data-execution_count="3">
<details class="code-fold">
<summary>코드</summary>
<div class="sourceCode cell-code" id="cb4" style="background: #f1f3f5;"><pre class="sourceCode numberSource python number-lines code-with-copy"><code class="sourceCode python"><span id="cb4-1"><span class="im" style="color: #00769E;
background-color: null;
font-style: inherit;">from</span> langchain_core.messages <span class="im" style="color: #00769E;
background-color: null;
font-style: inherit;">import</span> HumanMessage, SystemMessage</span>
<span id="cb4-2"></span>
<span id="cb4-3">messages <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> [</span>
<span id="cb4-4">    SystemMessage(content<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"당신은 Azure 전문가입니다."</span>),</span>
<span id="cb4-5">    HumanMessage(content<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Azure AI Search를 설명해주세요."</span>)</span>
<span id="cb4-6">]</span>
<span id="cb4-7"></span>
<span id="cb4-8">response <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> llm.invoke(messages)</span>
<span id="cb4-9"><span class="bu" style="color: null;
background-color: null;
font-style: inherit;">print</span>(response.content)</span></code></pre></div>
</details>
</div>
</section>
</section>
<section id="rag-프롬프트-엔지니어링" class="level2" data-number="5">
<h2 data-number="5" class="anchored" data-anchor-id="rag-프롬프트-엔지니어링"><span class="header-section-number">5</span> RAG 프롬프트 엔지니어링</h2>
<section id="기본-rag-프롬프트" class="level3" data-number="5.1">
<h3 data-number="5.1" class="anchored" data-anchor-id="기본-rag-프롬프트"><span class="header-section-number">5.1</span> 기본 RAG 프롬프트</h3>
<div id="f1e27d60" class="cell" data-execution_count="4">
<details class="code-fold">
<summary>코드</summary>
<div class="sourceCode cell-code" id="cb5" style="background: #f1f3f5;"><pre class="sourceCode numberSource python number-lines code-with-copy"><code class="sourceCode python"><span id="cb5-1"><span class="im" style="color: #00769E;
background-color: null;
font-style: inherit;">from</span> langchain_core.prompts <span class="im" style="color: #00769E;
background-color: null;
font-style: inherit;">import</span> ChatPromptTemplate</span>
<span id="cb5-2"></span>
<span id="cb5-3">basic_prompt <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> ChatPromptTemplate.from_template(</span>
<span id="cb5-4">    <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"""다음 컨텍스트를 참고하여 질문에 답변하세요.</span></span>
<span id="cb5-5"></span>
<span id="cb5-6"><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">컨텍스트:</span></span>
<span id="cb5-7"><span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">{context}</span></span>
<span id="cb5-8"></span>
<span id="cb5-9"><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">질문: </span><span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">{question}</span></span>
<span id="cb5-10"></span>
<span id="cb5-11"><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">답변:"""</span></span>
<span id="cb5-12">)</span></code></pre></div>
</details>
</div>
</section>
<section id="한국어-최적화-프롬프트" class="level3" data-number="5.2">
<h3 data-number="5.2" class="anchored" data-anchor-id="한국어-최적화-프롬프트"><span class="header-section-number">5.2</span> 한국어 최적화 프롬프트</h3>
<div id="f8762068" class="cell" data-execution_count="5">
<details class="code-fold">
<summary>코드</summary>
<div class="sourceCode cell-code" id="cb6" style="background: #f1f3f5;"><pre class="sourceCode numberSource python number-lines code-with-copy"><code class="sourceCode python"><span id="cb6-1">korean_prompt <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> ChatPromptTemplate.from_template(</span>
<span id="cb6-2">    <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"""당신은 친절한 AI 어시스턴트입니다.</span></span>
<span id="cb6-3"><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">주어진 컨텍스트를 바탕으로 사용자의 질문에 정확하고 상세하게 답변하세요.</span></span>
<span id="cb6-4"></span>
<span id="cb6-5"><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">## 지침:</span></span>
<span id="cb6-6"><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">1. 컨텍스트에 있는 정보만 사용하세요</span></span>
<span id="cb6-7"><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">2. 확실하지 않으면 "잘 모르겠습니다"라고 답하세요</span></span>
<span id="cb6-8"><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">3. 답변은 한국어로 작성하세요</span></span>
<span id="cb6-9"><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">4. 전문 용어는 쉽게 설명하세요</span></span>
<span id="cb6-10"></span>
<span id="cb6-11"><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">## 컨텍스트:</span></span>
<span id="cb6-12"><span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">{context}</span></span>
<span id="cb6-13"></span>
<span id="cb6-14"><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">## 질문:</span></span>
<span id="cb6-15"><span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">{question}</span></span>
<span id="cb6-16"></span>
<span id="cb6-17"><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">## 답변:"""</span></span>
<span id="cb6-18">)</span></code></pre></div>
</details>
</div>
</section>
<section id="구조화된-답변-프롬프트" class="level3" data-number="5.3">
<h3 data-number="5.3" class="anchored" data-anchor-id="구조화된-답변-프롬프트"><span class="header-section-number">5.3</span> 구조화된 답변 프롬프트</h3>
<div id="f146ea33" class="cell" data-execution_count="6">
<details class="code-fold">
<summary>코드</summary>
<div class="sourceCode cell-code" id="cb7" style="background: #f1f3f5;"><pre class="sourceCode numberSource python number-lines code-with-copy"><code class="sourceCode python"><span id="cb7-1">structured_prompt <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> ChatPromptTemplate.from_template(</span>
<span id="cb7-2">    <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"""다음 컨텍스트를 참고하여 질문에 답변하세요.</span></span>
<span id="cb7-3"></span>
<span id="cb7-4"><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">컨텍스트:</span></span>
<span id="cb7-5"><span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">{context}</span></span>
<span id="cb7-6"></span>
<span id="cb7-7"><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">질문: </span><span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">{question}</span></span>
<span id="cb7-8"></span>
<span id="cb7-9"><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">답변은 다음 형식으로 작성하세요:</span></span>
<span id="cb7-10"></span>
<span id="cb7-11"><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">**요약:** (한 문장 요약)</span></span>
<span id="cb7-12"></span>
<span id="cb7-13"><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">**상세 설명:**</span></span>
<span id="cb7-14"><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">- 핵심 포인트 1</span></span>
<span id="cb7-15"><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">- 핵심 포인트 2</span></span>
<span id="cb7-16"><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">- 핵심 포인트 3</span></span>
<span id="cb7-17"></span>
<span id="cb7-18"><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">**출처:** (컨텍스트에서 인용)</span></span>
<span id="cb7-19"></span>
<span id="cb7-20"><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">답변:"""</span></span>
<span id="cb7-21">)</span></code></pre></div>
</details>
</div>
</section>
<section id="few-shot-프롬프트" class="level3" data-number="5.4">
<h3 data-number="5.4" class="anchored" data-anchor-id="few-shot-프롬프트"><span class="header-section-number">5.4</span> Few-Shot 프롬프트</h3>
<div id="f8b6fd9d" class="cell" data-execution_count="7">
<details class="code-fold">
<summary>코드</summary>
<div class="sourceCode cell-code" id="cb8" style="background: #f1f3f5;"><pre class="sourceCode numberSource python number-lines code-with-copy"><code class="sourceCode python"><span id="cb8-1">few_shot_prompt <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> ChatPromptTemplate.from_template(</span>
<span id="cb8-2">    <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"""다음 예시를 참고하여 질문에 답변하세요.</span></span>
<span id="cb8-3"></span>
<span id="cb8-4"><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">예시 1:</span></span>
<span id="cb8-5"><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">질문: Azure Blob Storage란?</span></span>
<span id="cb8-6"><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">답변: Azure Blob Storage는 Microsoft의 클라우드 객체 스토리지 서비스입니다. </span></span>
<span id="cb8-7"><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">대량의 비구조화 데이터를 저장할 수 있으며, Hot/Cool/Archive 티어를 제공합니다.</span></span>
<span id="cb8-8"></span>
<span id="cb8-9"><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">예시 2:</span></span>
<span id="cb8-10"><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">질문: Document Intelligence의 용도는?</span></span>
<span id="cb8-11"><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">답변: Document Intelligence는 OCR 및 문서 분석 서비스입니다.</span></span>
<span id="cb8-12"><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">PDF, 이미지에서 텍스트, 표, 레이아웃을 추출하여 RAG 시스템의 입력으로 사용합니다.</span></span>
<span id="cb8-13"></span>
<span id="cb8-14"><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">이제 실제 질문에 답변하세요:</span></span>
<span id="cb8-15"></span>
<span id="cb8-16"><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">컨텍스트:</span></span>
<span id="cb8-17"><span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">{context}</span></span>
<span id="cb8-18"></span>
<span id="cb8-19"><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">질문: </span><span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">{question}</span></span>
<span id="cb8-20"></span>
<span id="cb8-21"><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">답변:"""</span></span>
<span id="cb8-22">)</span></code></pre></div>
</details>
</div>
</section>
</section>
<section id="컨텍스트-관리" class="level2" data-number="6">
<h2 data-number="6" class="anchored" data-anchor-id="컨텍스트-관리"><span class="header-section-number">6</span> 컨텍스트 관리</h2>
<section id="컨텍스트-압축" class="level3" data-number="6.1">
<h3 data-number="6.1" class="anchored" data-anchor-id="컨텍스트-압축"><span class="header-section-number">6.1</span> 컨텍스트 압축</h3>
<div id="65cb8192" class="cell" data-execution_count="8">
<details class="code-fold">
<summary>코드</summary>
<div class="sourceCode cell-code" id="cb9" style="background: #f1f3f5;"><pre class="sourceCode numberSource python number-lines code-with-copy"><code class="sourceCode python"><span id="cb9-1"><span class="kw" style="color: #003B4F;
background-color: null;
font-style: inherit;">def</span> compress_context(docs, max_tokens<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">3000</span>):</span>
<span id="cb9-2">    <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">"""컨텍스트를 토큰 제한 내로 압축"""</span></span>
<span id="cb9-3">    <span class="im" style="color: #00769E;
background-color: null;
font-style: inherit;">import</span> tiktoken</span>
<span id="cb9-4">    </span>
<span id="cb9-5">    encoding <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> tiktoken.encoding_for_model(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"gpt-4"</span>)</span>
<span id="cb9-6">    </span>
<span id="cb9-7">    compressed <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> []</span>
<span id="cb9-8">    total_tokens <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">0</span></span>
<span id="cb9-9">    </span>
<span id="cb9-10">    <span class="cf" style="color: #003B4F;
background-color: null;
font-style: inherit;">for</span> doc <span class="kw" style="color: #003B4F;
background-color: null;
font-style: inherit;">in</span> docs:</span>
<span id="cb9-11">        tokens <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> encoding.encode(doc.page_content)</span>
<span id="cb9-12">        doc_tokens <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> <span class="bu" style="color: null;
background-color: null;
font-style: inherit;">len</span>(tokens)</span>
<span id="cb9-13">        </span>
<span id="cb9-14">        <span class="cf" style="color: #003B4F;
background-color: null;
font-style: inherit;">if</span> total_tokens <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span> doc_tokens <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">&lt;=</span> max_tokens:</span>
<span id="cb9-15">            compressed.append(doc.page_content)</span>
<span id="cb9-16">            total_tokens <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+=</span> doc_tokens</span>
<span id="cb9-17">        <span class="cf" style="color: #003B4F;
background-color: null;
font-style: inherit;">else</span>:</span>
<span id="cb9-18">            <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># 남은 공간에 맞춰 자르기</span></span>
<span id="cb9-19">            remaining <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> max_tokens <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">-</span> total_tokens</span>
<span id="cb9-20">            truncated <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> encoding.decode(tokens[:remaining])</span>
<span id="cb9-21">            compressed.append(truncated <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"..."</span>)</span>
<span id="cb9-22">            <span class="cf" style="color: #003B4F;
background-color: null;
font-style: inherit;">break</span></span>
<span id="cb9-23">    </span>
<span id="cb9-24">    <span class="cf" style="color: #003B4F;
background-color: null;
font-style: inherit;">return</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"</span><span class="ch" style="color: #20794D;
background-color: null;
font-style: inherit;">\n\n</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"</span>.join(compressed)</span>
<span id="cb9-25"></span>
<span id="cb9-26"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># 사용</span></span>
<span id="cb9-27"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># context = compress_context(retrieved_docs, max_tokens=3000)</span></span></code></pre></div>
</details>
</div>
</section>
<section id="컨텍스트-재정렬" class="level3" data-number="6.2">
<h3 data-number="6.2" class="anchored" data-anchor-id="컨텍스트-재정렬"><span class="header-section-number">6.2</span> 컨텍스트 재정렬</h3>
<div id="dd0935be" class="cell" data-execution_count="9">
<details class="code-fold">
<summary>코드</summary>
<div class="sourceCode cell-code" id="cb10" style="background: #f1f3f5;"><pre class="sourceCode numberSource python number-lines code-with-copy"><code class="sourceCode python"><span id="cb10-1"><span class="im" style="color: #00769E;
background-color: null;
font-style: inherit;">from</span> langchain.document_transformers <span class="im" style="color: #00769E;
background-color: null;
font-style: inherit;">import</span> LongContextReorder</span>
<span id="cb10-2"></span>
<span id="cb10-3"><span class="kw" style="color: #003B4F;
background-color: null;
font-style: inherit;">def</span> reorder_context(docs):</span>
<span id="cb10-4">    <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">"""중요한 문서를 양 끝에 배치"""</span></span>
<span id="cb10-5">    reorderer <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> LongContextReorder()</span>
<span id="cb10-6">    reordered <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> reorderer.transform_documents(docs)</span>
<span id="cb10-7">    <span class="cf" style="color: #003B4F;
background-color: null;
font-style: inherit;">return</span> reordered</span>
<span id="cb10-8"></span>
<span id="cb10-9"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># 사용: 첫 번째와 마지막 문서가 가장 중요</span></span>
<span id="cb10-10"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># reordered_docs = reorder_context(retrieved_docs)</span></span></code></pre></div>
</details>
</div>
</section>
</section>
<section id="고급-rag-패턴" class="level2" data-number="7">
<h2 data-number="7" class="anchored" data-anchor-id="고급-rag-패턴"><span class="header-section-number">7</span> 고급 RAG 패턴</h2>
<section id="chain-of-thought-cot" class="level3" data-number="7.1">
<h3 data-number="7.1" class="anchored" data-anchor-id="chain-of-thought-cot"><span class="header-section-number">7.1</span> Chain-of-Thought (CoT)</h3>
<div id="10407c3b" class="cell" data-execution_count="10">
<details class="code-fold">
<summary>코드</summary>
<div class="sourceCode cell-code" id="cb11" style="background: #f1f3f5;"><pre class="sourceCode numberSource python number-lines code-with-copy"><code class="sourceCode python"><span id="cb11-1">cot_prompt <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> ChatPromptTemplate.from_template(</span>
<span id="cb11-2">    <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"""다음 컨텍스트를 참고하여 질문에 단계적으로 답변하세요.</span></span>
<span id="cb11-3"></span>
<span id="cb11-4"><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">컨텍스트:</span></span>
<span id="cb11-5"><span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">{context}</span></span>
<span id="cb11-6"></span>
<span id="cb11-7"><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">질문: </span><span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">{question}</span></span>
<span id="cb11-8"></span>
<span id="cb11-9"><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">단계별 추론:</span></span>
<span id="cb11-10"><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">1. 먼저 질문의 핵심을 파악합니다</span></span>
<span id="cb11-11"><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">2. 컨텍스트에서 관련 정보를 찾습니다</span></span>
<span id="cb11-12"><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">3. 정보를 종합하여 답변을 구성합니다</span></span>
<span id="cb11-13"></span>
<span id="cb11-14"><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">답변:"""</span></span>
<span id="cb11-15">)</span></code></pre></div>
</details>
</div>
</section>
<section id="self-ask" class="level3" data-number="7.2">
<h3 data-number="7.2" class="anchored" data-anchor-id="self-ask"><span class="header-section-number">7.2</span> Self-Ask</h3>
<div id="0b5469b6" class="cell" data-execution_count="11">
<details class="code-fold">
<summary>코드</summary>
<div class="sourceCode cell-code" id="cb12" style="background: #f1f3f5;"><pre class="sourceCode numberSource python number-lines code-with-copy"><code class="sourceCode python"><span id="cb12-1">self_ask_prompt <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> ChatPromptTemplate.from_template(</span>
<span id="cb12-2">    <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"""질문에 답하기 위해 필요한 하위 질문을 먼저 생성하고 답변하세요.</span></span>
<span id="cb12-3"></span>
<span id="cb12-4"><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">컨텍스트:</span></span>
<span id="cb12-5"><span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">{context}</span></span>
<span id="cb12-6"></span>
<span id="cb12-7"><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">질문: </span><span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">{question}</span></span>
<span id="cb12-8"></span>
<span id="cb12-9"><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">하위 질문 1: [질문]</span></span>
<span id="cb12-10"><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">답변 1: [답변]</span></span>
<span id="cb12-11"></span>
<span id="cb12-12"><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">하위 질문 2: [질문]</span></span>
<span id="cb12-13"><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">답변 2: [답변]</span></span>
<span id="cb12-14"></span>
<span id="cb12-15"><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">최종 답변: [종합 답변]"""</span></span>
<span id="cb12-16">)</span></code></pre></div>
</details>
</div>
</section>
<section id="인용-포함-답변" class="level3" data-number="7.3">
<h3 data-number="7.3" class="anchored" data-anchor-id="인용-포함-답변"><span class="header-section-number">7.3</span> 인용 포함 답변</h3>
<div id="9a60d094" class="cell" data-execution_count="12">
<details class="code-fold">
<summary>코드</summary>
<div class="sourceCode cell-code" id="cb13" style="background: #f1f3f5;"><pre class="sourceCode numberSource python number-lines code-with-copy"><code class="sourceCode python"><span id="cb13-1">citation_prompt <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> ChatPromptTemplate.from_template(</span>
<span id="cb13-2">    <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"""컨텍스트를 참고하여 답변하고, 인용 출처를 표시하세요.</span></span>
<span id="cb13-3"></span>
<span id="cb13-4"><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">컨텍스트:</span></span>
<span id="cb13-5"><span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">{context}</span></span>
<span id="cb13-6"></span>
<span id="cb13-7"><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">질문: </span><span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">{question}</span></span>
<span id="cb13-8"></span>
<span id="cb13-9"><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">답변 형식:</span></span>
<span id="cb13-10"><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">답변 내용 [출처: 문서명 또는 페이지]</span></span>
<span id="cb13-11"></span>
<span id="cb13-12"><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">답변:"""</span></span>
<span id="cb13-13">)</span></code></pre></div>
</details>
</div>
</section>
</section>
<section id="스트리밍" class="level2" data-number="8">
<h2 data-number="8" class="anchored" data-anchor-id="스트리밍"><span class="header-section-number">8</span> 스트리밍</h2>
<section id="실시간-응답-스트리밍" class="level3" data-number="8.1">
<h3 data-number="8.1" class="anchored" data-anchor-id="실시간-응답-스트리밍"><span class="header-section-number">8.1</span> 실시간 응답 스트리밍</h3>
<div id="151bd8b5" class="cell" data-execution_count="13">
<details class="code-fold">
<summary>코드</summary>
<div class="sourceCode cell-code" id="cb14" style="background: #f1f3f5;"><pre class="sourceCode numberSource python number-lines code-with-copy"><code class="sourceCode python"><span id="cb14-1"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># 스트리밍 활성화</span></span>
<span id="cb14-2">streaming_llm <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> AzureChatOpenAI(</span>
<span id="cb14-3">    azure_deployment<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span>os.getenv(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"AZURE_OPENAI_DEPLOYMENT"</span>),</span>
<span id="cb14-4">    openai_api_version<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span>os.getenv(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"AZURE_OPENAI_API_VERSION"</span>),</span>
<span id="cb14-5">    azure_endpoint<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span>os.getenv(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"AZURE_OPENAI_ENDPOINT"</span>),</span>
<span id="cb14-6">    api_key<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span>os.getenv(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"AZURE_OPENAI_API_KEY"</span>),</span>
<span id="cb14-7">    streaming<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span><span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">True</span>,</span>
<span id="cb14-8">    temperature<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">0</span></span>
<span id="cb14-9">)</span>
<span id="cb14-10"></span>
<span id="cb14-11"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># 스트리밍 실행</span></span>
<span id="cb14-12"><span class="cf" style="color: #003B4F;
background-color: null;
font-style: inherit;">for</span> chunk <span class="kw" style="color: #003B4F;
background-color: null;
font-style: inherit;">in</span> streaming_llm.stream(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Azure AI Search란?"</span>):</span>
<span id="cb14-13">    <span class="bu" style="color: null;
background-color: null;
font-style: inherit;">print</span>(chunk.content, end<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">""</span>, flush<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span><span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">True</span>)</span></code></pre></div>
</details>
</div>
</section>
<section id="rag-체인-스트리밍" class="level3" data-number="8.2">
<h3 data-number="8.2" class="anchored" data-anchor-id="rag-체인-스트리밍"><span class="header-section-number">8.2</span> RAG 체인 스트리밍</h3>
<div id="d5a4186c" class="cell" data-execution_count="14">
<details class="code-fold">
<summary>코드</summary>
<div class="sourceCode cell-code" id="cb15" style="background: #f1f3f5;"><pre class="sourceCode numberSource python number-lines code-with-copy"><code class="sourceCode python"><span id="cb15-1"><span class="im" style="color: #00769E;
background-color: null;
font-style: inherit;">from</span> langchain_core.runnables <span class="im" style="color: #00769E;
background-color: null;
font-style: inherit;">import</span> RunnablePassthrough</span>
<span id="cb15-2"><span class="im" style="color: #00769E;
background-color: null;
font-style: inherit;">from</span> langchain_core.output_parsers <span class="im" style="color: #00769E;
background-color: null;
font-style: inherit;">import</span> StrOutputParser</span>
<span id="cb15-3"></span>
<span id="cb15-4"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># 스트리밍 RAG 체인</span></span>
<span id="cb15-5">streaming_chain <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> (</span>
<span id="cb15-6">    {<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"context"</span>: retriever <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">|</span> format_docs, <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"question"</span>: RunnablePassthrough()}</span>
<span id="cb15-7">    <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">|</span> korean_prompt</span>
<span id="cb15-8">    <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">|</span> streaming_llm</span>
<span id="cb15-9">    <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">|</span> StrOutputParser()</span>
<span id="cb15-10">)</span>
<span id="cb15-11"></span>
<span id="cb15-12"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># 실행</span></span>
<span id="cb15-13"><span class="bu" style="color: null;
background-color: null;
font-style: inherit;">print</span>(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"답변: "</span>, end<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">""</span>)</span>
<span id="cb15-14"><span class="cf" style="color: #003B4F;
background-color: null;
font-style: inherit;">for</span> chunk <span class="kw" style="color: #003B4F;
background-color: null;
font-style: inherit;">in</span> streaming_chain.stream(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Azure AI Search의 장점은?"</span>):</span>
<span id="cb15-15">    <span class="bu" style="color: null;
background-color: null;
font-style: inherit;">print</span>(chunk, end<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">""</span>, flush<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span><span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">True</span>)</span>
<span id="cb15-16"><span class="bu" style="color: null;
background-color: null;
font-style: inherit;">print</span>()</span></code></pre></div>
</details>
</div>
</section>
</section>
<section id="json-모드" class="level2" data-number="9">
<h2 data-number="9" class="anchored" data-anchor-id="json-모드"><span class="header-section-number">9</span> JSON 모드</h2>
<section id="구조화된-출력" class="level3" data-number="9.1">
<h3 data-number="9.1" class="anchored" data-anchor-id="구조화된-출력"><span class="header-section-number">9.1</span> 구조화된 출력</h3>
<div id="dc72d024" class="cell" data-execution_count="15">
<details class="code-fold">
<summary>코드</summary>
<div class="sourceCode cell-code" id="cb16" style="background: #f1f3f5;"><pre class="sourceCode numberSource python number-lines code-with-copy"><code class="sourceCode python"><span id="cb16-1">json_llm <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> AzureChatOpenAI(</span>
<span id="cb16-2">    azure_deployment<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span>os.getenv(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"AZURE_OPENAI_DEPLOYMENT"</span>),</span>
<span id="cb16-3">    openai_api_version<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span>os.getenv(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"AZURE_OPENAI_API_VERSION"</span>),</span>
<span id="cb16-4">    azure_endpoint<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span>os.getenv(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"AZURE_OPENAI_ENDPOINT"</span>),</span>
<span id="cb16-5">    api_key<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span>os.getenv(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"AZURE_OPENAI_API_KEY"</span>),</span>
<span id="cb16-6">    temperature<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">0</span>,</span>
<span id="cb16-7">    model_kwargs<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span>{<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"response_format"</span>: {<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"type"</span>: <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"json_object"</span>}}</span>
<span id="cb16-8">)</span>
<span id="cb16-9"></span>
<span id="cb16-10">json_prompt <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> ChatPromptTemplate.from_template(</span>
<span id="cb16-11">    <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"""다음 컨텍스트를 참고하여 질문에 JSON 형식으로 답변하세요.</span></span>
<span id="cb16-12"></span>
<span id="cb16-13"><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">컨텍스트:</span></span>
<span id="cb16-14"><span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">{context}</span></span>
<span id="cb16-15"></span>
<span id="cb16-16"><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">질문: </span><span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">{question}</span></span>
<span id="cb16-17"></span>
<span id="cb16-18"><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">JSON 형식:</span></span>
<span id="cb16-19"><span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">{{</span></span>
<span id="cb16-20"><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">  "answer": "답변 내용",</span></span>
<span id="cb16-21"><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">  "confidence": "high/medium/low",</span></span>
<span id="cb16-22"><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">  "sources": ["출처1", "출처2"]</span></span>
<span id="cb16-23"><span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">}}</span></span>
<span id="cb16-24"></span>
<span id="cb16-25"><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">JSON 응답:"""</span></span>
<span id="cb16-26">)</span>
<span id="cb16-27"></span>
<span id="cb16-28"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># 사용</span></span>
<span id="cb16-29">response <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> json_llm.invoke(</span>
<span id="cb16-30">    json_prompt.invoke({</span>
<span id="cb16-31">        <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"context"</span>: <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Azure AI Search는 벡터 검색을 지원합니다."</span>,</span>
<span id="cb16-32">        <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"question"</span>: <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Azure AI Search의 주요 기능은?"</span></span>
<span id="cb16-33">    })</span>
<span id="cb16-34">)</span>
<span id="cb16-35"></span>
<span id="cb16-36"><span class="im" style="color: #00769E;
background-color: null;
font-style: inherit;">import</span> json</span>
<span id="cb16-37">result <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> json.loads(response.content)</span>
<span id="cb16-38"><span class="bu" style="color: null;
background-color: null;
font-style: inherit;">print</span>(<span class="ss" style="color: #20794D;
background-color: null;
font-style: inherit;">f"답변: </span><span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">{</span>result[<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">'answer'</span>]<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">}</span><span class="ss" style="color: #20794D;
background-color: null;
font-style: inherit;">"</span>)</span>
<span id="cb16-39"><span class="bu" style="color: null;
background-color: null;
font-style: inherit;">print</span>(<span class="ss" style="color: #20794D;
background-color: null;
font-style: inherit;">f"신뢰도: </span><span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">{</span>result[<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">'confidence'</span>]<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">}</span><span class="ss" style="color: #20794D;
background-color: null;
font-style: inherit;">"</span>)</span></code></pre></div>
</details>
</div>
</section>
</section>
<section id="함수-호출" class="level2" data-number="10">
<h2 data-number="10" class="anchored" data-anchor-id="함수-호출"><span class="header-section-number">10</span> 함수 호출</h2>
<section id="도구-정의" class="level3" data-number="10.1">
<h3 data-number="10.1" class="anchored" data-anchor-id="도구-정의"><span class="header-section-number">10.1</span> 도구 정의</h3>
<div id="3293f6f7" class="cell" data-execution_count="16">
<details class="code-fold">
<summary>코드</summary>
<div class="sourceCode cell-code" id="cb17" style="background: #f1f3f5;"><pre class="sourceCode numberSource python number-lines code-with-copy"><code class="sourceCode python"><span id="cb17-1"><span class="im" style="color: #00769E;
background-color: null;
font-style: inherit;">from</span> langchain_core.tools <span class="im" style="color: #00769E;
background-color: null;
font-style: inherit;">import</span> tool</span>
<span id="cb17-2"></span>
<span id="cb17-3"><span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">@tool</span></span>
<span id="cb17-4"><span class="kw" style="color: #003B4F;
background-color: null;
font-style: inherit;">def</span> search_documents(query: <span class="bu" style="color: null;
background-color: null;
font-style: inherit;">str</span>) <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">-&gt;</span> <span class="bu" style="color: null;
background-color: null;
font-style: inherit;">str</span>:</span>
<span id="cb17-5">    <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">"""문서를 검색하는 도구"""</span></span>
<span id="cb17-6">    <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># 실제로는 retriever 사용</span></span>
<span id="cb17-7">    <span class="cf" style="color: #003B4F;
background-color: null;
font-style: inherit;">return</span> <span class="ss" style="color: #20794D;
background-color: null;
font-style: inherit;">f"'</span><span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">{</span>query<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">}</span><span class="ss" style="color: #20794D;
background-color: null;
font-style: inherit;">'에 대한 검색 결과입니다."</span></span>
<span id="cb17-8"></span>
<span id="cb17-9"><span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">@tool</span></span>
<span id="cb17-10"><span class="kw" style="color: #003B4F;
background-color: null;
font-style: inherit;">def</span> get_metadata(doc_id: <span class="bu" style="color: null;
background-color: null;
font-style: inherit;">str</span>) <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">-&gt;</span> <span class="bu" style="color: null;
background-color: null;
font-style: inherit;">dict</span>:</span>
<span id="cb17-11">    <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">"""문서 메타데이터를 가져오는 도구"""</span></span>
<span id="cb17-12">    <span class="cf" style="color: #003B4F;
background-color: null;
font-style: inherit;">return</span> {<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"id"</span>: doc_id, <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"title"</span>: <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"샘플 문서"</span>, <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"date"</span>: <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"2025-01-01"</span>}</span>
<span id="cb17-13"></span>
<span id="cb17-14">tools <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> [search_documents, get_metadata]</span></code></pre></div>
</details>
</div>
</section>
<section id="함수-호출-llm" class="level3" data-number="10.2">
<h3 data-number="10.2" class="anchored" data-anchor-id="함수-호출-llm"><span class="header-section-number">10.2</span> 함수 호출 LLM</h3>
<div id="1a138e6e" class="cell" data-execution_count="17">
<details class="code-fold">
<summary>코드</summary>
<div class="sourceCode cell-code" id="cb18" style="background: #f1f3f5;"><pre class="sourceCode numberSource python number-lines code-with-copy"><code class="sourceCode python"><span id="cb18-1"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># 도구 바인딩</span></span>
<span id="cb18-2">llm_with_tools <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> llm.bind_tools(tools)</span>
<span id="cb18-3"></span>
<span id="cb18-4"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># 실행</span></span>
<span id="cb18-5">response <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> llm_with_tools.invoke(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Azure AI Search 문서를 검색해줘"</span>)</span>
<span id="cb18-6"></span>
<span id="cb18-7"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># 도구 호출 확인</span></span>
<span id="cb18-8"><span class="cf" style="color: #003B4F;
background-color: null;
font-style: inherit;">if</span> response.tool_calls:</span>
<span id="cb18-9">    <span class="cf" style="color: #003B4F;
background-color: null;
font-style: inherit;">for</span> tool_call <span class="kw" style="color: #003B4F;
background-color: null;
font-style: inherit;">in</span> response.tool_calls:</span>
<span id="cb18-10">        <span class="bu" style="color: null;
background-color: null;
font-style: inherit;">print</span>(<span class="ss" style="color: #20794D;
background-color: null;
font-style: inherit;">f"도구: </span><span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">{</span>tool_call[<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">'name'</span>]<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">}</span><span class="ss" style="color: #20794D;
background-color: null;
font-style: inherit;">"</span>)</span>
<span id="cb18-11">        <span class="bu" style="color: null;
background-color: null;
font-style: inherit;">print</span>(<span class="ss" style="color: #20794D;
background-color: null;
font-style: inherit;">f"인자: </span><span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">{</span>tool_call[<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">'args'</span>]<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">}</span><span class="ss" style="color: #20794D;
background-color: null;
font-style: inherit;">"</span>)</span></code></pre></div>
</details>
</div>
</section>
</section>
<section id="토큰-최적화" class="level2" data-number="11">
<h2 data-number="11" class="anchored" data-anchor-id="토큰-최적화"><span class="header-section-number">11</span> 토큰 최적화</h2>
<section id="토큰-계산" class="level3" data-number="11.1">
<h3 data-number="11.1" class="anchored" data-anchor-id="토큰-계산"><span class="header-section-number">11.1</span> 토큰 계산</h3>
<div id="904952c0" class="cell" data-execution_count="18">
<details class="code-fold">
<summary>코드</summary>
<div class="sourceCode cell-code" id="cb19" style="background: #f1f3f5;"><pre class="sourceCode numberSource python number-lines code-with-copy"><code class="sourceCode python"><span id="cb19-1"><span class="im" style="color: #00769E;
background-color: null;
font-style: inherit;">import</span> tiktoken</span>
<span id="cb19-2"></span>
<span id="cb19-3"><span class="kw" style="color: #003B4F;
background-color: null;
font-style: inherit;">def</span> count_tokens(text, model<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"gpt-4"</span>):</span>
<span id="cb19-4">    <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">"""토큰 수 계산"""</span></span>
<span id="cb19-5">    encoding <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> tiktoken.encoding_for_model(model)</span>
<span id="cb19-6">    <span class="cf" style="color: #003B4F;
background-color: null;
font-style: inherit;">return</span> <span class="bu" style="color: null;
background-color: null;
font-style: inherit;">len</span>(encoding.encode(text))</span>
<span id="cb19-7"></span>
<span id="cb19-8"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># 프롬프트 토큰 확인</span></span>
<span id="cb19-9">prompt_text <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> korean_prompt.invoke({</span>
<span id="cb19-10">    <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"context"</span>: <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"샘플 컨텍스트"</span>,</span>
<span id="cb19-11">    <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"question"</span>: <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"샘플 질문"</span></span>
<span id="cb19-12">}).to_string()</span>
<span id="cb19-13"></span>
<span id="cb19-14">tokens <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> count_tokens(prompt_text)</span>
<span id="cb19-15"><span class="bu" style="color: null;
background-color: null;
font-style: inherit;">print</span>(<span class="ss" style="color: #20794D;
background-color: null;
font-style: inherit;">f"프롬프트 토큰: </span><span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">{</span>tokens<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">}</span><span class="ss" style="color: #20794D;
background-color: null;
font-style: inherit;">"</span>)</span></code></pre></div>
</details>
</div>
</section>
<section id="비용-추정" class="level3" data-number="11.2">
<h3 data-number="11.2" class="anchored" data-anchor-id="비용-추정"><span class="header-section-number">11.2</span> 비용 추정</h3>
<div id="7f0b9620" class="cell" data-execution_count="19">
<details class="code-fold">
<summary>코드</summary>
<div class="sourceCode cell-code" id="cb20" style="background: #f1f3f5;"><pre class="sourceCode numberSource python number-lines code-with-copy"><code class="sourceCode python"><span id="cb20-1"><span class="kw" style="color: #003B4F;
background-color: null;
font-style: inherit;">def</span> estimate_cost(input_tokens, output_tokens, model<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"gpt-4o"</span>):</span>
<span id="cb20-2">    <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">"""비용 추정 (USD)"""</span></span>
<span id="cb20-3">    prices <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> {</span>
<span id="cb20-4">        <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"gpt-4o"</span>: {<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"input"</span>: <span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">5.0</span>, <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"output"</span>: <span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">15.0</span>},  <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># per 1M tokens</span></span>
<span id="cb20-5">        <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"gpt-4-turbo"</span>: {<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"input"</span>: <span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">10.0</span>, <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"output"</span>: <span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">30.0</span>},</span>
<span id="cb20-6">        <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"gpt-3.5-turbo"</span>: {<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"input"</span>: <span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">0.5</span>, <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"output"</span>: <span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">1.5</span>}</span>
<span id="cb20-7">    }</span>
<span id="cb20-8">    </span>
<span id="cb20-9">    price <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> prices.get(model, prices[<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"gpt-4o"</span>])</span>
<span id="cb20-10">    </span>
<span id="cb20-11">    input_cost <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> (input_tokens <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">/</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1_000_000</span>) <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">*</span> price[<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"input"</span>]</span>
<span id="cb20-12">    output_cost <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> (output_tokens <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">/</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1_000_000</span>) <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">*</span> price[<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"output"</span>]</span>
<span id="cb20-13">    </span>
<span id="cb20-14">    <span class="cf" style="color: #003B4F;
background-color: null;
font-style: inherit;">return</span> input_cost <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span> output_cost</span>
<span id="cb20-15"></span>
<span id="cb20-16"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># 예시: 1000개 질문 (각 3000 입력, 500 출력 토큰)</span></span>
<span id="cb20-17">total_cost <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> estimate_cost(<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">3000</span> <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">*</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1000</span>, <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">500</span> <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">*</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1000</span>, <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"gpt-4o"</span>)</span>
<span id="cb20-18"><span class="bu" style="color: null;
background-color: null;
font-style: inherit;">print</span>(<span class="ss" style="color: #20794D;
background-color: null;
font-style: inherit;">f"예상 비용: $</span><span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">{</span>total_cost<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">:.2f}</span><span class="ss" style="color: #20794D;
background-color: null;
font-style: inherit;">"</span>)</span></code></pre></div>
</details>
</div>
</section>
</section>
<section id="콜백을-통한-모니터링" class="level2" data-number="12">
<h2 data-number="12" class="anchored" data-anchor-id="콜백을-통한-모니터링"><span class="header-section-number">12</span> 콜백을 통한 모니터링</h2>
<div id="4b535347" class="cell" data-execution_count="20">
<details class="code-fold">
<summary>코드</summary>
<div class="sourceCode cell-code" id="cb21" style="background: #f1f3f5;"><pre class="sourceCode numberSource python number-lines code-with-copy"><code class="sourceCode python"><span id="cb21-1"><span class="im" style="color: #00769E;
background-color: null;
font-style: inherit;">from</span> langchain.callbacks <span class="im" style="color: #00769E;
background-color: null;
font-style: inherit;">import</span> StdOutCallbackHandler</span>
<span id="cb21-2"></span>
<span id="cb21-3"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># 콜백 핸들러</span></span>
<span id="cb21-4">callback <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> StdOutCallbackHandler()</span>
<span id="cb21-5"></span>
<span id="cb21-6"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># LLM 호출 시 콜백 전달</span></span>
<span id="cb21-7">response <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> llm.invoke(</span>
<span id="cb21-8">    <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Azure AI Search란?"</span>,</span>
<span id="cb21-9">    config<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span>{<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"callbacks"</span>: [callback]}</span>
<span id="cb21-10">)</span>
<span id="cb21-11"></span>
<span id="cb21-12"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># 토큰 사용량 확인</span></span>
<span id="cb21-13"><span class="bu" style="color: null;
background-color: null;
font-style: inherit;">print</span>(<span class="ss" style="color: #20794D;
background-color: null;
font-style: inherit;">f"토큰 사용량: </span><span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">{</span>response<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">.</span>response_metadata<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">.</span>get(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">'token_usage'</span>)<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">}</span><span class="ss" style="color: #20794D;
background-color: null;
font-style: inherit;">"</span>)</span></code></pre></div>
</details>
</div>
</section>
<section id="오류-처리" class="level2" data-number="13">
<h2 data-number="13" class="anchored" data-anchor-id="오류-처리"><span class="header-section-number">13</span> 오류 처리</h2>
<section id="재시도-로직" class="level3" data-number="13.1">
<h3 data-number="13.1" class="anchored" data-anchor-id="재시도-로직"><span class="header-section-number">13.1</span> 재시도 로직</h3>
<div id="aff85361" class="cell" data-execution_count="21">
<details class="code-fold">
<summary>코드</summary>
<div class="sourceCode cell-code" id="cb22" style="background: #f1f3f5;"><pre class="sourceCode numberSource python number-lines code-with-copy"><code class="sourceCode python"><span id="cb22-1"><span class="im" style="color: #00769E;
background-color: null;
font-style: inherit;">from</span> tenacity <span class="im" style="color: #00769E;
background-color: null;
font-style: inherit;">import</span> retry, stop_after_attempt, wait_exponential</span>
<span id="cb22-2"></span>
<span id="cb22-3"><span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">@retry</span>(</span>
<span id="cb22-4">    stop<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span>stop_after_attempt(<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">3</span>),</span>
<span id="cb22-5">    wait<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span>wait_exponential(multiplier<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span>, <span class="bu" style="color: null;
background-color: null;
font-style: inherit;">min</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">4</span>, <span class="bu" style="color: null;
background-color: null;
font-style: inherit;">max</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">10</span>)</span>
<span id="cb22-6">)</span>
<span id="cb22-7"><span class="kw" style="color: #003B4F;
background-color: null;
font-style: inherit;">def</span> invoke_llm_with_retry(messages):</span>
<span id="cb22-8">    <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">"""재시도 가능한 LLM 호출"""</span></span>
<span id="cb22-9">    <span class="cf" style="color: #003B4F;
background-color: null;
font-style: inherit;">return</span> llm.invoke(messages)</span>
<span id="cb22-10"></span>
<span id="cb22-11"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># 사용</span></span>
<span id="cb22-12"><span class="cf" style="color: #003B4F;
background-color: null;
font-style: inherit;">try</span>:</span>
<span id="cb22-13">    response <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> invoke_llm_with_retry(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"테스트 질문"</span>)</span>
<span id="cb22-14">    <span class="bu" style="color: null;
background-color: null;
font-style: inherit;">print</span>(response.content)</span>
<span id="cb22-15"><span class="cf" style="color: #003B4F;
background-color: null;
font-style: inherit;">except</span> <span class="pp" style="color: #AD0000;
background-color: null;
font-style: inherit;">Exception</span> <span class="im" style="color: #00769E;
background-color: null;
font-style: inherit;">as</span> e:</span>
<span id="cb22-16">    <span class="bu" style="color: null;
background-color: null;
font-style: inherit;">print</span>(<span class="ss" style="color: #20794D;
background-color: null;
font-style: inherit;">f"LLM 호출 실패: </span><span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">{</span>e<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">}</span><span class="ss" style="color: #20794D;
background-color: null;
font-style: inherit;">"</span>)</span></code></pre></div>
</details>
</div>
</section>
<section id="rate-limit-처리" class="level3" data-number="13.2">
<h3 data-number="13.2" class="anchored" data-anchor-id="rate-limit-처리"><span class="header-section-number">13.2</span> Rate Limit 처리</h3>
<div id="980354f5" class="cell" data-execution_count="22">
<details class="code-fold">
<summary>코드</summary>
<div class="sourceCode cell-code" id="cb23" style="background: #f1f3f5;"><pre class="sourceCode numberSource python number-lines code-with-copy"><code class="sourceCode python"><span id="cb23-1"><span class="im" style="color: #00769E;
background-color: null;
font-style: inherit;">import</span> time</span>
<span id="cb23-2"></span>
<span id="cb23-3"><span class="kw" style="color: #003B4F;
background-color: null;
font-style: inherit;">def</span> invoke_with_rate_limit(query, requests_per_minute<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">60</span>):</span>
<span id="cb23-4">    <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">"""Rate limit을 고려한 호출"""</span></span>
<span id="cb23-5">    sleep_time <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">60</span> <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">/</span> requests_per_minute</span>
<span id="cb23-6">    </span>
<span id="cb23-7">    response <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> llm.invoke(query)</span>
<span id="cb23-8">    time.sleep(sleep_time)</span>
<span id="cb23-9">    </span>
<span id="cb23-10">    <span class="cf" style="color: #003B4F;
background-color: null;
font-style: inherit;">return</span> response</span></code></pre></div>
</details>
</div>
</section>
</section>
<section id="참고-자료" class="level2" data-number="14">
<h2 data-number="14" class="anchored" data-anchor-id="참고-자료"><span class="header-section-number">14</span> 참고 자료</h2>
<section id="공식-문서" class="level3" data-number="14.1">
<h3 data-number="14.1" class="anchored" data-anchor-id="공식-문서"><span class="header-section-number">14.1</span> 공식 문서</h3>
<ul>
<li><a href="https://learn.microsoft.com/en-us/azure/ai-services/openai/">Azure OpenAI Service</a></li>
<li><a href="https://learn.microsoft.com/en-us/azure/ai-services/openai/concepts/models#gpt-4o-and-gpt-4-turbo">GPT-4o 모델</a></li>
<li><a href="https://learn.microsoft.com/en-us/azure/ai-services/openai/concepts/prompt-engineering">프롬프트 엔지니어링</a></li>
</ul>
</section>
<section id="langchain" class="level3" data-number="14.2">
<h3 data-number="14.2" class="anchored" data-anchor-id="langchain"><span class="header-section-number">14.2</span> LangChain</h3>
<ul>
<li><a href="https://python.langchain.com/docs/integrations/chat/azure_chat_openai">AzureChatOpenAI</a></li>
</ul>
</section>
</section>
<section id="다음-단계" class="level2" data-number="15">
<h2 data-number="15" class="anchored" data-anchor-id="다음-단계"><span class="header-section-number">15</span> 다음 단계</h2>
<p>Azure OpenAI LLM 최적화가 완료되었다면, 이제 서버리스 배포를 준비하자:</p>
<p>👉 <a href="../../../../../docs/blog/posts/RAG/13-Cloud-RAG/07-Azure-Functions-Apps.html">07-Azure-Functions-Apps.qmd</a> - Azure Functions를 활용한 서버리스 RAG 배포</p>


</section>

 ]]></description>
  <category>AI</category>
  <category>RAG</category>
  <category>Azure</category>
  <guid>kk3225.netlify.app/docs/blog/posts/RAG/13-Cloud-RAG/06-Azure-OpenAI-LLM.html</guid>
  <pubDate>Thu, 06 Nov 2025 15:00:00 GMT</pubDate>
</item>
<item>
  <title>LangChain to LangGraph</title>
  <dc:creator>Kwangmin Kim</dc:creator>
  <link>kk3225.netlify.app/docs/blog/posts/RAG/13-Cloud-RAG/05-LangChain-to-LangGraph.html</link>
  <description><![CDATA[ 





<section id="langchain-vs-langgraph" class="level2" data-number="1">
<h2 data-number="1" class="anchored" data-anchor-id="langchain-vs-langgraph"><span class="header-section-number">1</span> LangChain vs LangGraph</h2>
<section id="langchain의-한계" class="level3" data-number="1.1">
<h3 data-number="1.1" class="anchored" data-anchor-id="langchain의-한계"><span class="header-section-number">1.1</span> LangChain의 한계</h3>
<p><strong>LangChain (LCEL):</strong> - 선형적인 체인 구조 - 단방향 데이터 흐름 - 조건부 로직 구현 어려움 - 복잡한 워크플로우 제한적</p>
<div class="sourceCode" id="cb1" style="background: #f1f3f5;"><pre class="sourceCode numberSource python number-lines code-with-copy"><code class="sourceCode python"><span id="cb1-1"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># LangChain 체인 예시</span></span>
<span id="cb1-2">chain <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> (</span>
<span id="cb1-3">    {<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"context"</span>: retriever, <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"question"</span>: RunnablePassthrough()}</span>
<span id="cb1-4">    <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">|</span> prompt</span>
<span id="cb1-5">    <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">|</span> llm</span>
<span id="cb1-6">    <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">|</span> StrOutputParser()</span>
<span id="cb1-7">)</span></code></pre></div>
<p><strong>문제점:</strong> - 검색 실패 시 재시도 불가 - 답변 품질 검증 없음 - 대화 히스토리 관리 복잡 - 멀티턴 대화 구현 어려움</p>
</section>
<section id="langgraph의-장점" class="level3" data-number="1.2">
<h3 data-number="1.2" class="anchored" data-anchor-id="langgraph의-장점"><span class="header-section-number">1.2</span> LangGraph의 장점</h3>
<p><strong>LangGraph:</strong> - 상태 기반 그래프 구조 - 조건부 라우팅 - 루프 및 재시도 로직 - 복잡한 워크플로우 구현</p>
<p><strong>주요 개념:</strong> - <strong>State</strong>: 상태 관리 (TypedDict) - <strong>Nodes</strong>: 작업 단위 (함수) - <strong>Edges</strong>: 노드 간 연결 - <strong>Conditional Edges</strong>: 조건부 분기</p>
</section>
</section>
<section id="환경-설정" class="level2" data-number="2">
<h2 data-number="2" class="anchored" data-anchor-id="환경-설정"><span class="header-section-number">2</span> 환경 설정</h2>
<section id="설치" class="level3" data-number="2.1">
<h3 data-number="2.1" class="anchored" data-anchor-id="설치"><span class="header-section-number">2.1</span> 설치</h3>
<div class="sourceCode" id="cb2" style="background: #f1f3f5;"><pre class="sourceCode numberSource bash number-lines code-with-copy"><code class="sourceCode bash"><span id="cb2-1"><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">pip</span> install langgraph</span>
<span id="cb2-2"><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">pip</span> install langchain-openai</span>
<span id="cb2-3"><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">pip</span> install azure-search-documents</span></code></pre></div>
</section>
<section id="환경-변수" class="level3" data-number="2.2">
<h3 data-number="2.2" class="anchored" data-anchor-id="환경-변수"><span class="header-section-number">2.2</span> 환경 변수</h3>
<p><code>.env</code> 파일:</p>
<pre><code>AZURE_OPENAI_ENDPOINT=https://openai-rag-prod.openai.azure.com/
AZURE_OPENAI_API_KEY=your-key
AZURE_OPENAI_DEPLOYMENT=gpt-4
AZURE_OPENAI_API_VERSION=2024-02-01

AZURE_SEARCH_ENDPOINT=https://search-rag-prod.search.windows.net
AZURE_SEARCH_API_KEY=your-key
AZURE_SEARCH_INDEX_NAME=rag-documents</code></pre>
</section>
</section>
<section id="기본-langchain-rag" class="level2" data-number="3">
<h2 data-number="3" class="anchored" data-anchor-id="기본-langchain-rag"><span class="header-section-number">3</span> 기본 LangChain RAG</h2>
<p>먼저 기본 LangChain 체인을 구현한다.</p>
<div id="70917e7a" class="cell" data-execution_count="2">
<details class="code-fold">
<summary>코드</summary>
<div class="sourceCode cell-code" id="cb4" style="background: #f1f3f5;"><pre class="sourceCode numberSource python number-lines code-with-copy"><code class="sourceCode python"><span id="cb4-1"><span class="im" style="color: #00769E;
background-color: null;
font-style: inherit;">from</span> langchain_openai <span class="im" style="color: #00769E;
background-color: null;
font-style: inherit;">import</span> AzureOpenAIEmbeddings, AzureChatOpenAI</span>
<span id="cb4-2"><span class="im" style="color: #00769E;
background-color: null;
font-style: inherit;">from</span> langchain_community.vectorstores.azuresearch <span class="im" style="color: #00769E;
background-color: null;
font-style: inherit;">import</span> AzureSearch</span>
<span id="cb4-3"><span class="im" style="color: #00769E;
background-color: null;
font-style: inherit;">from</span> langchain_core.prompts <span class="im" style="color: #00769E;
background-color: null;
font-style: inherit;">import</span> ChatPromptTemplate</span>
<span id="cb4-4"><span class="im" style="color: #00769E;
background-color: null;
font-style: inherit;">from</span> langchain_core.output_parsers <span class="im" style="color: #00769E;
background-color: null;
font-style: inherit;">import</span> StrOutputParser</span>
<span id="cb4-5"><span class="im" style="color: #00769E;
background-color: null;
font-style: inherit;">from</span> langchain_core.runnables <span class="im" style="color: #00769E;
background-color: null;
font-style: inherit;">import</span> RunnablePassthrough</span>
<span id="cb4-6"><span class="im" style="color: #00769E;
background-color: null;
font-style: inherit;">from</span> dotenv <span class="im" style="color: #00769E;
background-color: null;
font-style: inherit;">import</span> load_dotenv</span>
<span id="cb4-7"><span class="im" style="color: #00769E;
background-color: null;
font-style: inherit;">import</span> os</span>
<span id="cb4-8"></span>
<span id="cb4-9">load_dotenv()</span>
<span id="cb4-10"></span>
<span id="cb4-11"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># Embeddings</span></span>
<span id="cb4-12">embeddings <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> AzureOpenAIEmbeddings(</span>
<span id="cb4-13">    azure_deployment<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"text-embedding-3-small"</span>,</span>
<span id="cb4-14">    openai_api_version<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span>os.getenv(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"AZURE_OPENAI_API_VERSION"</span>),</span>
<span id="cb4-15">    azure_endpoint<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span>os.getenv(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"AZURE_OPENAI_ENDPOINT"</span>),</span>
<span id="cb4-16">    api_key<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span>os.getenv(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"AZURE_OPENAI_API_KEY"</span>)</span>
<span id="cb4-17">)</span>
<span id="cb4-18"></span>
<span id="cb4-19"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># Vector Store</span></span>
<span id="cb4-20">vector_store <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> AzureSearch(</span>
<span id="cb4-21">    azure_search_endpoint<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span>os.getenv(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"AZURE_SEARCH_ENDPOINT"</span>),</span>
<span id="cb4-22">    azure_search_key<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span>os.getenv(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"AZURE_SEARCH_API_KEY"</span>),</span>
<span id="cb4-23">    index_name<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span>os.getenv(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"AZURE_SEARCH_INDEX_NAME"</span>),</span>
<span id="cb4-24">    embedding_function<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span>embeddings.embed_query</span>
<span id="cb4-25">)</span>
<span id="cb4-26"></span>
<span id="cb4-27"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># Retriever</span></span>
<span id="cb4-28">retriever <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> vector_store.as_retriever(search_kwargs<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span>{<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"k"</span>: <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">3</span>})</span>
<span id="cb4-29"></span>
<span id="cb4-30"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># LLM</span></span>
<span id="cb4-31">llm <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> AzureChatOpenAI(</span>
<span id="cb4-32">    azure_deployment<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span>os.getenv(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"AZURE_OPENAI_DEPLOYMENT"</span>),</span>
<span id="cb4-33">    openai_api_version<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span>os.getenv(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"AZURE_OPENAI_API_VERSION"</span>),</span>
<span id="cb4-34">    azure_endpoint<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span>os.getenv(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"AZURE_OPENAI_ENDPOINT"</span>),</span>
<span id="cb4-35">    api_key<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span>os.getenv(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"AZURE_OPENAI_API_KEY"</span>),</span>
<span id="cb4-36">    temperature<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">0</span></span>
<span id="cb4-37">)</span>
<span id="cb4-38"></span>
<span id="cb4-39"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># Prompt</span></span>
<span id="cb4-40">prompt <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> ChatPromptTemplate.from_template(</span>
<span id="cb4-41">    <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"""다음 컨텍스트를 참고하여 질문에 답변하세요.</span></span>
<span id="cb4-42"></span>
<span id="cb4-43"><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">컨텍스트:</span></span>
<span id="cb4-44"><span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">{context}</span></span>
<span id="cb4-45"></span>
<span id="cb4-46"><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">질문: </span><span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">{question}</span></span>
<span id="cb4-47"></span>
<span id="cb4-48"><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">답변:"""</span></span>
<span id="cb4-49">)</span>
<span id="cb4-50"></span>
<span id="cb4-51"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># Chain</span></span>
<span id="cb4-52"><span class="kw" style="color: #003B4F;
background-color: null;
font-style: inherit;">def</span> format_docs(docs):</span>
<span id="cb4-53">    <span class="cf" style="color: #003B4F;
background-color: null;
font-style: inherit;">return</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"</span><span class="ch" style="color: #20794D;
background-color: null;
font-style: inherit;">\n\n</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"</span>.join([doc.page_content <span class="cf" style="color: #003B4F;
background-color: null;
font-style: inherit;">for</span> doc <span class="kw" style="color: #003B4F;
background-color: null;
font-style: inherit;">in</span> docs])</span>
<span id="cb4-54"></span>
<span id="cb4-55">rag_chain <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> (</span>
<span id="cb4-56">    {<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"context"</span>: retriever <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">|</span> format_docs, <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"question"</span>: RunnablePassthrough()}</span>
<span id="cb4-57">    <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">|</span> prompt</span>
<span id="cb4-58">    <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">|</span> llm</span>
<span id="cb4-59">    <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">|</span> StrOutputParser()</span>
<span id="cb4-60">)</span>
<span id="cb4-61"></span>
<span id="cb4-62"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># 실행</span></span>
<span id="cb4-63">answer <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> rag_chain.invoke(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Azure AI Search란 무엇인가?"</span>)</span>
<span id="cb4-64"><span class="bu" style="color: null;
background-color: null;
font-style: inherit;">print</span>(answer)</span></code></pre></div>
</details>
</div>
</section>
<section id="langgraph로-전환" class="level2" data-number="4">
<h2 data-number="4" class="anchored" data-anchor-id="langgraph로-전환"><span class="header-section-number">4</span> LangGraph로 전환</h2>
<section id="상태-정의" class="level3" data-number="4.1">
<h3 data-number="4.1" class="anchored" data-anchor-id="상태-정의"><span class="header-section-number">4.1</span> 상태 정의</h3>
<div id="43be66ac" class="cell" data-execution_count="3">
<details class="code-fold">
<summary>코드</summary>
<div class="sourceCode cell-code" id="cb5" style="background: #f1f3f5;"><pre class="sourceCode numberSource python number-lines code-with-copy"><code class="sourceCode python"><span id="cb5-1"><span class="im" style="color: #00769E;
background-color: null;
font-style: inherit;">from</span> typing <span class="im" style="color: #00769E;
background-color: null;
font-style: inherit;">import</span> TypedDict, List</span>
<span id="cb5-2"><span class="im" style="color: #00769E;
background-color: null;
font-style: inherit;">from</span> langchain_core.documents <span class="im" style="color: #00769E;
background-color: null;
font-style: inherit;">import</span> Document</span>
<span id="cb5-3"></span>
<span id="cb5-4"><span class="kw" style="color: #003B4F;
background-color: null;
font-style: inherit;">class</span> RAGState(TypedDict):</span>
<span id="cb5-5">    <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">"""RAG 상태"""</span></span>
<span id="cb5-6">    question: <span class="bu" style="color: null;
background-color: null;
font-style: inherit;">str</span>  <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># 사용자 질문</span></span>
<span id="cb5-7">    context: List[Document]  <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># 검색된 문서</span></span>
<span id="cb5-8">    answer: <span class="bu" style="color: null;
background-color: null;
font-style: inherit;">str</span>  <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># 생성된 답변</span></span>
<span id="cb5-9">    retrieval_success: <span class="bu" style="color: null;
background-color: null;
font-style: inherit;">bool</span>  <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># 검색 성공 여부</span></span></code></pre></div>
</details>
</div>
</section>
<section id="노드-정의" class="level3" data-number="4.2">
<h3 data-number="4.2" class="anchored" data-anchor-id="노드-정의"><span class="header-section-number">4.2</span> 노드 정의</h3>
<div id="7639119c" class="cell" data-execution_count="4">
<details class="code-fold">
<summary>코드</summary>
<div class="sourceCode cell-code" id="cb6" style="background: #f1f3f5;"><pre class="sourceCode numberSource python number-lines code-with-copy"><code class="sourceCode python"><span id="cb6-1"><span class="kw" style="color: #003B4F;
background-color: null;
font-style: inherit;">def</span> retrieve(state: RAGState) <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">-&gt;</span> RAGState:</span>
<span id="cb6-2">    <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">"""문서 검색 노드"""</span></span>
<span id="cb6-3">    question <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> state[<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"question"</span>]</span>
<span id="cb6-4">    </span>
<span id="cb6-5">    <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># 검색 실행</span></span>
<span id="cb6-6">    docs <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> retriever.invoke(question)</span>
<span id="cb6-7">    </span>
<span id="cb6-8">    <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># 검색 성공 여부 확인</span></span>
<span id="cb6-9">    success <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> <span class="bu" style="color: null;
background-color: null;
font-style: inherit;">len</span>(docs) <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">&gt;</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">0</span></span>
<span id="cb6-10">    </span>
<span id="cb6-11">    <span class="cf" style="color: #003B4F;
background-color: null;
font-style: inherit;">return</span> {</span>
<span id="cb6-12">        <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">**</span>state,</span>
<span id="cb6-13">        <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"context"</span>: docs,</span>
<span id="cb6-14">        <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"retrieval_success"</span>: success</span>
<span id="cb6-15">    }</span>
<span id="cb6-16"></span>
<span id="cb6-17"><span class="kw" style="color: #003B4F;
background-color: null;
font-style: inherit;">def</span> generate(state: RAGState) <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">-&gt;</span> RAGState:</span>
<span id="cb6-18">    <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">"""답변 생성 노드"""</span></span>
<span id="cb6-19">    question <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> state[<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"question"</span>]</span>
<span id="cb6-20">    context <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> state[<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"context"</span>]</span>
<span id="cb6-21">    </span>
<span id="cb6-22">    <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># 컨텍스트 포맷팅</span></span>
<span id="cb6-23">    context_text <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"</span><span class="ch" style="color: #20794D;
background-color: null;
font-style: inherit;">\n\n</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"</span>.join([doc.page_content <span class="cf" style="color: #003B4F;
background-color: null;
font-style: inherit;">for</span> doc <span class="kw" style="color: #003B4F;
background-color: null;
font-style: inherit;">in</span> context])</span>
<span id="cb6-24">    </span>
<span id="cb6-25">    <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># 프롬프트 생성</span></span>
<span id="cb6-26">    messages <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> prompt.invoke({</span>
<span id="cb6-27">        <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"context"</span>: context_text,</span>
<span id="cb6-28">        <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"question"</span>: question</span>
<span id="cb6-29">    })</span>
<span id="cb6-30">    </span>
<span id="cb6-31">    <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># 답변 생성</span></span>
<span id="cb6-32">    response <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> llm.invoke(messages)</span>
<span id="cb6-33">    </span>
<span id="cb6-34">    <span class="cf" style="color: #003B4F;
background-color: null;
font-style: inherit;">return</span> {</span>
<span id="cb6-35">        <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">**</span>state,</span>
<span id="cb6-36">        <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"answer"</span>: response.content</span>
<span id="cb6-37">    }</span>
<span id="cb6-38"></span>
<span id="cb6-39"><span class="kw" style="color: #003B4F;
background-color: null;
font-style: inherit;">def</span> no_context_fallback(state: RAGState) <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">-&gt;</span> RAGState:</span>
<span id="cb6-40">    <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">"""컨텍스트 없을 때 기본 답변"""</span></span>
<span id="cb6-41">    <span class="cf" style="color: #003B4F;
background-color: null;
font-style: inherit;">return</span> {</span>
<span id="cb6-42">        <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">**</span>state,</span>
<span id="cb6-43">        <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"answer"</span>: <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"관련 정보를 찾을 수 없습니다. 질문을 다시 입력해주세요."</span></span>
<span id="cb6-44">    }</span></code></pre></div>
</details>
</div>
</section>
<section id="그래프-구성" class="level3" data-number="4.3">
<h3 data-number="4.3" class="anchored" data-anchor-id="그래프-구성"><span class="header-section-number">4.3</span> 그래프 구성</h3>
<div id="65bd2769" class="cell" data-execution_count="5">
<details class="code-fold">
<summary>코드</summary>
<div class="sourceCode cell-code" id="cb7" style="background: #f1f3f5;"><pre class="sourceCode numberSource python number-lines code-with-copy"><code class="sourceCode python"><span id="cb7-1"><span class="im" style="color: #00769E;
background-color: null;
font-style: inherit;">from</span> langgraph.graph <span class="im" style="color: #00769E;
background-color: null;
font-style: inherit;">import</span> StateGraph, END</span>
<span id="cb7-2"></span>
<span id="cb7-3"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># 그래프 생성</span></span>
<span id="cb7-4">workflow <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> StateGraph(RAGState)</span>
<span id="cb7-5"></span>
<span id="cb7-6"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># 노드 추가</span></span>
<span id="cb7-7">workflow.add_node(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"retrieve"</span>, retrieve)</span>
<span id="cb7-8">workflow.add_node(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"generate"</span>, generate)</span>
<span id="cb7-9">workflow.add_node(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"fallback"</span>, no_context_fallback)</span>
<span id="cb7-10"></span>
<span id="cb7-11"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># 시작점 설정</span></span>
<span id="cb7-12">workflow.set_entry_point(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"retrieve"</span>)</span>
<span id="cb7-13"></span>
<span id="cb7-14"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># 조건부 엣지 (검색 성공 여부)</span></span>
<span id="cb7-15"><span class="kw" style="color: #003B4F;
background-color: null;
font-style: inherit;">def</span> should_generate(state: RAGState) <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">-&gt;</span> <span class="bu" style="color: null;
background-color: null;
font-style: inherit;">str</span>:</span>
<span id="cb7-16">    <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">"""검색 성공 시 generate, 실패 시 fallback"""</span></span>
<span id="cb7-17">    <span class="cf" style="color: #003B4F;
background-color: null;
font-style: inherit;">if</span> state[<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"retrieval_success"</span>]:</span>
<span id="cb7-18">        <span class="cf" style="color: #003B4F;
background-color: null;
font-style: inherit;">return</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"generate"</span></span>
<span id="cb7-19">    <span class="cf" style="color: #003B4F;
background-color: null;
font-style: inherit;">else</span>:</span>
<span id="cb7-20">        <span class="cf" style="color: #003B4F;
background-color: null;
font-style: inherit;">return</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"fallback"</span></span>
<span id="cb7-21"></span>
<span id="cb7-22">workflow.add_conditional_edges(</span>
<span id="cb7-23">    <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"retrieve"</span>,</span>
<span id="cb7-24">    should_generate,</span>
<span id="cb7-25">    {</span>
<span id="cb7-26">        <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"generate"</span>: <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"generate"</span>,</span>
<span id="cb7-27">        <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"fallback"</span>: <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"fallback"</span></span>
<span id="cb7-28">    }</span>
<span id="cb7-29">)</span>
<span id="cb7-30"></span>
<span id="cb7-31"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># 종료 엣지</span></span>
<span id="cb7-32">workflow.add_edge(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"generate"</span>, END)</span>
<span id="cb7-33">workflow.add_edge(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"fallback"</span>, END)</span>
<span id="cb7-34"></span>
<span id="cb7-35"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># 컴파일</span></span>
<span id="cb7-36">app <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> workflow.<span class="bu" style="color: null;
background-color: null;
font-style: inherit;">compile</span>()</span></code></pre></div>
</details>
</div>
</section>
<section id="실행" class="level3" data-number="4.4">
<h3 data-number="4.4" class="anchored" data-anchor-id="실행"><span class="header-section-number">4.4</span> 실행</h3>
<div id="979de1f7" class="cell" data-execution_count="6">
<details class="code-fold">
<summary>코드</summary>
<div class="sourceCode cell-code" id="cb8" style="background: #f1f3f5;"><pre class="sourceCode numberSource python number-lines code-with-copy"><code class="sourceCode python"><span id="cb8-1"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># 그래프 실행</span></span>
<span id="cb8-2">result <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> app.invoke({</span>
<span id="cb8-3">    <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"question"</span>: <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Azure AI Search란 무엇인가?"</span></span>
<span id="cb8-4">})</span>
<span id="cb8-5"></span>
<span id="cb8-6"><span class="bu" style="color: null;
background-color: null;
font-style: inherit;">print</span>(<span class="ss" style="color: #20794D;
background-color: null;
font-style: inherit;">f"질문: </span><span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">{</span>result[<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">'question'</span>]<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">}</span><span class="ss" style="color: #20794D;
background-color: null;
font-style: inherit;">"</span>)</span>
<span id="cb8-7"><span class="bu" style="color: null;
background-color: null;
font-style: inherit;">print</span>(<span class="ss" style="color: #20794D;
background-color: null;
font-style: inherit;">f"검색 성공: </span><span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">{</span>result[<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">'retrieval_success'</span>]<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">}</span><span class="ss" style="color: #20794D;
background-color: null;
font-style: inherit;">"</span>)</span>
<span id="cb8-8"><span class="bu" style="color: null;
background-color: null;
font-style: inherit;">print</span>(<span class="ss" style="color: #20794D;
background-color: null;
font-style: inherit;">f"답변: </span><span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">{</span>result[<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">'answer'</span>]<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">}</span><span class="ss" style="color: #20794D;
background-color: null;
font-style: inherit;">"</span>)</span></code></pre></div>
</details>
</div>
</section>
</section>
<section id="대화-히스토리-추가" class="level2" data-number="5">
<h2 data-number="5" class="anchored" data-anchor-id="대화-히스토리-추가"><span class="header-section-number">5</span> 대화 히스토리 추가</h2>
<section id="상태-확장" class="level3" data-number="5.1">
<h3 data-number="5.1" class="anchored" data-anchor-id="상태-확장"><span class="header-section-number">5.1</span> 상태 확장</h3>
<div id="d7c04424" class="cell" data-execution_count="7">
<details class="code-fold">
<summary>코드</summary>
<div class="sourceCode cell-code" id="cb9" style="background: #f1f3f5;"><pre class="sourceCode numberSource python number-lines code-with-copy"><code class="sourceCode python"><span id="cb9-1"><span class="im" style="color: #00769E;
background-color: null;
font-style: inherit;">from</span> langchain_core.messages <span class="im" style="color: #00769E;
background-color: null;
font-style: inherit;">import</span> BaseMessage</span>
<span id="cb9-2"></span>
<span id="cb9-3"><span class="kw" style="color: #003B4F;
background-color: null;
font-style: inherit;">class</span> ConversationState(TypedDict):</span>
<span id="cb9-4">    <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">"""대화 상태"""</span></span>
<span id="cb9-5">    question: <span class="bu" style="color: null;
background-color: null;
font-style: inherit;">str</span></span>
<span id="cb9-6">    chat_history: List[BaseMessage]  <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># 대화 히스토리</span></span>
<span id="cb9-7">    context: List[Document]</span>
<span id="cb9-8">    answer: <span class="bu" style="color: null;
background-color: null;
font-style: inherit;">str</span></span>
<span id="cb9-9">    retrieval_success: <span class="bu" style="color: null;
background-color: null;
font-style: inherit;">bool</span></span></code></pre></div>
</details>
</div>
</section>
<section id="히스토리-기반-검색" class="level3" data-number="5.2">
<h3 data-number="5.2" class="anchored" data-anchor-id="히스토리-기반-검색"><span class="header-section-number">5.2</span> 히스토리 기반 검색</h3>
<div id="f4d8b59d" class="cell" data-execution_count="8">
<details class="code-fold">
<summary>코드</summary>
<div class="sourceCode cell-code" id="cb10" style="background: #f1f3f5;"><pre class="sourceCode numberSource python number-lines code-with-copy"><code class="sourceCode python"><span id="cb10-1"><span class="im" style="color: #00769E;
background-color: null;
font-style: inherit;">from</span> langchain_core.messages <span class="im" style="color: #00769E;
background-color: null;
font-style: inherit;">import</span> HumanMessage, AIMessage</span>
<span id="cb10-2"></span>
<span id="cb10-3"><span class="kw" style="color: #003B4F;
background-color: null;
font-style: inherit;">def</span> retrieve_with_history(state: ConversationState) <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">-&gt;</span> ConversationState:</span>
<span id="cb10-4">    <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">"""대화 히스토리를 고려한 검색"""</span></span>
<span id="cb10-5">    question <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> state[<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"question"</span>]</span>
<span id="cb10-6">    chat_history <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> state.get(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"chat_history"</span>, [])</span>
<span id="cb10-7">    </span>
<span id="cb10-8">    <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># 히스토리를 컨텍스트로 변환</span></span>
<span id="cb10-9">    history_text <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"</span><span class="ch" style="color: #20794D;
background-color: null;
font-style: inherit;">\n</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"</span>.join([</span>
<span id="cb10-10">        <span class="ss" style="color: #20794D;
background-color: null;
font-style: inherit;">f"</span><span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">{</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">'User'</span> <span class="cf" style="color: #003B4F;
background-color: null;
font-style: inherit;">if</span> <span class="bu" style="color: null;
background-color: null;
font-style: inherit;">isinstance</span>(msg, HumanMessage) <span class="cf" style="color: #003B4F;
background-color: null;
font-style: inherit;">else</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">'AI'</span><span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">}</span><span class="ss" style="color: #20794D;
background-color: null;
font-style: inherit;">: </span><span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">{</span>msg<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">.</span>content<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">}</span><span class="ss" style="color: #20794D;
background-color: null;
font-style: inherit;">"</span></span>
<span id="cb10-11">        <span class="cf" style="color: #003B4F;
background-color: null;
font-style: inherit;">for</span> msg <span class="kw" style="color: #003B4F;
background-color: null;
font-style: inherit;">in</span> chat_history[<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">-</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">3</span>:]  <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># 최근 3개만</span></span>
<span id="cb10-12">    ])</span>
<span id="cb10-13">    </span>
<span id="cb10-14">    <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># 질문 재구성 (히스토리 포함)</span></span>
<span id="cb10-15">    <span class="cf" style="color: #003B4F;
background-color: null;
font-style: inherit;">if</span> history_text:</span>
<span id="cb10-16">        enhanced_question <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> <span class="ss" style="color: #20794D;
background-color: null;
font-style: inherit;">f"대화 히스토리:</span><span class="ch" style="color: #20794D;
background-color: null;
font-style: inherit;">\n</span><span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">{</span>history_text<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">}</span><span class="ch" style="color: #20794D;
background-color: null;
font-style: inherit;">\n\n</span><span class="ss" style="color: #20794D;
background-color: null;
font-style: inherit;">현재 질문: </span><span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">{</span>question<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">}</span><span class="ss" style="color: #20794D;
background-color: null;
font-style: inherit;">"</span></span>
<span id="cb10-17">    <span class="cf" style="color: #003B4F;
background-color: null;
font-style: inherit;">else</span>:</span>
<span id="cb10-18">        enhanced_question <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> question</span>
<span id="cb10-19">    </span>
<span id="cb10-20">    <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># 검색</span></span>
<span id="cb10-21">    docs <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> retriever.invoke(enhanced_question)</span>
<span id="cb10-22">    </span>
<span id="cb10-23">    <span class="cf" style="color: #003B4F;
background-color: null;
font-style: inherit;">return</span> {</span>
<span id="cb10-24">        <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">**</span>state,</span>
<span id="cb10-25">        <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"context"</span>: docs,</span>
<span id="cb10-26">        <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"retrieval_success"</span>: <span class="bu" style="color: null;
background-color: null;
font-style: inherit;">len</span>(docs) <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">&gt;</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">0</span></span>
<span id="cb10-27">    }</span>
<span id="cb10-28"></span>
<span id="cb10-29"><span class="kw" style="color: #003B4F;
background-color: null;
font-style: inherit;">def</span> generate_with_history(state: ConversationState) <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">-&gt;</span> ConversationState:</span>
<span id="cb10-30">    <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">"""히스토리를 고려한 답변 생성"""</span></span>
<span id="cb10-31">    question <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> state[<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"question"</span>]</span>
<span id="cb10-32">    context <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> state[<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"context"</span>]</span>
<span id="cb10-33">    chat_history <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> state.get(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"chat_history"</span>, [])</span>
<span id="cb10-34">    </span>
<span id="cb10-35">    <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># 컨텍스트 포맷팅</span></span>
<span id="cb10-36">    context_text <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"</span><span class="ch" style="color: #20794D;
background-color: null;
font-style: inherit;">\n\n</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"</span>.join([doc.page_content <span class="cf" style="color: #003B4F;
background-color: null;
font-style: inherit;">for</span> doc <span class="kw" style="color: #003B4F;
background-color: null;
font-style: inherit;">in</span> context])</span>
<span id="cb10-37">    </span>
<span id="cb10-38">    <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># 히스토리 포함 프롬프트</span></span>
<span id="cb10-39">    history_prompt <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> ChatPromptTemplate.from_template(</span>
<span id="cb10-40">        <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"""이전 대화:</span></span>
<span id="cb10-41"><span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">{history}</span></span>
<span id="cb10-42"></span>
<span id="cb10-43"><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">컨텍스트:</span></span>
<span id="cb10-44"><span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">{context}</span></span>
<span id="cb10-45"></span>
<span id="cb10-46"><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">질문: </span><span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">{question}</span></span>
<span id="cb10-47"></span>
<span id="cb10-48"><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">답변:"""</span></span>
<span id="cb10-49">    )</span>
<span id="cb10-50">    </span>
<span id="cb10-51">    history_text <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"</span><span class="ch" style="color: #20794D;
background-color: null;
font-style: inherit;">\n</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"</span>.join([</span>
<span id="cb10-52">        <span class="ss" style="color: #20794D;
background-color: null;
font-style: inherit;">f"User: </span><span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">{</span>msg<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">.</span>content<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">}</span><span class="ss" style="color: #20794D;
background-color: null;
font-style: inherit;">"</span> <span class="cf" style="color: #003B4F;
background-color: null;
font-style: inherit;">if</span> <span class="bu" style="color: null;
background-color: null;
font-style: inherit;">isinstance</span>(msg, HumanMessage) <span class="cf" style="color: #003B4F;
background-color: null;
font-style: inherit;">else</span> <span class="ss" style="color: #20794D;
background-color: null;
font-style: inherit;">f"AI: </span><span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">{</span>msg<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">.</span>content<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">}</span><span class="ss" style="color: #20794D;
background-color: null;
font-style: inherit;">"</span></span>
<span id="cb10-53">        <span class="cf" style="color: #003B4F;
background-color: null;
font-style: inherit;">for</span> msg <span class="kw" style="color: #003B4F;
background-color: null;
font-style: inherit;">in</span> chat_history[<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">-</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">3</span>:]</span>
<span id="cb10-54">    ])</span>
<span id="cb10-55">    </span>
<span id="cb10-56">    messages <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> history_prompt.invoke({</span>
<span id="cb10-57">        <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"history"</span>: history_text <span class="kw" style="color: #003B4F;
background-color: null;
font-style: inherit;">or</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"없음"</span>,</span>
<span id="cb10-58">        <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"context"</span>: context_text,</span>
<span id="cb10-59">        <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"question"</span>: question</span>
<span id="cb10-60">    })</span>
<span id="cb10-61">    </span>
<span id="cb10-62">    response <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> llm.invoke(messages)</span>
<span id="cb10-63">    </span>
<span id="cb10-64">    <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># 히스토리 업데이트</span></span>
<span id="cb10-65">    updated_history <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> chat_history <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span> [</span>
<span id="cb10-66">        HumanMessage(content<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span>question),</span>
<span id="cb10-67">        AIMessage(content<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span>response.content)</span>
<span id="cb10-68">    ]</span>
<span id="cb10-69">    </span>
<span id="cb10-70">    <span class="cf" style="color: #003B4F;
background-color: null;
font-style: inherit;">return</span> {</span>
<span id="cb10-71">        <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">**</span>state,</span>
<span id="cb10-72">        <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"answer"</span>: response.content,</span>
<span id="cb10-73">        <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"chat_history"</span>: updated_history</span>
<span id="cb10-74">    }</span></code></pre></div>
</details>
</div>
</section>
<section id="대화형-그래프" class="level3" data-number="5.3">
<h3 data-number="5.3" class="anchored" data-anchor-id="대화형-그래프"><span class="header-section-number">5.3</span> 대화형 그래프</h3>
<div id="da788559" class="cell" data-execution_count="9">
<details class="code-fold">
<summary>코드</summary>
<div class="sourceCode cell-code" id="cb11" style="background: #f1f3f5;"><pre class="sourceCode numberSource python number-lines code-with-copy"><code class="sourceCode python"><span id="cb11-1"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># 대화형 워크플로우</span></span>
<span id="cb11-2">conversation_workflow <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> StateGraph(ConversationState)</span>
<span id="cb11-3"></span>
<span id="cb11-4">conversation_workflow.add_node(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"retrieve"</span>, retrieve_with_history)</span>
<span id="cb11-5">conversation_workflow.add_node(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"generate"</span>, generate_with_history)</span>
<span id="cb11-6">conversation_workflow.add_node(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"fallback"</span>, no_context_fallback)</span>
<span id="cb11-7"></span>
<span id="cb11-8">conversation_workflow.set_entry_point(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"retrieve"</span>)</span>
<span id="cb11-9"></span>
<span id="cb11-10">conversation_workflow.add_conditional_edges(</span>
<span id="cb11-11">    <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"retrieve"</span>,</span>
<span id="cb11-12">    should_generate,</span>
<span id="cb11-13">    {</span>
<span id="cb11-14">        <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"generate"</span>: <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"generate"</span>,</span>
<span id="cb11-15">        <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"fallback"</span>: <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"fallback"</span></span>
<span id="cb11-16">    }</span>
<span id="cb11-17">)</span>
<span id="cb11-18"></span>
<span id="cb11-19">conversation_workflow.add_edge(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"generate"</span>, END)</span>
<span id="cb11-20">conversation_workflow.add_edge(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"fallback"</span>, END)</span>
<span id="cb11-21"></span>
<span id="cb11-22">conversation_app <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> conversation_workflow.<span class="bu" style="color: null;
background-color: null;
font-style: inherit;">compile</span>()</span>
<span id="cb11-23"></span>
<span id="cb11-24"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># 멀티턴 대화 실행</span></span>
<span id="cb11-25">state <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> {</span>
<span id="cb11-26">    <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"question"</span>: <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Azure AI Search란 무엇인가?"</span>,</span>
<span id="cb11-27">    <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"chat_history"</span>: []</span>
<span id="cb11-28">}</span>
<span id="cb11-29"></span>
<span id="cb11-30">result1 <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> conversation_app.invoke(state)</span>
<span id="cb11-31"><span class="bu" style="color: null;
background-color: null;
font-style: inherit;">print</span>(<span class="ss" style="color: #20794D;
background-color: null;
font-style: inherit;">f"답변 1: </span><span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">{</span>result1[<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">'answer'</span>]<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">}</span><span class="ch" style="color: #20794D;
background-color: null;
font-style: inherit;">\n</span><span class="ss" style="color: #20794D;
background-color: null;
font-style: inherit;">"</span>)</span>
<span id="cb11-32"></span>
<span id="cb11-33"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># 후속 질문</span></span>
<span id="cb11-34">state2 <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> {</span>
<span id="cb11-35">    <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"question"</span>: <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"그것의 주요 기능은?"</span>,</span>
<span id="cb11-36">    <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"chat_history"</span>: result1[<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"chat_history"</span>]</span>
<span id="cb11-37">}</span>
<span id="cb11-38"></span>
<span id="cb11-39">result2 <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> conversation_app.invoke(state2)</span>
<span id="cb11-40"><span class="bu" style="color: null;
background-color: null;
font-style: inherit;">print</span>(<span class="ss" style="color: #20794D;
background-color: null;
font-style: inherit;">f"답변 2: </span><span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">{</span>result2[<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">'answer'</span>]<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">}</span><span class="ss" style="color: #20794D;
background-color: null;
font-style: inherit;">"</span>)</span></code></pre></div>
</details>
</div>
</section>
</section>
<section id="재시도-로직-추가" class="level2" data-number="6">
<h2 data-number="6" class="anchored" data-anchor-id="재시도-로직-추가"><span class="header-section-number">6</span> 재시도 로직 추가</h2>
<section id="재시도-상태" class="level3" data-number="6.1">
<h3 data-number="6.1" class="anchored" data-anchor-id="재시도-상태"><span class="header-section-number">6.1</span> 재시도 상태</h3>
<div id="ba82f70f" class="cell" data-execution_count="10">
<details class="code-fold">
<summary>코드</summary>
<div class="sourceCode cell-code" id="cb12" style="background: #f1f3f5;"><pre class="sourceCode numberSource python number-lines code-with-copy"><code class="sourceCode python"><span id="cb12-1"><span class="kw" style="color: #003B4F;
background-color: null;
font-style: inherit;">class</span> RetryState(TypedDict):</span>
<span id="cb12-2">    <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">"""재시도 가능한 RAG 상태"""</span></span>
<span id="cb12-3">    question: <span class="bu" style="color: null;
background-color: null;
font-style: inherit;">str</span></span>
<span id="cb12-4">    context: List[Document]</span>
<span id="cb12-5">    answer: <span class="bu" style="color: null;
background-color: null;
font-style: inherit;">str</span></span>
<span id="cb12-6">    retrieval_success: <span class="bu" style="color: null;
background-color: null;
font-style: inherit;">bool</span></span>
<span id="cb12-7">    retry_count: <span class="bu" style="color: null;
background-color: null;
font-style: inherit;">int</span>  <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># 재시도 횟수</span></span>
<span id="cb12-8">    max_retries: <span class="bu" style="color: null;
background-color: null;
font-style: inherit;">int</span>  <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># 최대 재시도</span></span></code></pre></div>
</details>
</div>
</section>
<section id="재시도-노드" class="level3" data-number="6.2">
<h3 data-number="6.2" class="anchored" data-anchor-id="재시도-노드"><span class="header-section-number">6.2</span> 재시도 노드</h3>
<div id="bc03a544" class="cell" data-execution_count="11">
<details class="code-fold">
<summary>코드</summary>
<div class="sourceCode cell-code" id="cb13" style="background: #f1f3f5;"><pre class="sourceCode numberSource python number-lines code-with-copy"><code class="sourceCode python"><span id="cb13-1"><span class="kw" style="color: #003B4F;
background-color: null;
font-style: inherit;">def</span> retrieve_with_retry(state: RetryState) <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">-&gt;</span> RetryState:</span>
<span id="cb13-2">    <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">"""재시도 가능한 검색"""</span></span>
<span id="cb13-3">    question <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> state[<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"question"</span>]</span>
<span id="cb13-4">    retry_count <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> state.get(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"retry_count"</span>, <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">0</span>)</span>
<span id="cb13-5">    </span>
<span id="cb13-6">    <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># 재시도 시 쿼리 확장</span></span>
<span id="cb13-7">    <span class="cf" style="color: #003B4F;
background-color: null;
font-style: inherit;">if</span> retry_count <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">&gt;</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">0</span>:</span>
<span id="cb13-8">        expanded_question <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> <span class="ss" style="color: #20794D;
background-color: null;
font-style: inherit;">f"</span><span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">{</span>question<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">}</span><span class="ss" style="color: #20794D;
background-color: null;
font-style: inherit;"> (관련 정보, 설명, 개요 포함)"</span></span>
<span id="cb13-9">    <span class="cf" style="color: #003B4F;
background-color: null;
font-style: inherit;">else</span>:</span>
<span id="cb13-10">        expanded_question <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> question</span>
<span id="cb13-11">    </span>
<span id="cb13-12">    docs <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> retriever.invoke(expanded_question)</span>
<span id="cb13-13">    </span>
<span id="cb13-14">    <span class="cf" style="color: #003B4F;
background-color: null;
font-style: inherit;">return</span> {</span>
<span id="cb13-15">        <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">**</span>state,</span>
<span id="cb13-16">        <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"context"</span>: docs,</span>
<span id="cb13-17">        <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"retrieval_success"</span>: <span class="bu" style="color: null;
background-color: null;
font-style: inherit;">len</span>(docs) <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">&gt;</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">0</span>,</span>
<span id="cb13-18">        <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"retry_count"</span>: retry_count <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span></span>
<span id="cb13-19">    }</span>
<span id="cb13-20"></span>
<span id="cb13-21"><span class="kw" style="color: #003B4F;
background-color: null;
font-style: inherit;">def</span> should_retry(state: RetryState) <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">-&gt;</span> <span class="bu" style="color: null;
background-color: null;
font-style: inherit;">str</span>:</span>
<span id="cb13-22">    <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">"""재시도 여부 결정"""</span></span>
<span id="cb13-23">    <span class="cf" style="color: #003B4F;
background-color: null;
font-style: inherit;">if</span> state[<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"retrieval_success"</span>]:</span>
<span id="cb13-24">        <span class="cf" style="color: #003B4F;
background-color: null;
font-style: inherit;">return</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"generate"</span></span>
<span id="cb13-25">    <span class="cf" style="color: #003B4F;
background-color: null;
font-style: inherit;">elif</span> state[<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"retry_count"</span>] <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">&lt;</span> state.get(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"max_retries"</span>, <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">2</span>):</span>
<span id="cb13-26">        <span class="cf" style="color: #003B4F;
background-color: null;
font-style: inherit;">return</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"retry"</span></span>
<span id="cb13-27">    <span class="cf" style="color: #003B4F;
background-color: null;
font-style: inherit;">else</span>:</span>
<span id="cb13-28">        <span class="cf" style="color: #003B4F;
background-color: null;
font-style: inherit;">return</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"fallback"</span></span></code></pre></div>
</details>
</div>
</section>
<section id="재시도-그래프" class="level3" data-number="6.3">
<h3 data-number="6.3" class="anchored" data-anchor-id="재시도-그래프"><span class="header-section-number">6.3</span> 재시도 그래프</h3>
<div id="62219522" class="cell" data-execution_count="12">
<details class="code-fold">
<summary>코드</summary>
<div class="sourceCode cell-code" id="cb14" style="background: #f1f3f5;"><pre class="sourceCode numberSource python number-lines code-with-copy"><code class="sourceCode python"><span id="cb14-1">retry_workflow <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> StateGraph(RetryState)</span>
<span id="cb14-2"></span>
<span id="cb14-3">retry_workflow.add_node(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"retrieve"</span>, retrieve_with_retry)</span>
<span id="cb14-4">retry_workflow.add_node(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"generate"</span>, generate)</span>
<span id="cb14-5">retry_workflow.add_node(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"fallback"</span>, no_context_fallback)</span>
<span id="cb14-6"></span>
<span id="cb14-7">retry_workflow.set_entry_point(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"retrieve"</span>)</span>
<span id="cb14-8"></span>
<span id="cb14-9">retry_workflow.add_conditional_edges(</span>
<span id="cb14-10">    <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"retrieve"</span>,</span>
<span id="cb14-11">    should_retry,</span>
<span id="cb14-12">    {</span>
<span id="cb14-13">        <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"generate"</span>: <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"generate"</span>,</span>
<span id="cb14-14">        <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"retry"</span>: <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"retrieve"</span>,  <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># 루프백</span></span>
<span id="cb14-15">        <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"fallback"</span>: <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"fallback"</span></span>
<span id="cb14-16">    }</span>
<span id="cb14-17">)</span>
<span id="cb14-18"></span>
<span id="cb14-19">retry_workflow.add_edge(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"generate"</span>, END)</span>
<span id="cb14-20">retry_workflow.add_edge(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"fallback"</span>, END)</span>
<span id="cb14-21"></span>
<span id="cb14-22">retry_app <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> retry_workflow.<span class="bu" style="color: null;
background-color: null;
font-style: inherit;">compile</span>()</span>
<span id="cb14-23"></span>
<span id="cb14-24"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># 실행</span></span>
<span id="cb14-25">result <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> retry_app.invoke({</span>
<span id="cb14-26">    <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"question"</span>: <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"희귀한 주제 검색"</span>,</span>
<span id="cb14-27">    <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"max_retries"</span>: <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">2</span></span>
<span id="cb14-28">})</span>
<span id="cb14-29"></span>
<span id="cb14-30"><span class="bu" style="color: null;
background-color: null;
font-style: inherit;">print</span>(<span class="ss" style="color: #20794D;
background-color: null;
font-style: inherit;">f"재시도 횟수: </span><span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">{</span>result[<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">'retry_count'</span>]<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">}</span><span class="ss" style="color: #20794D;
background-color: null;
font-style: inherit;">"</span>)</span>
<span id="cb14-31"><span class="bu" style="color: null;
background-color: null;
font-style: inherit;">print</span>(<span class="ss" style="color: #20794D;
background-color: null;
font-style: inherit;">f"답변: </span><span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">{</span>result[<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">'answer'</span>]<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">}</span><span class="ss" style="color: #20794D;
background-color: null;
font-style: inherit;">"</span>)</span></code></pre></div>
</details>
</div>
</section>
</section>
<section id="답변-품질-검증" class="level2" data-number="7">
<h2 data-number="7" class="anchored" data-anchor-id="답변-품질-검증"><span class="header-section-number">7</span> 답변 품질 검증</h2>
<section id="검증-상태" class="level3" data-number="7.1">
<h3 data-number="7.1" class="anchored" data-anchor-id="검증-상태"><span class="header-section-number">7.1</span> 검증 상태</h3>
<div id="b8f28c3d" class="cell" data-execution_count="13">
<details class="code-fold">
<summary>코드</summary>
<div class="sourceCode cell-code" id="cb15" style="background: #f1f3f5;"><pre class="sourceCode numberSource python number-lines code-with-copy"><code class="sourceCode python"><span id="cb15-1"><span class="kw" style="color: #003B4F;
background-color: null;
font-style: inherit;">class</span> QualityState(TypedDict):</span>
<span id="cb15-2">    <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">"""품질 검증 상태"""</span></span>
<span id="cb15-3">    question: <span class="bu" style="color: null;
background-color: null;
font-style: inherit;">str</span></span>
<span id="cb15-4">    context: List[Document]</span>
<span id="cb15-5">    answer: <span class="bu" style="color: null;
background-color: null;
font-style: inherit;">str</span></span>
<span id="cb15-6">    retrieval_success: <span class="bu" style="color: null;
background-color: null;
font-style: inherit;">bool</span></span>
<span id="cb15-7">    answer_quality: <span class="bu" style="color: null;
background-color: null;
font-style: inherit;">str</span>  <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># "good", "bad", "unknown"</span></span></code></pre></div>
</details>
</div>
</section>
<section id="품질-평가-노드" class="level3" data-number="7.2">
<h3 data-number="7.2" class="anchored" data-anchor-id="품질-평가-노드"><span class="header-section-number">7.2</span> 품질 평가 노드</h3>
<div id="a34a225b" class="cell" data-execution_count="14">
<details class="code-fold">
<summary>코드</summary>
<div class="sourceCode cell-code" id="cb16" style="background: #f1f3f5;"><pre class="sourceCode numberSource python number-lines code-with-copy"><code class="sourceCode python"><span id="cb16-1"><span class="kw" style="color: #003B4F;
background-color: null;
font-style: inherit;">def</span> evaluate_answer(state: QualityState) <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">-&gt;</span> QualityState:</span>
<span id="cb16-2">    <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">"""답변 품질 평가"""</span></span>
<span id="cb16-3">    answer <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> state[<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"answer"</span>]</span>
<span id="cb16-4">    question <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> state[<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"question"</span>]</span>
<span id="cb16-5">    </span>
<span id="cb16-6">    <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># 평가 프롬프트</span></span>
<span id="cb16-7">    eval_prompt <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> ChatPromptTemplate.from_template(</span>
<span id="cb16-8">        <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"""다음 질문과 답변의 품질을 평가하세요.</span></span>
<span id="cb16-9"></span>
<span id="cb16-10"><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">질문: </span><span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">{question}</span></span>
<span id="cb16-11"><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">답변: </span><span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">{answer}</span></span>
<span id="cb16-12"></span>
<span id="cb16-13"><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">답변이 질문에 적절히 대답하고 있나요?</span></span>
<span id="cb16-14"><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">- "good": 적절한 답변</span></span>
<span id="cb16-15"><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">- "bad": 부적절하거나 관련 없는 답변</span></span>
<span id="cb16-16"><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">- "unknown": 판단 불가</span></span>
<span id="cb16-17"></span>
<span id="cb16-18"><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">평가 결과 (good/bad/unknown만 출력):"""</span></span>
<span id="cb16-19">    )</span>
<span id="cb16-20">    </span>
<span id="cb16-21">    messages <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> eval_prompt.invoke({</span>
<span id="cb16-22">        <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"question"</span>: question,</span>
<span id="cb16-23">        <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"answer"</span>: answer</span>
<span id="cb16-24">    })</span>
<span id="cb16-25">    </span>
<span id="cb16-26">    evaluation <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> llm.invoke(messages).content.strip().lower()</span>
<span id="cb16-27">    </span>
<span id="cb16-28">    <span class="cf" style="color: #003B4F;
background-color: null;
font-style: inherit;">return</span> {</span>
<span id="cb16-29">        <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">**</span>state,</span>
<span id="cb16-30">        <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"answer_quality"</span>: evaluation</span>
<span id="cb16-31">    }</span>
<span id="cb16-32"></span>
<span id="cb16-33"><span class="kw" style="color: #003B4F;
background-color: null;
font-style: inherit;">def</span> regenerate_answer(state: QualityState) <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">-&gt;</span> QualityState:</span>
<span id="cb16-34">    <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">"""답변 재생성"""</span></span>
<span id="cb16-35">    question <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> state[<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"question"</span>]</span>
<span id="cb16-36">    context <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> state[<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"context"</span>]</span>
<span id="cb16-37">    </span>
<span id="cb16-38">    <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># 더 상세한 프롬프트</span></span>
<span id="cb16-39">    detailed_prompt <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> ChatPromptTemplate.from_template(</span>
<span id="cb16-40">        <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"""다음 컨텍스트를 참고하여 질문에 상세히 답변하세요.</span></span>
<span id="cb16-41"><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">반드시 컨텍스트의 정보를 활용하고, 구체적으로 설명하세요.</span></span>
<span id="cb16-42"></span>
<span id="cb16-43"><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">컨텍스트:</span></span>
<span id="cb16-44"><span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">{context}</span></span>
<span id="cb16-45"></span>
<span id="cb16-46"><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">질문: </span><span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">{question}</span></span>
<span id="cb16-47"></span>
<span id="cb16-48"><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">상세 답변:"""</span></span>
<span id="cb16-49">    )</span>
<span id="cb16-50">    </span>
<span id="cb16-51">    context_text <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"</span><span class="ch" style="color: #20794D;
background-color: null;
font-style: inherit;">\n\n</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"</span>.join([doc.page_content <span class="cf" style="color: #003B4F;
background-color: null;
font-style: inherit;">for</span> doc <span class="kw" style="color: #003B4F;
background-color: null;
font-style: inherit;">in</span> context])</span>
<span id="cb16-52">    messages <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> detailed_prompt.invoke({</span>
<span id="cb16-53">        <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"context"</span>: context_text,</span>
<span id="cb16-54">        <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"question"</span>: question</span>
<span id="cb16-55">    })</span>
<span id="cb16-56">    </span>
<span id="cb16-57">    response <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> llm.invoke(messages)</span>
<span id="cb16-58">    </span>
<span id="cb16-59">    <span class="cf" style="color: #003B4F;
background-color: null;
font-style: inherit;">return</span> {</span>
<span id="cb16-60">        <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">**</span>state,</span>
<span id="cb16-61">        <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"answer"</span>: response.content</span>
<span id="cb16-62">    }</span>
<span id="cb16-63"></span>
<span id="cb16-64"><span class="kw" style="color: #003B4F;
background-color: null;
font-style: inherit;">def</span> route_by_quality(state: QualityState) <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">-&gt;</span> <span class="bu" style="color: null;
background-color: null;
font-style: inherit;">str</span>:</span>
<span id="cb16-65">    <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">"""품질에 따라 라우팅"""</span></span>
<span id="cb16-66">    quality <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> state[<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"answer_quality"</span>]</span>
<span id="cb16-67">    </span>
<span id="cb16-68">    <span class="cf" style="color: #003B4F;
background-color: null;
font-style: inherit;">if</span> quality <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">==</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"good"</span>:</span>
<span id="cb16-69">        <span class="cf" style="color: #003B4F;
background-color: null;
font-style: inherit;">return</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"end"</span></span>
<span id="cb16-70">    <span class="cf" style="color: #003B4F;
background-color: null;
font-style: inherit;">elif</span> quality <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">==</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"bad"</span>:</span>
<span id="cb16-71">        <span class="cf" style="color: #003B4F;
background-color: null;
font-style: inherit;">return</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"regenerate"</span></span>
<span id="cb16-72">    <span class="cf" style="color: #003B4F;
background-color: null;
font-style: inherit;">else</span>:</span>
<span id="cb16-73">        <span class="cf" style="color: #003B4F;
background-color: null;
font-style: inherit;">return</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"end"</span></span></code></pre></div>
</details>
</div>
</section>
<section id="품질-검증-그래프" class="level3" data-number="7.3">
<h3 data-number="7.3" class="anchored" data-anchor-id="품질-검증-그래프"><span class="header-section-number">7.3</span> 품질 검증 그래프</h3>
<div id="618209ff" class="cell" data-execution_count="15">
<details class="code-fold">
<summary>코드</summary>
<div class="sourceCode cell-code" id="cb17" style="background: #f1f3f5;"><pre class="sourceCode numberSource python number-lines code-with-copy"><code class="sourceCode python"><span id="cb17-1">quality_workflow <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> StateGraph(QualityState)</span>
<span id="cb17-2"></span>
<span id="cb17-3">quality_workflow.add_node(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"retrieve"</span>, retrieve)</span>
<span id="cb17-4">quality_workflow.add_node(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"generate"</span>, generate)</span>
<span id="cb17-5">quality_workflow.add_node(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"evaluate"</span>, evaluate_answer)</span>
<span id="cb17-6">quality_workflow.add_node(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"regenerate"</span>, regenerate_answer)</span>
<span id="cb17-7">quality_workflow.add_node(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"fallback"</span>, no_context_fallback)</span>
<span id="cb17-8"></span>
<span id="cb17-9">quality_workflow.set_entry_point(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"retrieve"</span>)</span>
<span id="cb17-10"></span>
<span id="cb17-11">quality_workflow.add_conditional_edges(</span>
<span id="cb17-12">    <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"retrieve"</span>,</span>
<span id="cb17-13">    should_generate,</span>
<span id="cb17-14">    {</span>
<span id="cb17-15">        <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"generate"</span>: <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"generate"</span>,</span>
<span id="cb17-16">        <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"fallback"</span>: <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"fallback"</span></span>
<span id="cb17-17">    }</span>
<span id="cb17-18">)</span>
<span id="cb17-19"></span>
<span id="cb17-20">quality_workflow.add_edge(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"generate"</span>, <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"evaluate"</span>)</span>
<span id="cb17-21"></span>
<span id="cb17-22">quality_workflow.add_conditional_edges(</span>
<span id="cb17-23">    <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"evaluate"</span>,</span>
<span id="cb17-24">    route_by_quality,</span>
<span id="cb17-25">    {</span>
<span id="cb17-26">        <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"end"</span>: END,</span>
<span id="cb17-27">        <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"regenerate"</span>: <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"regenerate"</span></span>
<span id="cb17-28">    }</span>
<span id="cb17-29">)</span>
<span id="cb17-30"></span>
<span id="cb17-31">quality_workflow.add_edge(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"regenerate"</span>, END)</span>
<span id="cb17-32">quality_workflow.add_edge(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"fallback"</span>, END)</span>
<span id="cb17-33"></span>
<span id="cb17-34">quality_app <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> quality_workflow.<span class="bu" style="color: null;
background-color: null;
font-style: inherit;">compile</span>()</span>
<span id="cb17-35"></span>
<span id="cb17-36"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># 실행</span></span>
<span id="cb17-37">result <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> quality_app.invoke({</span>
<span id="cb17-38">    <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"question"</span>: <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Azure AI Search의 장점은?"</span></span>
<span id="cb17-39">})</span>
<span id="cb17-40"></span>
<span id="cb17-41"><span class="bu" style="color: null;
background-color: null;
font-style: inherit;">print</span>(<span class="ss" style="color: #20794D;
background-color: null;
font-style: inherit;">f"답변 품질: </span><span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">{</span>result[<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">'answer_quality'</span>]<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">}</span><span class="ss" style="color: #20794D;
background-color: null;
font-style: inherit;">"</span>)</span>
<span id="cb17-42"><span class="bu" style="color: null;
background-color: null;
font-style: inherit;">print</span>(<span class="ss" style="color: #20794D;
background-color: null;
font-style: inherit;">f"최종 답변: </span><span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">{</span>result[<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">'answer'</span>]<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">}</span><span class="ss" style="color: #20794D;
background-color: null;
font-style: inherit;">"</span>)</span></code></pre></div>
</details>
</div>
</section>
</section>
<section id="시각화" class="level2" data-number="8">
<h2 data-number="8" class="anchored" data-anchor-id="시각화"><span class="header-section-number">8</span> 시각화</h2>
<section id="그래프-구조-확인" class="level3" data-number="8.1">
<h3 data-number="8.1" class="anchored" data-anchor-id="그래프-구조-확인"><span class="header-section-number">8.1</span> 그래프 구조 확인</h3>
<div id="eaef98ae" class="cell" data-execution_count="16">
<details class="code-fold">
<summary>코드</summary>
<div class="sourceCode cell-code" id="cb18" style="background: #f1f3f5;"><pre class="sourceCode numberSource python number-lines code-with-copy"><code class="sourceCode python"><span id="cb18-1"><span class="im" style="color: #00769E;
background-color: null;
font-style: inherit;">from</span> IPython.display <span class="im" style="color: #00769E;
background-color: null;
font-style: inherit;">import</span> Image, display</span>
<span id="cb18-2"></span>
<span id="cb18-3"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># 그래프 시각화</span></span>
<span id="cb18-4"><span class="cf" style="color: #003B4F;
background-color: null;
font-style: inherit;">try</span>:</span>
<span id="cb18-5">    display(Image(app.get_graph().draw_mermaid_png()))</span>
<span id="cb18-6"><span class="cf" style="color: #003B4F;
background-color: null;
font-style: inherit;">except</span> <span class="pp" style="color: #AD0000;
background-color: null;
font-style: inherit;">Exception</span>:</span>
<span id="cb18-7">    <span class="bu" style="color: null;
background-color: null;
font-style: inherit;">print</span>(app.get_graph().draw_ascii())</span></code></pre></div>
</details>
</div>
</section>
</section>
<section id="스트리밍" class="level2" data-number="9">
<h2 data-number="9" class="anchored" data-anchor-id="스트리밍"><span class="header-section-number">9</span> 스트리밍</h2>
<section id="스트리밍-실행" class="level3" data-number="9.1">
<h3 data-number="9.1" class="anchored" data-anchor-id="스트리밍-실행"><span class="header-section-number">9.1</span> 스트리밍 실행</h3>
<div id="cd756c7e" class="cell" data-execution_count="17">
<details class="code-fold">
<summary>코드</summary>
<div class="sourceCode cell-code" id="cb19" style="background: #f1f3f5;"><pre class="sourceCode numberSource python number-lines code-with-copy"><code class="sourceCode python"><span id="cb19-1"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># 스트리밍으로 중간 단계 확인</span></span>
<span id="cb19-2"><span class="cf" style="color: #003B4F;
background-color: null;
font-style: inherit;">for</span> event <span class="kw" style="color: #003B4F;
background-color: null;
font-style: inherit;">in</span> app.stream({</span>
<span id="cb19-3">    <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"question"</span>: <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Azure AI Search란?"</span></span>
<span id="cb19-4">}):</span>
<span id="cb19-5">    <span class="bu" style="color: null;
background-color: null;
font-style: inherit;">print</span>(<span class="ss" style="color: #20794D;
background-color: null;
font-style: inherit;">f"이벤트: </span><span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">{</span>event<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">}</span><span class="ss" style="color: #20794D;
background-color: null;
font-style: inherit;">"</span>)</span>
<span id="cb19-6">    <span class="bu" style="color: null;
background-color: null;
font-style: inherit;">print</span>(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"---"</span>)</span></code></pre></div>
</details>
</div>
</section>
</section>
<section id="참고-자료" class="level2" data-number="10">
<h2 data-number="10" class="anchored" data-anchor-id="참고-자료"><span class="header-section-number">10</span> 참고 자료</h2>
<section id="공식-문서" class="level3" data-number="10.1">
<h3 data-number="10.1" class="anchored" data-anchor-id="공식-문서"><span class="header-section-number">10.1</span> 공식 문서</h3>
<ul>
<li><a href="https://langchain-ai.github.io/langgraph/">LangGraph 문서</a></li>
<li><a href="https://langchain-ai.github.io/langgraph/tutorials/">LangGraph 튜토리얼</a></li>
</ul>
</section>
<section id="예제" class="level3" data-number="10.2">
<h3 data-number="10.2" class="anchored" data-anchor-id="예제"><span class="header-section-number">10.2</span> 예제</h3>
<ul>
<li><a href="https://github.com/langchain-ai/langgraph/tree/main/examples">LangGraph RAG 예제</a></li>
</ul>
</section>
</section>
<section id="다음-단계" class="level2" data-number="11">
<h2 data-number="11" class="anchored" data-anchor-id="다음-단계"><span class="header-section-number">11</span> 다음 단계</h2>
<p>LangGraph로 RAG 로직을 구현했다면, 이제 Azure OpenAI LLM을 최적화하자:</p>
<p>👉 <a href="../../../../../docs/blog/posts/RAG/13-Cloud-RAG/06-Azure-OpenAI-LLM.html">06-Azure-OpenAI-LLM.qmd</a> - Azure OpenAI LLM 최적화 및 프롬프트 엔지니어링</p>


</section>

 ]]></description>
  <category>AI</category>
  <category>RAG</category>
  <category>LangChain</category>
  <category>LangGraph</category>
  <guid>kk3225.netlify.app/docs/blog/posts/RAG/13-Cloud-RAG/05-LangChain-to-LangGraph.html</guid>
  <pubDate>Wed, 05 Nov 2025 15:00:00 GMT</pubDate>
</item>
<item>
  <title>Azure AI Search Integration</title>
  <dc:creator>Kwangmin Kim</dc:creator>
  <link>kk3225.netlify.app/docs/blog/posts/RAG/13-Cloud-RAG/04-Azure-AI-Search-Integration.html</link>
  <description><![CDATA[ 





<section id="azure-ai-search란" class="level2" data-number="1">
<h2 data-number="1" class="anchored" data-anchor-id="azure-ai-search란"><span class="header-section-number">1</span> Azure AI Search란?</h2>
<p>Azure AI Search는 Microsoft의 관리형 검색 서비스로, <strong>벡터 검색</strong>과 <strong>하이브리드 검색</strong>을 지원한다.</p>
<p><strong>RAG 시스템에서의 역할:</strong> - 임베딩 벡터 저장 (Vector Store) - 의미 기반 검색 (Semantic Search) - 키워드 + 벡터 하이브리드 검색 - 대규모 문서 검색 (수백만 개 문서)</p>
<p><strong>왜 Azure AI Search인가?</strong> - 완전 관리형 서비스 (서버 관리 불필요) - 높은 가용성 (99.9% SLA) - 자동 스케일링 - 엔터프라이즈 보안 (Private Endpoint, RBAC)</p>
</section>
<section id="azure-ai-search-주요-개념" class="level2" data-number="2">
<h2 data-number="2" class="anchored" data-anchor-id="azure-ai-search-주요-개념"><span class="header-section-number">2</span> Azure AI Search 주요 개념</h2>
<section id="인덱스-index" class="level3" data-number="2.1">
<h3 data-number="2.1" class="anchored" data-anchor-id="인덱스-index"><span class="header-section-number">2.1</span> 인덱스 (Index)</h3>
<p>검색 가능한 문서 컬렉션. RDB의 테이블과 유사하다.</p>
<p><strong>구성 요소:</strong> - <strong>필드 (Fields)</strong>: 문서의 속성 (제목, 내용, 메타데이터 등) - <strong>벡터 필드 (Vector Fields)</strong>: 임베딩 벡터 저장 - <strong>검색 가능 필드 (Searchable)</strong>: 전체 텍스트 검색 대상 - <strong>필터링 가능 필드 (Filterable)</strong>: 조건 필터링 가능</p>
</section>
<section id="검색-유형" class="level3" data-number="2.2">
<h3 data-number="2.2" class="anchored" data-anchor-id="검색-유형"><span class="header-section-number">2.2</span> 검색 유형</h3>
<table class="caption-top table">
<thead>
<tr class="header">
<th>검색 유형</th>
<th>설명</th>
<th>용도</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td><strong>전체 텍스트 검색</strong></td>
<td>키워드 기반 BM25 알고리즘</td>
<td>정확한 용어 매칭</td>
</tr>
<tr class="even">
<td><strong>벡터 검색</strong></td>
<td>임베딩 기반 의미 검색</td>
<td>의미적 유사성</td>
</tr>
<tr class="odd">
<td><strong>하이브리드 검색</strong></td>
<td>텍스트 + 벡터 결합</td>
<td>최고 정확도</td>
</tr>
<tr class="even">
<td><strong>시맨틱 검색</strong></td>
<td>AI 기반 재순위화</td>
<td>자연어 쿼리 이해</td>
</tr>
</tbody>
</table>
</section>
<section id="벡터-알고리즘" class="level3" data-number="2.3">
<h3 data-number="2.3" class="anchored" data-anchor-id="벡터-알고리즘"><span class="header-section-number">2.3</span> 벡터 알고리즘</h3>
<p><strong>HNSW (Hierarchical Navigable Small World)</strong> - 근사 최근접 이웃 (Approximate Nearest Neighbor, ANN) - 빠른 검색 속도 (ms 단위) - 높은 정확도 (recall &gt; 95%)</p>
</section>
</section>
<section id="azure-ai-search-리소스-생성" class="level2" data-number="3">
<h2 data-number="3" class="anchored" data-anchor-id="azure-ai-search-리소스-생성"><span class="header-section-number">3</span> Azure AI Search 리소스 생성</h2>
<section id="azure-portal에서-생성" class="level3" data-number="3.1">
<h3 data-number="3.1" class="anchored" data-anchor-id="azure-portal에서-생성"><span class="header-section-number">3.1</span> Azure Portal에서 생성</h3>
<p><strong>1. Azure AI Search 만들기:</strong> - <a href="https://portal.azure.com">portal.azure.com</a> → “리소스 만들기” - “Azure AI Search” 검색 및 선택</p>
<p><strong>2. 기본 설정:</strong> - <strong>구독</strong>: 사용할 구독 선택 - <strong>리소스 그룹</strong>: <code>rg-rag-prod</code> - <strong>서비스 이름</strong>: <code>search-rag-prod</code> (전역적으로 고유해야 함) - <strong>지역</strong>: Korea Central (또는 East US) - <strong>가격 책정 계층</strong>: - Free: 무료 (50MB, 인덱스 3개) - Basic: $73.73/월 (2GB) - Standard S1: $250.83/월 (25GB)</p>
<p><strong>3. 검토 + 만들기</strong> → 생성 완료</p>
<p><strong>4. 키 및 엔드포인트 확인:</strong> - 생성된 리소스 → “키” - <strong>관리 키 (Admin Key)</strong> 복사 - <strong>URL</strong> 복사 (예: <code>https://search-rag-prod.search.windows.net</code>)</p>
</section>
<section id="azure-cli로-생성" class="level3" data-number="3.2">
<h3 data-number="3.2" class="anchored" data-anchor-id="azure-cli로-생성"><span class="header-section-number">3.2</span> Azure CLI로 생성</h3>
<div class="sourceCode" id="cb1" style="background: #f1f3f5;"><pre class="sourceCode numberSource bash number-lines code-with-copy"><code class="sourceCode bash"><span id="cb1-1"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># Azure AI Search 리소스 생성</span></span>
<span id="cb1-2"><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">az</span> search service create <span class="dt" style="color: #AD0000;
background-color: null;
font-style: inherit;">\</span></span>
<span id="cb1-3">    <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">--name</span> search-rag-prod <span class="dt" style="color: #AD0000;
background-color: null;
font-style: inherit;">\</span></span>
<span id="cb1-4">    <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">--resource-group</span> rg-rag-prod <span class="dt" style="color: #AD0000;
background-color: null;
font-style: inherit;">\</span></span>
<span id="cb1-5">    <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">--sku</span> basic <span class="dt" style="color: #AD0000;
background-color: null;
font-style: inherit;">\</span></span>
<span id="cb1-6">    <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">--location</span> koreacentral</span>
<span id="cb1-7"></span>
<span id="cb1-8"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># 관리 키 조회</span></span>
<span id="cb1-9"><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">az</span> search admin-key show <span class="dt" style="color: #AD0000;
background-color: null;
font-style: inherit;">\</span></span>
<span id="cb1-10">    <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">--service-name</span> search-rag-prod <span class="dt" style="color: #AD0000;
background-color: null;
font-style: inherit;">\</span></span>
<span id="cb1-11">    <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">--resource-group</span> rg-rag-prod</span></code></pre></div>
</section>
</section>
<section id="환경-설정" class="level2" data-number="4">
<h2 data-number="4" class="anchored" data-anchor-id="환경-설정"><span class="header-section-number">4</span> 환경 설정</h2>
<section id="python-sdk-설치" class="level3" data-number="4.1">
<h3 data-number="4.1" class="anchored" data-anchor-id="python-sdk-설치"><span class="header-section-number">4.1</span> Python SDK 설치</h3>
<div class="sourceCode" id="cb2" style="background: #f1f3f5;"><pre class="sourceCode numberSource bash number-lines code-with-copy"><code class="sourceCode bash"><span id="cb2-1"><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">pip</span> install azure-search-documents</span>
<span id="cb2-2"><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">pip</span> install langchain-community</span>
<span id="cb2-3"><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">pip</span> install azure-identity</span></code></pre></div>
</section>
<section id="환경-변수-설정" class="level3" data-number="4.2">
<h3 data-number="4.2" class="anchored" data-anchor-id="환경-변수-설정"><span class="header-section-number">4.2</span> 환경 변수 설정</h3>
<p><code>.env</code> 파일:</p>
<pre><code>AZURE_SEARCH_ENDPOINT=https://search-rag-prod.search.windows.net
AZURE_SEARCH_API_KEY=your-admin-key-here
AZURE_SEARCH_INDEX_NAME=rag-documents</code></pre>
</section>
</section>
<section id="기본-사용법" class="level2" data-number="5">
<h2 data-number="5" class="anchored" data-anchor-id="기본-사용법"><span class="header-section-number">5</span> 기본 사용법</h2>
<section id="인덱스-생성" class="level3" data-number="5.1">
<h3 data-number="5.1" class="anchored" data-anchor-id="인덱스-생성"><span class="header-section-number">5.1</span> 인덱스 생성</h3>
<div id="02fd512f" class="cell" data-execution_count="1">
<details class="code-fold">
<summary>코드</summary>
<div class="sourceCode cell-code" id="cb4" style="background: #f1f3f5;"><pre class="sourceCode numberSource python number-lines code-with-copy"><code class="sourceCode python"><span id="cb4-1"><span class="im" style="color: #00769E;
background-color: null;
font-style: inherit;">from</span> azure.search.documents.indexes <span class="im" style="color: #00769E;
background-color: null;
font-style: inherit;">import</span> SearchIndexClient</span>
<span id="cb4-2"><span class="im" style="color: #00769E;
background-color: null;
font-style: inherit;">from</span> azure.search.documents.indexes.models <span class="im" style="color: #00769E;
background-color: null;
font-style: inherit;">import</span> (</span>
<span id="cb4-3">    SearchIndex,</span>
<span id="cb4-4">    SearchField,</span>
<span id="cb4-5">    SearchFieldDataType,</span>
<span id="cb4-6">    VectorSearch,</span>
<span id="cb4-7">    HnswAlgorithmConfiguration,</span>
<span id="cb4-8">    VectorSearchProfile,</span>
<span id="cb4-9">    SemanticConfiguration,</span>
<span id="cb4-10">    SemanticField,</span>
<span id="cb4-11">    SemanticPrioritizedFields,</span>
<span id="cb4-12">    SemanticSearch</span>
<span id="cb4-13">)</span>
<span id="cb4-14"><span class="im" style="color: #00769E;
background-color: null;
font-style: inherit;">from</span> azure.core.credentials <span class="im" style="color: #00769E;
background-color: null;
font-style: inherit;">import</span> AzureKeyCredential</span>
<span id="cb4-15"><span class="im" style="color: #00769E;
background-color: null;
font-style: inherit;">from</span> dotenv <span class="im" style="color: #00769E;
background-color: null;
font-style: inherit;">import</span> load_dotenv</span>
<span id="cb4-16"><span class="im" style="color: #00769E;
background-color: null;
font-style: inherit;">import</span> os</span>
<span id="cb4-17"></span>
<span id="cb4-18">load_dotenv()</span>
<span id="cb4-19"></span>
<span id="cb4-20"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># 클라이언트 생성</span></span>
<span id="cb4-21">index_client <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> SearchIndexClient(</span>
<span id="cb4-22">    endpoint<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span>os.getenv(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"AZURE_SEARCH_ENDPOINT"</span>),</span>
<span id="cb4-23">    credential<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span>AzureKeyCredential(os.getenv(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"AZURE_SEARCH_API_KEY"</span>))</span>
<span id="cb4-24">)</span>
<span id="cb4-25"></span>
<span id="cb4-26"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># 인덱스 스키마 정의</span></span>
<span id="cb4-27">fields <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> [</span>
<span id="cb4-28">    SearchField(</span>
<span id="cb4-29">        name<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"id"</span>,</span>
<span id="cb4-30">        <span class="bu" style="color: null;
background-color: null;
font-style: inherit;">type</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span>SearchFieldDataType.String,</span>
<span id="cb4-31">        key<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span><span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">True</span>,  <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># 기본 키</span></span>
<span id="cb4-32">        filterable<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span><span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">True</span></span>
<span id="cb4-33">    ),</span>
<span id="cb4-34">    SearchField(</span>
<span id="cb4-35">        name<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"content"</span>,</span>
<span id="cb4-36">        <span class="bu" style="color: null;
background-color: null;
font-style: inherit;">type</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span>SearchFieldDataType.String,</span>
<span id="cb4-37">        searchable<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span><span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">True</span>,  <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># 전체 텍스트 검색 가능</span></span>
<span id="cb4-38">        filterable<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span><span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">False</span></span>
<span id="cb4-39">    ),</span>
<span id="cb4-40">    SearchField(</span>
<span id="cb4-41">        name<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"content_vector"</span>,</span>
<span id="cb4-42">        <span class="bu" style="color: null;
background-color: null;
font-style: inherit;">type</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span>SearchFieldDataType.Collection(SearchFieldDataType.Single),</span>
<span id="cb4-43">        vector_search_dimensions<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1536</span>,  <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># text-embedding-3-small</span></span>
<span id="cb4-44">        vector_search_profile_name<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"vector-profile"</span></span>
<span id="cb4-45">    ),</span>
<span id="cb4-46">    SearchField(</span>
<span id="cb4-47">        name<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"metadata"</span>,</span>
<span id="cb4-48">        <span class="bu" style="color: null;
background-color: null;
font-style: inherit;">type</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span>SearchFieldDataType.String,</span>
<span id="cb4-49">        searchable<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span><span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">False</span>,</span>
<span id="cb4-50">        filterable<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span><span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">True</span></span>
<span id="cb4-51">    ),</span>
<span id="cb4-52">    SearchField(</span>
<span id="cb4-53">        name<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"source"</span>,</span>
<span id="cb4-54">        <span class="bu" style="color: null;
background-color: null;
font-style: inherit;">type</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span>SearchFieldDataType.String,</span>
<span id="cb4-55">        searchable<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span><span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">False</span>,</span>
<span id="cb4-56">        filterable<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span><span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">True</span>,</span>
<span id="cb4-57">        facetable<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span><span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">True</span></span>
<span id="cb4-58">    )</span>
<span id="cb4-59">]</span>
<span id="cb4-60"></span>
<span id="cb4-61"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># 벡터 검색 설정</span></span>
<span id="cb4-62">vector_search <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> VectorSearch(</span>
<span id="cb4-63">    algorithms<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span>[</span>
<span id="cb4-64">        HnswAlgorithmConfiguration(</span>
<span id="cb4-65">            name<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"hnsw-config"</span>,</span>
<span id="cb4-66">            parameters<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span>{</span>
<span id="cb4-67">                <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"m"</span>: <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">4</span>,  <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># 그래프 연결 수</span></span>
<span id="cb4-68">                <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"efConstruction"</span>: <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">400</span>,  <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># 인덱스 구축 품질</span></span>
<span id="cb4-69">                <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"efSearch"</span>: <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">500</span>,  <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># 검색 정확도</span></span>
<span id="cb4-70">                <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"metric"</span>: <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"cosine"</span>  <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># 유사도 측정 방식</span></span>
<span id="cb4-71">            }</span>
<span id="cb4-72">        )</span>
<span id="cb4-73">    ],</span>
<span id="cb4-74">    profiles<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span>[</span>
<span id="cb4-75">        VectorSearchProfile(</span>
<span id="cb4-76">            name<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"vector-profile"</span>,</span>
<span id="cb4-77">            algorithm_configuration_name<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"hnsw-config"</span></span>
<span id="cb4-78">        )</span>
<span id="cb4-79">    ]</span>
<span id="cb4-80">)</span>
<span id="cb4-81"></span>
<span id="cb4-82"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># 시맨틱 검색 설정 (선택 사항)</span></span>
<span id="cb4-83">semantic_config <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> SemanticConfiguration(</span>
<span id="cb4-84">    name<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"semantic-config"</span>,</span>
<span id="cb4-85">    prioritized_fields<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span>SemanticPrioritizedFields(</span>
<span id="cb4-86">        title_field<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span><span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">None</span>,</span>
<span id="cb4-87">        content_fields<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span>[SemanticField(field_name<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"content"</span>)]</span>
<span id="cb4-88">    )</span>
<span id="cb4-89">)</span>
<span id="cb4-90"></span>
<span id="cb4-91">semantic_search <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> SemanticSearch(</span>
<span id="cb4-92">    configurations<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span>[semantic_config]</span>
<span id="cb4-93">)</span>
<span id="cb4-94"></span>
<span id="cb4-95"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># 인덱스 생성</span></span>
<span id="cb4-96">index <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> SearchIndex(</span>
<span id="cb4-97">    name<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span>os.getenv(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"AZURE_SEARCH_INDEX_NAME"</span>),</span>
<span id="cb4-98">    fields<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span>fields,</span>
<span id="cb4-99">    vector_search<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span>vector_search,</span>
<span id="cb4-100">    semantic_search<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span>semantic_search</span>
<span id="cb4-101">)</span>
<span id="cb4-102"></span>
<span id="cb4-103"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># 인덱스 업로드</span></span>
<span id="cb4-104">result <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> index_client.create_or_update_index(index)</span>
<span id="cb4-105"><span class="bu" style="color: null;
background-color: null;
font-style: inherit;">print</span>(<span class="ss" style="color: #20794D;
background-color: null;
font-style: inherit;">f"인덱스 생성 완료: </span><span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">{</span>result<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">.</span>name<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">}</span><span class="ss" style="color: #20794D;
background-color: null;
font-style: inherit;">"</span>)</span></code></pre></div>
</details>
</div>
</section>
<section id="문서-업로드" class="level3" data-number="5.2">
<h3 data-number="5.2" class="anchored" data-anchor-id="문서-업로드"><span class="header-section-number">5.2</span> 문서 업로드</h3>
<div id="1506211b" class="cell" data-execution_count="2">
<details class="code-fold">
<summary>코드</summary>
<div class="sourceCode cell-code" id="cb5" style="background: #f1f3f5;"><pre class="sourceCode numberSource python number-lines code-with-copy"><code class="sourceCode python"><span id="cb5-1"><span class="im" style="color: #00769E;
background-color: null;
font-style: inherit;">from</span> azure.search.documents <span class="im" style="color: #00769E;
background-color: null;
font-style: inherit;">import</span> SearchClient</span>
<span id="cb5-2"><span class="im" style="color: #00769E;
background-color: null;
font-style: inherit;">from</span> langchain_openai <span class="im" style="color: #00769E;
background-color: null;
font-style: inherit;">import</span> AzureOpenAIEmbeddings</span>
<span id="cb5-3"></span>
<span id="cb5-4"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># Embeddings 클라이언트</span></span>
<span id="cb5-5">embeddings <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> AzureOpenAIEmbeddings(</span>
<span id="cb5-6">    azure_deployment<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span>os.getenv(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"AZURE_OPENAI_EMBEDDING_DEPLOYMENT"</span>),</span>
<span id="cb5-7">    openai_api_version<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span>os.getenv(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"AZURE_OPENAI_API_VERSION"</span>),</span>
<span id="cb5-8">    azure_endpoint<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span>os.getenv(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"AZURE_OPENAI_ENDPOINT"</span>),</span>
<span id="cb5-9">    api_key<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span>os.getenv(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"AZURE_OPENAI_API_KEY"</span>)</span>
<span id="cb5-10">)</span>
<span id="cb5-11"></span>
<span id="cb5-12"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># Search 클라이언트</span></span>
<span id="cb5-13">search_client <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> SearchClient(</span>
<span id="cb5-14">    endpoint<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span>os.getenv(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"AZURE_SEARCH_ENDPOINT"</span>),</span>
<span id="cb5-15">    index_name<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span>os.getenv(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"AZURE_SEARCH_INDEX_NAME"</span>),</span>
<span id="cb5-16">    credential<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span>AzureKeyCredential(os.getenv(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"AZURE_SEARCH_API_KEY"</span>))</span>
<span id="cb5-17">)</span>
<span id="cb5-18"></span>
<span id="cb5-19"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># 문서 준비</span></span>
<span id="cb5-20">documents <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> [</span>
<span id="cb5-21">    {</span>
<span id="cb5-22">        <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"id"</span>: <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"1"</span>,</span>
<span id="cb5-23">        <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"content"</span>: <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Azure AI Search는 Microsoft의 관리형 검색 서비스다."</span>,</span>
<span id="cb5-24">        <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"source"</span>: <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"doc1.txt"</span>,</span>
<span id="cb5-25">        <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"metadata"</span>: <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Azure"</span></span>
<span id="cb5-26">    },</span>
<span id="cb5-27">    {</span>
<span id="cb5-28">        <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"id"</span>: <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"2"</span>,</span>
<span id="cb5-29">        <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"content"</span>: <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"RAG는 검색 증강 생성 기술이다."</span>,</span>
<span id="cb5-30">        <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"source"</span>: <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"doc2.txt"</span>,</span>
<span id="cb5-31">        <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"metadata"</span>: <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"RAG"</span></span>
<span id="cb5-32">    },</span>
<span id="cb5-33">    {</span>
<span id="cb5-34">        <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"id"</span>: <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"3"</span>,</span>
<span id="cb5-35">        <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"content"</span>: <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"임베딩은 텍스트를 벡터로 변환한다."</span>,</span>
<span id="cb5-36">        <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"source"</span>: <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"doc3.txt"</span>,</span>
<span id="cb5-37">        <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"metadata"</span>: <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Embeddings"</span></span>
<span id="cb5-38">    }</span>
<span id="cb5-39">]</span>
<span id="cb5-40"></span>
<span id="cb5-41"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># 임베딩 생성 및 문서 업로드</span></span>
<span id="cb5-42"><span class="cf" style="color: #003B4F;
background-color: null;
font-style: inherit;">for</span> doc <span class="kw" style="color: #003B4F;
background-color: null;
font-style: inherit;">in</span> documents:</span>
<span id="cb5-43">    <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># 임베딩 생성</span></span>
<span id="cb5-44">    doc[<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"content_vector"</span>] <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> embeddings.embed_query(doc[<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"content"</span>])</span>
<span id="cb5-45"></span>
<span id="cb5-46"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># 배치 업로드</span></span>
<span id="cb5-47">result <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> search_client.upload_documents(documents<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span>documents)</span>
<span id="cb5-48"><span class="bu" style="color: null;
background-color: null;
font-style: inherit;">print</span>(<span class="ss" style="color: #20794D;
background-color: null;
font-style: inherit;">f"업로드 완료: </span><span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">{</span><span class="bu" style="color: null;
background-color: null;
font-style: inherit;">len</span>(result)<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">}</span><span class="ss" style="color: #20794D;
background-color: null;
font-style: inherit;">개 문서"</span>)</span>
<span id="cb5-49"></span>
<span id="cb5-50"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># 각 문서 결과 확인</span></span>
<span id="cb5-51"><span class="cf" style="color: #003B4F;
background-color: null;
font-style: inherit;">for</span> item <span class="kw" style="color: #003B4F;
background-color: null;
font-style: inherit;">in</span> result:</span>
<span id="cb5-52">    <span class="bu" style="color: null;
background-color: null;
font-style: inherit;">print</span>(<span class="ss" style="color: #20794D;
background-color: null;
font-style: inherit;">f"문서 ID </span><span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">{</span>item<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">.</span>key<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">}</span><span class="ss" style="color: #20794D;
background-color: null;
font-style: inherit;">: </span><span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">{</span>item<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">.</span>succeeded<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">}</span><span class="ss" style="color: #20794D;
background-color: null;
font-style: inherit;">"</span>)</span></code></pre></div>
</details>
</div>
</section>
</section>
<section id="langchain-통합" class="level2" data-number="6">
<h2 data-number="6" class="anchored" data-anchor-id="langchain-통합"><span class="header-section-number">6</span> LangChain 통합</h2>
<section id="azuresearch-vectorstore" class="level3" data-number="6.1">
<h3 data-number="6.1" class="anchored" data-anchor-id="azuresearch-vectorstore"><span class="header-section-number">6.1</span> AzureSearch VectorStore</h3>
<div id="0af40db0" class="cell" data-execution_count="3">
<details class="code-fold">
<summary>코드</summary>
<div class="sourceCode cell-code" id="cb6" style="background: #f1f3f5;"><pre class="sourceCode numberSource python number-lines code-with-copy"><code class="sourceCode python"><span id="cb6-1"><span class="im" style="color: #00769E;
background-color: null;
font-style: inherit;">from</span> langchain_community.vectorstores.azuresearch <span class="im" style="color: #00769E;
background-color: null;
font-style: inherit;">import</span> AzureSearch</span>
<span id="cb6-2"></span>
<span id="cb6-3"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># Azure Search VectorStore 초기화</span></span>
<span id="cb6-4">vector_store <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> AzureSearch(</span>
<span id="cb6-5">    azure_search_endpoint<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span>os.getenv(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"AZURE_SEARCH_ENDPOINT"</span>),</span>
<span id="cb6-6">    azure_search_key<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span>os.getenv(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"AZURE_SEARCH_API_KEY"</span>),</span>
<span id="cb6-7">    index_name<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span>os.getenv(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"AZURE_SEARCH_INDEX_NAME"</span>),</span>
<span id="cb6-8">    embedding_function<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span>embeddings.embed_query</span>
<span id="cb6-9">)</span>
<span id="cb6-10"></span>
<span id="cb6-11"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># 문서 추가 (자동 임베딩)</span></span>
<span id="cb6-12"><span class="im" style="color: #00769E;
background-color: null;
font-style: inherit;">from</span> langchain_core.documents <span class="im" style="color: #00769E;
background-color: null;
font-style: inherit;">import</span> Document</span>
<span id="cb6-13"></span>
<span id="cb6-14">docs <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> [</span>
<span id="cb6-15">    Document(</span>
<span id="cb6-16">        page_content<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"LangChain은 LLM 애플리케이션 프레임워크다."</span>,</span>
<span id="cb6-17">        metadata<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span>{<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"source"</span>: <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"langchain.txt"</span>, <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"category"</span>: <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"framework"</span>}</span>
<span id="cb6-18">    ),</span>
<span id="cb6-19">    Document(</span>
<span id="cb6-20">        page_content<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Azure OpenAI는 엔터프라이즈급 LLM 서비스다."</span>,</span>
<span id="cb6-21">        metadata<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span>{<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"source"</span>: <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"azure_openai.txt"</span>, <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"category"</span>: <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"llm"</span>}</span>
<span id="cb6-22">    )</span>
<span id="cb6-23">]</span>
<span id="cb6-24"></span>
<span id="cb6-25"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># 자동으로 임베딩 생성 및 업로드</span></span>
<span id="cb6-26">vector_store.add_documents(docs)</span>
<span id="cb6-27"><span class="bu" style="color: null;
background-color: null;
font-style: inherit;">print</span>(<span class="ss" style="color: #20794D;
background-color: null;
font-style: inherit;">f"</span><span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">{</span><span class="bu" style="color: null;
background-color: null;
font-style: inherit;">len</span>(docs)<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">}</span><span class="ss" style="color: #20794D;
background-color: null;
font-style: inherit;">개 문서 추가 완료"</span>)</span></code></pre></div>
</details>
</div>
</section>
<section id="벡터-검색" class="level3" data-number="6.2">
<h3 data-number="6.2" class="anchored" data-anchor-id="벡터-검색"><span class="header-section-number">6.2</span> 벡터 검색</h3>
<div id="87dced8b" class="cell" data-execution_count="4">
<details class="code-fold">
<summary>코드</summary>
<div class="sourceCode cell-code" id="cb7" style="background: #f1f3f5;"><pre class="sourceCode numberSource python number-lines code-with-copy"><code class="sourceCode python"><span id="cb7-1"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># 유사도 검색</span></span>
<span id="cb7-2">query <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"LLM 프레임워크는 무엇인가?"</span></span>
<span id="cb7-3">results <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> vector_store.similarity_search(query, k<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">3</span>)</span>
<span id="cb7-4"></span>
<span id="cb7-5"><span class="bu" style="color: null;
background-color: null;
font-style: inherit;">print</span>(<span class="ss" style="color: #20794D;
background-color: null;
font-style: inherit;">f"검색 결과 (</span><span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">{</span><span class="bu" style="color: null;
background-color: null;
font-style: inherit;">len</span>(results)<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">}</span><span class="ss" style="color: #20794D;
background-color: null;
font-style: inherit;">개):</span><span class="ch" style="color: #20794D;
background-color: null;
font-style: inherit;">\n</span><span class="ss" style="color: #20794D;
background-color: null;
font-style: inherit;">"</span>)</span>
<span id="cb7-6"><span class="cf" style="color: #003B4F;
background-color: null;
font-style: inherit;">for</span> i, doc <span class="kw" style="color: #003B4F;
background-color: null;
font-style: inherit;">in</span> <span class="bu" style="color: null;
background-color: null;
font-style: inherit;">enumerate</span>(results, <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span>):</span>
<span id="cb7-7">    <span class="bu" style="color: null;
background-color: null;
font-style: inherit;">print</span>(<span class="ss" style="color: #20794D;
background-color: null;
font-style: inherit;">f"</span><span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">{</span>i<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">}</span><span class="ss" style="color: #20794D;
background-color: null;
font-style: inherit;">. </span><span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">{</span>doc<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">.</span>page_content<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">}</span><span class="ss" style="color: #20794D;
background-color: null;
font-style: inherit;">"</span>)</span>
<span id="cb7-8">    <span class="bu" style="color: null;
background-color: null;
font-style: inherit;">print</span>(<span class="ss" style="color: #20794D;
background-color: null;
font-style: inherit;">f"   메타데이터: </span><span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">{</span>doc<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">.</span>metadata<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">}</span><span class="ch" style="color: #20794D;
background-color: null;
font-style: inherit;">\n</span><span class="ss" style="color: #20794D;
background-color: null;
font-style: inherit;">"</span>)</span></code></pre></div>
</details>
</div>
</section>
<section id="유사도-점수와-함께-검색" class="level3" data-number="6.3">
<h3 data-number="6.3" class="anchored" data-anchor-id="유사도-점수와-함께-검색"><span class="header-section-number">6.3</span> 유사도 점수와 함께 검색</h3>
<div id="8a9700ac" class="cell" data-execution_count="5">
<details class="code-fold">
<summary>코드</summary>
<div class="sourceCode cell-code" id="cb8" style="background: #f1f3f5;"><pre class="sourceCode numberSource python number-lines code-with-copy"><code class="sourceCode python"><span id="cb8-1"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># 유사도 점수 포함 검색</span></span>
<span id="cb8-2">results_with_scores <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> vector_store.similarity_search_with_relevance_scores(</span>
<span id="cb8-3">    query<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Azure 검색 서비스"</span>,</span>
<span id="cb8-4">    k<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">3</span></span>
<span id="cb8-5">)</span>
<span id="cb8-6"></span>
<span id="cb8-7"><span class="bu" style="color: null;
background-color: null;
font-style: inherit;">print</span>(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"유사도 점수:</span><span class="ch" style="color: #20794D;
background-color: null;
font-style: inherit;">\n</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"</span>)</span>
<span id="cb8-8"><span class="cf" style="color: #003B4F;
background-color: null;
font-style: inherit;">for</span> doc, score <span class="kw" style="color: #003B4F;
background-color: null;
font-style: inherit;">in</span> results_with_scores:</span>
<span id="cb8-9">    <span class="bu" style="color: null;
background-color: null;
font-style: inherit;">print</span>(<span class="ss" style="color: #20794D;
background-color: null;
font-style: inherit;">f"점수: </span><span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">{</span>score<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">:.4f}</span><span class="ss" style="color: #20794D;
background-color: null;
font-style: inherit;">"</span>)</span>
<span id="cb8-10">    <span class="bu" style="color: null;
background-color: null;
font-style: inherit;">print</span>(<span class="ss" style="color: #20794D;
background-color: null;
font-style: inherit;">f"내용: </span><span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">{</span>doc<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">.</span>page_content<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">}</span><span class="ss" style="color: #20794D;
background-color: null;
font-style: inherit;">"</span>)</span>
<span id="cb8-11">    <span class="bu" style="color: null;
background-color: null;
font-style: inherit;">print</span>(<span class="ss" style="color: #20794D;
background-color: null;
font-style: inherit;">f"출처: </span><span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">{</span>doc<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">.</span>metadata<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">.</span>get(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">'source'</span>, <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">'N/A'</span>)<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">}</span><span class="ch" style="color: #20794D;
background-color: null;
font-style: inherit;">\n</span><span class="ss" style="color: #20794D;
background-color: null;
font-style: inherit;">"</span>)</span></code></pre></div>
</details>
</div>
</section>
</section>
<section id="하이브리드-검색" class="level2" data-number="7">
<h2 data-number="7" class="anchored" data-anchor-id="하이브리드-검색"><span class="header-section-number">7</span> 하이브리드 검색</h2>
<p>벡터 검색 + 키워드 검색을 결합한다.</p>
<section id="하이브리드-검색-구현" class="level3" data-number="7.1">
<h3 data-number="7.1" class="anchored" data-anchor-id="하이브리드-검색-구현"><span class="header-section-number">7.1</span> 하이브리드 검색 구현</h3>
<div id="940c6b0a" class="cell" data-execution_count="6">
<details class="code-fold">
<summary>코드</summary>
<div class="sourceCode cell-code" id="cb9" style="background: #f1f3f5;"><pre class="sourceCode numberSource python number-lines code-with-copy"><code class="sourceCode python"><span id="cb9-1"><span class="im" style="color: #00769E;
background-color: null;
font-style: inherit;">from</span> azure.search.documents.models <span class="im" style="color: #00769E;
background-color: null;
font-style: inherit;">import</span> VectorizedQuery</span>
<span id="cb9-2"></span>
<span id="cb9-3"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># 검색 클라이언트</span></span>
<span id="cb9-4">search_client <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> SearchClient(</span>
<span id="cb9-5">    endpoint<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span>os.getenv(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"AZURE_SEARCH_ENDPOINT"</span>),</span>
<span id="cb9-6">    index_name<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span>os.getenv(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"AZURE_SEARCH_INDEX_NAME"</span>),</span>
<span id="cb9-7">    credential<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span>AzureKeyCredential(os.getenv(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"AZURE_SEARCH_API_KEY"</span>))</span>
<span id="cb9-8">)</span>
<span id="cb9-9"></span>
<span id="cb9-10"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># 쿼리</span></span>
<span id="cb9-11">query_text <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Azure 검색 서비스"</span></span>
<span id="cb9-12">query_vector <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> embeddings.embed_query(query_text)</span>
<span id="cb9-13"></span>
<span id="cb9-14"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># 벡터 쿼리 정의</span></span>
<span id="cb9-15">vector_query <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> VectorizedQuery(</span>
<span id="cb9-16">    vector<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span>query_vector,</span>
<span id="cb9-17">    k_nearest_neighbors<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">50</span>,  <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># 벡터 검색 결과 수</span></span>
<span id="cb9-18">    fields<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"content_vector"</span></span>
<span id="cb9-19">)</span>
<span id="cb9-20"></span>
<span id="cb9-21"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># 하이브리드 검색 실행</span></span>
<span id="cb9-22">results <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> search_client.search(</span>
<span id="cb9-23">    search_text<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span>query_text,  <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># 키워드 검색</span></span>
<span id="cb9-24">    vector_queries<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span>[vector_query],  <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># 벡터 검색</span></span>
<span id="cb9-25">    select<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span>[<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"id"</span>, <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"content"</span>, <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"source"</span>, <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"metadata"</span>],</span>
<span id="cb9-26">    top<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">5</span></span>
<span id="cb9-27">)</span>
<span id="cb9-28"></span>
<span id="cb9-29"><span class="bu" style="color: null;
background-color: null;
font-style: inherit;">print</span>(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"하이브리드 검색 결과:</span><span class="ch" style="color: #20794D;
background-color: null;
font-style: inherit;">\n</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"</span>)</span>
<span id="cb9-30"><span class="cf" style="color: #003B4F;
background-color: null;
font-style: inherit;">for</span> result <span class="kw" style="color: #003B4F;
background-color: null;
font-style: inherit;">in</span> results:</span>
<span id="cb9-31">    <span class="bu" style="color: null;
background-color: null;
font-style: inherit;">print</span>(<span class="ss" style="color: #20794D;
background-color: null;
font-style: inherit;">f"ID: </span><span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">{</span>result[<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">'id'</span>]<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">}</span><span class="ss" style="color: #20794D;
background-color: null;
font-style: inherit;">"</span>)</span>
<span id="cb9-32">    <span class="bu" style="color: null;
background-color: null;
font-style: inherit;">print</span>(<span class="ss" style="color: #20794D;
background-color: null;
font-style: inherit;">f"점수: </span><span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">{</span>result[<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">'@search.score'</span>]<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">:.4f}</span><span class="ss" style="color: #20794D;
background-color: null;
font-style: inherit;">"</span>)</span>
<span id="cb9-33">    <span class="bu" style="color: null;
background-color: null;
font-style: inherit;">print</span>(<span class="ss" style="color: #20794D;
background-color: null;
font-style: inherit;">f"내용: </span><span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">{</span>result[<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">'content'</span>]<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">}</span><span class="ss" style="color: #20794D;
background-color: null;
font-style: inherit;">"</span>)</span>
<span id="cb9-34">    <span class="bu" style="color: null;
background-color: null;
font-style: inherit;">print</span>(<span class="ss" style="color: #20794D;
background-color: null;
font-style: inherit;">f"출처: </span><span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">{</span>result[<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">'source'</span>]<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">}</span><span class="ch" style="color: #20794D;
background-color: null;
font-style: inherit;">\n</span><span class="ss" style="color: #20794D;
background-color: null;
font-style: inherit;">"</span>)</span></code></pre></div>
</details>
</div>
</section>
<section id="시맨틱-검색-고급" class="level3" data-number="7.2">
<h3 data-number="7.2" class="anchored" data-anchor-id="시맨틱-검색-고급"><span class="header-section-number">7.2</span> 시맨틱 검색 (고급)</h3>
<p>Azure AI Search의 AI 기반 재순위화 기능이다.</p>
<div id="fccfe016" class="cell" data-execution_count="7">
<details class="code-fold">
<summary>코드</summary>
<div class="sourceCode cell-code" id="cb10" style="background: #f1f3f5;"><pre class="sourceCode numberSource python number-lines code-with-copy"><code class="sourceCode python"><span id="cb10-1"><span class="im" style="color: #00769E;
background-color: null;
font-style: inherit;">from</span> azure.search.documents.models <span class="im" style="color: #00769E;
background-color: null;
font-style: inherit;">import</span> QueryType, QueryCaptionType, QueryAnswerType</span>
<span id="cb10-2"></span>
<span id="cb10-3"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># 시맨틱 검색</span></span>
<span id="cb10-4">results <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> search_client.search(</span>
<span id="cb10-5">    search_text<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Azure에서 제공하는 검색 서비스는 무엇인가?"</span>,</span>
<span id="cb10-6">    vector_queries<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span>[vector_query],</span>
<span id="cb10-7">    query_type<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span>QueryType.SEMANTIC,  <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># 시맨틱 검색 활성화</span></span>
<span id="cb10-8">    semantic_configuration_name<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"semantic-config"</span>,</span>
<span id="cb10-9">    query_caption<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span>QueryCaptionType.EXTRACTIVE,</span>
<span id="cb10-10">    query_answer<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span>QueryAnswerType.EXTRACTIVE,</span>
<span id="cb10-11">    top<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">3</span></span>
<span id="cb10-12">)</span>
<span id="cb10-13"></span>
<span id="cb10-14"><span class="bu" style="color: null;
background-color: null;
font-style: inherit;">print</span>(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"시맨틱 검색 결과:</span><span class="ch" style="color: #20794D;
background-color: null;
font-style: inherit;">\n</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"</span>)</span>
<span id="cb10-15"><span class="cf" style="color: #003B4F;
background-color: null;
font-style: inherit;">for</span> result <span class="kw" style="color: #003B4F;
background-color: null;
font-style: inherit;">in</span> results:</span>
<span id="cb10-16">    <span class="bu" style="color: null;
background-color: null;
font-style: inherit;">print</span>(<span class="ss" style="color: #20794D;
background-color: null;
font-style: inherit;">f"내용: </span><span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">{</span>result[<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">'content'</span>]<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">}</span><span class="ss" style="color: #20794D;
background-color: null;
font-style: inherit;">"</span>)</span>
<span id="cb10-17">    </span>
<span id="cb10-18">    <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># 캡션 (관련 부분 하이라이트)</span></span>
<span id="cb10-19">    <span class="cf" style="color: #003B4F;
background-color: null;
font-style: inherit;">if</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">'@search.captions'</span> <span class="kw" style="color: #003B4F;
background-color: null;
font-style: inherit;">in</span> result:</span>
<span id="cb10-20">        captions <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> result[<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">'@search.captions'</span>]</span>
<span id="cb10-21">        <span class="cf" style="color: #003B4F;
background-color: null;
font-style: inherit;">if</span> captions:</span>
<span id="cb10-22">            <span class="bu" style="color: null;
background-color: null;
font-style: inherit;">print</span>(<span class="ss" style="color: #20794D;
background-color: null;
font-style: inherit;">f"캡션: </span><span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">{</span>captions[<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">0</span>]<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">.</span>text<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">}</span><span class="ss" style="color: #20794D;
background-color: null;
font-style: inherit;">"</span>)</span>
<span id="cb10-23">    </span>
<span id="cb10-24">    <span class="bu" style="color: null;
background-color: null;
font-style: inherit;">print</span>(<span class="ss" style="color: #20794D;
background-color: null;
font-style: inherit;">f"점수: </span><span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">{</span>result[<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">'@search.score'</span>]<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">:.4f}</span><span class="ch" style="color: #20794D;
background-color: null;
font-style: inherit;">\n</span><span class="ss" style="color: #20794D;
background-color: null;
font-style: inherit;">"</span>)</span></code></pre></div>
</details>
</div>
</section>
</section>
<section id="필터링" class="level2" data-number="8">
<h2 data-number="8" class="anchored" data-anchor-id="필터링"><span class="header-section-number">8</span> 필터링</h2>
<p>메타데이터 기반 필터링으로 검색 범위를 제한한다.</p>
<div id="1f1cea7c" class="cell" data-execution_count="8">
<details class="code-fold">
<summary>코드</summary>
<div class="sourceCode cell-code" id="cb11" style="background: #f1f3f5;"><pre class="sourceCode numberSource python number-lines code-with-copy"><code class="sourceCode python"><span id="cb11-1"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># 메타데이터 필터링</span></span>
<span id="cb11-2">results <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> vector_store.similarity_search(</span>
<span id="cb11-3">    query<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Azure 서비스"</span>,</span>
<span id="cb11-4">    k<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">5</span>,</span>
<span id="cb11-5">    filters<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"metadata eq 'Azure'"</span>  <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># OData 필터 구문</span></span>
<span id="cb11-6">)</span>
<span id="cb11-7"></span>
<span id="cb11-8"><span class="bu" style="color: null;
background-color: null;
font-style: inherit;">print</span>(<span class="ss" style="color: #20794D;
background-color: null;
font-style: inherit;">f"필터링된 결과 (</span><span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">{</span><span class="bu" style="color: null;
background-color: null;
font-style: inherit;">len</span>(results)<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">}</span><span class="ss" style="color: #20794D;
background-color: null;
font-style: inherit;">개):"</span>)</span>
<span id="cb11-9"><span class="cf" style="color: #003B4F;
background-color: null;
font-style: inherit;">for</span> doc <span class="kw" style="color: #003B4F;
background-color: null;
font-style: inherit;">in</span> results:</span>
<span id="cb11-10">    <span class="bu" style="color: null;
background-color: null;
font-style: inherit;">print</span>(<span class="ss" style="color: #20794D;
background-color: null;
font-style: inherit;">f"- </span><span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">{</span>doc<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">.</span>page_content<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">}</span><span class="ss" style="color: #20794D;
background-color: null;
font-style: inherit;">"</span>)</span>
<span id="cb11-11">    <span class="bu" style="color: null;
background-color: null;
font-style: inherit;">print</span>(<span class="ss" style="color: #20794D;
background-color: null;
font-style: inherit;">f"  메타데이터: </span><span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">{</span>doc<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">.</span>metadata<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">}</span><span class="ch" style="color: #20794D;
background-color: null;
font-style: inherit;">\n</span><span class="ss" style="color: #20794D;
background-color: null;
font-style: inherit;">"</span>)</span></code></pre></div>
</details>
</div>
<section id="복합-필터" class="level3" data-number="8.1">
<h3 data-number="8.1" class="anchored" data-anchor-id="복합-필터"><span class="header-section-number">8.1</span> 복합 필터</h3>
<div id="2462959b" class="cell" data-execution_count="9">
<details class="code-fold">
<summary>코드</summary>
<div class="sourceCode cell-code" id="cb12" style="background: #f1f3f5;"><pre class="sourceCode numberSource python number-lines code-with-copy"><code class="sourceCode python"><span id="cb12-1"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># AND/OR 조건</span></span>
<span id="cb12-2">filter_expression <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"metadata eq 'Azure' and source eq 'doc1.txt'"</span></span>
<span id="cb12-3"></span>
<span id="cb12-4">results <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> search_client.search(</span>
<span id="cb12-5">    search_text<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"검색"</span>,</span>
<span id="cb12-6">    <span class="bu" style="color: null;
background-color: null;
font-style: inherit;">filter</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span>filter_expression,</span>
<span id="cb12-7">    top<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">5</span></span>
<span id="cb12-8">)</span>
<span id="cb12-9"></span>
<span id="cb12-10"><span class="cf" style="color: #003B4F;
background-color: null;
font-style: inherit;">for</span> result <span class="kw" style="color: #003B4F;
background-color: null;
font-style: inherit;">in</span> results:</span>
<span id="cb12-11">    <span class="bu" style="color: null;
background-color: null;
font-style: inherit;">print</span>(<span class="ss" style="color: #20794D;
background-color: null;
font-style: inherit;">f"- </span><span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">{</span>result[<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">'content'</span>]<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">}</span><span class="ss" style="color: #20794D;
background-color: null;
font-style: inherit;">"</span>)</span></code></pre></div>
</details>
</div>
</section>
</section>
<section id="retriever로-활용" class="level2" data-number="9">
<h2 data-number="9" class="anchored" data-anchor-id="retriever로-활용"><span class="header-section-number">9</span> Retriever로 활용</h2>
<section id="vectorstoreretriever" class="level3" data-number="9.1">
<h3 data-number="9.1" class="anchored" data-anchor-id="vectorstoreretriever"><span class="header-section-number">9.1</span> VectorStoreRetriever</h3>
<div id="54fe1ade" class="cell" data-execution_count="10">
<details class="code-fold">
<summary>코드</summary>
<div class="sourceCode cell-code" id="cb13" style="background: #f1f3f5;"><pre class="sourceCode numberSource python number-lines code-with-copy"><code class="sourceCode python"><span id="cb13-1"><span class="im" style="color: #00769E;
background-color: null;
font-style: inherit;">from</span> langchain_core.runnables <span class="im" style="color: #00769E;
background-color: null;
font-style: inherit;">import</span> RunnablePassthrough</span>
<span id="cb13-2"><span class="im" style="color: #00769E;
background-color: null;
font-style: inherit;">from</span> langchain_core.output_parsers <span class="im" style="color: #00769E;
background-color: null;
font-style: inherit;">import</span> StrOutputParser</span>
<span id="cb13-3"><span class="im" style="color: #00769E;
background-color: null;
font-style: inherit;">from</span> langchain_openai <span class="im" style="color: #00769E;
background-color: null;
font-style: inherit;">import</span> AzureChatOpenAI</span>
<span id="cb13-4"><span class="im" style="color: #00769E;
background-color: null;
font-style: inherit;">from</span> langchain_core.prompts <span class="im" style="color: #00769E;
background-color: null;
font-style: inherit;">import</span> ChatPromptTemplate</span>
<span id="cb13-5"></span>
<span id="cb13-6"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># Retriever 생성</span></span>
<span id="cb13-7">retriever <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> vector_store.as_retriever(</span>
<span id="cb13-8">    search_type<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"similarity"</span>,</span>
<span id="cb13-9">    search_kwargs<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span>{<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"k"</span>: <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">3</span>}</span>
<span id="cb13-10">)</span>
<span id="cb13-11"></span>
<span id="cb13-12"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># LLM</span></span>
<span id="cb13-13">llm <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> AzureChatOpenAI(</span>
<span id="cb13-14">    azure_deployment<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span>os.getenv(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"AZURE_OPENAI_DEPLOYMENT"</span>),</span>
<span id="cb13-15">    openai_api_version<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span>os.getenv(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"AZURE_OPENAI_API_VERSION"</span>),</span>
<span id="cb13-16">    azure_endpoint<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span>os.getenv(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"AZURE_OPENAI_ENDPOINT"</span>),</span>
<span id="cb13-17">    api_key<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span>os.getenv(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"AZURE_OPENAI_API_KEY"</span>),</span>
<span id="cb13-18">    temperature<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">0</span></span>
<span id="cb13-19">)</span>
<span id="cb13-20"></span>
<span id="cb13-21"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># 프롬프트</span></span>
<span id="cb13-22">prompt <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> ChatPromptTemplate.from_template(</span>
<span id="cb13-23">    <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"""다음 컨텍스트를 참고하여 질문에 답변하세요.</span></span>
<span id="cb13-24"></span>
<span id="cb13-25"><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">컨텍스트:</span></span>
<span id="cb13-26"><span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">{context}</span></span>
<span id="cb13-27"></span>
<span id="cb13-28"><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">질문: </span><span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">{question}</span></span>
<span id="cb13-29"></span>
<span id="cb13-30"><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">답변:"""</span></span>
<span id="cb13-31">)</span>
<span id="cb13-32"></span>
<span id="cb13-33"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># RAG 체인</span></span>
<span id="cb13-34"><span class="kw" style="color: #003B4F;
background-color: null;
font-style: inherit;">def</span> format_docs(docs):</span>
<span id="cb13-35">    <span class="cf" style="color: #003B4F;
background-color: null;
font-style: inherit;">return</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"</span><span class="ch" style="color: #20794D;
background-color: null;
font-style: inherit;">\n\n</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"</span>.join([doc.page_content <span class="cf" style="color: #003B4F;
background-color: null;
font-style: inherit;">for</span> doc <span class="kw" style="color: #003B4F;
background-color: null;
font-style: inherit;">in</span> docs])</span>
<span id="cb13-36"></span>
<span id="cb13-37">rag_chain <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> (</span>
<span id="cb13-38">    {<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"context"</span>: retriever <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">|</span> format_docs, <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"question"</span>: RunnablePassthrough()}</span>
<span id="cb13-39">    <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">|</span> prompt</span>
<span id="cb13-40">    <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">|</span> llm</span>
<span id="cb13-41">    <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">|</span> StrOutputParser()</span>
<span id="cb13-42">)</span>
<span id="cb13-43"></span>
<span id="cb13-44"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># 실행</span></span>
<span id="cb13-45">answer <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> rag_chain.invoke(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Azure AI Search는 무엇인가?"</span>)</span>
<span id="cb13-46"><span class="bu" style="color: null;
background-color: null;
font-style: inherit;">print</span>(<span class="ss" style="color: #20794D;
background-color: null;
font-style: inherit;">f"답변: </span><span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">{</span>answer<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">}</span><span class="ss" style="color: #20794D;
background-color: null;
font-style: inherit;">"</span>)</span></code></pre></div>
</details>
</div>
</section>
</section>
<section id="대량-문서-업로드" class="level2" data-number="10">
<h2 data-number="10" class="anchored" data-anchor-id="대량-문서-업로드"><span class="header-section-number">10</span> 대량 문서 업로드</h2>
<section id="배치-업로드" class="level3" data-number="10.1">
<h3 data-number="10.1" class="anchored" data-anchor-id="배치-업로드"><span class="header-section-number">10.1</span> 배치 업로드</h3>
<div id="14cc979f" class="cell" data-execution_count="11">
<details class="code-fold">
<summary>코드</summary>
<div class="sourceCode cell-code" id="cb14" style="background: #f1f3f5;"><pre class="sourceCode numberSource python number-lines code-with-copy"><code class="sourceCode python"><span id="cb14-1"><span class="kw" style="color: #003B4F;
background-color: null;
font-style: inherit;">def</span> upload_documents_batch(documents, batch_size<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1000</span>):</span>
<span id="cb14-2">    <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">"""배치 단위로 대량 문서 업로드"""</span></span>
<span id="cb14-3">    total_uploaded <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">0</span></span>
<span id="cb14-4">    </span>
<span id="cb14-5">    <span class="cf" style="color: #003B4F;
background-color: null;
font-style: inherit;">for</span> i <span class="kw" style="color: #003B4F;
background-color: null;
font-style: inherit;">in</span> <span class="bu" style="color: null;
background-color: null;
font-style: inherit;">range</span>(<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">0</span>, <span class="bu" style="color: null;
background-color: null;
font-style: inherit;">len</span>(documents), batch_size):</span>
<span id="cb14-6">        batch <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> documents[i:i<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span>batch_size]</span>
<span id="cb14-7">        </span>
<span id="cb14-8">        <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># 임베딩 생성</span></span>
<span id="cb14-9">        <span class="cf" style="color: #003B4F;
background-color: null;
font-style: inherit;">for</span> doc <span class="kw" style="color: #003B4F;
background-color: null;
font-style: inherit;">in</span> batch:</span>
<span id="cb14-10">            <span class="cf" style="color: #003B4F;
background-color: null;
font-style: inherit;">if</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"content_vector"</span> <span class="kw" style="color: #003B4F;
background-color: null;
font-style: inherit;">not</span> <span class="kw" style="color: #003B4F;
background-color: null;
font-style: inherit;">in</span> doc:</span>
<span id="cb14-11">                doc[<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"content_vector"</span>] <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> embeddings.embed_query(doc[<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"content"</span>])</span>
<span id="cb14-12">        </span>
<span id="cb14-13">        <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># 업로드</span></span>
<span id="cb14-14">        result <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> search_client.upload_documents(documents<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span>batch)</span>
<span id="cb14-15">        </span>
<span id="cb14-16">        uploaded <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> <span class="bu" style="color: null;
background-color: null;
font-style: inherit;">sum</span>(<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span> <span class="cf" style="color: #003B4F;
background-color: null;
font-style: inherit;">for</span> item <span class="kw" style="color: #003B4F;
background-color: null;
font-style: inherit;">in</span> result <span class="cf" style="color: #003B4F;
background-color: null;
font-style: inherit;">if</span> item.succeeded)</span>
<span id="cb14-17">        total_uploaded <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+=</span> uploaded</span>
<span id="cb14-18">        </span>
<span id="cb14-19">        <span class="bu" style="color: null;
background-color: null;
font-style: inherit;">print</span>(<span class="ss" style="color: #20794D;
background-color: null;
font-style: inherit;">f"배치 </span><span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">{</span>i<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">//</span>batch_size <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span><span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">}</span><span class="ss" style="color: #20794D;
background-color: null;
font-style: inherit;">: </span><span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">{</span>uploaded<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">}</span><span class="ss" style="color: #20794D;
background-color: null;
font-style: inherit;">/</span><span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">{</span><span class="bu" style="color: null;
background-color: null;
font-style: inherit;">len</span>(batch)<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">}</span><span class="ss" style="color: #20794D;
background-color: null;
font-style: inherit;"> 업로드"</span>)</span>
<span id="cb14-20">    </span>
<span id="cb14-21">    <span class="cf" style="color: #003B4F;
background-color: null;
font-style: inherit;">return</span> total_uploaded</span>
<span id="cb14-22"></span>
<span id="cb14-23"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># 사용 예시</span></span>
<span id="cb14-24"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># large_docs = [{"id": str(i), "content": f"문서 {i}"} for i in range(5000)]</span></span>
<span id="cb14-25"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># total = upload_documents_batch(large_docs, batch_size=1000)</span></span>
<span id="cb14-26"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># print(f"총 {total}개 문서 업로드 완료")</span></span></code></pre></div>
</details>
</div>
</section>
</section>
<section id="인덱스-관리" class="level2" data-number="11">
<h2 data-number="11" class="anchored" data-anchor-id="인덱스-관리"><span class="header-section-number">11</span> 인덱스 관리</h2>
<section id="인덱스-삭제" class="level3" data-number="11.1">
<h3 data-number="11.1" class="anchored" data-anchor-id="인덱스-삭제"><span class="header-section-number">11.1</span> 인덱스 삭제</h3>
<div id="58608f76" class="cell" data-execution_count="12">
<details class="code-fold">
<summary>코드</summary>
<div class="sourceCode cell-code" id="cb15" style="background: #f1f3f5;"><pre class="sourceCode numberSource python number-lines code-with-copy"><code class="sourceCode python"><span id="cb15-1"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># 인덱스 삭제</span></span>
<span id="cb15-2">index_client.delete_index(os.getenv(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"AZURE_SEARCH_INDEX_NAME"</span>))</span>
<span id="cb15-3"><span class="bu" style="color: null;
background-color: null;
font-style: inherit;">print</span>(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"인덱스 삭제 완료"</span>)</span></code></pre></div>
</details>
</div>
</section>
<section id="인덱스-목록-조회" class="level3" data-number="11.2">
<h3 data-number="11.2" class="anchored" data-anchor-id="인덱스-목록-조회"><span class="header-section-number">11.2</span> 인덱스 목록 조회</h3>
<div id="c23ee2d0" class="cell" data-execution_count="13">
<details class="code-fold">
<summary>코드</summary>
<div class="sourceCode cell-code" id="cb16" style="background: #f1f3f5;"><pre class="sourceCode numberSource python number-lines code-with-copy"><code class="sourceCode python"><span id="cb16-1"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># 모든 인덱스 조회</span></span>
<span id="cb16-2">indexes <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> index_client.list_indexes()</span>
<span id="cb16-3"></span>
<span id="cb16-4"><span class="bu" style="color: null;
background-color: null;
font-style: inherit;">print</span>(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"인덱스 목록:"</span>)</span>
<span id="cb16-5"><span class="cf" style="color: #003B4F;
background-color: null;
font-style: inherit;">for</span> index <span class="kw" style="color: #003B4F;
background-color: null;
font-style: inherit;">in</span> indexes:</span>
<span id="cb16-6">    <span class="bu" style="color: null;
background-color: null;
font-style: inherit;">print</span>(<span class="ss" style="color: #20794D;
background-color: null;
font-style: inherit;">f"- </span><span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">{</span>index<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">.</span>name<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">}</span><span class="ss" style="color: #20794D;
background-color: null;
font-style: inherit;">"</span>)</span></code></pre></div>
</details>
</div>
</section>
<section id="문서-삭제" class="level3" data-number="11.3">
<h3 data-number="11.3" class="anchored" data-anchor-id="문서-삭제"><span class="header-section-number">11.3</span> 문서 삭제</h3>
<div id="3c081e63" class="cell" data-execution_count="14">
<details class="code-fold">
<summary>코드</summary>
<div class="sourceCode cell-code" id="cb17" style="background: #f1f3f5;"><pre class="sourceCode numberSource python number-lines code-with-copy"><code class="sourceCode python"><span id="cb17-1"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># 특정 문서 삭제</span></span>
<span id="cb17-2">search_client.delete_documents(documents<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span>[{<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"id"</span>: <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"1"</span>}, {<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"id"</span>: <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"2"</span>}])</span>
<span id="cb17-3"><span class="bu" style="color: null;
background-color: null;
font-style: inherit;">print</span>(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"문서 삭제 완료"</span>)</span></code></pre></div>
</details>
</div>
</section>
</section>
<section id="모니터링" class="level2" data-number="12">
<h2 data-number="12" class="anchored" data-anchor-id="모니터링"><span class="header-section-number">12</span> 모니터링</h2>
<section id="인덱스-통계" class="level3" data-number="12.1">
<h3 data-number="12.1" class="anchored" data-anchor-id="인덱스-통계"><span class="header-section-number">12.1</span> 인덱스 통계</h3>
<div id="20315038" class="cell" data-execution_count="15">
<details class="code-fold">
<summary>코드</summary>
<div class="sourceCode cell-code" id="cb18" style="background: #f1f3f5;"><pre class="sourceCode numberSource python number-lines code-with-copy"><code class="sourceCode python"><span id="cb18-1"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># 인덱스 통계 조회</span></span>
<span id="cb18-2">stats <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> search_client.get_document_count()</span>
<span id="cb18-3"><span class="bu" style="color: null;
background-color: null;
font-style: inherit;">print</span>(<span class="ss" style="color: #20794D;
background-color: null;
font-style: inherit;">f"총 문서 수: </span><span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">{</span>stats<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">}</span><span class="ss" style="color: #20794D;
background-color: null;
font-style: inherit;">"</span>)</span></code></pre></div>
</details>
</div>
</section>
<section id="검색-쿼리-성능" class="level3" data-number="12.2">
<h3 data-number="12.2" class="anchored" data-anchor-id="검색-쿼리-성능"><span class="header-section-number">12.2</span> 검색 쿼리 성능</h3>
<div id="f6f6b079" class="cell" data-execution_count="16">
<details class="code-fold">
<summary>코드</summary>
<div class="sourceCode cell-code" id="cb19" style="background: #f1f3f5;"><pre class="sourceCode numberSource python number-lines code-with-copy"><code class="sourceCode python"><span id="cb19-1"><span class="im" style="color: #00769E;
background-color: null;
font-style: inherit;">import</span> time</span>
<span id="cb19-2"></span>
<span id="cb19-3"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># 검색 성능 측정</span></span>
<span id="cb19-4">start_time <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> time.time()</span>
<span id="cb19-5"></span>
<span id="cb19-6">results <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> vector_store.similarity_search(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"테스트 쿼리"</span>, k<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">10</span>)</span>
<span id="cb19-7"></span>
<span id="cb19-8">duration <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> time.time() <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">-</span> start_time</span>
<span id="cb19-9"><span class="bu" style="color: null;
background-color: null;
font-style: inherit;">print</span>(<span class="ss" style="color: #20794D;
background-color: null;
font-style: inherit;">f"검색 시간: </span><span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">{</span>duration<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">:.3f}</span><span class="ss" style="color: #20794D;
background-color: null;
font-style: inherit;">초"</span>)</span>
<span id="cb19-10"><span class="bu" style="color: null;
background-color: null;
font-style: inherit;">print</span>(<span class="ss" style="color: #20794D;
background-color: null;
font-style: inherit;">f"검색 결과: </span><span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">{</span><span class="bu" style="color: null;
background-color: null;
font-style: inherit;">len</span>(results)<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">}</span><span class="ss" style="color: #20794D;
background-color: null;
font-style: inherit;">개"</span>)</span></code></pre></div>
</details>
</div>
</section>
</section>
<section id="문제-해결" class="level2" data-number="13">
<h2 data-number="13" class="anchored" data-anchor-id="문제-해결"><span class="header-section-number">13</span> 문제 해결</h2>
<section id="일반적인-오류" class="level3" data-number="13.1">
<h3 data-number="13.1" class="anchored" data-anchor-id="일반적인-오류"><span class="header-section-number">13.1</span> 일반적인 오류</h3>
<p><strong>1. 인덱스가 존재하지 않음</strong></p>
<div class="sourceCode" id="cb20" style="background: #f1f3f5;"><pre class="sourceCode numberSource python number-lines code-with-copy"><code class="sourceCode python"><span id="cb20-1"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># 해결: 인덱스 존재 확인</span></span>
<span id="cb20-2"><span class="cf" style="color: #003B4F;
background-color: null;
font-style: inherit;">try</span>:</span>
<span id="cb20-3">    index <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> index_client.get_index(os.getenv(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"AZURE_SEARCH_INDEX_NAME"</span>))</span>
<span id="cb20-4">    <span class="bu" style="color: null;
background-color: null;
font-style: inherit;">print</span>(<span class="ss" style="color: #20794D;
background-color: null;
font-style: inherit;">f"인덱스 존재: </span><span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">{</span>index<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">.</span>name<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">}</span><span class="ss" style="color: #20794D;
background-color: null;
font-style: inherit;">"</span>)</span>
<span id="cb20-5"><span class="cf" style="color: #003B4F;
background-color: null;
font-style: inherit;">except</span> <span class="pp" style="color: #AD0000;
background-color: null;
font-style: inherit;">Exception</span> <span class="im" style="color: #00769E;
background-color: null;
font-style: inherit;">as</span> e:</span>
<span id="cb20-6">    <span class="bu" style="color: null;
background-color: null;
font-style: inherit;">print</span>(<span class="ss" style="color: #20794D;
background-color: null;
font-style: inherit;">f"인덱스 없음: </span><span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">{</span>e<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">}</span><span class="ss" style="color: #20794D;
background-color: null;
font-style: inherit;">"</span>)</span>
<span id="cb20-7">    <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># 인덱스 생성</span></span></code></pre></div>
<p><strong>2. 벡터 차원 불일치</strong></p>
<div class="sourceCode" id="cb21" style="background: #f1f3f5;"><pre class="sourceCode numberSource python number-lines code-with-copy"><code class="sourceCode python"><span id="cb21-1"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># 해결: 임베딩 모델 차원 확인</span></span>
<span id="cb21-2">test_vector <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> embeddings.embed_query(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"테스트"</span>)</span>
<span id="cb21-3"><span class="bu" style="color: null;
background-color: null;
font-style: inherit;">print</span>(<span class="ss" style="color: #20794D;
background-color: null;
font-style: inherit;">f"임베딩 차원: </span><span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">{</span><span class="bu" style="color: null;
background-color: null;
font-style: inherit;">len</span>(test_vector)<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">}</span><span class="ss" style="color: #20794D;
background-color: null;
font-style: inherit;">"</span>)</span>
<span id="cb21-4"></span>
<span id="cb21-5"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># 인덱스 스키마의 vector_search_dimensions와 일치해야 함</span></span></code></pre></div>
<p><strong>3. 업로드 실패</strong></p>
<div class="sourceCode" id="cb22" style="background: #f1f3f5;"><pre class="sourceCode numberSource python number-lines code-with-copy"><code class="sourceCode python"><span id="cb22-1"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># 해결: 오류 확인</span></span>
<span id="cb22-2">result <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> search_client.upload_documents(documents<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span>docs)</span>
<span id="cb22-3"><span class="cf" style="color: #003B4F;
background-color: null;
font-style: inherit;">for</span> item <span class="kw" style="color: #003B4F;
background-color: null;
font-style: inherit;">in</span> result:</span>
<span id="cb22-4">    <span class="cf" style="color: #003B4F;
background-color: null;
font-style: inherit;">if</span> <span class="kw" style="color: #003B4F;
background-color: null;
font-style: inherit;">not</span> item.succeeded:</span>
<span id="cb22-5">        <span class="bu" style="color: null;
background-color: null;
font-style: inherit;">print</span>(<span class="ss" style="color: #20794D;
background-color: null;
font-style: inherit;">f"실패: </span><span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">{</span>item<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">.</span>key<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">}</span><span class="ss" style="color: #20794D;
background-color: null;
font-style: inherit;"> - </span><span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">{</span>item<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">.</span>error_message<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">}</span><span class="ss" style="color: #20794D;
background-color: null;
font-style: inherit;">"</span>)</span></code></pre></div>
</section>
</section>
<section id="비용-최적화" class="level2" data-number="14">
<h2 data-number="14" class="anchored" data-anchor-id="비용-최적화"><span class="header-section-number">14</span> 비용 최적화</h2>
<section id="인덱스-크기-줄이기" class="level3" data-number="14.1">
<h3 data-number="14.1" class="anchored" data-anchor-id="인덱스-크기-줄이기"><span class="header-section-number">14.1</span> 인덱스 크기 줄이기</h3>
<div class="sourceCode" id="cb23" style="background: #f1f3f5;"><pre class="sourceCode numberSource python number-lines code-with-copy"><code class="sourceCode python"><span id="cb23-1"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># 불필요한 필드 제거</span></span>
<span id="cb23-2"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># searchable=False로 설정하여 전체 텍스트 인덱스 비활성화</span></span>
<span id="cb23-3">SearchField(</span>
<span id="cb23-4">    name<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"metadata"</span>,</span>
<span id="cb23-5">    <span class="bu" style="color: null;
background-color: null;
font-style: inherit;">type</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span>SearchFieldDataType.String,</span>
<span id="cb23-6">    searchable<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span><span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">False</span>,  <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># 저장만 함</span></span>
<span id="cb23-7">    filterable<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span><span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">True</span></span>
<span id="cb23-8">)</span></code></pre></div>
</section>
<section id="벡터-차원-축소" class="level3" data-number="14.2">
<h3 data-number="14.2" class="anchored" data-anchor-id="벡터-차원-축소"><span class="header-section-number">14.2</span> 벡터 차원 축소</h3>
<div class="sourceCode" id="cb24" style="background: #f1f3f5;"><pre class="sourceCode numberSource python number-lines code-with-copy"><code class="sourceCode python"><span id="cb24-1"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># text-embedding-3-small: 1536 → 512</span></span>
<span id="cb24-2"><span class="im" style="color: #00769E;
background-color: null;
font-style: inherit;">from</span> openai <span class="im" style="color: #00769E;
background-color: null;
font-style: inherit;">import</span> AzureOpenAI</span>
<span id="cb24-3"></span>
<span id="cb24-4">client <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> AzureOpenAI(...)</span>
<span id="cb24-5"></span>
<span id="cb24-6">response <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> client.embeddings.create(</span>
<span id="cb24-7">    <span class="bu" style="color: null;
background-color: null;
font-style: inherit;">input</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"텍스트"</span>,</span>
<span id="cb24-8">    model<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"text-embedding-3-small"</span>,</span>
<span id="cb24-9">    dimensions<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">512</span>  <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># 1/3 크기</span></span>
<span id="cb24-10">)</span></code></pre></div>
</section>
</section>
<section id="참고-자료" class="level2" data-number="15">
<h2 data-number="15" class="anchored" data-anchor-id="참고-자료"><span class="header-section-number">15</span> 참고 자료</h2>
<section id="공식-문서" class="level3" data-number="15.1">
<h3 data-number="15.1" class="anchored" data-anchor-id="공식-문서"><span class="header-section-number">15.1</span> 공식 문서</h3>
<ul>
<li><a href="https://learn.microsoft.com/en-us/azure/search/search-what-is-azure-search">Azure AI Search 개요</a></li>
<li><a href="https://learn.microsoft.com/en-us/azure/search/vector-search-overview">벡터 검색</a></li>
<li><a href="https://learn.microsoft.com/en-us/azure/search/hybrid-search-overview">하이브리드 검색</a></li>
<li><a href="https://learn.microsoft.com/en-us/python/api/overview/azure/search-documents-readme">Python SDK</a></li>
</ul>
</section>
<section id="langchain" class="level3" data-number="15.2">
<h3 data-number="15.2" class="anchored" data-anchor-id="langchain"><span class="header-section-number">15.2</span> LangChain</h3>
<ul>
<li><a href="https://python.langchain.com/docs/integrations/vectorstores/azuresearch">AzureSearch VectorStore</a></li>
</ul>
</section>
</section>
<section id="다음-단계" class="level2" data-number="16">
<h2 data-number="16" class="anchored" data-anchor-id="다음-단계"><span class="header-section-number">16</span> 다음 단계</h2>
<p>벡터 스토어 구축이 완료되었다면, 이제 RAG 로직을 구현하자:</p>
<p>👉 <a href="../../../../../docs/blog/posts/RAG/13-Cloud-RAG/05-LangChain-to-LangGraph.html">05-LangChain-to-LangGraph.qmd</a> - LangChain에서 LangGraph로 전환</p>


</section>

 ]]></description>
  <category>AI</category>
  <category>RAG</category>
  <category>Azure</category>
  <guid>kk3225.netlify.app/docs/blog/posts/RAG/13-Cloud-RAG/04-Azure-AI-Search-Integration.html</guid>
  <pubDate>Tue, 04 Nov 2025 15:00:00 GMT</pubDate>
</item>
<item>
  <title>Azure OpenAI Embeddings</title>
  <dc:creator>Kwangmin Kim</dc:creator>
  <link>kk3225.netlify.app/docs/blog/posts/RAG/13-Cloud-RAG/03-Azure-OpenAI-Embeddings.html</link>
  <description><![CDATA[ 





<section id="azure-openai-embeddings란" class="level2" data-number="1">
<h2 data-number="1" class="anchored" data-anchor-id="azure-openai-embeddings란"><span class="header-section-number">1</span> Azure OpenAI Embeddings란?</h2>
<p>Azure OpenAI Embeddings는 텍스트를 고차원 벡터로 변환하는 서비스다. RAG 시스템에서 문서를 숫자 벡터로 표현하여 의미 기반 검색을 가능하게 한다.</p>
<p><strong>RAG 파이프라인에서의 역할:</strong> - 문서 청크 → 벡터 변환 - 사용자 질의 → 벡터 변환 - 벡터 간 유사도 계산 → 관련 문서 검색</p>
<p><strong>왜 임베딩이 필요한가?</strong> - 키워드 매칭의 한계 극복 (예: “자동차” vs “승용차”) - 의미적 유사성 계산 (코사인 유사도) - 다국어 지원 (동일 의미 공간에 매핑)</p>
</section>
<section id="azure-openai-embeddings-모델" class="level2" data-number="2">
<h2 data-number="2" class="anchored" data-anchor-id="azure-openai-embeddings-모델"><span class="header-section-number">2</span> Azure OpenAI Embeddings 모델</h2>
<p>Azure OpenAI는 3가지 주요 임베딩 모델을 제공한다:</p>
<section id="text-embedding-ada-002-레거시" class="level3" data-number="2.1">
<h3 data-number="2.1" class="anchored" data-anchor-id="text-embedding-ada-002-레거시"><span class="header-section-number">2.1</span> 1. text-embedding-ada-002 (레거시)</h3>
<p><strong>출시</strong>: 2022년 12월</p>
<p><strong>사양:</strong> - 차원: 1536 (고정) - 최대 토큰: 8,191 - 가격: $0.10 / 1M 토큰</p>
<p><strong>특징:</strong> - 범용 임베딩 모델 - 안정적이고 검증된 성능 - 신규 프로젝트는 text-embedding-3 권장</p>
</section>
<section id="text-embedding-3-small-권장" class="level3" data-number="2.2">
<h3 data-number="2.2" class="anchored" data-anchor-id="text-embedding-3-small-권장"><span class="header-section-number">2.2</span> 2. text-embedding-3-small (권장)</h3>
<p><strong>출시</strong>: 2024년 1월</p>
<p><strong>사양:</strong> - 차원: 512 또는 1536 (선택 가능) - 최대 토큰: 8,191 - 가격: $0.02 / 1M 토큰 (ada-002 대비 <strong>5배 저렴</strong>)</p>
<p><strong>특징:</strong> - 성능은 ada-002와 유사 - <strong>비용 효율적</strong> (가격 1/5) - 빠른 처리 속도</p>
<p><strong>RAG 시스템 권장</strong>: ✅ <strong>대부분의 경우 최선의 선택</strong></p>
</section>
<section id="text-embedding-3-large-고성능" class="level3" data-number="2.3">
<h3 data-number="2.3" class="anchored" data-anchor-id="text-embedding-3-large-고성능"><span class="header-section-number">2.3</span> 3. text-embedding-3-large (고성능)</h3>
<p><strong>출시</strong>: 2024년 1월</p>
<p><strong>사양:</strong> - 차원: 256 ~ 3072 (선택 가능) - 최대 토큰: 8,191 - 가격: $0.13 / 1M 토큰</p>
<p><strong>특징:</strong> - <strong>최고 성능</strong> (MTEB 벤치마크 1위권) - 다국어 지원 강화 - 복잡한 도메인에 적합</p>
<p><strong>RAG 시스템 권장</strong>: 높은 정확도가 중요한 경우</p>
</section>
<section id="모델-비교" class="level3" data-number="2.4">
<h3 data-number="2.4" class="anchored" data-anchor-id="모델-비교"><span class="header-section-number">2.4</span> 모델 비교</h3>
<table class="table">
<thead>
<tr class="header">
<th>항목</th>
<th>ada-002</th>
<th>text-embedding-3-small</th>
<th>text-embedding-3-large</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td><strong>차원</strong></td>
<td>1536</td>
<td>512/1536</td>
<td>256~3072</td>
</tr>
<tr class="even">
<td><strong>가격</strong></td>
<td>$0.10/1M</td>
<td>$0.02/1M</td>
<td>$0.13/1M</td>
</tr>
<tr class="odd">
<td><strong>성능</strong></td>
<td>기준</td>
<td>유사</td>
<td><strong>최고</strong></td>
</tr>
<tr class="even">
<td><strong>속도</strong></td>
<td>보통</td>
<td><strong>빠름</strong></td>
<td>보통</td>
</tr>
<tr class="odd">
<td><strong>권장</strong></td>
<td>레거시</td>
<td>✅ 범용</td>
<td>고정밀도 필요 시</td>
</tr>
</tbody>
</table>
</section>
</section>
<section id="azure-openai-리소스-생성" class="level2" data-number="3">
<h2 data-number="3" class="anchored" data-anchor-id="azure-openai-리소스-생성"><span class="header-section-number">3</span> Azure OpenAI 리소스 생성</h2>
<section id="azure-portal에서-생성" class="level3" data-number="3.1">
<h3 data-number="3.1" class="anchored" data-anchor-id="azure-portal에서-생성"><span class="header-section-number">3.1</span> Azure Portal에서 생성</h3>
<p><strong>1. Azure OpenAI 리소스 만들기:</strong> - <a href="https://portal.azure.com">portal.azure.com</a> → “리소스 만들기” - “Azure OpenAI” 검색 및 선택 - <strong>신청 양식 작성 필요</strong> (처음 사용 시)</p>
<p><strong>2. 기본 설정:</strong> - <strong>구독</strong>: 사용할 구독 선택 - <strong>리소스 그룹</strong>: <code>rg-rag-prod</code> - <strong>지역</strong>: East US (GPT-4 지원) 또는 Sweden Central - ⚠️ <strong>Korea Central은 현재 일부 모델 미지원</strong> - <strong>이름</strong>: <code>openai-rag-prod</code> - <strong>가격 책정 계층</strong>: Standard S0</p>
<p><strong>3. 네트워킹:</strong> - 모든 네트워크 (개발) 또는 선택된 네트워크 (프로덕션)</p>
<p><strong>4. 검토 + 만들기</strong> → 생성 완료</p>
</section>
<section id="모델-배포" class="level3" data-number="3.2">
<h3 data-number="3.2" class="anchored" data-anchor-id="모델-배포"><span class="header-section-number">3.2</span> 모델 배포</h3>
<p>Azure OpenAI에서는 리소스 생성 후 <strong>모델을 배포</strong>해야 한다.</p>
<p><strong>1. Azure OpenAI Studio 접속:</strong> - 생성된 리소스 → “Azure OpenAI Studio로 이동”</p>
<p><strong>2. 배포 만들기:</strong> - “배포” 메뉴 → “+ 배포 만들기” - <strong>모델 선택</strong>: text-embedding-3-small - <strong>배포 이름</strong>: <code>text-embedding-3-small</code> (또는 원하는 이름) - <strong>모델 버전</strong>: 최신 버전 - <strong>TPM (분당 토큰)</strong>: 120K (기본값)</p>
<p><strong>3. 엔드포인트 및 키 확인:</strong> - 리소스 → “키 및 엔드포인트” - <strong>KEY 1</strong>, <strong>엔드포인트</strong> 복사</p>
</section>
<section id="azure-cli로-생성" class="level3" data-number="3.3">
<h3 data-number="3.3" class="anchored" data-anchor-id="azure-cli로-생성"><span class="header-section-number">3.3</span> Azure CLI로 생성</h3>
<div class="sourceCode" id="cb1" style="background: #f1f3f5;"><pre class="sourceCode numberSource bash number-lines code-with-copy"><code class="sourceCode bash"><span id="cb1-1"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># Azure OpenAI 리소스 생성</span></span>
<span id="cb1-2"><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">az</span> cognitiveservices account create <span class="dt" style="color: #AD0000;
background-color: null;
font-style: inherit;">\</span></span>
<span id="cb1-3">    <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">--name</span> openai-rag-prod <span class="dt" style="color: #AD0000;
background-color: null;
font-style: inherit;">\</span></span>
<span id="cb1-4">    <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">--resource-group</span> rg-rag-prod <span class="dt" style="color: #AD0000;
background-color: null;
font-style: inherit;">\</span></span>
<span id="cb1-5">    <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">--kind</span> OpenAI <span class="dt" style="color: #AD0000;
background-color: null;
font-style: inherit;">\</span></span>
<span id="cb1-6">    <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">--sku</span> S0 <span class="dt" style="color: #AD0000;
background-color: null;
font-style: inherit;">\</span></span>
<span id="cb1-7">    <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">--location</span> eastus <span class="dt" style="color: #AD0000;
background-color: null;
font-style: inherit;">\</span></span>
<span id="cb1-8">    <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">--yes</span></span>
<span id="cb1-9"></span>
<span id="cb1-10"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># 키 및 엔드포인트 조회</span></span>
<span id="cb1-11"><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">az</span> cognitiveservices account keys list <span class="dt" style="color: #AD0000;
background-color: null;
font-style: inherit;">\</span></span>
<span id="cb1-12">    <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">--name</span> openai-rag-prod <span class="dt" style="color: #AD0000;
background-color: null;
font-style: inherit;">\</span></span>
<span id="cb1-13">    <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">--resource-group</span> rg-rag-prod</span>
<span id="cb1-14"></span>
<span id="cb1-15"><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">az</span> cognitiveservices account show <span class="dt" style="color: #AD0000;
background-color: null;
font-style: inherit;">\</span></span>
<span id="cb1-16">    <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">--name</span> openai-rag-prod <span class="dt" style="color: #AD0000;
background-color: null;
font-style: inherit;">\</span></span>
<span id="cb1-17">    <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">--resource-group</span> rg-rag-prod <span class="dt" style="color: #AD0000;
background-color: null;
font-style: inherit;">\</span></span>
<span id="cb1-18">    <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">--query</span> properties.endpoint</span></code></pre></div>
</section>
</section>
<section id="환경-설정" class="level2" data-number="4">
<h2 data-number="4" class="anchored" data-anchor-id="환경-설정"><span class="header-section-number">4</span> 환경 설정</h2>
<section id="python-sdk-설치" class="level3" data-number="4.1">
<h3 data-number="4.1" class="anchored" data-anchor-id="python-sdk-설치"><span class="header-section-number">4.1</span> Python SDK 설치</h3>
<div class="sourceCode" id="cb2" style="background: #f1f3f5;"><pre class="sourceCode numberSource bash number-lines code-with-copy"><code class="sourceCode bash"><span id="cb2-1"><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">pip</span> install openai</span>
<span id="cb2-2"><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">pip</span> install langchain-openai</span>
<span id="cb2-3"><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">pip</span> install python-dotenv</span>
<span id="cb2-4"><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">pip</span> install tiktoken  <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># 토큰 계산용</span></span></code></pre></div>
</section>
<section id="환경-변수-설정" class="level3" data-number="4.2">
<h3 data-number="4.2" class="anchored" data-anchor-id="환경-변수-설정"><span class="header-section-number">4.2</span> 환경 변수 설정</h3>
<p><code>.env</code> 파일:</p>
<pre><code>AZURE_OPENAI_ENDPOINT=https://openai-rag-prod.openai.azure.com/
AZURE_OPENAI_API_KEY=your-key-here
AZURE_OPENAI_EMBEDDING_DEPLOYMENT=text-embedding-3-small
AZURE_OPENAI_API_VERSION=2024-02-01</code></pre>
</section>
</section>
<section id="기본-사용법" class="level2" data-number="5">
<h2 data-number="5" class="anchored" data-anchor-id="기본-사용법"><span class="header-section-number">5</span> 기본 사용법</h2>
<section id="단일-텍스트-임베딩" class="level3" data-number="5.1">
<h3 data-number="5.1" class="anchored" data-anchor-id="단일-텍스트-임베딩"><span class="header-section-number">5.1</span> 단일 텍스트 임베딩</h3>
<div id="24f9a157" class="cell" data-execution_count="2">
<details class="code-fold">
<summary>코드</summary>
<div class="sourceCode cell-code" id="cb4" style="background: #f1f3f5;"><pre class="sourceCode numberSource python number-lines code-with-copy"><code class="sourceCode python"><span id="cb4-1"><span class="im" style="color: #00769E;
background-color: null;
font-style: inherit;">from</span> openai <span class="im" style="color: #00769E;
background-color: null;
font-style: inherit;">import</span> AzureOpenAI</span>
<span id="cb4-2"><span class="im" style="color: #00769E;
background-color: null;
font-style: inherit;">from</span> dotenv <span class="im" style="color: #00769E;
background-color: null;
font-style: inherit;">import</span> load_dotenv</span>
<span id="cb4-3"><span class="im" style="color: #00769E;
background-color: null;
font-style: inherit;">import</span> os</span>
<span id="cb4-4"></span>
<span id="cb4-5">load_dotenv()</span>
<span id="cb4-6"></span>
<span id="cb4-7"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># Azure OpenAI 클라이언트 생성</span></span>
<span id="cb4-8">client <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> AzureOpenAI(</span>
<span id="cb4-9">    api_key<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span>os.getenv(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"AZURE_OPENAI_API_KEY"</span>),</span>
<span id="cb4-10">    api_version<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span>os.getenv(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"AZURE_OPENAI_API_VERSION"</span>),</span>
<span id="cb4-11">    azure_endpoint<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span>os.getenv(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"AZURE_OPENAI_ENDPOINT"</span>)</span>
<span id="cb4-12">)</span>
<span id="cb4-13"></span>
<span id="cb4-14"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># 텍스트 임베딩 생성</span></span>
<span id="cb4-15">text <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Azure OpenAI는 Microsoft의 관리형 OpenAI 서비스다."</span></span>
<span id="cb4-16">response <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> client.embeddings.create(</span>
<span id="cb4-17">    <span class="bu" style="color: null;
background-color: null;
font-style: inherit;">input</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span>text,</span>
<span id="cb4-18">    model<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span>os.getenv(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"AZURE_OPENAI_EMBEDDING_DEPLOYMENT"</span>)</span>
<span id="cb4-19">)</span>
<span id="cb4-20"></span>
<span id="cb4-21"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># 임베딩 벡터 추출</span></span>
<span id="cb4-22">embedding <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> response.data[<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">0</span>].embedding</span>
<span id="cb4-23"></span>
<span id="cb4-24"><span class="bu" style="color: null;
background-color: null;
font-style: inherit;">print</span>(<span class="ss" style="color: #20794D;
background-color: null;
font-style: inherit;">f"임베딩 차원: </span><span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">{</span><span class="bu" style="color: null;
background-color: null;
font-style: inherit;">len</span>(embedding)<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">}</span><span class="ss" style="color: #20794D;
background-color: null;
font-style: inherit;">"</span>)</span>
<span id="cb4-25"><span class="bu" style="color: null;
background-color: null;
font-style: inherit;">print</span>(<span class="ss" style="color: #20794D;
background-color: null;
font-style: inherit;">f"첫 10개 값: </span><span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">{</span>embedding[:<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">10</span>]<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">}</span><span class="ss" style="color: #20794D;
background-color: null;
font-style: inherit;">"</span>)</span></code></pre></div>
</details>
</div>
</section>
<section id="배치-임베딩-생성" class="level3" data-number="5.2">
<h3 data-number="5.2" class="anchored" data-anchor-id="배치-임베딩-생성"><span class="header-section-number">5.2</span> 배치 임베딩 생성</h3>
<div id="fc1d1113" class="cell" data-execution_count="3">
<details class="code-fold">
<summary>코드</summary>
<div class="sourceCode cell-code" id="cb5" style="background: #f1f3f5;"><pre class="sourceCode numberSource python number-lines code-with-copy"><code class="sourceCode python"><span id="cb5-1"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># 여러 텍스트 동시 임베딩</span></span>
<span id="cb5-2">texts <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> [</span>
<span id="cb5-3">    <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Azure는 Microsoft의 클라우드 플랫폼이다."</span>,</span>
<span id="cb5-4">    <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"RAG는 검색 증강 생성 기술이다."</span>,</span>
<span id="cb5-5">    <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"임베딩은 텍스트를 벡터로 변환한다."</span></span>
<span id="cb5-6">]</span>
<span id="cb5-7"></span>
<span id="cb5-8">response <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> client.embeddings.create(</span>
<span id="cb5-9">    <span class="bu" style="color: null;
background-color: null;
font-style: inherit;">input</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span>texts,</span>
<span id="cb5-10">    model<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span>os.getenv(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"AZURE_OPENAI_EMBEDDING_DEPLOYMENT"</span>)</span>
<span id="cb5-11">)</span>
<span id="cb5-12"></span>
<span id="cb5-13"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># 모든 임베딩 추출</span></span>
<span id="cb5-14">embeddings <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> [data.embedding <span class="cf" style="color: #003B4F;
background-color: null;
font-style: inherit;">for</span> data <span class="kw" style="color: #003B4F;
background-color: null;
font-style: inherit;">in</span> response.data]</span>
<span id="cb5-15"></span>
<span id="cb5-16"><span class="bu" style="color: null;
background-color: null;
font-style: inherit;">print</span>(<span class="ss" style="color: #20794D;
background-color: null;
font-style: inherit;">f"생성된 임베딩 수: </span><span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">{</span><span class="bu" style="color: null;
background-color: null;
font-style: inherit;">len</span>(embeddings)<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">}</span><span class="ss" style="color: #20794D;
background-color: null;
font-style: inherit;">"</span>)</span>
<span id="cb5-17"><span class="bu" style="color: null;
background-color: null;
font-style: inherit;">print</span>(<span class="ss" style="color: #20794D;
background-color: null;
font-style: inherit;">f"각 임베딩 차원: </span><span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">{</span><span class="bu" style="color: null;
background-color: null;
font-style: inherit;">len</span>(embeddings[<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">0</span>])<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">}</span><span class="ss" style="color: #20794D;
background-color: null;
font-style: inherit;">"</span>)</span></code></pre></div>
</details>
</div>
</section>
</section>
<section id="langchain-통합" class="level2" data-number="6">
<h2 data-number="6" class="anchored" data-anchor-id="langchain-통합"><span class="header-section-number">6</span> LangChain 통합</h2>
<section id="azureopenaiembeddings-사용" class="level3" data-number="6.1">
<h3 data-number="6.1" class="anchored" data-anchor-id="azureopenaiembeddings-사용"><span class="header-section-number">6.1</span> AzureOpenAIEmbeddings 사용</h3>
<div id="96a4c734" class="cell" data-execution_count="4">
<details class="code-fold">
<summary>코드</summary>
<div class="sourceCode cell-code" id="cb6" style="background: #f1f3f5;"><pre class="sourceCode numberSource python number-lines code-with-copy"><code class="sourceCode python"><span id="cb6-1"><span class="im" style="color: #00769E;
background-color: null;
font-style: inherit;">from</span> langchain_openai <span class="im" style="color: #00769E;
background-color: null;
font-style: inherit;">import</span> AzureOpenAIEmbeddings</span>
<span id="cb6-2"></span>
<span id="cb6-3"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># LangChain 임베딩 클래스 생성</span></span>
<span id="cb6-4">embeddings <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> AzureOpenAIEmbeddings(</span>
<span id="cb6-5">    azure_deployment<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span>os.getenv(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"AZURE_OPENAI_EMBEDDING_DEPLOYMENT"</span>),</span>
<span id="cb6-6">    openai_api_version<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span>os.getenv(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"AZURE_OPENAI_API_VERSION"</span>),</span>
<span id="cb6-7">    azure_endpoint<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span>os.getenv(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"AZURE_OPENAI_ENDPOINT"</span>),</span>
<span id="cb6-8">    api_key<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span>os.getenv(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"AZURE_OPENAI_API_KEY"</span>)</span>
<span id="cb6-9">)</span>
<span id="cb6-10"></span>
<span id="cb6-11"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># 단일 텍스트 임베딩</span></span>
<span id="cb6-12">text <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"LangChain은 LLM 애플리케이션 프레임워크다."</span></span>
<span id="cb6-13">embedding <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> embeddings.embed_query(text)</span>
<span id="cb6-14"></span>
<span id="cb6-15"><span class="bu" style="color: null;
background-color: null;
font-style: inherit;">print</span>(<span class="ss" style="color: #20794D;
background-color: null;
font-style: inherit;">f"임베딩 차원: </span><span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">{</span><span class="bu" style="color: null;
background-color: null;
font-style: inherit;">len</span>(embedding)<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">}</span><span class="ss" style="color: #20794D;
background-color: null;
font-style: inherit;">"</span>)</span>
<span id="cb6-16"><span class="bu" style="color: null;
background-color: null;
font-style: inherit;">print</span>(<span class="ss" style="color: #20794D;
background-color: null;
font-style: inherit;">f"첫 5개 값: </span><span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">{</span>embedding[:<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">5</span>]<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">}</span><span class="ss" style="color: #20794D;
background-color: null;
font-style: inherit;">"</span>)</span></code></pre></div>
</details>
</div>
</section>
<section id="문서-목록-임베딩" class="level3" data-number="6.2">
<h3 data-number="6.2" class="anchored" data-anchor-id="문서-목록-임베딩"><span class="header-section-number">6.2</span> 문서 목록 임베딩</h3>
<div id="8dc75060" class="cell" data-execution_count="5">
<details class="code-fold">
<summary>코드</summary>
<div class="sourceCode cell-code" id="cb7" style="background: #f1f3f5;"><pre class="sourceCode numberSource python number-lines code-with-copy"><code class="sourceCode python"><span id="cb7-1"><span class="im" style="color: #00769E;
background-color: null;
font-style: inherit;">from</span> langchain_core.documents <span class="im" style="color: #00769E;
background-color: null;
font-style: inherit;">import</span> Document</span>
<span id="cb7-2"></span>
<span id="cb7-3"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># 문서 목록 생성</span></span>
<span id="cb7-4">documents <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> [</span>
<span id="cb7-5">    Document(page_content<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Azure AI Search는 벡터 데이터베이스다."</span>, metadata<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span>{<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"source"</span>: <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"doc1"</span>}),</span>
<span id="cb7-6">    Document(page_content<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Document Intelligence는 OCR 서비스다."</span>, metadata<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span>{<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"source"</span>: <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"doc2"</span>}),</span>
<span id="cb7-7">    Document(page_content<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Blob Storage는 파일 저장소다."</span>, metadata<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span>{<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"source"</span>: <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"doc3"</span>})</span>
<span id="cb7-8">]</span>
<span id="cb7-9"></span>
<span id="cb7-10"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># 문서 텍스트만 추출하여 임베딩</span></span>
<span id="cb7-11">texts <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> [doc.page_content <span class="cf" style="color: #003B4F;
background-color: null;
font-style: inherit;">for</span> doc <span class="kw" style="color: #003B4F;
background-color: null;
font-style: inherit;">in</span> documents]</span>
<span id="cb7-12">doc_embeddings <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> embeddings.embed_documents(texts)</span>
<span id="cb7-13"></span>
<span id="cb7-14"><span class="bu" style="color: null;
background-color: null;
font-style: inherit;">print</span>(<span class="ss" style="color: #20794D;
background-color: null;
font-style: inherit;">f"임베딩된 문서 수: </span><span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">{</span><span class="bu" style="color: null;
background-color: null;
font-style: inherit;">len</span>(doc_embeddings)<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">}</span><span class="ss" style="color: #20794D;
background-color: null;
font-style: inherit;">"</span>)</span>
<span id="cb7-15"><span class="bu" style="color: null;
background-color: null;
font-style: inherit;">print</span>(<span class="ss" style="color: #20794D;
background-color: null;
font-style: inherit;">f"첫 번째 문서 임베딩 차원: </span><span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">{</span><span class="bu" style="color: null;
background-color: null;
font-style: inherit;">len</span>(doc_embeddings[<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">0</span>])<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">}</span><span class="ss" style="color: #20794D;
background-color: null;
font-style: inherit;">"</span>)</span></code></pre></div>
</details>
</div>
</section>
</section>
<section id="문서-청크-임베딩" class="level2" data-number="7">
<h2 data-number="7" class="anchored" data-anchor-id="문서-청크-임베딩"><span class="header-section-number">7</span> 문서 청크 임베딩</h2>
<p>RAG 시스템에서는 문서를 청크로 분할한 후 각 청크를 임베딩한다.</p>
<section id="전체-파이프라인" class="level3" data-number="7.1">
<h3 data-number="7.1" class="anchored" data-anchor-id="전체-파이프라인"><span class="header-section-number">7.1</span> 전체 파이프라인</h3>
<div id="5165d66b" class="cell" data-execution_count="6">
<details class="code-fold">
<summary>코드</summary>
<div class="sourceCode cell-code" id="cb8" style="background: #f1f3f5;"><pre class="sourceCode numberSource python number-lines code-with-copy"><code class="sourceCode python"><span id="cb8-1"><span class="im" style="color: #00769E;
background-color: null;
font-style: inherit;">from</span> langchain.text_splitter <span class="im" style="color: #00769E;
background-color: null;
font-style: inherit;">import</span> RecursiveCharacterTextSplitter</span>
<span id="cb8-2"><span class="im" style="color: #00769E;
background-color: null;
font-style: inherit;">from</span> langchain_community.document_loaders <span class="im" style="color: #00769E;
background-color: null;
font-style: inherit;">import</span> TextLoader</span>
<span id="cb8-3"></span>
<span id="cb8-4"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># 1. 문서 로딩</span></span>
<span id="cb8-5">loader <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> TextLoader(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"sample_document.txt"</span>, encoding<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"utf-8"</span>)</span>
<span id="cb8-6">documents <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> loader.load()</span>
<span id="cb8-7"></span>
<span id="cb8-8"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># 2. 텍스트 분할</span></span>
<span id="cb8-9">text_splitter <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> RecursiveCharacterTextSplitter(</span>
<span id="cb8-10">    chunk_size<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1000</span>,</span>
<span id="cb8-11">    chunk_overlap<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">200</span>,</span>
<span id="cb8-12">    length_function<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span><span class="bu" style="color: null;
background-color: null;
font-style: inherit;">len</span>,</span>
<span id="cb8-13">    separators<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span>[<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"</span><span class="ch" style="color: #20794D;
background-color: null;
font-style: inherit;">\n\n</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"</span>, <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"</span><span class="ch" style="color: #20794D;
background-color: null;
font-style: inherit;">\n</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"</span>, <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">" "</span>, <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">""</span>]</span>
<span id="cb8-14">)</span>
<span id="cb8-15">chunks <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> text_splitter.split_documents(documents)</span>
<span id="cb8-16"></span>
<span id="cb8-17"><span class="bu" style="color: null;
background-color: null;
font-style: inherit;">print</span>(<span class="ss" style="color: #20794D;
background-color: null;
font-style: inherit;">f"생성된 청크 수: </span><span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">{</span><span class="bu" style="color: null;
background-color: null;
font-style: inherit;">len</span>(chunks)<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">}</span><span class="ss" style="color: #20794D;
background-color: null;
font-style: inherit;">"</span>)</span>
<span id="cb8-18"></span>
<span id="cb8-19"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># 3. 각 청크 임베딩</span></span>
<span id="cb8-20">chunk_texts <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> [chunk.page_content <span class="cf" style="color: #003B4F;
background-color: null;
font-style: inherit;">for</span> chunk <span class="kw" style="color: #003B4F;
background-color: null;
font-style: inherit;">in</span> chunks]</span>
<span id="cb8-21">chunk_embeddings <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> embeddings.embed_documents(chunk_texts)</span>
<span id="cb8-22"></span>
<span id="cb8-23"><span class="bu" style="color: null;
background-color: null;
font-style: inherit;">print</span>(<span class="ss" style="color: #20794D;
background-color: null;
font-style: inherit;">f"임베딩 완료: </span><span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">{</span><span class="bu" style="color: null;
background-color: null;
font-style: inherit;">len</span>(chunk_embeddings)<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">}</span><span class="ss" style="color: #20794D;
background-color: null;
font-style: inherit;">개 청크"</span>)</span></code></pre></div>
</details>
</div>
</section>
<section id="메타데이터와-함께-저장" class="level3" data-number="7.2">
<h3 data-number="7.2" class="anchored" data-anchor-id="메타데이터와-함께-저장"><span class="header-section-number">7.2</span> 메타데이터와 함께 저장</h3>
<div id="590b403d" class="cell" data-execution_count="7">
<details class="code-fold">
<summary>코드</summary>
<div class="sourceCode cell-code" id="cb9" style="background: #f1f3f5;"><pre class="sourceCode numberSource python number-lines code-with-copy"><code class="sourceCode python"><span id="cb9-1"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># 임베딩과 메타데이터를 함께 저장</span></span>
<span id="cb9-2">embedded_chunks <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> []</span>
<span id="cb9-3"><span class="cf" style="color: #003B4F;
background-color: null;
font-style: inherit;">for</span> chunk, embedding <span class="kw" style="color: #003B4F;
background-color: null;
font-style: inherit;">in</span> <span class="bu" style="color: null;
background-color: null;
font-style: inherit;">zip</span>(chunks, chunk_embeddings):</span>
<span id="cb9-4">    embedded_chunks.append({</span>
<span id="cb9-5">        <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"text"</span>: chunk.page_content,</span>
<span id="cb9-6">        <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"embedding"</span>: embedding,</span>
<span id="cb9-7">        <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"metadata"</span>: {</span>
<span id="cb9-8">            <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">**</span>chunk.metadata,</span>
<span id="cb9-9">            <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"chunk_size"</span>: <span class="bu" style="color: null;
background-color: null;
font-style: inherit;">len</span>(chunk.page_content),</span>
<span id="cb9-10">            <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"embedding_model"</span>: <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"text-embedding-3-small"</span></span>
<span id="cb9-11">        }</span>
<span id="cb9-12">    })</span>
<span id="cb9-13"></span>
<span id="cb9-14"><span class="bu" style="color: null;
background-color: null;
font-style: inherit;">print</span>(<span class="ss" style="color: #20794D;
background-color: null;
font-style: inherit;">f"첫 번째 청크 메타데이터: </span><span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">{</span>embedded_chunks[<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">0</span>][<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">'metadata'</span>]<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">}</span><span class="ss" style="color: #20794D;
background-color: null;
font-style: inherit;">"</span>)</span></code></pre></div>
</details>
</div>
</section>
</section>
<section id="유사도-계산" class="level2" data-number="8">
<h2 data-number="8" class="anchored" data-anchor-id="유사도-계산"><span class="header-section-number">8</span> 유사도 계산</h2>
<section id="코사인-유사도" class="level3" data-number="8.1">
<h3 data-number="8.1" class="anchored" data-anchor-id="코사인-유사도"><span class="header-section-number">8.1</span> 코사인 유사도</h3>
<div id="24c64b14" class="cell" data-execution_count="8">
<details class="code-fold">
<summary>코드</summary>
<div class="sourceCode cell-code" id="cb10" style="background: #f1f3f5;"><pre class="sourceCode numberSource python number-lines code-with-copy"><code class="sourceCode python"><span id="cb10-1"><span class="im" style="color: #00769E;
background-color: null;
font-style: inherit;">import</span> numpy <span class="im" style="color: #00769E;
background-color: null;
font-style: inherit;">as</span> np</span>
<span id="cb10-2"></span>
<span id="cb10-3"><span class="kw" style="color: #003B4F;
background-color: null;
font-style: inherit;">def</span> cosine_similarity(vec1, vec2):</span>
<span id="cb10-4">    <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">"""두 벡터 간 코사인 유사도 계산"""</span></span>
<span id="cb10-5">    <span class="cf" style="color: #003B4F;
background-color: null;
font-style: inherit;">return</span> np.dot(vec1, vec2) <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">/</span> (np.linalg.norm(vec1) <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">*</span> np.linalg.norm(vec2))</span>
<span id="cb10-6"></span>
<span id="cb10-7"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># 예시: 질의와 문서 유사도 계산</span></span>
<span id="cb10-8">query <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Azure의 AI 서비스는 무엇인가?"</span></span>
<span id="cb10-9">doc1 <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Azure AI Search는 검색 서비스다."</span></span>
<span id="cb10-10">doc2 <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Blob Storage는 파일 저장소다."</span></span>
<span id="cb10-11"></span>
<span id="cb10-12"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># 임베딩 생성</span></span>
<span id="cb10-13">query_embedding <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> embeddings.embed_query(query)</span>
<span id="cb10-14">doc1_embedding <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> embeddings.embed_query(doc1)</span>
<span id="cb10-15">doc2_embedding <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> embeddings.embed_query(doc2)</span>
<span id="cb10-16"></span>
<span id="cb10-17"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># 유사도 계산</span></span>
<span id="cb10-18">similarity1 <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> cosine_similarity(query_embedding, doc1_embedding)</span>
<span id="cb10-19">similarity2 <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> cosine_similarity(query_embedding, doc2_embedding)</span>
<span id="cb10-20"></span>
<span id="cb10-21"><span class="bu" style="color: null;
background-color: null;
font-style: inherit;">print</span>(<span class="ss" style="color: #20794D;
background-color: null;
font-style: inherit;">f"질의 vs 문서1 유사도: </span><span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">{</span>similarity1<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">:.4f}</span><span class="ss" style="color: #20794D;
background-color: null;
font-style: inherit;">"</span>)</span>
<span id="cb10-22"><span class="bu" style="color: null;
background-color: null;
font-style: inherit;">print</span>(<span class="ss" style="color: #20794D;
background-color: null;
font-style: inherit;">f"질의 vs 문서2 유사도: </span><span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">{</span>similarity2<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">:.4f}</span><span class="ss" style="color: #20794D;
background-color: null;
font-style: inherit;">"</span>)</span></code></pre></div>
</details>
</div>
</section>
<section id="가장-유사한-문서-찾기" class="level3" data-number="8.2">
<h3 data-number="8.2" class="anchored" data-anchor-id="가장-유사한-문서-찾기"><span class="header-section-number">8.2</span> 가장 유사한 문서 찾기</h3>
<div id="9e390912" class="cell" data-execution_count="9">
<details class="code-fold">
<summary>코드</summary>
<div class="sourceCode cell-code" id="cb11" style="background: #f1f3f5;"><pre class="sourceCode numberSource python number-lines code-with-copy"><code class="sourceCode python"><span id="cb11-1"><span class="kw" style="color: #003B4F;
background-color: null;
font-style: inherit;">def</span> find_most_similar(query_embedding, doc_embeddings, top_k<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">3</span>):</span>
<span id="cb11-2">    <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">"""가장 유사한 문서 찾기"""</span></span>
<span id="cb11-3">    similarities <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> []</span>
<span id="cb11-4">    <span class="cf" style="color: #003B4F;
background-color: null;
font-style: inherit;">for</span> idx, doc_emb <span class="kw" style="color: #003B4F;
background-color: null;
font-style: inherit;">in</span> <span class="bu" style="color: null;
background-color: null;
font-style: inherit;">enumerate</span>(doc_embeddings):</span>
<span id="cb11-5">        sim <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> cosine_similarity(query_embedding, doc_emb)</span>
<span id="cb11-6">        similarities.append((idx, sim))</span>
<span id="cb11-7">    </span>
<span id="cb11-8">    <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># 유사도 높은 순으로 정렬</span></span>
<span id="cb11-9">    similarities.sort(key<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span><span class="kw" style="color: #003B4F;
background-color: null;
font-style: inherit;">lambda</span> x: x[<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span>], reverse<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span><span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">True</span>)</span>
<span id="cb11-10">    <span class="cf" style="color: #003B4F;
background-color: null;
font-style: inherit;">return</span> similarities[:top_k]</span>
<span id="cb11-11"></span>
<span id="cb11-12"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># 사용 예시</span></span>
<span id="cb11-13">query <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"RAG 시스템 구축 방법"</span></span>
<span id="cb11-14">query_emb <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> embeddings.embed_query(query)</span>
<span id="cb11-15"></span>
<span id="cb11-16"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># 상위 3개 유사 문서 찾기</span></span>
<span id="cb11-17">top_docs <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> find_most_similar(query_emb, chunk_embeddings, top_k<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">3</span>)</span>
<span id="cb11-18"></span>
<span id="cb11-19"><span class="bu" style="color: null;
background-color: null;
font-style: inherit;">print</span>(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"가장 유사한 문서:"</span>)</span>
<span id="cb11-20"><span class="cf" style="color: #003B4F;
background-color: null;
font-style: inherit;">for</span> idx, similarity <span class="kw" style="color: #003B4F;
background-color: null;
font-style: inherit;">in</span> top_docs:</span>
<span id="cb11-21">    <span class="bu" style="color: null;
background-color: null;
font-style: inherit;">print</span>(<span class="ss" style="color: #20794D;
background-color: null;
font-style: inherit;">f"청크 </span><span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">{</span>idx<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">}</span><span class="ss" style="color: #20794D;
background-color: null;
font-style: inherit;">: </span><span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">{</span>similarity<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">:.4f}</span><span class="ss" style="color: #20794D;
background-color: null;
font-style: inherit;">"</span>)</span>
<span id="cb11-22">    <span class="bu" style="color: null;
background-color: null;
font-style: inherit;">print</span>(<span class="ss" style="color: #20794D;
background-color: null;
font-style: inherit;">f"내용: </span><span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">{</span>chunks[idx]<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">.</span>page_content[:<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">100</span>]<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">}</span><span class="ss" style="color: #20794D;
background-color: null;
font-style: inherit;">...</span><span class="ch" style="color: #20794D;
background-color: null;
font-style: inherit;">\n</span><span class="ss" style="color: #20794D;
background-color: null;
font-style: inherit;">"</span>)</span></code></pre></div>
</details>
</div>
</section>
</section>
<section id="차원-축소-matryoshka-embeddings" class="level2" data-number="9">
<h2 data-number="9" class="anchored" data-anchor-id="차원-축소-matryoshka-embeddings"><span class="header-section-number">9</span> 차원 축소 (Matryoshka Embeddings)</h2>
<p>text-embedding-3 모델은 차원 축소를 지원한다.</p>
<section id="축소-차원으로-임베딩-생성" class="level3" data-number="9.1">
<h3 data-number="9.1" class="anchored" data-anchor-id="축소-차원으로-임베딩-생성"><span class="header-section-number">9.1</span> 축소 차원으로 임베딩 생성</h3>
<div id="58299aff" class="cell" data-execution_count="10">
<details class="code-fold">
<summary>코드</summary>
<div class="sourceCode cell-code" id="cb12" style="background: #f1f3f5;"><pre class="sourceCode numberSource python number-lines code-with-copy"><code class="sourceCode python"><span id="cb12-1"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># 512 차원으로 축소 (기본 1536)</span></span>
<span id="cb12-2">response <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> client.embeddings.create(</span>
<span id="cb12-3">    <span class="bu" style="color: null;
background-color: null;
font-style: inherit;">input</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Azure OpenAI 임베딩 테스트"</span>,</span>
<span id="cb12-4">    model<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"text-embedding-3-small"</span>,</span>
<span id="cb12-5">    dimensions<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">512</span>  <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># 1536 → 512</span></span>
<span id="cb12-6">)</span>
<span id="cb12-7"></span>
<span id="cb12-8">embedding_512 <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> response.data[<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">0</span>].embedding</span>
<span id="cb12-9"><span class="bu" style="color: null;
background-color: null;
font-style: inherit;">print</span>(<span class="ss" style="color: #20794D;
background-color: null;
font-style: inherit;">f"축소된 차원: </span><span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">{</span><span class="bu" style="color: null;
background-color: null;
font-style: inherit;">len</span>(embedding_512)<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">}</span><span class="ss" style="color: #20794D;
background-color: null;
font-style: inherit;">"</span>)</span></code></pre></div>
</details>
</div>
</section>
<section id="차원-축소-후-유사도-비교" class="level3" data-number="9.2">
<h3 data-number="9.2" class="anchored" data-anchor-id="차원-축소-후-유사도-비교"><span class="header-section-number">9.2</span> 차원 축소 후 유사도 비교</h3>
<div id="f4d215db" class="cell" data-execution_count="11">
<details class="code-fold">
<summary>코드</summary>
<div class="sourceCode cell-code" id="cb13" style="background: #f1f3f5;"><pre class="sourceCode numberSource python number-lines code-with-copy"><code class="sourceCode python"><span id="cb13-1"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># 전체 차원 (1536) vs 축소 차원 (512) 비교</span></span>
<span id="cb13-2">text1 <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Azure는 클라우드 플랫폼이다."</span></span>
<span id="cb13-3">text2 <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Microsoft의 클라우드 서비스다."</span></span>
<span id="cb13-4">text3 <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Python은 프로그래밍 언어다."</span></span>
<span id="cb13-5"></span>
<span id="cb13-6"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># 1536 차원</span></span>
<span id="cb13-7">resp_full <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> client.embeddings.create(</span>
<span id="cb13-8">    <span class="bu" style="color: null;
background-color: null;
font-style: inherit;">input</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span>[text1, text2, text3],</span>
<span id="cb13-9">    model<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"text-embedding-3-small"</span></span>
<span id="cb13-10">)</span>
<span id="cb13-11">emb_full <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> [d.embedding <span class="cf" style="color: #003B4F;
background-color: null;
font-style: inherit;">for</span> d <span class="kw" style="color: #003B4F;
background-color: null;
font-style: inherit;">in</span> resp_full.data]</span>
<span id="cb13-12"></span>
<span id="cb13-13"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># 512 차원</span></span>
<span id="cb13-14">resp_reduced <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> client.embeddings.create(</span>
<span id="cb13-15">    <span class="bu" style="color: null;
background-color: null;
font-style: inherit;">input</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span>[text1, text2, text3],</span>
<span id="cb13-16">    model<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"text-embedding-3-small"</span>,</span>
<span id="cb13-17">    dimensions<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">512</span></span>
<span id="cb13-18">)</span>
<span id="cb13-19">emb_reduced <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> [d.embedding <span class="cf" style="color: #003B4F;
background-color: null;
font-style: inherit;">for</span> d <span class="kw" style="color: #003B4F;
background-color: null;
font-style: inherit;">in</span> resp_reduced.data]</span>
<span id="cb13-20"></span>
<span id="cb13-21"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># 유사도 비교</span></span>
<span id="cb13-22">sim_full_12 <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> cosine_similarity(emb_full[<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">0</span>], emb_full[<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span>])</span>
<span id="cb13-23">sim_reduced_12 <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> cosine_similarity(emb_reduced[<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">0</span>], emb_reduced[<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span>])</span>
<span id="cb13-24"></span>
<span id="cb13-25"><span class="bu" style="color: null;
background-color: null;
font-style: inherit;">print</span>(<span class="ss" style="color: #20794D;
background-color: null;
font-style: inherit;">f"1536 차원: text1-text2 유사도 = </span><span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">{</span>sim_full_12<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">:.4f}</span><span class="ss" style="color: #20794D;
background-color: null;
font-style: inherit;">"</span>)</span>
<span id="cb13-26"><span class="bu" style="color: null;
background-color: null;
font-style: inherit;">print</span>(<span class="ss" style="color: #20794D;
background-color: null;
font-style: inherit;">f"512 차원: text1-text2 유사도 = </span><span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">{</span>sim_reduced_12<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">:.4f}</span><span class="ss" style="color: #20794D;
background-color: null;
font-style: inherit;">"</span>)</span>
<span id="cb13-27"><span class="bu" style="color: null;
background-color: null;
font-style: inherit;">print</span>(<span class="ss" style="color: #20794D;
background-color: null;
font-style: inherit;">f"차이: </span><span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">{</span><span class="bu" style="color: null;
background-color: null;
font-style: inherit;">abs</span>(sim_full_12 <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">-</span> sim_reduced_12)<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">:.4f}</span><span class="ss" style="color: #20794D;
background-color: null;
font-style: inherit;">"</span>)</span></code></pre></div>
</details>
</div>
<p><strong>차원 축소 장점:</strong> - 저장 공간 절약 (512 차원: 1/3 크기) - 빠른 검색 속도 - 유사도 정확도 약간 감소 (보통 5% 이내)</p>
</section>
</section>
<section id="배치-처리-최적화" class="level2" data-number="10">
<h2 data-number="10" class="anchored" data-anchor-id="배치-처리-최적화"><span class="header-section-number">10</span> 배치 처리 최적화</h2>
<section id="대량-문서-임베딩" class="level3" data-number="10.1">
<h3 data-number="10.1" class="anchored" data-anchor-id="대량-문서-임베딩"><span class="header-section-number">10.1</span> 대량 문서 임베딩</h3>
<div id="e43d1ba7" class="cell" data-execution_count="12">
<details class="code-fold">
<summary>코드</summary>
<div class="sourceCode cell-code" id="cb14" style="background: #f1f3f5;"><pre class="sourceCode numberSource python number-lines code-with-copy"><code class="sourceCode python"><span id="cb14-1"><span class="kw" style="color: #003B4F;
background-color: null;
font-style: inherit;">def</span> embed_documents_batch(texts, batch_size<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">100</span>):</span>
<span id="cb14-2">    <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">"""배치 단위로 대량 문서 임베딩"""</span></span>
<span id="cb14-3">    all_embeddings <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> []</span>
<span id="cb14-4">    </span>
<span id="cb14-5">    <span class="cf" style="color: #003B4F;
background-color: null;
font-style: inherit;">for</span> i <span class="kw" style="color: #003B4F;
background-color: null;
font-style: inherit;">in</span> <span class="bu" style="color: null;
background-color: null;
font-style: inherit;">range</span>(<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">0</span>, <span class="bu" style="color: null;
background-color: null;
font-style: inherit;">len</span>(texts), batch_size):</span>
<span id="cb14-6">        batch <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> texts[i:i<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span>batch_size]</span>
<span id="cb14-7">        <span class="bu" style="color: null;
background-color: null;
font-style: inherit;">print</span>(<span class="ss" style="color: #20794D;
background-color: null;
font-style: inherit;">f"배치 </span><span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">{</span>i<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">//</span>batch_size <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span><span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">}</span><span class="ss" style="color: #20794D;
background-color: null;
font-style: inherit;">/</span><span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">{</span>(<span class="bu" style="color: null;
background-color: null;
font-style: inherit;">len</span>(texts)<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">-</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span>)<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">//</span>batch_size <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span><span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">}</span><span class="ss" style="color: #20794D;
background-color: null;
font-style: inherit;"> 처리 중..."</span>)</span>
<span id="cb14-8">        </span>
<span id="cb14-9">        <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># 배치 임베딩</span></span>
<span id="cb14-10">        batch_embeddings <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> embeddings.embed_documents(batch)</span>
<span id="cb14-11">        all_embeddings.extend(batch_embeddings)</span>
<span id="cb14-12">    </span>
<span id="cb14-13">    <span class="cf" style="color: #003B4F;
background-color: null;
font-style: inherit;">return</span> all_embeddings</span>
<span id="cb14-14"></span>
<span id="cb14-15"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># 사용 예시 (1000개 문서)</span></span>
<span id="cb14-16"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># large_texts = [f"문서 {i} 내용..." for i in range(1000)]</span></span>
<span id="cb14-17"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># embeddings_result = embed_documents_batch(large_texts, batch_size=100)</span></span></code></pre></div>
</details>
</div>
</section>
<section id="병렬-처리" class="level3" data-number="10.2">
<h3 data-number="10.2" class="anchored" data-anchor-id="병렬-처리"><span class="header-section-number">10.2</span> 병렬 처리</h3>
<div id="5117d808" class="cell" data-execution_count="13">
<details class="code-fold">
<summary>코드</summary>
<div class="sourceCode cell-code" id="cb15" style="background: #f1f3f5;"><pre class="sourceCode numberSource python number-lines code-with-copy"><code class="sourceCode python"><span id="cb15-1"><span class="im" style="color: #00769E;
background-color: null;
font-style: inherit;">from</span> concurrent.futures <span class="im" style="color: #00769E;
background-color: null;
font-style: inherit;">import</span> ThreadPoolExecutor</span>
<span id="cb15-2"><span class="im" style="color: #00769E;
background-color: null;
font-style: inherit;">import</span> time</span>
<span id="cb15-3"></span>
<span id="cb15-4"><span class="kw" style="color: #003B4F;
background-color: null;
font-style: inherit;">def</span> embed_chunk(texts_chunk):</span>
<span id="cb15-5">    <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">"""청크 단위 임베딩 (병렬 실행용)"""</span></span>
<span id="cb15-6">    <span class="cf" style="color: #003B4F;
background-color: null;
font-style: inherit;">return</span> embeddings.embed_documents(texts_chunk)</span>
<span id="cb15-7"></span>
<span id="cb15-8"><span class="kw" style="color: #003B4F;
background-color: null;
font-style: inherit;">def</span> embed_parallel(texts, num_workers<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">4</span>, chunk_size<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">25</span>):</span>
<span id="cb15-9">    <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">"""병렬로 임베딩 생성"""</span></span>
<span id="cb15-10">    <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># 청크로 분할</span></span>
<span id="cb15-11">    chunks <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> [texts[i:i<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span>chunk_size] <span class="cf" style="color: #003B4F;
background-color: null;
font-style: inherit;">for</span> i <span class="kw" style="color: #003B4F;
background-color: null;
font-style: inherit;">in</span> <span class="bu" style="color: null;
background-color: null;
font-style: inherit;">range</span>(<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">0</span>, <span class="bu" style="color: null;
background-color: null;
font-style: inherit;">len</span>(texts), chunk_size)]</span>
<span id="cb15-12">    </span>
<span id="cb15-13">    <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># 병렬 실행</span></span>
<span id="cb15-14">    start_time <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> time.time()</span>
<span id="cb15-15">    <span class="cf" style="color: #003B4F;
background-color: null;
font-style: inherit;">with</span> ThreadPoolExecutor(max_workers<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span>num_workers) <span class="im" style="color: #00769E;
background-color: null;
font-style: inherit;">as</span> executor:</span>
<span id="cb15-16">        results <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> <span class="bu" style="color: null;
background-color: null;
font-style: inherit;">list</span>(executor.<span class="bu" style="color: null;
background-color: null;
font-style: inherit;">map</span>(embed_chunk, chunks))</span>
<span id="cb15-17">    </span>
<span id="cb15-18">    <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># 결과 병합</span></span>
<span id="cb15-19">    all_embeddings <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> [emb <span class="cf" style="color: #003B4F;
background-color: null;
font-style: inherit;">for</span> chunk_result <span class="kw" style="color: #003B4F;
background-color: null;
font-style: inherit;">in</span> results <span class="cf" style="color: #003B4F;
background-color: null;
font-style: inherit;">for</span> emb <span class="kw" style="color: #003B4F;
background-color: null;
font-style: inherit;">in</span> chunk_result]</span>
<span id="cb15-20">    </span>
<span id="cb15-21">    duration <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> time.time() <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">-</span> start_time</span>
<span id="cb15-22">    <span class="bu" style="color: null;
background-color: null;
font-style: inherit;">print</span>(<span class="ss" style="color: #20794D;
background-color: null;
font-style: inherit;">f"병렬 처리 완료: </span><span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">{</span><span class="bu" style="color: null;
background-color: null;
font-style: inherit;">len</span>(all_embeddings)<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">}</span><span class="ss" style="color: #20794D;
background-color: null;
font-style: inherit;">개 임베딩, </span><span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">{</span>duration<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">:.2f}</span><span class="ss" style="color: #20794D;
background-color: null;
font-style: inherit;">초"</span>)</span>
<span id="cb15-23">    </span>
<span id="cb15-24">    <span class="cf" style="color: #003B4F;
background-color: null;
font-style: inherit;">return</span> all_embeddings</span>
<span id="cb15-25"></span>
<span id="cb15-26"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># 사용 예시</span></span>
<span id="cb15-27"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># texts_sample = [f"샘플 텍스트 {i}" for i in range(100)]</span></span>
<span id="cb15-28"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># parallel_embeddings = embed_parallel(texts_sample, num_workers=4, chunk_size=25)</span></span></code></pre></div>
</details>
</div>
</section>
</section>
<section id="캐싱-전략" class="level2" data-number="11">
<h2 data-number="11" class="anchored" data-anchor-id="캐싱-전략"><span class="header-section-number">11</span> 캐싱 전략</h2>
<p>동일한 텍스트는 재계산하지 않도록 캐싱한다.</p>
<section id="간단한-캐싱" class="level3" data-number="11.1">
<h3 data-number="11.1" class="anchored" data-anchor-id="간단한-캐싱"><span class="header-section-number">11.1</span> 간단한 캐싱</h3>
<div id="80d608e9" class="cell" data-execution_count="14">
<details class="code-fold">
<summary>코드</summary>
<div class="sourceCode cell-code" id="cb16" style="background: #f1f3f5;"><pre class="sourceCode numberSource python number-lines code-with-copy"><code class="sourceCode python"><span id="cb16-1"><span class="im" style="color: #00769E;
background-color: null;
font-style: inherit;">import</span> hashlib</span>
<span id="cb16-2"><span class="im" style="color: #00769E;
background-color: null;
font-style: inherit;">import</span> json</span>
<span id="cb16-3"></span>
<span id="cb16-4"><span class="kw" style="color: #003B4F;
background-color: null;
font-style: inherit;">class</span> EmbeddingCache:</span>
<span id="cb16-5">    <span class="kw" style="color: #003B4F;
background-color: null;
font-style: inherit;">def</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">__init__</span>(<span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">self</span>, cache_file<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">".embedding_cache.json"</span>):</span>
<span id="cb16-6">        <span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">self</span>.cache_file <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> cache_file</span>
<span id="cb16-7">        <span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">self</span>.cache <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> <span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">self</span>._load_cache()</span>
<span id="cb16-8">    </span>
<span id="cb16-9">    <span class="kw" style="color: #003B4F;
background-color: null;
font-style: inherit;">def</span> _load_cache(<span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">self</span>):</span>
<span id="cb16-10">        <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">"""캐시 파일 로드"""</span></span>
<span id="cb16-11">        <span class="cf" style="color: #003B4F;
background-color: null;
font-style: inherit;">try</span>:</span>
<span id="cb16-12">            <span class="cf" style="color: #003B4F;
background-color: null;
font-style: inherit;">with</span> <span class="bu" style="color: null;
background-color: null;
font-style: inherit;">open</span>(<span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">self</span>.cache_file, <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"r"</span>) <span class="im" style="color: #00769E;
background-color: null;
font-style: inherit;">as</span> f:</span>
<span id="cb16-13">                <span class="cf" style="color: #003B4F;
background-color: null;
font-style: inherit;">return</span> json.load(f)</span>
<span id="cb16-14">        <span class="cf" style="color: #003B4F;
background-color: null;
font-style: inherit;">except</span> <span class="pp" style="color: #AD0000;
background-color: null;
font-style: inherit;">FileNotFoundError</span>:</span>
<span id="cb16-15">            <span class="cf" style="color: #003B4F;
background-color: null;
font-style: inherit;">return</span> {}</span>
<span id="cb16-16">    </span>
<span id="cb16-17">    <span class="kw" style="color: #003B4F;
background-color: null;
font-style: inherit;">def</span> _save_cache(<span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">self</span>):</span>
<span id="cb16-18">        <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">"""캐시 파일 저장"""</span></span>
<span id="cb16-19">        <span class="cf" style="color: #003B4F;
background-color: null;
font-style: inherit;">with</span> <span class="bu" style="color: null;
background-color: null;
font-style: inherit;">open</span>(<span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">self</span>.cache_file, <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"w"</span>) <span class="im" style="color: #00769E;
background-color: null;
font-style: inherit;">as</span> f:</span>
<span id="cb16-20">            json.dump(<span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">self</span>.cache, f)</span>
<span id="cb16-21">    </span>
<span id="cb16-22">    <span class="kw" style="color: #003B4F;
background-color: null;
font-style: inherit;">def</span> _get_hash(<span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">self</span>, text):</span>
<span id="cb16-23">        <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">"""텍스트 해시 생성"""</span></span>
<span id="cb16-24">        <span class="cf" style="color: #003B4F;
background-color: null;
font-style: inherit;">return</span> hashlib.md5(text.encode()).hexdigest()</span>
<span id="cb16-25">    </span>
<span id="cb16-26">    <span class="kw" style="color: #003B4F;
background-color: null;
font-style: inherit;">def</span> get_embedding(<span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">self</span>, text, embeddings_func):</span>
<span id="cb16-27">        <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">"""캐시된 임베딩 반환 또는 생성"""</span></span>
<span id="cb16-28">        text_hash <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> <span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">self</span>._get_hash(text)</span>
<span id="cb16-29">        </span>
<span id="cb16-30">        <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># 캐시 확인</span></span>
<span id="cb16-31">        <span class="cf" style="color: #003B4F;
background-color: null;
font-style: inherit;">if</span> text_hash <span class="kw" style="color: #003B4F;
background-color: null;
font-style: inherit;">in</span> <span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">self</span>.cache:</span>
<span id="cb16-32">            <span class="bu" style="color: null;
background-color: null;
font-style: inherit;">print</span>(<span class="ss" style="color: #20794D;
background-color: null;
font-style: inherit;">f"캐시 히트: </span><span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">{</span>text[:<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">50</span>]<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">}</span><span class="ss" style="color: #20794D;
background-color: null;
font-style: inherit;">..."</span>)</span>
<span id="cb16-33">            <span class="cf" style="color: #003B4F;
background-color: null;
font-style: inherit;">return</span> <span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">self</span>.cache[text_hash]</span>
<span id="cb16-34">        </span>
<span id="cb16-35">        <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># 임베딩 생성</span></span>
<span id="cb16-36">        <span class="bu" style="color: null;
background-color: null;
font-style: inherit;">print</span>(<span class="ss" style="color: #20794D;
background-color: null;
font-style: inherit;">f"캐시 미스: </span><span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">{</span>text[:<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">50</span>]<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">}</span><span class="ss" style="color: #20794D;
background-color: null;
font-style: inherit;">..."</span>)</span>
<span id="cb16-37">        embedding <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> embeddings_func(text)</span>
<span id="cb16-38">        </span>
<span id="cb16-39">        <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># 캐시 저장</span></span>
<span id="cb16-40">        <span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">self</span>.cache[text_hash] <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> embedding</span>
<span id="cb16-41">        <span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">self</span>._save_cache()</span>
<span id="cb16-42">        </span>
<span id="cb16-43">        <span class="cf" style="color: #003B4F;
background-color: null;
font-style: inherit;">return</span> embedding</span>
<span id="cb16-44"></span>
<span id="cb16-45"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># 사용 예시</span></span>
<span id="cb16-46">cache <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> EmbeddingCache()</span>
<span id="cb16-47"></span>
<span id="cb16-48">text <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Azure OpenAI 서비스"</span></span>
<span id="cb16-49">emb1 <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> cache.get_embedding(text, embeddings.embed_query)  <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># 캐시 미스</span></span>
<span id="cb16-50">emb2 <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> cache.get_embedding(text, embeddings.embed_query)  <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># 캐시 히트 (즉시 반환)</span></span></code></pre></div>
</details>
</div>
</section>
<section id="langchain-cachebackedembeddings" class="level3" data-number="11.2">
<h3 data-number="11.2" class="anchored" data-anchor-id="langchain-cachebackedembeddings"><span class="header-section-number">11.2</span> LangChain CacheBackedEmbeddings</h3>
<div id="2df7a1b9" class="cell" data-execution_count="15">
<details class="code-fold">
<summary>코드</summary>
<div class="sourceCode cell-code" id="cb17" style="background: #f1f3f5;"><pre class="sourceCode numberSource python number-lines code-with-copy"><code class="sourceCode python"><span id="cb17-1"><span class="im" style="color: #00769E;
background-color: null;
font-style: inherit;">from</span> langchain.embeddings <span class="im" style="color: #00769E;
background-color: null;
font-style: inherit;">import</span> CacheBackedEmbeddings</span>
<span id="cb17-2"><span class="im" style="color: #00769E;
background-color: null;
font-style: inherit;">from</span> langchain.storage <span class="im" style="color: #00769E;
background-color: null;
font-style: inherit;">import</span> LocalFileStore</span>
<span id="cb17-3"></span>
<span id="cb17-4"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># 로컬 파일 캐시 스토어</span></span>
<span id="cb17-5">store <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> LocalFileStore(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"./.embedding_cache/"</span>)</span>
<span id="cb17-6"></span>
<span id="cb17-7"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># 캐시가 적용된 임베딩</span></span>
<span id="cb17-8">cached_embedder <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> CacheBackedEmbeddings.from_bytes_store(</span>
<span id="cb17-9">    underlying_embeddings<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span>embeddings,</span>
<span id="cb17-10">    document_embedding_cache<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span>store,</span>
<span id="cb17-11">    namespace<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"azure-openai-embeddings"</span></span>
<span id="cb17-12">)</span>
<span id="cb17-13"></span>
<span id="cb17-14"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># 사용 (자동 캐싱)</span></span>
<span id="cb17-15">texts <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> [<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Azure AI"</span>, <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"OpenAI Service"</span>, <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Azure AI"</span>]  <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># "Azure AI" 중복</span></span>
<span id="cb17-16">embeddings_result <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> cached_embedder.embed_documents(texts)</span>
<span id="cb17-17"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># 두 번째 "Azure AI"는 캐시에서 즉시 반환</span></span></code></pre></div>
</details>
</div>
</section>
</section>
<section id="토큰-계산-및-비용-추정" class="level2" data-number="12">
<h2 data-number="12" class="anchored" data-anchor-id="토큰-계산-및-비용-추정"><span class="header-section-number">12</span> 토큰 계산 및 비용 추정</h2>
<section id="토큰-수-계산" class="level3" data-number="12.1">
<h3 data-number="12.1" class="anchored" data-anchor-id="토큰-수-계산"><span class="header-section-number">12.1</span> 토큰 수 계산</h3>
<div id="10cfed46" class="cell" data-execution_count="16">
<details class="code-fold">
<summary>코드</summary>
<div class="sourceCode cell-code" id="cb18" style="background: #f1f3f5;"><pre class="sourceCode numberSource python number-lines code-with-copy"><code class="sourceCode python"><span id="cb18-1"><span class="im" style="color: #00769E;
background-color: null;
font-style: inherit;">import</span> tiktoken</span>
<span id="cb18-2"></span>
<span id="cb18-3"><span class="kw" style="color: #003B4F;
background-color: null;
font-style: inherit;">def</span> count_tokens(text, model<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"cl100k_base"</span>):</span>
<span id="cb18-4">    <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">"""텍스트의 토큰 수 계산"""</span></span>
<span id="cb18-5">    encoding <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> tiktoken.get_encoding(model)</span>
<span id="cb18-6">    <span class="cf" style="color: #003B4F;
background-color: null;
font-style: inherit;">return</span> <span class="bu" style="color: null;
background-color: null;
font-style: inherit;">len</span>(encoding.encode(text))</span>
<span id="cb18-7"></span>
<span id="cb18-8"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># 예시</span></span>
<span id="cb18-9">text <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Azure OpenAI Embeddings는 텍스트를 벡터로 변환하는 서비스다."</span></span>
<span id="cb18-10">token_count <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> count_tokens(text)</span>
<span id="cb18-11"></span>
<span id="cb18-12"><span class="bu" style="color: null;
background-color: null;
font-style: inherit;">print</span>(<span class="ss" style="color: #20794D;
background-color: null;
font-style: inherit;">f"텍스트: </span><span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">{</span>text<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">}</span><span class="ss" style="color: #20794D;
background-color: null;
font-style: inherit;">"</span>)</span>
<span id="cb18-13"><span class="bu" style="color: null;
background-color: null;
font-style: inherit;">print</span>(<span class="ss" style="color: #20794D;
background-color: null;
font-style: inherit;">f"토큰 수: </span><span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">{</span>token_count<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">}</span><span class="ss" style="color: #20794D;
background-color: null;
font-style: inherit;">"</span>)</span></code></pre></div>
</details>
</div>
</section>
<section id="비용-추정" class="level3" data-number="12.2">
<h3 data-number="12.2" class="anchored" data-anchor-id="비용-추정"><span class="header-section-number">12.2</span> 비용 추정</h3>
<div id="0d3371a9" class="cell" data-execution_count="17">
<details class="code-fold">
<summary>코드</summary>
<div class="sourceCode cell-code" id="cb19" style="background: #f1f3f5;"><pre class="sourceCode numberSource python number-lines code-with-copy"><code class="sourceCode python"><span id="cb19-1"><span class="kw" style="color: #003B4F;
background-color: null;
font-style: inherit;">def</span> estimate_cost(token_count, model<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"text-embedding-3-small"</span>):</span>
<span id="cb19-2">    <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">"""임베딩 비용 추정"""</span></span>
<span id="cb19-3">    prices <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> {</span>
<span id="cb19-4">        <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"text-embedding-ada-002"</span>: <span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">0.0001</span>,  <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># $0.10 / 1M tokens</span></span>
<span id="cb19-5">        <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"text-embedding-3-small"</span>: <span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">0.00002</span>,  <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># $0.02 / 1M tokens</span></span>
<span id="cb19-6">        <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"text-embedding-3-large"</span>: <span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">0.00013</span>   <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># $0.13 / 1M tokens</span></span>
<span id="cb19-7">    }</span>
<span id="cb19-8">    </span>
<span id="cb19-9">    price_per_token <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> prices.get(model, <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">0</span>)</span>
<span id="cb19-10">    cost <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> token_count <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">*</span> price_per_token</span>
<span id="cb19-11">    </span>
<span id="cb19-12">    <span class="cf" style="color: #003B4F;
background-color: null;
font-style: inherit;">return</span> cost</span>
<span id="cb19-13"></span>
<span id="cb19-14"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># 예시: 10,000개 문서 (각 500 토큰)</span></span>
<span id="cb19-15">total_tokens <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">10000</span> <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">*</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">500</span></span>
<span id="cb19-16">cost_small <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> estimate_cost(total_tokens, <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"text-embedding-3-small"</span>)</span>
<span id="cb19-17">cost_large <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> estimate_cost(total_tokens, <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"text-embedding-3-large"</span>)</span>
<span id="cb19-18"></span>
<span id="cb19-19"><span class="bu" style="color: null;
background-color: null;
font-style: inherit;">print</span>(<span class="ss" style="color: #20794D;
background-color: null;
font-style: inherit;">f"총 토큰: </span><span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">{</span>total_tokens<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">:,}</span><span class="ss" style="color: #20794D;
background-color: null;
font-style: inherit;">"</span>)</span>
<span id="cb19-20"><span class="bu" style="color: null;
background-color: null;
font-style: inherit;">print</span>(<span class="ss" style="color: #20794D;
background-color: null;
font-style: inherit;">f"text-embedding-3-small 비용: $</span><span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">{</span>cost_small<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">:.2f}</span><span class="ss" style="color: #20794D;
background-color: null;
font-style: inherit;">"</span>)</span>
<span id="cb19-21"><span class="bu" style="color: null;
background-color: null;
font-style: inherit;">print</span>(<span class="ss" style="color: #20794D;
background-color: null;
font-style: inherit;">f"text-embedding-3-large 비용: $</span><span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">{</span>cost_large<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">:.2f}</span><span class="ss" style="color: #20794D;
background-color: null;
font-style: inherit;">"</span>)</span></code></pre></div>
</details>
</div>
</section>
</section>
<section id="azure-ai-search-연동" class="level2" data-number="13">
<h2 data-number="13" class="anchored" data-anchor-id="azure-ai-search-연동"><span class="header-section-number">13</span> Azure AI Search 연동</h2>
<p>임베딩 생성 후 Azure AI Search에 저장한다.</p>
<div id="3f1dc3be" class="cell" data-execution_count="18">
<details class="code-fold">
<summary>코드</summary>
<div class="sourceCode cell-code" id="cb20" style="background: #f1f3f5;"><pre class="sourceCode numberSource python number-lines code-with-copy"><code class="sourceCode python"><span id="cb20-1"><span class="im" style="color: #00769E;
background-color: null;
font-style: inherit;">from</span> langchain_community.vectorstores.azuresearch <span class="im" style="color: #00769E;
background-color: null;
font-style: inherit;">import</span> AzureSearch</span>
<span id="cb20-2"></span>
<span id="cb20-3"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># Azure Search VectorStore 초기화</span></span>
<span id="cb20-4">vector_store <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> AzureSearch(</span>
<span id="cb20-5">    azure_search_endpoint<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span>os.getenv(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"AZURE_SEARCH_ENDPOINT"</span>),</span>
<span id="cb20-6">    azure_search_key<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span>os.getenv(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"AZURE_SEARCH_API_KEY"</span>),</span>
<span id="cb20-7">    index_name<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"rag-embeddings"</span>,</span>
<span id="cb20-8">    embedding_function<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span>embeddings.embed_query</span>
<span id="cb20-9">)</span>
<span id="cb20-10"></span>
<span id="cb20-11"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># 문서 추가 (자동 임베딩)</span></span>
<span id="cb20-12"><span class="im" style="color: #00769E;
background-color: null;
font-style: inherit;">from</span> langchain_core.documents <span class="im" style="color: #00769E;
background-color: null;
font-style: inherit;">import</span> Document</span>
<span id="cb20-13"></span>
<span id="cb20-14">documents <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> [</span>
<span id="cb20-15">    Document(page_content<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Azure는 Microsoft의 클라우드 플랫폼이다."</span>, metadata<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span>{<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"source"</span>: <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"doc1"</span>}),</span>
<span id="cb20-16">    Document(page_content<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"RAG는 검색 증강 생성 기술이다."</span>, metadata<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span>{<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"source"</span>: <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"doc2"</span>}),</span>
<span id="cb20-17">    Document(page_content<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"임베딩은 텍스트를 벡터로 변환한다."</span>, metadata<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span>{<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"source"</span>: <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"doc3"</span>})</span>
<span id="cb20-18">]</span>
<span id="cb20-19"></span>
<span id="cb20-20"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># 문서 추가 (임베딩 자동 생성 및 업로드)</span></span>
<span id="cb20-21">vector_store.add_documents(documents)</span>
<span id="cb20-22"><span class="bu" style="color: null;
background-color: null;
font-style: inherit;">print</span>(<span class="ss" style="color: #20794D;
background-color: null;
font-style: inherit;">f"</span><span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">{</span><span class="bu" style="color: null;
background-color: null;
font-style: inherit;">len</span>(documents)<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">}</span><span class="ss" style="color: #20794D;
background-color: null;
font-style: inherit;">개 문서가 Azure AI Search에 추가되었다."</span>)</span></code></pre></div>
</details>
</div>
</section>
<section id="모니터링" class="level2" data-number="14">
<h2 data-number="14" class="anchored" data-anchor-id="모니터링"><span class="header-section-number">14</span> 모니터링</h2>
<section id="임베딩-품질-확인" class="level3" data-number="14.1">
<h3 data-number="14.1" class="anchored" data-anchor-id="임베딩-품질-확인"><span class="header-section-number">14.1</span> 임베딩 품질 확인</h3>
<div id="f62b2536" class="cell" data-execution_count="19">
<details class="code-fold">
<summary>코드</summary>
<div class="sourceCode cell-code" id="cb21" style="background: #f1f3f5;"><pre class="sourceCode numberSource python number-lines code-with-copy"><code class="sourceCode python"><span id="cb21-1"><span class="kw" style="color: #003B4F;
background-color: null;
font-style: inherit;">def</span> check_embedding_quality(embeddings_list):</span>
<span id="cb21-2">    <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">"""임베딩 품질 메트릭"""</span></span>
<span id="cb21-3">    <span class="cf" style="color: #003B4F;
background-color: null;
font-style: inherit;">if</span> <span class="kw" style="color: #003B4F;
background-color: null;
font-style: inherit;">not</span> embeddings_list:</span>
<span id="cb21-4">        <span class="cf" style="color: #003B4F;
background-color: null;
font-style: inherit;">return</span> <span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">None</span></span>
<span id="cb21-5">    </span>
<span id="cb21-6">    <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># 벡터 길이 (L2 norm)</span></span>
<span id="cb21-7">    norms <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> [np.linalg.norm(emb) <span class="cf" style="color: #003B4F;
background-color: null;
font-style: inherit;">for</span> emb <span class="kw" style="color: #003B4F;
background-color: null;
font-style: inherit;">in</span> embeddings_list]</span>
<span id="cb21-8">    </span>
<span id="cb21-9">    <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># 차원별 통계</span></span>
<span id="cb21-10">    embeddings_array <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> np.array(embeddings_list)</span>
<span id="cb21-11">    </span>
<span id="cb21-12">    metrics <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> {</span>
<span id="cb21-13">        <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"count"</span>: <span class="bu" style="color: null;
background-color: null;
font-style: inherit;">len</span>(embeddings_list),</span>
<span id="cb21-14">        <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"dimensions"</span>: <span class="bu" style="color: null;
background-color: null;
font-style: inherit;">len</span>(embeddings_list[<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">0</span>]),</span>
<span id="cb21-15">        <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"norm_mean"</span>: np.mean(norms),</span>
<span id="cb21-16">        <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"norm_std"</span>: np.std(norms),</span>
<span id="cb21-17">        <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"value_mean"</span>: np.mean(embeddings_array),</span>
<span id="cb21-18">        <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"value_std"</span>: np.std(embeddings_array)</span>
<span id="cb21-19">    }</span>
<span id="cb21-20">    </span>
<span id="cb21-21">    <span class="cf" style="color: #003B4F;
background-color: null;
font-style: inherit;">return</span> metrics</span>
<span id="cb21-22"></span>
<span id="cb21-23"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># 사용 예시</span></span>
<span id="cb21-24">sample_texts <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> [<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Azure"</span>, <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"OpenAI"</span>, <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"RAG"</span>, <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Embeddings"</span>]</span>
<span id="cb21-25">sample_embeddings <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> embeddings.embed_documents(sample_texts)</span>
<span id="cb21-26"></span>
<span id="cb21-27">quality <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> check_embedding_quality(sample_embeddings)</span>
<span id="cb21-28"><span class="bu" style="color: null;
background-color: null;
font-style: inherit;">print</span>(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"임베딩 품질 메트릭:"</span>)</span>
<span id="cb21-29"><span class="cf" style="color: #003B4F;
background-color: null;
font-style: inherit;">for</span> key, value <span class="kw" style="color: #003B4F;
background-color: null;
font-style: inherit;">in</span> quality.items():</span>
<span id="cb21-30">    <span class="bu" style="color: null;
background-color: null;
font-style: inherit;">print</span>(<span class="ss" style="color: #20794D;
background-color: null;
font-style: inherit;">f"- </span><span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">{</span>key<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">}</span><span class="ss" style="color: #20794D;
background-color: null;
font-style: inherit;">: </span><span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">{</span>value<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">}</span><span class="ss" style="color: #20794D;
background-color: null;
font-style: inherit;">"</span>)</span></code></pre></div>
</details>
</div>
</section>
</section>
<section id="문제-해결" class="level2" data-number="15">
<h2 data-number="15" class="anchored" data-anchor-id="문제-해결"><span class="header-section-number">15</span> 문제 해결</h2>
<section id="일반적인-오류" class="level3" data-number="15.1">
<h3 data-number="15.1" class="anchored" data-anchor-id="일반적인-오류"><span class="header-section-number">15.1</span> 일반적인 오류</h3>
<p><strong>1. RateLimitError: 요청 제한 초과</strong></p>
<div class="sourceCode" id="cb22" style="background: #f1f3f5;"><pre class="sourceCode numberSource python number-lines code-with-copy"><code class="sourceCode python"><span id="cb22-1"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># 해결: 재시도 로직 구현</span></span>
<span id="cb22-2"><span class="im" style="color: #00769E;
background-color: null;
font-style: inherit;">from</span> tenacity <span class="im" style="color: #00769E;
background-color: null;
font-style: inherit;">import</span> retry, stop_after_attempt, wait_exponential</span>
<span id="cb22-3"></span>
<span id="cb22-4"><span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">@retry</span>(stop<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span>stop_after_attempt(<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">3</span>), wait<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span>wait_exponential(multiplier<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span>, <span class="bu" style="color: null;
background-color: null;
font-style: inherit;">min</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">4</span>, <span class="bu" style="color: null;
background-color: null;
font-style: inherit;">max</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">10</span>))</span>
<span id="cb22-5"><span class="kw" style="color: #003B4F;
background-color: null;
font-style: inherit;">def</span> embed_with_retry(text):</span>
<span id="cb22-6">    <span class="cf" style="color: #003B4F;
background-color: null;
font-style: inherit;">return</span> embeddings.embed_query(text)</span>
<span id="cb22-7"></span>
<span id="cb22-8"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># 사용</span></span>
<span id="cb22-9">result <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> embed_with_retry(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"테스트 텍스트"</span>)</span></code></pre></div>
<p><strong>2. InvalidRequestError: 토큰 초과</strong></p>
<div class="sourceCode" id="cb23" style="background: #f1f3f5;"><pre class="sourceCode numberSource python number-lines code-with-copy"><code class="sourceCode python"><span id="cb23-1"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># 해결: 텍스트 자르기 (최대 8,191 토큰)</span></span>
<span id="cb23-2"><span class="kw" style="color: #003B4F;
background-color: null;
font-style: inherit;">def</span> truncate_text(text, max_tokens<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">8000</span>):</span>
<span id="cb23-3">    encoding <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> tiktoken.get_encoding(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"cl100k_base"</span>)</span>
<span id="cb23-4">    tokens <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> encoding.encode(text)</span>
<span id="cb23-5">    </span>
<span id="cb23-6">    <span class="cf" style="color: #003B4F;
background-color: null;
font-style: inherit;">if</span> <span class="bu" style="color: null;
background-color: null;
font-style: inherit;">len</span>(tokens) <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">&gt;</span> max_tokens:</span>
<span id="cb23-7">        tokens <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> tokens[:max_tokens]</span>
<span id="cb23-8">        text <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> encoding.decode(tokens)</span>
<span id="cb23-9">    </span>
<span id="cb23-10">    <span class="cf" style="color: #003B4F;
background-color: null;
font-style: inherit;">return</span> text</span>
<span id="cb23-11"></span>
<span id="cb23-12">long_text <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"..."</span> <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">*</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">10000</span></span>
<span id="cb23-13">safe_text <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> truncate_text(long_text)</span>
<span id="cb23-14">embedding <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> embeddings.embed_query(safe_text)</span></code></pre></div>
</section>
</section>
<section id="참고-자료" class="level2" data-number="16">
<h2 data-number="16" class="anchored" data-anchor-id="참고-자료"><span class="header-section-number">16</span> 참고 자료</h2>
<section id="공식-문서" class="level3" data-number="16.1">
<h3 data-number="16.1" class="anchored" data-anchor-id="공식-문서"><span class="header-section-number">16.1</span> 공식 문서</h3>
<ul>
<li><a href="https://learn.microsoft.com/en-us/azure/ai-services/openai/concepts/understand-embeddings">Azure OpenAI Embeddings</a></li>
<li><a href="https://learn.microsoft.com/en-us/azure/ai-services/openai/concepts/models#embeddings-models">text-embedding-3 모델</a></li>
<li><a href="https://learn.microsoft.com/en-us/python/api/overview/azure/openai-readme">Python SDK 참조</a></li>
</ul>
</section>
<section id="벤치마크" class="level3" data-number="16.2">
<h3 data-number="16.2" class="anchored" data-anchor-id="벤치마크"><span class="header-section-number">16.2</span> 벤치마크</h3>
<ul>
<li><a href="https://huggingface.co/spaces/mteb/leaderboard">MTEB Leaderboard</a> - 임베딩 모델 성능 비교</li>
</ul>
</section>
</section>
<section id="다음-단계" class="level2" data-number="17">
<h2 data-number="17" class="anchored" data-anchor-id="다음-단계"><span class="header-section-number">17</span> 다음 단계</h2>
<p>임베딩 생성이 완료되었다면, 이제 벡터 데이터베이스에 저장하자:</p>
<p>👉 <a href="../../../../../docs/blog/posts/RAG/13-Cloud-RAG/04-Azure-AI-Search-Integration.html">04-Azure-AI-Search-Integration.qmd</a> - Azure AI Search와 RAG 시스템 통합</p>


</section>

 ]]></description>
  <category>AI</category>
  <category>RAG</category>
  <category>Azure</category>
  <category>LangChain</category>
  <guid>kk3225.netlify.app/docs/blog/posts/RAG/13-Cloud-RAG/03-Azure-OpenAI-Embeddings.html</guid>
  <pubDate>Mon, 03 Nov 2025 15:00:00 GMT</pubDate>
</item>
<item>
  <title>Document Intelligence</title>
  <dc:creator>Kwangmin Kim</dc:creator>
  <link>kk3225.netlify.app/docs/blog/posts/RAG/13-Cloud-RAG/02-Document-Intelligence.html</link>
  <description><![CDATA[ 





<section id="azure-document-intelligence란" class="level2" data-number="1">
<h2 data-number="1" class="anchored" data-anchor-id="azure-document-intelligence란"><span class="header-section-number">1</span> Azure Document Intelligence란?</h2>
<p>Azure Document Intelligence(이전 Form Recognizer)는 AI 기반 문서 이해 서비스로, 스캔 문서나 이미지에서 텍스트, 표, 구조를 추출한다. RAG 시스템에서 PDF, 이미지 등의 비정형 문서를 구조화된 텍스트로 변환하는 핵심 역할을 한다.</p>
<p><strong>RAG 파이프라인에서의 역할:</strong> - 스캔 PDF → 텍스트 추출 (OCR) - 이미지 속 텍스트 인식 - 표, 제목, 단락 등 문서 구조 파악 - 한글 및 다국어 문서 처리</p>
<p><strong>핵심 기능:</strong> - <strong>높은 OCR 정확도</strong>: 한국어 95% 이상 - <strong>레이아웃 분석</strong>: 제목, 단락, 표, 리스트 구분 - <strong>다국어 지원</strong>: 100개 이상 언어 (한국어, 영어, 중국어, 일본어 등) - <strong>사전 훈련 모델</strong>: 영수증, 명함, 청구서 등 특화 모델 제공</p>
</section>
<section id="document-intelligence-모델" class="level2" data-number="2">
<h2 data-number="2" class="anchored" data-anchor-id="document-intelligence-모델"><span class="header-section-number">2</span> Document Intelligence 모델</h2>
<p>Azure Document Intelligence는 문서 유형에 따라 다양한 사전 훈련 모델을 제공한다:</p>
<section id="layout-api-범용-레이아웃-분석" class="level3" data-number="2.1">
<h3 data-number="2.1" class="anchored" data-anchor-id="layout-api-범용-레이아웃-분석"><span class="header-section-number">2.1</span> 1. Layout API (범용 레이아웃 분석)</h3>
<p><strong>용도</strong>: 모든 종류의 문서 레이아웃 분석</p>
<p><strong>추출 정보:</strong> - 텍스트 (OCR) - 표 (행, 열 구조) - 제목 및 섹션 - 단락 및 줄바꿈 - 선택 마크 (체크박스)</p>
<p><strong>RAG 시스템 권장</strong>: ✅ <strong>가장 많이 사용</strong></p>
<p><strong>가격</strong>: 페이지당 $0.01</p>
</section>
<section id="read-api-텍스트-추출-전용" class="level3" data-number="2.2">
<h3 data-number="2.2" class="anchored" data-anchor-id="read-api-텍스트-추출-전용"><span class="header-section-number">2.2</span> 2. Read API (텍스트 추출 전용)</h3>
<p><strong>용도</strong>: 순수 텍스트 추출 (레이아웃 무시)</p>
<p><strong>추출 정보:</strong> - 텍스트만 (구조 정보 없음) - 빠른 처리 속도</p>
<p><strong>RAG 시스템 권장</strong>: 간단한 문서, 비용 절감 필요 시</p>
<p><strong>가격</strong>: 페이지당 $0.0015</p>
</section>
<section id="prebuilt-models-특화-모델" class="level3" data-number="2.3">
<h3 data-number="2.3" class="anchored" data-anchor-id="prebuilt-models-특화-모델"><span class="header-section-number">2.3</span> 3. Prebuilt Models (특화 모델)</h3>
<table class="table">
<thead>
<tr class="header">
<th>모델</th>
<th>용도</th>
<th>추출 정보</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td><strong>Invoice</strong></td>
<td>청구서, 세금계산서</td>
<td>날짜, 금액, 품목, 공급자</td>
</tr>
<tr class="even">
<td><strong>Receipt</strong></td>
<td>영수증</td>
<td>상점명, 날짜, 총액, 항목</td>
</tr>
<tr class="odd">
<td><strong>ID Document</strong></td>
<td>신분증, 여권</td>
<td>이름, 생년월일, 주소</td>
</tr>
<tr class="even">
<td><strong>Business Card</strong></td>
<td>명함</td>
<td>이름, 직함, 연락처</td>
</tr>
<tr class="odd">
<td><strong>W-2</strong></td>
<td>미국 세금 양식</td>
<td>급여, 세금</td>
</tr>
</tbody>
</table>
<p><strong>RAG 시스템 권장</strong>: 특정 문서 타입만 처리 시 유용</p>
</section>
</section>
<section id="document-intelligence-리소스-생성" class="level2" data-number="3">
<h2 data-number="3" class="anchored" data-anchor-id="document-intelligence-리소스-생성"><span class="header-section-number">3</span> Document Intelligence 리소스 생성</h2>
<section id="azure-portal에서-생성" class="level3" data-number="3.1">
<h3 data-number="3.1" class="anchored" data-anchor-id="azure-portal에서-생성"><span class="header-section-number">3.1</span> Azure Portal에서 생성</h3>
<p><strong>1. 리소스 만들기:</strong> - <a href="https://portal.azure.com">portal.azure.com</a> → “리소스 만들기” - “Document Intelligence” 검색 및 선택</p>
<p><strong>2. 기본 설정:</strong> - <strong>구독</strong>: 사용할 구독 선택 - <strong>리소스 그룹</strong>: <code>rg-rag-prod</code> - <strong>지역</strong>: Korea Central (한국어 처리 최적화) - <strong>이름</strong>: <code>doc-intel-rag-prod</code> - <strong>가격 책정 계층</strong>: - <strong>Free F0</strong>: 500페이지/월 무료 (개발/테스트) - <strong>Standard S0</strong>: 종량제 (프로덕션)</p>
<p><strong>3. 검토 + 만들기</strong> → 생성 완료</p>
<p><strong>4. 키 및 엔드포인트 확인:</strong> - 생성된 리소스 → “키 및 엔드포인트” - <strong>KEY 1</strong> 및 <strong>엔드포인트</strong> 복사</p>
</section>
<section id="azure-cli로-생성" class="level3" data-number="3.2">
<h3 data-number="3.2" class="anchored" data-anchor-id="azure-cli로-생성"><span class="header-section-number">3.2</span> Azure CLI로 생성</h3>
<div class="sourceCode" id="cb1" style="background: #f1f3f5;"><pre class="sourceCode numberSource bash number-lines code-with-copy"><code class="sourceCode bash"><span id="cb1-1"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># Document Intelligence 리소스 생성</span></span>
<span id="cb1-2"><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">az</span> cognitiveservices account create <span class="dt" style="color: #AD0000;
background-color: null;
font-style: inherit;">\</span></span>
<span id="cb1-3">    <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">--name</span> doc-intel-rag-prod <span class="dt" style="color: #AD0000;
background-color: null;
font-style: inherit;">\</span></span>
<span id="cb1-4">    <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">--resource-group</span> rg-rag-prod <span class="dt" style="color: #AD0000;
background-color: null;
font-style: inherit;">\</span></span>
<span id="cb1-5">    <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">--kind</span> FormRecognizer <span class="dt" style="color: #AD0000;
background-color: null;
font-style: inherit;">\</span></span>
<span id="cb1-6">    <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">--sku</span> S0 <span class="dt" style="color: #AD0000;
background-color: null;
font-style: inherit;">\</span></span>
<span id="cb1-7">    <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">--location</span> koreacentral <span class="dt" style="color: #AD0000;
background-color: null;
font-style: inherit;">\</span></span>
<span id="cb1-8">    <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">--yes</span></span>
<span id="cb1-9"></span>
<span id="cb1-10"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># 키 및 엔드포인트 조회</span></span>
<span id="cb1-11"><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">az</span> cognitiveservices account keys list <span class="dt" style="color: #AD0000;
background-color: null;
font-style: inherit;">\</span></span>
<span id="cb1-12">    <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">--name</span> doc-intel-rag-prod <span class="dt" style="color: #AD0000;
background-color: null;
font-style: inherit;">\</span></span>
<span id="cb1-13">    <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">--resource-group</span> rg-rag-prod</span>
<span id="cb1-14"></span>
<span id="cb1-15"><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">az</span> cognitiveservices account show <span class="dt" style="color: #AD0000;
background-color: null;
font-style: inherit;">\</span></span>
<span id="cb1-16">    <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">--name</span> doc-intel-rag-prod <span class="dt" style="color: #AD0000;
background-color: null;
font-style: inherit;">\</span></span>
<span id="cb1-17">    <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">--resource-group</span> rg-rag-prod <span class="dt" style="color: #AD0000;
background-color: null;
font-style: inherit;">\</span></span>
<span id="cb1-18">    <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">--query</span> properties.endpoint</span></code></pre></div>
</section>
</section>
<section id="환경-설정" class="level2" data-number="4">
<h2 data-number="4" class="anchored" data-anchor-id="환경-설정"><span class="header-section-number">4</span> 환경 설정</h2>
<section id="python-sdk-설치" class="level3" data-number="4.1">
<h3 data-number="4.1" class="anchored" data-anchor-id="python-sdk-설치"><span class="header-section-number">4.1</span> Python SDK 설치</h3>
<div class="sourceCode" id="cb2" style="background: #f1f3f5;"><pre class="sourceCode numberSource bash number-lines code-with-copy"><code class="sourceCode bash"><span id="cb2-1"><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">pip</span> install azure-ai-formrecognizer</span>
<span id="cb2-2"><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">pip</span> install azure-storage-blob</span>
<span id="cb2-3"><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">pip</span> install python-dotenv</span></code></pre></div>
</section>
<section id="환경-변수-설정" class="level3" data-number="4.2">
<h3 data-number="4.2" class="anchored" data-anchor-id="환경-변수-설정"><span class="header-section-number">4.2</span> 환경 변수 설정</h3>
<p><code>.env</code> 파일:</p>
<pre><code>AZURE_DOCUMENT_INTELLIGENCE_ENDPOINT=https://doc-intel-rag-prod.cognitiveservices.azure.com/
AZURE_DOCUMENT_INTELLIGENCE_KEY=your-key-here</code></pre>
</section>
</section>
<section id="layout-api-사용법" class="level2" data-number="5">
<h2 data-number="5" class="anchored" data-anchor-id="layout-api-사용법"><span class="header-section-number">5</span> Layout API 사용법</h2>
<section id="로컬-파일-분석" class="level3" data-number="5.1">
<h3 data-number="5.1" class="anchored" data-anchor-id="로컬-파일-분석"><span class="header-section-number">5.1</span> 로컬 파일 분석</h3>
<div id="5917eb87" class="cell" data-execution_count="1">
<details class="code-fold">
<summary>코드</summary>
<div class="sourceCode cell-code" id="cb4" style="background: #f1f3f5;"><pre class="sourceCode numberSource python number-lines code-with-copy"><code class="sourceCode python"><span id="cb4-1"><span class="im" style="color: #00769E;
background-color: null;
font-style: inherit;">from</span> azure.ai.formrecognizer <span class="im" style="color: #00769E;
background-color: null;
font-style: inherit;">import</span> DocumentAnalysisClient</span>
<span id="cb4-2"><span class="im" style="color: #00769E;
background-color: null;
font-style: inherit;">from</span> azure.core.credentials <span class="im" style="color: #00769E;
background-color: null;
font-style: inherit;">import</span> AzureKeyCredential</span>
<span id="cb4-3"><span class="im" style="color: #00769E;
background-color: null;
font-style: inherit;">from</span> dotenv <span class="im" style="color: #00769E;
background-color: null;
font-style: inherit;">import</span> load_dotenv</span>
<span id="cb4-4"><span class="im" style="color: #00769E;
background-color: null;
font-style: inherit;">import</span> os</span>
<span id="cb4-5"></span>
<span id="cb4-6">load_dotenv()</span>
<span id="cb4-7"></span>
<span id="cb4-8"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># 클라이언트 생성</span></span>
<span id="cb4-9">endpoint <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> os.getenv(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"AZURE_DOCUMENT_INTELLIGENCE_ENDPOINT"</span>)</span>
<span id="cb4-10">key <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> os.getenv(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"AZURE_DOCUMENT_INTELLIGENCE_KEY"</span>)</span>
<span id="cb4-11"></span>
<span id="cb4-12">document_analysis_client <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> DocumentAnalysisClient(</span>
<span id="cb4-13">    endpoint<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span>endpoint,</span>
<span id="cb4-14">    credential<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span>AzureKeyCredential(key)</span>
<span id="cb4-15">)</span>
<span id="cb4-16"></span>
<span id="cb4-17"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># 로컬 PDF 파일 분석</span></span>
<span id="cb4-18"><span class="cf" style="color: #003B4F;
background-color: null;
font-style: inherit;">with</span> <span class="bu" style="color: null;
background-color: null;
font-style: inherit;">open</span>(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"sample.pdf"</span>, <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"rb"</span>) <span class="im" style="color: #00769E;
background-color: null;
font-style: inherit;">as</span> f:</span>
<span id="cb4-19">    poller <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> document_analysis_client.begin_analyze_document(</span>
<span id="cb4-20">        <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"prebuilt-layout"</span>, document<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span>f</span>
<span id="cb4-21">    )</span>
<span id="cb4-22">    result <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> poller.result()</span>
<span id="cb4-23"></span>
<span id="cb4-24"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># 결과 출력</span></span>
<span id="cb4-25"><span class="bu" style="color: null;
background-color: null;
font-style: inherit;">print</span>(<span class="ss" style="color: #20794D;
background-color: null;
font-style: inherit;">f"분석된 페이지 수: </span><span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">{</span><span class="bu" style="color: null;
background-color: null;
font-style: inherit;">len</span>(result.pages)<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">}</span><span class="ss" style="color: #20794D;
background-color: null;
font-style: inherit;">"</span>)</span>
<span id="cb4-26"><span class="bu" style="color: null;
background-color: null;
font-style: inherit;">print</span>(<span class="ss" style="color: #20794D;
background-color: null;
font-style: inherit;">f"추출된 단락 수: </span><span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">{</span><span class="bu" style="color: null;
background-color: null;
font-style: inherit;">len</span>(result.paragraphs)<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">}</span><span class="ss" style="color: #20794D;
background-color: null;
font-style: inherit;">"</span>)</span>
<span id="cb4-27"><span class="bu" style="color: null;
background-color: null;
font-style: inherit;">print</span>(<span class="ss" style="color: #20794D;
background-color: null;
font-style: inherit;">f"추출된 표 수: </span><span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">{</span><span class="bu" style="color: null;
background-color: null;
font-style: inherit;">len</span>(result.tables)<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">}</span><span class="ss" style="color: #20794D;
background-color: null;
font-style: inherit;">"</span>)</span></code></pre></div>
</details>
</div>
</section>
<section id="url에서-문서-분석" class="level3" data-number="5.2">
<h3 data-number="5.2" class="anchored" data-anchor-id="url에서-문서-분석"><span class="header-section-number">5.2</span> URL에서 문서 분석</h3>
<div id="43bfb908" class="cell" data-execution_count="2">
<details class="code-fold">
<summary>코드</summary>
<div class="sourceCode cell-code" id="cb5" style="background: #f1f3f5;"><pre class="sourceCode numberSource python number-lines code-with-copy"><code class="sourceCode python"><span id="cb5-1"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># Azure Blob Storage URL로 분석</span></span>
<span id="cb5-2">document_url <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"https://stragdocs2025.blob.core.windows.net/rag-documents/sample.pdf?&lt;sas-token&gt;"</span></span>
<span id="cb5-3"></span>
<span id="cb5-4">poller <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> document_analysis_client.begin_analyze_document_from_url(</span>
<span id="cb5-5">    <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"prebuilt-layout"</span>, document_url<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span>document_url</span>
<span id="cb5-6">)</span>
<span id="cb5-7">result <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> poller.result()</span>
<span id="cb5-8"></span>
<span id="cb5-9"><span class="bu" style="color: null;
background-color: null;
font-style: inherit;">print</span>(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"문서 분석 완료"</span>)</span></code></pre></div>
</details>
</div>
</section>
</section>
<section id="텍스트-추출" class="level2" data-number="6">
<h2 data-number="6" class="anchored" data-anchor-id="텍스트-추출"><span class="header-section-number">6</span> 텍스트 추출</h2>
<section id="전체-텍스트-추출" class="level3" data-number="6.1">
<h3 data-number="6.1" class="anchored" data-anchor-id="전체-텍스트-추출"><span class="header-section-number">6.1</span> 전체 텍스트 추출</h3>
<div id="bb571b82" class="cell" data-execution_count="3">
<details class="code-fold">
<summary>코드</summary>
<div class="sourceCode cell-code" id="cb6" style="background: #f1f3f5;"><pre class="sourceCode numberSource python number-lines code-with-copy"><code class="sourceCode python"><span id="cb6-1"><span class="kw" style="color: #003B4F;
background-color: null;
font-style: inherit;">def</span> extract_full_text(result):</span>
<span id="cb6-2">    <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">"""문서에서 전체 텍스트 추출"""</span></span>
<span id="cb6-3">    full_text <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> []</span>
<span id="cb6-4">    </span>
<span id="cb6-5">    <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># 페이지별 텍스트 추출</span></span>
<span id="cb6-6">    <span class="cf" style="color: #003B4F;
background-color: null;
font-style: inherit;">for</span> page <span class="kw" style="color: #003B4F;
background-color: null;
font-style: inherit;">in</span> result.pages:</span>
<span id="cb6-7">        page_text <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> []</span>
<span id="cb6-8">        <span class="cf" style="color: #003B4F;
background-color: null;
font-style: inherit;">for</span> line <span class="kw" style="color: #003B4F;
background-color: null;
font-style: inherit;">in</span> page.lines:</span>
<span id="cb6-9">            page_text.append(line.content)</span>
<span id="cb6-10">        </span>
<span id="cb6-11">        full_text.append(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"</span><span class="ch" style="color: #20794D;
background-color: null;
font-style: inherit;">\n</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"</span>.join(page_text))</span>
<span id="cb6-12">    </span>
<span id="cb6-13">    <span class="cf" style="color: #003B4F;
background-color: null;
font-style: inherit;">return</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"</span><span class="ch" style="color: #20794D;
background-color: null;
font-style: inherit;">\n\n</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"</span>.join(full_text)</span>
<span id="cb6-14"></span>
<span id="cb6-15"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># 사용 예시</span></span>
<span id="cb6-16">text <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> extract_full_text(result)</span>
<span id="cb6-17"><span class="bu" style="color: null;
background-color: null;
font-style: inherit;">print</span>(<span class="ss" style="color: #20794D;
background-color: null;
font-style: inherit;">f"추출된 텍스트 (앞 500자):</span><span class="ch" style="color: #20794D;
background-color: null;
font-style: inherit;">\n</span><span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">{</span>text[:<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">500</span>]<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">}</span><span class="ss" style="color: #20794D;
background-color: null;
font-style: inherit;">"</span>)</span></code></pre></div>
</details>
</div>
</section>
<section id="단락-단위-추출" class="level3" data-number="6.2">
<h3 data-number="6.2" class="anchored" data-anchor-id="단락-단위-추출"><span class="header-section-number">6.2</span> 단락 단위 추출</h3>
<div id="3f0663f3" class="cell" data-execution_count="4">
<details class="code-fold">
<summary>코드</summary>
<div class="sourceCode cell-code" id="cb7" style="background: #f1f3f5;"><pre class="sourceCode numberSource python number-lines code-with-copy"><code class="sourceCode python"><span id="cb7-1"><span class="kw" style="color: #003B4F;
background-color: null;
font-style: inherit;">def</span> extract_paragraphs(result):</span>
<span id="cb7-2">    <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">"""단락 단위로 텍스트 추출 (레이아웃 유지)"""</span></span>
<span id="cb7-3">    paragraphs <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> []</span>
<span id="cb7-4">    </span>
<span id="cb7-5">    <span class="cf" style="color: #003B4F;
background-color: null;
font-style: inherit;">for</span> paragraph <span class="kw" style="color: #003B4F;
background-color: null;
font-style: inherit;">in</span> result.paragraphs:</span>
<span id="cb7-6">        paragraphs.append({</span>
<span id="cb7-7">            <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"content"</span>: paragraph.content,</span>
<span id="cb7-8">            <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"role"</span>: paragraph.role,  <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># title, sectionHeading, paragraph 등</span></span>
<span id="cb7-9">            <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"page_number"</span>: paragraph.bounding_regions[<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">0</span>].page_number <span class="cf" style="color: #003B4F;
background-color: null;
font-style: inherit;">if</span> paragraph.bounding_regions <span class="cf" style="color: #003B4F;
background-color: null;
font-style: inherit;">else</span> <span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">None</span></span>
<span id="cb7-10">        })</span>
<span id="cb7-11">    </span>
<span id="cb7-12">    <span class="cf" style="color: #003B4F;
background-color: null;
font-style: inherit;">return</span> paragraphs</span>
<span id="cb7-13"></span>
<span id="cb7-14"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># 사용 예시</span></span>
<span id="cb7-15">paragraphs <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> extract_paragraphs(result)</span>
<span id="cb7-16"><span class="bu" style="color: null;
background-color: null;
font-style: inherit;">print</span>(<span class="ss" style="color: #20794D;
background-color: null;
font-style: inherit;">f"총 </span><span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">{</span><span class="bu" style="color: null;
background-color: null;
font-style: inherit;">len</span>(paragraphs)<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">}</span><span class="ss" style="color: #20794D;
background-color: null;
font-style: inherit;">개 단락 추출"</span>)</span>
<span id="cb7-17"></span>
<span id="cb7-18"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># 제목만 추출</span></span>
<span id="cb7-19">titles <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> [p <span class="cf" style="color: #003B4F;
background-color: null;
font-style: inherit;">for</span> p <span class="kw" style="color: #003B4F;
background-color: null;
font-style: inherit;">in</span> paragraphs <span class="cf" style="color: #003B4F;
background-color: null;
font-style: inherit;">if</span> p[<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"role"</span>] <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">==</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"title"</span>]</span>
<span id="cb7-20"><span class="bu" style="color: null;
background-color: null;
font-style: inherit;">print</span>(<span class="ss" style="color: #20794D;
background-color: null;
font-style: inherit;">f"</span><span class="ch" style="color: #20794D;
background-color: null;
font-style: inherit;">\n</span><span class="ss" style="color: #20794D;
background-color: null;
font-style: inherit;">문서 제목들:"</span>)</span>
<span id="cb7-21"><span class="cf" style="color: #003B4F;
background-color: null;
font-style: inherit;">for</span> title <span class="kw" style="color: #003B4F;
background-color: null;
font-style: inherit;">in</span> titles:</span>
<span id="cb7-22">    <span class="bu" style="color: null;
background-color: null;
font-style: inherit;">print</span>(<span class="ss" style="color: #20794D;
background-color: null;
font-style: inherit;">f"- </span><span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">{</span>title[<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">'content'</span>]<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">}</span><span class="ss" style="color: #20794D;
background-color: null;
font-style: inherit;"> (페이지 </span><span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">{</span>title[<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">'page_number'</span>]<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">}</span><span class="ss" style="color: #20794D;
background-color: null;
font-style: inherit;">)"</span>)</span></code></pre></div>
</details>
</div>
</section>
</section>
<section id="표-추출" class="level2" data-number="7">
<h2 data-number="7" class="anchored" data-anchor-id="표-추출"><span class="header-section-number">7</span> 표 추출</h2>
<section id="표-구조-파싱" class="level3" data-number="7.1">
<h3 data-number="7.1" class="anchored" data-anchor-id="표-구조-파싱"><span class="header-section-number">7.1</span> 표 구조 파싱</h3>
<div id="14c51005" class="cell" data-execution_count="5">
<details class="code-fold">
<summary>코드</summary>
<div class="sourceCode cell-code" id="cb8" style="background: #f1f3f5;"><pre class="sourceCode numberSource python number-lines code-with-copy"><code class="sourceCode python"><span id="cb8-1"><span class="kw" style="color: #003B4F;
background-color: null;
font-style: inherit;">def</span> extract_tables(result):</span>
<span id="cb8-2">    <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">"""문서에서 표 추출"""</span></span>
<span id="cb8-3">    tables_data <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> []</span>
<span id="cb8-4">    </span>
<span id="cb8-5">    <span class="cf" style="color: #003B4F;
background-color: null;
font-style: inherit;">for</span> table_idx, table <span class="kw" style="color: #003B4F;
background-color: null;
font-style: inherit;">in</span> <span class="bu" style="color: null;
background-color: null;
font-style: inherit;">enumerate</span>(result.tables):</span>
<span id="cb8-6">        <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># 표 메타데이터</span></span>
<span id="cb8-7">        table_info <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> {</span>
<span id="cb8-8">            <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"table_id"</span>: table_idx <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span>,</span>
<span id="cb8-9">            <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"row_count"</span>: table.row_count,</span>
<span id="cb8-10">            <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"column_count"</span>: table.column_count,</span>
<span id="cb8-11">            <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"page_number"</span>: table.bounding_regions[<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">0</span>].page_number,</span>
<span id="cb8-12">            <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"cells"</span>: []</span>
<span id="cb8-13">        }</span>
<span id="cb8-14">        </span>
<span id="cb8-15">        <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># 셀 데이터</span></span>
<span id="cb8-16">        <span class="cf" style="color: #003B4F;
background-color: null;
font-style: inherit;">for</span> cell <span class="kw" style="color: #003B4F;
background-color: null;
font-style: inherit;">in</span> table.cells:</span>
<span id="cb8-17">            table_info[<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"cells"</span>].append({</span>
<span id="cb8-18">                <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"row_index"</span>: cell.row_index,</span>
<span id="cb8-19">                <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"column_index"</span>: cell.column_index,</span>
<span id="cb8-20">                <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"content"</span>: cell.content,</span>
<span id="cb8-21">                <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"kind"</span>: cell.kind  <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># columnHeader, rowHeader, content, stub</span></span>
<span id="cb8-22">            })</span>
<span id="cb8-23">        </span>
<span id="cb8-24">        tables_data.append(table_info)</span>
<span id="cb8-25">    </span>
<span id="cb8-26">    <span class="cf" style="color: #003B4F;
background-color: null;
font-style: inherit;">return</span> tables_data</span>
<span id="cb8-27"></span>
<span id="cb8-28"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># 사용 예시</span></span>
<span id="cb8-29">tables <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> extract_tables(result)</span>
<span id="cb8-30"><span class="bu" style="color: null;
background-color: null;
font-style: inherit;">print</span>(<span class="ss" style="color: #20794D;
background-color: null;
font-style: inherit;">f"추출된 표 개수: </span><span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">{</span><span class="bu" style="color: null;
background-color: null;
font-style: inherit;">len</span>(tables)<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">}</span><span class="ss" style="color: #20794D;
background-color: null;
font-style: inherit;">"</span>)</span>
<span id="cb8-31"></span>
<span id="cb8-32"><span class="cf" style="color: #003B4F;
background-color: null;
font-style: inherit;">for</span> table <span class="kw" style="color: #003B4F;
background-color: null;
font-style: inherit;">in</span> tables:</span>
<span id="cb8-33">    <span class="bu" style="color: null;
background-color: null;
font-style: inherit;">print</span>(<span class="ss" style="color: #20794D;
background-color: null;
font-style: inherit;">f"</span><span class="ch" style="color: #20794D;
background-color: null;
font-style: inherit;">\n</span><span class="ss" style="color: #20794D;
background-color: null;
font-style: inherit;">[표 </span><span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">{</span>table[<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">'table_id'</span>]<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">}</span><span class="ss" style="color: #20794D;
background-color: null;
font-style: inherit;">] 페이지 </span><span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">{</span>table[<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">'page_number'</span>]<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">}</span><span class="ss" style="color: #20794D;
background-color: null;
font-style: inherit;">"</span>)</span>
<span id="cb8-34">    <span class="bu" style="color: null;
background-color: null;
font-style: inherit;">print</span>(<span class="ss" style="color: #20794D;
background-color: null;
font-style: inherit;">f"크기: </span><span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">{</span>table[<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">'row_count'</span>]<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">}</span><span class="ss" style="color: #20794D;
background-color: null;
font-style: inherit;">행 × </span><span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">{</span>table[<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">'column_count'</span>]<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">}</span><span class="ss" style="color: #20794D;
background-color: null;
font-style: inherit;">열"</span>)</span></code></pre></div>
</details>
</div>
</section>
<section id="표를-pandas-dataframe으로-변환" class="level3" data-number="7.2">
<h3 data-number="7.2" class="anchored" data-anchor-id="표를-pandas-dataframe으로-변환"><span class="header-section-number">7.2</span> 표를 Pandas DataFrame으로 변환</h3>
<div id="df103ed8" class="cell" data-execution_count="6">
<details class="code-fold">
<summary>코드</summary>
<div class="sourceCode cell-code" id="cb9" style="background: #f1f3f5;"><pre class="sourceCode numberSource python number-lines code-with-copy"><code class="sourceCode python"><span id="cb9-1"><span class="im" style="color: #00769E;
background-color: null;
font-style: inherit;">import</span> pandas <span class="im" style="color: #00769E;
background-color: null;
font-style: inherit;">as</span> pd</span>
<span id="cb9-2"></span>
<span id="cb9-3"><span class="kw" style="color: #003B4F;
background-color: null;
font-style: inherit;">def</span> table_to_dataframe(table):</span>
<span id="cb9-4">    <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">"""표를 Pandas DataFrame으로 변환"""</span></span>
<span id="cb9-5">    <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># 표 초기화 (빈 셀 포함)</span></span>
<span id="cb9-6">    data <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> [[<span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">None</span>] <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">*</span> table[<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"column_count"</span>] <span class="cf" style="color: #003B4F;
background-color: null;
font-style: inherit;">for</span> _ <span class="kw" style="color: #003B4F;
background-color: null;
font-style: inherit;">in</span> <span class="bu" style="color: null;
background-color: null;
font-style: inherit;">range</span>(table[<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"row_count"</span>])]</span>
<span id="cb9-7">    </span>
<span id="cb9-8">    <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># 셀 데이터 채우기</span></span>
<span id="cb9-9">    <span class="cf" style="color: #003B4F;
background-color: null;
font-style: inherit;">for</span> cell <span class="kw" style="color: #003B4F;
background-color: null;
font-style: inherit;">in</span> table[<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"cells"</span>]:</span>
<span id="cb9-10">        data[cell[<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"row_index"</span>]][cell[<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"column_index"</span>]] <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> cell[<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"content"</span>]</span>
<span id="cb9-11">    </span>
<span id="cb9-12">    <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># DataFrame 생성 (첫 행을 헤더로)</span></span>
<span id="cb9-13">    df <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> pd.DataFrame(data[<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span>:], columns<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span>data[<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">0</span>])</span>
<span id="cb9-14">    <span class="cf" style="color: #003B4F;
background-color: null;
font-style: inherit;">return</span> df</span>
<span id="cb9-15"></span>
<span id="cb9-16"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># 사용 예시</span></span>
<span id="cb9-17"><span class="cf" style="color: #003B4F;
background-color: null;
font-style: inherit;">if</span> tables:</span>
<span id="cb9-18">    df <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> table_to_dataframe(tables[<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">0</span>])</span>
<span id="cb9-19">    <span class="bu" style="color: null;
background-color: null;
font-style: inherit;">print</span>(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"</span><span class="ch" style="color: #20794D;
background-color: null;
font-style: inherit;">\n</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">표 데이터 (DataFrame):"</span>)</span>
<span id="cb9-20">    <span class="bu" style="color: null;
background-color: null;
font-style: inherit;">print</span>(df)</span></code></pre></div>
</details>
</div>
</section>
</section>
<section id="레이아웃-기반-문서-분할" class="level2" data-number="8">
<h2 data-number="8" class="anchored" data-anchor-id="레이아웃-기반-문서-분할"><span class="header-section-number">8</span> 레이아웃 기반 문서 분할</h2>
<p>RAG 시스템에서는 문서 구조를 고려한 청크 분할이 중요하다.</p>
<div id="ca6c1f74" class="cell" data-execution_count="7">
<details class="code-fold">
<summary>코드</summary>
<div class="sourceCode cell-code" id="cb10" style="background: #f1f3f5;"><pre class="sourceCode numberSource python number-lines code-with-copy"><code class="sourceCode python"><span id="cb10-1"><span class="im" style="color: #00769E;
background-color: null;
font-style: inherit;">from</span> langchain_core.documents <span class="im" style="color: #00769E;
background-color: null;
font-style: inherit;">import</span> Document</span>
<span id="cb10-2"><span class="im" style="color: #00769E;
background-color: null;
font-style: inherit;">from</span> typing <span class="im" style="color: #00769E;
background-color: null;
font-style: inherit;">import</span> List</span>
<span id="cb10-3"></span>
<span id="cb10-4"><span class="kw" style="color: #003B4F;
background-color: null;
font-style: inherit;">def</span> split_by_layout(result, max_chunk_size: <span class="bu" style="color: null;
background-color: null;
font-style: inherit;">int</span> <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1000</span>) <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">-&gt;</span> List[Document]:</span>
<span id="cb10-5">    <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">"""레이아웃 기반 문서 분할"""</span></span>
<span id="cb10-6">    documents <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> []</span>
<span id="cb10-7">    current_chunk <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> []</span>
<span id="cb10-8">    current_size <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">0</span></span>
<span id="cb10-9">    current_page <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span></span>
<span id="cb10-10">    </span>
<span id="cb10-11">    <span class="cf" style="color: #003B4F;
background-color: null;
font-style: inherit;">for</span> paragraph <span class="kw" style="color: #003B4F;
background-color: null;
font-style: inherit;">in</span> result.paragraphs:</span>
<span id="cb10-12">        <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># 단락 정보</span></span>
<span id="cb10-13">        content <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> paragraph.content</span>
<span id="cb10-14">        role <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> paragraph.role <span class="kw" style="color: #003B4F;
background-color: null;
font-style: inherit;">or</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"paragraph"</span></span>
<span id="cb10-15">        page_num <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> paragraph.bounding_regions[<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">0</span>].page_number <span class="cf" style="color: #003B4F;
background-color: null;
font-style: inherit;">if</span> paragraph.bounding_regions <span class="cf" style="color: #003B4F;
background-color: null;
font-style: inherit;">else</span> current_page</span>
<span id="cb10-16">        </span>
<span id="cb10-17">        <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># 제목은 새로운 청크 시작</span></span>
<span id="cb10-18">        <span class="cf" style="color: #003B4F;
background-color: null;
font-style: inherit;">if</span> role <span class="kw" style="color: #003B4F;
background-color: null;
font-style: inherit;">in</span> [<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"title"</span>, <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"sectionHeading"</span>] <span class="kw" style="color: #003B4F;
background-color: null;
font-style: inherit;">and</span> current_chunk:</span>
<span id="cb10-19">            <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># 이전 청크 저장</span></span>
<span id="cb10-20">            doc <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> Document(</span>
<span id="cb10-21">                page_content<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"</span><span class="ch" style="color: #20794D;
background-color: null;
font-style: inherit;">\n\n</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"</span>.join(current_chunk),</span>
<span id="cb10-22">                metadata<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span>{</span>
<span id="cb10-23">                    <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"page"</span>: current_page,</span>
<span id="cb10-24">                    <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"chunk_type"</span>: <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"section"</span></span>
<span id="cb10-25">                }</span>
<span id="cb10-26">            )</span>
<span id="cb10-27">            documents.append(doc)</span>
<span id="cb10-28">            current_chunk <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> []</span>
<span id="cb10-29">            current_size <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">0</span></span>
<span id="cb10-30">        </span>
<span id="cb10-31">        <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># 현재 단락 추가</span></span>
<span id="cb10-32">        current_chunk.append(content)</span>
<span id="cb10-33">        current_size <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+=</span> <span class="bu" style="color: null;
background-color: null;
font-style: inherit;">len</span>(content)</span>
<span id="cb10-34">        current_page <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> page_num</span>
<span id="cb10-35">        </span>
<span id="cb10-36">        <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># 최대 크기 초과 시 청크 분할</span></span>
<span id="cb10-37">        <span class="cf" style="color: #003B4F;
background-color: null;
font-style: inherit;">if</span> current_size <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">&gt;=</span> max_chunk_size:</span>
<span id="cb10-38">            doc <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> Document(</span>
<span id="cb10-39">                page_content<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"</span><span class="ch" style="color: #20794D;
background-color: null;
font-style: inherit;">\n\n</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"</span>.join(current_chunk),</span>
<span id="cb10-40">                metadata<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span>{</span>
<span id="cb10-41">                    <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"page"</span>: current_page,</span>
<span id="cb10-42">                    <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"chunk_type"</span>: <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"paragraph"</span></span>
<span id="cb10-43">                }</span>
<span id="cb10-44">            )</span>
<span id="cb10-45">            documents.append(doc)</span>
<span id="cb10-46">            current_chunk <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> []</span>
<span id="cb10-47">            current_size <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">0</span></span>
<span id="cb10-48">    </span>
<span id="cb10-49">    <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># 마지막 청크</span></span>
<span id="cb10-50">    <span class="cf" style="color: #003B4F;
background-color: null;
font-style: inherit;">if</span> current_chunk:</span>
<span id="cb10-51">        doc <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> Document(</span>
<span id="cb10-52">            page_content<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"</span><span class="ch" style="color: #20794D;
background-color: null;
font-style: inherit;">\n\n</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"</span>.join(current_chunk),</span>
<span id="cb10-53">            metadata<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span>{</span>
<span id="cb10-54">                <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"page"</span>: current_page,</span>
<span id="cb10-55">                <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"chunk_type"</span>: <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"paragraph"</span></span>
<span id="cb10-56">            }</span>
<span id="cb10-57">        )</span>
<span id="cb10-58">        documents.append(doc)</span>
<span id="cb10-59">    </span>
<span id="cb10-60">    <span class="cf" style="color: #003B4F;
background-color: null;
font-style: inherit;">return</span> documents</span>
<span id="cb10-61"></span>
<span id="cb10-62"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># 사용 예시</span></span>
<span id="cb10-63">documents <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> split_by_layout(result, max_chunk_size<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1000</span>)</span>
<span id="cb10-64"><span class="bu" style="color: null;
background-color: null;
font-style: inherit;">print</span>(<span class="ss" style="color: #20794D;
background-color: null;
font-style: inherit;">f"생성된 청크 수: </span><span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">{</span><span class="bu" style="color: null;
background-color: null;
font-style: inherit;">len</span>(documents)<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">}</span><span class="ss" style="color: #20794D;
background-color: null;
font-style: inherit;">"</span>)</span>
<span id="cb10-65"><span class="bu" style="color: null;
background-color: null;
font-style: inherit;">print</span>(<span class="ss" style="color: #20794D;
background-color: null;
font-style: inherit;">f"</span><span class="ch" style="color: #20794D;
background-color: null;
font-style: inherit;">\n</span><span class="ss" style="color: #20794D;
background-color: null;
font-style: inherit;">첫 번째 청크 (앞 300자):</span><span class="ch" style="color: #20794D;
background-color: null;
font-style: inherit;">\n</span><span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">{</span>documents[<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">0</span>]<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">.</span>page_content[:<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">300</span>]<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">}</span><span class="ss" style="color: #20794D;
background-color: null;
font-style: inherit;">"</span>)</span></code></pre></div>
</details>
</div>
</section>
<section id="azure-blob-storage-연동" class="level2" data-number="9">
<h2 data-number="9" class="anchored" data-anchor-id="azure-blob-storage-연동"><span class="header-section-number">9</span> Azure Blob Storage 연동</h2>
<section id="blob에서-직접-분석" class="level3" data-number="9.1">
<h3 data-number="9.1" class="anchored" data-anchor-id="blob에서-직접-분석"><span class="header-section-number">9.1</span> Blob에서 직접 분석</h3>
<div id="752ecba4" class="cell" data-execution_count="8">
<details class="code-fold">
<summary>코드</summary>
<div class="sourceCode cell-code" id="cb11" style="background: #f1f3f5;"><pre class="sourceCode numberSource python number-lines code-with-copy"><code class="sourceCode python"><span id="cb11-1"><span class="im" style="color: #00769E;
background-color: null;
font-style: inherit;">from</span> azure.storage.blob <span class="im" style="color: #00769E;
background-color: null;
font-style: inherit;">import</span> BlobServiceClient</span>
<span id="cb11-2"></span>
<span id="cb11-3"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># Blob Storage 클라이언트</span></span>
<span id="cb11-4">blob_service_client <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> BlobServiceClient.from_connection_string(</span>
<span id="cb11-5">    os.getenv(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"AZURE_STORAGE_CONNECTION_STRING"</span>)</span>
<span id="cb11-6">)</span>
<span id="cb11-7"></span>
<span id="cb11-8"><span class="kw" style="color: #003B4F;
background-color: null;
font-style: inherit;">def</span> analyze_blob_document(container_name: <span class="bu" style="color: null;
background-color: null;
font-style: inherit;">str</span>, blob_name: <span class="bu" style="color: null;
background-color: null;
font-style: inherit;">str</span>):</span>
<span id="cb11-9">    <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">"""Blob Storage의 문서를 Document Intelligence로 분석"""</span></span>
<span id="cb11-10">    </span>
<span id="cb11-11">    <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># Blob SAS URL 생성</span></span>
<span id="cb11-12">    <span class="im" style="color: #00769E;
background-color: null;
font-style: inherit;">from</span> azure.storage.blob <span class="im" style="color: #00769E;
background-color: null;
font-style: inherit;">import</span> generate_blob_sas, BlobSasPermissions</span>
<span id="cb11-13">    <span class="im" style="color: #00769E;
background-color: null;
font-style: inherit;">from</span> datetime <span class="im" style="color: #00769E;
background-color: null;
font-style: inherit;">import</span> datetime, timedelta</span>
<span id="cb11-14">    </span>
<span id="cb11-15">    sas_token <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> generate_blob_sas(</span>
<span id="cb11-16">        account_name<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"stragdocs2025"</span>,</span>
<span id="cb11-17">        container_name<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span>container_name,</span>
<span id="cb11-18">        blob_name<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span>blob_name,</span>
<span id="cb11-19">        account_key<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span>os.getenv(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"AZURE_STORAGE_KEY"</span>),</span>
<span id="cb11-20">        permission<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span>BlobSasPermissions(read<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span><span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">True</span>),</span>
<span id="cb11-21">        expiry<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span>datetime.utcnow() <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span> timedelta(hours<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span>)</span>
<span id="cb11-22">    )</span>
<span id="cb11-23">    </span>
<span id="cb11-24">    blob_url <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> <span class="ss" style="color: #20794D;
background-color: null;
font-style: inherit;">f"https://stragdocs2025.blob.core.windows.net/</span><span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">{</span>container_name<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">}</span><span class="ss" style="color: #20794D;
background-color: null;
font-style: inherit;">/</span><span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">{</span>blob_name<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">}</span><span class="ss" style="color: #20794D;
background-color: null;
font-style: inherit;">?</span><span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">{</span>sas_token<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">}</span><span class="ss" style="color: #20794D;
background-color: null;
font-style: inherit;">"</span></span>
<span id="cb11-25">    </span>
<span id="cb11-26">    <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># Document Intelligence로 분석</span></span>
<span id="cb11-27">    poller <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> document_analysis_client.begin_analyze_document_from_url(</span>
<span id="cb11-28">        <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"prebuilt-layout"</span>, document_url<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span>blob_url</span>
<span id="cb11-29">    )</span>
<span id="cb11-30">    result <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> poller.result()</span>
<span id="cb11-31">    </span>
<span id="cb11-32">    <span class="cf" style="color: #003B4F;
background-color: null;
font-style: inherit;">return</span> result</span>
<span id="cb11-33"></span>
<span id="cb11-34"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># 사용 예시</span></span>
<span id="cb11-35">result <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> analyze_blob_document(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"rag-documents"</span>, <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"sample.pdf"</span>)</span>
<span id="cb11-36"><span class="bu" style="color: null;
background-color: null;
font-style: inherit;">print</span>(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Blob 문서 분석 완료"</span>)</span></code></pre></div>
</details>
</div>
</section>
<section id="배치-처리" class="level3" data-number="9.2">
<h3 data-number="9.2" class="anchored" data-anchor-id="배치-처리"><span class="header-section-number">9.2</span> 배치 처리</h3>
<div id="cbccdc44" class="cell" data-execution_count="9">
<details class="code-fold">
<summary>코드</summary>
<div class="sourceCode cell-code" id="cb12" style="background: #f1f3f5;"><pre class="sourceCode numberSource python number-lines code-with-copy"><code class="sourceCode python"><span id="cb12-1"><span class="kw" style="color: #003B4F;
background-color: null;
font-style: inherit;">def</span> analyze_all_blobs(container_name: <span class="bu" style="color: null;
background-color: null;
font-style: inherit;">str</span>):</span>
<span id="cb12-2">    <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">"""컨테이너의 모든 문서 분석"""</span></span>
<span id="cb12-3">    container_client <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> blob_service_client.get_container_client(container_name)</span>
<span id="cb12-4">    blob_list <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> container_client.list_blobs()</span>
<span id="cb12-5">    </span>
<span id="cb12-6">    results <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> []</span>
<span id="cb12-7">    <span class="cf" style="color: #003B4F;
background-color: null;
font-style: inherit;">for</span> blob <span class="kw" style="color: #003B4F;
background-color: null;
font-style: inherit;">in</span> blob_list:</span>
<span id="cb12-8">        <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># PDF 파일만 처리</span></span>
<span id="cb12-9">        <span class="cf" style="color: #003B4F;
background-color: null;
font-style: inherit;">if</span> blob.name.endswith(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">'.pdf'</span>):</span>
<span id="cb12-10">            <span class="bu" style="color: null;
background-color: null;
font-style: inherit;">print</span>(<span class="ss" style="color: #20794D;
background-color: null;
font-style: inherit;">f"분석 중: </span><span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">{</span>blob<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">.</span>name<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">}</span><span class="ss" style="color: #20794D;
background-color: null;
font-style: inherit;">"</span>)</span>
<span id="cb12-11">            <span class="cf" style="color: #003B4F;
background-color: null;
font-style: inherit;">try</span>:</span>
<span id="cb12-12">                result <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> analyze_blob_document(container_name, blob.name)</span>
<span id="cb12-13">                text <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> extract_full_text(result)</span>
<span id="cb12-14">                </span>
<span id="cb12-15">                results.append({</span>
<span id="cb12-16">                    <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"blob_name"</span>: blob.name,</span>
<span id="cb12-17">                    <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"page_count"</span>: <span class="bu" style="color: null;
background-color: null;
font-style: inherit;">len</span>(result.pages),</span>
<span id="cb12-18">                    <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"text"</span>: text,</span>
<span id="cb12-19">                    <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"status"</span>: <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"success"</span></span>
<span id="cb12-20">                })</span>
<span id="cb12-21">            <span class="cf" style="color: #003B4F;
background-color: null;
font-style: inherit;">except</span> <span class="pp" style="color: #AD0000;
background-color: null;
font-style: inherit;">Exception</span> <span class="im" style="color: #00769E;
background-color: null;
font-style: inherit;">as</span> e:</span>
<span id="cb12-22">                <span class="bu" style="color: null;
background-color: null;
font-style: inherit;">print</span>(<span class="ss" style="color: #20794D;
background-color: null;
font-style: inherit;">f"오류: </span><span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">{</span>blob<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">.</span>name<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">}</span><span class="ss" style="color: #20794D;
background-color: null;
font-style: inherit;"> - </span><span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">{</span><span class="bu" style="color: null;
background-color: null;
font-style: inherit;">str</span>(e)<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">}</span><span class="ss" style="color: #20794D;
background-color: null;
font-style: inherit;">"</span>)</span>
<span id="cb12-23">                results.append({</span>
<span id="cb12-24">                    <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"blob_name"</span>: blob.name,</span>
<span id="cb12-25">                    <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"status"</span>: <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"error"</span>,</span>
<span id="cb12-26">                    <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"error"</span>: <span class="bu" style="color: null;
background-color: null;
font-style: inherit;">str</span>(e)</span>
<span id="cb12-27">                })</span>
<span id="cb12-28">    </span>
<span id="cb12-29">    <span class="cf" style="color: #003B4F;
background-color: null;
font-style: inherit;">return</span> results</span>
<span id="cb12-30"></span>
<span id="cb12-31"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># 사용 예시</span></span>
<span id="cb12-32"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># results = analyze_all_blobs("rag-documents")</span></span>
<span id="cb12-33"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># print(f"총 {len(results)}개 문서 처리 완료")</span></span></code></pre></div>
</details>
</div>
</section>
</section>
<section id="read-api-사용-경량-ocr" class="level2" data-number="10">
<h2 data-number="10" class="anchored" data-anchor-id="read-api-사용-경량-ocr"><span class="header-section-number">10</span> Read API 사용 (경량 OCR)</h2>
<p>단순 텍스트 추출만 필요할 경우 Read API가 더 빠르고 저렴하다.</p>
<div id="1afe91d2" class="cell" data-execution_count="10">
<details class="code-fold">
<summary>코드</summary>
<div class="sourceCode cell-code" id="cb13" style="background: #f1f3f5;"><pre class="sourceCode numberSource python number-lines code-with-copy"><code class="sourceCode python"><span id="cb13-1"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># Read API로 문서 분석</span></span>
<span id="cb13-2"><span class="cf" style="color: #003B4F;
background-color: null;
font-style: inherit;">with</span> <span class="bu" style="color: null;
background-color: null;
font-style: inherit;">open</span>(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"simple_document.pdf"</span>, <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"rb"</span>) <span class="im" style="color: #00769E;
background-color: null;
font-style: inherit;">as</span> f:</span>
<span id="cb13-3">    poller <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> document_analysis_client.begin_analyze_document(</span>
<span id="cb13-4">        <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"prebuilt-read"</span>, document<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span>f</span>
<span id="cb13-5">    )</span>
<span id="cb13-6">    result <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> poller.result()</span>
<span id="cb13-7"></span>
<span id="cb13-8"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># 텍스트만 추출 (레이아웃 무시)</span></span>
<span id="cb13-9">full_text <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> result.content</span>
<span id="cb13-10"><span class="bu" style="color: null;
background-color: null;
font-style: inherit;">print</span>(<span class="ss" style="color: #20794D;
background-color: null;
font-style: inherit;">f"추출된 텍스트:</span><span class="ch" style="color: #20794D;
background-color: null;
font-style: inherit;">\n</span><span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">{</span>full_text<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">}</span><span class="ss" style="color: #20794D;
background-color: null;
font-style: inherit;">"</span>)</span></code></pre></div>
</details>
</div>
<p><strong>Layout vs Read 비교:</strong> | 항목 | Layout API | Read API | |——|———–|———-| | <strong>가격</strong> | $0.01/페이지 | $0.0015/페이지 | | <strong>속도</strong> | 느림 | 빠름 | | <strong>구조 정보</strong> | ✅ (제목, 표, 단락) | ❌ | | <strong>RAG 권장</strong> | 복잡한 문서 | 간단한 텍스트 문서 |</p>
</section>
<section id="한국어-문서-최적화" class="level2" data-number="11">
<h2 data-number="11" class="anchored" data-anchor-id="한국어-문서-최적화"><span class="header-section-number">11</span> 한국어 문서 최적화</h2>
<section id="언어-힌트-제공" class="level3" data-number="11.1">
<h3 data-number="11.1" class="anchored" data-anchor-id="언어-힌트-제공"><span class="header-section-number">11.1</span> 언어 힌트 제공</h3>
<div id="c5735580" class="cell" data-execution_count="11">
<details class="code-fold">
<summary>코드</summary>
<div class="sourceCode cell-code" id="cb14" style="background: #f1f3f5;"><pre class="sourceCode numberSource python number-lines code-with-copy"><code class="sourceCode python"><span id="cb14-1"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># 한국어 문서 분석 (언어 힌트)</span></span>
<span id="cb14-2"><span class="cf" style="color: #003B4F;
background-color: null;
font-style: inherit;">with</span> <span class="bu" style="color: null;
background-color: null;
font-style: inherit;">open</span>(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"korean_document.pdf"</span>, <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"rb"</span>) <span class="im" style="color: #00769E;
background-color: null;
font-style: inherit;">as</span> f:</span>
<span id="cb14-3">    poller <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> document_analysis_client.begin_analyze_document(</span>
<span id="cb14-4">        <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"prebuilt-layout"</span>,</span>
<span id="cb14-5">        document<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span>f,</span>
<span id="cb14-6">        locale<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"ko-KR"</span>  <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># 한국어 힌트</span></span>
<span id="cb14-7">    )</span>
<span id="cb14-8">    result <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> poller.result()</span>
<span id="cb14-9"></span>
<span id="cb14-10"><span class="bu" style="color: null;
background-color: null;
font-style: inherit;">print</span>(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"한국어 문서 분석 완료"</span>)</span></code></pre></div>
</details>
</div>
</section>
<section id="한글-ocr-후처리" class="level3" data-number="11.2">
<h3 data-number="11.2" class="anchored" data-anchor-id="한글-ocr-후처리"><span class="header-section-number">11.2</span> 한글 OCR 후처리</h3>
<div id="24fea624" class="cell" data-execution_count="12">
<details class="code-fold">
<summary>코드</summary>
<div class="sourceCode cell-code" id="cb15" style="background: #f1f3f5;"><pre class="sourceCode numberSource python number-lines code-with-copy"><code class="sourceCode python"><span id="cb15-1"><span class="im" style="color: #00769E;
background-color: null;
font-style: inherit;">import</span> re</span>
<span id="cb15-2"></span>
<span id="cb15-3"><span class="kw" style="color: #003B4F;
background-color: null;
font-style: inherit;">def</span> clean_korean_text(text: <span class="bu" style="color: null;
background-color: null;
font-style: inherit;">str</span>) <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">-&gt;</span> <span class="bu" style="color: null;
background-color: null;
font-style: inherit;">str</span>:</span>
<span id="cb15-4">    <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">"""한글 OCR 결과 정리"""</span></span>
<span id="cb15-5">    <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># 불필요한 공백 제거</span></span>
<span id="cb15-6">    text <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> re.sub(<span class="vs" style="color: #20794D;
background-color: null;
font-style: inherit;">r'\s+'</span>, <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">' '</span>, text)</span>
<span id="cb15-7">    </span>
<span id="cb15-8">    <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># 줄바꿈 정리</span></span>
<span id="cb15-9">    text <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> re.sub(<span class="vs" style="color: #20794D;
background-color: null;
font-style: inherit;">r'\n\s*\n'</span>, <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">'</span><span class="ch" style="color: #20794D;
background-color: null;
font-style: inherit;">\n\n</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">'</span>, text)</span>
<span id="cb15-10">    </span>
<span id="cb15-11">    <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># 특수문자 정리</span></span>
<span id="cb15-12">    text <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> text.replace(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">'〃'</span>, <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">'"'</span>).replace(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">'〃'</span>, <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">'"'</span>)</span>
<span id="cb15-13">    </span>
<span id="cb15-14">    <span class="cf" style="color: #003B4F;
background-color: null;
font-style: inherit;">return</span> text.strip()</span>
<span id="cb15-15"></span>
<span id="cb15-16"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># 사용 예시</span></span>
<span id="cb15-17">raw_text <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> extract_full_text(result)</span>
<span id="cb15-18">cleaned_text <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> clean_korean_text(raw_text)</span>
<span id="cb15-19"><span class="bu" style="color: null;
background-color: null;
font-style: inherit;">print</span>(<span class="ss" style="color: #20794D;
background-color: null;
font-style: inherit;">f"정리된 텍스트:</span><span class="ch" style="color: #20794D;
background-color: null;
font-style: inherit;">\n</span><span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">{</span>cleaned_text[:<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">500</span>]<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">}</span><span class="ss" style="color: #20794D;
background-color: null;
font-style: inherit;">"</span>)</span></code></pre></div>
</details>
</div>
</section>
</section>
<section id="langchain-통합" class="level2" data-number="12">
<h2 data-number="12" class="anchored" data-anchor-id="langchain-통합"><span class="header-section-number">12</span> LangChain 통합</h2>
<section id="azureaidocumentintelligenceloader" class="level3" data-number="12.1">
<h3 data-number="12.1" class="anchored" data-anchor-id="azureaidocumentintelligenceloader"><span class="header-section-number">12.1</span> AzureAIDocumentIntelligenceLoader</h3>
<div id="985d6882" class="cell" data-execution_count="13">
<details class="code-fold">
<summary>코드</summary>
<div class="sourceCode cell-code" id="cb16" style="background: #f1f3f5;"><pre class="sourceCode numberSource python number-lines code-with-copy"><code class="sourceCode python"><span id="cb16-1"><span class="im" style="color: #00769E;
background-color: null;
font-style: inherit;">from</span> langchain_community.document_loaders <span class="im" style="color: #00769E;
background-color: null;
font-style: inherit;">import</span> AzureAIDocumentIntelligenceLoader</span>
<span id="cb16-2"></span>
<span id="cb16-3"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># Document Intelligence Loader 생성</span></span>
<span id="cb16-4">loader <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> AzureAIDocumentIntelligenceLoader(</span>
<span id="cb16-5">    api_endpoint<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span>endpoint,</span>
<span id="cb16-6">    api_key<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span>key,</span>
<span id="cb16-7">    file_path<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"sample.pdf"</span>,</span>
<span id="cb16-8">    api_model<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"prebuilt-layout"</span></span>
<span id="cb16-9">)</span>
<span id="cb16-10"></span>
<span id="cb16-11"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># 문서 로딩</span></span>
<span id="cb16-12">documents <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> loader.load()</span>
<span id="cb16-13"></span>
<span id="cb16-14"><span class="bu" style="color: null;
background-color: null;
font-style: inherit;">print</span>(<span class="ss" style="color: #20794D;
background-color: null;
font-style: inherit;">f"로딩된 문서 수: </span><span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">{</span><span class="bu" style="color: null;
background-color: null;
font-style: inherit;">len</span>(documents)<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">}</span><span class="ss" style="color: #20794D;
background-color: null;
font-style: inherit;">"</span>)</span>
<span id="cb16-15"><span class="bu" style="color: null;
background-color: null;
font-style: inherit;">print</span>(<span class="ss" style="color: #20794D;
background-color: null;
font-style: inherit;">f"첫 번째 청크:</span><span class="ch" style="color: #20794D;
background-color: null;
font-style: inherit;">\n</span><span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">{</span>documents[<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">0</span>]<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">.</span>page_content[:<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">300</span>]<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">}</span><span class="ss" style="color: #20794D;
background-color: null;
font-style: inherit;">"</span>)</span>
<span id="cb16-16"><span class="bu" style="color: null;
background-color: null;
font-style: inherit;">print</span>(<span class="ss" style="color: #20794D;
background-color: null;
font-style: inherit;">f"메타데이터: </span><span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">{</span>documents[<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">0</span>]<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">.</span>metadata<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">}</span><span class="ss" style="color: #20794D;
background-color: null;
font-style: inherit;">"</span>)</span></code></pre></div>
</details>
</div>
</section>
<section id="rag-파이프라인-통합" class="level3" data-number="12.2">
<h3 data-number="12.2" class="anchored" data-anchor-id="rag-파이프라인-통합"><span class="header-section-number">12.2</span> RAG 파이프라인 통합</h3>
<div id="b376f4a0" class="cell" data-execution_count="14">
<details class="code-fold">
<summary>코드</summary>
<div class="sourceCode cell-code" id="cb17" style="background: #f1f3f5;"><pre class="sourceCode numberSource python number-lines code-with-copy"><code class="sourceCode python"><span id="cb17-1"><span class="im" style="color: #00769E;
background-color: null;
font-style: inherit;">from</span> langchain.text_splitter <span class="im" style="color: #00769E;
background-color: null;
font-style: inherit;">import</span> RecursiveCharacterTextSplitter</span>
<span id="cb17-2"></span>
<span id="cb17-3"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># Document Intelligence로 문서 로딩</span></span>
<span id="cb17-4">loader <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> AzureAIDocumentIntelligenceLoader(</span>
<span id="cb17-5">    api_endpoint<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span>endpoint,</span>
<span id="cb17-6">    api_key<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span>key,</span>
<span id="cb17-7">    file_path<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"long_document.pdf"</span>,</span>
<span id="cb17-8">    api_model<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"prebuilt-layout"</span></span>
<span id="cb17-9">)</span>
<span id="cb17-10">documents <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> loader.load()</span>
<span id="cb17-11"></span>
<span id="cb17-12"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># 텍스트 분할 (레이아웃 고려)</span></span>
<span id="cb17-13">text_splitter <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> RecursiveCharacterTextSplitter(</span>
<span id="cb17-14">    chunk_size<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1000</span>,</span>
<span id="cb17-15">    chunk_overlap<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">200</span>,</span>
<span id="cb17-16">    separators<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span>[<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"</span><span class="ch" style="color: #20794D;
background-color: null;
font-style: inherit;">\n\n</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"</span>, <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"</span><span class="ch" style="color: #20794D;
background-color: null;
font-style: inherit;">\n</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"</span>, <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">" "</span>, <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">""</span>]</span>
<span id="cb17-17">)</span>
<span id="cb17-18">splits <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> text_splitter.split_documents(documents)</span>
<span id="cb17-19"></span>
<span id="cb17-20"><span class="bu" style="color: null;
background-color: null;
font-style: inherit;">print</span>(<span class="ss" style="color: #20794D;
background-color: null;
font-style: inherit;">f"총 </span><span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">{</span><span class="bu" style="color: null;
background-color: null;
font-style: inherit;">len</span>(splits)<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">}</span><span class="ss" style="color: #20794D;
background-color: null;
font-style: inherit;">개 청크 생성"</span>)</span></code></pre></div>
</details>
</div>
</section>
</section>
<section id="비용-최적화" class="level2" data-number="13">
<h2 data-number="13" class="anchored" data-anchor-id="비용-최적화"><span class="header-section-number">13</span> 비용 최적화</h2>
<section id="캐싱-전략" class="level3" data-number="13.1">
<h3 data-number="13.1" class="anchored" data-anchor-id="캐싱-전략"><span class="header-section-number">13.1</span> 캐싱 전략</h3>
<div id="00050004" class="cell" data-execution_count="15">
<details class="code-fold">
<summary>코드</summary>
<div class="sourceCode cell-code" id="cb18" style="background: #f1f3f5;"><pre class="sourceCode numberSource python number-lines code-with-copy"><code class="sourceCode python"><span id="cb18-1"><span class="im" style="color: #00769E;
background-color: null;
font-style: inherit;">import</span> json</span>
<span id="cb18-2"><span class="im" style="color: #00769E;
background-color: null;
font-style: inherit;">import</span> hashlib</span>
<span id="cb18-3"></span>
<span id="cb18-4"><span class="kw" style="color: #003B4F;
background-color: null;
font-style: inherit;">def</span> get_cache_key(file_path: <span class="bu" style="color: null;
background-color: null;
font-style: inherit;">str</span>) <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">-&gt;</span> <span class="bu" style="color: null;
background-color: null;
font-style: inherit;">str</span>:</span>
<span id="cb18-5">    <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">"""파일 해시로 캐시 키 생성"""</span></span>
<span id="cb18-6">    <span class="cf" style="color: #003B4F;
background-color: null;
font-style: inherit;">with</span> <span class="bu" style="color: null;
background-color: null;
font-style: inherit;">open</span>(file_path, <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"rb"</span>) <span class="im" style="color: #00769E;
background-color: null;
font-style: inherit;">as</span> f:</span>
<span id="cb18-7">        file_hash <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> hashlib.md5(f.read()).hexdigest()</span>
<span id="cb18-8">    <span class="cf" style="color: #003B4F;
background-color: null;
font-style: inherit;">return</span> <span class="ss" style="color: #20794D;
background-color: null;
font-style: inherit;">f"doc_intel_</span><span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">{</span>file_hash<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">}</span><span class="ss" style="color: #20794D;
background-color: null;
font-style: inherit;">"</span></span>
<span id="cb18-9"></span>
<span id="cb18-10"><span class="kw" style="color: #003B4F;
background-color: null;
font-style: inherit;">def</span> analyze_with_cache(file_path: <span class="bu" style="color: null;
background-color: null;
font-style: inherit;">str</span>):</span>
<span id="cb18-11">    <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">"""캐싱을 사용한 문서 분석"""</span></span>
<span id="cb18-12">    cache_key <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> get_cache_key(file_path)</span>
<span id="cb18-13">    cache_file <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> <span class="ss" style="color: #20794D;
background-color: null;
font-style: inherit;">f".cache/</span><span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">{</span>cache_key<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">}</span><span class="ss" style="color: #20794D;
background-color: null;
font-style: inherit;">.json"</span></span>
<span id="cb18-14">    </span>
<span id="cb18-15">    <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># 캐시 확인</span></span>
<span id="cb18-16">    <span class="cf" style="color: #003B4F;
background-color: null;
font-style: inherit;">try</span>:</span>
<span id="cb18-17">        <span class="cf" style="color: #003B4F;
background-color: null;
font-style: inherit;">with</span> <span class="bu" style="color: null;
background-color: null;
font-style: inherit;">open</span>(cache_file, <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"r"</span>, encoding<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"utf-8"</span>) <span class="im" style="color: #00769E;
background-color: null;
font-style: inherit;">as</span> f:</span>
<span id="cb18-18">            cached_result <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> json.load(f)</span>
<span id="cb18-19">            <span class="bu" style="color: null;
background-color: null;
font-style: inherit;">print</span>(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"캐시에서 결과 로딩"</span>)</span>
<span id="cb18-20">            <span class="cf" style="color: #003B4F;
background-color: null;
font-style: inherit;">return</span> cached_result</span>
<span id="cb18-21">    <span class="cf" style="color: #003B4F;
background-color: null;
font-style: inherit;">except</span> <span class="pp" style="color: #AD0000;
background-color: null;
font-style: inherit;">FileNotFoundError</span>:</span>
<span id="cb18-22">        <span class="cf" style="color: #003B4F;
background-color: null;
font-style: inherit;">pass</span></span>
<span id="cb18-23">    </span>
<span id="cb18-24">    <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># Document Intelligence 실행</span></span>
<span id="cb18-25">    <span class="cf" style="color: #003B4F;
background-color: null;
font-style: inherit;">with</span> <span class="bu" style="color: null;
background-color: null;
font-style: inherit;">open</span>(file_path, <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"rb"</span>) <span class="im" style="color: #00769E;
background-color: null;
font-style: inherit;">as</span> f:</span>
<span id="cb18-26">        poller <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> document_analysis_client.begin_analyze_document(</span>
<span id="cb18-27">            <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"prebuilt-layout"</span>, document<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span>f</span>
<span id="cb18-28">        )</span>
<span id="cb18-29">        result <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> poller.result()</span>
<span id="cb18-30">    </span>
<span id="cb18-31">    <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># 결과를 딕셔너리로 변환</span></span>
<span id="cb18-32">    result_dict <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> {</span>
<span id="cb18-33">        <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"content"</span>: result.content,</span>
<span id="cb18-34">        <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"pages"</span>: [{<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"page_number"</span>: p.page_number, <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"width"</span>: p.width, <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"height"</span>: p.height} <span class="cf" style="color: #003B4F;
background-color: null;
font-style: inherit;">for</span> p <span class="kw" style="color: #003B4F;
background-color: null;
font-style: inherit;">in</span> result.pages],</span>
<span id="cb18-35">        <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"paragraphs"</span>: [{<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"content"</span>: p.content, <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"role"</span>: p.role} <span class="cf" style="color: #003B4F;
background-color: null;
font-style: inherit;">for</span> p <span class="kw" style="color: #003B4F;
background-color: null;
font-style: inherit;">in</span> result.paragraphs]</span>
<span id="cb18-36">    }</span>
<span id="cb18-37">    </span>
<span id="cb18-38">    <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># 캐시 저장</span></span>
<span id="cb18-39">    os.makedirs(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">".cache"</span>, exist_ok<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span><span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">True</span>)</span>
<span id="cb18-40">    <span class="cf" style="color: #003B4F;
background-color: null;
font-style: inherit;">with</span> <span class="bu" style="color: null;
background-color: null;
font-style: inherit;">open</span>(cache_file, <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"w"</span>, encoding<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"utf-8"</span>) <span class="im" style="color: #00769E;
background-color: null;
font-style: inherit;">as</span> f:</span>
<span id="cb18-41">        json.dump(result_dict, f, ensure_ascii<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span><span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">False</span>, indent<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">2</span>)</span>
<span id="cb18-42">    </span>
<span id="cb18-43">    <span class="bu" style="color: null;
background-color: null;
font-style: inherit;">print</span>(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Document Intelligence 실행 및 캐시 저장"</span>)</span>
<span id="cb18-44">    <span class="cf" style="color: #003B4F;
background-color: null;
font-style: inherit;">return</span> result_dict</span>
<span id="cb18-45"></span>
<span id="cb18-46"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># 사용 예시</span></span>
<span id="cb18-47"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># cached_result = analyze_with_cache("sample.pdf")</span></span></code></pre></div>
</details>
</div>
</section>
<section id="배치-크기-조정" class="level3" data-number="13.2">
<h3 data-number="13.2" class="anchored" data-anchor-id="배치-크기-조정"><span class="header-section-number">13.2</span> 배치 크기 조정</h3>
<div id="0a5815b5" class="cell" data-execution_count="16">
<details class="code-fold">
<summary>코드</summary>
<div class="sourceCode cell-code" id="cb19" style="background: #f1f3f5;"><pre class="sourceCode numberSource python number-lines code-with-copy"><code class="sourceCode python"><span id="cb19-1"><span class="kw" style="color: #003B4F;
background-color: null;
font-style: inherit;">def</span> analyze_documents_batch(file_paths: List[<span class="bu" style="color: null;
background-color: null;
font-style: inherit;">str</span>], batch_size: <span class="bu" style="color: null;
background-color: null;
font-style: inherit;">int</span> <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">5</span>):</span>
<span id="cb19-2">    <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">"""배치 단위로 문서 분석 (API 제한 고려)"""</span></span>
<span id="cb19-3">    <span class="im" style="color: #00769E;
background-color: null;
font-style: inherit;">import</span> time</span>
<span id="cb19-4">    </span>
<span id="cb19-5">    results <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> []</span>
<span id="cb19-6">    <span class="cf" style="color: #003B4F;
background-color: null;
font-style: inherit;">for</span> i <span class="kw" style="color: #003B4F;
background-color: null;
font-style: inherit;">in</span> <span class="bu" style="color: null;
background-color: null;
font-style: inherit;">range</span>(<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">0</span>, <span class="bu" style="color: null;
background-color: null;
font-style: inherit;">len</span>(file_paths), batch_size):</span>
<span id="cb19-7">        batch <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> file_paths[i:i<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span>batch_size]</span>
<span id="cb19-8">        </span>
<span id="cb19-9">        <span class="bu" style="color: null;
background-color: null;
font-style: inherit;">print</span>(<span class="ss" style="color: #20794D;
background-color: null;
font-style: inherit;">f"배치 </span><span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">{</span>i<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">//</span>batch_size <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span><span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">}</span><span class="ss" style="color: #20794D;
background-color: null;
font-style: inherit;"> 처리 중 (</span><span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">{</span><span class="bu" style="color: null;
background-color: null;
font-style: inherit;">len</span>(batch)<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">}</span><span class="ss" style="color: #20794D;
background-color: null;
font-style: inherit;">개 파일)"</span>)</span>
<span id="cb19-10">        <span class="cf" style="color: #003B4F;
background-color: null;
font-style: inherit;">for</span> file_path <span class="kw" style="color: #003B4F;
background-color: null;
font-style: inherit;">in</span> batch:</span>
<span id="cb19-11">            <span class="cf" style="color: #003B4F;
background-color: null;
font-style: inherit;">with</span> <span class="bu" style="color: null;
background-color: null;
font-style: inherit;">open</span>(file_path, <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"rb"</span>) <span class="im" style="color: #00769E;
background-color: null;
font-style: inherit;">as</span> f:</span>
<span id="cb19-12">                poller <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> document_analysis_client.begin_analyze_document(</span>
<span id="cb19-13">                    <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"prebuilt-layout"</span>, document<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span>f</span>
<span id="cb19-14">                )</span>
<span id="cb19-15">                result <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> poller.result()</span>
<span id="cb19-16">                results.append({</span>
<span id="cb19-17">                    <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"file"</span>: file_path,</span>
<span id="cb19-18">                    <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"result"</span>: result</span>
<span id="cb19-19">                })</span>
<span id="cb19-20">        </span>
<span id="cb19-21">        <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># API 제한 방지 (초당 15 요청)</span></span>
<span id="cb19-22">        time.sleep(<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span>)</span>
<span id="cb19-23">    </span>
<span id="cb19-24">    <span class="cf" style="color: #003B4F;
background-color: null;
font-style: inherit;">return</span> results</span>
<span id="cb19-25"></span>
<span id="cb19-26"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># 사용 예시</span></span>
<span id="cb19-27"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># file_list = ["doc1.pdf", "doc2.pdf", "doc3.pdf"]</span></span>
<span id="cb19-28"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># results = analyze_documents_batch(file_list, batch_size=5)</span></span></code></pre></div>
</details>
</div>
</section>
</section>
<section id="모니터링" class="level2" data-number="14">
<h2 data-number="14" class="anchored" data-anchor-id="모니터링"><span class="header-section-number">14</span> 모니터링</h2>
<section id="분석-통계-추적" class="level3" data-number="14.1">
<h3 data-number="14.1" class="anchored" data-anchor-id="분석-통계-추적"><span class="header-section-number">14.1</span> 분석 통계 추적</h3>
<div id="10fda9de" class="cell" data-execution_count="17">
<details class="code-fold">
<summary>코드</summary>
<div class="sourceCode cell-code" id="cb20" style="background: #f1f3f5;"><pre class="sourceCode numberSource python number-lines code-with-copy"><code class="sourceCode python"><span id="cb20-1"><span class="kw" style="color: #003B4F;
background-color: null;
font-style: inherit;">def</span> analyze_with_metrics(file_path: <span class="bu" style="color: null;
background-color: null;
font-style: inherit;">str</span>):</span>
<span id="cb20-2">    <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">"""분석 메트릭 추적"""</span></span>
<span id="cb20-3">    <span class="im" style="color: #00769E;
background-color: null;
font-style: inherit;">import</span> time</span>
<span id="cb20-4">    </span>
<span id="cb20-5">    start_time <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> time.time()</span>
<span id="cb20-6">    </span>
<span id="cb20-7">    <span class="cf" style="color: #003B4F;
background-color: null;
font-style: inherit;">with</span> <span class="bu" style="color: null;
background-color: null;
font-style: inherit;">open</span>(file_path, <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"rb"</span>) <span class="im" style="color: #00769E;
background-color: null;
font-style: inherit;">as</span> f:</span>
<span id="cb20-8">        file_size <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> os.path.getsize(file_path)</span>
<span id="cb20-9">        </span>
<span id="cb20-10">        poller <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> document_analysis_client.begin_analyze_document(</span>
<span id="cb20-11">            <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"prebuilt-layout"</span>, document<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span>f</span>
<span id="cb20-12">        )</span>
<span id="cb20-13">        result <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> poller.result()</span>
<span id="cb20-14">    </span>
<span id="cb20-15">    end_time <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> time.time()</span>
<span id="cb20-16">    duration <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> end_time <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">-</span> start_time</span>
<span id="cb20-17">    </span>
<span id="cb20-18">    metrics <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> {</span>
<span id="cb20-19">        <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"file_path"</span>: file_path,</span>
<span id="cb20-20">        <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"file_size_mb"</span>: file_size <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">/</span> (<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1024</span> <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">*</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1024</span>),</span>
<span id="cb20-21">        <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"page_count"</span>: <span class="bu" style="color: null;
background-color: null;
font-style: inherit;">len</span>(result.pages),</span>
<span id="cb20-22">        <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"duration_seconds"</span>: duration,</span>
<span id="cb20-23">        <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"pages_per_second"</span>: <span class="bu" style="color: null;
background-color: null;
font-style: inherit;">len</span>(result.pages) <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">/</span> duration</span>
<span id="cb20-24">    }</span>
<span id="cb20-25">    </span>
<span id="cb20-26">    <span class="bu" style="color: null;
background-color: null;
font-style: inherit;">print</span>(<span class="ss" style="color: #20794D;
background-color: null;
font-style: inherit;">f"분석 완료:"</span>)</span>
<span id="cb20-27">    <span class="bu" style="color: null;
background-color: null;
font-style: inherit;">print</span>(<span class="ss" style="color: #20794D;
background-color: null;
font-style: inherit;">f"- 파일 크기: </span><span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">{</span>metrics[<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">'file_size_mb'</span>]<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">:.2f}</span><span class="ss" style="color: #20794D;
background-color: null;
font-style: inherit;"> MB"</span>)</span>
<span id="cb20-28">    <span class="bu" style="color: null;
background-color: null;
font-style: inherit;">print</span>(<span class="ss" style="color: #20794D;
background-color: null;
font-style: inherit;">f"- 페이지 수: </span><span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">{</span>metrics[<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">'page_count'</span>]<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">}</span><span class="ss" style="color: #20794D;
background-color: null;
font-style: inherit;">"</span>)</span>
<span id="cb20-29">    <span class="bu" style="color: null;
background-color: null;
font-style: inherit;">print</span>(<span class="ss" style="color: #20794D;
background-color: null;
font-style: inherit;">f"- 처리 시간: </span><span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">{</span>metrics[<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">'duration_seconds'</span>]<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">:.2f}</span><span class="ss" style="color: #20794D;
background-color: null;
font-style: inherit;">초"</span>)</span>
<span id="cb20-30">    <span class="bu" style="color: null;
background-color: null;
font-style: inherit;">print</span>(<span class="ss" style="color: #20794D;
background-color: null;
font-style: inherit;">f"- 속도: </span><span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">{</span>metrics[<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">'pages_per_second'</span>]<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">:.2f}</span><span class="ss" style="color: #20794D;
background-color: null;
font-style: inherit;"> 페이지/초"</span>)</span>
<span id="cb20-31">    </span>
<span id="cb20-32">    <span class="cf" style="color: #003B4F;
background-color: null;
font-style: inherit;">return</span> result, metrics</span>
<span id="cb20-33"></span>
<span id="cb20-34"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># 사용 예시</span></span>
<span id="cb20-35"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># result, metrics = analyze_with_metrics("large_document.pdf")</span></span></code></pre></div>
</details>
</div>
</section>
</section>
<section id="문제-해결" class="level2" data-number="15">
<h2 data-number="15" class="anchored" data-anchor-id="문제-해결"><span class="header-section-number">15</span> 문제 해결</h2>
<section id="일반적인-오류" class="level3" data-number="15.1">
<h3 data-number="15.1" class="anchored" data-anchor-id="일반적인-오류"><span class="header-section-number">15.1</span> 일반적인 오류</h3>
<p><strong>1. InvalidRequest: 파일 크기 초과</strong></p>
<pre><code>오류: 파일이 너무 큼 (최대 500MB)
해결: 파일을 분할하거나 압축</code></pre>
<p><strong>2. InvalidImage: 이미지 해상도 부족</strong></p>
<div class="sourceCode" id="cb22" style="background: #f1f3f5;"><pre class="sourceCode numberSource python number-lines code-with-copy"><code class="sourceCode python"><span id="cb22-1"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># 해결: 이미지 품질 확인 (최소 150 DPI 권장)</span></span>
<span id="cb22-2"><span class="im" style="color: #00769E;
background-color: null;
font-style: inherit;">from</span> PIL <span class="im" style="color: #00769E;
background-color: null;
font-style: inherit;">import</span> Image</span>
<span id="cb22-3"></span>
<span id="cb22-4">img <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> Image.<span class="bu" style="color: null;
background-color: null;
font-style: inherit;">open</span>(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"low_quality.png"</span>)</span>
<span id="cb22-5"><span class="bu" style="color: null;
background-color: null;
font-style: inherit;">print</span>(<span class="ss" style="color: #20794D;
background-color: null;
font-style: inherit;">f"해상도: </span><span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">{</span>img<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">.</span>size<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">}</span><span class="ss" style="color: #20794D;
background-color: null;
font-style: inherit;">"</span>)</span>
<span id="cb22-6"><span class="bu" style="color: null;
background-color: null;
font-style: inherit;">print</span>(<span class="ss" style="color: #20794D;
background-color: null;
font-style: inherit;">f"DPI: </span><span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">{</span>img<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">.</span>info<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">.</span>get(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">'dpi'</span>, <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">'Unknown'</span>)<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">}</span><span class="ss" style="color: #20794D;
background-color: null;
font-style: inherit;">"</span>)</span></code></pre></div>
<p><strong>3. Unauthorized: 인증 실패</strong></p>
<div class="sourceCode" id="cb23" style="background: #f1f3f5;"><pre class="sourceCode numberSource python number-lines code-with-copy"><code class="sourceCode python"><span id="cb23-1"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># 키 및 엔드포인트 확인</span></span>
<span id="cb23-2"><span class="bu" style="color: null;
background-color: null;
font-style: inherit;">print</span>(<span class="ss" style="color: #20794D;
background-color: null;
font-style: inherit;">f"Endpoint: </span><span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">{</span>endpoint<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">}</span><span class="ss" style="color: #20794D;
background-color: null;
font-style: inherit;">"</span>)</span>
<span id="cb23-3"><span class="bu" style="color: null;
background-color: null;
font-style: inherit;">print</span>(<span class="ss" style="color: #20794D;
background-color: null;
font-style: inherit;">f"Key: </span><span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">{</span>key[:<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">10</span>]<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">}</span><span class="ss" style="color: #20794D;
background-color: null;
font-style: inherit;">... (길이: </span><span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">{</span><span class="bu" style="color: null;
background-color: null;
font-style: inherit;">len</span>(key)<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">}</span><span class="ss" style="color: #20794D;
background-color: null;
font-style: inherit;">)"</span>)</span></code></pre></div>
</section>
</section>
<section id="참고-자료" class="level2" data-number="16">
<h2 data-number="16" class="anchored" data-anchor-id="참고-자료"><span class="header-section-number">16</span> 참고 자료</h2>
<section id="공식-문서" class="level3" data-number="16.1">
<h3 data-number="16.1" class="anchored" data-anchor-id="공식-문서"><span class="header-section-number">16.1</span> 공식 문서</h3>
<ul>
<li><a href="https://learn.microsoft.com/en-us/azure/ai-services/document-intelligence/">Document Intelligence 개요</a></li>
<li><a href="https://learn.microsoft.com/en-us/python/api/overview/azure/ai-formrecognizer-readme">Python SDK 참조</a></li>
<li><a href="https://learn.microsoft.com/en-us/azure/ai-services/document-intelligence/concept-model-overview">모델 가이드</a></li>
</ul>
</section>
<section id="샘플-코드" class="level3" data-number="16.2">
<h3 data-number="16.2" class="anchored" data-anchor-id="샘플-코드"><span class="header-section-number">16.2</span> 샘플 코드</h3>
<ul>
<li><a href="https://github.com/Azure/azure-sdk-for-python/tree/main/sdk/formrecognizer/azure-ai-formrecognizer/samples">Document Intelligence Samples</a></li>
<li><a href="https://python.langchain.com/docs/integrations/document_loaders/azure_document_intelligence">LangChain 통합</a></li>
</ul>
</section>
</section>
<section id="다음-단계" class="level2" data-number="17">
<h2 data-number="17" class="anchored" data-anchor-id="다음-단계"><span class="header-section-number">17</span> 다음 단계</h2>
<p>문서 OCR 및 레이아웃 분석이 완료되었다면, 이제 텍스트를 임베딩으로 변환하자:</p>
<p>👉 <a href="../../../../../docs/blog/posts/RAG/13-Cloud-RAG/03-Azure-OpenAI-Embeddings.html">03-Azure-OpenAI-Embeddings.qmd</a> - Azure OpenAI로 문서 임베딩 생성</p>


</section>

 ]]></description>
  <category>AI</category>
  <category>RAG</category>
  <category>Azure</category>
  <category>OCR</category>
  <guid>kk3225.netlify.app/docs/blog/posts/RAG/13-Cloud-RAG/02-Document-Intelligence.html</guid>
  <pubDate>Sun, 02 Nov 2025 15:00:00 GMT</pubDate>
</item>
<item>
  <title>Azure Blob Storage</title>
  <dc:creator>Kwangmin Kim</dc:creator>
  <link>kk3225.netlify.app/docs/blog/posts/RAG/13-Cloud-RAG/01-Azure-Blob-Storage.html</link>
  <description><![CDATA[ 





<section id="azure-blob-storage란" class="level2" data-number="1">
<h2 data-number="1" class="anchored" data-anchor-id="azure-blob-storage란"><span class="header-section-number">1</span> Azure Blob Storage란?</h2>
<p>Azure Blob Storage는 Microsoft Azure에서 제공하는 객체 스토리지 서비스로, RAG 시스템의 문서 저장소로 사용된다. 비정형 데이터(PDF, Word, 이미지 등)를 대용량으로 저장하고 관리할 수 있는 확장 가능한 클라우드 스토리지다.</p>
<p><strong>RAG 파이프라인에서의 역할:</strong> - 원본 문서 저장 (PDF, DOCX, PPTX, 이미지 등) - 전처리된 텍스트 저장 - 메타데이터 및 인덱스 백업 - 대용량 데이터셋 관리</p>
<p><strong>주요 특징:</strong> - <strong>확장성</strong>: EB(Exabyte) 규모까지 자동 확장 - <strong>내구성</strong>: 99.999999999% (11 nine’s) 데이터 내구성 - <strong>비용 효율성</strong>: 계층형 스토리지로 비용 최적화 - <strong>보안</strong>: 암호화, RBAC, Private Endpoint 지원</p>
</section>
<section id="blob-storage-계층" class="level2" data-number="2">
<h2 data-number="2" class="anchored" data-anchor-id="blob-storage-계층"><span class="header-section-number">2</span> Blob Storage 계층</h2>
<p>Azure Blob Storage는 데이터 액세스 패턴에 따라 3가지 계층을 제공한다:</p>
<table class="caption-top table">
<colgroup>
<col style="width: 11%">
<col style="width: 11%">
<col style="width: 25%">
<col style="width: 21%">
<col style="width: 30%">
</colgroup>
<thead>
<tr class="header">
<th>계층</th>
<th>용도</th>
<th>가격 (GB/월)</th>
<th>읽기 비용</th>
<th>적합한 시나리오</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td><strong>Hot</strong></td>
<td>자주 액세스</td>
<td>$0.0184</td>
<td>낮음</td>
<td>RAG 운영 문서, 활성 데이터셋</td>
</tr>
<tr class="even">
<td><strong>Cool</strong></td>
<td>가끔 액세스</td>
<td>$0.01</td>
<td>중간</td>
<td>아카이브 문서, 백업</td>
</tr>
<tr class="odd">
<td><strong>Archive</strong></td>
<td>거의 없음</td>
<td>$0.002</td>
<td>높음</td>
<td>장기 보관, 규정 준수 데이터</td>
</tr>
</tbody>
</table>
<p><strong>RAG 시스템 권장 사항:</strong> - <strong>Hot 계층</strong>: 현재 RAG에서 사용 중인 문서 - <strong>Cool 계층</strong>: 3개월 이상 미사용 문서 - <strong>Archive 계층</strong>: 법적 보관 의무만 있는 문서</p>
</section>
<section id="storage-account-생성" class="level2" data-number="3">
<h2 data-number="3" class="anchored" data-anchor-id="storage-account-생성"><span class="header-section-number">3</span> Storage Account 생성</h2>
<section id="azure-portal에서-생성" class="level3" data-number="3.1">
<h3 data-number="3.1" class="anchored" data-anchor-id="azure-portal에서-생성"><span class="header-section-number">3.1</span> Azure Portal에서 생성</h3>
<p><strong>1. Azure Portal 접속:</strong> - <a href="https://portal.azure.com">portal.azure.com</a> → “리소스 만들기” - “Storage Account” 검색 및 선택</p>
<p><strong>2. 기본 설정:</strong> - <strong>구독</strong>: 사용할 구독 선택 - <strong>리소스 그룹</strong>: 새로 만들기 또는 기존 선택 (예: <code>rg-rag-prod</code>) - <strong>Storage Account 이름</strong>: 전역적으로 고유한 이름 (예: <code>stragdocs2025</code>) - <strong>지역</strong>: Korea Central 또는 Korea South - <strong>성능</strong>: Standard (대부분의 경우 충분) - <strong>중복성</strong>: - LRS (Locally Redundant Storage): 단일 데이터센터 내 3개 복제 - GRS (Geo-Redundant Storage): 다른 리전에 자동 복제 (권장)</p>
<p><strong>3. 고급 설정:</strong> - <strong>보안</strong>: - Require secure transfer (HTTPS 강제) - Enable blob public access (나중에 제어 가능) - <strong>Data Lake Storage Gen2</strong>: RAG에서는 불필요 - <strong>Blob soft delete</strong>: 7일 (실수로 삭제 방지)</p>
<p><strong>4. 네트워킹:</strong> - <strong>연결 방법</strong>: - Public endpoint (개발): 모든 네트워크에서 액세스 - Private endpoint (프로덕션): VNet 내에서만 액세스</p>
<p><strong>5. 검토 + 만들기</strong> → 생성 완료 (약 1분 소요)</p>
</section>
<section id="azure-cli로-생성" class="level3" data-number="3.2">
<h3 data-number="3.2" class="anchored" data-anchor-id="azure-cli로-생성"><span class="header-section-number">3.2</span> Azure CLI로 생성</h3>
<div class="sourceCode" id="cb1" style="background: #f1f3f5;"><pre class="sourceCode numberSource bash number-lines code-with-copy"><code class="sourceCode bash"><span id="cb1-1"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># Azure CLI 로그인</span></span>
<span id="cb1-2"><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">az</span> login</span>
<span id="cb1-3"></span>
<span id="cb1-4"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># 리소스 그룹 생성</span></span>
<span id="cb1-5"><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">az</span> group create <span class="dt" style="color: #AD0000;
background-color: null;
font-style: inherit;">\</span></span>
<span id="cb1-6">    <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">--name</span> rg-rag-prod <span class="dt" style="color: #AD0000;
background-color: null;
font-style: inherit;">\</span></span>
<span id="cb1-7">    <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">--location</span> koreacentral</span>
<span id="cb1-8"></span>
<span id="cb1-9"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># Storage Account 생성</span></span>
<span id="cb1-10"><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">az</span> storage account create <span class="dt" style="color: #AD0000;
background-color: null;
font-style: inherit;">\</span></span>
<span id="cb1-11">    <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">--name</span> stragdocs2025 <span class="dt" style="color: #AD0000;
background-color: null;
font-style: inherit;">\</span></span>
<span id="cb1-12">    <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">--resource-group</span> rg-rag-prod <span class="dt" style="color: #AD0000;
background-color: null;
font-style: inherit;">\</span></span>
<span id="cb1-13">    <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">--location</span> koreacentral <span class="dt" style="color: #AD0000;
background-color: null;
font-style: inherit;">\</span></span>
<span id="cb1-14">    <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">--sku</span> Standard_GRS <span class="dt" style="color: #AD0000;
background-color: null;
font-style: inherit;">\</span></span>
<span id="cb1-15">    <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">--kind</span> StorageV2 <span class="dt" style="color: #AD0000;
background-color: null;
font-style: inherit;">\</span></span>
<span id="cb1-16">    <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">--https-only</span> true <span class="dt" style="color: #AD0000;
background-color: null;
font-style: inherit;">\</span></span>
<span id="cb1-17">    <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">--allow-blob-public-access</span> false</span>
<span id="cb1-18"></span>
<span id="cb1-19"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># 생성 확인</span></span>
<span id="cb1-20"><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">az</span> storage account show <span class="dt" style="color: #AD0000;
background-color: null;
font-style: inherit;">\</span></span>
<span id="cb1-21">    <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">--name</span> stragdocs2025 <span class="dt" style="color: #AD0000;
background-color: null;
font-style: inherit;">\</span></span>
<span id="cb1-22">    <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">--resource-group</span> rg-rag-prod <span class="dt" style="color: #AD0000;
background-color: null;
font-style: inherit;">\</span></span>
<span id="cb1-23">    <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">--query</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"[name, location, sku.name]"</span></span></code></pre></div>
</section>
</section>
<section id="컨테이너-생성" class="level2" data-number="4">
<h2 data-number="4" class="anchored" data-anchor-id="컨테이너-생성"><span class="header-section-number">4</span> 컨테이너 생성</h2>
<p>Blob Storage에서 <strong>컨테이너</strong>는 파일 시스템의 폴더와 유사한 개념이다.</p>
<section id="azure-portal에서-생성-1" class="level3" data-number="4.1">
<h3 data-number="4.1" class="anchored" data-anchor-id="azure-portal에서-생성-1"><span class="header-section-number">4.1</span> Azure Portal에서 생성</h3>
<ol type="1">
<li>Storage Account → “컨테이너” 메뉴</li>
<li>“+ 컨테이너” 클릭</li>
<li>설정:
<ul>
<li><strong>이름</strong>: <code>rag-documents</code> (소문자, 하이픈만 허용)</li>
<li><strong>Public access level</strong>: Private (권장)</li>
</ul></li>
<li>“만들기” 클릭</li>
</ol>
</section>
<section id="python-sdk로-생성" class="level3" data-number="4.2">
<h3 data-number="4.2" class="anchored" data-anchor-id="python-sdk로-생성"><span class="header-section-number">4.2</span> Python SDK로 생성</h3>
<div id="aff7a815" class="cell" data-execution_count="1">
<details class="code-fold">
<summary>코드</summary>
<div class="sourceCode cell-code" id="cb2" style="background: #f1f3f5;"><pre class="sourceCode numberSource python number-lines code-with-copy"><code class="sourceCode python"><span id="cb2-1"><span class="im" style="color: #00769E;
background-color: null;
font-style: inherit;">from</span> azure.storage.blob <span class="im" style="color: #00769E;
background-color: null;
font-style: inherit;">import</span> BlobServiceClient</span>
<span id="cb2-2"><span class="im" style="color: #00769E;
background-color: null;
font-style: inherit;">from</span> dotenv <span class="im" style="color: #00769E;
background-color: null;
font-style: inherit;">import</span> load_dotenv</span>
<span id="cb2-3"><span class="im" style="color: #00769E;
background-color: null;
font-style: inherit;">import</span> os</span>
<span id="cb2-4"></span>
<span id="cb2-5">load_dotenv()</span>
<span id="cb2-6"></span>
<span id="cb2-7"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># 환경 변수에서 연결 문자열 가져오기</span></span>
<span id="cb2-8">connection_string <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> os.getenv(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"AZURE_STORAGE_CONNECTION_STRING"</span>)</span>
<span id="cb2-9"></span>
<span id="cb2-10"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># BlobServiceClient 생성</span></span>
<span id="cb2-11">blob_service_client <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> BlobServiceClient.from_connection_string(connection_string)</span>
<span id="cb2-12"></span>
<span id="cb2-13"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># 컨테이너 생성</span></span>
<span id="cb2-14">container_name <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"rag-documents"</span></span>
<span id="cb2-15">container_client <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> blob_service_client.create_container(container_name)</span>
<span id="cb2-16"></span>
<span id="cb2-17"><span class="bu" style="color: null;
background-color: null;
font-style: inherit;">print</span>(<span class="ss" style="color: #20794D;
background-color: null;
font-style: inherit;">f"컨테이너 '</span><span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">{</span>container_name<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">}</span><span class="ss" style="color: #20794D;
background-color: null;
font-style: inherit;">' 생성 완료"</span>)</span></code></pre></div>
</details>
</div>
<p><strong>환경 변수 설정</strong> (<code>.env</code> 파일):</p>
<pre><code>AZURE_STORAGE_CONNECTION_STRING=DefaultEndpointsProtocol=https;AccountName=stragdocs2025;AccountKey=xxx;EndpointSuffix=core.windows.net</code></pre>
</section>
</section>
<section id="문서-업로드" class="level2" data-number="5">
<h2 data-number="5" class="anchored" data-anchor-id="문서-업로드"><span class="header-section-number">5</span> 문서 업로드</h2>
<section id="단일-파일-업로드" class="level3" data-number="5.1">
<h3 data-number="5.1" class="anchored" data-anchor-id="단일-파일-업로드"><span class="header-section-number">5.1</span> 단일 파일 업로드</h3>
<div id="c6ecd97c" class="cell" data-execution_count="2">
<details class="code-fold">
<summary>코드</summary>
<div class="sourceCode cell-code" id="cb4" style="background: #f1f3f5;"><pre class="sourceCode numberSource python number-lines code-with-copy"><code class="sourceCode python"><span id="cb4-1"><span class="im" style="color: #00769E;
background-color: null;
font-style: inherit;">from</span> azure.storage.blob <span class="im" style="color: #00769E;
background-color: null;
font-style: inherit;">import</span> BlobClient</span>
<span id="cb4-2"></span>
<span id="cb4-3"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># Blob 클라이언트 생성</span></span>
<span id="cb4-4">blob_client <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> blob_service_client.get_blob_client(</span>
<span id="cb4-5">    container<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"rag-documents"</span>,</span>
<span id="cb4-6">    blob<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"sample.pdf"</span></span>
<span id="cb4-7">)</span>
<span id="cb4-8"></span>
<span id="cb4-9"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># 파일 업로드</span></span>
<span id="cb4-10"><span class="cf" style="color: #003B4F;
background-color: null;
font-style: inherit;">with</span> <span class="bu" style="color: null;
background-color: null;
font-style: inherit;">open</span>(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"sample.pdf"</span>, <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"rb"</span>) <span class="im" style="color: #00769E;
background-color: null;
font-style: inherit;">as</span> data:</span>
<span id="cb4-11">    blob_client.upload_blob(data, overwrite<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span><span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">True</span>)</span>
<span id="cb4-12">    </span>
<span id="cb4-13"><span class="bu" style="color: null;
background-color: null;
font-style: inherit;">print</span>(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"파일 업로드 완료"</span>)</span></code></pre></div>
</details>
</div>
</section>
<section id="여러-파일-일괄-업로드" class="level3" data-number="5.2">
<h3 data-number="5.2" class="anchored" data-anchor-id="여러-파일-일괄-업로드"><span class="header-section-number">5.2</span> 여러 파일 일괄 업로드</h3>
<div id="480182c6" class="cell" data-execution_count="3">
<details class="code-fold">
<summary>코드</summary>
<div class="sourceCode cell-code" id="cb5" style="background: #f1f3f5;"><pre class="sourceCode numberSource python number-lines code-with-copy"><code class="sourceCode python"><span id="cb5-1"><span class="im" style="color: #00769E;
background-color: null;
font-style: inherit;">import</span> os</span>
<span id="cb5-2"><span class="im" style="color: #00769E;
background-color: null;
font-style: inherit;">from</span> pathlib <span class="im" style="color: #00769E;
background-color: null;
font-style: inherit;">import</span> Path</span>
<span id="cb5-3"></span>
<span id="cb5-4"><span class="kw" style="color: #003B4F;
background-color: null;
font-style: inherit;">def</span> upload_directory(container_name, local_directory):</span>
<span id="cb5-5">    <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">"""디렉토리 내 모든 파일을 Blob Storage에 업로드"""</span></span>
<span id="cb5-6">    container_client <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> blob_service_client.get_container_client(container_name)</span>
<span id="cb5-7">    </span>
<span id="cb5-8">    <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># 로컬 디렉토리의 모든 파일 탐색</span></span>
<span id="cb5-9">    <span class="cf" style="color: #003B4F;
background-color: null;
font-style: inherit;">for</span> root, dirs, files <span class="kw" style="color: #003B4F;
background-color: null;
font-style: inherit;">in</span> os.walk(local_directory):</span>
<span id="cb5-10">        <span class="cf" style="color: #003B4F;
background-color: null;
font-style: inherit;">for</span> <span class="bu" style="color: null;
background-color: null;
font-style: inherit;">file</span> <span class="kw" style="color: #003B4F;
background-color: null;
font-style: inherit;">in</span> files:</span>
<span id="cb5-11">            file_path <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> os.path.join(root, <span class="bu" style="color: null;
background-color: null;
font-style: inherit;">file</span>)</span>
<span id="cb5-12">            </span>
<span id="cb5-13">            <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># Blob 이름 생성 (디렉토리 구조 유지)</span></span>
<span id="cb5-14">            blob_name <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> os.path.relpath(file_path, local_directory).replace(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"</span><span class="ch" style="color: #20794D;
background-color: null;
font-style: inherit;">\\</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"</span>, <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"/"</span>)</span>
<span id="cb5-15">            </span>
<span id="cb5-16">            <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># 파일 업로드</span></span>
<span id="cb5-17">            <span class="cf" style="color: #003B4F;
background-color: null;
font-style: inherit;">with</span> <span class="bu" style="color: null;
background-color: null;
font-style: inherit;">open</span>(file_path, <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"rb"</span>) <span class="im" style="color: #00769E;
background-color: null;
font-style: inherit;">as</span> data:</span>
<span id="cb5-18">                blob_client <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> container_client.get_blob_client(blob_name)</span>
<span id="cb5-19">                blob_client.upload_blob(data, overwrite<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span><span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">True</span>)</span>
<span id="cb5-20">                <span class="bu" style="color: null;
background-color: null;
font-style: inherit;">print</span>(<span class="ss" style="color: #20794D;
background-color: null;
font-style: inherit;">f"업로드: </span><span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">{</span>blob_name<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">}</span><span class="ss" style="color: #20794D;
background-color: null;
font-style: inherit;">"</span>)</span>
<span id="cb5-21"></span>
<span id="cb5-22"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># 사용 예시</span></span>
<span id="cb5-23">upload_directory(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"rag-documents"</span>, <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"./documents"</span>)</span></code></pre></div>
</details>
</div>
</section>
<section id="메타데이터와-함께-업로드" class="level3" data-number="5.3">
<h3 data-number="5.3" class="anchored" data-anchor-id="메타데이터와-함께-업로드"><span class="header-section-number">5.3</span> 메타데이터와 함께 업로드</h3>
<div id="d4395c5e" class="cell" data-execution_count="4">
<details class="code-fold">
<summary>코드</summary>
<div class="sourceCode cell-code" id="cb6" style="background: #f1f3f5;"><pre class="sourceCode numberSource python number-lines code-with-copy"><code class="sourceCode python"><span id="cb6-1"><span class="im" style="color: #00769E;
background-color: null;
font-style: inherit;">from</span> datetime <span class="im" style="color: #00769E;
background-color: null;
font-style: inherit;">import</span> datetime</span>
<span id="cb6-2"></span>
<span id="cb6-3"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># 메타데이터 정의</span></span>
<span id="cb6-4">metadata <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> {</span>
<span id="cb6-5">    <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"author"</span>: <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Kwangmin Kim"</span>,</span>
<span id="cb6-6">    <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"category"</span>: <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"AI"</span>,</span>
<span id="cb6-7">    <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"upload_date"</span>: datetime.now().isoformat(),</span>
<span id="cb6-8">    <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"version"</span>: <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"1.0"</span></span>
<span id="cb6-9">}</span>
<span id="cb6-10"></span>
<span id="cb6-11"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># 메타데이터와 함께 업로드</span></span>
<span id="cb6-12"><span class="cf" style="color: #003B4F;
background-color: null;
font-style: inherit;">with</span> <span class="bu" style="color: null;
background-color: null;
font-style: inherit;">open</span>(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"report.pdf"</span>, <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"rb"</span>) <span class="im" style="color: #00769E;
background-color: null;
font-style: inherit;">as</span> data:</span>
<span id="cb6-13">    blob_client <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> blob_service_client.get_blob_client(</span>
<span id="cb6-14">        container<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"rag-documents"</span>,</span>
<span id="cb6-15">        blob<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"report.pdf"</span></span>
<span id="cb6-16">    )</span>
<span id="cb6-17">    blob_client.upload_blob(</span>
<span id="cb6-18">        data,</span>
<span id="cb6-19">        metadata<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span>metadata,</span>
<span id="cb6-20">        overwrite<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span><span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">True</span></span>
<span id="cb6-21">    )</span>
<span id="cb6-22"></span>
<span id="cb6-23"><span class="bu" style="color: null;
background-color: null;
font-style: inherit;">print</span>(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"메타데이터와 함께 업로드 완료"</span>)</span></code></pre></div>
</details>
</div>
</section>
</section>
<section id="문서-다운로드" class="level2" data-number="6">
<h2 data-number="6" class="anchored" data-anchor-id="문서-다운로드"><span class="header-section-number">6</span> 문서 다운로드</h2>
<section id="단일-파일-다운로드" class="level3" data-number="6.1">
<h3 data-number="6.1" class="anchored" data-anchor-id="단일-파일-다운로드"><span class="header-section-number">6.1</span> 단일 파일 다운로드</h3>
<div id="96435554" class="cell" data-execution_count="5">
<details class="code-fold">
<summary>코드</summary>
<div class="sourceCode cell-code" id="cb7" style="background: #f1f3f5;"><pre class="sourceCode numberSource python number-lines code-with-copy"><code class="sourceCode python"><span id="cb7-1"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># Blob 다운로드</span></span>
<span id="cb7-2">blob_client <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> blob_service_client.get_blob_client(</span>
<span id="cb7-3">    container<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"rag-documents"</span>,</span>
<span id="cb7-4">    blob<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"sample.pdf"</span></span>
<span id="cb7-5">)</span>
<span id="cb7-6"></span>
<span id="cb7-7"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># 로컬에 저장</span></span>
<span id="cb7-8"><span class="cf" style="color: #003B4F;
background-color: null;
font-style: inherit;">with</span> <span class="bu" style="color: null;
background-color: null;
font-style: inherit;">open</span>(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"downloaded_sample.pdf"</span>, <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"wb"</span>) <span class="im" style="color: #00769E;
background-color: null;
font-style: inherit;">as</span> download_file:</span>
<span id="cb7-9">    download_file.write(blob_client.download_blob().readall())</span>
<span id="cb7-10"></span>
<span id="cb7-11"><span class="bu" style="color: null;
background-color: null;
font-style: inherit;">print</span>(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"파일 다운로드 완료"</span>)</span></code></pre></div>
</details>
</div>
</section>
<section id="스트리밍-다운로드-대용량-파일" class="level3" data-number="6.2">
<h3 data-number="6.2" class="anchored" data-anchor-id="스트리밍-다운로드-대용량-파일"><span class="header-section-number">6.2</span> 스트리밍 다운로드 (대용량 파일)</h3>
<div id="294ce7cb" class="cell" data-execution_count="6">
<details class="code-fold">
<summary>코드</summary>
<div class="sourceCode cell-code" id="cb8" style="background: #f1f3f5;"><pre class="sourceCode numberSource python number-lines code-with-copy"><code class="sourceCode python"><span id="cb8-1"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># 스트리밍으로 다운로드 (메모리 효율적)</span></span>
<span id="cb8-2"><span class="cf" style="color: #003B4F;
background-color: null;
font-style: inherit;">with</span> <span class="bu" style="color: null;
background-color: null;
font-style: inherit;">open</span>(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"large_file.pdf"</span>, <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"wb"</span>) <span class="im" style="color: #00769E;
background-color: null;
font-style: inherit;">as</span> download_file:</span>
<span id="cb8-3">    blob_data <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> blob_client.download_blob()</span>
<span id="cb8-4">    </span>
<span id="cb8-5">    <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># 청크 단위로 읽기 (기본 4MB)</span></span>
<span id="cb8-6">    <span class="cf" style="color: #003B4F;
background-color: null;
font-style: inherit;">for</span> chunk <span class="kw" style="color: #003B4F;
background-color: null;
font-style: inherit;">in</span> blob_data.chunks():</span>
<span id="cb8-7">        download_file.write(chunk)</span>
<span id="cb8-8"></span>
<span id="cb8-9"><span class="bu" style="color: null;
background-color: null;
font-style: inherit;">print</span>(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"대용량 파일 다운로드 완료"</span>)</span></code></pre></div>
</details>
</div>
</section>
</section>
<section id="문서-목록-조회" class="level2" data-number="7">
<h2 data-number="7" class="anchored" data-anchor-id="문서-목록-조회"><span class="header-section-number">7</span> 문서 목록 조회</h2>
<section id="컨테이너-내-모든-blob-나열" class="level3" data-number="7.1">
<h3 data-number="7.1" class="anchored" data-anchor-id="컨테이너-내-모든-blob-나열"><span class="header-section-number">7.1</span> 컨테이너 내 모든 Blob 나열</h3>
<div id="5c99cf2c" class="cell" data-execution_count="7">
<details class="code-fold">
<summary>코드</summary>
<div class="sourceCode cell-code" id="cb9" style="background: #f1f3f5;"><pre class="sourceCode numberSource python number-lines code-with-copy"><code class="sourceCode python"><span id="cb9-1"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># 컨테이너의 모든 Blob 가져오기</span></span>
<span id="cb9-2">container_client <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> blob_service_client.get_container_client(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"rag-documents"</span>)</span>
<span id="cb9-3">blob_list <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> container_client.list_blobs()</span>
<span id="cb9-4"></span>
<span id="cb9-5"><span class="bu" style="color: null;
background-color: null;
font-style: inherit;">print</span>(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Blob 목록:"</span>)</span>
<span id="cb9-6"><span class="cf" style="color: #003B4F;
background-color: null;
font-style: inherit;">for</span> blob <span class="kw" style="color: #003B4F;
background-color: null;
font-style: inherit;">in</span> blob_list:</span>
<span id="cb9-7">    <span class="bu" style="color: null;
background-color: null;
font-style: inherit;">print</span>(<span class="ss" style="color: #20794D;
background-color: null;
font-style: inherit;">f"- </span><span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">{</span>blob<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">.</span>name<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">}</span><span class="ss" style="color: #20794D;
background-color: null;
font-style: inherit;">"</span>)</span>
<span id="cb9-8">    <span class="bu" style="color: null;
background-color: null;
font-style: inherit;">print</span>(<span class="ss" style="color: #20794D;
background-color: null;
font-style: inherit;">f"  크기: </span><span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">{</span>blob<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">.</span>size <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">/</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1024</span><span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">:.2f}</span><span class="ss" style="color: #20794D;
background-color: null;
font-style: inherit;"> KB"</span>)</span>
<span id="cb9-9">    <span class="bu" style="color: null;
background-color: null;
font-style: inherit;">print</span>(<span class="ss" style="color: #20794D;
background-color: null;
font-style: inherit;">f"  수정일: </span><span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">{</span>blob<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">.</span>last_modified<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">}</span><span class="ss" style="color: #20794D;
background-color: null;
font-style: inherit;">"</span>)</span></code></pre></div>
</details>
</div>
</section>
<section id="메타데이터-포함-조회" class="level3" data-number="7.2">
<h3 data-number="7.2" class="anchored" data-anchor-id="메타데이터-포함-조회"><span class="header-section-number">7.2</span> 메타데이터 포함 조회</h3>
<div id="f5cd3ac9" class="cell" data-execution_count="8">
<details class="code-fold">
<summary>코드</summary>
<div class="sourceCode cell-code" id="cb10" style="background: #f1f3f5;"><pre class="sourceCode numberSource python number-lines code-with-copy"><code class="sourceCode python"><span id="cb10-1"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># 메타데이터 포함 조회</span></span>
<span id="cb10-2">blob_list <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> container_client.list_blobs(include<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span>[<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">'metadata'</span>])</span>
<span id="cb10-3"></span>
<span id="cb10-4"><span class="cf" style="color: #003B4F;
background-color: null;
font-style: inherit;">for</span> blob <span class="kw" style="color: #003B4F;
background-color: null;
font-style: inherit;">in</span> blob_list:</span>
<span id="cb10-5">    <span class="bu" style="color: null;
background-color: null;
font-style: inherit;">print</span>(<span class="ss" style="color: #20794D;
background-color: null;
font-style: inherit;">f"</span><span class="ch" style="color: #20794D;
background-color: null;
font-style: inherit;">\n</span><span class="ss" style="color: #20794D;
background-color: null;
font-style: inherit;">파일: </span><span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">{</span>blob<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">.</span>name<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">}</span><span class="ss" style="color: #20794D;
background-color: null;
font-style: inherit;">"</span>)</span>
<span id="cb10-6">    <span class="bu" style="color: null;
background-color: null;
font-style: inherit;">print</span>(<span class="ss" style="color: #20794D;
background-color: null;
font-style: inherit;">f"메타데이터: </span><span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">{</span>blob<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">.</span>metadata<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">}</span><span class="ss" style="color: #20794D;
background-color: null;
font-style: inherit;">"</span>)</span></code></pre></div>
</details>
</div>
</section>
<section id="특정-접두사로-필터링" class="level3" data-number="7.3">
<h3 data-number="7.3" class="anchored" data-anchor-id="특정-접두사로-필터링"><span class="header-section-number">7.3</span> 특정 접두사로 필터링</h3>
<div id="144c8bc0" class="cell" data-execution_count="9">
<details class="code-fold">
<summary>코드</summary>
<div class="sourceCode cell-code" id="cb11" style="background: #f1f3f5;"><pre class="sourceCode numberSource python number-lines code-with-copy"><code class="sourceCode python"><span id="cb11-1"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># "reports/" 폴더의 파일만 조회</span></span>
<span id="cb11-2">blob_list <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> container_client.list_blobs(name_starts_with<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"reports/"</span>)</span>
<span id="cb11-3"></span>
<span id="cb11-4"><span class="cf" style="color: #003B4F;
background-color: null;
font-style: inherit;">for</span> blob <span class="kw" style="color: #003B4F;
background-color: null;
font-style: inherit;">in</span> blob_list:</span>
<span id="cb11-5">    <span class="bu" style="color: null;
background-color: null;
font-style: inherit;">print</span>(<span class="ss" style="color: #20794D;
background-color: null;
font-style: inherit;">f"- </span><span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">{</span>blob<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">.</span>name<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">}</span><span class="ss" style="color: #20794D;
background-color: null;
font-style: inherit;">"</span>)</span></code></pre></div>
</details>
</div>
</section>
</section>
<section id="문서-삭제" class="level2" data-number="8">
<h2 data-number="8" class="anchored" data-anchor-id="문서-삭제"><span class="header-section-number">8</span> 문서 삭제</h2>
<section id="단일-파일-삭제" class="level3" data-number="8.1">
<h3 data-number="8.1" class="anchored" data-anchor-id="단일-파일-삭제"><span class="header-section-number">8.1</span> 단일 파일 삭제</h3>
<div id="c629738f" class="cell" data-execution_count="10">
<details class="code-fold">
<summary>코드</summary>
<div class="sourceCode cell-code" id="cb12" style="background: #f1f3f5;"><pre class="sourceCode numberSource python number-lines code-with-copy"><code class="sourceCode python"><span id="cb12-1"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># Blob 삭제</span></span>
<span id="cb12-2">blob_client <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> blob_service_client.get_blob_client(</span>
<span id="cb12-3">    container<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"rag-documents"</span>,</span>
<span id="cb12-4">    blob<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"old_file.pdf"</span></span>
<span id="cb12-5">)</span>
<span id="cb12-6"></span>
<span id="cb12-7">blob_client.delete_blob()</span>
<span id="cb12-8"><span class="bu" style="color: null;
background-color: null;
font-style: inherit;">print</span>(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"파일 삭제 완료"</span>)</span></code></pre></div>
</details>
</div>
</section>
<section id="조건부-삭제-오래된-파일만" class="level3" data-number="8.2">
<h3 data-number="8.2" class="anchored" data-anchor-id="조건부-삭제-오래된-파일만"><span class="header-section-number">8.2</span> 조건부 삭제 (오래된 파일만)</h3>
<div id="54ed6986" class="cell" data-execution_count="11">
<details class="code-fold">
<summary>코드</summary>
<div class="sourceCode cell-code" id="cb13" style="background: #f1f3f5;"><pre class="sourceCode numberSource python number-lines code-with-copy"><code class="sourceCode python"><span id="cb13-1"><span class="im" style="color: #00769E;
background-color: null;
font-style: inherit;">from</span> datetime <span class="im" style="color: #00769E;
background-color: null;
font-style: inherit;">import</span> datetime, timedelta</span>
<span id="cb13-2"></span>
<span id="cb13-3"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># 30일 이상 된 파일 삭제</span></span>
<span id="cb13-4">threshold_date <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> datetime.now() <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">-</span> timedelta(days<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">30</span>)</span>
<span id="cb13-5"></span>
<span id="cb13-6">container_client <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> blob_service_client.get_container_client(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"rag-documents"</span>)</span>
<span id="cb13-7">blob_list <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> container_client.list_blobs()</span>
<span id="cb13-8"></span>
<span id="cb13-9"><span class="cf" style="color: #003B4F;
background-color: null;
font-style: inherit;">for</span> blob <span class="kw" style="color: #003B4F;
background-color: null;
font-style: inherit;">in</span> blob_list:</span>
<span id="cb13-10">    <span class="cf" style="color: #003B4F;
background-color: null;
font-style: inherit;">if</span> blob.last_modified <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">&lt;</span> threshold_date:</span>
<span id="cb13-11">        blob_client <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> container_client.get_blob_client(blob.name)</span>
<span id="cb13-12">        blob_client.delete_blob()</span>
<span id="cb13-13">        <span class="bu" style="color: null;
background-color: null;
font-style: inherit;">print</span>(<span class="ss" style="color: #20794D;
background-color: null;
font-style: inherit;">f"삭제: </span><span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">{</span>blob<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">.</span>name<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">}</span><span class="ss" style="color: #20794D;
background-color: null;
font-style: inherit;"> (수정일: </span><span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">{</span>blob<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">.</span>last_modified<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">}</span><span class="ss" style="color: #20794D;
background-color: null;
font-style: inherit;">)"</span>)</span></code></pre></div>
</details>
</div>
</section>
</section>
<section id="sas-shared-access-signature-토큰" class="level2" data-number="9">
<h2 data-number="9" class="anchored" data-anchor-id="sas-shared-access-signature-토큰"><span class="header-section-number">9</span> SAS (Shared Access Signature) 토큰</h2>
<p>SAS 토큰은 Storage Account 키를 노출하지 않고 제한된 액세스를 제공한다.</p>
<section id="sas-토큰-생성" class="level3" data-number="9.1">
<h3 data-number="9.1" class="anchored" data-anchor-id="sas-토큰-생성"><span class="header-section-number">9.1</span> SAS 토큰 생성</h3>
<div id="9c2fedd8" class="cell" data-execution_count="12">
<details class="code-fold">
<summary>코드</summary>
<div class="sourceCode cell-code" id="cb14" style="background: #f1f3f5;"><pre class="sourceCode numberSource python number-lines code-with-copy"><code class="sourceCode python"><span id="cb14-1"><span class="im" style="color: #00769E;
background-color: null;
font-style: inherit;">from</span> azure.storage.blob <span class="im" style="color: #00769E;
background-color: null;
font-style: inherit;">import</span> generate_blob_sas, BlobSasPermissions</span>
<span id="cb14-2"><span class="im" style="color: #00769E;
background-color: null;
font-style: inherit;">from</span> datetime <span class="im" style="color: #00769E;
background-color: null;
font-style: inherit;">import</span> datetime, timedelta</span>
<span id="cb14-3"></span>
<span id="cb14-4"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># SAS 토큰 생성 (읽기 전용, 1시간 유효)</span></span>
<span id="cb14-5">sas_token <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> generate_blob_sas(</span>
<span id="cb14-6">    account_name<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"stragdocs2025"</span>,</span>
<span id="cb14-7">    container_name<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"rag-documents"</span>,</span>
<span id="cb14-8">    blob_name<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"sample.pdf"</span>,</span>
<span id="cb14-9">    account_key<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span>os.getenv(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"AZURE_STORAGE_KEY"</span>),</span>
<span id="cb14-10">    permission<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span>BlobSasPermissions(read<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span><span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">True</span>),</span>
<span id="cb14-11">    expiry<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span>datetime.utcnow() <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span> timedelta(hours<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span>)</span>
<span id="cb14-12">)</span>
<span id="cb14-13"></span>
<span id="cb14-14"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># SAS URL 생성</span></span>
<span id="cb14-15">sas_url <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> <span class="ss" style="color: #20794D;
background-color: null;
font-style: inherit;">f"https://stragdocs2025.blob.core.windows.net/rag-documents/sample.pdf?</span><span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">{</span>sas_token<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">}</span><span class="ss" style="color: #20794D;
background-color: null;
font-style: inherit;">"</span></span>
<span id="cb14-16"><span class="bu" style="color: null;
background-color: null;
font-style: inherit;">print</span>(<span class="ss" style="color: #20794D;
background-color: null;
font-style: inherit;">f"SAS URL: </span><span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">{</span>sas_url<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">}</span><span class="ss" style="color: #20794D;
background-color: null;
font-style: inherit;">"</span>)</span></code></pre></div>
</details>
</div>
</section>
<section id="sas-토큰으로-다운로드" class="level3" data-number="9.2">
<h3 data-number="9.2" class="anchored" data-anchor-id="sas-토큰으로-다운로드"><span class="header-section-number">9.2</span> SAS 토큰으로 다운로드</h3>
<div id="aac06be0" class="cell" data-execution_count="13">
<details class="code-fold">
<summary>코드</summary>
<div class="sourceCode cell-code" id="cb15" style="background: #f1f3f5;"><pre class="sourceCode numberSource python number-lines code-with-copy"><code class="sourceCode python"><span id="cb15-1"><span class="im" style="color: #00769E;
background-color: null;
font-style: inherit;">import</span> requests</span>
<span id="cb15-2"></span>
<span id="cb15-3"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># SAS URL로 파일 다운로드</span></span>
<span id="cb15-4">response <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> requests.get(sas_url)</span>
<span id="cb15-5"></span>
<span id="cb15-6"><span class="cf" style="color: #003B4F;
background-color: null;
font-style: inherit;">if</span> response.status_code <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">==</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">200</span>:</span>
<span id="cb15-7">    <span class="cf" style="color: #003B4F;
background-color: null;
font-style: inherit;">with</span> <span class="bu" style="color: null;
background-color: null;
font-style: inherit;">open</span>(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"downloaded_with_sas.pdf"</span>, <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"wb"</span>) <span class="im" style="color: #00769E;
background-color: null;
font-style: inherit;">as</span> f:</span>
<span id="cb15-8">        f.write(response.content)</span>
<span id="cb15-9">    <span class="bu" style="color: null;
background-color: null;
font-style: inherit;">print</span>(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"SAS 토큰으로 다운로드 완료"</span>)</span>
<span id="cb15-10"><span class="cf" style="color: #003B4F;
background-color: null;
font-style: inherit;">else</span>:</span>
<span id="cb15-11">    <span class="bu" style="color: null;
background-color: null;
font-style: inherit;">print</span>(<span class="ss" style="color: #20794D;
background-color: null;
font-style: inherit;">f"다운로드 실패: </span><span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">{</span>response<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">.</span>status_code<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">}</span><span class="ss" style="color: #20794D;
background-color: null;
font-style: inherit;">"</span>)</span></code></pre></div>
</details>
</div>
</section>
</section>
<section id="rag-파이프라인-통합" class="level2" data-number="10">
<h2 data-number="10" class="anchored" data-anchor-id="rag-파이프라인-통합"><span class="header-section-number">10</span> RAG 파이프라인 통합</h2>
<section id="문서-로딩-함수" class="level3" data-number="10.1">
<h3 data-number="10.1" class="anchored" data-anchor-id="문서-로딩-함수"><span class="header-section-number">10.1</span> 문서 로딩 함수</h3>
<div id="ca621888" class="cell" data-execution_count="14">
<details class="code-fold">
<summary>코드</summary>
<div class="sourceCode cell-code" id="cb16" style="background: #f1f3f5;"><pre class="sourceCode numberSource python number-lines code-with-copy"><code class="sourceCode python"><span id="cb16-1"><span class="im" style="color: #00769E;
background-color: null;
font-style: inherit;">from</span> typing <span class="im" style="color: #00769E;
background-color: null;
font-style: inherit;">import</span> List</span>
<span id="cb16-2"><span class="im" style="color: #00769E;
background-color: null;
font-style: inherit;">from</span> langchain_core.documents <span class="im" style="color: #00769E;
background-color: null;
font-style: inherit;">import</span> Document</span>
<span id="cb16-3"></span>
<span id="cb16-4"><span class="kw" style="color: #003B4F;
background-color: null;
font-style: inherit;">def</span> load_documents_from_blob(</span>
<span id="cb16-5">    container_name: <span class="bu" style="color: null;
background-color: null;
font-style: inherit;">str</span>,</span>
<span id="cb16-6">    prefix: <span class="bu" style="color: null;
background-color: null;
font-style: inherit;">str</span> <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">""</span></span>
<span id="cb16-7">) <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">-&gt;</span> List[Document]:</span>
<span id="cb16-8">    <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">"""Azure Blob Storage에서 문서 로딩"""</span></span>
<span id="cb16-9">    </span>
<span id="cb16-10">    container_client <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> blob_service_client.get_container_client(container_name)</span>
<span id="cb16-11">    blob_list <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> container_client.list_blobs(</span>
<span id="cb16-12">        name_starts_with<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span>prefix,</span>
<span id="cb16-13">        include<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span>[<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">'metadata'</span>]</span>
<span id="cb16-14">    )</span>
<span id="cb16-15">    </span>
<span id="cb16-16">    documents <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> []</span>
<span id="cb16-17">    <span class="cf" style="color: #003B4F;
background-color: null;
font-style: inherit;">for</span> blob <span class="kw" style="color: #003B4F;
background-color: null;
font-style: inherit;">in</span> blob_list:</span>
<span id="cb16-18">        <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># 지원 파일 형식만 처리</span></span>
<span id="cb16-19">        <span class="cf" style="color: #003B4F;
background-color: null;
font-style: inherit;">if</span> blob.name.endswith((<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">'.pdf'</span>, <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">'.txt'</span>, <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">'.docx'</span>)):</span>
<span id="cb16-20">            <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># Blob 다운로드</span></span>
<span id="cb16-21">            blob_client <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> container_client.get_blob_client(blob.name)</span>
<span id="cb16-22">            content <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> blob_client.download_blob().readall()</span>
<span id="cb16-23">            </span>
<span id="cb16-24">            <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># Document 객체 생성</span></span>
<span id="cb16-25">            doc <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> Document(</span>
<span id="cb16-26">                page_content<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span>content.decode(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">'utf-8'</span>, errors<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">'ignore'</span>),</span>
<span id="cb16-27">                metadata<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span>{</span>
<span id="cb16-28">                    <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"source"</span>: blob.name,</span>
<span id="cb16-29">                    <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"size"</span>: blob.size,</span>
<span id="cb16-30">                    <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"last_modified"</span>: blob.last_modified.isoformat(),</span>
<span id="cb16-31">                    <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">**</span>blob.metadata  <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># Blob 메타데이터 추가</span></span>
<span id="cb16-32">                }</span>
<span id="cb16-33">            )</span>
<span id="cb16-34">            documents.append(doc)</span>
<span id="cb16-35">    </span>
<span id="cb16-36">    <span class="cf" style="color: #003B4F;
background-color: null;
font-style: inherit;">return</span> documents</span>
<span id="cb16-37"></span>
<span id="cb16-38"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># 사용 예시</span></span>
<span id="cb16-39">documents <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> load_documents_from_blob(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"rag-documents"</span>, prefix<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"reports/"</span>)</span>
<span id="cb16-40"><span class="bu" style="color: null;
background-color: null;
font-style: inherit;">print</span>(<span class="ss" style="color: #20794D;
background-color: null;
font-style: inherit;">f"로딩된 문서 수: </span><span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">{</span><span class="bu" style="color: null;
background-color: null;
font-style: inherit;">len</span>(documents)<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">}</span><span class="ss" style="color: #20794D;
background-color: null;
font-style: inherit;">"</span>)</span></code></pre></div>
</details>
</div>
</section>
<section id="langchain-azureblobstorageloader-사용" class="level3" data-number="10.2">
<h3 data-number="10.2" class="anchored" data-anchor-id="langchain-azureblobstorageloader-사용"><span class="header-section-number">10.2</span> LangChain AzureBlobStorageLoader 사용</h3>
<div id="2248402b" class="cell" data-execution_count="15">
<details class="code-fold">
<summary>코드</summary>
<div class="sourceCode cell-code" id="cb17" style="background: #f1f3f5;"><pre class="sourceCode numberSource python number-lines code-with-copy"><code class="sourceCode python"><span id="cb17-1"><span class="im" style="color: #00769E;
background-color: null;
font-style: inherit;">from</span> langchain_community.document_loaders <span class="im" style="color: #00769E;
background-color: null;
font-style: inherit;">import</span> AzureBlobStorageFileLoader</span>
<span id="cb17-2"></span>
<span id="cb17-3"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># Azure Blob Storage에서 파일 로딩</span></span>
<span id="cb17-4">loader <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> AzureBlobStorageFileLoader(</span>
<span id="cb17-5">    conn_str<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span>os.getenv(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"AZURE_STORAGE_CONNECTION_STRING"</span>),</span>
<span id="cb17-6">    container<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"rag-documents"</span>,</span>
<span id="cb17-7">    blob_name<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"sample.pdf"</span></span>
<span id="cb17-8">)</span>
<span id="cb17-9"></span>
<span id="cb17-10">documents <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> loader.load()</span>
<span id="cb17-11"><span class="bu" style="color: null;
background-color: null;
font-style: inherit;">print</span>(<span class="ss" style="color: #20794D;
background-color: null;
font-style: inherit;">f"로딩된 문서: </span><span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">{</span><span class="bu" style="color: null;
background-color: null;
font-style: inherit;">len</span>(documents)<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">}</span><span class="ss" style="color: #20794D;
background-color: null;
font-style: inherit;">"</span>)</span>
<span id="cb17-12"><span class="bu" style="color: null;
background-color: null;
font-style: inherit;">print</span>(<span class="ss" style="color: #20794D;
background-color: null;
font-style: inherit;">f"첫 번째 문서 내용 (앞 200자):</span><span class="ch" style="color: #20794D;
background-color: null;
font-style: inherit;">\n</span><span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">{</span>documents[<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">0</span>]<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">.</span>page_content[:<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">200</span>]<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">}</span><span class="ss" style="color: #20794D;
background-color: null;
font-style: inherit;">"</span>)</span></code></pre></div>
</details>
</div>
</section>
</section>
<section id="비용-최적화" class="level2" data-number="11">
<h2 data-number="11" class="anchored" data-anchor-id="비용-최적화"><span class="header-section-number">11</span> 비용 최적화</h2>
<section id="수명-주기-관리-정책" class="level3" data-number="11.1">
<h3 data-number="11.1" class="anchored" data-anchor-id="수명-주기-관리-정책"><span class="header-section-number">11.1</span> 수명 주기 관리 정책</h3>
<p>Azure Portal에서 설정: 1. Storage Account → “수명 주기 관리” 2. “+ 규칙 추가” 3. 규칙 정의:</p>
<p><strong>예시: 자동 계층 전환</strong></p>
<div class="sourceCode" id="cb18" style="background: #f1f3f5;"><pre class="sourceCode numberSource json number-lines code-with-copy"><code class="sourceCode json"><span id="cb18-1"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">{</span></span>
<span id="cb18-2">  <span class="dt" style="color: #AD0000;
background-color: null;
font-style: inherit;">"rules"</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">:</span> <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">[</span></span>
<span id="cb18-3">    <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">{</span></span>
<span id="cb18-4">      <span class="dt" style="color: #AD0000;
background-color: null;
font-style: inherit;">"name"</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">:</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"move-to-cool"</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">,</span></span>
<span id="cb18-5">      <span class="dt" style="color: #AD0000;
background-color: null;
font-style: inherit;">"enabled"</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">:</span> <span class="kw" style="color: #003B4F;
background-color: null;
font-style: inherit;">true</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">,</span></span>
<span id="cb18-6">      <span class="dt" style="color: #AD0000;
background-color: null;
font-style: inherit;">"type"</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">:</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Lifecycle"</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">,</span></span>
<span id="cb18-7">      <span class="dt" style="color: #AD0000;
background-color: null;
font-style: inherit;">"definition"</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">:</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">{</span></span>
<span id="cb18-8">        <span class="dt" style="color: #AD0000;
background-color: null;
font-style: inherit;">"filters"</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">:</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">{</span></span>
<span id="cb18-9">          <span class="dt" style="color: #AD0000;
background-color: null;
font-style: inherit;">"blobTypes"</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">:</span> <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">[</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"blockBlob"</span><span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">]</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">,</span></span>
<span id="cb18-10">          <span class="dt" style="color: #AD0000;
background-color: null;
font-style: inherit;">"prefixMatch"</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">:</span> <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">[</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"rag-documents/"</span><span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">]</span></span>
<span id="cb18-11">        <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">},</span></span>
<span id="cb18-12">        <span class="dt" style="color: #AD0000;
background-color: null;
font-style: inherit;">"actions"</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">:</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">{</span></span>
<span id="cb18-13">          <span class="dt" style="color: #AD0000;
background-color: null;
font-style: inherit;">"baseBlob"</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">:</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">{</span></span>
<span id="cb18-14">            <span class="dt" style="color: #AD0000;
background-color: null;
font-style: inherit;">"tierToCool"</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">:</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">{</span></span>
<span id="cb18-15">              <span class="dt" style="color: #AD0000;
background-color: null;
font-style: inherit;">"daysAfterModificationGreaterThan"</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">:</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">90</span></span>
<span id="cb18-16">            <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">},</span></span>
<span id="cb18-17">            <span class="dt" style="color: #AD0000;
background-color: null;
font-style: inherit;">"tierToArchive"</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">:</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">{</span></span>
<span id="cb18-18">              <span class="dt" style="color: #AD0000;
background-color: null;
font-style: inherit;">"daysAfterModificationGreaterThan"</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">:</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">365</span></span>
<span id="cb18-19">            <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">},</span></span>
<span id="cb18-20">            <span class="dt" style="color: #AD0000;
background-color: null;
font-style: inherit;">"delete"</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">:</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">{</span></span>
<span id="cb18-21">              <span class="dt" style="color: #AD0000;
background-color: null;
font-style: inherit;">"daysAfterModificationGreaterThan"</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">:</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">730</span></span>
<span id="cb18-22">            <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">}</span></span>
<span id="cb18-23">          <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">}</span></span>
<span id="cb18-24">        <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">}</span></span>
<span id="cb18-25">      <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">}</span></span>
<span id="cb18-26">    <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">}</span></span>
<span id="cb18-27">  <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">]</span></span>
<span id="cb18-28"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">}</span></span></code></pre></div>
<p><strong>의미:</strong> - 90일 미사용 → Cool 계층 전환 - 365일 미사용 → Archive 계층 전환 - 730일(2년) 후 → 자동 삭제</p>
</section>
<section id="압축-저장" class="level3" data-number="11.2">
<h3 data-number="11.2" class="anchored" data-anchor-id="압축-저장"><span class="header-section-number">11.2</span> 압축 저장</h3>
<div id="ffb5a3fb" class="cell" data-execution_count="16">
<details class="code-fold">
<summary>코드</summary>
<div class="sourceCode cell-code" id="cb19" style="background: #f1f3f5;"><pre class="sourceCode numberSource python number-lines code-with-copy"><code class="sourceCode python"><span id="cb19-1"><span class="im" style="color: #00769E;
background-color: null;
font-style: inherit;">import</span> gzip</span>
<span id="cb19-2"></span>
<span id="cb19-3"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># 텍스트 파일 압축 후 업로드</span></span>
<span id="cb19-4"><span class="cf" style="color: #003B4F;
background-color: null;
font-style: inherit;">with</span> <span class="bu" style="color: null;
background-color: null;
font-style: inherit;">open</span>(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"large_document.txt"</span>, <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"rb"</span>) <span class="im" style="color: #00769E;
background-color: null;
font-style: inherit;">as</span> f:</span>
<span id="cb19-5">    content <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> f.read()</span>
<span id="cb19-6">    compressed <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> gzip.compress(content)</span>
<span id="cb19-7"></span>
<span id="cb19-8">blob_client <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> blob_service_client.get_blob_client(</span>
<span id="cb19-9">    container<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"rag-documents"</span>,</span>
<span id="cb19-10">    blob<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"large_document.txt.gz"</span></span>
<span id="cb19-11">)</span>
<span id="cb19-12"></span>
<span id="cb19-13">blob_client.upload_blob(</span>
<span id="cb19-14">    compressed,</span>
<span id="cb19-15">    metadata<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span>{<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"compressed"</span>: <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"gzip"</span>},</span>
<span id="cb19-16">    overwrite<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span><span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">True</span></span>
<span id="cb19-17">)</span>
<span id="cb19-18"></span>
<span id="cb19-19"><span class="bu" style="color: null;
background-color: null;
font-style: inherit;">print</span>(<span class="ss" style="color: #20794D;
background-color: null;
font-style: inherit;">f"원본 크기: </span><span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">{</span><span class="bu" style="color: null;
background-color: null;
font-style: inherit;">len</span>(content)<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">}</span><span class="ss" style="color: #20794D;
background-color: null;
font-style: inherit;"> bytes"</span>)</span>
<span id="cb19-20"><span class="bu" style="color: null;
background-color: null;
font-style: inherit;">print</span>(<span class="ss" style="color: #20794D;
background-color: null;
font-style: inherit;">f"압축 크기: </span><span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">{</span><span class="bu" style="color: null;
background-color: null;
font-style: inherit;">len</span>(compressed)<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">}</span><span class="ss" style="color: #20794D;
background-color: null;
font-style: inherit;"> bytes (</span><span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">{</span><span class="bu" style="color: null;
background-color: null;
font-style: inherit;">len</span>(compressed)<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">/</span><span class="bu" style="color: null;
background-color: null;
font-style: inherit;">len</span>(content)<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">*</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">100</span><span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">:.1f}</span><span class="ss" style="color: #20794D;
background-color: null;
font-style: inherit;">%)"</span>)</span></code></pre></div>
</details>
</div>
</section>
</section>
<section id="보안-설정" class="level2" data-number="12">
<h2 data-number="12" class="anchored" data-anchor-id="보안-설정"><span class="header-section-number">12</span> 보안 설정</h2>
<section id="managed-identity로-인증" class="level3" data-number="12.1">
<h3 data-number="12.1" class="anchored" data-anchor-id="managed-identity로-인증"><span class="header-section-number">12.1</span> Managed Identity로 인증</h3>
<div id="3ff7ee80" class="cell" data-execution_count="17">
<details class="code-fold">
<summary>코드</summary>
<div class="sourceCode cell-code" id="cb20" style="background: #f1f3f5;"><pre class="sourceCode numberSource python number-lines code-with-copy"><code class="sourceCode python"><span id="cb20-1"><span class="im" style="color: #00769E;
background-color: null;
font-style: inherit;">from</span> azure.identity <span class="im" style="color: #00769E;
background-color: null;
font-style: inherit;">import</span> DefaultAzureCredential</span>
<span id="cb20-2"></span>
<span id="cb20-3"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># Managed Identity 사용 (키 노출 없음)</span></span>
<span id="cb20-4">credential <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> DefaultAzureCredential()</span>
<span id="cb20-5"></span>
<span id="cb20-6">blob_service_client <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> BlobServiceClient(</span>
<span id="cb20-7">    account_url<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"https://stragdocs2025.blob.core.windows.net"</span>,</span>
<span id="cb20-8">    credential<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span>credential</span>
<span id="cb20-9">)</span>
<span id="cb20-10"></span>
<span id="cb20-11"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># 이후 동일하게 사용</span></span>
<span id="cb20-12">container_client <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> blob_service_client.get_container_client(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"rag-documents"</span>)</span></code></pre></div>
</details>
</div>
<p><strong>Managed Identity 설정:</strong> 1. Azure Function/Container App → “ID” → “시스템 할당 관리 ID” 활성화 2. Storage Account → “액세스 제어(IAM)” → “역할 할당 추가” 3. 역할: “Storage Blob Data Contributor” 4. 할당 대상: 생성된 Managed Identity</p>
</section>
<section id="private-endpoint-설정" class="level3" data-number="12.2">
<h3 data-number="12.2" class="anchored" data-anchor-id="private-endpoint-설정"><span class="header-section-number">12.2</span> Private Endpoint 설정</h3>
<ol type="1">
<li>Storage Account → “네트워킹” → “프라이빗 엔드포인트 연결”</li>
<li>“+ 프라이빗 엔드포인트” 클릭</li>
<li>설정:
<ul>
<li>리소스 그룹 선택</li>
<li>이름: <code>pe-storage-rag</code></li>
<li>대상 하위 리소스: <code>blob</code></li>
<li>가상 네트워크 및 서브넷 선택</li>
</ul></li>
<li>“만들기” → VNet 내에서만 액세스 가능</li>
</ol>
</section>
</section>
<section id="모니터링" class="level2" data-number="13">
<h2 data-number="13" class="anchored" data-anchor-id="모니터링"><span class="header-section-number">13</span> 모니터링</h2>
<section id="storage-analytics-활성화" class="level3" data-number="13.1">
<h3 data-number="13.1" class="anchored" data-anchor-id="storage-analytics-활성화"><span class="header-section-number">13.1</span> Storage Analytics 활성화</h3>
<div id="2806e37e" class="cell" data-execution_count="18">
<details class="code-fold">
<summary>코드</summary>
<div class="sourceCode cell-code" id="cb21" style="background: #f1f3f5;"><pre class="sourceCode numberSource python number-lines code-with-copy"><code class="sourceCode python"><span id="cb21-1"><span class="im" style="color: #00769E;
background-color: null;
font-style: inherit;">from</span> azure.storage.blob <span class="im" style="color: #00769E;
background-color: null;
font-style: inherit;">import</span> BlobAnalyticsLogging, Metrics, RetentionPolicy</span>
<span id="cb21-2"></span>
<span id="cb21-3"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># Analytics 설정</span></span>
<span id="cb21-4">logging <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> BlobAnalyticsLogging(</span>
<span id="cb21-5">    version<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"1.0"</span>,</span>
<span id="cb21-6">    delete<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span><span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">True</span>,</span>
<span id="cb21-7">    read<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span><span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">True</span>,</span>
<span id="cb21-8">    write<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span><span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">True</span>,</span>
<span id="cb21-9">    retention_policy<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span>RetentionPolicy(enabled<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span><span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">True</span>, days<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">7</span>)</span>
<span id="cb21-10">)</span>
<span id="cb21-11"></span>
<span id="cb21-12">metrics <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> Metrics(</span>
<span id="cb21-13">    version<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"1.0"</span>,</span>
<span id="cb21-14">    enabled<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span><span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">True</span>,</span>
<span id="cb21-15">    include_apis<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span><span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">True</span>,</span>
<span id="cb21-16">    retention_policy<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span>RetentionPolicy(enabled<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span><span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">True</span>, days<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">7</span>)</span>
<span id="cb21-17">)</span>
<span id="cb21-18"></span>
<span id="cb21-19"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># 설정 적용</span></span>
<span id="cb21-20">blob_service_client.set_service_properties(</span>
<span id="cb21-21">    analytics_logging<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span>logging,</span>
<span id="cb21-22">    hour_metrics<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span>metrics,</span>
<span id="cb21-23">    minute_metrics<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span>metrics</span>
<span id="cb21-24">)</span>
<span id="cb21-25"></span>
<span id="cb21-26"><span class="bu" style="color: null;
background-color: null;
font-style: inherit;">print</span>(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Storage Analytics 활성화 완료"</span>)</span></code></pre></div>
</details>
</div>
</section>
<section id="주요-메트릭" class="level3" data-number="13.2">
<h3 data-number="13.2" class="anchored" data-anchor-id="주요-메트릭"><span class="header-section-number">13.2</span> 주요 메트릭</h3>
<p>Azure Portal → Storage Account → “메트릭”: - <strong>Transactions</strong>: 요청 수 (GET, PUT, DELETE) - <strong>Ingress/Egress</strong>: 업로드/다운로드 데이터량 - <strong>Availability</strong>: 가동률 - <strong>Success E2E Latency</strong>: 종단 간 응답 시간</p>
</section>
</section>
<section id="문제-해결" class="level2" data-number="14">
<h2 data-number="14" class="anchored" data-anchor-id="문제-해결"><span class="header-section-number">14</span> 문제 해결</h2>
<section id="일반적인-오류" class="level3" data-number="14.1">
<h3 data-number="14.1" class="anchored" data-anchor-id="일반적인-오류"><span class="header-section-number">14.1</span> 일반적인 오류</h3>
<p><strong>1. AuthorizationPermissionMismatch</strong></p>
<pre><code>오류: 권한 없음
해결: Storage Account IAM에서 "Storage Blob Data Contributor" 역할 추가</code></pre>
<p><strong>2. ContainerNotFound</strong></p>
<div class="sourceCode" id="cb23" style="background: #f1f3f5;"><pre class="sourceCode numberSource python number-lines code-with-copy"><code class="sourceCode python"><span id="cb23-1"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># 컨테이너 존재 확인 후 생성</span></span>
<span id="cb23-2"><span class="cf" style="color: #003B4F;
background-color: null;
font-style: inherit;">try</span>:</span>
<span id="cb23-3">    container_client <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> blob_service_client.get_container_client(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"rag-documents"</span>)</span>
<span id="cb23-4">    container_client.get_container_properties()</span>
<span id="cb23-5"><span class="cf" style="color: #003B4F;
background-color: null;
font-style: inherit;">except</span> <span class="pp" style="color: #AD0000;
background-color: null;
font-style: inherit;">Exception</span>:</span>
<span id="cb23-6">    container_client.create_container()</span></code></pre></div>
<p><strong>3. BlobNotFound</strong></p>
<div class="sourceCode" id="cb24" style="background: #f1f3f5;"><pre class="sourceCode numberSource python number-lines code-with-copy"><code class="sourceCode python"><span id="cb24-1"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># Blob 존재 확인</span></span>
<span id="cb24-2"><span class="cf" style="color: #003B4F;
background-color: null;
font-style: inherit;">if</span> blob_client.exists():</span>
<span id="cb24-3">    blob_client.download_blob()</span>
<span id="cb24-4"><span class="cf" style="color: #003B4F;
background-color: null;
font-style: inherit;">else</span>:</span>
<span id="cb24-5">    <span class="bu" style="color: null;
background-color: null;
font-style: inherit;">print</span>(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"파일이 존재하지 않습니다"</span>)</span></code></pre></div>
</section>
</section>
<section id="참고-자료" class="level2" data-number="15">
<h2 data-number="15" class="anchored" data-anchor-id="참고-자료"><span class="header-section-number">15</span> 참고 자료</h2>
<section id="공식-문서" class="level3" data-number="15.1">
<h3 data-number="15.1" class="anchored" data-anchor-id="공식-문서"><span class="header-section-number">15.1</span> 공식 문서</h3>
<ul>
<li><a href="https://learn.microsoft.com/en-us/azure/storage/blobs/storage-blobs-overview">Azure Blob Storage 개요</a></li>
<li><a href="https://learn.microsoft.com/en-us/python/api/overview/azure/storage-blob-readme">Python SDK 참조</a></li>
<li><a href="https://learn.microsoft.com/en-us/azure/storage/blobs/security-recommendations">보안 가이드</a></li>
</ul>
</section>
<section id="샘플-코드" class="level3" data-number="15.2">
<h3 data-number="15.2" class="anchored" data-anchor-id="샘플-코드"><span class="header-section-number">15.2</span> 샘플 코드</h3>
<ul>
<li><a href="https://github.com/Azure-Samples/azure-storage-python-samples">Azure Storage Python Samples</a></li>
<li><a href="https://python.langchain.com/docs/integrations/document_loaders/azure_blob_storage_file">LangChain Azure 통합</a></li>
</ul>
</section>
</section>
<section id="다음-단계" class="level2" data-number="16">
<h2 data-number="16" class="anchored" data-anchor-id="다음-단계"><span class="header-section-number">16</span> 다음 단계</h2>
<p>문서 저장이 완료되었다면, 이제 OCR 및 레이아웃 분석 단계로 넘어가자:</p>
<p>👉 <a href="../../../../../docs/blog/posts/RAG/13-Cloud-RAG/02-Document-Intelligence.html">02-Document-Intelligence.qmd</a> - Azure Document Intelligence를 활용한 문서 분석</p>


</section>

 ]]></description>
  <category>AI</category>
  <category>RAG</category>
  <category>Azure</category>
  <category>Cloud</category>
  <guid>kk3225.netlify.app/docs/blog/posts/RAG/13-Cloud-RAG/01-Azure-Blob-Storage.html</guid>
  <pubDate>Sat, 01 Nov 2025 15:00:00 GMT</pubDate>
</item>
<item>
  <title>Azure RAG Overview</title>
  <dc:creator>Kwangmin Kim</dc:creator>
  <link>kk3225.netlify.app/docs/blog/posts/RAG/13-Cloud-RAG/00-Azure-RAG-Overview.html</link>
  <description><![CDATA[ 





<section id="azure-rag-파이프라인이란" class="level2" data-number="1">
<h2 data-number="1" class="anchored" data-anchor-id="azure-rag-파이프라인이란"><span class="header-section-number">1</span> Azure RAG 파이프라인이란?</h2>
<p>Azure RAG(Retrieval-Augmented Generation)은 Microsoft Azure 클라우드 서비스를 활용하여 구축하는 엔터프라이즈급 질의응답 시스템이다. 기존 로컬 환경의 RAG와 달리, Azure의 관리형 서비스들을 조합하여 확장 가능하고 안정적인 프로덕션 시스템을 구축할 수 있다.</p>
<p><strong>핵심 가치:</strong> - <strong>완전 관리형</strong>: 인프라 관리 부담 없이 비즈니스 로직에 집중 - <strong>엔터프라이즈급 보안</strong>: Azure AD, RBAC, Private Endpoint 등 기업용 보안 기능 - <strong>글로벌 확장성</strong>: 전 세계 Azure 리전을 활용한 자동 스케일링 - <strong>통합 생태계</strong>: Azure 서비스 간 네이티브 통합으로 빠른 개발</p>
</section>
<section id="azure-rag-아키텍처" class="level2" data-number="2">
<h2 data-number="2" class="anchored" data-anchor-id="azure-rag-아키텍처"><span class="header-section-number">2</span> Azure RAG 아키텍처</h2>
<p>전체 파이프라인은 문서 수집부터 질의응답까지 9단계로 구성된다:</p>
<div class="sourceCode" id="cb1" style="background: #f1f3f5;"><pre class="sourceCode numberSource mermaid number-lines code-with-copy"><code class="sourceCode"><span id="cb1-1">graph TB</span>
<span id="cb1-2">    A[Azure Blob Storage&lt;br/&gt;비정형 문서 저장] --&gt; B[Document Intelligence&lt;br/&gt;OCR &amp; 레이아웃 분석]</span>
<span id="cb1-3">    B --&gt; C[Azure OpenAI Embeddings&lt;br/&gt;문서 임베딩 생성]</span>
<span id="cb1-4">    C --&gt; D[Azure AI Search&lt;br/&gt;벡터 스토어 저장]</span>
<span id="cb1-5">    D --&gt; E[LangChain/LangGraph&lt;br/&gt;RAG 로직 구현]</span>
<span id="cb1-6">    E --&gt; F[Azure OpenAI LLM&lt;br/&gt;컨텍스트 기반 응답 생성]</span>
<span id="cb1-7">    F --&gt; G{배포 방식 선택}</span>
<span id="cb1-8">    G --&gt;|서버리스| H[Azure Functions&lt;br/&gt;이벤트 기반 실행]</span>
<span id="cb1-9">    G --&gt;|컨테이너| I[Azure Container Apps&lt;br/&gt;항시 실행]</span>
<span id="cb1-10">    H --&gt; J[End-User]</span>
<span id="cb1-11">    I --&gt; J</span>
<span id="cb1-12">    </span>
<span id="cb1-13">    style A fill:#e1f5ff</span>
<span id="cb1-14">    style B fill:#fff4e1</span>
<span id="cb1-15">    style C fill:#ffe1f5</span>
<span id="cb1-16">    style D fill:#e1ffe1</span>
<span id="cb1-17">    style E fill:#f5e1ff</span>
<span id="cb1-18">    style F fill:#ffe1e1</span>
<span id="cb1-19">    style H fill:#e1e1ff</span>
<span id="cb1-20">    style I fill:#ffe1cc</span></code></pre></div>
</section>
<section id="주요-azure-서비스-소개" class="level2" data-number="3">
<h2 data-number="3" class="anchored" data-anchor-id="주요-azure-서비스-소개"><span class="header-section-number">3</span> 주요 Azure 서비스 소개</h2>
<section id="azure-blob-storage" class="level3" data-number="3.1">
<h3 data-number="3.1" class="anchored" data-anchor-id="azure-blob-storage"><span class="header-section-number">3.1</span> Azure Blob Storage</h3>
<p><strong>역할</strong>: 비정형 문서 저장소</p>
<ul>
<li>PDF, Word, Excel, 이미지 등 다양한 형식의 문서 저장</li>
<li>계층형 스토리지(Hot/Cool/Archive)로 비용 최적화</li>
<li>대용량 파일 업로드 및 버전 관리</li>
</ul>
<p><strong>사용 이유</strong>: - 안정적이고 확장 가능한 클라우드 스토리지 - Azure 서비스와의 완벽한 통합 - 저렴한 비용 (GB당 $0.018/월부터)</p>
</section>
<section id="document-intelligence-구-form-recognizer" class="level3" data-number="3.2">
<h3 data-number="3.2" class="anchored" data-anchor-id="document-intelligence-구-form-recognizer"><span class="header-section-number">3.2</span> Document Intelligence (구 Form Recognizer)</h3>
<p><strong>역할</strong>: OCR 및 문서 레이아웃 분석</p>
<ul>
<li>스캔 문서, 이미지에서 텍스트 추출</li>
<li>표, 제목, 단락 등 문서 구조 인식</li>
<li>한국어를 포함한 100개 이상 언어 지원</li>
</ul>
<p><strong>사용 이유</strong>: - 높은 OCR 정확도 (한국어 95% 이상) - 문서 레이아웃 유지로 컨텍스트 보존 - API 기반으로 쉬운 통합</p>
</section>
<section id="azure-openai-service" class="level3" data-number="3.3">
<h3 data-number="3.3" class="anchored" data-anchor-id="azure-openai-service"><span class="header-section-number">3.3</span> Azure OpenAI Service</h3>
<p><strong>역할</strong>: 임베딩 생성 및 LLM 질의응답</p>
<p><strong>Embeddings 모델</strong>: - <code>text-embedding-ada-002</code>: 1536차원, 범용 - <code>text-embedding-3-small</code>: 512/1536차원, 빠른 속도 - <code>text-embedding-3-large</code>: 256~3072차원, 최고 성능</p>
<p><strong>LLM 모델</strong>: - <code>gpt-4o</code>: 최신 멀티모달 모델 - <code>gpt-4-turbo</code>: 빠른 속도, 128K 컨텍스트 - <code>gpt-35-turbo</code>: 비용 효율적</p>
<p><strong>사용 이유</strong>: - 엔터프라이즈 SLA 보장 (99.9% 가동률) - 데이터 주권 준수 (한국 리전 사용 시 데이터가 한국에 유지) - Azure AD 통합 인증</p>
</section>
<section id="azure-ai-search-구-azure-cognitive-search" class="level3" data-number="3.4">
<h3 data-number="3.4" class="anchored" data-anchor-id="azure-ai-search-구-azure-cognitive-search"><span class="header-section-number">3.4</span> Azure AI Search (구 Azure Cognitive Search)</h3>
<p><strong>역할</strong>: 벡터 스토어 및 하이브리드 검색</p>
<ul>
<li>벡터 검색 + 전문 검색 하이브리드 지원</li>
<li>시맨틱 랭킹으로 검색 품질 향상</li>
<li>자동 인덱싱 및 스케일링</li>
</ul>
<p><strong>사용 이유</strong>: - 네이티브 하이브리드 검색 (키워드 + 벡터) - 엔터프라이즈급 보안 및 규정 준수 - Azure 서비스와의 완벽한 통합</p>
</section>
<section id="langchain-langgraph" class="level3" data-number="3.5">
<h3 data-number="3.5" class="anchored" data-anchor-id="langchain-langgraph"><span class="header-section-number">3.5</span> LangChain &amp; LangGraph</h3>
<p><strong>역할</strong>: RAG 로직 구현 프레임워크</p>
<p><strong>LangChain</strong>: - 문서 로딩, 분할, 임베딩 파이프라인 - 체인 구성으로 복잡한 워크플로우 구현 - Azure 서비스 통합 커넥터 제공</p>
<p><strong>LangGraph</strong>: - 상태 기반 워크플로우 관리 - 멀티 에이전트 협업 - 조건부 분기 및 루프 처리</p>
<p><strong>사용 이유</strong>: - 검증된 RAG 구현 패턴 - Azure 네이티브 통합 - 활발한 커뮤니티와 풍부한 예제</p>
</section>
<section id="azure-functions" class="level3" data-number="3.6">
<h3 data-number="3.6" class="anchored" data-anchor-id="azure-functions"><span class="header-section-number">3.6</span> Azure Functions</h3>
<p><strong>역할</strong>: 서버리스 RAG 배포</p>
<ul>
<li>이벤트 기반 실행 (HTTP, Blob Trigger 등)</li>
<li>자동 스케일링 (0에서 수천 인스턴스까지)</li>
<li>종량제 과금 (실행 시간만 비용 청구)</li>
</ul>
<p><strong>사용 이유</strong>: - 간헐적 사용 시 비용 효율적 - 인프라 관리 불필요 - 빠른 배포 및 업데이트</p>
</section>
<section id="azure-container-apps" class="level3" data-number="3.7">
<h3 data-number="3.7" class="anchored" data-anchor-id="azure-container-apps"><span class="header-section-number">3.7</span> Azure Container Apps</h3>
<p><strong>역할</strong>: 컨테이너 기반 RAG 배포</p>
<ul>
<li>항시 실행되는 API 서버 호스팅</li>
<li>Kubernetes 기반 자동 스케일링</li>
<li>멀티 컨테이너 앱 지원</li>
</ul>
<p><strong>사용 이유</strong>: - 지속적 트래픽 처리에 적합 - 복잡한 종속성 관리 용이 - 컨테이너 표준 활용</p>
</section>
</section>
<section id="azure-rag-vs-로컬-rag-비교" class="level2" data-number="4">
<h2 data-number="4" class="anchored" data-anchor-id="azure-rag-vs-로컬-rag-비교"><span class="header-section-number">4</span> Azure RAG vs 로컬 RAG 비교</h2>
<table class="caption-top table">
<thead>
<tr class="header">
<th>항목</th>
<th>로컬 RAG</th>
<th>Azure RAG</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td><strong>인프라 관리</strong></td>
<td>직접 관리 필요</td>
<td>완전 관리형</td>
</tr>
<tr class="even">
<td><strong>확장성</strong></td>
<td>수동 스케일링</td>
<td>자동 스케일링</td>
</tr>
<tr class="odd">
<td><strong>비용</strong></td>
<td>고정 비용 (서버 구매)</td>
<td>사용량 기반 (종량제)</td>
</tr>
<tr class="even">
<td><strong>보안</strong></td>
<td>자체 구현</td>
<td>엔터프라이즈급 내장</td>
</tr>
<tr class="odd">
<td><strong>고가용성</strong></td>
<td>직접 구성</td>
<td>99.9% SLA 보장</td>
</tr>
<tr class="even">
<td><strong>글로벌 배포</strong></td>
<td>어려움</td>
<td>전 세계 리전 활용</td>
</tr>
<tr class="odd">
<td><strong>모니터링</strong></td>
<td>별도 도구 필요</td>
<td>Azure Monitor 통합</td>
</tr>
<tr class="even">
<td><strong>비용 예측</strong></td>
<td>명확</td>
<td>변동 가능</td>
</tr>
</tbody>
</table>
<p><strong>로컬 RAG가 적합한 경우</strong>: - 데이터 외부 유출 절대 불가 - 고정적이고 예측 가능한 워크로드 - 클라우드 비용 부담</p>
<p><strong>Azure RAG가 적합한 경우</strong>: - 엔터프라이즈급 보안 및 규정 준수 필요 - 가변적인 트래픽 패턴 - 빠른 개발 및 배포 - 글로벌 서비스 제공</p>
</section>
<section id="azure-rag-구축-단계별-가이드" class="level2" data-number="5">
<h2 data-number="5" class="anchored" data-anchor-id="azure-rag-구축-단계별-가이드"><span class="header-section-number">5</span> Azure RAG 구축 단계별 가이드</h2>
<section id="단계-문서-저장-azure-blob-storage" class="level3" data-number="5.1">
<h3 data-number="5.1" class="anchored" data-anchor-id="단계-문서-저장-azure-blob-storage"><span class="header-section-number">5.1</span> 1단계: 문서 저장 (Azure Blob Storage)</h3>
<ul>
<li>Storage Account 생성</li>
<li>컨테이너 설정 및 문서 업로드</li>
<li>액세스 정책 및 SAS 토큰 관리</li>
</ul>
<p><a href="../../../../../docs/blog/posts/RAG/13-Cloud-RAG/01-Azure-Blob-Storage.html">상세 가이드: 01-Azure-Blob-Storage.qmd</a></p>
</section>
<section id="단계-문서-분석-document-intelligence" class="level3" data-number="5.2">
<h3 data-number="5.2" class="anchored" data-anchor-id="단계-문서-분석-document-intelligence"><span class="header-section-number">5.2</span> 2단계: 문서 분석 (Document Intelligence)</h3>
<ul>
<li>Document Intelligence 리소스 생성</li>
<li>Layout 또는 Read API를 통한 OCR</li>
<li>테이블, 제목, 단락 구조 추출</li>
</ul>
<p><a href="../../../../../docs/blog/posts/RAG/13-Cloud-RAG/02-Document-Intelligence.html">상세 가이드: 02-Document-Intelligence.qmd</a></p>
</section>
<section id="단계-임베딩-생성-azure-openai" class="level3" data-number="5.3">
<h3 data-number="5.3" class="anchored" data-anchor-id="단계-임베딩-생성-azure-openai"><span class="header-section-number">5.3</span> 3단계: 임베딩 생성 (Azure OpenAI)</h3>
<ul>
<li>Azure OpenAI 리소스 및 배포 생성</li>
<li>Embeddings 모델 선택 (ada-002, text-embedding-3)</li>
<li>문서 청크 임베딩 생성</li>
</ul>
<p><a href="../../../../../docs/blog/posts/RAG/13-Cloud-RAG/03-Azure-OpenAI-Embeddings.html">상세 가이드: 03-Azure-OpenAI-Embeddings.qmd</a></p>
</section>
<section id="단계-벡터-저장-azure-ai-search" class="level3" data-number="5.4">
<h3 data-number="5.4" class="anchored" data-anchor-id="단계-벡터-저장-azure-ai-search"><span class="header-section-number">5.4</span> 4단계: 벡터 저장 (Azure AI Search)</h3>
<ul>
<li>Azure AI Search 서비스 생성</li>
<li>인덱스 스키마 정의 (벡터 필드 포함)</li>
<li>벡터 및 메타데이터 업로드</li>
</ul>
<p><a href="../../../../../docs/blog/posts/RAG/13-Cloud-RAG/04-Azure-AI-Search-Integration.html">상세 가이드: 04-Azure-AI-Search-Integration.qmd</a></p>
</section>
<section id="단계-rag-로직-구현-langchainlanggraph" class="level3" data-number="5.5">
<h3 data-number="5.5" class="anchored" data-anchor-id="단계-rag-로직-구현-langchainlanggraph"><span class="header-section-number">5.5</span> 5단계: RAG 로직 구현 (LangChain/LangGraph)</h3>
<ul>
<li>LangChain으로 기본 RAG 체인 구성</li>
<li>LangGraph로 복잡한 워크플로우 구현</li>
<li>프롬프트 엔지니어링 및 최적화</li>
</ul>
<p><a href="../../../../../docs/blog/posts/RAG/13-Cloud-RAG/05-LangChain-to-LangGraph.html">상세 가이드: 05-LangChain-to-LangGraph.qmd</a></p>
</section>
<section id="단계-질의응답-생성-azure-openai-llm" class="level3" data-number="5.6">
<h3 data-number="5.6" class="anchored" data-anchor-id="단계-질의응답-생성-azure-openai-llm"><span class="header-section-number">5.6</span> 6단계: 질의응답 생성 (Azure OpenAI LLM)</h3>
<ul>
<li>GPT-4 또는 GPT-3.5 Turbo 배포</li>
<li>시스템 프롬프트 설정</li>
<li>스트리밍 응답 구현</li>
</ul>
<p><a href="../../../../../docs/blog/posts/RAG/13-Cloud-RAG/06-Azure-OpenAI-LLM.html">상세 가이드: 06-Azure-OpenAI-LLM.qmd</a></p>
</section>
<section id="단계-서버리스-배포-azure-functions" class="level3" data-number="5.7">
<h3 data-number="5.7" class="anchored" data-anchor-id="단계-서버리스-배포-azure-functions"><span class="header-section-number">5.7</span> 7단계: 서버리스 배포 (Azure Functions)</h3>
<ul>
<li>Python Function App 생성</li>
<li>HTTP 트리거 함수 구현</li>
<li>환경 변수 및 시크릿 관리</li>
</ul>
<p><a href="../../../../../docs/blog/posts/RAG/13-Cloud-RAG/07-Azure-Functions-Apps.html">상세 가이드: 07-Azure-Functions-Apps.qmd</a></p>
</section>
<section id="단계-컨테이너-배포-azure-container-apps" class="level3" data-number="5.8">
<h3 data-number="5.8" class="anchored" data-anchor-id="단계-컨테이너-배포-azure-container-apps"><span class="header-section-number">5.8</span> 8단계: 컨테이너 배포 (Azure Container Apps)</h3>
<ul>
<li>Docker 이미지 빌드</li>
<li>Container Registry 푸시</li>
<li>Container Apps 배포 및 스케일링 설정</li>
</ul>
<p><a href="../../../../../docs/blog/posts/RAG/13-Cloud-RAG/08-Azure-Container-Apps.html">상세 가이드: 08-Azure-Container-Apps.qmd</a></p>
</section>
<section id="단계-전체-통합-end-to-end" class="level3" data-number="5.9">
<h3 data-number="5.9" class="anchored" data-anchor-id="단계-전체-통합-end-to-end"><span class="header-section-number">5.9</span> 9단계: 전체 통합 (End-to-End)</h3>
<ul>
<li>전체 파이프라인 통합 테스트</li>
<li>모니터링 및 로깅 설정</li>
<li>성능 최적화 및 비용 관리</li>
</ul>
<p><a href="../../../../../docs/blog/posts/RAG/13-Cloud-RAG/09-End-to-End-Azure-RAG.html">상세 가이드: 09-End-to-End-Azure-RAG.qmd</a></p>
</section>
</section>
<section id="비용-예측" class="level2" data-number="6">
<h2 data-number="6" class="anchored" data-anchor-id="비용-예측"><span class="header-section-number">6</span> 비용 예측</h2>
<section id="예제-시나리오-월-10000회-질의응답" class="level3" data-number="6.1">
<h3 data-number="6.1" class="anchored" data-anchor-id="예제-시나리오-월-10000회-질의응답"><span class="header-section-number">6.1</span> 예제 시나리오: 월 10,000회 질의응답</h3>
<p><strong>Azure Blob Storage</strong>: - 10GB 문서 저장: $0.18/월 (Hot tier) - 10,000회 읽기: $0.004/월 - <strong>소계: $0.18/월</strong></p>
<p><strong>Document Intelligence</strong>: - 1,000페이지 OCR (초기 한 번): $1.50 - <strong>소계: $1.50 (초기 비용)</strong></p>
<p><strong>Azure OpenAI Embeddings</strong>: - 10,000 문서 청크 (초기 한 번): $0.40 - <strong>소계: $0.40 (초기 비용)</strong></p>
<p><strong>Azure AI Search</strong>: - Basic 계층 (15GB): $73.73/월 - 10,000회 검색 쿼리: 포함됨 - <strong>소계: $73.73/월</strong></p>
<p><strong>Azure OpenAI LLM</strong>: - GPT-4o: 10,000 요청 × (입력 1,000토큰 + 출력 500토큰) - 입력: 10M 토큰 × $2.50/1M = $25 - 출력: 5M 토큰 × $10/1M = $50 - <strong>소계: $75/월</strong></p>
<p><strong>Azure Functions (서버리스 배포)</strong>: - 10,000 실행: 무료 (월 100만 실행 무료) - 실행 시간: $0.20/월 - <strong>소계: $0.20/월</strong></p>
<p><strong>총 예상 비용</strong>: 초기 $1.90 + <strong>월 $149.31</strong></p>
<p><strong>비용 최적화 팁</strong>: - GPT-3.5-Turbo 사용 시 LLM 비용 80% 절감 - 캐싱 전략으로 중복 쿼리 비용 절감 - Azure AI Search Free 계층으로 시작 (개발/테스트)</p>
</section>
</section>
<section id="보안-및-규정-준수" class="level2" data-number="7">
<h2 data-number="7" class="anchored" data-anchor-id="보안-및-규정-준수"><span class="header-section-number">7</span> 보안 및 규정 준수</h2>
<section id="데이터-주권" class="level3" data-number="7.1">
<h3 data-number="7.1" class="anchored" data-anchor-id="데이터-주권"><span class="header-section-number">7.1</span> 데이터 주권</h3>
<ul>
<li><strong>리전 선택</strong>: 데이터가 물리적으로 저장되는 위치 제어</li>
<li><strong>한국 리전</strong>: Korea Central, Korea South (데이터가 한국 내에만 유지)</li>
<li><strong>데이터 레지던시</strong>: 금융권, 공공기관 규제 준수</li>
</ul>
</section>
<section id="인증-및-권한-관리" class="level3" data-number="7.2">
<h3 data-number="7.2" class="anchored" data-anchor-id="인증-및-권한-관리"><span class="header-section-number">7.2</span> 인증 및 권한 관리</h3>
<ul>
<li><strong>Azure AD 통합</strong>: 기업 SSO 연동</li>
<li><strong>Managed Identity</strong>: 코드에 시크릿 노출 없이 안전한 인증</li>
<li><strong>RBAC</strong>: 세밀한 역할 기반 액세스 제어</li>
</ul>
</section>
<section id="네트워크-보안" class="level3" data-number="7.3">
<h3 data-number="7.3" class="anchored" data-anchor-id="네트워크-보안"><span class="header-section-number">7.3</span> 네트워크 보안</h3>
<ul>
<li><strong>Private Endpoint</strong>: 인터넷 노출 없이 Azure 서비스 접근</li>
<li><strong>VNet 통합</strong>: 기업 내부 네트워크와 안전한 연결</li>
<li><strong>NSG</strong>: 네트워크 수준 트래픽 제어</li>
</ul>
</section>
<section id="규정-준수-인증" class="level3" data-number="7.4">
<h3 data-number="7.4" class="anchored" data-anchor-id="규정-준수-인증"><span class="header-section-number">7.4</span> 규정 준수 인증</h3>
<ul>
<li>ISO 27001, SOC 2, GDPR, HIPAA 등 준수</li>
<li>금융권 ISMS-P, 전자금융감독규정 대응 가능</li>
<li>정기 감사 및 취약점 스캔 자동화</li>
</ul>
</section>
</section>
<section id="모니터링-및-운영" class="level2" data-number="8">
<h2 data-number="8" class="anchored" data-anchor-id="모니터링-및-운영"><span class="header-section-number">8</span> 모니터링 및 운영</h2>
<section id="azure-monitor-통합" class="level3" data-number="8.1">
<h3 data-number="8.1" class="anchored" data-anchor-id="azure-monitor-통합"><span class="header-section-number">8.1</span> Azure Monitor 통합</h3>
<div class="sourceCode" id="cb2" style="background: #f1f3f5;"><pre class="sourceCode numberSource python number-lines code-with-copy"><code class="sourceCode python"><span id="cb2-1"><span class="im" style="color: #00769E;
background-color: null;
font-style: inherit;">from</span> azure.monitor.opentelemetry <span class="im" style="color: #00769E;
background-color: null;
font-style: inherit;">import</span> configure_azure_monitor</span>
<span id="cb2-2"><span class="im" style="color: #00769E;
background-color: null;
font-style: inherit;">from</span> opentelemetry <span class="im" style="color: #00769E;
background-color: null;
font-style: inherit;">import</span> trace</span>
<span id="cb2-3"></span>
<span id="cb2-4"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># Application Insights 연동</span></span>
<span id="cb2-5">configure_azure_monitor(</span>
<span id="cb2-6">    connection_string<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"InstrumentationKey=xxx"</span></span>
<span id="cb2-7">)</span>
<span id="cb2-8"></span>
<span id="cb2-9">tracer <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> trace.get_tracer(<span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">__name__</span>)</span>
<span id="cb2-10"></span>
<span id="cb2-11"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># RAG 실행 추적</span></span>
<span id="cb2-12"><span class="cf" style="color: #003B4F;
background-color: null;
font-style: inherit;">with</span> tracer.start_as_current_span(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"rag_query"</span>):</span>
<span id="cb2-13">    <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># RAG 로직 실행</span></span>
<span id="cb2-14">    result <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> rag_chain.invoke({<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"query"</span>: question})</span></code></pre></div>
</section>
<section id="주요-모니터링-메트릭" class="level3" data-number="8.2">
<h3 data-number="8.2" class="anchored" data-anchor-id="주요-모니터링-메트릭"><span class="header-section-number">8.2</span> 주요 모니터링 메트릭</h3>
<ul>
<li><strong>성능</strong>: 응답 시간, 처리량, 대기 시간</li>
<li><strong>비용</strong>: 서비스별 비용 추적, 예산 알람</li>
<li><strong>오류</strong>: 실패율, 예외 발생 빈도</li>
<li><strong>사용자</strong>: 동시 사용자 수, 요청 패턴</li>
</ul>
</section>
<section id="로깅-전략" class="level3" data-number="8.3">
<h3 data-number="8.3" class="anchored" data-anchor-id="로깅-전략"><span class="header-section-number">8.3</span> 로깅 전략</h3>
<ul>
<li><strong>구조화 로깅</strong>: JSON 형식으로 검색 및 분석 용이</li>
<li><strong>로그 수준</strong>: DEBUG, INFO, WARNING, ERROR, CRITICAL</li>
<li><strong>민감 정보 마스킹</strong>: PII 데이터 자동 제거</li>
</ul>
</section>
</section>
<section id="참고-자료" class="level2" data-number="9">
<h2 data-number="9" class="anchored" data-anchor-id="참고-자료"><span class="header-section-number">9</span> 참고 자료</h2>
<section id="공식-문서" class="level3" data-number="9.1">
<h3 data-number="9.1" class="anchored" data-anchor-id="공식-문서"><span class="header-section-number">9.1</span> 공식 문서</h3>
<ul>
<li><a href="https://learn.microsoft.com/en-us/azure/ai-services/">Azure AI Services 문서</a></li>
<li><a href="https://learn.microsoft.com/en-us/azure/ai-services/openai/">Azure OpenAI Service</a></li>
<li><a href="https://learn.microsoft.com/en-us/azure/search/">Azure AI Search</a></li>
<li><a href="https://learn.microsoft.com/en-us/azure/storage/blobs/">Azure Blob Storage</a></li>
<li><a href="https://learn.microsoft.com/en-us/azure/ai-services/document-intelligence/">Document Intelligence</a></li>
</ul>
</section>
<section id="아키텍처-가이드" class="level3" data-number="9.2">
<h3 data-number="9.2" class="anchored" data-anchor-id="아키텍처-가이드"><span class="header-section-number">9.2</span> 아키텍처 가이드</h3>
<ul>
<li><a href="https://learn.microsoft.com/en-us/azure/architecture/ai-ml/architecture/rag-solution">Azure OpenAI + RAG 참조 아키텍처</a></li>
<li><a href="https://learn.microsoft.com/en-us/azure/architecture/ai-ml/guide/rag-solution-design-and-evaluation-guide">엔터프라이즈 RAG 보안 가이드</a></li>
</ul>
</section>
<section id="샘플-코드" class="level3" data-number="9.3">
<h3 data-number="9.3" class="anchored" data-anchor-id="샘플-코드"><span class="header-section-number">9.3</span> 샘플 코드</h3>
<ul>
<li><a href="https://github.com/Azure-Samples/azure-search-openai-demo">Azure Search OpenAI Demo</a></li>
<li><a href="https://github.com/Azure-Samples/openai">Azure OpenAI Samples</a></li>
<li><a href="https://python.langchain.com/docs/integrations/platforms/microsoft">LangChain Azure 통합</a></li>
</ul>
</section>
<section id="커뮤니티" class="level3" data-number="9.4">
<h3 data-number="9.4" class="anchored" data-anchor-id="커뮤니티"><span class="header-section-number">9.4</span> 커뮤니티</h3>
<ul>
<li><a href="https://discord.gg/azure-ai">Azure AI Discord</a></li>
<li><a href="https://techcommunity.microsoft.com/t5/azure-ai-services/bd-p/Azure-AI-Services">Microsoft Tech Community</a></li>
<li><a href="https://stackoverflow.com/questions/tagged/azure">Stack Overflow - Azure</a></li>
</ul>
</section>
</section>
<section id="다음-단계" class="level2" data-number="10">
<h2 data-number="10" class="anchored" data-anchor-id="다음-단계"><span class="header-section-number">10</span> 다음 단계</h2>
<p>이제 Azure RAG 파이프라인의 전체적인 그림을 이해했다면, 각 단계를 상세히 학습할 차례다:</p>
<ol type="1">
<li><strong>문서 저장 시작하기</strong> → <a href="../../../../../docs/blog/posts/RAG/13-Cloud-RAG/01-Azure-Blob-Storage.html">01-Azure-Blob-Storage.qmd</a></li>
<li><strong>문서 OCR 알아보기</strong> → <a href="../../../../../docs/blog/posts/RAG/13-Cloud-RAG/02-Document-Intelligence.html">02-Document-Intelligence.qmd</a></li>
<li><strong>임베딩 생성하기</strong> → <a href="../../../../../docs/blog/posts/RAG/13-Cloud-RAG/03-Azure-OpenAI-Embeddings.html">03-Azure-OpenAI-Embeddings.qmd</a></li>
</ol>
<p>각 단계를 순차적으로 따라가면서 실제 동작하는 Azure RAG 시스템을 구축해보자!</p>


</section>

 ]]></description>
  <category>AI</category>
  <category>RAG</category>
  <category>LangChain</category>
  <category>Azure</category>
  <guid>kk3225.netlify.app/docs/blog/posts/RAG/13-Cloud-RAG/00-Azure-RAG-Overview.html</guid>
  <pubDate>Fri, 31 Oct 2025 15:00:00 GMT</pubDate>
</item>
<item>
  <title>비동기 프로그래밍 (Asynchronous Programming)</title>
  <dc:creator>Kwangmin Kim</dc:creator>
  <link>kk3225.netlify.app/docs/blog/posts/Engineering/Python/async.html</link>
  <description><![CDATA[ 





<section id="비동기-프로그래밍-asynchronous-programming-개요" class="level2" data-number="1">
<h2 data-number="1" class="anchored" data-anchor-id="비동기-프로그래밍-asynchronous-programming-개요"><span class="header-section-number">1</span> 비동기 프로그래밍 (Asynchronous Programming) 개요</h2>
<ul>
<li>비동기 프로그래밍은 <strong>단일 스레드(Single Thread)</strong> 환경에서 I/O 작업으로 인한 대기 시간(Latency)을 효율적으로 활용하여 <strong>동시성(Concurrency)</strong>을 달성하고 시스템의 <strong>처리량(Throughput)</strong>을 극대화하는 프로그래밍 패러다임</li>
<li>동시에 여러 이벤트를 효율적으로 처리할 수 있지만 병렬작업과는 완전히 다른 개념</li>
</ul>
<section id="비동기란" class="level3" data-number="1.1">
<h3 data-number="1.1" class="anchored" data-anchor-id="비동기란"><span class="header-section-number">1.1</span> 비동기란?</h3>
<p>비동기 방식의 핵심은 <strong>“빠른 주체(CPU)를 느린 주체(I/O 장치)가 멈추게 하지 않도록 보호”</strong>하는 것</p>
<ul>
<li><strong>배경:</strong> 프로그램 실행 주체인 <strong>CPU</strong>는 초고속이지만, <strong>I/O 작업</strong> (네트워크 통신, 파일 접근, 데이터베이스 조회 등)은 수백~수천 배 느림</li>
<li><strong>동기(Synchronous) 방식의 문제:</strong> CPU가 느린 I/O 작업이 끝날 때까지 멈춰서 <strong>강제로 대기(Blocking)</strong>하며 에너지를 낭비</li>
<li><strong>비동기 방식으로 해결:</strong> CPU는 느린 I/O 작업을 <strong>OS 커널에 위임</strong>하고, 완료를 기다리지 않고 <strong>그 시간 동안 다른 요청을 처리</strong></li>
</ul>
<p><strong>결론:</strong> 비동기는 물리적인 동시 실행(병렬)보다는 <strong>CPU의 유휴(노는) 시간을 제거</strong>하여 프로그램의 반응성과 효율을 높이는 데 초점</p>
</section>
<section id="핵심-작동-원리-이벤트-루프와-협력" class="level3" data-number="1.2">
<h3 data-number="1.2" class="anchored" data-anchor-id="핵심-작동-원리-이벤트-루프와-협력"><span class="header-section-number">1.2</span> 핵심 작동 원리: 이벤트 루프와 협력</h3>
<p>비동기 프로그래밍이 순서가 꼬이지 않고 안정적으로 작동할 수 있는 핵심은 <strong>이벤트 루프(Event Loop)</strong>와 <strong>협력적 멀티태스킹</strong></p>
<ul>
<li><strong>이벤트 루프 (Event Loop):</strong>
<ul>
<li>비동기 작업의 <strong>교통 정리 관제탑</strong></li>
<li>CPU(메인 스레드)의 상태와 I/O 작업의 완료 여부를 끊임없이 감시하며, CPU가 비어 있을 때 처리할 다음 작업을 스케줄링</li>
</ul></li>
<li><strong>코루틴 (Coroutine):</strong> <code>async def</code>로 정의된 함수로, 실행을 <strong>일시 중지</strong>했다가 나중에 <strong>재개</strong>할 수 있는 특별한 실행 단위</li>
<li><strong><code>await</code> 키워드:</strong>
<ul>
<li>코루틴 내에서 <strong>I/O 대기</strong>가 필요한 지점을 <strong>명시적으로 표시</strong></li>
<li>CPU가 <code>await</code>을 만나면 <strong>스스로 제어권을 이벤트 루프에게 반납</strong>하고, 이벤트 루프는 그 시간에 다른 준비된 코루틴을 실행</li>
<li>주의) CPU가 <code>await</code>을 만나면 <strong>무조건 제어권을 이벤트 루프에게 반납하진 않음</strong></li>
</ul></li>
</ul>
</section>
<section id="비동기-프로그래밍-설계-시-유의사항-cpu-작업의-함정" class="level3" data-number="1.3">
<h3 data-number="1.3" class="anchored" data-anchor-id="비동기-프로그래밍-설계-시-유의사항-cpu-작업의-함정"><span class="header-section-number">1.3</span> 비동기 프로그래밍 설계 시 유의사항 (CPU 작업의 함정)</h3>
<p>비동기 환경에서 가장 중요한 원칙은 <strong>CPU의 블로킹을 절대 허용하지 않는 것</strong></p>
<ul>
<li><strong>CPU 집약적 연산의 위험:</strong> <code>await</code>이 없는 <strong>오래 걸리는 순수 CPU 연산</strong> (예: 복잡한 계산, 머신러닝 최적화)은 CPU가 제어권을 이벤트 루프에게 반납할 수 있는 <strong>논리적인 틈이 없기 때문</strong>에, <strong>메인 스레드를 블로킹</strong>하여 비동기 시스템 전체를 마비시킴</li>
<li><strong>올바른 설계:</strong>
<ul>
<li>코루틴 내부에는 <strong>I/O 작업(<code>await</code>)</strong>과 <strong>매우 짧은 CPU 연산</strong>만 배치하는 것이 원칙</li>
<li>오래 걸리는 CPU 작업은 <code>asyncio.to_thread()</code> 등을 사용하여 <strong>별도의 스레드에 위임(병렬 처리)</strong>해야함</li>
</ul></li>
</ul>
</section>
</section>
<section id="세부-설명" class="level2" data-number="2">
<h2 data-number="2" class="anchored" data-anchor-id="세부-설명"><span class="header-section-number">2</span> 세부 설명</h2>
<section id="비동기-프로그래밍의-등장-배경-속도의-불균형" class="level3" data-number="2.1">
<h3 data-number="2.1" class="anchored" data-anchor-id="비동기-프로그래밍의-등장-배경-속도의-불균형"><span class="header-section-number">2.1</span> 비동기 프로그래밍의 등장 배경: 속도의 불균형</h3>
<p>앞서 배경에서 언급했듯이, 하나의 프로그램을 실행하는 데 관여하는 <strong>주체들(Components)의 연산 속도 차이가 매우 심하다</strong>는 것이라는 것을 명심.</p>
<ul>
<li><strong>CPU (중앙 처리 장치):</strong> 초당 수십억 번의 연산을 수행하는 ‘매우 빠른 주체’.</li>
<li><strong>I/O (입출력 장치):</strong> 네트워크 통신, 디스크 파일 읽기/쓰기, 데이터베이스 조회 등 ‘매우 느린 주체’.</li>
</ul>
<p>전통적인 <strong>동기(Synchronous) 방식</strong>에서는 CPU가 코드를 순서대로 실행하다가 I/O 작업을 만나면, 그 느린 작업이 완료될 때까지 <strong>CPU는 아무 일도 하지 않고 멈춰서 대기(Blocking)</strong> 하는 것은 엄청난 자원 낭비로 이어짐.</p>
</section>
<section id="비동기asynchronous-방식의-핵심-목표-효율성" class="level3" data-number="2.2">
<h3 data-number="2.2" class="anchored" data-anchor-id="비동기asynchronous-방식의-핵심-목표-효율성"><span class="header-section-number">2.2</span> 비동기(Asynchronous) 방식의 핵심 목표: 효율성</h3>
<p>비동기 프로그래밍은 이 낭비를 막기 위해 등장</p>
<blockquote class="blockquote">
<p><strong>“빠른 주체(CPU)가 느린 주체(I/O)를 기다리며 쉴 틈을 주지 않고, 그 시간에 다른 일을 하게 만드는 것.”</strong></p>
</blockquote>
<ul>
<li>이것이 궁극적으로 도출된 비동기 프로그래밍의 핵심 목표.</li>
<li>즉, 비동기는 <strong>CPU의 유휴 시간(Idle Time)을 최소화</strong>하여 시스템 전체의 효율(처리량)을 극대화하는 방식</li>
</ul>
</section>
<section id="비동기-vs.-병렬-중요한-구분" class="level3" data-number="2.3">
<h3 data-number="2.3" class="anchored" data-anchor-id="비동기-vs.-병렬-중요한-구분"><span class="header-section-number">2.3</span> 비동기 vs.&nbsp;병렬: 중요한 구분</h3>
<p>우리는 이것이 <strong>병렬 작업(Parallelism)</strong>과 다르다는 점을 명확히 해야함</p>
<ul>
<li><strong>병렬 작업:</strong> 여러 개의 CPU 코어를 동원해 <strong>하나의 무거운 계산(CPU 작업)</strong>을 동시에 처리하여 ’총 작업 시간’을 줄이는 것. (예: 머신러닝 학습)</li>
<li><strong>비동기 작업 (동시성):</strong> <strong>하나의 CPU 코어</strong>가 여러 개의 <strong>느린 I/O 작업</strong> 사이를 효율적으로 오가며 ’대기 시간’을 활용하는 것</li>
</ul>
</section>
<section id="어떻게-비동기-프로그래밍을-구현하나-await-태깅과-이벤트-루프" class="level3" data-number="2.4">
<h3 data-number="2.4" class="anchored" data-anchor-id="어떻게-비동기-프로그래밍을-구현하나-await-태깅과-이벤트-루프"><span class="header-section-number">2.4</span> ‘어떻게’ 비동기 프로그래밍을 구현하나? (Await 태깅과 이벤트 루프)</h3>
<ul>
<li>그렇다면 CPU가 어떻게 I/O 작업을 기다리지 않고 다른 일을 할 수 있을까?</li>
<li>여기서 <code>async</code>와 <code>await</code>의 진짜 의미가 등장</li>
</ul>
<section id="프로그래머의-약속-async와-await-태깅" class="level4" data-number="2.4.1">
<h4 data-number="2.4.1" class="anchored" data-anchor-id="프로그래머의-약속-async와-await-태깅"><span class="header-section-number">2.4.1</span> 프로그래머의 약속: <code>async</code>와 <code>await</code> 태깅</h4>
<p>프로그래머가 CPU와 I/O가 할 일을 <strong>구분해서 코딩</strong>해야함</p>
<ul>
<li><strong><code>async def</code> (태깅):</strong>
<ul>
<li>함수를 일반 함수가 아닌 <strong>‘코루틴(Coroutine)’</strong> 객체로 선언</li>
<li>“이 함수는 내부에 I/O 대기(<code>await</code>)가 있을 수 있으니, 비동기적으로 관리되어야 합니다”라는 <strong>태그</strong>를 붙이는 행위</li>
</ul></li>
<li><strong><code>await</code> (마킹):</strong>
<ul>
<li>코루틴 내부에서 <strong>실제로 느린 I/O 작업</strong>이 발생하는 지점을 <strong>마킹</strong></li>
<li>즉, <code>await</code>은 프로그래머가 CPU에게 보내는 신호</li>
</ul></li>
</ul>
<blockquote class="blockquote">
<p><strong>“이 명령어(<code>await</code>)는 외부 I/O 작업이라 오래 걸릴 거야. 그러니 이 작업은 OS 커널 같은 다른 주체에게 맡기고, 너(CPU)는 멈춰서 기다리지 말고 다른 일 하러 가.”</strong></p>
</blockquote>
</section>
<section id="교통-정리의-핵심-이벤트-루프-event-loop" class="level4" data-number="2.4.2">
<h4 data-number="2.4.2" class="anchored" data-anchor-id="교통-정리의-핵심-이벤트-루프-event-loop"><span class="header-section-number">2.4.2</span> 교통 정리의 핵심: 이벤트 루프 (Event Loop)</h4>
<ul>
<li><code>await</code>을 만난 CPU는 <code>await</code> 명령문의 연산 제어권을 포기하고 이 제어권은 <strong>이벤트 루프</strong>로 이동.</li>
<li>즉, 이벤트 루프는 <strong>“비동기 이벤트의 교통 정리 관제탑”</strong></li>
<li><strong>역할:</strong>
<ul>
<li>이벤트 루프는 <strong>단일 스레드</strong> 내에서 수많은 코루틴(Task)들의 상태를 관리</li>
<li>CPU가 놀지 않도록 다음에 실행할 작업을 <strong>스케줄링</strong></li>
</ul></li>
<li><strong>작동 방식 (교통 정리):</strong>
<ol type="1">
<li>CPU가 <strong>Task A</strong>를 실행하다가 <code>await</code> (I/O 작업 1)을 만난다.</li>
<li>CPU는 I/O 작업 1을 OS 커널에 위임하고 <strong>제어권을 이벤트 루프에게 반납</strong>.</li>
<li>이벤트 루프는 CPU가 비었으니, 대기 중인 <strong>Task B</strong>를 CPU에게 넘긴다.</li>
<li>CPU가 Task B를 실행하다가 <code>await</code> (I/O 작업 2)을 만난다.</li>
<li>CPU는 I/O 작업 2를 위임하고 <strong>제어권을 다시 반납</strong>한다.</li>
<li>이벤트 루프는 CPU가 비었지만, 만약 다른 Task가 없다면 대기</li>
<li>이때, OS 커널로부터 “I/O 작업 1이 완료되었습니다!”라는 <strong>알림(콜백)</strong>이 도착</li>
<li>이벤트 루프는 이 알림을 받고, “Task A의 다음 작업을 실행할 차례”라고 판단하여 <strong>Task A</strong>를 다시 CPU에게 넘긴다.</li>
<li>CPU는 Task A의 <code>await</code> 다음 줄부터 연산을 재개</li>
</ol></li>
</ul>
<p>이 모든 과정이 <strong>큐(Queue)</strong>와 <strong>콜백(Callback)</strong>이라는 알고리즘을 기반으로 순서가 뒤죽박죽되지 않고 안정적으로 처리</p>
</section>
<section id="예시" class="level4" data-number="2.4.3">
<h4 data-number="2.4.3" class="anchored" data-anchor-id="예시"><span class="header-section-number">2.4.3</span> 예시</h4>
<p>이 예시는 <strong>단일 스레드</strong> 내에서 여러 개의 코루틴(메서드)이 어떻게 CPU와 I/O 작업을 <strong>협력적으로</strong> 처리하며 전체 시간을 단축하는지를 보여줌</p>
</section>
</section>
</section>
<section id="복합-비동기-시나리오-예시-orderprocessor" class="level2" data-number="3">
<h2 data-number="3" class="anchored" data-anchor-id="복합-비동기-시나리오-예시-orderprocessor"><span class="header-section-number">3</span> 복합 비동기 시나리오 예시: <code>OrderProcessor</code></h2>
<ul>
<li>온라인 쇼핑몰의 주문을 처리하는 <code>OrderProcessor</code> 클래스를 가정</li>
<li>주문 처리 과정은 여러 단계를 거치며, 각 단계에는 CPU 연산과 I/O 대기(DB 조회, 결제)가 혼합되어 있다.</li>
</ul>
<div class="sourceCode" id="cb1" style="background: #f1f3f5;"><pre class="sourceCode numberSource python number-lines code-with-copy"><code class="sourceCode python"><span id="cb1-1"><span class="im" style="color: #00769E;
background-color: null;
font-style: inherit;">import</span> asyncio</span>
<span id="cb1-2"><span class="im" style="color: #00769E;
background-color: null;
font-style: inherit;">import</span> time</span>
<span id="cb1-3"></span>
<span id="cb1-4"><span class="kw" style="color: #003B4F;
background-color: null;
font-style: inherit;">class</span> OrderProcessor:</span>
<span id="cb1-5">    <span class="kw" style="color: #003B4F;
background-color: null;
font-style: inherit;">def</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">__init__</span>(<span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">self</span>, order_id):</span>
<span id="cb1-6">        <span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">self</span>.order_id <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> order_id</span>
<span id="cb1-7">        <span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">self</span>.data <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> {}</span>
<span id="cb1-8">        <span class="bu" style="color: null;
background-color: null;
font-style: inherit;">print</span>(<span class="ss" style="color: #20794D;
background-color: null;
font-style: inherit;">f"[</span><span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">{</span>order_id<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">}</span><span class="ss" style="color: #20794D;
background-color: null;
font-style: inherit;">] 주문 프로세서 초기화 시작."</span>) <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># &lt;--- CPU 작업</span></span>
<span id="cb1-9"></span>
<span id="cb1-10">    <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># 1. 코루틴: 사용자 정보를 비동기적으로 조회</span></span>
<span id="cb1-11">    <span class="cf" style="color: #003B4F;
background-color: null;
font-style: inherit;">async</span> <span class="kw" style="color: #003B4F;
background-color: null;
font-style: inherit;">def</span> fetch_user_info(<span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">self</span>):</span>
<span id="cb1-12">        <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># [CPU 작업] 현재 시각 기록 및 로그 메시지 출력</span></span>
<span id="cb1-13">        start <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> time.time()</span>
<span id="cb1-14">        <span class="bu" style="color: null;
background-color: null;
font-style: inherit;">print</span>(<span class="ss" style="color: #20794D;
background-color: null;
font-style: inherit;">f"[</span><span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">{</span><span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">self</span><span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">.</span>order_id<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">}</span><span class="ss" style="color: #20794D;
background-color: null;
font-style: inherit;">] 1. 사용자 정보 조회 요청..."</span>)</span>
<span id="cb1-15"></span>
<span id="cb1-16">        <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># [I/O 위임 (await)] 1초간 네트워크 대기 시뮬레이션</span></span>
<span id="cb1-17">        <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># &lt;--- 제어권 반납 (이벤트 루프가 다른 Task로 전환)</span></span>
<span id="cb1-18">        <span class="cf" style="color: #003B4F;
background-color: null;
font-style: inherit;">await</span> asyncio.sleep(<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span>) </span>
<span id="cb1-19">        </span>
<span id="cb1-20">        <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># [CPU 작업] I/O 완료 후 데이터 처리</span></span>
<span id="cb1-21">        user_info <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> <span class="ss" style="color: #20794D;
background-color: null;
font-style: inherit;">f"User-</span><span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">{</span><span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">self</span><span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">.</span>order_id<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">}</span><span class="ss" style="color: #20794D;
background-color: null;
font-style: inherit;">-Data"</span></span>
<span id="cb1-22">        <span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">self</span>.data[<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">'user'</span>] <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> user_info</span>
<span id="cb1-23">        <span class="bu" style="color: null;
background-color: null;
font-style: inherit;">print</span>(<span class="ss" style="color: #20794D;
background-color: null;
font-style: inherit;">f"[</span><span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">{</span><span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">self</span><span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">.</span>order_id<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">}</span><span class="ss" style="color: #20794D;
background-color: null;
font-style: inherit;">] 1. 사용자 정보 조회 완료. (</span><span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">{</span>time<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">.</span>time() <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">-</span> start<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">:.2f}</span><span class="ss" style="color: #20794D;
background-color: null;
font-style: inherit;">초 소요)"</span>)</span>
<span id="cb1-24">        <span class="cf" style="color: #003B4F;
background-color: null;
font-style: inherit;">return</span> user_info</span>
<span id="cb1-25"></span>
<span id="cb1-26">    <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># 2. 코루틴: 재고 확인 (CPU 집약적인 로직 가정)</span></span>
<span id="cb1-27">    <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># 일반 CPU 연산이므로 await을 사용하지 않아야 하지만, 시간이 너무 길면 블로킹 위험.</span></span>
<span id="cb1-28">    <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># 여기서는 비동기 흐름을 깨지 않는 짧은 CPU 연산으로 가정.</span></span>
<span id="cb1-29">    <span class="cf" style="color: #003B4F;
background-color: null;
font-style: inherit;">async</span> <span class="kw" style="color: #003B4F;
background-color: null;
font-style: inherit;">def</span> check_inventory(<span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">self</span>):</span>
<span id="cb1-30">        <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># [CPU 작업] 시작 시간 기록</span></span>
<span id="cb1-31">        start <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> time.time()</span>
<span id="cb1-32">        <span class="bu" style="color: null;
background-color: null;
font-style: inherit;">print</span>(<span class="ss" style="color: #20794D;
background-color: null;
font-style: inherit;">f"[</span><span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">{</span><span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">self</span><span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">.</span>order_id<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">}</span><span class="ss" style="color: #20794D;
background-color: null;
font-style: inherit;">] 2. 재고 복잡 연산 시작..."</span>)</span>
<span id="cb1-33"></span>
<span id="cb1-34">        <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># [CPU 작업] 복잡한 재고 연산을 시뮬레이션 (블로킹이 없다고 가정)</span></span>
<span id="cb1-35">        inventory_status <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Available"</span></span>
<span id="cb1-36">        </span>
<span id="cb1-37">        <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># [CPU 작업] 결과 저장 및 출력</span></span>
<span id="cb1-38">        <span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">self</span>.data[<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">'inventory'</span>] <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> inventory_status</span>
<span id="cb1-39">        <span class="bu" style="color: null;
background-color: null;
font-style: inherit;">print</span>(<span class="ss" style="color: #20794D;
background-color: null;
font-style: inherit;">f"[</span><span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">{</span><span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">self</span><span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">.</span>order_id<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">}</span><span class="ss" style="color: #20794D;
background-color: null;
font-style: inherit;">] 2. 재고 연산 완료. (</span><span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">{</span>time<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">.</span>time() <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">-</span> start<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">:.2f}</span><span class="ss" style="color: #20794D;
background-color: null;
font-style: inherit;">초 소요)"</span>)</span>
<span id="cb1-40">        <span class="cf" style="color: #003B4F;
background-color: null;
font-style: inherit;">return</span> inventory_status</span>
<span id="cb1-41"></span>
<span id="cb1-42">    <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># 3. 코루틴: 결제 요청 (가장 오래 걸리는 I/O)</span></span>
<span id="cb1-43">    <span class="cf" style="color: #003B4F;
background-color: null;
font-style: inherit;">async</span> <span class="kw" style="color: #003B4F;
background-color: null;
font-style: inherit;">def</span> process_payment(<span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">self</span>):</span>
<span id="cb1-44">        <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># [CPU 작업] 시작 시간 기록</span></span>
<span id="cb1-45">        start <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> time.time()</span>
<span id="cb1-46">        <span class="bu" style="color: null;
background-color: null;
font-style: inherit;">print</span>(<span class="ss" style="color: #20794D;
background-color: null;
font-style: inherit;">f"[</span><span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">{</span><span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">self</span><span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">.</span>order_id<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">}</span><span class="ss" style="color: #20794D;
background-color: null;
font-style: inherit;">] 3. 결제 요청 시작..."</span>)</span>
<span id="cb1-47"></span>
<span id="cb1-48">        <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># [I/O 위임 (await)] 4초간 외부 결제 API 대기 시뮬레이션</span></span>
<span id="cb1-49">        <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># &lt;--- 제어권 반납 (이벤트 루프가 다른 Task로 전환)</span></span>
<span id="cb1-50">        <span class="cf" style="color: #003B4F;
background-color: null;
font-style: inherit;">await</span> asyncio.sleep(<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">4</span>) </span>
<span id="cb1-51">        </span>
<span id="cb1-52">        <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># [CPU 작업] I/O 완료 후 결과 처리</span></span>
<span id="cb1-53">        payment_result <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Success"</span></span>
<span id="cb1-54">        <span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">self</span>.data[<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">'payment'</span>] <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> payment_result</span>
<span id="cb1-55">        <span class="bu" style="color: null;
background-color: null;
font-style: inherit;">print</span>(<span class="ss" style="color: #20794D;
background-color: null;
font-style: inherit;">f"[</span><span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">{</span><span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">self</span><span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">.</span>order_id<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">}</span><span class="ss" style="color: #20794D;
background-color: null;
font-style: inherit;">] 3. 결제 완료. (</span><span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">{</span>time<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">.</span>time() <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">-</span> start<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">:.2f}</span><span class="ss" style="color: #20794D;
background-color: null;
font-style: inherit;">초 소요)"</span>)</span>
<span id="cb1-56">        <span class="cf" style="color: #003B4F;
background-color: null;
font-style: inherit;">return</span> payment_result</span>
<span id="cb1-57">    </span>
<span id="cb1-58">    <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># 4. 코루틴: 모든 단계를 비동기적으로 실행하고 결과를 취합</span></span>
<span id="cb1-59">    <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># 이 메서드 자체가 여러 코루틴을 묶는 상위 코루틴입니다.</span></span>
<span id="cb1-60">    <span class="cf" style="color: #003B4F;
background-color: null;
font-style: inherit;">async</span> <span class="kw" style="color: #003B4F;
background-color: null;
font-style: inherit;">def</span> run_full_process(<span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">self</span>):</span>
<span id="cb1-61">        <span class="bu" style="color: null;
background-color: null;
font-style: inherit;">print</span>(<span class="ss" style="color: #20794D;
background-color: null;
font-style: inherit;">f"[</span><span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">{</span><span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">self</span><span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">.</span>order_id<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">}</span><span class="ss" style="color: #20794D;
background-color: null;
font-style: inherit;">] &gt;&gt;&gt; 전체 주문 처리 파이프라인 시작 &lt;&lt;&lt;"</span>)</span>
<span id="cb1-62"></span>
<span id="cb1-63">        <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># 4-1. [CPU/I/O] 사용자 정보 조회</span></span>
<span id="cb1-64">        user_info <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> <span class="cf" style="color: #003B4F;
background-color: null;
font-style: inherit;">await</span> <span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">self</span>.fetch_user_info() </span>
<span id="cb1-65">        </span>
<span id="cb1-66">        <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># 4-2. [CPU] 재고 확인</span></span>
<span id="cb1-67">        inventory <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> <span class="cf" style="color: #003B4F;
background-color: null;
font-style: inherit;">await</span> <span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">self</span>.check_inventory()</span>
<span id="cb1-68">        </span>
<span id="cb1-69">        <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># 4-3. [CPU/I/O] 결제 처리</span></span>
<span id="cb1-70">        payment <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> <span class="cf" style="color: #003B4F;
background-color: null;
font-style: inherit;">await</span> <span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">self</span>.process_payment()</span>
<span id="cb1-71">        </span>
<span id="cb1-72">        <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># 4-4. [CPU] 최종 결과 조합 및 출력</span></span>
<span id="cb1-73">        final_status <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> <span class="ss" style="color: #20794D;
background-color: null;
font-style: inherit;">f"Order </span><span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">{</span><span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">self</span><span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">.</span>order_id<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">}</span><span class="ss" style="color: #20794D;
background-color: null;
font-style: inherit;">: </span><span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">{</span>user_info<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">}</span><span class="ss" style="color: #20794D;
background-color: null;
font-style: inherit;">, </span><span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">{</span>inventory<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">}</span><span class="ss" style="color: #20794D;
background-color: null;
font-style: inherit;">, </span><span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">{</span>payment<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">}</span><span class="ss" style="color: #20794D;
background-color: null;
font-style: inherit;">"</span></span>
<span id="cb1-74">        <span class="bu" style="color: null;
background-color: null;
font-style: inherit;">print</span>(<span class="ss" style="color: #20794D;
background-color: null;
font-style: inherit;">f"[</span><span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">{</span><span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">self</span><span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">.</span>order_id<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">}</span><span class="ss" style="color: #20794D;
background-color: null;
font-style: inherit;">] &gt;&gt;&gt; 최종 결과: </span><span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">{</span>final_status<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">}</span><span class="ss" style="color: #20794D;
background-color: null;
font-style: inherit;"> &lt;&lt;&lt;"</span>)</span>
<span id="cb1-75">        <span class="cf" style="color: #003B4F;
background-color: null;
font-style: inherit;">return</span> final_status</span>
<span id="cb1-76"></span>
<span id="cb1-77"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># -------------------------------------------------------------</span></span>
<span id="cb1-78"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># 메인 실행 로직</span></span>
<span id="cb1-79"><span class="cf" style="color: #003B4F;
background-color: null;
font-style: inherit;">async</span> <span class="kw" style="color: #003B4F;
background-color: null;
font-style: inherit;">def</span> main():</span>
<span id="cb1-80">    start_time <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> time.time()</span>
<span id="cb1-81">    <span class="bu" style="color: null;
background-color: null;
font-style: inherit;">print</span>(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"--- 2개의 주문을 비동기적으로 처리 시작 ---"</span>)</span>
<span id="cb1-82"></span>
<span id="cb1-83">    <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># 두 개의 독립적인 주문 프로세스를 생성 (서로 다른 Task)</span></span>
<span id="cb1-84">    order_a <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> OrderProcessor(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Order-A"</span>)</span>
<span id="cb1-85">    order_b <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> OrderProcessor(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Order-B"</span>)</span>
<span id="cb1-86"></span>
<span id="cb1-87">    <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># 두 개의 run_full_process 코루틴을 Task로 만들고 동시에 실행</span></span>
<span id="cb1-88">    <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># 여기서 비동기 동시성(Concurrency)이 발생합니다.</span></span>
<span id="cb1-89">    task_a <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> asyncio.create_task(order_a.run_full_process())</span>
<span id="cb1-90">    task_b <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> asyncio.create_task(order_b.run_full_process())</span>
<span id="cb1-91"></span>
<span id="cb1-92">    <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># 두 Task가 모두 완료될 때까지 기다림</span></span>
<span id="cb1-93">    <span class="cf" style="color: #003B4F;
background-color: null;
font-style: inherit;">await</span> asyncio.gather(task_a, task_b)</span>
<span id="cb1-94">    </span>
<span id="cb1-95">    end_time <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> time.time()</span>
<span id="cb1-96">    <span class="bu" style="color: null;
background-color: null;
font-style: inherit;">print</span>(<span class="ss" style="color: #20794D;
background-color: null;
font-style: inherit;">f"</span><span class="ch" style="color: #20794D;
background-color: null;
font-style: inherit;">\n</span><span class="ss" style="color: #20794D;
background-color: null;
font-style: inherit;">--- 최종 소요 시간: </span><span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">{</span>end_time <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">-</span> start_time<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">:.2f}</span><span class="ss" style="color: #20794D;
background-color: null;
font-style: inherit;">초 ---"</span>)</span>
<span id="cb1-97"></span>
<span id="cb1-98"><span class="cf" style="color: #003B4F;
background-color: null;
font-style: inherit;">if</span> <span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">__name__</span> <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">==</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"__main__"</span>:</span>
<span id="cb1-99">    <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># 동기적으로 실행했다면: (1+4)초 + (1+4)초 = 약 10초 소요</span></span>
<span id="cb1-100">    <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># 비동기적으로 실행하면: 가장 긴 I/O 시간인 4초에 가까워야 함</span></span>
<span id="cb1-101">    asyncio.run(main())</span></code></pre></div>
<p><strong>연산 처리 순서 및 흐름 설명</strong></p>
<p>총 소요 시간은 <img src="https://latex.codecogs.com/png.latex?4%5Ctext%7B%EC%B4%88%7D%20+%20%5Ctext%7B%EC%95%BD%EA%B0%84%EC%9D%98%20CPU%20%EC%8B%9C%EA%B0%84%7D">에 가깝게 나와야함.</p>
<table class="caption-top table">
<colgroup>
<col style="width: 25%">
<col style="width: 25%">
<col style="width: 25%">
<col style="width: 25%">
</colgroup>
<thead>
<tr class="header">
<th style="text-align: left;">시간대 (대략)</th>
<th style="text-align: left;">CPU(메인 스레드) 역할</th>
<th style="text-align: left;">Order-A (Task A)</th>
<th style="text-align: left;">Order-B (Task B)</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td style="text-align: left;"><strong>0.0초</strong></td>
<td style="text-align: left;"><strong>Task A 시작</strong></td>
<td style="text-align: left;"><code>run_full_process</code> 실행</td>
<td style="text-align: left;">대기</td>
</tr>
<tr class="even">
<td style="text-align: left;"><strong>0.0초</strong></td>
<td style="text-align: left;"><strong>Task B 시작</strong></td>
<td style="text-align: left;"><code>fetch_user_info</code> 실행 (CPU)</td>
<td style="text-align: left;">대기</td>
</tr>
<tr class="odd">
<td style="text-align: left;"><strong>0.0초</strong></td>
<td style="text-align: left;"><strong>제어권 반납</strong></td>
<td style="text-align: left;"><strong>await 1초 대기 (I/O 위임)</strong></td>
<td style="text-align: left;">대기</td>
</tr>
<tr class="even">
<td style="text-align: left;"><strong>0.0초</strong></td>
<td style="text-align: left;"><strong>Task B 전환</strong></td>
<td style="text-align: left;">대기 (I/O 진행 중)</td>
<td style="text-align: left;"><code>run_full_process</code> 실행</td>
</tr>
<tr class="odd">
<td style="text-align: left;"><strong>0.0초</strong></td>
<td style="text-align: left;"><strong>제어권 반납</strong></td>
<td style="text-align: left;">대기 (I/O 진행 중)</td>
<td style="text-align: left;"><strong>await 1초 대기 (I/O 위임)</strong></td>
</tr>
<tr class="even">
<td style="text-align: left;"><strong>0.0초</strong></td>
<td style="text-align: left;"><strong>이벤트 루프 유휴</strong></td>
<td style="text-align: left;">I/O 진행 중</td>
<td style="text-align: left;">I/O 진행 중</td>
</tr>
<tr class="odd">
<td style="text-align: left;"><strong>1.0초</strong></td>
<td style="text-align: left;"><strong>Task A 재개</strong></td>
<td style="text-align: left;">I/O 완료, 재고 연산 (CPU)</td>
<td style="text-align: left;">대기</td>
</tr>
<tr class="even">
<td style="text-align: left;"><strong>1.0초</strong></td>
<td style="text-align: left;"><strong>제어권 반납</strong></td>
<td style="text-align: left;"><code>process_payment</code> 실행 (CPU)</td>
<td style="text-align: left;">I/O 완료, 재고 연산 (CPU)</td>
</tr>
<tr class="odd">
<td style="text-align: left;"><strong>1.0초</strong></td>
<td style="text-align: left;"><strong>Task B 재개</strong></td>
<td style="text-align: left;">대기</td>
<td style="text-align: left;"><code>process_payment</code> 실행 (CPU)</td>
</tr>
<tr class="even">
<td style="text-align: left;"><strong>1.0초</strong></td>
<td style="text-align: left;"><strong>제어권 반납</strong></td>
<td style="text-align: left;"><strong>await 4초 대기 (I/O 위임)</strong></td>
<td style="text-align: left;"><strong>await 4초 대기 (I/O 위임)</strong></td>
</tr>
<tr class="odd">
<td style="text-align: left;"><strong>1.0 ~ 5.0초</strong></td>
<td style="text-align: left;"><strong>I/O 진행 중</strong></td>
<td style="text-align: left;">결제 I/O 진행 중</td>
<td style="text-align: left;">결제 I/O 진행 중</td>
</tr>
<tr class="even">
<td style="text-align: left;"><strong>5.0초</strong></td>
<td style="text-align: left;"><strong>Task A 재개</strong></td>
<td style="text-align: left;">결제 완료, 최종 출력 (CPU)</td>
<td style="text-align: left;">대기</td>
</tr>
<tr class="odd">
<td style="text-align: left;"><strong>5.0초</strong></td>
<td style="text-align: left;"><strong>Task B 재개</strong></td>
<td style="text-align: left;">완료</td>
<td style="text-align: left;">결제 완료, 최종 출력 (CPU)</td>
</tr>
<tr class="even">
<td style="text-align: left;"><strong>5.0초</strong></td>
<td style="text-align: left;"><strong>모든 Task 완료</strong></td>
<td style="text-align: left;">완료</td>
<td style="text-align: left;">완료</td>
</tr>
</tbody>
</table>
<p><strong>결론: 동시성 달성</strong></p>
<ul>
<li>CPU는 <strong>Order-A의 1초 I/O 대기 시간</strong>이 발생했을 때 <strong>Order-B의 1초 I/O 요청</strong>을 처리하는 데 활용</li>
<li><strong>Order-A와 Order-B의 4초 결제 대기 시간</strong> 동안 CPU는 <strong>아무 작업도 하지 않고 대기</strong>하는 대신, <strong>두 결제 요청을 동시에 진행</strong></li>
<li>결과적으로 두 주문의 총 I/O 대기 시간(4초)에 가까운 시간 안에 모든 작업이 완료되어 <strong>효율적인 동시 처리</strong>가 이루어진다.</li>
</ul>
<section id="무엇을-조심해야-하는가-cpu-연산의-함정" class="level3" data-number="3.1">
<h3 data-number="3.1" class="anchored" data-anchor-id="무엇을-조심해야-하는가-cpu-연산의-함정"><span class="header-section-number">3.1</span> ‘무엇을’ 조심해야 하는가? (CPU 연산의 함정)</h3>
<ul>
<li>이 논리대로라면, 프로그래머가 <code>async def</code>와 <code>await</code>을 잘 설계하는 것이 핵심</li>
<li>프로그래머는 모든 명령문에 대해서 CPU작업과 I/O작업을 구분짓기 힘들 수 있음</li>
</ul>
<section id="코루틴의-구성-cpu-작업과-io-작업의-혼재" class="level4" data-number="3.1.1">
<h4 data-number="3.1.1" class="anchored" data-anchor-id="코루틴의-구성-cpu-작업과-io-작업의-혼재"><span class="header-section-number">3.1.1</span> 코루틴의 구성: CPU 작업과 I/O 작업의 혼재</h4>
<p>우리는 코루틴 내부가 <strong>“CPU가 할 일과 OS(I/O)가 할 일이 섞여 있을 수밖에 없다”</strong>는 것을 확인</p>
<ul>
<li><strong>CPU가 할 일 (Await이 없는 코드):</strong> 변수 할당, 간단한 연산, 로그 찍기.</li>
<li><strong>OS가 할 일 (Await이 있는 코드):</strong> <code>await asyncio.sleep(1)</code>, <code>await client.get(url)</code>.</li>
</ul>
<p>비동기 함수는 이 두 가지가 번갈아 나타나는 <strong>“얇은 껍질(Thin Wrapper)”</strong>처럼 설계되어, CPU가 간단한 연산을 빠르게 처리하고 즉시 <code>await</code>에서 제어권을 반납하도록 유도해야 바람직하다.</p>
</section>
<section id="치명적인-실수-cpu-집약적-작업에-await을-붙인다면" class="level4" data-number="3.1.2">
<h4 data-number="3.1.2" class="anchored" data-anchor-id="치명적인-실수-cpu-집약적-작업에-await을-붙인다면"><span class="header-section-number">3.1.2</span> 치명적인 실수: CPU 집약적 작업에 <code>await</code>을 붙인다면?</h4>
<p>만약 머신러닝의 ‘가중치 최적화’ 같은 <strong>무거운 CPU 연산</strong>에 <code>await</code>을 붙이면 어떻게 될까?</p>
<ul>
<li><strong>잘못된 가정:</strong> <code>await</code>을 붙였으니 CPU가 이 작업을 I/O처럼 다른 곳에 위임하고 다른 일을 할 것이다.</li>
<li><strong>현실:</strong>
<ul>
<li>CPU 연산은 OS 커널에 <strong>위임할 수 없다.</strong></li>
<li>CPU 자신이 <strong>직접</strong> 처리해야 하는 일이다.</li>
<li>즉, CPU 연산에 <code>await</code>을 마킹해도 CPU연산이 일어남</li>
<li>즉, <code>await</code>을 붙이더라도, CPU는 “이건 내가 해야 하는 계산이네”라고 판단하고, 그 <strong>계산이 끝날 때까지 제어권을 이벤트 루프에게 반납하지 않는다.</strong></li>
</ul></li>
</ul>
<blockquote class="blockquote">
<p><strong>결과: 이벤트 루프가 멈춘다 (Blocking).</strong></p>
</blockquote>
<ul>
<li>CPU가 무거운 계산을 하는 동안 이벤트 루프는 스케줄링을 할 수 없게 되고,</li>
<li>다른 모든 비동기 작업(네트워크 요청, 다른 사용자의 응답)이 <strong>완전히 정지</strong></li>
<li>이는 <code>async</code>를 쓰지 않고 동기 코드를 실행한 것과 똑같거나 오히려 더 나쁜 결과를 초래</li>
</ul>
</section>
<section id="최종-결론-올바른-비동기-설계" class="level4" data-number="3.1.3">
<h4 data-number="3.1.3" class="anchored" data-anchor-id="최종-결론-올바른-비동기-설계"><span class="header-section-number">3.1.3</span> 최종 결론: 올바른 비동기 설계</h4>
<ul>
<li>비동기 프로그램은 <strong>I/O 대기 시간</strong>이 긴 작업(네트워크, DB)에 압도적으로 유리</li>
<li>비동기 코루틴(<code>async def</code>) 안에는 <strong>무거운 CPU 연산</strong>을 절대로 배치해서는 안 된다.</li>
<li>만약 무거운 CPU 연산이 필요하다면, <code>asyncio.to_thread()</code> 등을 사용해 <strong>별도의 스레드(병렬 처리)</strong>로 분리하여 이벤트 루프를 막지 않도록 설계해야 한다.</li>
</ul>


</section>
</section>
</section>

 ]]></description>
  <category>Engineering</category>
  <guid>kk3225.netlify.app/docs/blog/posts/Engineering/Python/async.html</guid>
  <pubDate>Wed, 29 Oct 2025 15:00:00 GMT</pubDate>
</item>
<item>
  <title>Programmers Code Problem: Phone Number List</title>
  <dc:creator>Kwangmin Kim</dc:creator>
  <link>kk3225.netlify.app/docs/blog/posts/Code_Test/algorithm/hash_level2_phone_number.html</link>
  <description><![CDATA[ 





<section id="문제-정보" class="level1" data-number="1">
<h1 data-number="1"><span class="header-section-number">1</span> 문제 정보</h1>
<ul>
<li>제목: 전화번호 목록</li>
<li>링크: https://school.programmers.co.kr/learn/courses/30/lessons/42577</li>
<li><strong>난이도</strong>: 2</li>
<li><strong>유형</strong>: Hash</li>
<li>풀이 시간: 10분</li>
</ul>
</section>
<section id="문제-설명" class="level1" data-number="2">
<h1 data-number="2"><span class="header-section-number">2</span> 문제 설명</h1>
<p>전화번호부에 적힌 전화번호 중, 한 번호가 다른 번호의 접두어인 경우가 있는지 확인하려 합니다. 전화번호가 다음과 같을 경우, 구조대 전화번호는 영석이의 전화번호의 접두사입니다.</p>
<ul>
<li>구조대 : 119</li>
<li>박준영 : 97 674 223</li>
<li>지영석 : 11 9552 4421</li>
</ul>
<p>전화번호부에 적힌 전화번호를 담은 배열 phone_book 이 solution 함수의 매개변수로 주어질 때, 어떤 번호가 다른 번호의 접두어인 경우가 있으면 false를, 그렇지 않으면 true를 return 하도록 solution 함수를 작성해주세요.</p>
<section id="제한-사항" class="level2" data-number="2.1">
<h2 data-number="2.1" class="anchored" data-anchor-id="제한-사항"><span class="header-section-number">2.1</span> 제한 사항</h2>
<p>phone_book의 길이는 1 이상 1,000,000 이하입니다. 각 전화번호의 길이는 1 이상 20 이하입니다. 같은 전화번호가 중복해서 들어있지 않습니다.</p>
</section>
<section id="입출력-예제" class="level2" data-number="2.2">
<h2 data-number="2.2" class="anchored" data-anchor-id="입출력-예제"><span class="header-section-number">2.2</span> 입출력 예제</h2>
<table class="caption-top table">
<thead>
<tr class="header">
<th>예시</th>
<th>phone_book</th>
<th>return</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td>예시 1</td>
<td>[“119”, “97674223”, “1195524421”]</td>
<td>false</td>
</tr>
<tr class="even">
<td>예시 2</td>
<td>[“123”,“456”,“789”]</td>
<td>true</td>
</tr>
<tr class="odd">
<td>예시 3</td>
<td>[“12”,“123”,“1235”,“567”,“88”]</td>
<td>false</td>
</tr>
</tbody>
</table>
</section>
<section id="입출력-예-설명" class="level2" data-number="2.3">
<h2 data-number="2.3" class="anchored" data-anchor-id="입출력-예-설명"><span class="header-section-number">2.3</span> 입출력 예 설명</h2>
<p>입출력 예 #1 앞에서 설명한 예와 같습니다.</p>
<p>입출력 예 #2 한 번호가 다른 번호의 접두사인 경우가 없으므로, 답은 true입니다.</p>
<p>입출력 예 #3 첫 번째 전화번호, “12”가 두 번째 전화번호 “123”의 접두사입니다. 따라서 답은 false입니다.</p>
</section>
<section id="알림" class="level2" data-number="2.4">
<h2 data-number="2.4" class="anchored" data-anchor-id="알림"><span class="header-section-number">2.4</span> 알림</h2>
<p>2021년 3월 4일, 테스트 케이스가 변경되었습니다. 이로 인해 이전에 통과하던 코드가 더 이상 통과하지 않을 수 있습니다.</p>
</section>
</section>
<section id="문제-해설" class="level1" data-number="3">
<h1 data-number="3"><span class="header-section-number">3</span> 문제 해설</h1>
<section id="문제-핵심-이해" class="level2" data-number="3.1">
<h2 data-number="3.1" class="anchored" data-anchor-id="문제-핵심-이해"><span class="header-section-number">3.1</span> 문제 핵심 이해</h2>
<p>이 문제의 핵심은 <strong>한 전화번호가 다른 전화번호의 접두어인지 확인하는 것</strong></p>
<ul>
<li>입력: 전화번호 목록 배열</li>
<li>출력: 접두어 관계가 있으면 false, 없으면 true</li>
<li>목표: 효율적으로 접두어 관계 탐지</li>
</ul>
</section>
<section id="중요한-조건들" class="level2" data-number="3.2">
<h2 data-number="3.2" class="anchored" data-anchor-id="중요한-조건들"><span class="header-section-number">3.2</span> 중요한 조건들</h2>
<ol type="1">
<li><strong>접두어 정의</strong>: 한 번호가 다른 번호의 시작 부분과 완전히 일치</li>
<li><strong>대용량 데이터</strong>: 최대 1,000,000개의 전화번호 처리 필요</li>
<li><strong>효율성 요구</strong>: O(n²) 방식으로는 시간 초과 발생 가능</li>
</ol>
</section>
<section id="해결-방법별-분석" class="level2" data-number="3.3">
<h2 data-number="3.3" class="anchored" data-anchor-id="해결-방법별-분석"><span class="header-section-number">3.3</span> 해결 방법별 분석</h2>
<section id="알고리즘-요약" class="level3" data-number="3.3.1">
<h3 data-number="3.3.1" class="anchored" data-anchor-id="알고리즘-요약"><span class="header-section-number">3.3.1</span> 알고리즘 요약</h3>
<section id="핵심-아이디어" class="level4" data-number="3.3.1.1">
<h4 data-number="3.3.1.1" class="anchored" data-anchor-id="핵심-아이디어"><span class="header-section-number">3.3.1.1</span> 핵심 아이디어</h4>
<p><strong>사전순 정렬 후 인접한 번호끼리만 비교</strong>하여 O(n log n) 시간에 모든 접두어 관계를 효율적으로 탐지</p>
</section>
<section id="알고리즘-동작" class="level4" data-number="3.3.1.2">
<h4 data-number="3.3.1.2" class="anchored" data-anchor-id="알고리즘-동작"><span class="header-section-number">3.3.1.2</span> 알고리즘 동작</h4>
<ol type="1">
<li><strong>사전순 정렬</strong>: 전화번호를 문자열 기준으로 정렬</li>
<li><strong>인접 비교</strong>: 정렬된 배열에서 인접한 두 번호만 접두어 관계를 확인</li>
<li><strong>조기 종료</strong>: 접두어 관계를 발견하면 즉시 false를 반환</li>
</ol>
</section>
<section id="왜-효율적인가" class="level4" data-number="3.3.1.3">
<h4 data-number="3.3.1.3" class="anchored" data-anchor-id="왜-효율적인가"><span class="header-section-number">3.3.1.3</span> 왜 효율적인가?</h4>
<p>정렬의 특성상 접두어 관계가 있다면 반드시 인접한 위치에 배치되므로, 모든 쌍을 비교할 필요가 없음</p>
</section>
<section id="핵심-포인트" class="level4" data-number="3.3.1.4">
<h4 data-number="3.3.1.4" class="anchored" data-anchor-id="핵심-포인트"><span class="header-section-number">3.3.1.4</span> 핵심 포인트</h4>
<p><strong>“정렬된 상태에서 접두어는 반드시 인접하다”</strong>는 특성을 활용하여 O(n²) → O(n log n)로 시간복잡도를 획기적으로 개선</p>
</section>
</section>
<section id="정렬-방법-권장" class="level3" data-number="3.3.2">
<h3 data-number="3.3.2" class="anchored" data-anchor-id="정렬-방법-권장"><span class="header-section-number">3.3.2</span> 정렬 방법 (권장)</h3>
<p><strong>시간복잡도</strong>: O(n log n)<br>
<strong>공간복잡도</strong>: O(log n)</p>
<div class="sourceCode" id="cb1" style="background: #f1f3f5;"><pre class="sourceCode numberSource python number-lines code-with-copy"><code class="sourceCode python"><span id="cb1-1"><span class="kw" style="color: #003B4F;
background-color: null;
font-style: inherit;">def</span> solution(phone_book):</span>
<span id="cb1-2">    <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># 사전순 정렬 - O(n log n) 시간, O(log n) 공간(정렬 알고리즘 스택)</span></span>
<span id="cb1-3">    phone_book.sort()</span>
<span id="cb1-4">    </span>
<span id="cb1-5">    <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># 인접한 번호끼리만 접두어 관계 확인 - O(n) 시간, O(1) 공간</span></span>
<span id="cb1-6">    <span class="cf" style="color: #003B4F;
background-color: null;
font-style: inherit;">for</span> i <span class="kw" style="color: #003B4F;
background-color: null;
font-style: inherit;">in</span> <span class="bu" style="color: null;
background-color: null;
font-style: inherit;">range</span>(<span class="bu" style="color: null;
background-color: null;
font-style: inherit;">len</span>(phone_book) <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">-</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span>):  <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># O(n) 반복</span></span>
<span id="cb1-7">        <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># startswith 비교 - O(m) 시간 (m: 짧은 번호의 길이)</span></span>
<span id="cb1-8">        <span class="cf" style="color: #003B4F;
background-color: null;
font-style: inherit;">if</span> phone_book[i<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span>].startswith(phone_book[i]):</span>
<span id="cb1-9">            <span class="cf" style="color: #003B4F;
background-color: null;
font-style: inherit;">return</span> <span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">False</span>  <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># O(1) 시간, O(1) 공간</span></span>
<span id="cb1-10">    </span>
<span id="cb1-11">    <span class="cf" style="color: #003B4F;
background-color: null;
font-style: inherit;">return</span> <span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">True</span>  <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># O(1) 시간, O(1) 공간</span></span>
<span id="cb1-12"></span>
<span id="cb1-13"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># 전체 시간복잡도: O(n log n) + O(n * m) = O(n log n) (m &lt;&lt; log n 일반적)</span></span>
<span id="cb1-14"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># 전체 공간복잡도: O(log n) (정렬 알고리즘의 스택 공간)</span></span></code></pre></div>
<p><strong>동작 원리</strong>: - 사전순 정렬 후 인접한 번호끼리만 비교 - 정렬되어 있으면 접두어 관계는 반드시 인접한 위치에 존재 - 예: [“119”, “1195524421”, “97674223”] 정렬 시 “119”와 “1195524421”이 인접</p>
</section>
<section id="해시셋set-방법" class="level3" data-number="3.3.3">
<h3 data-number="3.3.3" class="anchored" data-anchor-id="해시셋set-방법"><span class="header-section-number">3.3.3</span> 해시셋(Set) 방법</h3>
<p><strong>시간복잡도</strong>: O(n×m²) (n: 번호 개수, m: 평균 번호 길이)<br>
<strong>공간복잡도</strong>: O(n×m)</p>
<div class="sourceCode" id="cb2" style="background: #f1f3f5;"><pre class="sourceCode numberSource python number-lines code-with-copy"><code class="sourceCode python"><span id="cb2-1"><span class="kw" style="color: #003B4F;
background-color: null;
font-style: inherit;">def</span> solution(phone_book):</span>
<span id="cb2-2">    <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># 모든 번호를 해시셋에 저장 - O(n) 시간, O(n * m) 공간</span></span>
<span id="cb2-3">    phone_set <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> <span class="bu" style="color: null;
background-color: null;
font-style: inherit;">set</span>(phone_book)  <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># n개 번호, 각 번호 평균 m자리</span></span>
<span id="cb2-4">    </span>
<span id="cb2-5">    <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># 각 번호의 모든 접두어가 해시셋에 있는지 확인 - O(n * m) 시간</span></span>
<span id="cb2-6">    <span class="cf" style="color: #003B4F;
background-color: null;
font-style: inherit;">for</span> phone <span class="kw" style="color: #003B4F;
background-color: null;
font-style: inherit;">in</span> phone_book:  <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># O(n) 반복</span></span>
<span id="cb2-7">        <span class="cf" style="color: #003B4F;
background-color: null;
font-style: inherit;">for</span> i <span class="kw" style="color: #003B4F;
background-color: null;
font-style: inherit;">in</span> <span class="bu" style="color: null;
background-color: null;
font-style: inherit;">range</span>(<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span>, <span class="bu" style="color: null;
background-color: null;
font-style: inherit;">len</span>(phone)):  <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># O(m) 반복 (m: 전화번호 길이)</span></span>
<span id="cb2-8">            <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># 슬라이싱 O(i), 해시셋 검색 O(1) 평균 → O(m) 최대</span></span>
<span id="cb2-9">            <span class="cf" style="color: #003B4F;
background-color: null;
font-style: inherit;">if</span> phone[:i] <span class="kw" style="color: #003B4F;
background-color: null;
font-style: inherit;">in</span> phone_set:</span>
<span id="cb2-10">                <span class="cf" style="color: #003B4F;
background-color: null;
font-style: inherit;">return</span> <span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">False</span>  <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># O(1) 시간, O(1) 공간</span></span>
<span id="cb2-11">    </span>
<span id="cb2-12">    <span class="cf" style="color: #003B4F;
background-color: null;
font-style: inherit;">return</span> <span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">True</span>  <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># O(1) 시간, O(1) 공간</span></span>
<span id="cb2-13"></span>
<span id="cb2-14"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># 전체 시간복잡도: O(n) + O(n * m^2) = O(n * m^2)</span></span>
<span id="cb2-15"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># 전체 공간복잡도: O(n * m) (해시셋 저장)</span></span></code></pre></div>
<p><strong>동작 원리</strong>: - 모든 전화번호를 해시셋에 저장 - 각 번호의 모든 가능한 접두어를 생성하여 해시셋에서 검색</p>
</section>
<section id="한-줄-해답-정렬-any-함수" class="level3" data-number="3.3.4">
<h3 data-number="3.3.4" class="anchored" data-anchor-id="한-줄-해답-정렬-any-함수"><span class="header-section-number">3.3.4</span> 한 줄 해답 (정렬 + any 함수)</h3>
<div class="sourceCode" id="cb3" style="background: #f1f3f5;"><pre class="sourceCode numberSource python number-lines code-with-copy"><code class="sourceCode python"><span id="cb3-1"><span class="kw" style="color: #003B4F;
background-color: null;
font-style: inherit;">def</span> solution(phone_book):</span>
<span id="cb3-2">    <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># 사전순 정렬 - O(n log n) 시간, O(log n) 공간</span></span>
<span id="cb3-3">    phone_book.sort()</span>
<span id="cb3-4">    </span>
<span id="cb3-5">    <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># any() 함수로 접두어 관계 확인 - O(n * m) 시간, O(1) 공간</span></span>
<span id="cb3-6">    <span class="cf" style="color: #003B4F;
background-color: null;
font-style: inherit;">return</span> <span class="kw" style="color: #003B4F;
background-color: null;
font-style: inherit;">not</span> <span class="bu" style="color: null;
background-color: null;
font-style: inherit;">any</span>(  <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># any(): 최악의 경우 O(n) 반복</span></span>
<span id="cb3-7">        phone_book[i<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span>].startswith(phone_book[i])  <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># startswith: O(m) 시간</span></span>
<span id="cb3-8">        <span class="cf" style="color: #003B4F;
background-color: null;
font-style: inherit;">for</span> i <span class="kw" style="color: #003B4F;
background-color: null;
font-style: inherit;">in</span> <span class="bu" style="color: null;
background-color: null;
font-style: inherit;">range</span>(<span class="bu" style="color: null;
background-color: null;
font-style: inherit;">len</span>(phone_book) <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">-</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span>)  <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># 제너레이터: O(1) 공간</span></span>
<span id="cb3-9">    )</span>
<span id="cb3-10"></span>
<span id="cb3-11"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># 전체 시간복잡도: O(n log n) + O(n * m) = O(n log n) (m &lt;&lt; log n 일반적)</span></span>
<span id="cb3-12"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># 전체 공간복잡도: O(log n) (정렬 알고리즘 스택) + O(1) (제너레이터) = O(log n)</span></span></code></pre></div>
</section>
</section>
<section id="복잡도-비교표" class="level2" data-number="3.4">
<h2 data-number="3.4" class="anchored" data-anchor-id="복잡도-비교표"><span class="header-section-number">3.4</span> 복잡도 비교표</h2>
<table class="caption-top table">
<thead>
<tr class="header">
<th>방법</th>
<th>시간복잡도</th>
<th>공간복잡도</th>
<th>특징</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td>정렬</td>
<td>O(n log n)</td>
<td>O(log n)</td>
<td><strong>가장 효율적, 메모리 절약</strong></td>
</tr>
<tr class="even">
<td>해시셋</td>
<td>O(n×m²)</td>
<td>O(n×m)</td>
<td>구현이 직관적</td>
</tr>
<tr class="odd">
<td>한 줄 해답</td>
<td>O(n log n)</td>
<td>O(log n)</td>
<td>코드가 간결</td>
</tr>
</tbody>
</table>
</section>
<section id="왜-정렬-방법이-최적인가" class="level2" data-number="3.5">
<h2 data-number="3.5" class="anchored" data-anchor-id="왜-정렬-방법이-최적인가"><span class="header-section-number">3.5</span> 왜 정렬 방법이 최적인가?</h2>
<ol type="1">
<li><strong>핵심 아이디어</strong>: 사전순 정렬 시 접두어 관계는 반드시 인접한 위치에 존재</li>
<li><strong>시간 효율성</strong>: O(n log n) - 정렬 후 한 번의 순회만 필요</li>
<li><strong>공간 효율성</strong>: O(log n) - 정렬 알고리즘의 스택 공간만 사용</li>
<li><strong>단순함</strong>: 구현이 직관적이고 이해하기 쉬움</li>
</ol>
</section>
<section id="핵심-포인트-1" class="level2" data-number="3.6">
<h2 data-number="3.6" class="anchored" data-anchor-id="핵심-포인트-1"><span class="header-section-number">3.6</span> 핵심 포인트</h2>
<ul>
<li><strong>정렬의 활용</strong>: 사전순 정렬로 비교 대상을 대폭 축소</li>
<li><strong>접두어 특성</strong>: A가 B의 접두어라면, 정렬 후 A는 B보다 앞에 위치</li>
<li><strong>최적화</strong>: 모든 쌍 비교(O(n²)) → 인접 비교(O(n))</li>
</ul>
<p>이 문제의 핵심은 <strong>“정렬을 통한 비교 대상 축소로 효율성을 극대화하는 것”</strong>입니다.</p>
</section>
<section id="예제별-동작-과정" class="level2" data-number="3.7">
<h2 data-number="3.7" class="anchored" data-anchor-id="예제별-동작-과정"><span class="header-section-number">3.7</span> 예제별 동작 과정</h2>
<section id="예제-1-119-97674223-1195524421-결과-false" class="level3" data-number="3.7.1">
<h3 data-number="3.7.1" class="anchored" data-anchor-id="예제-1-119-97674223-1195524421-결과-false"><span class="header-section-number">3.7.1</span> 예제 1: <code>["119", "97674223", "1195524421"]</code> → 결과: false</h3>
<p><strong>정렬 방법</strong>: 1. 사전순 정렬: <code>["119", "1195524421", "97674223"]</code> 2. 인접 비교: - “119”와 “1195524421”: <code>"1195524421".startswith("119")</code> → True - 접두어 관계 발견! → <strong>답: false</strong></p>
</section>
<section id="예제-2-123-456-789-결과-true" class="level3" data-number="3.7.2">
<h3 data-number="3.7.2" class="anchored" data-anchor-id="예제-2-123-456-789-결과-true"><span class="header-section-number">3.7.2</span> 예제 2: <code>["123", "456", "789"]</code> → 결과: true</h3>
<p><strong>정렬 방법</strong>: 1. 사전순 정렬: <code>["123", "456", "789"]</code> (이미 정렬됨) 2. 인접 비교: - “123”과 “456”: <code>"456".startswith("123")</code> → False - “456”과 “789”: <code>"789".startswith("456")</code> → False - 접두어 관계 없음 → <strong>답: true</strong></p>
</section>
<section id="예제-3-12-123-1235-567-88-결과-false" class="level3" data-number="3.7.3">
<h3 data-number="3.7.3" class="anchored" data-anchor-id="예제-3-12-123-1235-567-88-결과-false"><span class="header-section-number">3.7.3</span> 예제 3: <code>["12", "123", "1235", "567", "88"]</code> → 결과: false</h3>
<p><strong>정렬 방법</strong>: 1. 사전순 정렬: <code>["12", "123", "1235", "567", "88"]</code> 2. 인접 비교: - “12”와 “123”: <code>"123".startswith("12")</code> → True - 접두어 관계 발견! → <strong>답: false</strong></p>


</section>
</section>
</section>

 ]]></description>
  <category>Code Test</category>
  <category>Algorithm Test</category>
  <guid>kk3225.netlify.app/docs/blog/posts/Code_Test/algorithm/hash_level2_phone_number.html</guid>
  <pubDate>Fri, 12 Sep 2025 15:00:00 GMT</pubDate>
</item>
</channel>
</rss>
