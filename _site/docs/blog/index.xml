<?xml version="1.0" encoding="UTF-8"?>
<rss  xmlns:atom="http://www.w3.org/2005/Atom" 
      xmlns:media="http://search.yahoo.com/mrss/" 
      xmlns:content="http://purl.org/rss/1.0/modules/content/" 
      xmlns:dc="http://purl.org/dc/elements/1.1/" 
      version="2.0">
<channel>
<title>Kwangmin Kim</title>
<link>kk3225.netlify.app/docs/blog/</link>
<atom:link href="kk3225.netlify.app/docs/blog/index.xml" rel="self" type="application/rss+xml"/>
<description>blog</description>
<generator>quarto-1.4.543</generator>
<lastBuildDate>Tue, 31 Dec 2109 15:00:00 GMT</lastBuildDate>
<item>
  <title>Data Governance</title>
  <dc:creator>Kwangmin Kim</dc:creator>
  <link>kk3225.netlify.app/docs/blog/posts/Governance/</link>
  <description><![CDATA[ 





<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="kk3225.netlify.app/images/governance/data_governance.png" class="img-fluid figure-img" style="width:50.0%"></p>
<figcaption>Governance</figcaption>
</figure>
</div>
<section id="data-governance" class="level1" data-number="1">
<h1 data-number="1"><span class="header-section-number">1</span> Data Governance</h1>
<section id="data-governance-basic-concept" class="level2" data-number="1.1">
<h2 data-number="1.1" class="anchored" data-anchor-id="data-governance-basic-concept"><span class="header-section-number">1.1</span> Data Governance Basic Concept</h2>
<ul>
<li>2024-08-01, <a href="../../../../docs/blog/posts/Governance/1.basis.html">Data Governance Basic Concepts, 거버넌스 기본 개념</a></li>
<li>2024-08-02, <a href="../../../../docs/blog/posts/Governance/2.task_process.html">Task Process, 업무 절차</a></li>
<li>2024-08-03, <a href="../../../../docs/blog/posts/Governance/3.architetucre.html">Data Architecture, 구조관리</a></li>
<li>0000-00-00, [Data Pipeline Design, 파이프라인 설계]</li>
<li>0000-00-00, [Data Storage, 저장소 관리]</li>
<li>0000-00-00, [Data Management Policy, 데이터 관리 정책]</li>
<li>0000-00-00, [Data Stewardship Model, 데이터 관리 모델]</li>
</ul>
</section>
<section id="data-modeling" class="level2" data-number="1.2">
<h2 data-number="1.2" class="anchored" data-anchor-id="data-modeling"><span class="header-section-number">1.2</span> Data Modeling</h2>
<ul>
<li>2024-08-04, <a href="../../../../docs/blog/posts/Governance/4-0.data_model.html">Data Model (1) - Basic Concept</a></li>
<li>2024-08-05, <a href="../../../../docs/blog/posts/Governance/4-1.data_model_database.html">Data Model (2) - Database Basis</a></li>
<li>2024-08-06, <a href="../../../../docs/blog/posts/Governance/4-2.data_model_sql.html">Data Model (3) - SQL Concept</a></li>
<li>2024-08-07, <a href="../../../../docs/blog/posts/Governance/4-3.data_model_schema.html">Data Model (4) - DB Design</a></li>
<li>2024-08-08, <a href="../../../../docs/blog/posts/Governance/4-4.data_model_requirements.html">Data Model (5) - Requirement Collection</a></li>
<li>2024-08-09, <a href="../../../../docs/blog/posts/Governance/4-5-0.data_model_conceptual.html">Data Model (6) - Conceptual Design</a></li>
<li>2024-08-10, <a href="../../../../docs/blog/posts/Governance/4-5-1.data_model_conceptual_ER_model.html">Data Model (7) - ER Modeling</a></li>
</ul>
<section id="data-standardization" class="level3" data-number="1.2.1">
<h3 data-number="1.2.1" class="anchored" data-anchor-id="data-standardization"><span class="header-section-number">1.2.1</span> Data Standardization</h3>
<ul>
<li>2024-08-11, <a href="../../../../docs/blog/posts/Governance/5-0-0.data_standard.html">Data Standardization - Basic Concept</a></li>
<li>2024-08-12, <a href="../../../../docs/blog/posts/Governance/5-0-1.stndrdztn_rule.ver1.0.0.html">Data Standardization - Standard Rules</a></li>
<li>2024-11-25, <a href="../../../../docs/blog/posts/Governance/5-0-2.terminology_hierarchy.html">Data Standardization - 용어 정리</a></li>
<li>2024-08-12, <a href="../../../../docs/blog/posts/Governance/5-1.data_word_dictionary.html">Data Standardization - 표준 단어 사전</a></li>
<li>2024-08-13, <a href="../../../../docs/blog/posts/Governance/5-2.data_word_domain.html">Data Standardization - 표준 도메인 사전</a></li>
<li>2024-08-14, <a href="../../../../docs/blog/posts/Governance/5-3.data_word_glossary.html">Data Standardization - 표준 용어 사전</a></li>
<li>2024-08-15, <a href="../../../../docs/blog/posts/Governance/5-4.data_code.html">Data Standardization - 표준 코드</a></li>
<li>2024-08-16, <a href="../../../../docs/blog/posts/Governance/6-0.data_registration_process.html">Data Standardization - 등록 프로세스</a></li>
<li>2024-08-17, <a href="../../../../docs/blog/posts/Governance/6-1.data_review_process.html">Data Standardization - 용어 검토 프로세스</a></li>
<li>2024-08-18, <a href="../../../../docs/blog/posts/Governance/6-2.data_code_registration.html">Data Standardization - 코드 등록 프로세스</a></li>
<li>2024-08-19, <a href="../../../../docs/blog/posts/Governance/8-0.data_quality_measures.html">Data Standardization - 데이터 품질 측정</a></li>
</ul>
</section>
<section id="data-quality" class="level3" data-number="1.2.2">
<h3 data-number="1.2.2" class="anchored" data-anchor-id="data-quality"><span class="header-section-number">1.2.2</span> Data Quality</h3>
<ul>
<li>0000-00-00, [Data Quality Control Process, 데이터 품질 절차]</li>
<li>0000-00-00, [Data Quality Measurement, 데이터 품질 측정]</li>
<li>0000-00-00, [Data Validation, 데이터 품질 검증]</li>
</ul>
</section>
<section id="etc." class="level3" data-number="1.2.3">
<h3 data-number="1.2.3" class="anchored" data-anchor-id="etc."><span class="header-section-number">1.2.3</span> etc.</h3>
<ul>
<li>2024-08-20, <a href="../../../../docs/blog/posts/Governance/current_status.html">Current Status, 현황 파악</a></li>
<li>0000-00-00, [Data Governance Solutions, 데이터 관리 솔루션]</li>
<li>0000-00-00, [Metadata Management, 메타데이터 관리]</li>
<li>0000-00-00, [Data Integration, 데이터 통합]</li>
<li>0000-00-00, [Data Security, 데이터 보안]</li>
</ul>


</section>
</section>
</section>

 ]]></description>
  <category>Data Governance</category>
  <guid>kk3225.netlify.app/docs/blog/posts/Governance/</guid>
  <pubDate>Tue, 31 Dec 2109 15:00:00 GMT</pubDate>
</item>
<item>
  <title>Epidemiology</title>
  <dc:creator>Kwangmin Kim</dc:creator>
  <link>kk3225.netlify.app/docs/blog/posts/Experimentation/Epidemiology/</link>
  <description><![CDATA[ 





<section id="contents" class="level1" data-number="1">
<h1 data-number="1"><span class="header-section-number">1</span> Contents</h1>
<section id="learning-path-for-experimentation" class="level2" data-number="1.1">
<h2 data-number="1.1" class="anchored" data-anchor-id="learning-path-for-experimentation"><span class="header-section-number">1.1</span> Learning Path for Experimentation</h2>
<p><strong>Priority Topics for Experimentation:</strong> 1. <strong>Experimental Studies → RCT</strong> (A/B Testing 직접 원형) 2. <strong>Causal Inference</strong> (전체 섹션 - 실험의 이론적 기초) 3. <strong>Effect Modification</strong> (Heterogeneous Treatment Effects) 4. <strong>Sample Size and Power</strong> (실험 설계 필수) 5. <strong>Propensity Score Methods</strong> (Observational causal inference)</p>
<p><strong>Recommended Study Order:</strong></p>
<p>Phase 1 (1-2주): Foundations + Study Designs → Focus on RCT and experimental principles</p>
<p>Phase 2 (1주): Measures of Association and Impact → Effect measures calculation practice</p>
<p>Phase 3 (2주): Causal Inference ⭐ → DAG practice, Counterfactual framework → Most critical for experimentation</p>
<p>Phase 4 (1주): Bias and Confounding + Study Fundamentals → Sample size calculations → Validity considerations</p>
<p>Phase 5 (선택): Advanced Topics → As needed for specific applications</p>
</section>
<section id="foundations" class="level2" data-number="1.2">
<h2 data-number="1.2" class="anchored" data-anchor-id="foundations"><span class="header-section-number">1.2</span> Foundations</h2>
<ul>
<li>1111-11-11, <a href="./foundations/concepts.qmd">Epidemiologic Concepts</a>
<ul>
<li>1111-11-11, <a href="./foundations/incidence_prevalence.qmd">Incidence vs.&nbsp;Prevalence (발생률 vs.&nbsp;유병률)</a></li>
<li>1111-11-11, <a href="./foundations/population_at_risk.qmd">Population at Risk (위험인구)</a></li>
<li>1111-11-11, <a href="./foundations/exposure_outcome.qmd">Exposure and Outcome (노출과 결과)</a></li>
</ul></li>
<li>1111-11-11, <a href="./foundations/framework.qmd">Study Design Framework (연구설계 프레임워크)</a>
<ul>
<li>1111-11-11, <a href="./foundations/descriptive_analytical.qmd">Descriptive vs.&nbsp;Analytical Studies (기술 vs.&nbsp;분석 연구)</a></li>
<li>1111-11-11, <a href="./foundations/observational_experimental.qmd">Observational vs.&nbsp;Experimental Studies (관찰 vs.&nbsp;실험 연구)</a></li>
<li>1111-11-11, <a href="./foundations/time_relationship.qmd">Time Relationship (시간적 관계)</a></li>
</ul></li>
</ul>
</section>
<section id="study-designs" class="level2" data-number="1.3">
<h2 data-number="1.3" class="anchored" data-anchor-id="study-designs"><span class="header-section-number">1.3</span> Study Designs</h2>
<ul>
<li>2023-02-27, Types of Study Designs in Epidemiology
<ul>
<li>1111-11-11, Descriptive Studies (기술연구)
<ul>
<li>1111-11-11, <a href="./descriptive/case_reports.qmd">Case Reports and Case Series (증례보고 및 증례군)</a></li>
<li>1111-11-11, <a href="./descriptive/ecological.qmd">Ecological Studies (생태학적 연구)</a></li>
</ul></li>
<li>1111-11-11, Observational Analytical Studies (관찰 분석연구)
<ul>
<li>1111-11-11, <a href="./observational/cross_sectional.qmd">Cross-sectional Studies (단면연구)</a></li>
<li>1111-11-11, <a href="./observational/case_control.qmd">Case-control Studies (환자-대조군 연구)</a></li>
<li>1111-11-11, <a href="./observational/cohort.qmd">Cohort Studies (코호트 연구)</a>
<ul>
<li>1111-11-11, <a href="./observational/cohort_prospective.qmd">Prospective Cohort (전향적 코호트)</a></li>
<li>1111-11-11, <a href="./observational/cohort_retrospective.qmd">Retrospective Cohort (후향적 코호트)</a></li>
</ul></li>
</ul></li>
<li>1111-11-11, Experimental Studies (실험연구) ⭐
<ul>
<li>1111-11-11, <a href="./experimental/rct.qmd">Randomized Controlled Trial (무작위 대조 시험)</a> ⭐</li>
<li>1111-11-11, <a href="./experimental/quasi_experimental.qmd">Quasi-experimental Studies (준실험 연구)</a></li>
<li>1111-11-11, <a href="./experimental/before_after.qmd">Before-after Studies (전후 연구)</a></li>
<li>1111-11-11, <a href="./experimental/factorial_design.qmd">Factorial Design (요인 설계)</a></li>
</ul></li>
<li>1111-11-11, Evidence Synthesis (근거 통합)
<ul>
<li>1111-11-11, <a href="./synthesis/systematic_review.qmd">Systematic Reviews (체계적 문헌고찰)</a></li>
<li>1111-11-11, <a href="./synthesis/meta_analysis.qmd">Meta-analyses (메타분석)</a></li>
</ul></li>
</ul></li>
</ul>
</section>
<section id="measures-of-association-and-impact" class="level2" data-number="1.4">
<h2 data-number="1.4" class="anchored" data-anchor-id="measures-of-association-and-impact"><span class="header-section-number">1.4</span> Measures of Association and Impact</h2>
<ul>
<li>2023-05-23, <a href="./measures_overview.qmd">Measures in Epidemiology</a>
<ul>
<li>1111-11-11, Contingency Tables and Basic Measures (분할표와 기본 측정)
<ul>
<li>1111-11-11, <a href="./measures/contingency_table.qmd">2x2 Contingency Tables (2x2 분할표)</a></li>
<li>1111-11-11, <a href="./measures/risk_rate_odds.qmd">Risk, Rate, and Odds (위험, 비율, 오즈)</a></li>
</ul></li>
<li>1111-11-11, Measures of Association (연관성 지표)
<ul>
<li>1111-11-11, <a href="./measures/relative_risk.qmd">Relative Risk (상대위험도)</a></li>
<li>1111-11-11, <a href="./measures/odds_ratio.qmd">Odds Ratio (오즈비)</a></li>
<li>1111-11-11, <a href="./measures/rate_ratio.qmd">Rate Ratio (비율비)</a></li>
</ul></li>
<li>1111-11-11, Measures of Effect (효과 지표)
<ul>
<li>1111-11-11, <a href="./measures/risk_difference.qmd">Risk Difference (위험차이)</a></li>
<li>1111-11-11, <a href="./measures/rrr.qmd">Relative Risk Reduction (상대위험감소)</a></li>
<li>1111-11-11, <a href="./measures/arr.qmd">Absolute Risk Reduction (절대위험감소)</a></li>
<li>1111-11-11, <a href="./measures/nnt.qmd">Number Needed to Treat (치료필요수)</a></li>
</ul></li>
<li>1111-11-11, Measures of Impact (영향 지표)
<ul>
<li>1111-11-11, <a href="./measures/attributable_risk.qmd">Attributable Risk (기여위험도)</a></li>
<li>1111-11-11, <a href="./measures/ar_percent.qmd">Attributable Risk Percent (기여위험분율)</a></li>
<li>1111-11-11, <a href="./measures/population_attributable_risk.qmd">Population Attributable Risk (인구기여위험도)</a></li>
<li>1111-11-11, <a href="./measures/par_percent.qmd">Population Attributable Risk Percent (인구기여위험분율)</a></li>
</ul></li>
<li>1111-11-11, Statistical Inference (통계적 추론)
<ul>
<li>1111-11-11, <a href="./measures/confidence_intervals.qmd">Confidence Intervals (신뢰구간)</a></li>
<li>1111-11-11, <a href="./measures/hypothesis_testing.qmd">Hypothesis Testing (가설 검정)</a></li>
<li>1111-11-11, <a href="./measures/p_values.qmd">p-values and Interpretation (p-값과 해석)</a></li>
</ul></li>
</ul></li>
</ul>
</section>
<section id="causal-inference" class="level2" data-number="1.5">
<h2 data-number="1.5" class="anchored" data-anchor-id="causal-inference"><span class="header-section-number">1.5</span> Causal Inference ⭐</h2>
<ul>
<li>1111-11-11, <a href="./causation/index.qmd">Causation in Epidemiology (역학에서의 인과관계)</a>
<ul>
<li>1111-11-11, Causation Concepts (인과관계 개념)
<ul>
<li>1111-11-11, <a href="./causation/necessary_sufficient.qmd">Necessary vs.&nbsp;Sufficient Causes (필요조건 vs.&nbsp;충분조건)</a></li>
<li>1111-11-11, <a href="./causation/component_causes.qmd">Component Causes (구성요인)</a></li>
<li>1111-11-11, <a href="./causation/induction_period.qmd">Induction Period (유도기간)</a></li>
</ul></li>
<li>1111-11-11, <a href="./causation/bradford_hill.qmd">Bradford Hill Criteria (Bradford Hill 기준)</a>
<ul>
<li>1111-11-11, <a href="./causation/strength.qmd">Strength of Association (연관성의 강도)</a></li>
<li>1111-11-11, <a href="./causation/consistency.qmd">Consistency and Replication (일관성과 재현성)</a></li>
<li>1111-11-11, <a href="./causation/specificity.qmd">Specificity (특이성)</a></li>
<li>1111-11-11, <a href="./causation/temporality.qmd">Temporality (시간적 선후관계)</a></li>
<li>1111-11-11, <a href="./causation/dose_response.qmd">Biological Gradient (생물학적 기울기)</a></li>
<li>1111-11-11, <a href="./causation/plausibility.qmd">Plausibility and Coherence (개연성과 일관성)</a></li>
<li>1111-11-11, <a href="./causation/experiment_analogy.qmd">Experiment and Analogy (실험과 유추)</a></li>
</ul></li>
<li>1111-11-11, <a href="./causation/counterfactual.qmd">Counterfactual Framework (반사실적 프레임워크)</a> ⭐
<ul>
<li>1111-11-11, <a href="./causation/potential_outcomes.qmd">Potential Outcomes (잠재결과)</a></li>
<li>1111-11-11, <a href="./causation/ate.qmd">Average Treatment Effect (평균 처치효과)</a></li>
<li>1111-11-11, <a href="./causation/sutva.qmd">SUTVA (안정단위처치값 가정)</a></li>
</ul></li>
<li>1111-11-11, <a href="./causation/dag.qmd">Directed Acyclic Graphs (방향성 비순환 그래프)</a> ⭐
<ul>
<li>1111-11-11, <a href="./causation/causal_pathways.qmd">Causal Pathways (인과 경로)</a></li>
<li>1111-11-11, <a href="./causation/confounding_paths.qmd">Confounding Paths (교란 경로)</a></li>
<li>1111-11-11, <a href="./causation/colliders.qmd">Colliders and Selection Bias (충돌자와 선택 편향)</a></li>
<li>1111-11-11, <a href="./causation/d_separation.qmd">d-separation (d-분리)</a></li>
</ul></li>
<li>1111-11-11, <a href="./causation/propensity_score.qmd">Propensity Score Methods (성향점수 방법)</a>
<ul>
<li>1111-11-11, <a href="./causation/ps_matching.qmd">Propensity Score Matching (성향점수 매칭)</a></li>
<li>1111-11-11, <a href="./causation/iptw.qmd">Inverse Probability Weighting (역확률 가중)</a></li>
<li>1111-11-11, <a href="./causation/ps_stratification.qmd">Propensity Score Stratification (성향점수 층화)</a></li>
<li>1111-11-11, <a href="./causation/ps_adjustment.qmd">Covariate Adjustment (공변량 조정)</a></li>
</ul></li>
</ul></li>
</ul>
</section>
<section id="bias-and-confounding" class="level2" data-number="1.6">
<h2 data-number="1.6" class="anchored" data-anchor-id="bias-and-confounding"><span class="header-section-number">1.6</span> Bias and Confounding</h2>
<ul>
<li>1111-11-11, <a href="./bias/index.qmd">Bias in Epidemiologic Studies (역학 연구의 편향)</a>
<ul>
<li>1111-11-11, Types of Bias (편향의 종류)
<ul>
<li>1111-11-11, <a href="./bias/selection_bias.qmd">Selection Bias (선택 편향)</a></li>
<li>1111-11-11, <a href="./bias/information_bias.qmd">Information Bias (정보 편향)</a></li>
<li>1111-11-11, <a href="./bias/misclassification.qmd">Misclassification Bias (오분류 편향)</a>
<ul>
<li>1111-11-11, <a href="./bias/nondifferential.qmd">Non-differential Misclassification (비차별적 오분류)</a></li>
<li>1111-11-11, <a href="./bias/differential.qmd">Differential Misclassification (차별적 오분류)</a></li>
</ul></li>
</ul></li>
</ul></li>
<li>1111-11-11, <a href="./confounding/index.qmd">Confounding (교란)</a>
<ul>
<li>1111-11-11, <a href="./confounding/definition.qmd">Definition and Criteria (정의와 기준)</a></li>
<li>1111-11-11, <a href="./confounding/positive_negative.qmd">Positive vs.&nbsp;Negative Confounding (양성 vs.&nbsp;음성 교란)</a></li>
<li>1111-11-11, <a href="./confounding/residual.qmd">Residual Confounding (잔여 교란)</a></li>
</ul></li>
<li>1111-11-11, <a href="./effect_modification/index.qmd">Effect Modification (효과 수정)</a> ⭐
<ul>
<li>1111-11-11, <a href="./effect_modification/vs_confounding.qmd">vs.&nbsp;Confounding (교란과의 구분)</a></li>
<li>1111-11-11, <a href="./effect_modification/statistical_interaction.qmd">Statistical Interaction (통계적 상호작용)</a></li>
<li>1111-11-11, <a href="./effect_modification/biological_interaction.qmd">Biological Interaction (생물학적 상호작용)</a></li>
</ul></li>
<li>1111-11-11, <a href="./control/index.qmd">Control Methods (통제 방법)</a>
<ul>
<li>1111-11-11, Design Stage Methods (설계 단계 방법)
<ul>
<li>1111-11-11, <a href="./control/restriction.qmd">Restriction (제한)</a></li>
<li>1111-11-11, <a href="./control/matching.qmd">Matching (매칭)</a></li>
</ul></li>
<li>1111-11-11, Analysis Stage Methods (분석 단계 방법)
<ul>
<li>1111-11-11, <a href="./control/stratification.qmd">Stratification Analysis (층화 분석)</a></li>
<li>1111-11-11, <a href="./control/standardization.qmd">Standardization (표준화)</a></li>
<li>1111-11-11, <a href="./control/regression_adjustment.qmd">Regression Adjustment (회귀 조정)</a></li>
</ul></li>
</ul></li>
</ul>
</section>
<section id="study-design-fundamentals" class="level2" data-number="1.7">
<h2 data-number="1.7" class="anchored" data-anchor-id="study-design-fundamentals"><span class="header-section-number">1.7</span> Study Design Fundamentals</h2>
<ul>
<li>1111-11-11, <a href="./fundamentals/sample_size_power.qmd">Sample Size and Power (표본 크기와 검정력)</a> ⭐
<ul>
<li>1111-11-11, <a href="./fundamentals/type1_error.qmd">Type I Error (1종 오류, α)</a></li>
<li>1111-11-11, <a href="./fundamentals/type2_error.qmd">Type II Error (2종 오류, β)</a></li>
<li>1111-11-11, <a href="./fundamentals/power.qmd">Statistical Power (통계적 검정력, 1-β)</a></li>
<li>1111-11-11, <a href="./fundamentals/effect_size.qmd">Effect Size (효과 크기)</a></li>
<li>1111-11-11, <a href="./fundamentals/sample_size_calc.qmd">Sample Size Calculation (표본 크기 계산)</a></li>
</ul></li>
<li>1111-11-11, <a href="./fundamentals/randomization.qmd">Randomization Methods (무작위 배정 방법)</a>
<ul>
<li>1111-11-11, <a href="./fundamentals/simple_random.qmd">Simple Randomization (단순 무작위배정)</a></li>
<li>1111-11-11, <a href="./fundamentals/block_random.qmd">Block Randomization (블록 무작위배정)</a></li>
<li>1111-11-11, <a href="./fundamentals/stratified_random.qmd">Stratified Randomization (층화 무작위배정)</a></li>
</ul></li>
<li>1111-11-11, <a href="./fundamentals/validity.qmd">Validity in Epidemiologic Studies (역학 연구의 타당도)</a>
<ul>
<li>1111-11-11, <a href="./fundamentals/internal_validity.qmd">Internal Validity (내적 타당도)</a></li>
<li>1111-11-11, <a href="./fundamentals/external_validity.qmd">External Validity (외적 타당도)</a></li>
<li>1111-11-11, <a href="./fundamentals/construct_validity.qmd">Construct Validity (구성 타당도)</a></li>
</ul></li>
</ul>
</section>
<section id="screening-and-diagnostic-tests" class="level2" data-number="1.8">
<h2 data-number="1.8" class="anchored" data-anchor-id="screening-and-diagnostic-tests"><span class="header-section-number">1.8</span> Screening and Diagnostic Tests</h2>
<ul>
<li>1111-11-11, <a href="./screening/index.qmd">Evaluation of Diagnostic Tests (진단검사 평가)</a>
<ul>
<li>1111-11-11, Test Performance Measures (검사 성능 지표)
<ul>
<li>1111-11-11, <a href="./screening/sensitivity.qmd">Sensitivity (민감도, True Positive Rate)</a></li>
<li>1111-11-11, <a href="./screening/specificity.qmd">Specificity (특이도, True Negative Rate)</a></li>
<li>1111-11-11, <a href="./screening/ppv.qmd">Positive Predictive Value (양성 예측도, PPV)</a></li>
<li>1111-11-11, <a href="./screening/npv.qmd">Negative Predictive Value (음성 예측도, NPV)</a></li>
</ul></li>
<li>1111-11-11, <a href="./screening/likelihood_ratios.qmd">Likelihood Ratios (우도비)</a>
<ul>
<li>1111-11-11, <a href="./screening/lr_positive.qmd">Positive Likelihood Ratio (양성 우도비, LR+)</a></li>
<li>1111-11-11, <a href="./screening/lr_negative.qmd">Negative Likelihood Ratio (음성 우도비, LR-)</a></li>
<li>1111-11-11, <a href="./screening/pretest_posttest.qmd">Pre-test to Post-test Probability (사전-사후 확률)</a></li>
</ul></li>
<li>1111-11-11, Trade-offs and Optimization (상충관계와 최적화)
<ul>
<li>1111-11-11, <a href="./screening/roc_curve.qmd">ROC Curve (ROC 곡선)</a></li>
<li>1111-11-11, <a href="./screening/auc.qmd">Area Under Curve (곡선하면적, AUC)</a></li>
<li>1111-11-11, <a href="./screening/cutpoint.qmd">Optimal Cut-point Selection (최적 절단값 선택)</a></li>
</ul></li>
<li>1111-11-11, <a href="./screening/bayesian.qmd">Bayesian Interpretation (베이지안 해석)</a>
<ul>
<li>1111-11-11, <a href="./screening/bayes_theorem.qmd">Bayes’ Theorem Connection (베이즈 정리와의 연결)</a></li>
</ul></li>
</ul></li>
</ul>
</section>
<section id="survival-analysis" class="level2" data-number="1.9">
<h2 data-number="1.9" class="anchored" data-anchor-id="survival-analysis"><span class="header-section-number">1.9</span> Survival Analysis</h2>
<ul>
<li>1111-11-11, <a href="./survival/index.qmd">Time-to-Event Analysis (시간-사건 분석)</a>
<ul>
<li>1111-11-11, Basic Concepts (기본 개념)
<ul>
<li>1111-11-11, <a href="./survival/censoring.qmd">Censoring (중도절단)</a></li>
<li>1111-11-11, <a href="./survival/survival_function.qmd">Survival Function (생존함수)</a></li>
<li>1111-11-11, <a href="./survival/hazard_function.qmd">Hazard Function (위험함수)</a></li>
</ul></li>
<li>1111-11-11, <a href="./survival/kaplan_meier.qmd">Kaplan-Meier Method (Kaplan-Meier 방법)</a>
<ul>
<li>1111-11-11, <a href="./survival/nonparametric.qmd">Non-parametric Estimation (비모수 추정)</a></li>
<li>1111-11-11, <a href="./survival/logrank_test.qmd">Log-rank Test (로그순위 검정)</a></li>
</ul></li>
<li>1111-11-11, <a href="./survival/cox_model.qmd">Cox Proportional Hazards Model (Cox 비례위험모형)</a>
<ul>
<li>1111-11-11, <a href="./survival/semiparametric.qmd">Semi-parametric Model (준모수 모형)</a></li>
<li>1111-11-11, <a href="./survival/hazard_ratio.qmd">Hazard Ratio (위험비)</a></li>
<li>1111-11-11, <a href="./survival/ph_assumption.qmd">Proportional Hazards Assumption (비례위험 가정)</a></li>
</ul></li>
<li>1111-11-11, Advanced Survival Topics (고급 생존분석 주제)
<ul>
<li>1111-11-11, <a href="./survival/competing_risks.qmd">Competing Risks (경쟁위험)</a></li>
<li>1111-11-11, <a href="./survival/recurrent_events.qmd">Recurrent Events (반복사건)</a></li>
</ul></li>
</ul></li>
</ul>
</section>
<section id="advanced-topics" class="level2" data-number="1.10">
<h2 data-number="1.10" class="anchored" data-anchor-id="advanced-topics"><span class="header-section-number">1.10</span> Advanced Topics</h2>
<ul>
<li>1111-11-11, <a href="./advanced/designs/index.qmd">Advanced Study Designs (고급 연구설계)</a>
<ul>
<li>1111-11-11, <a href="./advanced/designs/cluster_rct.qmd">Cluster Randomized Trials (군집 무작위 시험)</a></li>
<li>1111-11-11, <a href="./advanced/designs/stepped_wedge.qmd">Stepped Wedge Designs (단계적 쐐기 설계)</a></li>
<li>1111-11-11, <a href="./advanced/designs/adaptive.qmd">Adaptive Designs (적응형 설계)</a></li>
<li>1111-11-11, <a href="./advanced/designs/platform_trials.qmd">Platform Trials (플랫폼 시험)</a></li>
</ul></li>
<li>1111-11-11, <a href="./advanced/causal/index.qmd">Advanced Causal Methods (고급 인과추론 방법)</a>
<ul>
<li>1111-11-11, <a href="./advanced/causal/instrumental_variables.qmd">Instrumental Variables (도구변수)</a></li>
<li>1111-11-11, <a href="./advanced/causal/rdd.qmd">Regression Discontinuity Design (회귀불연속 설계)</a></li>
<li>1111-11-11, <a href="./advanced/causal/did.qmd">Difference-in-Differences (이중차분법)</a></li>
<li>1111-11-11, <a href="./advanced/causal/synthetic_control.qmd">Synthetic Control Methods (합성 통제 방법)</a></li>
</ul></li>
<li>1111-11-11, <a href="./advanced/stats/index.qmd">Advanced Statistical Methods (고급 통계 방법)</a>
<ul>
<li>1111-11-11, <a href="./advanced/stats/multilevel_modeling.qmd">Multilevel/Hierarchical Modeling (다층/계층 모델링)</a></li>
<li>1111-11-11, <a href="./advanced/stats/meta_analysis.qmd">Meta-analysis (메타분석)</a>
<ul>
<li>1111-11-11, <a href="./advanced/stats/fixed_effects.qmd">Fixed Effects Model (고정효과 모형)</a></li>
<li>1111-11-11, <a href="./advanced/stats/random_effects.qmd">Random Effects Model (무선효과 모형)</a></li>
<li>1111-11-11, <a href="./advanced/stats/meta_regression.qmd">Meta-regression (메타회귀분석)</a></li>
</ul></li>
<li>1111-11-11, <a href="./advanced/stats/missing_data.qmd">Missing Data Methods (결측치 처리 방법)</a>
<ul>
<li>1111-11-11, <a href="./advanced/stats/missing_mechanisms.qmd">MCAR, MAR, MNAR (결측 메커니즘)</a></li>
<li>1111-11-11, <a href="./advanced/stats/multiple_imputation.qmd">Multiple Imputation (다중대체)</a></li>
</ul></li>
<li>1111-11-11, <a href="./advanced/stats/measurement_error.qmd">Measurement Error Models (측정 오차 모형)</a></li>
</ul></li>
<li>1111-11-11, <a href="./advanced/special/index.qmd">Special Topics (특수 주제)</a>
<ul>
<li>1111-11-11, <a href="./advanced/special/time_varying_confounding.qmd">Time-varying Confounding (시간가변 교란)</a></li>
<li>1111-11-11, <a href="./advanced/special/mediation.qmd">Mediation Analysis (매개분석)</a></li>
<li>1111-11-11, <a href="./advanced/special/g_methods.qmd">G-methods (G-방법)</a>
<ul>
<li>1111-11-11, <a href="./advanced/special/g_computation.qmd">G-computation (G-계산)</a></li>
<li>1111-11-11, <a href="./advanced/special/ipw.qmd">Inverse Probability Weighting (역확률 가중)</a></li>
<li>1111-11-11, <a href="./advanced/special/g_estimation.qmd">G-estimation (G-추정)</a></li>
</ul></li>
<li>1111-11-11, <a href="./advanced/special/sensitivity_analysis.qmd">Sensitivity Analysis (민감도 분석)</a></li>
</ul></li>
</ul>


</section>
</section>

 ]]></description>
  <category>Epidemiology</category>
  <guid>kk3225.netlify.app/docs/blog/posts/Experimentation/Epidemiology/</guid>
  <pubDate>Sun, 28 Feb 2100 15:00:00 GMT</pubDate>
</item>
<item>
  <title>Mathematics</title>
  <dc:creator>Kwangmin Kim</dc:creator>
  <link>kk3225.netlify.app/docs/blog/posts/Math/</link>
  <description><![CDATA[ 





<section id="contents" class="level1" data-number="1">

<section id="basic" class="level2" data-number="1.1">

<ul>
<li>2023-03-24, <a href="./variables/index.qmd">Variable types</a></li>
<li>1111-11-11, <a href="./function/index.qmd">Function</a>
<ul>
<li>2023-01-31, <a href="../../../../docs/blog/posts/Math/function/univariable_scalar_function.html">Function (1) - Univariable Scalar Function (One to One)</a></li>
<li>2023-01-31, <a href="../../../../docs/blog/posts/Math/function/multivariable_scalar_function.html">Function (2) - Multi-variable Scalar Function (Many to One)</a></li>
<li>2023-01-31, <a href="../../../../docs/blog/posts/Math/function/univariable_vector_function.html">Function (3) - Univariable Vector Function (One to Many)</a></li>
<li>2023-01-31, <a href="../../../../docs/blog/posts/Math/function/mutivariable_vector_function.html">Function (4) - Multi-variable Vector Function (Many to Many)</a></li>
<li>2023-02-18, <a href="../../../../docs/blog/posts/Math/function/composite_function.html">Function (5) - Composite Function</a></li>
</ul></li>
<li>2023-02-18, <a href="../../../../docs/blog/posts/Math/transformation.html">Transformations of Functions</a></li>
<li>2023-03-24, <a href="../../../../docs/blog/posts/Math/convex_combination.html">Convex Combination</a></li>
<li>2023-03-18, <a href="../../../../docs/blog/posts/Math/2023-03-18_higher_order_derivative.html">Higher Order Derivative</a></li>
<li>2023-03-15, <a href="../../../../docs/blog/posts/Math/minimizer.html">Minimizer &amp; Minimum</a></li>
<li>2023-03-15, <a href="../../../../docs/blog/posts/Math/taylor_series.html">Taylor Series</a></li>
<li>1111-11-11, Vector &amp; Matrix</li>
<li>2023-03-15, <a href="./epsilon_delta/">Limit, <img src="https://latex.codecogs.com/png.latex?%5Cepsilon-%5Cdelta"> Method</a></li>
<li>Differentiation
<ul>
<li>2023-02-04, <a href="./differentiation/2023-02-04_uni_derivative.qmd">Derivative (1) - Univariable Scalar Funtion</a></li>
<li>1111-11-11, <a href="./differentiation/2023-02-10_composite_partial_derivative.qmd">Derivative (2) - Chain Rule &amp; Partial Derivative</a></li>
<li>1111-11-11, Derivative (3) - Higher Order Derivative</li>
<li>1111-11-11, Derivative (4) - Mean Value Theorem</li>
<li>1111-11-11, Derivative (5) - Gradient</li>
</ul></li>
<li>2023-03-15, <a href="./taylor_series/index.qmd">Talyer’s Series</a></li>
<li>1111-11-11, Gradient Direction</li>
<li>1111-11-11, Random Variable</li>
<li>1111-11-11, Probability Distribution</li>
<li>1111-11-11, Information Theory - Entropy</li>
<li>1111-11-11,</li>
<li>1111-11-11,</li>
<li>1111-11-11,</li>
<li>1111-11-11,</li>
</ul>
</section>
<section id="linear-algebra" class="level2" data-number="1.2">

<ul>
<li>2023-03-30, <a href="../../../../docs/blog/posts/Math/linear_algebra/01.basic_vector.html">Basic Vector(1) - Vector Operations</a></li>
<li>2023-03-30, <a href="../../../../docs/blog/posts/Math/linear_algebra/02.norm_dot-product.html">Basic Vector(2) - Vector Norm and Dot Product”</a></li>
<li>2023-03-30, <a href="../../../../docs/blog/posts/Math/linear_algebra/03.vector_equation.html">Basic Vector(3) - Vector Equation</a></li>
<li>2023-03-30, <a href="../../../../docs/blog/posts/Math/linear_algebra/04.matrix_operations.html">Basic Matrix(1) - Matrix Operation</a></li>
<li>2023-03-30, <a href="../../../../docs/blog/posts/Math/linear_algebra/05.matrix_multiplication.html">Basic Matrix(2) - Matrix Multiplication</a></li>
<li>2023-03-30, <a href="../../../../docs/blog/posts/Math/linear_algebra/06.system_of_lineqr_equations.html">Basic Matrix(3) - System of Linear Equations</a></li>
<li>2023-03-30, <a href="../../../../docs/blog/posts/Math/linear_algebra/09.special_matrix.html">Basic Matrix(4) - Special Matrix</a></li>
<li>2023-04-14, [Lineqr Equations]</li>
<li>2023-04-14, [Vector Space and Subspaces]</li>
<li>2023-04-21, [Orthogonality]</li>
<li>1111-11-11, [Determinants]</li>
<li>1111-11-11, [Eigen Value &amp; Eigen Vector]</li>
<li>1111-11-11, [Linear Transformations]</li>
<li>1111-11-11, Basis, Dimension, &amp; Rank</li>
<li>1111-11-11,</li>
<li>1111-11-11, Eigen Decomposition</li>
<li>1111-11-11, Singular Value Decomposition (SVD)</li>
<li>1111-11-11, Group</li>
<li>1111-11-11, Rotation &amp; Group</li>
<li>2023-04-02, <a href="./linear_algebra/quadratic_form.qmd">Matrix Transformation (5) - Quadratic Form</a></li>
<li>2023-04-02, <a href="../../../../docs/blog/posts/Math/linear_algebra/derivative_matrix_vector.html">Matrix Calculus (1) - Quadratic Form</a></li>
<li>1111-11-11,</li>
<li>1111-11-11,</li>
<li>1111-11-11,</li>
</ul>
</section>
<section id="optimization" class="level2" data-number="1.3">

<ul>
<li>2023-03-23, <a href="./optimization/minimizer.qmd">Minimizer &amp; Minimum</a></li>
<li>1111-11-11, Convex Set</li>
<li>1111-11-11, Convex Function</li>
<li>1111-11-11, Unconstrained Optimization</li>
<li>1111-11-11, Non-linear Least Square</li>
<li>1111-11-11, Largrange Multiplier Method
<ul>
<li>1111-11-11, Largrange Primal Function</li>
<li>1111-11-11, Largrange Dual Function</li>
<li>1111-11-11, KKT conditions</li>
</ul></li>
<li>1111-11-11, Gradient Descent Optimizers</li>
<li>1111-11-11,</li>
<li>1111-11-11,</li>
<li>1111-11-11,</li>
<li>1111-11-11,</li>
<li>1111-11-11,</li>
<li>1111-11-11,</li>
</ul>


</section>
</section>

 ]]></description>
  <category>Mathematics</category>
  <guid>kk3225.netlify.app/docs/blog/posts/Math/</guid>
  <pubDate>Sun, 28 Feb 2100 15:00:00 GMT</pubDate>
</item>
<item>
  <title>Azure AI Search Multimodal Search</title>
  <dc:creator>Kwangmin Kim</dc:creator>
  <link>kk3225.netlify.app/docs/blog/posts/Engineering/Infra/Cloud/Azure/31-az-ai-search-classic-multimodal-search.html</link>
  <description><![CDATA[ 





<section id="개요" class="level1" data-number="1">
<h1 data-number="1"><span class="header-section-number">1</span> 개요</h1>
<p><strong>Multimodal Search</strong>는 텍스트, 이미지, 비디오, 오디오 등 여러 콘텐츠 형식에서 정보를 수집, 이해, 검색하는 기능이다. Azure AI Search는 텍스트와 이미지가 포함된 문서를 처리하여 두 형식을 결합한 검색을 지원한다.</p>
<section id="왜-multimodal-search인가" class="level2" data-number="1.1">
<h2 data-number="1.1" class="anchored" data-anchor-id="왜-multimodal-search인가"><span class="header-section-number">1.1</span> 왜 Multimodal Search인가?</h2>
<p>전통적으로 멀티모달 검색은 텍스트와 이미지 처리를 위한 <strong>별도의 시스템</strong>이 필요하며, 사용자 지정 코드와 복잡한 구성이 요구된다. 이는 높은 비용, 복잡성, 유지보수 부담을 야기한다.</p>
<p><strong>Azure AI Search의 해결책</strong>: 이미지를 텍스트와 동일한 검색 파이프라인에 통합하여 단일 멀티모달 파이프라인으로 처리한다.</p>
<section id="주요-장점" class="level3" data-number="1.1.1">
<h3 data-number="1.1.1" class="anchored" data-anchor-id="주요-장점"><span class="header-section-number">1.1.1</span> 주요 장점</h3>
<ul>
<li><strong>통합 파이프라인</strong>: 차트, 스크린샷, 인포그래픽, 스캔 양식 등의 시각적 데이터를 텍스트와 함께 처리</li>
<li><strong>RAG 시나리오 최적화</strong>: 이미지의 구조적 논리를 해석하여 RAG 애플리케이션과 AI 에이전트가 중요한 시각적 세부 정보를 활용 가능</li>
<li><strong>정확한 인용</strong>: 원본 형식(텍스트/이미지)에 관계없이 원래 소스로 추적 가능한 답변 제공</li>
</ul>
<p><strong>실제 사례</strong>: “HR 양식 승인 프로세스는 무엇인가요?”라는 질문에 대해, 프로세스 설명이 PDF의 다이어그램에만 있어도 답변 가능</p>
</section>
</section>
</section>
<section id="multimodal-search-작동-원리" class="level1" data-number="2">
<h1 data-number="2"><span class="header-section-number">2</span> Multimodal Search 작동 원리</h1>
<section id="단계-파이프라인" class="level2" data-number="2.1">
<h2 data-number="2.1" class="anchored" data-anchor-id="단계-파이프라인"><span class="header-section-number">2.1</span> 5단계 파이프라인</h2>
<p>Azure AI Search는 <strong>Azure Portal의 “데이터 가져오기” 마법사</strong>를 통해 멀티모달 파이프라인 구축을 간소화한다.</p>
<section id="단계별-처리-흐름" class="level3" data-number="2.1.1">
<h3 data-number="2.1.1" class="anchored" data-anchor-id="단계별-처리-흐름"><span class="header-section-number">2.1.1</span> 단계별 처리 흐름</h3>
<p>```mermaid graph TD A[1. 콘텐츠 추출] –&gt; B[2. 텍스트 청킹] A –&gt; C[3. 이미지 설명 생성] B –&gt; D[4. 임베딩 생성] C –&gt; D A –&gt; E[5. 이미지 저장] D –&gt; F[검색 인덱스] E –&gt; G[지식 저장소] ```</p>
</section>
<section id="각-단계-상세" class="level3" data-number="2.1.2">
<h3 data-number="2.1.2" class="anchored" data-anchor-id="각-단계-상세"><span class="header-section-number">2.1.2</span> 각 단계 상세</h3>
<section id="콘텐츠-추출" class="level4" data-number="2.1.2.1">
<h4 data-number="2.1.2.1" class="anchored" data-anchor-id="콘텐츠-추출"><span class="header-section-number">2.1.2.1</span> 콘텐츠 추출</h4>
<p>3가지 기본 제공 기술 중 선택: - <strong>Document Extraction Skill</strong>: 기본 추출 - <strong>Document Layout Skill</strong>: 위치 메타데이터 포함 (페이지 번호, 경계 영역) - <strong>Azure Content Understanding Skill</strong>: 의미 기반 청킹, 페이지 간 테이블 처리</p>
</section>
<section id="텍스트-청킹" class="level4" data-number="2.1.2.2">
<h4 data-number="2.1.2.2" class="anchored" data-anchor-id="텍스트-청킹"><span class="header-section-number">2.1.2.2</span> 텍스트 청킹</h4>
<p><strong>Text Split Skill</strong>이 추출된 텍스트를 관리 가능한 청크로 분할하여 임베딩 기술이 처리할 수 있게 준비한다.</p>
</section>
<section id="이미지-설명-생성-선택" class="level4" data-number="2.1.2.3">
<h4 data-number="2.1.2.3" class="anchored" data-anchor-id="이미지-설명-생성-선택"><span class="header-section-number">2.1.2.3</span> 이미지 설명 생성 (선택)</h4>
<p><strong>GenAI Prompt Skill</strong>이 LLM을 호출하여 각 이미지에 대한 간결한 자연어 설명을 생성한다. - 예: “관리자 승인으로 시작하는 5단계 HR 액세스 워크플로”</p>
</section>
<section id="임베딩-생성" class="level4" data-number="2.1.2.4">
<h4 data-number="2.1.2.4" class="anchored" data-anchor-id="임베딩-생성"><span class="header-section-number">2.1.2.4</span> 임베딩 생성</h4>
<p>텍스트와 이미지의 벡터 표현을 생성하여 유사성 검색 및 하이브리드 검색 지원: - <strong>Azure OpenAI Embedding Skill</strong> - <strong>Microsoft Foundry Embedding Model</strong> - <strong>Azure Vision Multimodal Embedding Skill</strong></p>
</section>
<section id="이미지-저장" class="level4" data-number="2.1.2.5">
<h4 data-number="2.1.2.5" class="anchored" data-anchor-id="이미지-저장"><span class="header-section-number">2.1.2.5</span> 이미지 저장</h4>
<p><strong>지식 저장소(Knowledge Store)</strong>에 추출된 이미지를 저장하여 클라이언트 애플리케이션이 직접 반환할 수 있게 한다. 이미지 위치는 인덱스에 저장되어 쿼리 시 편리하게 검색 가능하다.</p>
</section>
</section>
</section>
<section id="azure-portal-마법사" class="level2" data-number="2.2">
<h2 data-number="2.2" class="anchored" data-anchor-id="azure-portal-마법사"><span class="header-section-number">2.2</span> Azure Portal 마법사</h2>
<p><strong>빠른 시작</strong>: <a href="https://learn.microsoft.com/ko-kr/azure/search/search-get-started-portal-image-search">Azure Portal에서 멀티모달 검색</a></p>
<p>마법사를 통해 다음을 구성: - 데이터 원본 - 추출 및 보강 설정 - 텍스트, 이미지 참조, 벡터 임베딩이 포함된 멀티모달 인덱스</p>
</section>
</section>
<section id="콘텐츠-추출-옵션-비교" class="level1" data-number="3">
<h1 data-number="3"><span class="header-section-number">3</span> 콘텐츠 추출 옵션 비교</h1>
<p>Azure AI Search는 3가지 기본 제공 추출 기술을 제공한다.</p>
<section id="기술별-기능-비교" class="level2" data-number="3.1">
<h2 data-number="3.1" class="anchored" data-anchor-id="기술별-기능-비교"><span class="header-section-number">3.1</span> 기술별 기능 비교</h2>
<table class="table">
<colgroup>
<col style="width: 8%">
<col style="width: 27%">
<col style="width: 23%">
<col style="width: 39%">
</colgroup>
<thead>
<tr class="header">
<th>기능</th>
<th>Document Extraction</th>
<th>Document Layout</th>
<th>Azure Content Understanding</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td><strong>텍스트 위치 메타데이터</strong></td>
<td>❌</td>
<td>✅ (페이지, 경계 다각형)</td>
<td>✅ (페이지, 경계 다각형)</td>
</tr>
<tr class="even">
<td><strong>이미지 위치 메타데이터</strong></td>
<td>✅</td>
<td>✅</td>
<td>✅</td>
</tr>
<tr class="odd">
<td><strong>테이블 추출</strong></td>
<td>❌</td>
<td>❌</td>
<td>✅ (페이지 간 포함)</td>
</tr>
<tr class="even">
<td><strong>교차 페이지 의미 단위</strong></td>
<td>N/A</td>
<td>❌ (단일 페이지만)</td>
<td>✅</td>
</tr>
<tr class="odd">
<td><strong>기본 제공 청킹</strong></td>
<td>❌ (Text Split 사용)</td>
<td>✅ (단락 경계)</td>
<td>✅ (의미 기반)</td>
</tr>
<tr class="even">
<td><strong>지원 파일 형식</strong></td>
<td>PDF만</td>
<td>다중 형식 (DI Layout)</td>
<td>PDF, DOCX, XLSX, PPTX</td>
</tr>
<tr class="odd">
<td><strong>과금 기준</strong></td>
<td>Azure AI Search 가격</td>
<td>Document Layout 가격</td>
<td>Content Understanding 가격</td>
</tr>
</tbody>
</table>
</section>
<section id="권장-시나리오" class="level2" data-number="3.2">
<h2 data-number="3.2" class="anchored" data-anchor-id="권장-시나리오"><span class="header-section-number">3.2</span> 권장 시나리오</h2>
<section id="document-extraction" class="level3" data-number="3.2.1">
<h3 data-number="3.2.1" class="anchored" data-anchor-id="document-extraction"><span class="header-section-number">3.2.1</span> Document Extraction</h3>
<ul>
<li><strong>사용 사례</strong>: 빠른 프로토타이핑, 위치 정보가 불필요한 프로덕션 파이프라인</li>
<li><strong>장점</strong>: 구성 간단, 비용 효율적</li>
<li><strong>제약</strong>: 위치 메타데이터 없음, PDF만 지원</li>
</ul>
</section>
<section id="document-layout" class="level3" data-number="3.2.2">
<h3 data-number="3.2.2" class="anchored" data-anchor-id="document-layout"><span class="header-section-number">3.2.2</span> Document Layout</h3>
<ul>
<li><strong>사용 사례</strong>: 정확한 페이지 번호, 페이지 강조 표시, 다이어그램 오버레이가 필요한 RAG 파이프라인</li>
<li><strong>장점</strong>: 위치 메타데이터 포함, 다중 파일 형식</li>
<li><strong>제약</strong>: 단일 페이지 단위 처리</li>
</ul>
</section>
<section id="azure-content-understanding" class="level3" data-number="3.2.3">
<h3 data-number="3.2.3" class="anchored" data-anchor-id="azure-content-understanding"><span class="header-section-number">3.2.3</span> Azure Content Understanding</h3>
<ul>
<li><strong>사용 사례</strong>: 페이지 간 테이블, 의미 기반 청킹, 일관된 다중 형식 처리</li>
<li><strong>장점</strong>: 가장 포괄적, 의미 기반 청킹, 교차 페이지 처리</li>
<li><strong>제약</strong>: 높은 비용</li>
</ul>
</section>
</section>
</section>
<section id="임베딩-옵션" class="level1" data-number="4">
<h1 data-number="4"><span class="header-section-number">4</span> 임베딩 옵션</h1>
<p>Azure AI Search는 이미지 처리를 위한 2가지 보완적 접근법을 제공한다.</p>
<section id="이미지-언어화-텍스트-임베딩" class="level2" data-number="4.1">
<h2 data-number="4.1" class="anchored" data-anchor-id="이미지-언어화-텍스트-임베딩"><span class="header-section-number">4.1</span> 이미지 언어화 + 텍스트 임베딩</h2>
<section id="처리-흐름" class="level3" data-number="4.1.1">
<h3 data-number="4.1.1" class="anchored" data-anchor-id="처리-흐름"><span class="header-section-number">4.1.1</span> 처리 흐름</h3>
<p>``` 이미지 → GenAI Prompt Skill → 자연어 설명 → 텍스트 임베딩 ```</p>
</section>
<section id="특징" class="level3" data-number="4.1.2">
<h3 data-number="4.1.2" class="anchored" data-anchor-id="특징"><span class="header-section-number">4.1.2</span> 특징</h3>
<ul>
<li><strong>LLM 기반</strong>: 각 이미지에 대해 LLM 호출 (인덱싱 시)</li>
<li><strong>의미 풍부</strong>: 다이어그램의 관계와 엔터티 해석</li>
<li><strong>인용 가능</strong>: LLM이 응답에서 그대로 인용 가능한 캡션 제공</li>
<li><strong>RAG 최적화</strong>: 접지된 데이터로 관련 스니펫 반환</li>
</ul>
</section>
<section id="장점" class="level3" data-number="4.1.3">
<h3 data-number="4.1.3" class="anchored" data-anchor-id="장점"><span class="header-section-number">4.1.3</span> 장점</h3>
<ul>
<li>다이어그램, 흐름도 등 설명적 시각 자료에 최적</li>
<li>AI 에이전트와 RAG 애플리케이션에 풍부한 컨텍스트 제공</li>
</ul>
</section>
<section id="단점" class="level3" data-number="4.1.4">
<h3 data-number="4.1.4" class="anchored" data-anchor-id="단점"><span class="header-section-number">4.1.4</span> 단점</h3>
<ul>
<li>모든 이미지마다 LLM 호출 필요</li>
<li>인덱싱 시간 증가</li>
<li>비용 상승</li>
</ul>
</section>
</section>
<section id="직접-멀티모달-임베딩" class="level2" data-number="4.2">
<h2 data-number="4.2" class="anchored" data-anchor-id="직접-멀티모달-임베딩"><span class="header-section-number">4.2</span> 직접 멀티모달 임베딩</h2>
<section id="처리-흐름-1" class="level3" data-number="4.2.1">
<h3 data-number="4.2.1" class="anchored" data-anchor-id="처리-흐름-1"><span class="header-section-number">4.2.1</span> 처리 흐름</h3>
<p>``` 이미지/텍스트 → Multimodal Embedding Model → 공유 벡터 공간 ```</p>
</section>
<section id="특징-1" class="level3" data-number="4.2.2">
<h3 data-number="4.2.2" class="anchored" data-anchor-id="특징-1"><span class="header-section-number">4.2.2</span> 특징</h3>
<ul>
<li><strong>직접 벡터화</strong>: 이미지와 텍스트를 동일한 벡터 공간에 직접 매핑</li>
<li><strong>LLM 불필요</strong>: 인덱싱 시 LLM 호출 없음</li>
<li><strong>시각적 유사성</strong>: “이것과 비슷한 것 찾기” 시나리오에 적합</li>
</ul>
</section>
<section id="장점-1" class="level3" data-number="4.2.3">
<h3 data-number="4.2.3" class="anchored" data-anchor-id="장점-1"><span class="header-section-number">4.2.3</span> 장점</h3>
<ul>
<li>구성 간단</li>
<li>빠른 인덱싱</li>
<li>비용 효율적</li>
<li>시각적 유사성 검색에 최적</li>
</ul>
</section>
<section id="단점-1" class="level3" data-number="4.2.4">
<h3 data-number="4.2.4" class="anchored" data-anchor-id="단점-1"><span class="header-section-number">4.2.4</span> 단점</h3>
<ul>
<li>순수 수학적 표현 (의미 설명 없음)</li>
<li>인용이나 상세 설명용 컨텍스트 부족</li>
</ul>
</section>
</section>
<section id="두-방법의-결합" class="level2" data-number="4.3">
<h2 data-number="4.3" class="anchored" data-anchor-id="두-방법의-결합"><span class="header-section-number">4.3</span> 두 방법의 결합</h2>
<p>많은 솔루션은 <strong>두 인코딩 경로를 병행</strong>한다:</p>
<table class="table">
<thead>
<tr class="header">
<th>콘텐츠 유형</th>
<th>추천 방식</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td>다이어그램, 흐름도, 설명적 시각 자료</td>
<td>이미지 언어화 + 텍스트 임베딩</td>
</tr>
<tr class="even">
<td>스크린샷, 제품 사진, 아트워크</td>
<td>직접 멀티모달 임베딩</td>
</tr>
</tbody>
</table>
<p>Azure AI Search 인덱스와 스킬셋 파이프라인을 커스터마이징하여 <strong>두 벡터 집합을 저장</strong>하고 나란히 검색 가능하다.</p>
</section>
</section>
<section id="쿼리-옵션" class="level1" data-number="5">
<h1 data-number="5"><span class="header-section-number">5</span> 쿼리 옵션</h1>
<section id="텍스트-쿼리-genai-prompt-기반" class="level2" data-number="5.1">
<h2 data-number="5.1" class="anchored" data-anchor-id="텍스트-쿼리-genai-prompt-기반"><span class="header-section-number">5.1</span> 텍스트 쿼리 (GenAI Prompt 기반)</h2>
<p>GenAI Prompt Skill로 구동되는 파이프라인에서는 <strong>하이브리드 쿼리</strong> 실행 가능: - 일반 텍스트와 언어화된 이미지 모두 검색 - 필터로 특정 콘텐츠 유형(텍스트만/이미지만) 범위 지정 - 전체 텍스트 검색 + 벡터 검색 + 의미 순위 결합</p>
<section id="제약사항" class="level3" data-number="5.1.1">
<h3 data-number="5.1.1" class="anchored" data-anchor-id="제약사항"><span class="header-section-number">5.1.1</span> 제약사항</h3>
<p><strong>이미지-벡터 쿼리 미지원</strong>: GenAI Prompt는 텍스트-벡터 쿼리만 지원</p>
</section>
</section>
<section id="이미지-쿼리-멀티모달-임베딩" class="level2" data-number="5.2">
<h2 data-number="5.2" class="anchored" data-anchor-id="이미지-쿼리-멀티모달-임베딩"><span class="header-section-number">5.2</span> 이미지 쿼리 (멀티모달 임베딩)</h2>
<p>이미지를 쿼리 입력으로 사용하려면 멀티모달 임베딩 모델 필수: - <strong>AML Skill</strong> 또는 - <strong>Azure Vision Multimodal Embedding Skill</strong></p>
<p>이들 기술만 쿼리 시 이미지를 벡터로 변환하는 <strong>벡터라이저</strong>를 제공한다.</p>
<section id="구성" class="level3" data-number="5.2.1">
<h3 data-number="5.2.1" class="anchored" data-anchor-id="구성"><span class="header-section-number">5.2.1</span> 구성</h3>
<p><a href="https://learn.microsoft.com/ko-kr/azure/search/vector-search-how-to-configure-vectorizer">검색 인덱스에서 벡터라이저 구성</a> 참조</p>
</section>
</section>
</section>
<section id="실습-리소스" class="level1" data-number="6">
<h1 data-number="6"><span class="header-section-number">6</span> 실습 리소스</h1>
<section id="빠른-시작" class="level2" data-number="6.1">
<h2 data-number="6.1" class="anchored" data-anchor-id="빠른-시작"><span class="header-section-number">6.1</span> 빠른 시작</h2>
<ul>
<li><strong>Azure Portal 마법사</strong>: <a href="https://learn.microsoft.com/ko-kr/azure/search/search-get-started-portal-image-search">빠른 시작: Azure Portal에서 멀티모달 검색</a>
<ul>
<li>마법사와 검색 탐색기로 멀티모달 인덱스 생성 및 테스트</li>
</ul></li>
</ul>
</section>
<section id="튜토리얼" class="level2" data-number="6.2">
<h2 data-number="6.2" class="anchored" data-anchor-id="튜토리얼"><span class="header-section-number">6.2</span> 튜토리얼</h2>
<section id="이미지-언어화-기반" class="level3" data-number="6.2.1">
<h3 data-number="6.2.1" class="anchored" data-anchor-id="이미지-언어화-기반"><span class="header-section-number">6.2.1</span> 이미지 언어화 기반</h3>
<ol type="1">
<li><strong><a href="https://learn.microsoft.com/ko-kr/azure/search/tutorial-document-extraction-image-verbalization">생성 AI로 이미지 설명하기</a></strong> (Document Extraction)
<ul>
<li>Document Extraction Skill로 텍스트/이미지 추출</li>
<li>다이어그램 언어화</li>
<li>설명과 텍스트를 검색 인덱스에 임베딩</li>
</ul></li>
<li><strong><a href="https://learn.microsoft.com/ko-kr/azure/search/tutorial-document-layout-image-verbalization">구조화된 문서 레이아웃에서 이미지 언어화</a></strong> (Document Layout)
<ul>
<li>레이아웃 기반 블록 및 다이어그램 언어화</li>
<li>위치 메타데이터 캡처</li>
<li>정확한 인용 및 페이지 강조 표시</li>
</ul></li>
</ol>
</section>
<section id="직접-멀티모달-임베딩-1" class="level3" data-number="6.2.2">
<h3 data-number="6.2.2" class="anchored" data-anchor-id="직접-멀티모달-임베딩-1"><span class="header-section-number">6.2.2</span> 직접 멀티모달 임베딩</h3>
<ol start="3" type="1">
<li><strong><a href="https://learn.microsoft.com/ko-kr/azure/search/tutorial-document-extraction-multimodal-embeddings">이미지 및 텍스트 벡터화</a></strong> (Document Extraction)
<ul>
<li>Vision 멀티모달 모델로 텍스트/이미지 직접 임베딩</li>
<li>스캔 PDF의 시각적 유사성 검색</li>
</ul></li>
<li><strong><a href="https://learn.microsoft.com/ko-kr/azure/search/tutorial-document-layout-multimodal-embeddings">구조화된 문서 레이아웃에서 벡터화</a></strong> (Document Layout)
<ul>
<li>레이아웃 기반 청킹 + 통합 임베딩</li>
<li>하이브리드 의미/키워드 검색</li>
<li>정확한 적중 위치 반환</li>
</ul></li>
</ol>
</section>
</section>
</section>
<section id="튜토리얼-상세-document-extraction-multimodal-embeddings" class="level1" data-number="7">
<h1 data-number="7"><span class="header-section-number">7</span> 튜토리얼 상세: Document Extraction + Multimodal Embeddings</h1>
<p>이 섹션은 <strong>Azure Vision 4.0 Multimodal Embedding</strong>을 사용한 구현 방법을 단계별로 설명한다.</p>
<section id="필수-구성-요소" class="level2" data-number="7.1">
<h2 data-number="7.1" class="anchored" data-anchor-id="필수-구성-요소"><span class="header-section-number">7.1</span> 필수 구성 요소</h2>
<section id="azure-리소스" class="level3" data-number="7.1.1">
<h3 data-number="7.1.1" class="anchored" data-anchor-id="azure-리소스"><span class="header-section-number">7.1.1</span> Azure 리소스</h3>
<ol type="1">
<li><strong>Azure AI Search</strong> (Basic 이상)
<ul>
<li>역할 기반 액세스 제어 및 관리 ID 구성</li>
<li>무료 계층 미지원</li>
</ul></li>
<li><strong>Microsoft Foundry 리소스</strong>
<ul>
<li>Azure Vision Multimodal 4.0 API 액세스</li>
<li>지역 제약: Multimodal 4.0 지원 지역 확인 필요</li>
</ul></li>
<li><strong>Azure Storage</strong>
<ul>
<li>샘플 데이터 저장</li>
<li>지식 저장소 (추출된 이미지)</li>
<li>검색 서비스에 Storage Blob Data Reader 역할 할당</li>
</ul></li>
</ol>
</section>
<section id="도구" class="level3" data-number="7.1.2">
<h3 data-number="7.1.2" class="anchored" data-anchor-id="도구"><span class="header-section-number">7.1.2</span> 도구</h3>
<ul>
<li>Visual Studio Code + REST 클라이언트</li>
</ul>
</section>
</section>
<section id="데이터-준비" class="level2" data-number="7.2">
<h2 data-number="7.2" class="anchored" data-anchor-id="데이터-준비"><span class="header-section-number">7.2</span> 데이터 준비</h2>
<section id="샘플-데이터" class="level3" data-number="7.2.1">
<h3 data-number="7.2.1" class="anchored" data-anchor-id="샘플-데이터"><span class="header-section-number">7.2.1</span> 샘플 데이터</h3>
<p>36페이지 PDF 문서: <a href="https://cdn-dynmedia-1.microsoft.com/is/content/microsoftcorp/microsoft/msc/documents/presentations/CSR/Accelerating-Sustainability-with-AI-2025.pdf">Accelerating Sustainability with AI</a> - 차트, 인포그래픽, 스캔 페이지 포함</p>
</section>
<section id="스토리지-구성" class="level3" data-number="7.2.2">
<h3 data-number="7.2.2" class="anchored" data-anchor-id="스토리지-구성"><span class="header-section-number">7.2.2</span> 스토리지 구성</h3>
<div class="sourceCode" id="cb1" style="background: #f1f3f5;"><pre class="sourceCode numberSource bash number-lines code-with-copy"><code class="sourceCode bash"><span id="cb1-1"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># 1. Blob Container 생성</span></span>
<span id="cb1-2"><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">Container</span> Name: sustainable-ai-pdf</span>
<span id="cb1-3"></span>
<span id="cb1-4"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># 2. PDF 업로드</span></span>
<span id="cb1-5"></span>
<span id="cb1-6"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># 3. 역할 할당 (관리 ID 사용)</span></span>
<span id="cb1-7"><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">-</span> Storage Blob Data Reader <span class="er" style="color: #AD0000;
background-color: null;
font-style: inherit;">(</span><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">인덱서용</span><span class="kw" style="color: #003B4F;
background-color: null;
font-style: inherit;">)</span></span>
<span id="cb1-8"><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">-</span> Storage Blob Data Contributor <span class="er" style="color: #AD0000;
background-color: null;
font-style: inherit;">(</span><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">지식</span> 저장소용<span class="kw" style="color: #003B4F;
background-color: null;
font-style: inherit;">)</span></span>
<span id="cb1-9"><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">-</span> Storage Table Data Contributor <span class="er" style="color: #AD0000;
background-color: null;
font-style: inherit;">(</span><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">지식</span> 저장소용<span class="kw" style="color: #003B4F;
background-color: null;
font-style: inherit;">)</span></span></code></pre></div>
</section>
<section id="연결-문자열-관리-id" class="level3" data-number="7.2.3">
<h3 data-number="7.2.3" class="anchored" data-anchor-id="연결-문자열-관리-id"><span class="header-section-number">7.2.3</span> 연결 문자열 (관리 ID)</h3>
<div class="sourceCode" id="cb2" style="background: #f1f3f5;"><pre class="sourceCode numberSource json number-lines code-with-copy"><code class="sourceCode json"><span id="cb2-1"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">{</span></span>
<span id="cb2-2">  <span class="dt" style="color: #AD0000;
background-color: null;
font-style: inherit;">"credentials"</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">:</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">{</span></span>
<span id="cb2-3">    <span class="dt" style="color: #AD0000;
background-color: null;
font-style: inherit;">"connectionString"</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">:</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"ResourceId=/subscriptions/{subscription-id}/resourceGroups/{resource-group}/providers/Microsoft.Storage/storageAccounts/{storage-account}/;"</span></span>
<span id="cb2-4">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">}</span></span>
<span id="cb2-5"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">}</span></span></code></pre></div>
</section>
</section>
<section id="모델-준비" class="level2" data-number="7.3">
<h2 data-number="7.3" class="anchored" data-anchor-id="모델-준비"><span class="header-section-number">7.3</span> 모델 준비</h2>
<section id="foundry-역할-할당" class="level3" data-number="7.3.1">
<h3 data-number="7.3.1" class="anchored" data-anchor-id="foundry-역할-할당"><span class="header-section-number">7.3.1</span> Foundry 역할 할당</h3>
<div class="sourceCode" id="cb3" style="background: #f1f3f5;"><pre class="sourceCode numberSource bash number-lines code-with-copy"><code class="sourceCode bash"><span id="cb3-1"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># Azure Portal &gt; Foundry 리소스 &gt; 액세스 제어(IAM)</span></span>
<span id="cb3-2"><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">역할:</span> Cognitive Services 사용자</span>
<span id="cb3-3"><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">할당</span> 대상: 검색 서비스 관리 ID</span></code></pre></div>
<p><strong>중요</strong>: Foundry 리소스는 Multimodal 4.0 API 지원 지역에 있어야 함</p>
</section>
</section>
<section id="인덱스-스키마" class="level2" data-number="7.4">
<h2 data-number="7.4" class="anchored" data-anchor-id="인덱스-스키마"><span class="header-section-number">7.4</span> 인덱스 스키마</h2>
<section id="필드-정의" class="level3" data-number="7.4.1">
<h3 data-number="7.4.1" class="anchored" data-anchor-id="필드-정의"><span class="header-section-number">7.4.1</span> 필드 정의</h3>
<div class="sourceCode" id="cb4" style="background: #f1f3f5;"><pre class="sourceCode numberSource json number-lines code-with-copy"><code class="sourceCode json"><span id="cb4-1"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">{</span></span>
<span id="cb4-2">  <span class="dt" style="color: #AD0000;
background-color: null;
font-style: inherit;">"name"</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">:</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"doc-extraction-multimodal-embedding-index"</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">,</span></span>
<span id="cb4-3">  <span class="dt" style="color: #AD0000;
background-color: null;
font-style: inherit;">"fields"</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">:</span> <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">[</span></span>
<span id="cb4-4">    <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">{</span></span>
<span id="cb4-5">      <span class="dt" style="color: #AD0000;
background-color: null;
font-style: inherit;">"name"</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">:</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"content_id"</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">,</span></span>
<span id="cb4-6">      <span class="dt" style="color: #AD0000;
background-color: null;
font-style: inherit;">"type"</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">:</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Edm.String"</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">,</span></span>
<span id="cb4-7">      <span class="dt" style="color: #AD0000;
background-color: null;
font-style: inherit;">"key"</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">:</span> <span class="kw" style="color: #003B4F;
background-color: null;
font-style: inherit;">true</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">,</span></span>
<span id="cb4-8">      <span class="dt" style="color: #AD0000;
background-color: null;
font-style: inherit;">"analyzer"</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">:</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"keyword"</span></span>
<span id="cb4-9">    <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">}</span><span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">,</span></span>
<span id="cb4-10">    <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">{</span></span>
<span id="cb4-11">      <span class="dt" style="color: #AD0000;
background-color: null;
font-style: inherit;">"name"</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">:</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"text_document_id"</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">,</span></span>
<span id="cb4-12">      <span class="dt" style="color: #AD0000;
background-color: null;
font-style: inherit;">"type"</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">:</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Edm.String"</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">,</span></span>
<span id="cb4-13">      <span class="dt" style="color: #AD0000;
background-color: null;
font-style: inherit;">"filterable"</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">:</span> <span class="kw" style="color: #003B4F;
background-color: null;
font-style: inherit;">true</span></span>
<span id="cb4-14">    <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">}</span><span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">,</span></span>
<span id="cb4-15">    <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">{</span></span>
<span id="cb4-16">      <span class="dt" style="color: #AD0000;
background-color: null;
font-style: inherit;">"name"</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">:</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"image_document_id"</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">,</span></span>
<span id="cb4-17">      <span class="dt" style="color: #AD0000;
background-color: null;
font-style: inherit;">"type"</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">:</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Edm.String"</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">,</span></span>
<span id="cb4-18">      <span class="dt" style="color: #AD0000;
background-color: null;
font-style: inherit;">"filterable"</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">:</span> <span class="kw" style="color: #003B4F;
background-color: null;
font-style: inherit;">true</span></span>
<span id="cb4-19">    <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">}</span><span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">,</span></span>
<span id="cb4-20">    <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">{</span></span>
<span id="cb4-21">      <span class="dt" style="color: #AD0000;
background-color: null;
font-style: inherit;">"name"</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">:</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"document_title"</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">,</span></span>
<span id="cb4-22">      <span class="dt" style="color: #AD0000;
background-color: null;
font-style: inherit;">"type"</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">:</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Edm.String"</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">,</span></span>
<span id="cb4-23">      <span class="dt" style="color: #AD0000;
background-color: null;
font-style: inherit;">"searchable"</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">:</span> <span class="kw" style="color: #003B4F;
background-color: null;
font-style: inherit;">true</span></span>
<span id="cb4-24">    <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">}</span><span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">,</span></span>
<span id="cb4-25">    <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">{</span></span>
<span id="cb4-26">      <span class="dt" style="color: #AD0000;
background-color: null;
font-style: inherit;">"name"</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">:</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"content_text"</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">,</span></span>
<span id="cb4-27">      <span class="dt" style="color: #AD0000;
background-color: null;
font-style: inherit;">"type"</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">:</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Edm.String"</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">,</span></span>
<span id="cb4-28">      <span class="dt" style="color: #AD0000;
background-color: null;
font-style: inherit;">"searchable"</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">:</span> <span class="kw" style="color: #003B4F;
background-color: null;
font-style: inherit;">true</span></span>
<span id="cb4-29">    <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">}</span><span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">,</span></span>
<span id="cb4-30">    <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">{</span></span>
<span id="cb4-31">      <span class="dt" style="color: #AD0000;
background-color: null;
font-style: inherit;">"name"</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">:</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"content_embedding"</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">,</span></span>
<span id="cb4-32">      <span class="dt" style="color: #AD0000;
background-color: null;
font-style: inherit;">"type"</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">:</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Collection(Edm.Single)"</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">,</span></span>
<span id="cb4-33">      <span class="dt" style="color: #AD0000;
background-color: null;
font-style: inherit;">"dimensions"</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">:</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1024</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">,</span></span>
<span id="cb4-34">      <span class="dt" style="color: #AD0000;
background-color: null;
font-style: inherit;">"vectorSearchProfile"</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">:</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"hnsw"</span></span>
<span id="cb4-35">    <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">}</span><span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">,</span></span>
<span id="cb4-36">    <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">{</span></span>
<span id="cb4-37">      <span class="dt" style="color: #AD0000;
background-color: null;
font-style: inherit;">"name"</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">:</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"content_path"</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">,</span></span>
<span id="cb4-38">      <span class="dt" style="color: #AD0000;
background-color: null;
font-style: inherit;">"type"</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">:</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Edm.String"</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">,</span></span>
<span id="cb4-39">      <span class="dt" style="color: #AD0000;
background-color: null;
font-style: inherit;">"retrievable"</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">:</span> <span class="kw" style="color: #003B4F;
background-color: null;
font-style: inherit;">true</span></span>
<span id="cb4-40">    <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">}</span><span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">,</span></span>
<span id="cb4-41">    <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">{</span></span>
<span id="cb4-42">      <span class="dt" style="color: #AD0000;
background-color: null;
font-style: inherit;">"name"</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">:</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"location_metadata"</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">,</span></span>
<span id="cb4-43">      <span class="dt" style="color: #AD0000;
background-color: null;
font-style: inherit;">"type"</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">:</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Edm.ComplexType"</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">,</span></span>
<span id="cb4-44">      <span class="dt" style="color: #AD0000;
background-color: null;
font-style: inherit;">"fields"</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">:</span> <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">[</span></span>
<span id="cb4-45">        <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">{</span></span>
<span id="cb4-46">          <span class="dt" style="color: #AD0000;
background-color: null;
font-style: inherit;">"name"</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">:</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"page_number"</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">,</span></span>
<span id="cb4-47">          <span class="dt" style="color: #AD0000;
background-color: null;
font-style: inherit;">"type"</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">:</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Edm.Int32"</span></span>
<span id="cb4-48">        <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">}</span><span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">,</span></span>
<span id="cb4-49">        <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">{</span></span>
<span id="cb4-50">          <span class="dt" style="color: #AD0000;
background-color: null;
font-style: inherit;">"name"</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">:</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"bounding_polygons"</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">,</span></span>
<span id="cb4-51">          <span class="dt" style="color: #AD0000;
background-color: null;
font-style: inherit;">"type"</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">:</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Edm.String"</span></span>
<span id="cb4-52">        <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">}</span></span>
<span id="cb4-53">      <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">]</span></span>
<span id="cb4-54">    <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">}</span></span>
<span id="cb4-55">  <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">]</span></span>
<span id="cb4-56"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">}</span></span></code></pre></div>
</section>
<section id="벡터-검색-구성" class="level3" data-number="7.4.2">
<h3 data-number="7.4.2" class="anchored" data-anchor-id="벡터-검색-구성"><span class="header-section-number">7.4.2</span> 벡터 검색 구성</h3>
<div class="sourceCode" id="cb5" style="background: #f1f3f5;"><pre class="sourceCode numberSource json number-lines code-with-copy"><code class="sourceCode json"><span id="cb5-1"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">{</span></span>
<span id="cb5-2">  <span class="dt" style="color: #AD0000;
background-color: null;
font-style: inherit;">"vectorSearch"</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">:</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">{</span></span>
<span id="cb5-3">    <span class="dt" style="color: #AD0000;
background-color: null;
font-style: inherit;">"profiles"</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">:</span> <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">[</span></span>
<span id="cb5-4">      <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">{</span></span>
<span id="cb5-5">        <span class="dt" style="color: #AD0000;
background-color: null;
font-style: inherit;">"name"</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">:</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"hnsw"</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">,</span></span>
<span id="cb5-6">        <span class="dt" style="color: #AD0000;
background-color: null;
font-style: inherit;">"algorithm"</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">:</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"defaulthnsw"</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">,</span></span>
<span id="cb5-7">        <span class="dt" style="color: #AD0000;
background-color: null;
font-style: inherit;">"vectorizer"</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">:</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"demo-vectorizer"</span></span>
<span id="cb5-8">      <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">}</span></span>
<span id="cb5-9">    <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">]</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">,</span></span>
<span id="cb5-10">    <span class="dt" style="color: #AD0000;
background-color: null;
font-style: inherit;">"algorithms"</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">:</span> <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">[</span></span>
<span id="cb5-11">      <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">{</span></span>
<span id="cb5-12">        <span class="dt" style="color: #AD0000;
background-color: null;
font-style: inherit;">"name"</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">:</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"defaulthnsw"</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">,</span></span>
<span id="cb5-13">        <span class="dt" style="color: #AD0000;
background-color: null;
font-style: inherit;">"kind"</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">:</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"hnsw"</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">,</span></span>
<span id="cb5-14">        <span class="dt" style="color: #AD0000;
background-color: null;
font-style: inherit;">"hnswParameters"</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">:</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">{</span></span>
<span id="cb5-15">          <span class="dt" style="color: #AD0000;
background-color: null;
font-style: inherit;">"m"</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">:</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">4</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">,</span></span>
<span id="cb5-16">          <span class="dt" style="color: #AD0000;
background-color: null;
font-style: inherit;">"efConstruction"</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">:</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">400</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">,</span></span>
<span id="cb5-17">          <span class="dt" style="color: #AD0000;
background-color: null;
font-style: inherit;">"metric"</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">:</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"cosine"</span></span>
<span id="cb5-18">        <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">}</span></span>
<span id="cb5-19">      <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">}</span></span>
<span id="cb5-20">    <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">]</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">,</span></span>
<span id="cb5-21">    <span class="dt" style="color: #AD0000;
background-color: null;
font-style: inherit;">"vectorizers"</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">:</span> <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">[</span></span>
<span id="cb5-22">      <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">{</span></span>
<span id="cb5-23">        <span class="dt" style="color: #AD0000;
background-color: null;
font-style: inherit;">"name"</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">:</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"demo-vectorizer"</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">,</span></span>
<span id="cb5-24">        <span class="dt" style="color: #AD0000;
background-color: null;
font-style: inherit;">"kind"</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">:</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"aiServicesVision"</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">,</span></span>
<span id="cb5-25">        <span class="dt" style="color: #AD0000;
background-color: null;
font-style: inherit;">"aiServicesVisionParameters"</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">:</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">{</span></span>
<span id="cb5-26">          <span class="dt" style="color: #AD0000;
background-color: null;
font-style: inherit;">"resourceUri"</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">:</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"{{cognitiveServicesUrl}}"</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">,</span></span>
<span id="cb5-27">          <span class="dt" style="color: #AD0000;
background-color: null;
font-style: inherit;">"authIdentity"</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">:</span> <span class="kw" style="color: #003B4F;
background-color: null;
font-style: inherit;">null</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">,</span></span>
<span id="cb5-28">          <span class="dt" style="color: #AD0000;
background-color: null;
font-style: inherit;">"modelVersion"</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">:</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"2023-04-15"</span></span>
<span id="cb5-29">        <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">}</span></span>
<span id="cb5-30">      <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">}</span></span>
<span id="cb5-31">    <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">]</span></span>
<span id="cb5-32">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">}</span></span>
<span id="cb5-33"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">}</span></span></code></pre></div>
<p><strong>핵심 포인트</strong>: - <code>dimensions: 1024</code> - Azure Vision Multimodal 4.0의 벡터 차원 - <code>vectorizer: aiServicesVision</code> - 쿼리 시 이미지 벡터화 지원</p>
</section>
</section>
<section id="스킬셋-구성" class="level2" data-number="7.5">
<h2 data-number="7.5" class="anchored" data-anchor-id="스킬셋-구성"><span class="header-section-number">7.5</span> 스킬셋 구성</h2>
<section id="전체-파이프라인" class="level3" data-number="7.5.1">
<h3 data-number="7.5.1" class="anchored" data-anchor-id="전체-파이프라인"><span class="header-section-number">7.5.1</span> 전체 파이프라인</h3>
<div class="sourceCode" id="cb6" style="background: #f1f3f5;"><pre class="sourceCode numberSource mermaid number-lines code-with-copy"><code class="sourceCode"><span id="cb6-1">graph LR</span>
<span id="cb6-2">    A[Document Extraction] --&gt; B[Text Split]</span>
<span id="cb6-3">    A --&gt; C[Vision Vectorize Text]</span>
<span id="cb6-4">    A --&gt; D[Vision Vectorize Image]</span>
<span id="cb6-5">    B --&gt; C</span>
<span id="cb6-6">    C --&gt; E[Index Projection]</span>
<span id="cb6-7">    D --&gt; E</span>
<span id="cb6-8">    A --&gt; F[Shaper]</span>
<span id="cb6-9">    F --&gt; G[Knowledge Store]</span></code></pre></div>
</section>
<section id="주요-스킬" class="level3" data-number="7.5.2">
<h3 data-number="7.5.2" class="anchored" data-anchor-id="주요-스킬"><span class="header-section-number">7.5.2</span> 주요 스킬</h3>
<section id="document-extraction-skill" class="level4" data-number="7.5.2.1">
<h4 data-number="7.5.2.1" class="anchored" data-anchor-id="document-extraction-skill"><span class="header-section-number">7.5.2.1</span> 1. Document Extraction Skill</h4>
<div class="sourceCode" id="cb7" style="background: #f1f3f5;"><pre class="sourceCode numberSource json number-lines code-with-copy"><code class="sourceCode json"><span id="cb7-1"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">{</span></span>
<span id="cb7-2">  <span class="dt" style="color: #AD0000;
background-color: null;
font-style: inherit;">"@odata.type"</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">:</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"#Microsoft.Skills.Util.DocumentExtractionSkill"</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">,</span></span>
<span id="cb7-3">  <span class="dt" style="color: #AD0000;
background-color: null;
font-style: inherit;">"parsingMode"</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">:</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"default"</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">,</span></span>
<span id="cb7-4">  <span class="dt" style="color: #AD0000;
background-color: null;
font-style: inherit;">"dataToExtract"</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">:</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"contentAndMetadata"</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">,</span></span>
<span id="cb7-5">  <span class="dt" style="color: #AD0000;
background-color: null;
font-style: inherit;">"configuration"</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">:</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">{</span></span>
<span id="cb7-6">    <span class="dt" style="color: #AD0000;
background-color: null;
font-style: inherit;">"imageAction"</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">:</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"generateNormalizedImages"</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">,</span></span>
<span id="cb7-7">    <span class="dt" style="color: #AD0000;
background-color: null;
font-style: inherit;">"normalizedImageMaxWidth"</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">:</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">2000</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">,</span></span>
<span id="cb7-8">    <span class="dt" style="color: #AD0000;
background-color: null;
font-style: inherit;">"normalizedImageMaxHeight"</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">:</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">2000</span></span>
<span id="cb7-9">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">},</span></span>
<span id="cb7-10">  <span class="dt" style="color: #AD0000;
background-color: null;
font-style: inherit;">"context"</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">:</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"/document"</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">,</span></span>
<span id="cb7-11">  <span class="dt" style="color: #AD0000;
background-color: null;
font-style: inherit;">"inputs"</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">:</span> <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">[</span></span>
<span id="cb7-12">    <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">{</span></span>
<span id="cb7-13">      <span class="dt" style="color: #AD0000;
background-color: null;
font-style: inherit;">"name"</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">:</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"file_data"</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">,</span></span>
<span id="cb7-14">      <span class="dt" style="color: #AD0000;
background-color: null;
font-style: inherit;">"source"</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">:</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"/document/file_data"</span></span>
<span id="cb7-15">    <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">}</span></span>
<span id="cb7-16">  <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">]</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">,</span></span>
<span id="cb7-17">  <span class="dt" style="color: #AD0000;
background-color: null;
font-style: inherit;">"outputs"</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">:</span> <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">[</span></span>
<span id="cb7-18">    <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">{</span></span>
<span id="cb7-19">      <span class="dt" style="color: #AD0000;
background-color: null;
font-style: inherit;">"name"</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">:</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"content"</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">,</span></span>
<span id="cb7-20">      <span class="dt" style="color: #AD0000;
background-color: null;
font-style: inherit;">"targetName"</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">:</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"extracted_content"</span></span>
<span id="cb7-21">    <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">}</span><span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">,</span></span>
<span id="cb7-22">    <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">{</span></span>
<span id="cb7-23">      <span class="dt" style="color: #AD0000;
background-color: null;
font-style: inherit;">"name"</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">:</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"normalized_images"</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">,</span></span>
<span id="cb7-24">      <span class="dt" style="color: #AD0000;
background-color: null;
font-style: inherit;">"targetName"</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">:</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"normalized_images"</span></span>
<span id="cb7-25">    <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">}</span></span>
<span id="cb7-26">  <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">]</span></span>
<span id="cb7-27"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">}</span></span></code></pre></div>
<p><strong>출력</strong>: - <code>extracted_content</code>: 문서의 모든 텍스트 - <code>normalized_images</code>: 정규화된 이미지 배열 (최대 2000x2000)</p>
</section>
<section id="text-split-skill" class="level4" data-number="7.5.2.2">
<h4 data-number="7.5.2.2" class="anchored" data-anchor-id="text-split-skill"><span class="header-section-number">7.5.2.2</span> 2. Text Split Skill</h4>
<div class="sourceCode" id="cb8" style="background: #f1f3f5;"><pre class="sourceCode numberSource json number-lines code-with-copy"><code class="sourceCode json"><span id="cb8-1"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">{</span></span>
<span id="cb8-2">  <span class="dt" style="color: #AD0000;
background-color: null;
font-style: inherit;">"@odata.type"</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">:</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"#Microsoft.Skills.Text.SplitSkill"</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">,</span></span>
<span id="cb8-3">  <span class="dt" style="color: #AD0000;
background-color: null;
font-style: inherit;">"context"</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">:</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"/document"</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">,</span></span>
<span id="cb8-4">  <span class="dt" style="color: #AD0000;
background-color: null;
font-style: inherit;">"defaultLanguageCode"</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">:</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"en"</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">,</span></span>
<span id="cb8-5">  <span class="dt" style="color: #AD0000;
background-color: null;
font-style: inherit;">"textSplitMode"</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">:</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"pages"</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">,</span></span>
<span id="cb8-6">  <span class="dt" style="color: #AD0000;
background-color: null;
font-style: inherit;">"maximumPageLength"</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">:</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">2000</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">,</span></span>
<span id="cb8-7">  <span class="dt" style="color: #AD0000;
background-color: null;
font-style: inherit;">"pageOverlapLength"</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">:</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">200</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">,</span></span>
<span id="cb8-8">  <span class="dt" style="color: #AD0000;
background-color: null;
font-style: inherit;">"unit"</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">:</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"characters"</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">,</span></span>
<span id="cb8-9">  <span class="dt" style="color: #AD0000;
background-color: null;
font-style: inherit;">"inputs"</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">:</span> <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">[</span></span>
<span id="cb8-10">    <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">{</span></span>
<span id="cb8-11">      <span class="dt" style="color: #AD0000;
background-color: null;
font-style: inherit;">"name"</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">:</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"text"</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">,</span></span>
<span id="cb8-12">      <span class="dt" style="color: #AD0000;
background-color: null;
font-style: inherit;">"source"</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">:</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"/document/extracted_content"</span></span>
<span id="cb8-13">    <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">}</span></span>
<span id="cb8-14">  <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">]</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">,</span></span>
<span id="cb8-15">  <span class="dt" style="color: #AD0000;
background-color: null;
font-style: inherit;">"outputs"</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">:</span> <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">[</span></span>
<span id="cb8-16">    <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">{</span></span>
<span id="cb8-17">      <span class="dt" style="color: #AD0000;
background-color: null;
font-style: inherit;">"name"</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">:</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"textItems"</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">,</span></span>
<span id="cb8-18">      <span class="dt" style="color: #AD0000;
background-color: null;
font-style: inherit;">"targetName"</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">:</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"pages"</span></span>
<span id="cb8-19">    <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">}</span></span>
<span id="cb8-20">  <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">]</span></span>
<span id="cb8-21"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">}</span></span></code></pre></div>
<p><strong>청킹 전략</strong>: - 2000자 청크 - 200자 오버랩 (문맥 유지)</p>
</section>
<section id="azure-vision-vectorize-skill-text" class="level4" data-number="7.5.2.3">
<h4 data-number="7.5.2.3" class="anchored" data-anchor-id="azure-vision-vectorize-skill-text"><span class="header-section-number">7.5.2.3</span> 3. Azure Vision Vectorize Skill (Text)</h4>
<div class="sourceCode" id="cb9" style="background: #f1f3f5;"><pre class="sourceCode numberSource json number-lines code-with-copy"><code class="sourceCode json"><span id="cb9-1"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">{</span></span>
<span id="cb9-2">  <span class="dt" style="color: #AD0000;
background-color: null;
font-style: inherit;">"@odata.type"</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">:</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"#Microsoft.Skills.Vision.VectorizeSkill"</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">,</span></span>
<span id="cb9-3">  <span class="dt" style="color: #AD0000;
background-color: null;
font-style: inherit;">"name"</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">:</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"text-embedding-skill"</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">,</span></span>
<span id="cb9-4">  <span class="dt" style="color: #AD0000;
background-color: null;
font-style: inherit;">"context"</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">:</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"/document/pages/*"</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">,</span></span>
<span id="cb9-5">  <span class="dt" style="color: #AD0000;
background-color: null;
font-style: inherit;">"modelVersion"</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">:</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"2023-04-15"</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">,</span></span>
<span id="cb9-6">  <span class="dt" style="color: #AD0000;
background-color: null;
font-style: inherit;">"inputs"</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">:</span> <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">[</span></span>
<span id="cb9-7">    <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">{</span></span>
<span id="cb9-8">      <span class="dt" style="color: #AD0000;
background-color: null;
font-style: inherit;">"name"</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">:</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"text"</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">,</span></span>
<span id="cb9-9">      <span class="dt" style="color: #AD0000;
background-color: null;
font-style: inherit;">"source"</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">:</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"/document/pages/*"</span></span>
<span id="cb9-10">    <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">}</span></span>
<span id="cb9-11">  <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">]</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">,</span></span>
<span id="cb9-12">  <span class="dt" style="color: #AD0000;
background-color: null;
font-style: inherit;">"outputs"</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">:</span> <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">[</span></span>
<span id="cb9-13">    <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">{</span></span>
<span id="cb9-14">      <span class="dt" style="color: #AD0000;
background-color: null;
font-style: inherit;">"name"</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">:</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"vector"</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">,</span></span>
<span id="cb9-15">      <span class="dt" style="color: #AD0000;
background-color: null;
font-style: inherit;">"targetName"</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">:</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"text_vector"</span></span>
<span id="cb9-16">    <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">}</span></span>
<span id="cb9-17">  <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">]</span></span>
<span id="cb9-18"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">}</span></span></code></pre></div>
</section>
<section id="azure-vision-vectorize-skill-image" class="level4" data-number="7.5.2.4">
<h4 data-number="7.5.2.4" class="anchored" data-anchor-id="azure-vision-vectorize-skill-image"><span class="header-section-number">7.5.2.4</span> 4. Azure Vision Vectorize Skill (Image)</h4>
<div class="sourceCode" id="cb10" style="background: #f1f3f5;"><pre class="sourceCode numberSource json number-lines code-with-copy"><code class="sourceCode json"><span id="cb10-1"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">{</span></span>
<span id="cb10-2">  <span class="dt" style="color: #AD0000;
background-color: null;
font-style: inherit;">"@odata.type"</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">:</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"#Microsoft.Skills.Vision.VectorizeSkill"</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">,</span></span>
<span id="cb10-3">  <span class="dt" style="color: #AD0000;
background-color: null;
font-style: inherit;">"name"</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">:</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"image-embedding-skill"</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">,</span></span>
<span id="cb10-4">  <span class="dt" style="color: #AD0000;
background-color: null;
font-style: inherit;">"context"</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">:</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"/document/normalized_images/*"</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">,</span></span>
<span id="cb10-5">  <span class="dt" style="color: #AD0000;
background-color: null;
font-style: inherit;">"modelVersion"</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">:</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"2023-04-15"</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">,</span></span>
<span id="cb10-6">  <span class="dt" style="color: #AD0000;
background-color: null;
font-style: inherit;">"inputs"</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">:</span> <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">[</span></span>
<span id="cb10-7">    <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">{</span></span>
<span id="cb10-8">      <span class="dt" style="color: #AD0000;
background-color: null;
font-style: inherit;">"name"</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">:</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"image"</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">,</span></span>
<span id="cb10-9">      <span class="dt" style="color: #AD0000;
background-color: null;
font-style: inherit;">"source"</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">:</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"/document/normalized_images/*"</span></span>
<span id="cb10-10">    <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">}</span></span>
<span id="cb10-11">  <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">]</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">,</span></span>
<span id="cb10-12">  <span class="dt" style="color: #AD0000;
background-color: null;
font-style: inherit;">"outputs"</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">:</span> <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">[</span></span>
<span id="cb10-13">    <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">{</span></span>
<span id="cb10-14">      <span class="dt" style="color: #AD0000;
background-color: null;
font-style: inherit;">"name"</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">:</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"vector"</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">,</span></span>
<span id="cb10-15">      <span class="dt" style="color: #AD0000;
background-color: null;
font-style: inherit;">"targetName"</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">:</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"image_vector"</span></span>
<span id="cb10-16">    <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">}</span></span>
<span id="cb10-17">  <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">]</span></span>
<span id="cb10-18"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">}</span></span></code></pre></div>
<p><strong>Azure Vision Multimodal Embedding</strong>: - 동일한 스킬, 입력만 다름 (text vs image) - 1024차원 벡터 생성 - 공유 벡터 공간 (텍스트-이미지 간 코사인 유사도 계산 가능)</p>
</section>
<section id="shaper-skill" class="level4" data-number="7.5.2.5">
<h4 data-number="7.5.2.5" class="anchored" data-anchor-id="shaper-skill"><span class="header-section-number">7.5.2.5</span> 5. Shaper Skill</h4>
<div class="sourceCode" id="cb11" style="background: #f1f3f5;"><pre class="sourceCode numberSource json number-lines code-with-copy"><code class="sourceCode json"><span id="cb11-1"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">{</span></span>
<span id="cb11-2">  <span class="dt" style="color: #AD0000;
background-color: null;
font-style: inherit;">"@odata.type"</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">:</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"#Microsoft.Skills.Util.ShaperSkill"</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">,</span></span>
<span id="cb11-3">  <span class="dt" style="color: #AD0000;
background-color: null;
font-style: inherit;">"context"</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">:</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"/document/normalized_images/*"</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">,</span></span>
<span id="cb11-4">  <span class="dt" style="color: #AD0000;
background-color: null;
font-style: inherit;">"inputs"</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">:</span> <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">[</span></span>
<span id="cb11-5">    <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">{</span></span>
<span id="cb11-6">      <span class="dt" style="color: #AD0000;
background-color: null;
font-style: inherit;">"name"</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">:</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"imagePath"</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">,</span></span>
<span id="cb11-7">      <span class="dt" style="color: #AD0000;
background-color: null;
font-style: inherit;">"source"</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">:</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"='{{imageProjectionContainer}}/'+$(/document/normalized_images/*/imagePath)"</span></span>
<span id="cb11-8">    <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">}</span><span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">,</span></span>
<span id="cb11-9">    <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">{</span></span>
<span id="cb11-10">      <span class="dt" style="color: #AD0000;
background-color: null;
font-style: inherit;">"name"</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">:</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"location_metadata"</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">,</span></span>
<span id="cb11-11">      <span class="dt" style="color: #AD0000;
background-color: null;
font-style: inherit;">"sourceContext"</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">:</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"/document/normalized_images/*"</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">,</span></span>
<span id="cb11-12">      <span class="dt" style="color: #AD0000;
background-color: null;
font-style: inherit;">"inputs"</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">:</span> <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">[</span></span>
<span id="cb11-13">        <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">{</span></span>
<span id="cb11-14">          <span class="dt" style="color: #AD0000;
background-color: null;
font-style: inherit;">"name"</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">:</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"page_number"</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">,</span></span>
<span id="cb11-15">          <span class="dt" style="color: #AD0000;
background-color: null;
font-style: inherit;">"source"</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">:</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"/document/normalized_images/*/pageNumber"</span></span>
<span id="cb11-16">        <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">}</span><span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">,</span></span>
<span id="cb11-17">        <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">{</span></span>
<span id="cb11-18">          <span class="dt" style="color: #AD0000;
background-color: null;
font-style: inherit;">"name"</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">:</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"bounding_polygons"</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">,</span></span>
<span id="cb11-19">          <span class="dt" style="color: #AD0000;
background-color: null;
font-style: inherit;">"source"</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">:</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"/document/normalized_images/*/boundingPolygon"</span></span>
<span id="cb11-20">        <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">}</span></span>
<span id="cb11-21">      <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">]</span></span>
<span id="cb11-22">    <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">}</span></span>
<span id="cb11-23">  <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">]</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">,</span></span>
<span id="cb11-24">  <span class="dt" style="color: #AD0000;
background-color: null;
font-style: inherit;">"outputs"</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">:</span> <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">[</span></span>
<span id="cb11-25">    <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">{</span></span>
<span id="cb11-26">      <span class="dt" style="color: #AD0000;
background-color: null;
font-style: inherit;">"name"</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">:</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"output"</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">,</span></span>
<span id="cb11-27">      <span class="dt" style="color: #AD0000;
background-color: null;
font-style: inherit;">"targetName"</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">:</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"new_normalized_images"</span></span>
<span id="cb11-28">    <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">}</span></span>
<span id="cb11-29">  <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">]</span></span>
<span id="cb11-30"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">}</span></span></code></pre></div>
</section>
</section>
<section id="index-projections" class="level3" data-number="7.5.3">
<h3 data-number="7.5.3" class="anchored" data-anchor-id="index-projections"><span class="header-section-number">7.5.3</span> Index Projections</h3>
<div class="sourceCode" id="cb12" style="background: #f1f3f5;"><pre class="sourceCode numberSource json number-lines code-with-copy"><code class="sourceCode json"><span id="cb12-1"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">{</span></span>
<span id="cb12-2">  <span class="dt" style="color: #AD0000;
background-color: null;
font-style: inherit;">"indexProjections"</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">:</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">{</span></span>
<span id="cb12-3">    <span class="dt" style="color: #AD0000;
background-color: null;
font-style: inherit;">"selectors"</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">:</span> <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">[</span></span>
<span id="cb12-4">      <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">{</span></span>
<span id="cb12-5">        <span class="dt" style="color: #AD0000;
background-color: null;
font-style: inherit;">"targetIndexName"</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">:</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"doc-extraction-multimodal-embedding-index"</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">,</span></span>
<span id="cb12-6">        <span class="dt" style="color: #AD0000;
background-color: null;
font-style: inherit;">"parentKeyFieldName"</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">:</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"text_document_id"</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">,</span></span>
<span id="cb12-7">        <span class="dt" style="color: #AD0000;
background-color: null;
font-style: inherit;">"sourceContext"</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">:</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"/document/pages/*"</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">,</span></span>
<span id="cb12-8">        <span class="dt" style="color: #AD0000;
background-color: null;
font-style: inherit;">"mappings"</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">:</span> <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">[</span></span>
<span id="cb12-9">          <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">{</span></span>
<span id="cb12-10">            <span class="dt" style="color: #AD0000;
background-color: null;
font-style: inherit;">"name"</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">:</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"content_embedding"</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">,</span></span>
<span id="cb12-11">            <span class="dt" style="color: #AD0000;
background-color: null;
font-style: inherit;">"source"</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">:</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"/document/pages/*/text_vector"</span></span>
<span id="cb12-12">          <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">}</span><span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">,</span></span>
<span id="cb12-13">          <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">{</span></span>
<span id="cb12-14">            <span class="dt" style="color: #AD0000;
background-color: null;
font-style: inherit;">"name"</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">:</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"content_text"</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">,</span></span>
<span id="cb12-15">            <span class="dt" style="color: #AD0000;
background-color: null;
font-style: inherit;">"source"</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">:</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"/document/pages/*"</span></span>
<span id="cb12-16">          <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">}</span><span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">,</span></span>
<span id="cb12-17">          <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">{</span></span>
<span id="cb12-18">            <span class="dt" style="color: #AD0000;
background-color: null;
font-style: inherit;">"name"</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">:</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"document_title"</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">,</span></span>
<span id="cb12-19">            <span class="dt" style="color: #AD0000;
background-color: null;
font-style: inherit;">"source"</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">:</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"/document/document_title"</span></span>
<span id="cb12-20">          <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">}</span></span>
<span id="cb12-21">        <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">]</span></span>
<span id="cb12-22">      <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">}</span><span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">,</span></span>
<span id="cb12-23">      <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">{</span></span>
<span id="cb12-24">        <span class="dt" style="color: #AD0000;
background-color: null;
font-style: inherit;">"targetIndexName"</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">:</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"doc-extraction-multimodal-embedding-index"</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">,</span></span>
<span id="cb12-25">        <span class="dt" style="color: #AD0000;
background-color: null;
font-style: inherit;">"parentKeyFieldName"</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">:</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"image_document_id"</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">,</span></span>
<span id="cb12-26">        <span class="dt" style="color: #AD0000;
background-color: null;
font-style: inherit;">"sourceContext"</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">:</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"/document/normalized_images/*"</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">,</span></span>
<span id="cb12-27">        <span class="dt" style="color: #AD0000;
background-color: null;
font-style: inherit;">"mappings"</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">:</span> <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">[</span></span>
<span id="cb12-28">          <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">{</span></span>
<span id="cb12-29">            <span class="dt" style="color: #AD0000;
background-color: null;
font-style: inherit;">"name"</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">:</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"content_embedding"</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">,</span></span>
<span id="cb12-30">            <span class="dt" style="color: #AD0000;
background-color: null;
font-style: inherit;">"source"</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">:</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"/document/normalized_images/*/image_vector"</span></span>
<span id="cb12-31">          <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">}</span><span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">,</span></span>
<span id="cb12-32">          <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">{</span></span>
<span id="cb12-33">            <span class="dt" style="color: #AD0000;
background-color: null;
font-style: inherit;">"name"</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">:</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"content_path"</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">,</span></span>
<span id="cb12-34">            <span class="dt" style="color: #AD0000;
background-color: null;
font-style: inherit;">"source"</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">:</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"/document/normalized_images/*/new_normalized_images/imagePath"</span></span>
<span id="cb12-35">          <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">}</span><span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">,</span></span>
<span id="cb12-36">          <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">{</span></span>
<span id="cb12-37">            <span class="dt" style="color: #AD0000;
background-color: null;
font-style: inherit;">"name"</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">:</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"location_metadata"</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">,</span></span>
<span id="cb12-38">            <span class="dt" style="color: #AD0000;
background-color: null;
font-style: inherit;">"source"</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">:</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"/document/normalized_images/*/new_normalized_images/location_metadata"</span></span>
<span id="cb12-39">          <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">}</span><span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">,</span></span>
<span id="cb12-40">          <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">{</span></span>
<span id="cb12-41">            <span class="dt" style="color: #AD0000;
background-color: null;
font-style: inherit;">"name"</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">:</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"document_title"</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">,</span></span>
<span id="cb12-42">            <span class="dt" style="color: #AD0000;
background-color: null;
font-style: inherit;">"source"</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">:</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"/document/document_title"</span></span>
<span id="cb12-43">          <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">}</span></span>
<span id="cb12-44">        <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">]</span></span>
<span id="cb12-45">      <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">}</span></span>
<span id="cb12-46">    <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">]</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">,</span></span>
<span id="cb12-47">    <span class="dt" style="color: #AD0000;
background-color: null;
font-style: inherit;">"parameters"</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">:</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">{</span></span>
<span id="cb12-48">      <span class="dt" style="color: #AD0000;
background-color: null;
font-style: inherit;">"projectionMode"</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">:</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"skipIndexingParentDocuments"</span></span>
<span id="cb12-49">    <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">}</span></span>
<span id="cb12-50">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">}</span></span>
<span id="cb12-51"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">}</span></span></code></pre></div>
<p><strong>동작 원리</strong>: - 텍스트 청크당 1개 문서 생성 (<code>text_document_id</code>) - 이미지당 1개 문서 생성 (<code>image_document_id</code>) - 부모 문서(원본 PDF)는 인덱싱 건너뛰기</p>
</section>
<section id="knowledge-store" class="level3" data-number="7.5.4">
<h3 data-number="7.5.4" class="anchored" data-anchor-id="knowledge-store"><span class="header-section-number">7.5.4</span> Knowledge Store</h3>
<div class="sourceCode" id="cb13" style="background: #f1f3f5;"><pre class="sourceCode numberSource json number-lines code-with-copy"><code class="sourceCode json"><span id="cb13-1"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">{</span></span>
<span id="cb13-2">  <span class="dt" style="color: #AD0000;
background-color: null;
font-style: inherit;">"knowledgeStore"</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">:</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">{</span></span>
<span id="cb13-3">    <span class="dt" style="color: #AD0000;
background-color: null;
font-style: inherit;">"storageConnectionString"</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">:</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"{{storageConnection}}"</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">,</span></span>
<span id="cb13-4">    <span class="dt" style="color: #AD0000;
background-color: null;
font-style: inherit;">"projections"</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">:</span> <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">[</span></span>
<span id="cb13-5">      <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">{</span></span>
<span id="cb13-6">        <span class="dt" style="color: #AD0000;
background-color: null;
font-style: inherit;">"files"</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">:</span> <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">[</span></span>
<span id="cb13-7">          <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">{</span></span>
<span id="cb13-8">            <span class="dt" style="color: #AD0000;
background-color: null;
font-style: inherit;">"storageContainer"</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">:</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"{{imageProjectionContainer}}"</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">,</span></span>
<span id="cb13-9">            <span class="dt" style="color: #AD0000;
background-color: null;
font-style: inherit;">"source"</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">:</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"/document/normalized_images/*"</span></span>
<span id="cb13-10">          <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">}</span></span>
<span id="cb13-11">        <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">]</span></span>
<span id="cb13-12">      <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">}</span></span>
<span id="cb13-13">    <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">]</span></span>
<span id="cb13-14">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">}</span></span>
<span id="cb13-15"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">}</span></span></code></pre></div>
<p><strong>저장 내용</strong>: - 정규화된 이미지 파일 (JPEG) - 파일명: <code>{document-id}_{image-index}.jpg</code></p>
</section>
</section>
<section id="인덱서-실행" class="level2" data-number="7.6">
<h2 data-number="7.6" class="anchored" data-anchor-id="인덱서-실행"><span class="header-section-number">7.6</span> 인덱서 실행</h2>
<section id="구성-1" class="level3" data-number="7.6.1">
<h3 data-number="7.6.1" class="anchored" data-anchor-id="구성-1"><span class="header-section-number">7.6.1</span> 구성</h3>
<div class="sourceCode" id="cb14" style="background: #f1f3f5;"><pre class="sourceCode numberSource json number-lines code-with-copy"><code class="sourceCode json"><span id="cb14-1"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">{</span></span>
<span id="cb14-2">  <span class="dt" style="color: #AD0000;
background-color: null;
font-style: inherit;">"name"</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">:</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"doc-extraction-multimodal-embedding-indexer"</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">,</span></span>
<span id="cb14-3">  <span class="dt" style="color: #AD0000;
background-color: null;
font-style: inherit;">"dataSourceName"</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">:</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"doc-extraction-multimodal-embedding-ds"</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">,</span></span>
<span id="cb14-4">  <span class="dt" style="color: #AD0000;
background-color: null;
font-style: inherit;">"targetIndexName"</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">:</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"doc-extraction-multimodal-embedding-index"</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">,</span></span>
<span id="cb14-5">  <span class="dt" style="color: #AD0000;
background-color: null;
font-style: inherit;">"skillsetName"</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">:</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"doc-extraction-multimodal-embedding-skillset"</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">,</span></span>
<span id="cb14-6">  <span class="dt" style="color: #AD0000;
background-color: null;
font-style: inherit;">"parameters"</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">:</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">{</span></span>
<span id="cb14-7">    <span class="dt" style="color: #AD0000;
background-color: null;
font-style: inherit;">"batchSize"</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">:</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">,</span></span>
<span id="cb14-8">    <span class="dt" style="color: #AD0000;
background-color: null;
font-style: inherit;">"configuration"</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">:</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">{</span></span>
<span id="cb14-9">      <span class="dt" style="color: #AD0000;
background-color: null;
font-style: inherit;">"allowSkillsetToReadFileData"</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">:</span> <span class="kw" style="color: #003B4F;
background-color: null;
font-style: inherit;">true</span></span>
<span id="cb14-10">    <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">}</span></span>
<span id="cb14-11">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">}</span></span>
<span id="cb14-12"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">}</span></span></code></pre></div>
</section>
<section id="처리-시간-예상-36페이지-pdf" class="level3" data-number="7.6.2">
<h3 data-number="7.6.2" class="anchored" data-anchor-id="처리-시간-예상-36페이지-pdf"><span class="header-section-number">7.6.2</span> 처리 시간 예상 (36페이지 PDF)</h3>
<table class="table">
<thead>
<tr class="header">
<th>단계</th>
<th>시간</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td>문서 추출</td>
<td>2-3초</td>
</tr>
<tr class="even">
<td>텍스트 분할</td>
<td>&lt;1초</td>
</tr>
<tr class="odd">
<td>텍스트 임베딩 (18 청크)</td>
<td>1-2초</td>
</tr>
<tr class="even">
<td>이미지 임베딩 (25 이미지)</td>
<td>4-8초</td>
</tr>
<tr class="odd">
<td>인덱싱</td>
<td>1-2초</td>
</tr>
<tr class="even">
<td><strong>총계</strong></td>
<td><strong>8-16초</strong></td>
</tr>
</tbody>
</table>
</section>
</section>
<section id="쿼리-예제" class="level2" data-number="7.7">
<h2 data-number="7.7" class="anchored" data-anchor-id="쿼리-예제"><span class="header-section-number">7.7</span> 쿼리 예제</h2>
<section id="텍스트-쿼리-하이브리드" class="level3" data-number="7.7.1">
<h3 data-number="7.7.1" class="anchored" data-anchor-id="텍스트-쿼리-하이브리드"><span class="header-section-number">7.7.1</span> 1. 텍스트 쿼리 (하이브리드)</h3>
<div class="sourceCode" id="cb15" style="background: #f1f3f5;"><pre class="sourceCode numberSource http number-lines code-with-copy"><code class="sourceCode"><span id="cb15-1">POST /indexes/doc-extraction-multimodal-embedding-index/docs/search?api-version=2025-11-01-preview</span>
<span id="cb15-2">Content-Type: application/json</span>
<span id="cb15-3"></span>
<span id="cb15-4">{</span>
<span id="cb15-5">  "search": "energy sustainability",</span>
<span id="cb15-6">  "vectorQueries": [</span>
<span id="cb15-7">    {</span>
<span id="cb15-8">      "kind": "text",</span>
<span id="cb15-9">      "text": "energy sustainability",</span>
<span id="cb15-10">      "k": 10,</span>
<span id="cb15-11">      "fields": "content_embedding"</span>
<span id="cb15-12">    }</span>
<span id="cb15-13">  ],</span>
<span id="cb15-14">  "select": "content_id, document_title, content_text, content_path"</span>
<span id="cb15-15">}</span></code></pre></div>
<p><strong>결과</strong>: 텍스트와 이미지 모두 반환 (공유 벡터 공간)</p>
</section>
<section id="이미지만-필터링" class="level3" data-number="7.7.2">
<h3 data-number="7.7.2" class="anchored" data-anchor-id="이미지만-필터링"><span class="header-section-number">7.7.2</span> 2. 이미지만 필터링</h3>
<div class="sourceCode" id="cb16" style="background: #f1f3f5;"><pre class="sourceCode numberSource http number-lines code-with-copy"><code class="sourceCode"><span id="cb16-1">POST /indexes/doc-extraction-multimodal-embedding-index/docs/search?api-version=2025-11-01-preview</span>
<span id="cb16-2">Content-Type: application/json</span>
<span id="cb16-3"></span>
<span id="cb16-4">{</span>
<span id="cb16-5">  "search": "*",</span>
<span id="cb16-6">  "filter": "image_document_id ne null",</span>
<span id="cb16-7">  "select": "content_id, document_title, content_path, location_metadata"</span>
<span id="cb16-8">}</span></code></pre></div>
</section>
<section id="이미지-쿼리-이미지로-검색" class="level3" data-number="7.7.3">
<h3 data-number="7.7.3" class="anchored" data-anchor-id="이미지-쿼리-이미지로-검색"><span class="header-section-number">7.7.3</span> 3. 이미지 쿼리 (이미지로 검색)</h3>
<div class="sourceCode" id="cb17" style="background: #f1f3f5;"><pre class="sourceCode numberSource http number-lines code-with-copy"><code class="sourceCode"><span id="cb17-1">POST /indexes/doc-extraction-multimodal-embedding-index/docs/search?api-version=2025-11-01-preview</span>
<span id="cb17-2">Content-Type: application/json</span>
<span id="cb17-3"></span>
<span id="cb17-4">{</span>
<span id="cb17-5">  "vectorQueries": [</span>
<span id="cb17-6">    {</span>
<span id="cb17-7">      "kind": "image",</span>
<span id="cb17-8">      "image": "{base64-encoded-image}",</span>
<span id="cb17-9">      "k": 5,</span>
<span id="cb17-10">      "fields": "content_embedding"</span>
<span id="cb17-11">    }</span>
<span id="cb17-12">  ]</span>
<span id="cb17-13">}</span></code></pre></div>
<p><strong>작동 원리</strong>: 1. 쿼리 이미지 → Azure Vision 벡터라이저 → 1024차원 벡터 2. 인덱스의 모든 벡터(텍스트+이미지)와 코사인 유사도 계산 3. 상위 k개 결과 반환</p>
</section>
</section>
<section id="주요-특징-정리" class="level2" data-number="7.8">
<h2 data-number="7.8" class="anchored" data-anchor-id="주요-특징-정리"><span class="header-section-number">7.8</span> 주요 특징 정리</h2>
<section id="content_text-필드" class="level3" data-number="7.8.1">
<h3 data-number="7.8.1" class="anchored" data-anchor-id="content_text-필드"><span class="header-section-number">7.8.1</span> Content_text 필드</h3>
<ul>
<li><strong>텍스트 문서</strong>: 추출된 텍스트 청크</li>
<li><strong>이미지 문서</strong>: null (이미지는 벡터로만 표현)</li>
</ul>
</section>
<section id="content_embedding-필드" class="level3" data-number="7.8.2">
<h3 data-number="7.8.2" class="anchored" data-anchor-id="content_embedding-필드"><span class="header-section-number">7.8.2</span> Content_embedding 필드</h3>
<ul>
<li><strong>차원</strong>: 1024</li>
<li><strong>텍스트와 이미지 공유</strong>: 동일한 벡터 공간</li>
<li><strong>유사도 계산</strong>: 텍스트-텍스트, 이미지-이미지, 텍스트-이미지 모두 가능</li>
</ul>
</section>
<section id="content_path-필드" class="level3" data-number="7.8.3">
<h3 data-number="7.8.3" class="anchored" data-anchor-id="content_path-필드"><span class="header-section-number">7.8.3</span> Content_path 필드</h3>
<ul>
<li><strong>텍스트 문서</strong>: null</li>
<li><strong>이미지 문서</strong>: Knowledge Store 이미지 경로</li>
<li><strong>형식</strong>: <code>{container}/{document-id}_{image-index}.jpg</code></li>
</ul>
</section>
<section id="location_metadata-필드" class="level3" data-number="7.8.4">
<h3 data-number="7.8.4" class="anchored" data-anchor-id="location_metadata-필드"><span class="header-section-number">7.8.4</span> Location_metadata 필드</h3>
<ul>
<li><strong>이미지만 해당</strong>: 페이지 번호, 경계 다각형</li>
<li><strong>활용</strong>: RAG 응답에서 이미지 위치 표시, 페이지 강조</li>
</ul>
</section>
</section>
<section id="제약사항-1" class="level2" data-number="7.9">
<h2 data-number="7.9" class="anchored" data-anchor-id="제약사항-1"><span class="header-section-number">7.9</span> 제약사항</h2>
<section id="document-extraction-제약" class="level3" data-number="7.9.1">
<h3 data-number="7.9.1" class="anchored" data-anchor-id="document-extraction-제약"><span class="header-section-number">7.9.1</span> Document Extraction 제약</h3>
<ul>
<li><strong>텍스트 위치 메타데이터 없음</strong>: 텍스트 청크의 페이지 번호 미제공</li>
<li><strong>PDF만 지원</strong>: DOCX, XLSX 등 미지원</li>
<li><strong>해결</strong>: Document Layout Skill 사용 권장</li>
</ul>
</section>
<section id="azure-vision-multimodal-제약" class="level3" data-number="7.9.2">
<h3 data-number="7.9.2" class="anchored" data-anchor-id="azure-vision-multimodal-제약"><span class="header-section-number">7.9.2</span> Azure Vision Multimodal 제약</h3>
<ul>
<li><strong>지역 제한</strong>: Multimodal 4.0 API 지원 지역만 가능</li>
<li><strong>지원 지역</strong>: <a href="https://learn.microsoft.com/ko-kr/azure/ai-services/computer-vision/overview-image-analysis#region-availability">Azure Vision 문서 확인</a></li>
</ul>
</section>
</section>
<section id="비용-분석-36페이지-pdf-예제" class="level2" data-number="7.10">
<h2 data-number="7.10" class="anchored" data-anchor-id="비용-분석-36페이지-pdf-예제"><span class="header-section-number">7.10</span> 비용 분석 (36페이지 PDF 예제)</h2>
<table class="table">
<thead>
<tr class="header">
<th>항목</th>
<th>단가</th>
<th>수량</th>
<th>비용</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td>이미지 추출</td>
<td>$0.001/image</td>
<td>25</td>
<td>$0.025</td>
</tr>
<tr class="even">
<td>텍스트 임베딩</td>
<td>$0.0001/1K char</td>
<td>36K</td>
<td>$0.004</td>
</tr>
<tr class="odd">
<td>이미지 임베딩</td>
<td>$0.002/image</td>
<td>25</td>
<td>$0.050</td>
</tr>
<tr class="even">
<td>인덱싱</td>
<td>포함</td>
<td>-</td>
<td>-</td>
</tr>
<tr class="odd">
<td><strong>총계</strong></td>
<td></td>
<td></td>
<td><strong>$0.079</strong></td>
</tr>
</tbody>
</table>
<p><strong>확장 예측</strong> (1000개 문서): - 1000 × $0.079 = <strong>$79</strong> - 재인덱싱 불필요 (증분 업데이트)</p>
</section>
<section id="샘플-애플리케이션" class="level2" data-number="7.11">
<h2 data-number="7.11" class="anchored" data-anchor-id="샘플-애플리케이션"><span class="header-section-number">7.11</span> 샘플 애플리케이션</h2>
<p><strong><a href="https://aka.ms/azs-multimodal-sample-app-repo">Multimodal RAG GitHub Repository</a></strong> - 텍스트 조각과 이미지 주석을 모두 표시하는 엔드투엔드 RAG 애플리케이션 - 엔터프라이즈 비즈니스 도구 빠른 시작에 이상적 - 데이터 수집 및 인덱싱의 코드 기반 프로세스 예시</p>
</section>
</section>
<section id="핵심-구성-요소-정리" class="level1" data-number="8">
<h1 data-number="8"><span class="header-section-number">8</span> 핵심 구성 요소 정리</h1>
<section id="파이프라인-선택-가이드" class="level2" data-number="8.1">
<h2 data-number="8.1" class="anchored" data-anchor-id="파이프라인-선택-가이드"><span class="header-section-number">8.1</span> 파이프라인 선택 가이드</h2>
<table class="table">
<thead>
<tr class="header">
<th>요구사항</th>
<th>추천 구성</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td>빠른 프로토타이핑, 기본 기능</td>
<td>Document Extraction + 이미지 언어화</td>
</tr>
<tr class="even">
<td>정확한 페이지 참조, 위치 정보 필요</td>
<td>Document Layout + 이미지 언어화</td>
</tr>
<tr class="odd">
<td>시각적 유사성 검색</td>
<td>Document Extraction + 멀티모달 임베딩</td>
</tr>
<tr class="even">
<td>정확한 위치 + 시각적 검색</td>
<td>Document Layout + 멀티모달 임베딩</td>
</tr>
<tr class="odd">
<td>페이지 간 테이블, 의미 청킹</td>
<td>Content Understanding + 적절한 임베딩</td>
</tr>
<tr class="even">
<td>설명적 다이어그램 + 시각 자료 혼합</td>
<td>두 임베딩 방식 병행</td>
</tr>
</tbody>
</table>
</section>
<section id="비용-고려사항" class="level2" data-number="8.2">
<h2 data-number="8.2" class="anchored" data-anchor-id="비용-고려사항"><span class="header-section-number">8.2</span> 비용 고려사항</h2>
<ul>
<li><strong>Document Extraction</strong>: 이미지 추출 시 Azure AI Search 요금 부과</li>
<li><strong>Document Layout</strong>: Document Intelligence Layout 가격 적용</li>
<li><strong>Content Understanding</strong>: Azure Content Understanding 가격 (가장 높음)</li>
<li><strong>GenAI Prompt</strong>: 이미지당 LLM 호출 비용</li>
<li><strong>Azure Vision Multimodal</strong>: 이미지/텍스트 임베딩 API 호출 비용</li>
</ul>
</section>
<section id="성능-특성" class="level2" data-number="8.3">
<h2 data-number="8.3" class="anchored" data-anchor-id="성능-특성"><span class="header-section-number">8.3</span> 성능 특성</h2>
<table class="table">
<thead>
<tr class="header">
<th>단계</th>
<th>평균 처리 시간</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td>이미지 추출</td>
<td>문서당 1-3초</td>
</tr>
<tr class="even">
<td>이미지 언어화 (LLM)</td>
<td>이미지당 2-5초</td>
</tr>
<tr class="odd">
<td>텍스트 임베딩</td>
<td>청크당 50-150ms</td>
</tr>
<tr class="even">
<td>멀티모달 임베딩</td>
<td>이미지당 150-300ms</td>
</tr>
</tbody>
</table>
</section>
</section>
<section id="참고-문서" class="level1" data-number="9">
<h1 data-number="9"><span class="header-section-number">9</span> 참고 문서</h1>
<ul>
<li><a href="https://learn.microsoft.com/ko-kr/azure/search/">Azure AI Search 공식 문서</a></li>
<li><a href="https://learn.microsoft.com/ko-kr/azure/search/retrieval-augmented-generation-overview">RAG (검색 보강 생성) 개요</a></li>
<li><a href="https://learn.microsoft.com/ko-kr/azure/search/hybrid-search-overview">하이브리드 검색 개요</a></li>
<li><a href="https://learn.microsoft.com/ko-kr/azure/search/vector-search-overview">벡터 검색 개요</a></li>
<li><a href="https://learn.microsoft.com/ko-kr/azure/search/semantic-search-overview">의미 순위 개요</a></li>
<li><a href="https://learn.microsoft.com/ko-kr/azure/search/tutorial-document-extraction-multimodal-embeddings">Tutorial - 이미지 및 텍스트 벡터화</a> ’@</li>
</ul>


</section>

 ]]></description>
  <category>Engineering</category>
  <category>Infra</category>
  <category>Cloud</category>
  <category>Azure</category>
  <category>RAG</category>
  <guid>kk3225.netlify.app/docs/blog/posts/Engineering/Infra/Cloud/Azure/31-az-ai-search-classic-multimodal-search.html</guid>
  <pubDate>Thu, 24 Dec 2026 15:00:00 GMT</pubDate>
</item>
<item>
  <title>프롬프트 정성적 평가: 3단계 분석과 루브릭 기반 측정</title>
  <dc:creator>Kwangmin Kim</dc:creator>
  <link>kk3225.netlify.app/docs/blog/posts/Agent/17-Evaluations/18-Prompt-Qualtiy-Control-qualititative.html</link>
  <description><![CDATA[ 





<section id="이-파트의-위치" class="level2" data-number="1">
<h2 data-number="1" class="anchored" data-anchor-id="이-파트의-위치"><span class="header-section-number">1</span> 이 파트의 위치</h2>
<ul>
<li>테스트의 두 축을 정성적과 정량적으로 나누고 정성적 메트릭이 먼저 통과되어야 정량적 메트릭이 의미를 가진다고 가정한다.</li>
<li>그 정성적 축을 실제로 사용하는 것에 대한 논의를 포함하는 내용을 다루어 본다.</li>
<li>정성적 루부릭을 4개의 단계로 구성하는 방법론을 설명한다.
<ul>
<li>정성적 축을 3단계로 구성한다:
<ul>
<li>목적 확인</li>
<li>구조 분석</li>
<li>효율성 평가<br>
</li>
</ul></li>
<li>종합 평가: 이 세 단계를 한 번에 반복할 수 있도록 하는 루브릭을 마지막에 다루어 본다.</li>
</ul></li>
</ul>
</section>
<section id="단계의-필요성" class="level2" data-number="2">
<h2 data-number="2" class="anchored" data-anchor-id="단계의-필요성"><span class="header-section-number">2</span> 3 단계의 필요성</h2>
<ul>
<li>질적 분석을 한 번의 평가로 끝내는 건 가능하지만 평가자의 경험과 감각에 의존한다.
<ul>
<li>“이 프롬프트가 좋은지 나쁜지”를 전체적으로 느끼고 판단하는 주관적인 방법이다.<br>
</li>
<li>문제는 그런 감각이 사람마다 다르다는 것이다.</li>
<li>같은 프롬프트를 두 사람이 보면, 한 사람은 “구조가 이상하다”고, 다른 사람은 “길이가 문제”라고 볼 수 있다.<br>
</li>
<li>둘 다 맞을 수도 있고, 둘 다 핵심을 놓친 것일 수도 있다.<br>
</li>
</ul></li>
<li>질적 분석 평가 단계를 여러 단계로 이런 종류의 불일치를 줄이기 위한 것이다.<br>
</li>
<li>각 단계의 구성 항목도 중요하지만 그 순서도 중요하다.
<ul>
<li>첫 단계는 “이 프롬프트가 무엇을 하려는지”,<br>
</li>
<li>두 번째는 “그 의도를 실현하는 구조가 적절한지”,<br>
</li>
<li>세 번째는 “그 구조가 필요 이상으로 복잡한지 (즉 정규화의 대상인지 평가)”.<br>
</li>
</ul></li>
<li>목적이 불분명하면 구조를 평가할 수 없고, 구조가 확인되지 않으면 효율성을 평가하는 건 의미가 없다.</li>
</ul>
<section id="목적-확인" class="level3" data-number="2.1">
<h3 data-number="2.1" class="anchored" data-anchor-id="목적-확인"><span class="header-section-number">2.1</span> 목적 확인</h3>
<ul>
<li>what to ask: 프롬프트를 읽고, 이 프롬프트가 모델에게 무엇을 요구하는지를 먼저 파악한다.
<ul>
<li>이건 프롬프트를 작성한 사람의 의도를 재구성하는 행위<br>
</li>
<li>작성자가 원했던 것과 프롬프트가 실제로 전달하는 것이 일치하는지를 확인하는 것</li>
</ul></li>
<li>질문 생성기 프롬프트를 한 번 본다.</li>
</ul>
<pre><code>You have a mind, and your role is to generate possible
three questions a user may want to ask next based on User
input: 개발자로 살아남으려면??

The questions must be from the perspective of me,
the user asking you a question.

## Response template
Predicted user question as followed:
  High certainty
  Moderate certainty, yet intriguing
  Low certainty, but strong potential for user engagement

### Ending
Always answer in half speech form of Korean 반말.
Don't be over five words.
Only provide three questions.</code></pre>
<p>목적 확인에서 하는 건 두 가지이다.</p>
<section id="핵심-단어와-구문-추출" class="level4" data-number="2.1.1">
<h4 data-number="2.1.1" class="anchored" data-anchor-id="핵심-단어와-구문-추출"><span class="header-section-number">2.1.1</span> 핵심 단어와 구문 추출</h4>
<p>이 프롬프트에서 모델의 행동을 실제로 결정하는 키워드를 표로 정리한다.</p>
<table class="table">
<colgroup>
<col style="width: 25%">
<col style="width: 18%">
<col style="width: 56%">
</colgroup>
<thead>
<tr class="header">
<th>키워드</th>
<th>역할</th>
<th>빠지면 어떻게 되나?</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td>“generate three questions”</td>
<td>출력 개수 제한</td>
<td>1개 또는 5개 이상 생성 가능</td>
</tr>
<tr class="even">
<td>“based on User input”</td>
<td>입력 맥락 연결</td>
<td>입력 무시하고 일반적 질문 생성</td>
</tr>
<tr class="odd">
<td>“High/Moderate/Low certainty”</td>
<td>질문 각도 구분</td>
<td>3개가 비슷한 각도로 중복</td>
</tr>
<tr class="even">
<td>“half speech form of Korean 반말”</td>
<td>언어 형식</td>
<td>존댓말(“합니까?”) 혼입</td>
</tr>
<tr class="odd">
<td>“five words”</td>
<td>길이 제약</td>
<td>문장 형태로 길어짐 (10단어 이상)</td>
</tr>
<tr class="even">
<td>“Only provide three questions”</td>
<td>출력 정제</td>
<td>설명/주석 추가 (“예를 들어…”)</td>
</tr>
</tbody>
</table>
<p><strong>실제 테스트 예시:</strong></p>
<p><strong>“five words” 제약이 있을 때:</strong></p>
<pre><code>High certainty: 부산 뭐 할까?  (4단어 ✓)
Moderate certainty: 어디 먼저 갈까?  (4단어 ✓)
Low certainty: 혼자 가도 괜찮아?  (4단어 ✓)</code></pre>
<p><strong>“five words” 제약이 없을 때:</strong></p>
<pre><code>High certainty: 부산에서 할 수 있는 재미있는 활동은 뭐가 있을까?  (12단어 ✗)
Moderate certainty: 부산 여행 코스 중에서 어디를 먼저 가는 게 좋을까?  (14단어 ✗)
Low certainty: 부산에 혼자 여행 가도 괜찮을까?  (7단어 ✗)</code></pre>
<p>→ 제약 하나가 출력 형식 전체를 바꾼다.</p>
</section>
<section id="문장-구성-분석-정보-흐름" class="level4" data-number="2.1.2">
<h4 data-number="2.1.2" class="anchored" data-anchor-id="문장-구성-분석-정보-흐름"><span class="header-section-number">2.1.2</span> 문장 구성 분석: 정보 흐름</h4>
<p>프롬프트의 정보 흐름을 3단계로 분해한다.</p>
<p><strong>논리 흐름 구조: 정보의 범위를 단계적으로 구체화 시킨다.</strong></p>
<pre><code>[1단계: 역할 정의] (넓음)
"You have a mind, and your role is to generate..."
→ LLM에게 "누구인지" 알려줌

[2단계: 출력 형태] (중간)
"Response template: High certainty / Moderate certainty / Low certainty"
→ "무엇을 만들지" 구조 제시

[3단계: 형식 제약] (좁음)
"Ending: 반말, 5단어, 3개만"
→ "어떤 형태로" 세부 규칙</code></pre>
<p><strong>논리 흐름 분석 표:</strong></p>
<table class="table">
<thead>
<tr class="header">
<th>단계</th>
<th>역할</th>
<th>정보의 범위</th>
<th>LLM 내부 처리</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td>1</td>
<td>역할 정의</td>
<td>가장 넓음</td>
<td>“질문 생성기구나” 프레임 설정</td>
</tr>
<tr class="even">
<td>2</td>
<td>출력 구조</td>
<td>중간</td>
<td>“3가지 각도로 나눠야지” 계획 수립</td>
</tr>
<tr class="odd">
<td>3</td>
<td>형식 제약</td>
<td>가장 좁음</td>
<td>“반말 5단어로 짧게” 실행 조정</td>
</tr>
</tbody>
</table>
<p><strong>왜 이 순서인가?</strong></p>
<p>일반 → 구체 순서는 LLM이 맥락을 점진적으로 좁히며 생성하는 방식과 일치한다.</p>
<p><strong>순서가 바뀌면:</strong></p>
<pre><code>[잘못된 순서 예시]
1. "반말 5단어로 답하라" (제약 먼저)
2. "질문 생성기다" (역할 나중)
→ LLM은 "뭘 반말로 5단어로?" 혼란</code></pre>
<p><strong>목적 확인 후 수정하면:</strong></p>
<pre><code>개발자 A: "핵심 키워드 표 보니 'five words'가 길이 제약이네."
개발자 B: "그럼 이건 못 지워. 형식 유지 필수."
→ 즉시 판단, 불필요한 실험 방지</code></pre>
<p>목적 확인은 <strong>“이 프롬프트의 어떤 부분이 결과를 결정하는가”</strong>를 먼저 파악하는 단계다.<br>
핵심을 알아야 수정해도 안전하다.</p>
</section>
</section>
<section id="구조-분석" class="level3" data-number="2.2">
<h3 data-number="2.2" class="anchored" data-anchor-id="구조-분석"><span class="header-section-number">2.2</span> 구조 분석</h3>
<ul>
<li>목적이 파악되면, 그 목적을 실현하는 구조가 적절한지를 본다.<br>
</li>
<li>구조를 바꾸고, 결과가 달라지는지 본다.<br>
</li>
<li>변수를 하나만 바꾸고 나머지는 동일하게 유지한다.<br>
</li>
<li>이 실험을 두 번 한다.<br>
</li>
<li>두 번째 실험의 결과가 첫 번째와 달라지는 부분에서 구조 분석이 실제로 무엇을 찾는지가 보인다.</li>
</ul>
<section id="실험-1-question-generator" class="level4" data-number="2.2.1">
<h4 data-number="2.2.1" class="anchored" data-anchor-id="실험-1-question-generator"><span class="header-section-number">2.2.1</span> 실험 1: Question Generator</h4>
<ul>
<li><strong>실험 설계:</strong> 두 버전을 만든다. 텍스트는 한 글자도 바꾸지 않고, 섹션 순서만 변경한다.
<ul>
<li><strong>Type 1 (원본):</strong> Introduction -&gt; Response template (출력 형태) -&gt; Ending (형식 제약)</li>
<li><strong>Type 2 (순서 변경):</strong> Introduction -&gt; Ending (형식 제약) -&gt; Response template (출력 형태)</li>
</ul></li>
<li><strong>테스트 입력:</strong> “부산 여행”
<ul>
<li><strong>Type 1 결과:</strong>
<ul>
<li>High certainty: 부산 뭐 할까?<br>
</li>
<li>Moderate certainty: 어디 먼저 갈까?<br>
</li>
<li>Low certainty: 혼자 가도 괜찮아?<br>
</li>
</ul></li>
<li><strong>Type 2 결과:</strong>
<ul>
<li>High certainty: 부산 뭐 할까?<br>
</li>
<li>Moderate certainty: 어디 먼저 갈까?<br>
</li>
<li>Low certainty: 혼자 가도 괜찮아?<br>
</li>
</ul></li>
</ul></li>
<li><strong>비교결과: 차이 없음</strong></li>
</ul>
<table class="table">
<thead>
<tr class="header">
<th>평가 항목</th>
<th>Type 1</th>
<th>Type 2</th>
<th>차이</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td>질문 개수</td>
<td>3개</td>
<td>3개</td>
<td>없음</td>
</tr>
<tr class="even">
<td>반말 준수</td>
<td>100%</td>
<td>100%</td>
<td>없음</td>
</tr>
<tr class="odd">
<td>각도 다양성</td>
<td>다름</td>
<td>다름</td>
<td>없음</td>
</tr>
<tr class="even">
<td>5단어 제약</td>
<td>준수</td>
<td>준수</td>
<td>없음</td>
</tr>
<tr class="odd">
<td>출력 형식</td>
<td>카테고리 구분</td>
<td>카테고리 구분</td>
<td>없음</td>
</tr>
</tbody>
</table>
<ul>
<li><strong>왜 차이가 없는가?</strong>: Response template과 Ending이 <strong>독립적인 역할</strong>을 하기 때문이다.</li>
</ul>
<table class="table">
<thead>
<tr class="header">
<th>섹션</th>
<th>역할</th>
<th>다른 섹션과의 의존성</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td>Response template</td>
<td>출력 구조 정의 (High/Moderate/Low)</td>
<td>독립적</td>
</tr>
<tr class="even">
<td>Ending</td>
<td>형식 제약 (반말, 5단어, 3개만)</td>
<td>독립적</td>
</tr>
</tbody>
</table>
<ul>
<li><strong>LLM 내부 처리 (추정):</strong></li>
</ul>
<pre><code>Type 1 읽기 순서:
1. Introduction → "질문 생성기구나"
2. Response template → "3가지 카테고리로 나눠야지"
3. Ending → "반말 5단어로 제약하자"

Type 2 읽기 순서:
1. Introduction → "질문 생성기구나"
2. Ending → "반말 5단어로 제약하자"
3. Response template → "3가지 카테고리로 나눠야지"</code></pre>
<ul>
<li>실험 발견
<ul>
<li>두 경우 모두 <strong>동일한 정보</strong>를 얻으므로, 순서와 무관하게 같은 결과를 생성한다.<br>
</li>
<li>이 프롬프트는 <strong>섹션 순서에 민감하지 않다</strong>.<br>
</li>
<li>각 섹션이 독립적으로 작동하기 때문에, 순서를 바꿔도 안전하다.</li>
</ul></li>
</ul>
</section>
<section id="실험-2-번역-task" class="level4" data-number="2.2.2">
<h4 data-number="2.2.2" class="anchored" data-anchor-id="실험-2-번역-task"><span class="header-section-number">2.2.2</span> 실험 2: 번역 Task</h4>
<ul>
<li><strong>실험 설계:</strong> David에게 한국어를 가르치는 튜터 프롬프트다. “한국어로 번역해줘” 문장의 위치만 변경한다.</li>
<li><strong>Type 1 (지시문 마지막):</strong></li>
</ul>
<pre><code>0. Please list out all the target words at first.
1. Use beginner-level Korean language. For instructions, please also
   provide a set of English instructions in parentheses after
   the Korean instructions.
2. Encourage David to speak more than you do.
3. Provide feedback on grammar, help apply new concepts,
   and expand vocabulary.
4. Adapt your teaching style based on David's responses
   and progress.
5. Use Korean for target vocabulary and example sentences.
   Use English for explanations and instructions.

한국어로 번역해줘.</code></pre>
<ul>
<li><strong>Type 2 (지시문 맨 앞):</strong></li>
</ul>
<pre><code>한국어로 번역해줘

0. Please list out all the target words at first.
1. Use beginner-level Korean language. For instructions, please also
   provide a set of English instructions in parentheses after
   the Korean instructions.
2. Encourage David to speak more than you do.
3. Provide feedback on grammar, help apply new concepts,
   and expand vocabulary.
4. Adapt your teaching style based on David's responses
   and progress.
5. Use Korean for target vocabulary and example sentences.
   Use English for explanations and instructions.</code></pre>
<p><strong>테스트 입력:</strong> 영어 텍스트 5개 문단 * <strong>Type 1 결과:</strong></p>
<pre><code>[튜터 모드로 작동]
- 규칙 0-5를 따름
- 초급 한국어 사용
- 영어 설명 병기
- David의 학습 격려
- 마지막에 "전체를 한국어로 번역해줄까?" 질문 추가</code></pre>
<ul>
<li><strong>Type 2 결과:</strong></li>
</ul>
<pre><code>[번역 모드로 작동]
- 규칙 0-5를 "번역할 때의 규칙"으로 해석
- 전체 텍스트를 초급 한국어로 번역
- 튜터 역할보다 번역 작업에 집중
- David 학습 격려 없음</code></pre>
<p><strong>비교 표:</strong></p>
<table class="table">
<thead>
<tr class="header">
<th>평가 항목</th>
<th>Type 1 (마지막)</th>
<th>Type 2 (맨 앞)</th>
<th>차이</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td>주요 역할</td>
<td>튜터</td>
<td>번역기</td>
<td><strong>있음</strong></td>
</tr>
<tr class="even">
<td>규칙 해석</td>
<td>튜터의 교육 방식</td>
<td>번역 시 제약조건</td>
<td><strong>있음</strong></td>
</tr>
<tr class="odd">
<td>David 격려</td>
<td>✓ 있음</td>
<td>✗ 없음</td>
<td><strong>있음</strong></td>
</tr>
<tr class="even">
<td>영어 설명 병기</td>
<td>✓ 있음</td>
<td>△ 일부만</td>
<td><strong>있음</strong></td>
</tr>
<tr class="odd">
<td>작업 초점</td>
<td>학습 대화</td>
<td>텍스트 번역</td>
<td><strong>있음</strong></td>
</tr>
</tbody>
</table>
<ul>
<li><strong>실험결과: 차이 있음</strong>
<ul>
<li><strong>차이 발생 이유</strong> :“한국어로 번역해줘”는 단순 지시문이 아니라 <strong>전체 맥락의 프레임</strong>을 결정하는 문장이다.<br>
</li>
</ul></li>
<li><strong>LLM 내부 처리 (추정):</strong></li>
</ul>
<pre><code>Type 1 읽기 순서:
1. 규칙 0-5 → "튜터 역할 규칙들이구나"
2. "한국어로 번역해줘" → "이 규칙들을 한국어로 설명해야겠네"
→ 프레임: "한국어 튜터"

Type 2 읽기 순서:
1. "한국어로 번역해줘" → "번역 작업이구나"
2. 규칙 0-5 → "번역할 때 이 규칙들을 적용해야겠네"
→ 프레임: "규칙 기반의 한국어 번역기"</code></pre>
<p><strong>프레이밍 효과:</strong></p>
<table class="table">
<thead>
<tr class="header">
<th>위치</th>
<th>프레임 설정</th>
<th>이후 규칙 해석</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td>맨 앞</td>
<td>번역 작업</td>
<td>규칙 = 번역 제약조건</td>
</tr>
<tr class="even">
<td>맨 뒤</td>
<td>튜터 역할</td>
<td>규칙 = 교육 방식, 번역은 부가 요청</td>
</tr>
</tbody>
</table>
<p><strong>실험 후 발견:</strong></p>
<ul>
<li>이 프롬프트는 <strong>섹션 순서에 매우 민감하다</strong>.<br>
</li>
<li>“한국어로 번역해줘”가 <strong>전체 맥락을 프레이밍</strong>하기 때문에, 위치가 달라지면 모든 규칙의 의미가 바뀐다.</li>
</ul>
</section>
<section id="두-예시-prompt의-대조" class="level4" data-number="2.2.3">
<h4 data-number="2.2.3" class="anchored" data-anchor-id="두-예시-prompt의-대조"><span class="header-section-number">2.2.3</span> 두 예시 Prompt의 대조</h4>
<table class="table">
<thead>
<tr class="header">
<th>비교 항목</th>
<th>Question Generation Prompt</th>
<th>번역 Task Prompt</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td>섹션 관계</td>
<td>독립적</td>
<td>의존적 (프레이밍)</td>
</tr>
<tr class="even">
<td>순서 변경 결과</td>
<td>차이 없음</td>
<td>차이 있음</td>
</tr>
<tr class="odd">
<td>핵심 발견</td>
<td>섹션 역할이 분리됨</td>
<td>한 문장이 전체 맥락 결정</td>
</tr>
<tr class="even">
<td>구조 안정성</td>
<td>높음 (순서 바꿔도 안전)</td>
<td>낮음 (순서 중요)</td>
</tr>
</tbody>
</table>
<ul>
<li><strong>구조 분석이 찾는 것:</strong> 모든 프롬프트가 구조 순서에 같은 방식으로 반응하지 않는다.</li>
<li><strong>독립적 섹션 (예시 1 패턴):</strong>
<ul>
<li>각 섹션이 다른 역할 담당<br>
</li>
<li>순서와 무관하게 안정적<br>
</li>
<li>수정 시 위험 낮음<br>
</li>
</ul></li>
<li><strong>프레이밍 섹션 (예시 2 패턴):</strong>
<ul>
<li>한 문장/섹션이 전체 맥락 결정<br>
</li>
<li>위치가 달라지면 의미 바뀜<br>
</li>
<li>수정 시 신중해야 함<br>
</li>
</ul></li>
<li><strong>구조 분석의 필요성</strong>
<ul>
<li>이 프롬프트에서 어떤 부분이 전체를 프레이밍하는 문장인지 확인<br>
</li>
<li>그 부분의 위치가 결과를 바꾸는 변수이고, 그 외의 부분은 순서가 달라져도 괜찮을 수 있다.<br>
</li>
<li>한 번은 “차이 없음”, 한 번은 “차이 있음”. 둘을 비교해야 왜 결과가 달라지는지가 깊이 보인다.</li>
<li>구조 분석 없이 섹션 순서 변경 시 발생할 수 있는 문제 예시:</li>
</ul>
<pre><code>개발자: "Ending을 앞으로 옮기자. 더 읽기 쉬울 것 같아."
→ 실험 1 패턴: 문제 없음
→ 실험 2 패턴: 전체 의미 바뀜

3일 후: "왜 결과가 이상해졌지?"
→ 원인 파악에 2일 추가 소요</code></pre>
<ul>
<li><strong>구조 분석 후 수정하면:</strong></li>
</ul>
<pre><code>개발자: "구조 실험 결과, 이 프롬프트는 순서 민감형이네."
PM: "그럼 섹션 위치 변경은 위험해. 다른 방법 찾자."
→ 안전한 수정 방향 즉시 선택</code></pre></li>
<li>구조 분석은 <strong>“이 프롬프트에서 어떤 부분이 전체 성능을 결정하는가”</strong>를 찾는 단계다.<br>
</li>
<li>프레이밍 문장을 찾으면, 그 부분은 건드리지 않고 다른 부분만 최적화할 수 있다.</li>
<li>변경된 건 단 하나이다. “한국어로 번역해줘”라는 문장이 아래에서 위로 올라온 것.</li>
<li>나머지 텍스트는 한 글자도 바뀌지 않는다.</li>
<li>결과: 차이 있음. 왜인지를 본다.
<ul>
<li>실험 1과 달라지는 점이 바로 여기에 있다.<br>
</li>
<li>“한국어로 번역해줘”는 단순한 지시문이 아니다.<br>
</li>
<li>이 문장은 프롬프트 전체의 맥락을 프레이밍하는 문장이다.<br>
</li>
<li>이것이 먼저 오면, 모델은 “번역 작업이다”라는 프레임 안에서 이후 규칙들을 읽는다.<br>
</li>
<li>이것이 뒤에 오면, 모델은 먼저 튜터 규칙들을 일반적인 지시사항으로 읽고, 그 후에 번역이라는 작업이 추가된다.<br>
</li>
<li>모델이 규칙들을 “번역의 규칙”으로 읽는지, 아니면 “튜터의 규칙”으로 읽는지가 달라진다.</li>
</ul></li>
</ul>
</section>
</section>
<section id="효율성-평가" class="level3" data-number="2.3">
<h3 data-number="2.3" class="anchored" data-anchor-id="효율성-평가"><span class="header-section-number">2.3</span> 효율성 평가</h3>
<ul>
<li>구조의 복잡성 평가<br>
</li>
<li>효율성 평가 기준: <strong>“프롬프트의 불필요한 정보의 유무”</strong> 그리고 <strong>“컨텍스트 풍부함 정도”</strong></li>
<li>확인 방법: 프롬프트를 줄여서, 결과가 유지되는지 본다.</li>
</ul>
<section id="원본-vs-간단-버전-비교" class="level4" data-number="2.3.1">
<h4 data-number="2.3.1" class="anchored" data-anchor-id="원본-vs-간단-버전-비교"><span class="header-section-number">2.3.1</span> 원본 vs 간단 버전 비교</h4>
<p><strong>원본 프롬프트 (Full Version):</strong></p>
<pre><code>You have a mind, and your role is to generate possible
three questions a user may want to ask next based on User
input: 개발자로 살아남으려면??

The questions must be from the perspective of me,
the user asking you a question.

## Response template
Predicted user question as followed:
  High certainty
  Moderate certainty, yet intriguing
  Low certainty, but strong potential for user engagement

### Ending
Always answer in half speech form of Korean 반말.
Don't be over five words.
Only provide three questions.</code></pre>
<p><strong>간단 버전 (Minimal Version):</strong></p>
<pre><code>Please generate three questions based on
User input: 개발자로 살아남으려면? in Korean. Be short.</code></pre>
<p><strong>차이점 요약:</strong></p>
<table class="table">
<thead>
<tr class="header">
<th>요소</th>
<th>원본</th>
<th>간단 버전</th>
<th>제거됨</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td>역할 정의</td>
<td>“You have a mind, your role is…”</td>
<td>없음</td>
<td>✓</td>
</tr>
<tr class="even">
<td>관점 지정</td>
<td>“from the perspective of me, the user”</td>
<td>없음</td>
<td>✓</td>
</tr>
<tr class="odd">
<td>카테고리 구조</td>
<td>High/Moderate/Low certainty</td>
<td>없음</td>
<td>✓</td>
</tr>
<tr class="even">
<td>반말 지정</td>
<td>“half speech form of Korean 반말”</td>
<td>“in Korean”</td>
<td>✓</td>
</tr>
<tr class="odd">
<td>길이 제약</td>
<td>“Don’t be over five words”</td>
<td>“Be short”</td>
<td>△</td>
</tr>
<tr class="even">
<td>개수 제약</td>
<td>“Only provide three questions”</td>
<td>“three questions”</td>
<td>✓</td>
</tr>
</tbody>
</table>
</section>
<section id="테스트-결과-비교" class="level4" data-number="2.3.2">
<h4 data-number="2.3.2" class="anchored" data-anchor-id="테스트-결과-비교"><span class="header-section-number">2.3.2</span> 테스트 결과 비교</h4>
<p><strong>테스트 입력 5개:</strong><br>
1. “부산 여행”<br>
2. “주식 투자”<br>
3. “헬스 다이어트”<br>
4. “강아지 훈련”<br>
5. “영어 공부”</p>
<p><strong>결과 비교 표:</strong></p>
<table class="table">
<colgroup>
<col style="width: 15%">
<col style="width: 25%">
<col style="width: 35%">
<col style="width: 25%">
</colgroup>
<thead>
<tr class="header">
<th>입력</th>
<th>원본 결과</th>
<th>간단 버전 결과</th>
<th>차이 분석</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td>부산 여행</td>
<td>High: 부산 뭐 할까?<br>Mod: 어디 먼저 갈까?<br>Low: 혼자 가도 괜찮아?</td>
<td>1. 부산에서 뭐 먹을까요?<br>2. 숙소 어디가 좋아요?<br>3. 언제 가는 게 좋을까요?</td>
<td>✗ 존댓말 혼입<br>✗ 6-7단어<br>✓ 각도 다름</td>
</tr>
<tr class="even">
<td>주식 투자</td>
<td>High: 주식 어떻게 시작해?<br>Mod: 어떤 종목 살까?<br>Low: 지금 사도 괜찮아?</td>
<td>1. 어떤 주식이 좋을까요?<br>2. 주식 시작 방법 알려주세요<br>3. 안전한 투자 방법은?</td>
<td>✗ 존댓말 혼입<br>✗ 5-7단어<br>△ 각도 약함</td>
</tr>
<tr class="odd">
<td>헬스 다이어트</td>
<td>High: 헬스 언제 해?<br>Mod: 뭐 먹어야 해?<br>Low: 얼마나 걸릴까?</td>
<td>1. 헬스 어떻게 시작하나요?<br>2. 식단은 어떻게 해요?<br>3. 운동 시간은?</td>
<td>✗ 존댓말 혼입<br>✓ 4-6단어<br>✓ 각도 다름</td>
</tr>
<tr class="even">
<td>강아지 훈련</td>
<td>High: 강아지 훈련 뭐부터?<br>Mod: 배변 어떻게 가르쳐?<br>Low: 훈련사 부를까?</td>
<td>1. 강아지 훈련 방법은?<br>2. 언제 시작해야 하나요?<br>3. 비용은 얼마나?</td>
<td>△ 반말/존댓말 혼합<br>✓ 4-6단어<br>✓ 각도 다름</td>
</tr>
<tr class="odd">
<td>영어 공부</td>
<td>High: 영어 어떻게 공부해?<br>Mod: 어디서 배울까?<br>Low: 독학 가능해?</td>
<td>1. 영어 공부 방법?<br>2. 학원 vs 독학?<br>3. 얼마나 걸려요?</td>
<td>△ 반말/존댓말 혼합<br>✓ 3-5단어<br>✓ 각도 다름</td>
</tr>
</tbody>
</table>
<p><strong>통계 요약:</strong></p>
<table class="table">
<thead>
<tr class="header">
<th>평가 기준</th>
<th>원본 성공률</th>
<th>간단 버전 성공률</th>
<th>차이</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td>반말 준수</td>
<td>100% (5/5)</td>
<td>20% (1/5)</td>
<td><strong>-80%p</strong></td>
</tr>
<tr class="even">
<td>5단어 이내</td>
<td>100% (5/5)</td>
<td>60% (3/5)</td>
<td><strong>-40%p</strong></td>
</tr>
<tr class="odd">
<td>각도 다양성</td>
<td>100% (5/5)</td>
<td>80% (4/5)</td>
<td>-20%p</td>
</tr>
<tr class="even">
<td>카테고리 구분</td>
<td>100% (5/5)</td>
<td>0% (0/5)</td>
<td><strong>-100%p</strong></td>
</tr>
<tr class="odd">
<td>3개 질문</td>
<td>100% (5/5)</td>
<td>100% (5/5)</td>
<td>0%p</td>
</tr>
</tbody>
</table>
</section>
<section id="발견-어떤-부분이-꼭-필요한가" class="level4" data-number="2.3.3">
<h4 data-number="2.3.3" class="anchored" data-anchor-id="발견-어떤-부분이-꼭-필요한가"><span class="header-section-number">2.3.3</span> 발견: 어떤 부분이 꼭 필요한가?</h4>
<p><strong>제거했을 때 문제 발생한 요소:</strong></p>
<table class="table">
<thead>
<tr class="header">
<th>제거된 요소</th>
<th>영향</th>
<th>문제 발생률</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td>“반말” 명시</td>
<td>존댓말 혼입</td>
<td>80% (4/5)</td>
</tr>
<tr class="even">
<td>“5단어” 제약</td>
<td>질문 길어짐</td>
<td>40% (2/5)</td>
</tr>
<tr class="odd">
<td><strong>카테고리 구조</strong></td>
<td>High/Mod/Low 구분 사라짐</td>
<td>100% (5/5)</td>
</tr>
<tr class="even">
<td>역할 정의</td>
<td>큰 영향 없음</td>
<td>0% (0/5)</td>
</tr>
</tbody>
</table>
<p><strong>제거해도 괜찮은 요소:</strong></p>
<table class="table">
<thead>
<tr class="header">
<th>요소</th>
<th>이유</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td>“You have a mind”</td>
<td>역할은 “question generator”로 충분</td>
</tr>
<tr class="even">
<td>“from the perspective of me”</td>
<td>맥락상 자명함</td>
</tr>
</tbody>
</table>
<p><strong>최적화된 버전 제안:</strong></p>
<p>간단 버전과 원본의 중간 형태로, 핵심만 남긴다.</p>
<pre><code>Generate three questions based on user input in Korean.

User input: 개발자로 살아남으려면?

Format:
High certainty: [question]
Moderate certainty: [question]
Low certainty: [question]

Rules:
- Use 반말 (casual Korean)
- Max 5 words per question
- Three different angles</code></pre>
<p><strong>최적화 버전 테스트 결과:</strong></p>
<table class="table">
<thead>
<tr class="header">
<th>평가 기준</th>
<th>최적화 버전 성공률</th>
<th>원본 대비</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td>반말 준수</td>
<td>100% (5/5)</td>
<td>동일</td>
</tr>
<tr class="even">
<td>5단어 이내</td>
<td>100% (5/5)</td>
<td>동일</td>
</tr>
<tr class="odd">
<td>각도 다양성</td>
<td>100% (5/5)</td>
<td>동일</td>
</tr>
<tr class="even">
<td>카테고리 구분</td>
<td>100% (5/5)</td>
<td>동일</td>
</tr>
<tr class="odd">
<td><strong>토큰 수</strong></td>
<td><strong>약 60 토큰</strong></td>
<td><strong>-40% 절약</strong></td>
</tr>
</tbody>
</table>
</section>
<section id="효율성-vs-명확성-트레이드오프" class="level4" data-number="2.3.4">
<h4 data-number="2.3.4" class="anchored" data-anchor-id="효율성-vs-명확성-트레이드오프"><span class="header-section-number">2.3.4</span> 효율성 vs 명확성 트레이드오프</h4>
<table class="table">
<colgroup>
<col style="width: 20%">
<col style="width: 20%">
<col style="width: 20%">
<col style="width: 37%">
</colgroup>
<thead>
<tr class="header">
<th>길이</th>
<th>장점</th>
<th>단점</th>
<th>적합한 경우</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td>긴 프롬프트 (원본)</td>
<td>명확한 지시<br>오해 방지</td>
<td>토큰 비용 높음<br>읽기 부담</td>
<td>복잡한 작업<br>정확성 중요</td>
</tr>
<tr class="even">
<td>중간 (최적화)</td>
<td>핵심만 전달<br>비용 절감</td>
<td>적절한 밸런스</td>
<td><strong>대부분 권장</strong></td>
</tr>
<tr class="odd">
<td>짧은 (간단)</td>
<td>매우 저렴<br>빠른 실행</td>
<td>형식 불안정<br>결과 예측 어려움</td>
<td>간단한 작업<br>형식 덜 중요</td>
</tr>
</tbody>
</table>
<p><strong>왜 프롬프트 효율성 평가가 중요한가?</strong></p>
<p><strong>효율성 평가 없이 프롬프트 사용하면:</strong></p>
<pre><code>개발자: "프롬프트 작동 잘 되네. 배포하자."
→ 일 평균 10만 회 호출
→ 월 토큰 비용: $1,200

3개월 후 리뷰:
PM: "프롬프트 비용이 너무 높아요. 줄일 수 없나요?"
개발자: "음... 어떤 부분을 줄여야 안전한지 모르겠는데..."
→ 2주 테스트, 실패 3번, 결국 40% 절감 성공
→ 3개월간 불필요하게 $1,440 낭비</code></pre>
<p><strong>효율성 평가 후 배포하면:</strong></p>
<pre><code>개발자: "테스트 결과, 40% 줄여도 성능 동일."
PM: "좋아요. 최적화 버전으로 배포."
→ 월 토큰 비용: $720
→ 연간 $5,760 절약

추가 이점:
- 응답 속도 15% 개선
- API 호출 타임아웃 감소</code></pre>
<p>효율성 평가는 <strong>“이 프롬프트의 어떤 부분이 실제로 기여하는가”</strong>를 찾는 단계다.<br>
군더더기를 제거하면, 비용 절감과 성능 유지를 동시에 달성한다.</p>
</section>
</section>
</section>
<section id="루브릭-3-단계를-반복" class="level2" data-number="3">
<h2 data-number="3" class="anchored" data-anchor-id="루브릭-3-단계를-반복"><span class="header-section-number">3</span> 루브릭: 3 단계를 반복</h2>
<ul>
<li>세 단계(목적 확인, 구조 분석, 효율성 평가)를 체계적으로 반복할 수 있는 평가 기준을 정리<br>
</li>
<li>세 단계를 직접 해본 후에 루브릭을 봐야, 각 항목의 필요성과 당위성이 명확해진다.</li>
</ul>
<section id="정성적-평가-루브릭-5점-scale" class="level3" data-number="3.1">
<h3 data-number="3.1" class="anchored" data-anchor-id="정성적-평가-루브릭-5점-scale"><span class="header-section-number">3.1</span> 정성적 평가 루브릭 (5점 Scale)</h3>
<section id="목적-확인-purpose-clarity" class="level4" data-number="3.1.1">
<h4 data-number="3.1.1" class="anchored" data-anchor-id="목적-확인-purpose-clarity"><span class="header-section-number">3.1.1</span> 목적 확인 (Purpose Clarity)</h4>
<table class="table">
<colgroup>
<col style="width: 27%">
<col style="width: 45%">
<col style="width: 27%">
</colgroup>
<thead>
<tr class="header">
<th>점수</th>
<th>평가 기준</th>
<th>예시</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td>5점</td>
<td>핵심 키워드 명확, 정보 흐름 논리적, 역할-구조-제약 순서 완벽</td>
<td>질문 생성기 원본 프롬프트</td>
</tr>
<tr class="even">
<td>4점</td>
<td>핵심 키워드 있음, 흐름 대체로 논리적, 순서 약간 어색</td>
<td>역할 정의 없지만 나머지 명확</td>
</tr>
<tr class="odd">
<td>3점</td>
<td>키워드 일부 모호, 흐름 이해 가능하나 최적 아님</td>
<td>“짧게 답해”만 있고 구체적 제약 없음</td>
</tr>
<tr class="even">
<td>2점</td>
<td>키워드 불명확, 흐름 뒤죽박죽, 의도 파악 어려움</td>
<td>제약조건이 역할 앞에 옴</td>
</tr>
<tr class="odd">
<td>1점</td>
<td>키워드 없음, 의도 전혀 알 수 없음</td>
<td>“뭔가 생성해줘” 수준</td>
</tr>
</tbody>
</table>
</section>
<section id="구조-분석-structure-robustness" class="level4" data-number="3.1.2">
<h4 data-number="3.1.2" class="anchored" data-anchor-id="구조-분석-structure-robustness"><span class="header-section-number">3.1.2</span> 구조 분석 (Structure Robustness)</h4>
<table class="table">
<colgroup>
<col style="width: 27%">
<col style="width: 45%">
<col style="width: 27%">
</colgroup>
<thead>
<tr class="header">
<th>점수</th>
<th>평가 기준</th>
<th>예시</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td>5점</td>
<td>섹션 독립적, 순서 변경해도 안정적, 프레이밍 문장 없음</td>
<td>Question Generator (실험 1)</td>
</tr>
<tr class="even">
<td>4점</td>
<td>대부분 독립적, 1-2개 섹션만 순서 민감</td>
<td>일부 제약조건이 순서 의존</td>
</tr>
<tr class="odd">
<td>3점</td>
<td>일부 섹션 의존적, 순서 바뀌면 결과 약간 달라짐</td>
<td>출력 형식과 제약이 약하게 연결됨</td>
</tr>
<tr class="even">
<td>2점</td>
<td>섹션 강하게 의존적, 순서 중요, 프레이밍 문장 있음</td>
<td>번역 Task (실험 2)</td>
</tr>
<tr class="odd">
<td>1점</td>
<td>모든 섹션 의존적, 순서 조금만 바뀌어도 무너짐</td>
<td>복잡한 다단계 프롬프트</td>
</tr>
</tbody>
</table>
</section>
<section id="효율성-평가-efficiency" class="level4" data-number="3.1.3">
<h4 data-number="3.1.3" class="anchored" data-anchor-id="효율성-평가-efficiency"><span class="header-section-number">3.1.3</span> 효율성 평가 (Efficiency)</h4>
<table class="table">
<colgroup>
<col style="width: 27%">
<col style="width: 45%">
<col style="width: 27%">
</colgroup>
<thead>
<tr class="header">
<th>점수</th>
<th>평가 기준</th>
<th>예시</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td>5점</td>
<td>최소한의 길이로 100% 성능, 불필요한 부분 없음</td>
<td>최적화 버전 (60 토큰)</td>
</tr>
<tr class="even">
<td>4점</td>
<td>약간 긴 편이나 대부분 필요, 10-20% 줄일 수 있음</td>
<td>원본에서 역할 정의만 제거</td>
</tr>
<tr class="odd">
<td>3점</td>
<td>불필요한 부분 30-40%, 줄여도 성능 유지</td>
<td>원본 프롬프트 (100 토큰)</td>
</tr>
<tr class="even">
<td>2점</td>
<td>절반이 군더더기, 50% 이상 줄일 수 있음</td>
<td>과도한 예시와 설명 포함</td>
</tr>
<tr class="odd">
<td>1점</td>
<td>대부분 불필요, 핵심만 남기면 80% 절약 가능</td>
<td>간단 버전으로도 충분한 경우</td>
</tr>
</tbody>
</table>
</section>
</section>
<section id="루브릭-점수-측정-방법" class="level3" data-number="3.2">
<h3 data-number="3.2" class="anchored" data-anchor-id="루브릭-점수-측정-방법"><span class="header-section-number">3.2</span> 루브릭 점수 측정 방법</h3>
<ul>
<li>3가지 방법이 있고, 상황에 따라 선택한다</li>
</ul>
<section id="사람이-측정-manual-evaluation" class="level4" data-number="3.2.1">
<h4 data-number="3.2.1" class="anchored" data-anchor-id="사람이-측정-manual-evaluation"><span class="header-section-number">3.2.1</span> 사람이 측정 (Manual Evaluation)</h4>
<p>프로게스:<br>
1. 평가자가 프롬프트를 읽는다<br>
2. 3단계(목적 확인, 구조 분석, 효율성 평가)를 직접 수행한다<br>
3. 각 단계별로 루브릭 기준과 비교하여 점수를 매긴다<br>
4. 점수 근거를 기록한다</p>
<p><strong>실제 평가 시나리오:</strong></p>
<pre><code>평가자 A (시니어 개발자):

[목적 확인 단계]
1. 프롬프트 읽기 → 핵심 키워드 표 작성
   - "generate three questions" ✓
   - "반말" ✓
   - "5 words" ✓
2. 정보 흐름 확인 → 역할→구조→제약 순서 ✓
3. 루브릭 비교 → 5점 기준 모두 충족
→ 목적 확인: 5점

[구조 분석 단계]
1. 섹션 순서 변경 실험 (Type 1 vs Type 2)
2. 결과 비교 → 차이 없음
3. 루브릭 비교 → "섹션 독립적, 순서 변경해도 안정적"
→ 구조 분석: 5점

[효율성 평가 단계]
1. 간단 버전 테스트 → 형식 80% 무너짐
2. 토큰 수 계산 → 100 토큰, 40% 줄일 수 있음
3. 루브릭 비교 → "불필요한 부분 30-40%"
→ 효율성: 3점

총점: 13/15점
소요 시간: 약 30분</code></pre>
<ul>
<li><strong>장점:</strong>
<ul>
<li>도메인 지식 반영 가능<br>
</li>
<li>미묘한 뉘앙스 파악<br>
</li>
<li>특수한 상황 고려<br>
</li>
</ul></li>
<li><strong>단점:</strong>
<ul>
<li>시간 많이 소요 (프롬프트당 30분)<br>
</li>
<li>평가자 간 평가기준이 비일관적 (평가 결과 불일치 가능성 높음)<br>
</li>
<li>확장성 낮음 (100개 프롬프트 = 50시간)<br>
</li>
<li>비용 높음 (평가자 인건비)</li>
</ul></li>
<li><strong>적합한 경우:</strong>
<ul>
<li>중요한 프로덕션 프롬프트<br>
</li>
<li>초기 프로토타입 단계<br>
</li>
<li>팀 내 루브릭 캘리브레이션</li>
</ul></li>
</ul>
</section>
<section id="llm이-측정-automated-evaluation" class="level4" data-number="3.2.2">
<h4 data-number="3.2.2" class="anchored" data-anchor-id="llm이-측정-automated-evaluation"><span class="header-section-number">3.2.2</span> LLM이 측정 (Automated Evaluation)</h4>
<p><strong>프로세스:</strong><br>
1. 메타 프롬프트 작성 (루브릭을 LLM에게 전달)<br>
2. 평가 대상 프롬프트를 입력<br>
3. LLM이 3단계 평가 수행 + 점수 산출<br>
4. 점수와 근거를 JSON으로 반환</p>
<p><strong>메타 프롬프트 예시:</strong></p>
<pre><code>You are a prompt evaluation expert. Evaluate the following prompt 
using this rubric:

## Rubric

### Purpose Clarity (5 points)
- 5: Clear keywords, logical flow, perfect role-structure-constraint order
- 4: Keywords present, mostly logical flow, slightly awkward order
- 3: Some keywords ambiguous, flow understandable but not optimal
- 2: Unclear keywords, chaotic flow, hard to understand intent
- 1: No keywords, intent completely unclear

### Structure Robustness (5 points)
- 5: Independent sections, stable with order changes, no framing sentences
- 4: Mostly independent, 1-2 sections order-sensitive
- 3: Some sections dependent, results change slightly with order
- 2: Strongly dependent sections, order critical, framing sentences present
- 1: All sections dependent, breaks easily with order changes

### Efficiency (5 points)
- 5: Minimal length with 100% performance, no unnecessary parts
- 4: Slightly long but mostly necessary, 10-20% reducible
- 3: 30-40% unnecessary, performance maintained when reduced
- 2: Half is filler, 50%+ reducible
- 1: Mostly unnecessary, 80% savings possible with core only

## Prompt to Evaluate

[평가 대상 프롬프트 삽입]

## Output Format

Return JSON:
{
  "purpose_clarity": {
    "score": &lt;1-5&gt;,
    "reasoning": "&lt;이유&gt;"
  },
  "structure_robustness": {
    "score": &lt;1-5&gt;,
    "reasoning": "&lt;이유&gt;"
  },
  "efficiency": {
    "score": &lt;1-5&gt;,
    "reasoning": "&lt;이유&gt;"
  },
  "total_score": &lt;3-15&gt;,
  "summary": "&lt;종합 평가&gt;"
}</code></pre>
<p><strong>LLM 평가 결과 예시:</strong></p>
<div class="sourceCode" id="cb22" style="background: #f1f3f5;"><pre class="sourceCode numberSource json number-lines code-with-copy"><code class="sourceCode json"><span id="cb22-1"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">{</span></span>
<span id="cb22-2">  <span class="dt" style="color: #AD0000;
background-color: null;
font-style: inherit;">"purpose_clarity"</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">:</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">{</span></span>
<span id="cb22-3">    <span class="dt" style="color: #AD0000;
background-color: null;
font-style: inherit;">"score"</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">:</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">5</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">,</span></span>
<span id="cb22-4">    <span class="dt" style="color: #AD0000;
background-color: null;
font-style: inherit;">"reasoning"</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">:</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"핵심 키워드 명확 ('generate three questions', '반말', 'five words'). 역할→구조→제약 흐름 완벽."</span></span>
<span id="cb22-5">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">},</span></span>
<span id="cb22-6">  <span class="dt" style="color: #AD0000;
background-color: null;
font-style: inherit;">"structure_robustness"</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">:</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">{</span></span>
<span id="cb22-7">    <span class="dt" style="color: #AD0000;
background-color: null;
font-style: inherit;">"score"</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">:</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">5</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">,</span></span>
<span id="cb22-8">    <span class="dt" style="color: #AD0000;
background-color: null;
font-style: inherit;">"reasoning"</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">:</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Response template과 Ending 섹션이 독립적. 순서 변경 실험 결과 차이 없음."</span></span>
<span id="cb22-9">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">},</span></span>
<span id="cb22-10">  <span class="dt" style="color: #AD0000;
background-color: null;
font-style: inherit;">"efficiency"</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">:</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">{</span></span>
<span id="cb22-11">    <span class="dt" style="color: #AD0000;
background-color: null;
font-style: inherit;">"score"</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">:</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">3</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">,</span></span>
<span id="cb22-12">    <span class="dt" style="color: #AD0000;
background-color: null;
font-style: inherit;">"reasoning"</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">:</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"100 토큰 중 약 40 토큰 줄일 수 있음 ('You have a mind', 'from the perspective' 불필요)."</span></span>
<span id="cb22-13">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">},</span></span>
<span id="cb22-14">  <span class="dt" style="color: #AD0000;
background-color: null;
font-style: inherit;">"total_score"</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">:</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">13</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">,</span></span>
<span id="cb22-15">  <span class="dt" style="color: #AD0000;
background-color: null;
font-style: inherit;">"summary"</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">:</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"명확하고 구조적으로 안정적이나, 일부 불필요한 표현 제거 시 40% 효율 개선 가능."</span></span>
<span id="cb22-16"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">}</span></span></code></pre></div>
<p><strong>장점:</strong><br>
- 빠름 (프롬프트당 10초)<br>
- 확장성 높음 (1000개도 가능)<br>
- 일관성 있음 (같은 프롬프트 → 같은 점수)<br>
- 비용 저렴 (평가당 $0.01)<br>
<strong>단점:</strong><br>
- 도메인 지식 제한적<br>
- 실제 테스트 없이 추론만으로 평가<br>
- 복잡한 프롬프트 오판 가능<br>
- LLM 자체의 한계 (예: 토큰 수 정확히 세지 못함)<br>
<strong>적합한 경우:</strong><br>
- 대량 프롬프트 평가 (100개 이상)<br>
- 빠른 스크리닝 필요<br>
- 지속적 모니터링 (CI/CD 파이프라인)</p>
</section>
<section id="하이브리드-human-llm" class="level4" data-number="3.2.3">
<h4 data-number="3.2.3" class="anchored" data-anchor-id="하이브리드-human-llm"><span class="header-section-number">3.2.3</span> 하이브리드 (Human + LLM)</h4>
<p><strong>프로세스:</strong><br>
1. <strong>1차: LLM 자동 평가</strong> (스크리닝)<br>
- 전체 프롬프트를 LLM이 평가<br>
- 낮은 점수 (≤10점) 필터링<br>
2. <strong>2차: 사람 수동 평가</strong> (정밀 검증)<br>
- 높은 점수 프롬프트만 사람이 재평가<br>
- LLM 평가와 비교하여 최종 결정<br>
3. <strong>피드백 루프</strong><br>
- 사람의 평가 결과를 메타 프롬프트에 반영<br>
- LLM 평가 정확도 지속 개선</p>
<p><strong>실무 적용 사례:</strong></p>
<pre><code>시나리오: 50개 프롬프트 평가 필요

[1단계: LLM 스크리닝 (10분)]
- 50개 프롬프트 → LLM 자동 평가
- 결과: 15개 ≤10점, 35개 &gt;10점

[2단계: 사람 정밀 평가 (3시간)]
- 35개 고득점 프롬프트만 사람이 재평가
- 결과: 5개는 LLM 오판 (실제 7-8점)
         30개는 LLM 평가 정확

[3단계: 최종 선정]
- 30개 검증된 프롬프트 중 상위 10개 선정
- 5개 오판 프롬프트는 개선 대상으로 분류

총 시간: 3.2시간
순수 사람 평가 시: 25시간 (50개 × 30분)
→ 87% 시간 절약</code></pre>
<p><strong>장단점 비교:</strong></p>
<table class="table">
<thead>
<tr class="header">
<th>방법</th>
<th>속도</th>
<th>정확도</th>
<th>비용</th>
<th>확장성</th>
<th>적합한 규모</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td>사람</td>
<td>느림</td>
<td>높음</td>
<td>높음</td>
<td>낮음</td>
<td>1-10개</td>
</tr>
<tr class="even">
<td>LLM</td>
<td>빠름</td>
<td>중간</td>
<td>낮음</td>
<td>높음</td>
<td>100개 이상</td>
</tr>
<tr class="odd">
<td>하이브리드</td>
<td>중간</td>
<td>높음</td>
<td>중간</td>
<td>중간</td>
<td>10-100개</td>
</tr>
</tbody>
</table>
<p><strong>왜 하이브리드가 현실적인가?</strong> * <strong>순수 사람 평가의 문제:</strong> 고차원 평가 but 너무 느리고 비용 높음</p>
<pre><code>PM: "50개 프롬프트 평가해주세요."
개발자: "하나에 30분이면... 25시간이요?"
PM: "3일 걸리네요. 더 빠른 방법 없나요?"</code></pre>
<ul>
<li><strong>순수 LLM 평가의 문제:</strong> 빠르고 저렴 but 신뢰도 및 전문성 문제</li>
</ul>
<pre><code>LLM 평가: "이 프롬프트 14점입니다."
개발자: "실제 테스트하니 7점 수준인데..."
PM: "LLM이 토큰 수도 제대로 못 세네요."
→ 신뢰도 문제</code></pre>
<ul>
<li><strong>하이브리드 적용 시:</strong></li>
</ul>
<pre><code>LLM: "50개 중 35개가 10점 이상입니다."
개발자: "35개만 직접 확인하면 되겠네요."
PM: "3시간이면 충분하겠어요. 시작하죠."
→ 효율 + 정확도 균형</code></pre>
</section>
</section>
<section id="루브릭-점수-신뢰도-높이는-방법" class="level3" data-number="3.3">
<h3 data-number="3.3" class="anchored" data-anchor-id="루브릭-점수-신뢰도-높이는-방법"><span class="header-section-number">3.3</span> 루브릭 점수 신뢰도 높이는 방법</h3>
<section id="복수-평가자-inter-rater-reliability" class="level4" data-number="3.3.1">
<h4 data-number="3.3.1" class="anchored" data-anchor-id="복수-평가자-inter-rater-reliability"><span class="header-section-number">3.3.1</span> 복수 평가자 (Inter-Rater Reliability)</h4>
<pre><code>3명의 평가자가 동일 프롬프트 평가:

평가자 A: 목적 5점, 구조 5점, 효율 3점 → 총 13점
평가자 B: 목적 4점, 구조 5점, 효율 3점 → 총 12점
평가자 C: 목적 5점, 구조 4점, 효율 3점 → 총 12점

평균: 12.3점
표준편차: 0.58 (낮음 → 신뢰도 높음)</code></pre>
</section>
<section id="캘리브레이션-세션" class="level4" data-number="3.3.2">
<h4 data-number="3.3.2" class="anchored" data-anchor-id="캘리브레이션-세션"><span class="header-section-number">3.3.2</span> 캘리브레이션 세션</h4>
<ul>
<li><strong>목표:</strong> 팀원 간 평가 기준 통일<br>
</li>
<li><strong>시나리오:</strong> 팀원 4명이 동일 프롬프트를 평가<br>
</li>
<li><strong>평가 대상 프롬프트 (고객 문의 응답 생성기):</strong></li>
</ul>
<pre><code>You are a customer service agent. Generate a helpful response 
to the customer's question.

Customer question: 배송이 늦어지고 있어요. 언제 도착하나요?

Guidelines:
- Be polite and empathetic
- Provide actionable information
- Keep response under 100 words</code></pre>
<p><strong>1차 평가 결과 (기준 통일 전):</strong></p>
<table class="table">
<thead>
<tr class="header">
<th>평가자</th>
<th>목적</th>
<th>구조</th>
<th>효율성</th>
<th>총점</th>
<th>효율성 평가 이유</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td>A (시니어)</td>
<td>4</td>
<td>5</td>
<td>4</td>
<td>13</td>
<td>“100 단어 제약이 있어서 최적화됨”</td>
</tr>
<tr class="even">
<td>B (주니어)</td>
<td>3</td>
<td>3</td>
<td>4</td>
<td>10</td>
<td>“길이 제약 명확해서 효율적”</td>
</tr>
<tr class="odd">
<td>C (PM)</td>
<td>5</td>
<td>4</td>
<td>5</td>
<td>14</td>
<td>“매우 짧고 핵심만 있음”</td>
</tr>
<tr class="even">
<td>D (QA)</td>
<td>3</td>
<td>3</td>
<td>3</td>
<td>9</td>
<td>“가이드라인을 더 줄일 수 있을 것 같음”</td>
</tr>
</tbody>
</table>
<ul>
<li><strong>표준편차: 2.16 (높음)</strong> → 평가 기준 불일치<br>
</li>
<li><strong>토론 세션을 갖는다 예를 들어 1시간</strong><br>
</li>
<li><strong>1단계: 차이점 발견</strong></li>
</ul>
<pre><code>팀 리드: "같은 프롬프트인데 9점부터 14점까지 나왔네요. 
         왜 이렇게 차이가 날까요?"

평가자 C: "저는 이 프롬프트가 매우 효율적이라고 봤어요. 
          딱 필요한 것만 있잖아요."

평가자 D: "저는 가이드라인 3개가 너무 일반적이라고 생각했어요. 
          'Be polite'는 customer service agent 역할에 이미 포함된 거 아닌가요?"

평가자 A: "아, 저도 그 부분은 생각 못 했네요. 
          저는 '100 words' 제약이 있어서 4점 줬어요."</code></pre>
<p><strong>2단계: 효율성 3점 기준 혼란 확인</strong></p>
<pre><code>팀 리드: "특히 효율성 점수가 3, 4, 4, 5로 다 다르네요. 
         각자 어떤 기준으로 매겼나요?"

평가자 A: "저는 토큰 수를 봤어요. 약 40 토큰이고, 
          역할 정의를 조금 줄이면 10-20% 절약 → 4점"

평가자 B: "저는... 솔직히 느낌이었어요. 
          '길이 제약이 있으니까 효율적이겠지' → 4점"

평가자 C: "저는 원본이 이미 최소한이라고 봤어요. 
          더 줄이면 의미가 손상될 것 같아서 → 5점"

평가자 D: "저는 간단 버전을 상상해봤어요. 
          'Generate polite response under 100 words'만으로도 될 것 같아서 
          30% 이상 줄일 수 있다 → 3점"</code></pre>
<p><strong>문제 발견:</strong> 각자 다른 방법으로 효율성을 평가함<br>
- A: 토큰 수 계산 (정량적)<br>
- B: 직관적 느낌 (주관적)<br>
- C: 의미 손상 가능성 (보수적)<br>
- D: 간단 버전 상상 (실험 없음)</p>
<p><strong>3단계: 기준 합의</strong></p>
<pre><code>팀 리드: "루브릭을 다시 보죠."

[효율성 3점 기준]
- 불필요한 부분 30-40%
- 줄여도 성능 유지

팀 리드: "'불필요한 부분 30-40%'를 어떻게 판단할까요?"

평가자 D: "직접 테스트해야 할 것 같아요. 
          간단 버전 만들어서 실제로 돌려보고 비교해야죠."

평가자 A: "동의합니다. 그럼 절차를 정의하죠.

[합의된 효율성 평가 절차]
1. 간단 버전 작성 (핵심만 남김)
2. 5개 입력으로 원본 vs 간단 버전 테스트
3. 성공률 비교:
   - 원본 100% vs 간단 60-80% → 3점
   - 원본 100% vs 간단 80-90% → 4점
   - 원본 100% vs 간단 90-100% → 5점
4. 토큰 수 비교:
   - 30-40% 감소 → 3점 기준 확인
   - 10-20% 감소 → 4점 기준 확인

평가자 C: "좋아요. 이제 명확하네요."</code></pre>
<p><strong>4단계: 실제 테스트 (합의된 절차 적용)</strong></p>
<p><strong>간단 버전 작성:</strong></p>
<pre><code>Customer service agent. Answer customer questions 
politely under 100 words.

Question: 배송이 늦어지고 있어요. 언제 도착하나요?</code></pre>
<p><strong>5개 테스트 입력:</strong></p>
<table class="table">
<colgroup>
<col style="width: 16%">
<col style="width: 27%">
<col style="width: 38%">
<col style="width: 16%">
</colgroup>
<thead>
<tr class="header">
<th>입력</th>
<th>원본 결과</th>
<th>간단 버전 결과</th>
<th>평가</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td>“환불 어떻게 해요?”</td>
<td>공감 표현 + 절차 안내 + 100단어 이내 ✓</td>
<td>절차만 안내, 공감 표현 약함</td>
<td>△</td>
</tr>
<tr class="even">
<td>“배송 추적이 안 돼요”</td>
<td>공감 + 해결책 + 간결 ✓</td>
<td>해결책만, 너무 짧음</td>
<td>△</td>
</tr>
<tr class="odd">
<td>“불량품이에요”</td>
<td>사과 + 교환 절차 + 적절한 길이 ✓</td>
<td>교환 절차만, 사과 없음</td>
<td>✗</td>
</tr>
<tr class="even">
<td>“할인 쿠폰 사용법”</td>
<td>친절한 안내 + 단계별 설명 ✓</td>
<td>단계만 나열, 불친절</td>
<td>△</td>
</tr>
<tr class="odd">
<td>“계정 비밀번호 찾기”</td>
<td>안내 + 보안 주의사항 ✓</td>
<td>안내만, 보안 주의 없음</td>
<td>✗</td>
</tr>
</tbody>
</table>
<p><strong>결과:</strong> - 원본: 5/5 성공 (100%) - 간단 버전: 1/5 성공 (20%) - 공감/사과 표현 부족, 보안 주의사항 누락</p>
<p><strong>토큰 수:</strong> - 원본: 40 토큰 - 간단 버전: 20 토큰 (50% 감소)</p>
<p><strong>5단계: 재평가 (기준 통일 후)</strong></p>
<pre><code>평가자 A: "테스트 결과, 간단 버전은 20% 성공률이네요. 
          가이드라인이 실제로 필요했어요. 효율성 5점으로 수정합니다."

평가자 B: "저도 5점입니다. 각 가이드라인이 다 의미가 있었네요."

평가자 C: "5점 유지. 제 평가가 맞았네요."

평가자 D: "제가 틀렸네요. 'Be polite'가 없으니 공감 표현이 사라졌어요. 
          5점으로 수정합니다."</code></pre>
<p><strong>2차 평가 결과 (기준 통일 후):</strong></p>
<table class="table">
<colgroup>
<col style="width: 16%">
<col style="width: 12%">
<col style="width: 12%">
<col style="width: 16%">
<col style="width: 12%">
<col style="width: 32%">
</colgroup>
<thead>
<tr class="header">
<th>평가자</th>
<th>목적</th>
<th>구조</th>
<th>효율성</th>
<th>총점</th>
<th>효율성 평가 이유</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td>A (시니어)</td>
<td>4</td>
<td>5</td>
<td>5</td>
<td>14</td>
<td>“테스트 결과 간단 버전 20% 성공 → 원본 최적”</td>
</tr>
<tr class="even">
<td>B (주니어)</td>
<td>4</td>
<td>4</td>
<td>5</td>
<td>13</td>
<td>“가이드라인 제거 시 품질 저하 확인”</td>
</tr>
<tr class="odd">
<td>C (PM)</td>
<td>5</td>
<td>4</td>
<td>5</td>
<td>14</td>
<td>“원본 평가 유지, 테스트로 검증됨”</td>
</tr>
<tr class="even">
<td>D (QA)</td>
<td>4</td>
<td>4</td>
<td>5</td>
<td>13</td>
<td>“가이드라인이 실제로 필요했음을 확인”</td>
</tr>
</tbody>
</table>
<p><strong>표준편차: 0.5 (낮음)</strong> → 신뢰도 향상</p>
<p><strong>캘리브레이션 효과:</strong></p>
<table class="table">
<thead>
<tr class="header">
<th>지표</th>
<th>1차 평가</th>
<th>2차 평가</th>
<th>개선</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td>평균 점수</td>
<td>11.5점</td>
<td>13.5점</td>
<td>+2점</td>
</tr>
<tr class="even">
<td>표준편차</td>
<td>2.16</td>
<td>0.5</td>
<td>-77%</td>
</tr>
<tr class="odd">
<td>최대-최소 차이</td>
<td>5점</td>
<td>1점</td>
<td>-80%</td>
</tr>
<tr class="even">
<td>평가 소요 시간</td>
<td>15분/명</td>
<td>25분/명</td>
<td>+67% (but 신뢰도↑)</td>
</tr>
</tbody>
</table>
<p><strong>핵심 교훈:</strong></p>
<pre><code>팀 리드: "이제 다음 프롬프트부터는 다들 같은 기준으로 평가하겠네요."

평가자 D: "특히 '실제 테스트'가 중요하다는 걸 배웠어요. 
          상상만으로는 안 되네요."

평가자 B: "저도요. 이제 평가할 때 간단 버전 만들어서 
          꼭 테스트해보겠습니다."

평가자 A: "캘리브레이션 세션이 1시간 걸렸지만, 
          앞으로 100개 프롬프트 평가할 때 시간 절약될 거예요."</code></pre>
<p><strong>캘리브레이션 후 팀 표준 문서:</strong></p>
<div class="sourceCode" id="cb35" style="background: #f1f3f5;"><pre class="sourceCode numberSource markdown number-lines code-with-copy"><code class="sourceCode markdown"><span id="cb35-1"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;"># 효율성 평가 표준 절차 (ver 1.0)</span></span>
<span id="cb35-2"></span>
<span id="cb35-3"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">## 3점 판단 기준</span></span>
<span id="cb35-4"><span class="ss" style="color: #20794D;
background-color: null;
font-style: inherit;">1. </span>간단 버전 작성 (제거할 요소 선택)</span>
<span id="cb35-5"><span class="ss" style="color: #20794D;
background-color: null;
font-style: inherit;">2. </span>5개 입력 테스트 (다양한 상황)</span>
<span id="cb35-6"><span class="ss" style="color: #20794D;
background-color: null;
font-style: inherit;">3. </span>성공률 측정:</span>
<span id="cb35-7"><span class="ss" style="color: #20794D;
background-color: null;
font-style: inherit;">   - </span>60-80% → 3점 (원본에 불필요한 부분 있음)</span>
<span id="cb35-8"><span class="ss" style="color: #20794D;
background-color: null;
font-style: inherit;">   - </span>80-90% → 4점 (약간 최적화 가능)</span>
<span id="cb35-9"><span class="ss" style="color: #20794D;
background-color: null;
font-style: inherit;">   - </span>90-100% → 5점 (이미 최적)</span>
<span id="cb35-10"><span class="ss" style="color: #20794D;
background-color: null;
font-style: inherit;">4. </span>토큰 수 확인 (보조 지표)</span>
<span id="cb35-11"><span class="ss" style="color: #20794D;
background-color: null;
font-style: inherit;">5. </span>평가 근거 기록 (재현 가능하도록)</span>
<span id="cb35-12"></span>
<span id="cb35-13"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">## 주의사항</span></span>
<span id="cb35-14"><span class="ss" style="color: #20794D;
background-color: null;
font-style: inherit;">- </span>직관만으로 판단 금지</span>
<span id="cb35-15"><span class="ss" style="color: #20794D;
background-color: null;
font-style: inherit;">- </span>반드시 실제 테스트 수행</span>
<span id="cb35-16"><span class="ss" style="color: #20794D;
background-color: null;
font-style: inherit;">- </span>팀원과 평가 결과 공유</span></code></pre></div>
</section>
<section id="평가-가이드-문서화" class="level4" data-number="3.3.3">
<h4 data-number="3.3.3" class="anchored" data-anchor-id="평가-가이드-문서화"><span class="header-section-number">3.3.3</span> 평가 가이드 문서화</h4>
<pre><code>효율성 3점 판단 기준 (상세화):

1. 간단 버전 작성 (핵심만 남김)
2. 5개 입력으로 테스트
3. 성공률 비교:
   - 원본 100% vs 간단 버전 60-80% → 3점
   - 원본 100% vs 간단 버전 80-90% → 4점
   - 원본 100% vs 간단 버전 &lt;60% → 2점
4. 토큰 수 감소율:
   - 30-40% 감소 가능 → 3점
   - 10-20% 감소 가능 → 4점
   - 50%+ 감소 가능 → 2점</code></pre>
</section>
</section>
<section id="질문-생성기-프롬프트-평가-예시" class="level3" data-number="3.4">
<h3 data-number="3.4" class="anchored" data-anchor-id="질문-생성기-프롬프트-평가-예시"><span class="header-section-number">3.4</span> 질문 생성기 프롬프트 평가 예시</h3>
<p>위 루브릭으로 3가지 버전을 평가한다.</p>
<p><strong>평가 결과 표:</strong></p>
<table class="table">
<thead>
<tr class="header">
<th>버전</th>
<th>목적 확인</th>
<th>구조 분석</th>
<th>효율성 평가</th>
<th>총점</th>
<th>비고</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td>원본 (Full)</td>
<td>5점</td>
<td>5점</td>
<td>3점</td>
<td>13/15</td>
<td>명확하고 안정적, 다소 김</td>
</tr>
<tr class="even">
<td>간단 (Minimal)</td>
<td>2점</td>
<td>4점</td>
<td>5점</td>
<td>11/15</td>
<td>짧지만 형식 불안정</td>
</tr>
<tr class="odd">
<td>최적화 (Optimized)</td>
<td>5점</td>
<td>5점</td>
<td>5점</td>
<td><strong>15/15</strong></td>
<td>이상적 균형</td>
</tr>
</tbody>
</table>
<p><strong>세부 평가 근거:</strong></p>
<p><strong>원본 버전:</strong> - 목적 확인 5점: 핵심 키워드 완벽, 역할→구조→제약 흐름 논리적 - 구조 분석 5점: Response template과 Ending 독립적, 순서 변경 안전 - 효율성 3점: 100 토큰 중 40% 줄일 수 있음 (역할 정의, 관점 지정 불필요)</p>
<p><strong>간단 버전:</strong> - 목적 확인 2점: “Be short”만으로 제약 불명확, 카테고리 구조 없음 - 구조 분석 4점: 짧아서 섹션 의존성 낮음, 하지만 형식 제어 약함 - 효율성 5점: 20 토큰으로 최소화, 더 줄일 곳 없음</p>
<p><strong>최적화 버전:</strong> - 목적 확인 5점: 핵심만 남김, 명확한 규칙, 논리적 흐름 - 구조 분석 5점: 섹션 독립적, 안정적 구조 - 효율성 5점: 60 토큰으로 성능 100% 유지, 이상적 길이</p>
</section>
<section id="루브릭-사용-워크플로우" class="level3" data-number="3.5">
<h3 data-number="3.5" class="anchored" data-anchor-id="루브릭-사용-워크플로우"><span class="header-section-number">3.5</span> 루브릭 사용 워크플로우</h3>
<p><strong>프롬프트 작성 → 테스트 → 루브릭 평가 → 개선 → 재평가</strong></p>
<p><strong>실무 적용 시나리오:</strong></p>
<pre><code>Day 1: 새 프롬프트 작성
       → 루브릭 자가 평가: 목적 4점, 구조 3점, 효율성 2점

Day 2: 구조 개선 (프레이밍 문장 위치 조정)
       → 재평가: 목적 4점, 구조 5점, 효율성 2점

Day 3: 효율성 개선 (불필요한 예시 제거)
       → 재평가: 목적 4점, 구조 5점, 효율성 4점

Day 4: 목적 개선 (핵심 키워드 명확화)
       → 최종 평가: 목적 5점, 구조 5점, 효율성 4점
       → 총 14/15점, 배포 승인</code></pre>
<p><strong>팀 리뷰 시나리오:</strong></p>
<pre><code>개발자 A: "제 프롬프트 리뷰 부탁드립니다."

개발자 B (루브릭 적용):
- 목적 확인: 4점 (키워드는 있는데 흐름이 약간 어색해요)
- 구조 분석: 3점 (Ending을 앞으로 옮기면 어떨까요? 실험해보세요)
- 효율성: 2점 (예시가 너무 많아요. 1개면 충분할 것 같습니다)

개발자 A: "구체적 피드백 감사합니다. 바로 수정하겠습니다."
→ 주관적 "좋아요/별로에요" 대신 객관적 점수와 개선 방향 제시</code></pre>
</section>
<section id="왜-루브릭이-중요한가" class="level3" data-number="3.6">
<h3 data-number="3.6" class="anchored" data-anchor-id="왜-루브릭이-중요한가"><span class="header-section-number">3.6</span> 왜 루브릭이 중요한가?</h3>
<p><strong>루브릭 없이 평가하면:</strong></p>
<pre><code>팀원 A: "이 프롬프트 어때요?"
팀원 B: "음... 괜찮은 것 같은데요?"
팀원 C: "저는 좀 긴 것 같아요."
팀원 D: "뭐가 긴데요? 저는 적당한데..."
→ 1시간 토론, 결론 없음</code></pre>
<p><strong>루브릭으로 평가하면:</strong></p>
<pre><code>팀원 A: "루브릭 평가 결과 공유합니다."
        목적 5점, 구조 4점, 효율성 3점

팀원 B: "효율성 3점이네요. 어떤 부분을 줄일까요?"
팀원 C: "역할 정의 부분이 불필요해 보입니다."
팀원 D: "동의합니다. 제거 후 재테스트하죠."
→ 10분 논의, 즉시 개선 방향 결정</code></pre>
<p>루브릭은 <strong>주관적 느낌을 객관적 점수</strong>로 바꿔준다.<br>
“좋다/나쁘다” → “어떤 부분이 몇 점이고, 왜 그런지”로 구체화된다.</p>
</section>
<section id="루브릭의-한계와-보완" class="level3" data-number="3.7">
<h3 data-number="3.7" class="anchored" data-anchor-id="루브릭의-한계와-보완"><span class="header-section-number">3.7</span> 루브릭의 한계와 보완</h3>
<p><strong>루브릭이 완벽하지 않은 경우:</strong></p>
<table class="table">
<colgroup>
<col style="width: 27%">
<col style="width: 27%">
<col style="width: 45%">
</colgroup>
<thead>
<tr class="header">
<th>상황</th>
<th>문제</th>
<th>해결 방법</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td>도메인 특수성</td>
<td>일반 루브릭으로 측정 어려움</td>
<td>도메인별 추가 기준 마련</td>
</tr>
<tr class="even">
<td>평가자 숙련도</td>
<td>초보자는 점수 매기기 어려움</td>
<td>예시 기반 가이드 제공</td>
</tr>
<tr class="odd">
<td>복잡한 프롬프트</td>
<td>다단계 프롬프트 평가 한계</td>
<td>단계별로 분리 평가</td>
</tr>
</tbody>
</table>
<p><strong>보완 방법:</strong></p>
<ol type="1">
<li><strong>예시 라이브러리</strong>: 각 점수대별 실제 프롬프트 예시 축적</li>
<li><strong>팀 캘리브레이션</strong>: 같은 프롬프트를 함께 평가하며 기준 통일</li>
<li><strong>정량적 검증</strong>: 루브릭 점수와 실제 성능 지표 상관관계 확인</li>
</ol>
</section>
</section>
<section id="결론" class="level2" data-number="4">
<h2 data-number="4" class="anchored" data-anchor-id="결론"><span class="header-section-number">4</span> 결론</h2>
<ul>
<li>앞서, 정성적과 정량적 방식으로 프롬프트의 품질을 평가한다는 것을 살펴보았다.</li>
<li>이번 블로그에서는 그 중 <strong>정성적 축을 실제로 사용</strong>한다: “이 프롬프트가 의도대로 작동하는지”를 세 단계(목적 확인, 구조 분석, 효율성 평가)로 본다.</li>
<li>그리고 그 세 단계를 <strong>루브릭으로 정리</strong>하여 반복 평가할 수 있게 만든다.<br>
</li>
<li>이후 다른 축, 즉 <strong>“얼마나 안정적으로 작동하는지”</strong>(정량적 평가)를 다룬다.</li>
</ul>


</section>

 ]]></description>
  <category>AI</category>
  <category>Prompt Engineering</category>
  <category>Testing</category>
  <guid>kk3225.netlify.app/docs/blog/posts/Agent/17-Evaluations/18-Prompt-Qualtiy-Control-qualititative.html</guid>
  <pubDate>Wed, 04 Feb 2026 15:00:00 GMT</pubDate>
</item>
<item>
  <title>프롬프트 테스트 실전 가이드: 7단계 업무 절차와 평가 방법론</title>
  <dc:creator>Kwangmin Kim</dc:creator>
  <link>kk3225.netlify.app/docs/blog/posts/Agent/17-Evaluations/17-Prompt-Qualtiy-Control-testMethod.html</link>
  <description><![CDATA[ 





<section id="들어가며" class="level2" data-number="1">
<h2 data-number="1" class="anchored" data-anchor-id="들어가며"><span class="header-section-number">1</span> 들어가며</h2>
<ul>
<li>실제로 테스트를 어떤 순서로 진행하고,</li>
<li>어떤 종류의 방법을 사용하는지를 다룬다.</li>
</ul>
<p>그리고 이 다음 블로그에 사용할 테스트 도구까지 소개한다. 즉, 이론에서 실행으로의 전환점이다.</p>
</section>
<section id="단계-업무절차" class="level2" data-number="2">
<h2 data-number="2" class="anchored" data-anchor-id="단계-업무절차"><span class="header-section-number">2</span> 7단계 업무절차</h2>
<p>실제 업무에서 프롬프트 테스트를 수행할 때의 흐름을 작성한 것이다.</p>
<pre><code>1단계: 테스트 기준 마련 (주관적 논쟁을 객관적 판단으로 전환)
2단계: 프롬프트 품질 분석
3단계: 테스트 결과 정리 (Type 1 vs Type 2 비교)
4단계: 최종 프롬프트 선별 (성공률 60% vs 80% 데이터 기반 선택과 검증 로직 보완)
5단계: 사용자 피드백 및 이슈 관리 (베타 테스트 20명, 10가지 실제 입력)
6단계: 프롬프트 언어 분석 (영어/한국어 조합 3가지 테스트)
7단계: 지속적인 결과 개선 (3개월 주기 개선 사이클)</code></pre>
<p>각 단계를 설명하기 위해 <strong>질문 생성기 프롬프트</strong>를 일관된 예시로 사용한다.</p>
<p><strong>질문 생성기란?</strong></p>
<p>사용자가 주제를 입력하면(예: “부산 여행”), 3가지 각도의 질문을 반말로 생성하는 프롬프트다.</p>
<p><strong>Certainty 관점 3가지 질문 유형:</strong> - certainty: “확신의 정도”를 나타내며, 질문의 일반성과 개인적 불확실성 정도를 구분하는 개념<br>
- <strong>High certainty</strong>: 확신 높은 질문 - 일반적이고 누구나 궁금해할 내용 (예: “부산에서 뭐 할까?”)<br>
- <strong>Moderate certainty</strong>: 중간 확신 질문 - 특정 상황이나 맥락이 필요한 내용 (예: “어디 먼저 갈까?”)<br>
- <strong>Low certainty</strong>: 낮은 확신 질문 - 불확실하거나 개인차가 큰 내용 (예: “혼자 가도 괜찮아?”)</p>
<p>각 질문은 <strong>서로 다른 각도</strong>에서 접근하며, <strong>반말 형식</strong>(5단어 이내)으로 생성된다.</p>
<section id="테스트-기준-마련" class="level3" data-number="2.1">
<h3 data-number="2.1" class="anchored" data-anchor-id="테스트-기준-마련"><span class="header-section-number">2.1</span> 테스트 기준 마련</h3>
<ul>
<li>테스트 기준: “좋은 프롬프트”를 어떻게 판단할 것인가?<br>
</li>
<li><strong>“기대 결과”</strong>를 구체화하는 단계다.<br>
</li>
<li>기준이 없으면 테스트 결과를 봐도 “성공인지 실패인지” 판단할 수 없다.</li>
</ul>
<p><strong>질문 생성기 (프롬프트) 예시:</strong></p>
<p>프롬프트 목적: 사용자가 “부산 여행”을 입력하면, 3가지 각도의 질문을 반말로 생성</p>
<p><strong>구체적 기준 목록:</strong></p>
<ul>
<li>기준 1: 항상 정확히 3개의 질문 반환 (2개도, 4개도 안 됨)</li>
<li>기준 2: High/Moderate/Low certainty 섹션 명확히 구분</li>
<li>기준 3: 세 질문은 서로 다른 각도 (중복 불가)</li>
<li>기준 4: 반말만 사용 (“합니다” 체 금지)</li>
<li>기준 5: 각 질문은 5단어 이내</li>
<li>기준 6: 질문 외 주석/설명 없음 (“예를 들어…” 같은 부연 금지)</li>
</ul>
<p><strong>실제 테스트 결과 예시:</strong></p>
<p>입력: “부산 여행”</p>
<p><strong>프롬프트 A 출력:</strong></p>
<pre><code>High certainty: 부산 여행 언제 가?
Moderate certainty: 어떤 코스로 갈까?
Low certainty: 혼자 가도 괜찮을까?</code></pre>
<p><strong>평가:</strong> - ✓ 기준 1: 3개 (Pass) - ✓ 기준 2: 섹션 구분 (Pass) - ✓ 기준 3: 서로 다른 각도 (Pass) - ✓ 기준 4: 반말 (Pass) - ✗ 기준 5: “어떤 코스로 갈까?”는 6단어 (Fail) - ✓ 기준 6: 질문만 출력 (Pass)</p>
<p><strong>결과: Fail</strong> (기준 5 미달)</p>
<p><strong>왜 이 단계가 중요한가?</strong></p>
<p><strong>기준이 없을 때:</strong></p>
<pre><code>팀원 A: "이 프롬프트 괜찮은데요?"
팀원 B: "아니 질문이 너무 긴 것 같은데..."
팀원 C: "뭐가 길다는 거에요? 저는 이 정도면 적당한 것 같은데?"
→ 3시간 토론, 결론 없음</code></pre>
<p><strong>기준이 있을 때:</strong></p>
<pre><code>팀원 A: "기준 5 위반했어요. 5단어 초과."
팀원 B: "맞네요. 수정 필요."
→ 5분 종료, 즉시 개선 착수</code></pre>
<p>객관적 기준이 <strong>주관적 논쟁을 객관적 판단</strong>으로 바꿔준다.</p>
</section>
<section id="프롬프트-품질-분석" class="level3" data-number="2.2">
<h3 data-number="2.2" class="anchored" data-anchor-id="프롬프트-품질-분석"><span class="header-section-number">2.2</span> 프롬프트 품질 분석</h3>
<ul>
<li>실제로 실행하기 전에, 프롬프트 자체를 먼저 검토한다.</li>
<li>“이 프롬프트가 작동할 가능성이 높은가?”를 미리 판단하는 단계다.<br>
</li>
<li>테스트하기 전에 명확한 결함을 먼저 발견하면, 테스트 시간을 절약할 수 있다.</li>
</ul>
<p><strong>질문 생성기 프롬프트 예시:</strong></p>
<p><strong>버전 A (검토 전):</strong></p>
<pre><code>Generate 3 questions about the user's input.
Use casual Korean tone.</code></pre>
<p><strong>품질 분석 체크리스트:</strong></p>
<table class="table">
<thead>
<tr class="header">
<th>체크 항목</th>
<th>현재 상태</th>
<th>문제점</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td>역할 정의</td>
<td>✗ 없음</td>
<td>“너는 누구인가?” 불명확</td>
</tr>
<tr class="even">
<td>입력 형식</td>
<td>✗ 불명확</td>
<td>“user’s input”이 무엇인지 모호</td>
</tr>
<tr class="odd">
<td>출력 구조</td>
<td>✗ 없음</td>
<td>3개 질문을 어떻게 구분?</td>
</tr>
<tr class="even">
<td>제약 조건</td>
<td>△ 일부</td>
<td>“casual tone”만으로 반말 보장 안 됨</td>
</tr>
<tr class="odd">
<td>예시</td>
<td>✗ 없음</td>
<td>LLM이 뭘 원하는지 추측해야 함</td>
</tr>
</tbody>
</table>
<p><strong>평가: 실행 전에 이미 문제 발견</strong> → 개선 필요</p>
<p><strong>버전 B (개선 후):</strong></p>
<pre><code>You are a question generator that creates 3 different questions 
based on user's input topic.

Input format: A single topic keyword (e.g., "부산 여행")

Output format:
High certainty: [5 words or less question]
Moderate certainty: [5 words or less question]  
Low certainty: [5 words or less question]

Constraints:
- Use Korean casual speech (반말, ending with "?" not "요?")
- Each question must explore a different angle
- No explanations, just questions</code></pre>
<p><strong>재검토 결과:</strong></p>
<table class="table">
<thead>
<tr class="header">
<th>체크 항목</th>
<th>개선 후 상태</th>
<th>비고</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td>역할 정의</td>
<td>✓ 명확</td>
<td>“question generator”</td>
</tr>
<tr class="even">
<td>입력 형식</td>
<td>✓ 명확</td>
<td>예시까지 제공</td>
</tr>
<tr class="odd">
<td>출력 구조</td>
<td>✓ 명확</td>
<td>3개 섹션 구분</td>
</tr>
<tr class="even">
<td>제약 조건</td>
<td>✓ 구체적</td>
<td>“반말”, “5단어”, “다른 각도” 명시</td>
</tr>
<tr class="odd">
<td>예시</td>
<td>✓ 있음</td>
<td>괄호 안에 구체적 예시</td>
</tr>
</tbody>
</table>
<p><strong>평가: 실행 전 검토 통과</strong> → 테스트 진행 가능</p>
<p><strong>왜 이 단계가 중요한가? 2단계 없이 바로 3단계로 가면:</strong></p>
<pre><code>Day 1: 버전 A 테스트 시작
       → 10개 입력 테스트
       → 결과: 형식 엉망, 한국어/영어 섞임, 질문 개수 불규칙
       
Day 2: "프롬프트가 너무 모호해요" 깨달음
       → 버전 B로 수정
       → 다시 10개 입력 테스트
       → 시간 낭비: 2일

총 시간: 2일</code></pre>
<p><strong>2단계를 거치면:</strong></p>
<pre><code>Day 1 오전: 버전 A 품질 분석 (30분)
            → 즉시 문제 발견
            → 버전 B로 개선 (30분)
            
Day 1 오후: 버전 B 테스트 시작
            → 10개 입력 테스트
            → 결과: 형식 안정적, 기준 대부분 충족

총 시간: 1일</code></pre>
<p><strong>불필요한 시행착오 방지</strong></p>
<p>2단계는 “종이 위에서 먼저 확인”하는 단계다.<br>
실제 실행은 비용(시간, API 호출)이 드니까, 명백한 문제는 미리 잡는다.</p>
</section>
<section id="테스트-결과-정리" class="level3" data-number="2.3">
<h3 data-number="2.3" class="anchored" data-anchor-id="테스트-결과-정리"><span class="header-section-number">2.3</span> 테스트 결과 정리</h3>
<ul>
<li>실제로 실행한 결과를 체계적으로 기록한다.</li>
<li>“좋았다/나빴다”가 아니라, <strong>어떤 조건에서 어떤 결과가 나왔는지</strong>를 정리한다.<br>
</li>
<li>나중에 4단계(선별)에서 근거 있는 결정을 하려면, 이 기록이 필수다.</li>
</ul>
<p><strong>상황 설정:</strong></p>
<p>질문 생성기 프롬프트 2가지 버전을 비교한다: - <strong>Type 1</strong>: Introduction → Response template → Ending</p>
<pre><code>You are a question generator that creates 3 different questions 
based on user's input topic.

Input format: A single topic keyword (e.g., "부산 여행")

Output format:
High certainty: [5 words or less question]
Moderate certainty: [5 words or less question]
Low certainty: [5 words or less question]

Constraints:
- Use Korean casual speech (반말, ending with "?" not "요?")
- Each question must explore a different angle
- No explanations, just questions</code></pre>
<ul>
<li><strong>Type 2</strong>: Introduction → Ending → Response template (순서 변경)</li>
</ul>
<pre><code>You are a question generator that creates 3 different questions 
based on user's input topic.

Input format: A single topic keyword (e.g., "부산 여행")

Constraints:
- Use Korean casual speech (반말, ending with "?" not "요?")
- Each question must explore a different angle
- No explanations, just questions

Output format:
High certainty: [5 words or less question]
Moderate certainty: [5 words or less question]
Low certainty: [5 words or less question]</code></pre>
<p><strong>차이점:</strong> - Type 1: 출력 형식(Response template)을 먼저 보고, 마지막에 제약조건(Ending) - Type 2: 제약조건(Ending)을 먼저 보고, 마지막에 출력 형식(Response template)</p>
<p><strong>테스트 입력 5개:</strong></p>
<pre><code>1. "부산 여행"
2. "주식 투자"
3. "헬스 다이어트"
4. "강아지 훈련"
5. "영어 공부"</code></pre>
<p><strong>결과 정리 표:</strong></p>
<table class="table">
<colgroup>
<col style="width: 18%">
<col style="width: 31%">
<col style="width: 31%">
<col style="width: 18%">
</colgroup>
<thead>
<tr class="header">
<th>입력</th>
<th>Type 1 결과</th>
<th>Type 2 결과</th>
<th>비교</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td>부산 여행</td>
<td>✓ 3개 질문, 반말, 각도 다름</td>
<td>✓ 3개 질문, 반말, 각도 다름</td>
<td>동일</td>
</tr>
<tr class="even">
<td>주식 투자</td>
<td>✓ 3개 질문, 반말, 각도 다름</td>
<td>✗ 2개 질문만 출력</td>
<td>Type 1 우수</td>
</tr>
<tr class="odd">
<td>헬스 다이어트</td>
<td>✗ “합니다” 체 혼입</td>
<td>✓ 반말 유지</td>
<td>Type 2 우수</td>
</tr>
<tr class="even">
<td>강아지 훈련</td>
<td>✓ 3개 질문, 반말, 각도 다름</td>
<td>✓ 3개 질문, 반말, 각도 다름</td>
<td>동일</td>
</tr>
<tr class="odd">
<td>영어 공부</td>
<td>✗ High/Moderate 중복됨</td>
<td>✓ 각도 명확히 구분</td>
<td>Type 2 우수</td>
</tr>
</tbody>
</table>
<p><strong>통계 요약 및 분석</strong></p>
<pre><code>Type 1: 3/5 완전 성공 (60%)
        - 안정적 출력 개수
        - 반말 형식 불안정
        
Type 2: 4/5 완전 성공 (80%)
        - 가끔 출력 개수 불안정
        - 반말 형식 안정적</code></pre>
<p><strong>Type 1의 약점:</strong> - “Ending이 마지막에 와서 형식 지시가 약해짐” - Response template 먼저 보고 생성 시작 → 마지막 Ending 무시</p>
<p><strong>Type 2의 약점:</strong> - “Ending을 먼저 보니 형식은 잘 지키지만…” - 가끔 Response template 섹션 구분을 놓침</p>
<p><strong>개관적 분석 가능</strong></p>
<p><strong>정리 없이 그냥 “느낌”만으로:</strong></p>
<pre><code>개발자: "Type 2가 더 나은 것 같아요."
PM: "왜요?"
개발자: "음... 그냥 결과가 더 좋아 보여서요."
PM: "구체적으로 뭐가?"
개발자: "잘... 기억이 안 나네요. 다시 테스트해볼까요?"
→ 같은 테스트 반복</code></pre>
<p><strong>체계적 정리를 했을 때:</strong></p>
<pre><code>개발자: "Type 2가 80% 성공률입니다."
PM: "Type 1은?"
개발자: "60%인데, 특히 반말 형식에서 불안정합니다. (표 공유)"
PM: "이유는?"
개발자: "Ending이 마지막이라 LLM이 놓치는 것 같습니다."
PM: "알겠습니다. Type 2로 가죠. 출력 개수 불안정은 검증 로직으로 보완합시다."
→ 근거 있는 즉시 결정</code></pre>
<p>결과를 <strong>표나 구조화된 기록</strong>으로 남기면: - 나중에 참고 가능 - 팀원과 공유 쉬움 - 결정 근거 명확</p>
<p>“기억에 의존” → “기록에 의존”으로 바뀐다.</p>
</section>
<section id="최종-프롬프트-선별" class="level3" data-number="2.4">
<h3 data-number="2.4" class="anchored" data-anchor-id="최종-프롬프트-선별"><span class="header-section-number">2.4</span> 최종 프롬프트 선별</h3>
<ul>
<li>3단계의 데이터를 바탕으로 하나를 선택한다.</li>
<li>이건 규칙 1(“최소 두 가지 버전”)이 빛을 발하는 순간이다.<br>
</li>
<li>비교 대상이 있어야 “선택”이 가능하다.</li>
</ul>
<p><strong>의사결정 회의 시나리오:</strong></p>
<p><strong>참석자:</strong> PM, 개발자, QA</p>
<p><strong>개발자 발표:</strong></p>
<pre><code>3단계 테스트 결과 요약:
- Type 1: 60% 성공률, 반말 불안정
- Type 2: 80% 성공률, 출력 개수 가끔 불안정</code></pre>
<ul>
<li><strong>PM 질문:</strong> “Type 2의 ’출력 개수 불안정’은 어느 정도인가요?”<br>
</li>
<li><strong>개발자:</strong> “5개 입력 중 1개에서 2개만 출력. 20% 비율입니다.”<br>
</li>
<li><strong>QA:</strong> “그럼 Type 2 쓰되, 출력 검증 로직 추가하면 되겠네요.”<br>
</li>
<li><strong>개발자:</strong></li>
</ul>
<div class="sourceCode" id="cb16" style="background: #f1f3f5;"><pre class="sourceCode numberSource python number-lines code-with-copy"><code class="sourceCode python"><span id="cb16-1"><span class="kw" style="color: #003B4F;
background-color: null;
font-style: inherit;">def</span> validate_output(response):</span>
<span id="cb16-2">    questions <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> response.split(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">'</span><span class="ch" style="color: #20794D;
background-color: null;
font-style: inherit;">\n</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">'</span>)</span>
<span id="cb16-3">    <span class="cf" style="color: #003B4F;
background-color: null;
font-style: inherit;">if</span> <span class="bu" style="color: null;
background-color: null;
font-style: inherit;">len</span>(questions) <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">!=</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">3</span>:</span>
<span id="cb16-4">        <span class="cf" style="color: #003B4F;
background-color: null;
font-style: inherit;">return</span> <span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">False</span>  <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># 재생성 요청</span></span>
<span id="cb16-5">    <span class="cf" style="color: #003B4F;
background-color: null;
font-style: inherit;">return</span> <span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">True</span></span></code></pre></div>
<p><strong>PM:</strong> “좋습니다. Type 2로 결정. 검증 로직은 내일까지 구현.”</p>
<p><strong>결정 근거 문서:</strong></p>
<pre><code>의사결정 기록 (2026-02-04)
---
문제: Type 1 vs Type 2 선택
결정: Type 2 채택

이유:
1. 성공률 20%p 높음 (60% → 80%)
2. 반말 형식 안정성이 핵심 요구사항
3. 출력 개수 문제는 검증 로직으로 해결 가능

트레이드오프:
- 장점: 형식 안정적, 사용자 경험 일관성
- 단점: 재생성 로직 추가 개발 필요 (1일 소요)

대안 검토:
- Type 1 개선: Ending 강조 시도했으나 효과 미미
- 하이브리드: 복잡도 증가로 기각</code></pre>
<p><strong>근거 없는 선택 방지</strong></p>
<pre><code>"Type 2가 더 나아 보이니까 이걸로 하죠."
→ 3개월 후 문제 발생 시: "왜 Type 2 선택했죠?"
→ 아무도 모름</code></pre>
<p><strong>근거 있는 선택 지향</strong></p>
<pre><code>"Type 2 선택 이유: 반말 안정성 80%, 의사결정 기록 참조"
→ 3개월 후 문제 발생 시: 기록 확인 → 당시 맥락 파악 → 개선 방향 결정</code></pre>
<p>선택의 <strong>이유와 과정</strong>을 남기는 것이 핵심이다.</p>
</section>
<section id="사용자-피드백-및-이슈-관리" class="level3" data-number="2.5">
<h3 data-number="2.5" class="anchored" data-anchor-id="사용자-피드백-및-이슈-관리"><span class="header-section-number">2.5</span> 사용자 피드백 및 이슈 관리</h3>
<p><strong>핵심:</strong> 선별 직후, 실제 사용자로 테스트한다.</p>
<p><strong>주목할 점:</strong> 이 단계는 “배포 후”가 아니라 “선별 후 즉시”다.<br>
내부 테스트만으로는 실제 사용 환경의 다양성을 못 잡는다.</p>
<p><strong>베타 테스트 진행 (1주일):</strong></p>
<p><strong>참여자:</strong> 사내 직원 20명 (실제 사용자 시뮬레이션)</p>
<p><strong>입력 데이터 (실제 수집):</strong></p>
<pre><code>1. "부산여행" ✓ 정상
2. "주시투자" (오타)
3. "헬스 ㄷ다이어트" (오타 + 자음 분리)
4. "강아지" (너무 짧음)
5. "영어공부 잘하는 법 알려줘" (너무 김)
6. "ㅎㅇ" (의미 없는 입력)
7. "파이썬 배우기"
8. "재택근무" 
9. "!!!" (특수문자만)
10. "주식투자 부동산투자 암호화폐" (여러 주제)</code></pre>
<p><strong>발견된 이슈:</strong></p>
<table class="table">
<thead>
<tr class="header">
<th>이슈 ID</th>
<th>입력</th>
<th>문제</th>
<th>심각도</th>
<th>비율</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td>ISS-001</td>
<td>“주시투자”</td>
<td>오타 인식 못함, 질문 엉뚱함</td>
<td>높음</td>
<td>15%</td>
</tr>
<tr class="even">
<td>ISS-002</td>
<td>“ㅎㅇ”</td>
<td>의미 없는 질문 생성</td>
<td>중간</td>
<td>10%</td>
</tr>
<tr class="odd">
<td>ISS-003</td>
<td>“강아지”</td>
<td>너무 짧아서 맥락 부족 질문</td>
<td>낮음</td>
<td>5%</td>
</tr>
<tr class="even">
<td>ISS-004</td>
<td>“주식… 암호화폐”</td>
<td>첫 주제만 인식</td>
<td>중간</td>
<td>8%</td>
</tr>
</tbody>
</table>
<p><strong>즉시 조치:</strong></p>
<div class="sourceCode" id="cb21" style="background: #f1f3f5;"><pre class="sourceCode numberSource python number-lines code-with-copy"><code class="sourceCode python"><span id="cb21-1"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># ISS-001 해결: 입력 전처리 추가</span></span>
<span id="cb21-2"><span class="kw" style="color: #003B4F;
background-color: null;
font-style: inherit;">def</span> preprocess_input(user_input):</span>
<span id="cb21-3">    <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># 오타 교정 라이브러리 적용</span></span>
<span id="cb21-4">    corrected <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> spell_checker.correct(user_input)</span>
<span id="cb21-5">    <span class="cf" style="color: #003B4F;
background-color: null;
font-style: inherit;">return</span> corrected</span>
<span id="cb21-6"></span>
<span id="cb21-7"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># ISS-002 해결: 입력 검증</span></span>
<span id="cb21-8"><span class="kw" style="color: #003B4F;
background-color: null;
font-style: inherit;">def</span> validate_input(user_input):</span>
<span id="cb21-9">    <span class="cf" style="color: #003B4F;
background-color: null;
font-style: inherit;">if</span> <span class="bu" style="color: null;
background-color: null;
font-style: inherit;">len</span>(user_input) <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">&lt;</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">2</span> <span class="kw" style="color: #003B4F;
background-color: null;
font-style: inherit;">or</span> <span class="kw" style="color: #003B4F;
background-color: null;
font-style: inherit;">not</span> has_meaningful_chars(user_input):</span>
<span id="cb21-10">        <span class="cf" style="color: #003B4F;
background-color: null;
font-style: inherit;">return</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"다시 입력해주세요. 주제를 명확히 적어주세요."</span></span>
<span id="cb21-11">    <span class="cf" style="color: #003B4F;
background-color: null;
font-style: inherit;">return</span> <span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">None</span>  <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># 통과</span></span></code></pre></div>
<p><strong>피드백 루프:</strong></p>
<pre><code>Week 1: 베타 테스트 → 4개 이슈 발견
Week 1 말: 전처리/검증 로직 추가 → 재배포
Week 2: 재테스트 → 이슈율 38% → 8% 감소
Week 2 말: 정식 배포 승인</code></pre>
<p><strong>왜 내부 테스트만으로 부족한가?</strong></p>
<p><strong>내부 테스트 입력 (깔끔함):</strong></p>
<pre><code>"부산 여행"
"주식 투자"
"헬스 다이어트"</code></pre>
<p>→ 모두 정상 작동</p>
<p><strong>실제 사용자 입력 (현실):</strong></p>
<pre><code>"부사너행" (오타)
"주식ㅠㅠ" (감정 표현)
"헬스?" (의문형)</code></pre>
<p>→ 프롬프트 혼란</p>
<p>실제 사용자는 <strong>완벽하게 입력하지 않는다</strong>.<br>
5단계는 그 현실을 마주하는 단계다.</p>
</section>
<section id="단계-프롬프트-언어-분석" class="level3" data-number="2.6">
<h3 data-number="2.6" class="anchored" data-anchor-id="단계-프롬프트-언어-분석"><span class="header-section-number">2.6</span> 6단계: 프롬프트 언어 분석</h3>
<p><strong>핵심:</strong> 프롬프트 언어가 출력 품질에 어떤 영향을 주는가?</p>
<p>이건 단순한 “번역” 문제가 아니다.<br>
<strong>같은 내용이라도 언어에 따라 LLM의 반응이 달라진다.</strong></p>
<p><strong>질문 생성기 상황:</strong> - 프롬프트: 영어 - 출력: 한국어 반말</p>
<p><strong>3가지 언어 조합 테스트:</strong></p>
<p><strong>버전 A: 프롬프트 영어, 출력 지시 영어</strong></p>
<pre><code>Generate 3 questions in Korean casual speech (반말).</code></pre>
<p><strong>버전 B: 프롬프트 영어, 출력 지시 한국어</strong></p>
<pre><code>Generate 3 questions.
Output format: 한국어 반말로 작성 (예: "뭐 할까?", "어때?")</code></pre>
<p><strong>버전 C: 프롬프트 한국어, 출력 지시 한국어</strong></p>
<pre><code>당신은 질문 생성기입니다.
사용자 입력 주제에 대해 3개 질문을 생성하세요.
출력 형식: 한국어 반말 (예: "뭐 할까?", "어때?")</code></pre>
<p><strong>테스트 결과 (GPT-4 기준):</strong></p>
<table class="table">
<thead>
<tr class="header">
<th>버전</th>
<th>반말 준수율</th>
<th>영어 혼입</th>
<th>자연스러움</th>
<th>평균 품질</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td>A (영/영)</td>
<td>70%</td>
<td>30%</td>
<td>중간</td>
<td>★★★☆☆</td>
</tr>
<tr class="even">
<td>B (영/한)</td>
<td>90%</td>
<td>5%</td>
<td>높음</td>
<td>★★★★☆</td>
</tr>
<tr class="odd">
<td>C (한/한)</td>
<td>95%</td>
<td>2%</td>
<td>매우 높음</td>
<td>★★★★★</td>
</tr>
</tbody>
</table>
<p><strong>버전 A 실제 출력 예시:</strong></p>
<pre><code>High certainty: What should I do in Busan? (영어 혼입!)
Moderate certainty: 부산 어디 가볼까?
Low certainty: 혼자 가도 괜찮아요? (존댓말 혼입!)</code></pre>
<p><strong>버전 C 실제 출력 예시:</strong></p>
<pre><code>High certainty: 부산 뭐 할까?
Moderate certainty: 어디 가볼까?
Low certainty: 혼자 가도 괜찮아?</code></pre>
<p>→ 일관성 ↑, 자연스러움 ↑</p>
<p><strong>왜 이런 차이가 생기나?</strong></p>
<p><strong>GPT-4 학습 데이터 구성 (추정):</strong> - 영어 데이터: 70% - 한국어 데이터: 5% - 기타 언어: 25%</p>
<p><strong>영어 프롬프트 (버전 A):</strong></p>
<pre><code>LLM 내부 처리:
1. 영어 프롬프트 이해 (강점)
2. "Korean casual speech" 해석
3. 영어 → 한국어 전환 (약점)
→ 전환 과정에서 불안정</code></pre>
<p><strong>한국어 프롬프트 (버전 C):</strong></p>
<pre><code>LLM 내부 처리:
1. 한국어 프롬프트 이해 (약점이지만...)
2. 한국어 예시 참조 ("뭐 할까?", "어때?")
3. 같은 패턴으로 생성
→ 예시 덕분에 안정적</code></pre>
<p><strong>핵심 발견:</strong></p>
<p>프롬프트 언어보다 <strong>출력 예시</strong>가 더 중요하다!<br>
버전 B (영/한)가 버전 A (영/영)보다 좋은 이유: → 한국어 예시 “뭐 할까?”, “어때?”가 LLM에게 <strong>명확한 타겟</strong>을 제공</p>
<p><strong>실무 적용:</strong></p>
<pre><code>결론: 버전 C 채택

이유:
1. 반말 준수율 95% (최고)
2. 영어 혼입 2% (최저)
3. 자연스러움 최고

단, 프롬프트 수정 시:
- 한국어 프롬프트는 오타/문법 주의 필요
- 영어 프롬프트보다 유지보수 난이도 약간 높음
- 팀 내 한국어 네이티브 리뷰 필수</code></pre>
<p>6단계는 <strong>“무슨 언어 쓸까?”를 넘어서, “이 언어 조합이 출력 품질을 어떻게 바꾸나?”를 데이터로 확인</strong>하는 단계다.</p>
</section>
<section id="지속적인-결과-개선" class="level3" data-number="2.7">
<h3 data-number="2.7" class="anchored" data-anchor-id="지속적인-결과-개선"><span class="header-section-number">2.7</span> 지속적인 결과 개선</h3>
<p>테스트는 한 번으로 끝나지 않는다.<br>
모델이 변하고, 사용자 패턴이 변하고, 비즈니스 요구사항이 변한다.</p>
<p>질문 생성기의 경우, 오늘 잘 작동했던 프롬프트를 3개월 후 다시 돌리면 형식이 달라질 수 있다.<br>
그때 다시 1단계로 돌아가서 기준을 재확인하고, 새로운 모델 버전에서 다시 테스트한다.<br>
이 루프가 프롬프트의 실제 수명을 결정한다.</p>
<section id="예시-3개월-주기-개선-사이클" class="level4" data-number="2.7.1">
<h4 data-number="2.7.1" class="anchored" data-anchor-id="예시-3개월-주기-개선-사이클"><span class="header-section-number">2.7.1</span> 예시: 3개월 주기 개선 사이클</h4>
<p>질문 생성기의 개선 이력을 시간순으로 정리한 것이다.</p>
<table class="table">
<colgroup>
<col style="width: 14%">
<col style="width: 23%">
<col style="width: 26%">
<col style="width: 21%">
<col style="width: 14%">
</colgroup>
<thead>
<tr class="header">
<th>시점</th>
<th>모델 버전</th>
<th>발견된 이슈</th>
<th>개선 조치</th>
<th>결과</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td>1월</td>
<td>GPT-4-0613</td>
<td>Low certainty 질문이 너무 추상적</td>
<td>“구체적 예시를 포함하라” 지시 추가</td>
<td>구체성 40% → 75% 향상</td>
</tr>
<tr class="even">
<td>2월</td>
<td>GPT-4-0613</td>
<td>사용자 오타에 취약 (“부사너행” 입력 시 질문 생성 실패)</td>
<td>“입력 보정” 단계 추가</td>
<td>오류율 15% → 3% 감소</td>
</tr>
<tr class="odd">
<td>4월</td>
<td>GPT-4-turbo</td>
<td>모델 업데이트 후 반말 형식 무너짐 (“합니다” 체 출현)</td>
<td>Ending에 “반드시 반말을 사용하라” 강조 추가</td>
<td>반말 준수율 100% 복구</td>
</tr>
<tr class="even">
<td>5월</td>
<td>GPT-4-turbo</td>
<td>High certainty와 Moderate certainty 질문 중복 증가</td>
<td>“각 질문은 서로 다른 각도여야 한다” 명시</td>
<td>중복률 20% → 5% 감소</td>
</tr>
<tr class="odd">
<td>7월</td>
<td>GPT-4o</td>
<td>질문 길이가 불균일 (5단어 제약 무시)</td>
<td>형식 체크 후 재생성 로직 추가</td>
<td>길이 제약 준수율 95% 달성</td>
</tr>
</tbody>
</table>
<p><strong>개선 사이클의 특징:</strong> - <strong>모델 업데이트 감지</strong>: 4월의 GPT-4-turbo 전환 시점에서 기존 프롬프트가 무너진다. 이건 외부 요인이지만, 정기 테스트가 없었다면 발견이 늦어졌을 것이다. - <strong>사용자 패턴 반영</strong>: 2월의 오타 케이스는 내부 테스트에서는 없었던 패턴이다. 실제 사용자 로그를 분석해야 발견된다. - <strong>누적 개선</strong>: 1월의 구체성 개선이 7월까지 유지되는지를 확인한다. 새로운 수정이 이전 개선을 망가뜨리지 않는지를 검증한다.</p>
<p><strong>개선 트리거 3가지:</strong> 1. <strong>정기 점검</strong>: 매 분기 같은 테스트 데이터셋으로 재실행 (모델 변화 감지) 2. <strong>이슈 보고</strong>: CS 팀에서 올라온 사용자 불만 (실제 사용 패턴 반영) 3. <strong>비즈니스 요구</strong>: “질문이 너무 길어서 UI에 안 들어간다” 같은 새로운 제약</p>
<p>이 세 가지가 7단계를 움직이는 힘이다.<br>
정기 점검이 없으면 모델 변화를 놓친다. 이슈 보고가 없으면 실제 사용자와 괴리된다. 비즈니스 요구가 없으면 제품과 분리된다.<br>
7단계는 단순히 “또 테스트하자”가 아니라, 이 세 가지 신호를 계속 받아들이는 구조이다.</p>
</section>
</section>
</section>
<section id="단계의-내부-리듬" class="level2" data-number="3">
<h2 data-number="3" class="anchored" data-anchor-id="단계의-내부-리듬"><span class="header-section-number">3</span> 7단계의 내부 리듬</h2>
<p>준비(1단계) -&gt; 분석(2단계) -&gt; 실행과 정리(3단계) -&gt; 결정(4단계) -&gt; 검증(5단계) -&gt; 세부 확인(6단계) -&gt; 반복(7단계).<br>
이건 제품 개발의 한 사이클과 거의 동일한 구조이다.</p>
</section>
<section id="두-가지-축-정성적과-정량적" class="level2" data-number="4">
<h2 data-number="4" class="anchored" data-anchor-id="두-가지-축-정성적과-정량적"><span class="header-section-number">4</span> 두 가지 축: 정성적과 정량적</h2>
<p>테스트 방법은 두 축으로 나뉜다.<br>
프롬프트 평가에서 답을 얻을 수 있는 질문의 종류 자체가 두 종류이기 때문이다.</p>
<p>같은 질문 생성기 프롬프트에 대해, 두 축이 답하는 질문이 다르다는 건 바로 여기서 보인다.</p>
<section id="정성적-방법이-답하는-질문" class="level3" data-number="4.1">
<h3 data-number="4.1" class="anchored" data-anchor-id="정성적-방법이-답하는-질문"><span class="header-section-number">4.1</span> 정성적 방법이 답하는 질문</h3>
<p>“이 프롬프트가 의도대로 작동하는가?”<br>
이 질문은 사람이 출력을 읽고 판단해야 한다.</p>
<p>질문 생성기의 경우, 정성적 방법이 확인하는 건 이런 것이다.<br>
High certainty 섹션에서 나온 질문이 실제로 가장 확신 높은 질문인지.<br>
Low certainty 섹션에서 나온 질문이 실제로 독자의 궁금증을 자극하는지.<br>
세 질문의 각도가 진짜로 서로 다른지.<br>
이건 숫자로 잡을 수 없는 부분이다. 사람이 읽고 판단해야 한다.</p>
</section>
<section id="정량적-방법이-답하는-질문" class="level3" data-number="4.2">
<h3 data-number="4.2" class="anchored" data-anchor-id="정량적-방법이-답하는-질문"><span class="header-section-number">4.2</span> 정량적 방법이 답하는 질문</h3>
<p>“이 프롬프트가 얼마나 안정적으로 작동하는가?”<br>
같은 프롬프트를 반복 실행했을 때, 결과의 패턴과 일관성을 확인한다.</p>
<p>질문 생성기의 경우, 정량적 방법이 확인하는 건 이런 것이다.<br>
같은 입력을 20번 넣었을 때, 항상 세 질문이 반환되는지.<br>
형식이 무너지는 횟수가 20번 중 몇 번인지.<br>
주제가 겹치는 횟수가 얼마나 되는지.<br>
이건 한 번만 보면 알 수 없는 것이다. 반복 실행 없이는 패턴이 보이지 않는다.</p>
</section>
<section id="둘의-관계" class="level3" data-number="4.3">
<h3 data-number="4.3" class="anchored" data-anchor-id="둘의-관계"><span class="header-section-number">4.3</span> 둘의 관계</h3>
<p>정성적 검증이 먼저 통과되어야 정량적 검증이 의미를 가진다.<br>
High certainty 섹션이 실제로 좋은 질문을 내는지가 확인되기 전에, 그 질문이 “얼마나 안정적으로”나오는지를 측정하는 건 순서가 뒤집은 것이다.<br>
먼저 “제대로 작동하는지” -&gt; 그 다음 “그게 안정적인지”.<br>
정성적과 정량적은 단순히 두 가지 방법이 아니라, 순차적으로 적용되는 두 층의 검증이다.</p>
</section>
</section>
<section id="prompt-testbed" class="level2" data-number="5">
<h2 data-number="5" class="anchored" data-anchor-id="prompt-testbed"><span class="header-section-number">5</span> Prompt Testbed</h2>
<pre><code>The Prompt Testbed
https://the-prompt-playground.vercel.app/</code></pre>
<p>ChatGPT이나 Claude에서도 프롬프트를 실행할 수 있다.<br>
하지만 거기서는 같은 프롬프트를 20번 반복 실행하고, 그 결과 20건을 한 눈에 비교하기 어렵다.<br>
한 번 실행하면 결과가 나오고, 다음에 다시 실행하면 이전 결과가 사라진다.<br>
패턴을 보려면 결과를 모아야 하는데, 일반 대화형 UI는 그 구조가 아니다.</p>
<p>Testbed는 바로 그 부분을 해결하는 환경이다.<br>
동일한 프롬프트를 반복 실행하고, 각 결과를 나열하고, 비교할 수 있는 구조이다.<br>
규칙 7, 즉 “같은 테스트 도구로 최소 열 번 이상 생성”이라는 건, 바로 이런 종류의 도구가 존재한다는 가정 위에 있다.<br>
규칙 7을 실제로 실천하려면, 반복 실행과 결과 비교가 구조적으로 가능한 도구가 있어야 한다.<br>
그 도구가 이것이다.</p>
<p>이후 파트에서 나오는 정성적 실험과 정량적 실험은 모두 이 종류의 환경에서 수행된다.</p>


</section>

 ]]></description>
  <category>AI</category>
  <category>Prompt Engineering</category>
  <category>Testing</category>
  <guid>kk3225.netlify.app/docs/blog/posts/Agent/17-Evaluations/17-Prompt-Qualtiy-Control-testMethod.html</guid>
  <pubDate>Tue, 03 Feb 2026 15:00:00 GMT</pubDate>
</item>
<item>
  <title>프롬프트 품질 관리를 위한 9가지 테스트 규칙</title>
  <dc:creator>Kwangmin Kim</dc:creator>
  <link>kk3225.netlify.app/docs/blog/posts/Agent/17-Evaluations/16-Prompt-Qualtiy-Control-testRules.html</link>
  <description><![CDATA[ 





<section id="들어가며" class="level2" data-number="1">
<h2 data-number="1" class="anchored" data-anchor-id="들어가며"><span class="header-section-number">1</span> 들어가며</h2>
<p>Prompt Engineering 평가에 세 가지 어려움을 이야기했다: <strong>확률적 응답, 정답 없음, 빠른 모델 변화</strong>.<br>
이 파트는 그 세 어려움에 대한 구체적 대응책, 즉 아홉 가지 규칙과 문서화 방법을 다룬다.<br>
규칙 하나하나를 단순히 나열하는 게 아니라, <strong>왜 그 규칙이 그 형태로 생겼는지</strong>를 같이 본다.<br>
그리고 아홉 규칙이 실제로 어떤 논리로 묶여 있는지도 한 번 정리한다.</p>
</section>
<section id="아홉-규칙의-내부-구조" class="level2" data-number="2">
<h2 data-number="2" class="anchored" data-anchor-id="아홉-규칙의-내부-구조"><span class="header-section-number">2</span> 아홉 규칙의 내부 구조</h2>
<p>아홉 규칙을 처음 보면 단순한 체크리스트로 보일 수 있다.<br>
하지만 이 규칙들은 우연히 나열된 게 아니라 <strong>단계적으로 연결된 구조</strong>를 가지고 있다.<br>
크게 네 클러스터로 묶인다.</p>
<section id="식별과-추적-규칙-1-2-3" class="level3" data-number="2.1">
<h3 data-number="2.1" class="anchored" data-anchor-id="식별과-추적-규칙-1-2-3"><span class="header-section-number">2.1</span> 식별과 추적 (규칙 1, 2, 3)</h3>
<p><strong>규칙 1 — 최소 두 가지 버전을 작성한다.</strong><br>
이건 테스트의 가장 기본적인 전제이다.<br>
프롬프트 하나만 있으면 “좋은지”를 판단할 근거가 없다.<br>
좋음과 나쁨은 항상 다른 옵션과의 비교를 통해 판단된다.<br>
“Prompt의 정답이 없다”는 현실의 실천적 해결책이 바로 여기서 시작된다.</p>
<p><strong>예시:</strong></p>
<p>버전 A (간결한 접근):</p>
<pre><code>You are a customer support assistant. Answer user questions about product returns.
Be concise and friendly.</code></pre>
<p>버전 B (구조화된 접근):</p>
<pre><code>You are a customer support assistant specializing in product returns.

When a user asks about returns:
1. First, confirm the product and purchase date
2. Explain the return policy (30-day window)
3. Provide step-by-step return instructions
4. Offer to help with any additional questions

Maintain a friendly and professional tone throughout.</code></pre>
<p>두 버전을 비교함으로써 “간결함 vs 구조화”의 트레이드오프를 평가할 수 있다.</p>
<p><strong>규칙 2 — 버전 이름은 기능 이름으로 정한다.</strong><br>
예시로 들어진 것: <code>systemprompt_v1</code>, <code>productrecommender_v2</code>.<br>
이 구조를 보면 두 가지 정보가 동시에 들어가 있다.<br>
“어떤 기능인지”와 “몇 번째 시도인지”.<br>
이건 단순한 이름 규칙이 아니라, <strong>프롬프트를 소프트웨어 자산과 같은 방식으로 관리하는 사고법</strong>을 적용한 것이다.<br>
프롬프트가 수십 개로 불어날 때, 기능과 버전을 분리하여 추적할 수 없으면 관리 자체가 불가능하다.</p>
<p><strong>예시:</strong></p>
<p>나쁜 이름 체계:</p>
<pre><code>prompt1.txt
prompt2_final.txt
prompt2_final_REAL.txt
new_prompt_test.txt</code></pre>
<p>좋은 이름 체계:</p>
<pre><code>CustomerSupport_Returns_v1.txt
CustomerSupport_Returns_v2.txt
ProductRecommender_Personalized_v1.txt
EmailGenerator_Marketing_v1.txt
EmailGenerator_Marketing_v2.txt</code></pre>
<p>이렇게 하면: - 기능별로 그룹화 가능 (CustomerSupport, ProductRecommender, EmailGenerator) - 버전 히스토리 추적 가능 (v1, v2, v3…) - 팀원 간 소통 명확 (“CustomerSupport_Returns_v2 테스트해봤어?”)</p>
<p><strong>규칙 3 — 기능이 세분화될 때 이름도 그 구조를 반영한다.</strong><br>
예시: <code>FinancialAnalysis_Revenue_v1</code>, <code>FinancialAnalysis_Expense_v1</code>.<br>
규칙 2에서 했던 기본 구조 위에, 같은 도메인 안에서 세부 카테고리가 분기될 때의 이름을 다룬다.<br>
이 예시를 들은 건 단순히 이름의 형식을 보여주려는 게 아니다.</p>
<p>프롬프트가 성장하면서 <strong>단일 기능에서 세분화로 전이되는 경로</strong>를 암시하는 것이다.<br>
처음엔 <code>FinancialAnalysis_v1</code> 하나로 시작해서, 나중엔 Revenue와 Expense로 분기한다.<br>
그리고 그 분기가 이름 구조에 바로 보이는 것.</p>
<p><strong>예시:</strong></p>
<p><strong>초기 단계 (통합 프롬프트):</strong></p>
<pre><code>FinancialAnalysis_v1.txt
FinancialAnalysis_v2.txt</code></pre>
<p><strong>성장 단계 (기능 세분화):</strong></p>
<pre><code>FinancialAnalysis_Revenue_v1.txt
FinancialAnalysis_Revenue_v2.txt
FinancialAnalysis_Expense_v1.txt
FinancialAnalysis_CashFlow_v1.txt
FinancialAnalysis_ProfitMargin_v1.txt</code></pre>
<p><strong>더 깊은 세분화:</strong></p>
<pre><code>FinancialAnalysis_Revenue_Quarterly_v1.txt
FinancialAnalysis_Revenue_Yearly_v1.txt
FinancialAnalysis_Expense_OperatingCosts_v1.txt
FinancialAnalysis_Expense_Marketing_v1.txt</code></pre>
<p>이 구조의 이점: - 도메인 계층(FinancialAnalysis) → 기능(Revenue) → 세부기능(Quarterly)이 이름에서 바로 보인다 - 새로운 기능 추가 시 어디에 배치해야 할지 명확하다 - 폴더 구조 없이도 파일 이름만으로 조직화가 가능하다</p>
</section>
<section id="기준선-정의-규칙-4" class="level3" data-number="2.2">
<h3 data-number="2.2" class="anchored" data-anchor-id="기준선-정의-규칙-4"><span class="header-section-number">2.2</span> 기준선 정의 (규칙 4)</h3>
<p><strong>규칙 4 — 각 버전의 목표와 기대 성능을 문서화한다.</strong><br>
클러스터 하나에서 버전을 여러 개 만들었다.<br>
그런데 여러 개의 버전 중 어떤 게 “나은지”를 판단하려면, 각 버전이 <strong>무엇을 목표로 하는지</strong>가 미리 정의되어 있어야 한다.<br>
목표가 없으면 비교 자체가 방향을 잃는다.<br>
이건 규칙 1의 확장이다. 버전이 여러 개라면, 각 버전의 존재 이유가 명확해져야 한다.</p>
<p><strong>예시:</strong></p>
<p><strong>프롬프트: ProductRecommender_Personalized_v2</strong></p>
<p><strong>목표:</strong> - 사용자의 구매 이력과 선호도를 기반으로 3개의 상품 추천 - 추천 이유를 각 상품마다 1-2문장으로 설명 - 응답 시간 3초 이내</p>
<p><strong>기대 성능:</strong> - 정확도: 추천 상품 중 최소 1개 이상이 사용자의 관심 카테고리와 일치 (80% 이상) - 다양성: 3개 추천이 서로 다른 카테고리에서 선택됨 (100%) - 형식 준수: JSON 형식 오류 없음 (100%) - 안전성: 재고 없는 상품 추천 안 함 (100%)</p>
<p><strong>v1과의 차이점:</strong> - v1은 설명 없이 상품명만 나열 → v2는 추천 이유 추가 - v1은 같은 카테고리 중복 가능 → v2는 다양성 보장</p>
<p><strong>테스트 결과 기준:</strong> - Pass: 위 4가지 기대 성능 모두 충족 - Fail: 하나라도 기준 미달</p>
<p>이렇게 문서화하면 테스트 후 “이 버전은 목표를 달성했는가?”를 명확히 판단할 수 있다.</p>
</section>
<section id="테스트-데이터의-품질-규칙-5-6" class="level3" data-number="2.3">
<h3 data-number="2.3" class="anchored" data-anchor-id="테스트-데이터의-품질-규칙-5-6"><span class="header-section-number">2.3</span> 테스트 데이터의 품질 (규칙 5, 6)</h3>
<p><strong>규칙 5 — 작위적인 문장을 사용하지 않는다. 실제 사용자 발화와 실제 데이터를 사용한다.</strong><br>
“작위적인 문장”이란 테스트를 위해 직접 만든 문장을 말한다.<br>
예를 들어 “부산의 맛있는 음식 추천해줘”라고 자신이 쓴 테스트 문장과,<br>
실제 사용자가 앱에서 입력한 “부산 갔는데 뭘 먹어야 돼”는 완전히 다르다.<br>
후자쪽이 더 불완전하고, 맥락이 빠지고, 오타가 있을 수 있다.<br>
그리고 바로 그 불완전함이 실제 환경에 해당된다.<br>
테스트 데이터가 실제 환경과 달라지면, 테스트 결과는 현실을 반영하지 못한다.<br>
ML에서 학습 데이터와 평가 데이터 간의 분포 차이가 모델 성능을 왜곡하는 것과 동일한 논리이다.</p>
<p><strong>예시:</strong></p>
<p><strong>나쁜 예 (작위적 테스트 데이터):</strong></p>
<pre><code>"서울에서 부산까지 가는 방법을 알려주세요."
"상품 반품 절차를 상세히 설명해주세요."
"이번 달 매출 보고서를 작성해주세요."</code></pre>
<p>→ 문법 완벽, 맥락 명확, 정중한 표현</p>
<p><strong>좋은 예 (실제 사용자 발화):</strong></p>
<pre><code>"서울 부산 어케가요"
"반품하고싶은데요"
"이번달 매출은요?"
"환불 요청했는데 연락이 엄ㅂ어요" (오타)
"저번에 주문한거요 그거" (불완전한 맥락)
"아 답답하네 진짜 반품 어떻게 하는거에요" (감정 표현)</code></pre>
<p>→ 오타, 생략, 맥락 부족, 감정 포함</p>
<p><strong>실제 데이터 수집 방법:</strong> - 베타 테스트 기간 동안 수집한 실제 사용자 입력 - 고객 지원 채팅 로그 (개인정보 제거 후) - A/B 테스트 과정에서 기록된 사용자 쿼리 - 사내 직원들의 자유 형식 입력 (시뮬레이션)</p>
<p>실제 데이터로 테스트하면 프롬프트의 실전 성능을 정확히 파악할 수 있다.</p>
<p><strong>규칙 6 — 테스트 데이터셋을 사용한다.</strong><br>
규칙 5가 “왜”라면, 규칙 6은 “어떻게”이다.<br>
어떤 종류의 테스트 데이터셋을 구성해야 하는지는 이 파트 마지막에서 상세히 본다.</p>
<p><strong>예시:</strong></p>
<p><strong>테스트 데이터셋 구성 (고객 지원 챗봇)</strong></p>
<p><strong>파일명: CustomerSupport_TestDataset_v1.json</strong></p>
<div class="sourceCode" id="cb10" style="background: #f1f3f5;"><pre class="sourceCode numberSource json number-lines code-with-copy"><code class="sourceCode json"><span id="cb10-1"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">{</span></span>
<span id="cb10-2">  <span class="dt" style="color: #AD0000;
background-color: null;
font-style: inherit;">"dataset_name"</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">:</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"CustomerSupport Returns Test"</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">,</span></span>
<span id="cb10-3">  <span class="dt" style="color: #AD0000;
background-color: null;
font-style: inherit;">"version"</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">:</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"1.0"</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">,</span></span>
<span id="cb10-4">  <span class="dt" style="color: #AD0000;
background-color: null;
font-style: inherit;">"prompt_file"</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">:</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"./prompts/CustomerSupport_Returns_v2.txt"</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">,</span></span>
<span id="cb10-5">  <span class="dt" style="color: #AD0000;
background-color: null;
font-style: inherit;">"total_cases"</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">:</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">50</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">,</span> <span class="er" style="color: #AD0000;
background-color: null;
font-style: inherit;">//</span> <span class="er" style="color: #AD0000;
background-color: null;
font-style: inherit;">총</span> <span class="er" style="color: #AD0000;
background-color: null;
font-style: inherit;">50개의</span> <span class="er" style="color: #AD0000;
background-color: null;
font-style: inherit;">테스트</span> <span class="er" style="color: #AD0000;
background-color: null;
font-style: inherit;">케이스</span></span>
<span id="cb10-6">  <span class="dt" style="color: #AD0000;
background-color: null;
font-style: inherit;">"model_config"</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">:</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">{</span></span>
<span id="cb10-7">    <span class="dt" style="color: #AD0000;
background-color: null;
font-style: inherit;">"model"</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">:</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"gpt-4"</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">,</span></span>
<span id="cb10-8">    <span class="dt" style="color: #AD0000;
background-color: null;
font-style: inherit;">"temperature"</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">:</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">0</span><span class="er" style="color: #AD0000;
background-color: null;
font-style: inherit;">.</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">7</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">,</span></span>
<span id="cb10-9">    <span class="dt" style="color: #AD0000;
background-color: null;
font-style: inherit;">"max_tokens"</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">:</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">200</span></span>
<span id="cb10-10">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">},</span></span>
<span id="cb10-11">  <span class="dt" style="color: #AD0000;
background-color: null;
font-style: inherit;">"results_output"</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">:</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"./results/test_2024_02_03_results.json"</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">,</span></span>
<span id="cb10-12">  <span class="dt" style="color: #AD0000;
background-color: null;
font-style: inherit;">"categories"</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">:</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">{</span></span>
<span id="cb10-13">    <span class="dt" style="color: #AD0000;
background-color: null;
font-style: inherit;">"normal_cases"</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">:</span> <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">[</span></span>
<span id="cb10-14">      <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">{</span></span>
<span id="cb10-15">        <span class="dt" style="color: #AD0000;
background-color: null;
font-style: inherit;">"id"</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">:</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"TC001"</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">,</span></span>
<span id="cb10-16">        <span class="dt" style="color: #AD0000;
background-color: null;
font-style: inherit;">"input"</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">:</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"제품 반품하고 싶어요"</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">,</span></span>
<span id="cb10-17">        <span class="dt" style="color: #AD0000;
background-color: null;
font-style: inherit;">"expected_behavior"</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">:</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"반품 절차 안내, 구매 날짜 확인 요청"</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">,</span></span>
<span id="cb10-18">        <span class="dt" style="color: #AD0000;
background-color: null;
font-style: inherit;">"category"</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">:</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"정상 케이스"</span></span>
<span id="cb10-19">      <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">}</span><span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">,</span></span>
<span id="cb10-20">      <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">{</span></span>
<span id="cb10-21">        <span class="dt" style="color: #AD0000;
background-color: null;
font-style: inherit;">"id"</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">:</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"TC002"</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">,</span></span>
<span id="cb10-22">        <span class="dt" style="color: #AD0000;
background-color: null;
font-style: inherit;">"input"</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">:</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"환불은 언제 되나요?"</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">,</span></span>
<span id="cb10-23">        <span class="dt" style="color: #AD0000;
background-color: null;
font-style: inherit;">"expected_behavior"</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">:</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"환불 소요 기간 안내 (영업일 기준 3-5일)"</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">,</span></span>
<span id="cb10-24">        <span class="dt" style="color: #AD0000;
background-color: null;
font-style: inherit;">"category"</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">:</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"정상 케이스"</span></span>
<span id="cb10-25">      <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">}</span></span>
<span id="cb10-26">    <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">]</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">,</span></span>
<span id="cb10-27">    <span class="dt" style="color: #AD0000;
background-color: null;
font-style: inherit;">"edge_cases"</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">:</span> <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">[</span></span>
<span id="cb10-28">      <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">{</span></span>
<span id="cb10-29">        <span class="dt" style="color: #AD0000;
background-color: null;
font-style: inherit;">"id"</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">:</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"TC015"</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">,</span></span>
<span id="cb10-30">        <span class="dt" style="color: #AD0000;
background-color: null;
font-style: inherit;">"input"</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">:</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"한달전에 산건데 반품되요?"</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">,</span></span>
<span id="cb10-31">        <span class="dt" style="color: #AD0000;
background-color: null;
font-style: inherit;">"expected_behavior"</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">:</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"30일 기한 초과 안내, 대안 제시"</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">,</span></span>
<span id="cb10-32">        <span class="dt" style="color: #AD0000;
background-color: null;
font-style: inherit;">"category"</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">:</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"경계 케이스"</span></span>
<span id="cb10-33">      <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">}</span></span>
<span id="cb10-34">    <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">]</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">,</span></span>
<span id="cb10-35">    <span class="dt" style="color: #AD0000;
background-color: null;
font-style: inherit;">"user_errors"</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">:</span> <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">[</span></span>
<span id="cb10-36">      <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">{</span></span>
<span id="cb10-37">        <span class="dt" style="color: #AD0000;
background-color: null;
font-style: inherit;">"id"</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">:</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"TC025"</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">,</span></span>
<span id="cb10-38">        <span class="dt" style="color: #AD0000;
background-color: null;
font-style: inherit;">"input"</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">:</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"반품반품"</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">,</span></span>
<span id="cb10-39">        <span class="dt" style="color: #AD0000;
background-color: null;
font-style: inherit;">"expected_behavior"</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">:</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"추가 정보 요청 (어떤 제품인지)"</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">,</span></span>
<span id="cb10-40">        <span class="dt" style="color: #AD0000;
background-color: null;
font-style: inherit;">"category"</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">:</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"불완전한 입력"</span></span>
<span id="cb10-41">      <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">}</span><span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">,</span></span>
<span id="cb10-42">      <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">{</span></span>
<span id="cb10-43">        <span class="dt" style="color: #AD0000;
background-color: null;
font-style: inherit;">"id"</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">:</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"TC026"</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">,</span></span>
<span id="cb10-44">        <span class="dt" style="color: #AD0000;
background-color: null;
font-style: inherit;">"input"</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">:</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"hwanbuㄹ해주세요"</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">,</span></span>
<span id="cb10-45">        <span class="dt" style="color: #AD0000;
background-color: null;
font-style: inherit;">"expected_behavior"</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">:</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"오타 인식 후 환불 절차 안내"</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">,</span></span>
<span id="cb10-46">        <span class="dt" style="color: #AD0000;
background-color: null;
font-style: inherit;">"category"</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">:</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"오타 포함"</span></span>
<span id="cb10-47">      <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">}</span></span>
<span id="cb10-48">    <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">]</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">,</span></span>
<span id="cb10-49">    <span class="dt" style="color: #AD0000;
background-color: null;
font-style: inherit;">"adversarial"</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">:</span> <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">[</span></span>
<span id="cb10-50">      <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">{</span></span>
<span id="cb10-51">        <span class="dt" style="color: #AD0000;
background-color: null;
font-style: inherit;">"id"</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">:</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"TC040"</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">,</span></span>
<span id="cb10-52">        <span class="dt" style="color: #AD0000;
background-color: null;
font-style: inherit;">"input"</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">:</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"반품 안 된다고? 소비자보호센터에 신고할거야"</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">,</span></span>
<span id="cb10-53">        <span class="dt" style="color: #AD0000;
background-color: null;
font-style: inherit;">"expected_behavior"</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">:</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"감정 인식, 정중하게 정책 재안내, 고객센터 연결 제안"</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">,</span></span>
<span id="cb10-54">        <span class="dt" style="color: #AD0000;
background-color: null;
font-style: inherit;">"category"</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">:</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"감정적 입력"</span></span>
<span id="cb10-55">      <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">}</span></span>
<span id="cb10-56">    <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">]</span></span>
<span id="cb10-57">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">}</span></span>
<span id="cb10-58"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">}</span></span></code></pre></div>
<p><strong>데이터셋 사용법:</strong> 1. 각 테스트 케이스에 프롬프트 실행 2. 실제 출력과 expected_behavior 비교 3. 카테고리별 성공률 계산 4. 실패 케이스 패턴 분석</p>
<p>이렇게 구조화된 데이터셋으로 체계적이고 재현 가능한 테스트를 수행한다.</p>
</section>
</section>
<section id="json-구조의-목적" class="level2" data-number="3">
<h2 data-number="3" class="anchored" data-anchor-id="json-구조의-목적"><span class="header-section-number">3</span> JSON 구조의 목적</h2>
<ul>
<li>이 JSON은 <strong>프롬프트를 체계적으로 테스트하기 위한 시험지</strong>다. 학교 시험지처럼 “쉬운 문제, 어려운 문제, 함정 문제”를 섞어놓은 것과 같다.</li>
<li>이 구조의 목적은
<ol type="1">
<li><strong>재현 가능:</strong> 누가 테스트해도 같은 50개 케이스 사용<br>
</li>
<li><strong>버전 관리:</strong> v1과 v2 비교 가능<br>
</li>
<li><strong>약점 파악:</strong> “오류 케이스에서 자주 실패” → 그 부분 프롬프트 개선<br>
</li>
<li><strong>자동화:</strong> 코드로 자동 테스트 가능</li>
</ol></li>
</ul>
<p><strong>요약:</strong> 프롬프트 테스트를 “아무렇게나 질문해보기”가 아니라 <strong>체계적인 시험</strong>으로 만드는 구조다.</p>
<section id="categories-4가지-유형으로-분류" class="level3" data-number="3.1">
<h3 data-number="3.1" class="anchored" data-anchor-id="categories-4가지-유형으로-분류"><span class="header-section-number">3.1</span> Categories: 4가지 유형으로 분류</h3>
<p><strong>normal_cases (정상 케이스)</strong></p>
<div class="sourceCode" id="cb11" style="background: #f1f3f5;"><pre class="sourceCode numberSource json number-lines code-with-copy"><code class="sourceCode json"><span id="cb11-1"><span class="er" style="color: #AD0000;
background-color: null;
font-style: inherit;">"input":</span> <span class="er" style="color: #AD0000;
background-color: null;
font-style: inherit;">"제품</span> <span class="er" style="color: #AD0000;
background-color: null;
font-style: inherit;">반품하고</span> <span class="er" style="color: #AD0000;
background-color: null;
font-style: inherit;">싶어요",</span></span>
<span id="cb11-2"><span class="er" style="color: #AD0000;
background-color: null;
font-style: inherit;">"expected_behavior":</span> <span class="er" style="color: #AD0000;
background-color: null;
font-style: inherit;">"반품</span> <span class="er" style="color: #AD0000;
background-color: null;
font-style: inherit;">절차</span> <span class="er" style="color: #AD0000;
background-color: null;
font-style: inherit;">안내,</span> <span class="er" style="color: #AD0000;
background-color: null;
font-style: inherit;">구매</span> <span class="er" style="color: #AD0000;
background-color: null;
font-style: inherit;">날짜</span> <span class="er" style="color: #AD0000;
background-color: null;
font-style: inherit;">확인</span> <span class="er" style="color: #AD0000;
background-color: null;
font-style: inherit;">요청"</span></span></code></pre></div>
<ul>
<li><strong>의미:</strong> 일반적이고 정상적인 질문</li>
<li><strong>목적:</strong> 프롬프트가 기본적인 업무를 제대로 수행하는가?</li>
<li><strong>예:</strong> 문법도 맞고, 질문도 명확한 “정상” 입력</li>
</ul>
<p><strong>edge_cases (경계 케이스)</strong></p>
<div class="sourceCode" id="cb12" style="background: #f1f3f5;"><pre class="sourceCode numberSource json number-lines code-with-copy"><code class="sourceCode json"><span id="cb12-1"><span class="er" style="color: #AD0000;
background-color: null;
font-style: inherit;">"input":</span> <span class="er" style="color: #AD0000;
background-color: null;
font-style: inherit;">"한달전에</span> <span class="er" style="color: #AD0000;
background-color: null;
font-style: inherit;">산건데</span> <span class="er" style="color: #AD0000;
background-color: null;
font-style: inherit;">반품되요?",</span></span>
<span id="cb12-2"><span class="er" style="color: #AD0000;
background-color: null;
font-style: inherit;">"expected_behavior":</span> <span class="er" style="color: #AD0000;
background-color: null;
font-style: inherit;">"30일</span> <span class="er" style="color: #AD0000;
background-color: null;
font-style: inherit;">기한</span> <span class="er" style="color: #AD0000;
background-color: null;
font-style: inherit;">초과</span> <span class="er" style="color: #AD0000;
background-color: null;
font-style: inherit;">안내,</span> <span class="er" style="color: #AD0000;
background-color: null;
font-style: inherit;">대안</span> <span class="er" style="color: #AD0000;
background-color: null;
font-style: inherit;">제시"</span></span></code></pre></div>
<ul>
<li><strong>의미:</strong> 정책의 경계선에 있는 애매한 상황<br>
</li>
<li><strong>목적:</strong> 프롬프트가 예외 상황도 잘 처리하는가?<br>
</li>
<li><strong>예:</strong> 반품 기한이 딱 지났을 때 (29일은 OK, 31일은 NO → 30일은?)</li>
</ul>
<p><strong>user_errors (사용자 오류)</strong></p>
<div class="sourceCode" id="cb13" style="background: #f1f3f5;"><pre class="sourceCode numberSource json number-lines code-with-copy"><code class="sourceCode json"><span id="cb13-1"><span class="er" style="color: #AD0000;
background-color: null;
font-style: inherit;">"input":</span> <span class="er" style="color: #AD0000;
background-color: null;
font-style: inherit;">"반품반품",</span>  <span class="er" style="color: #AD0000;
background-color: null;
font-style: inherit;">//</span> <span class="er" style="color: #AD0000;
background-color: null;
font-style: inherit;">뭘</span> <span class="er" style="color: #AD0000;
background-color: null;
font-style: inherit;">반품할지</span> <span class="er" style="color: #AD0000;
background-color: null;
font-style: inherit;">안</span> <span class="er" style="color: #AD0000;
background-color: null;
font-style: inherit;">말함</span></span>
<span id="cb13-2"><span class="er" style="color: #AD0000;
background-color: null;
font-style: inherit;">"input":</span> <span class="er" style="color: #AD0000;
background-color: null;
font-style: inherit;">"hwanbuㄹ해주세요",</span>  <span class="er" style="color: #AD0000;
background-color: null;
font-style: inherit;">//</span> <span class="er" style="color: #AD0000;
background-color: null;
font-style: inherit;">오타</span></span></code></pre></div>
<ul>
<li><strong>의미:</strong> 사용자가 실수한 불완전한 입력<br>
</li>
<li><strong>목적:</strong> 프롬프트가 오타나 불완전한 질문도 이해하는가?<br>
</li>
<li><strong>현실:</strong> 실제 사용자는 이렇게 질문한다</li>
</ul>
<p><strong>adversarial (적대적 입력)</strong></p>
<div class="sourceCode" id="cb14" style="background: #f1f3f5;"><pre class="sourceCode numberSource json number-lines code-with-copy"><code class="sourceCode json"><span id="cb14-1"><span class="er" style="color: #AD0000;
background-color: null;
font-style: inherit;">"input":</span> <span class="er" style="color: #AD0000;
background-color: null;
font-style: inherit;">"반품</span> <span class="er" style="color: #AD0000;
background-color: null;
font-style: inherit;">안</span> <span class="er" style="color: #AD0000;
background-color: null;
font-style: inherit;">된다고?</span> <span class="er" style="color: #AD0000;
background-color: null;
font-style: inherit;">소비자원에</span> <span class="er" style="color: #AD0000;
background-color: null;
font-style: inherit;">신고할거야",</span></span>
<span id="cb14-2"><span class="er" style="color: #AD0000;
background-color: null;
font-style: inherit;">"expected_behavior":</span> <span class="er" style="color: #AD0000;
background-color: null;
font-style: inherit;">"감정</span> <span class="er" style="color: #AD0000;
background-color: null;
font-style: inherit;">인식,</span> <span class="er" style="color: #AD0000;
background-color: null;
font-style: inherit;">정중하게</span> <span class="er" style="color: #AD0000;
background-color: null;
font-style: inherit;">정책</span> <span class="er" style="color: #AD0000;
background-color: null;
font-style: inherit;">재안내"</span></span></code></pre></div>
<ul>
<li><strong>의미:</strong> 화난 고객, 공격적 표현<br>
</li>
<li><strong>목적:</strong> 프롬프트가 감정적 상황도 잘 대응하는가?<br>
</li>
<li><strong>중요:</strong> 프롬프트가 싸우거나 무시하지 않고 정중하게 응대하는지 확인</li>
</ul>
</section>
<section id="각-테스트-케이스의-구조" class="level3" data-number="3.2">
<h3 data-number="3.2" class="anchored" data-anchor-id="각-테스트-케이스의-구조"><span class="header-section-number">3.2</span> 각 테스트 케이스의 구조</h3>
<div class="sourceCode" id="cb15" style="background: #f1f3f5;"><pre class="sourceCode numberSource json number-lines code-with-copy"><code class="sourceCode json"><span id="cb15-1"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">{</span></span>
<span id="cb15-2">  <span class="dt" style="color: #AD0000;
background-color: null;
font-style: inherit;">"id"</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">:</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"TC001"</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">,</span>  <span class="er" style="color: #AD0000;
background-color: null;
font-style: inherit;">//</span> <span class="er" style="color: #AD0000;
background-color: null;
font-style: inherit;">고유</span> <span class="er" style="color: #AD0000;
background-color: null;
font-style: inherit;">번호</span> <span class="er" style="color: #AD0000;
background-color: null;
font-style: inherit;">(Test</span> <span class="er" style="color: #AD0000;
background-color: null;
font-style: inherit;">Case</span> <span class="er" style="color: #AD0000;
background-color: null;
font-style: inherit;">001)</span></span>
<span id="cb15-3">  <span class="dt" style="color: #AD0000;
background-color: null;
font-style: inherit;">"input"</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">:</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"제품 반품하고 싶어요"</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">,</span>  <span class="er" style="color: #AD0000;
background-color: null;
font-style: inherit;">//</span> <span class="er" style="color: #AD0000;
background-color: null;
font-style: inherit;">사용자가</span> <span class="er" style="color: #AD0000;
background-color: null;
font-style: inherit;">입력한</span> <span class="er" style="color: #AD0000;
background-color: null;
font-style: inherit;">것</span></span>
<span id="cb15-4">  <span class="dt" style="color: #AD0000;
background-color: null;
font-style: inherit;">"expected_behavior"</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">:</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"반품 절차 안내, 구매 날짜 확인 요청"</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">,</span>  <span class="er" style="color: #AD0000;
background-color: null;
font-style: inherit;">//</span> <span class="er" style="color: #AD0000;
background-color: null;
font-style: inherit;">프롬프트가</span> <span class="er" style="color: #AD0000;
background-color: null;
font-style: inherit;">해야</span> <span class="er" style="color: #AD0000;
background-color: null;
font-style: inherit;">할</span> <span class="er" style="color: #AD0000;
background-color: null;
font-style: inherit;">일</span></span>
<span id="cb15-5">  <span class="dt" style="color: #AD0000;
background-color: null;
font-style: inherit;">"category"</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">:</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"정상 케이스"</span>  <span class="er" style="color: #AD0000;
background-color: null;
font-style: inherit;">//</span> <span class="er" style="color: #AD0000;
background-color: null;
font-style: inherit;">어떤</span> <span class="er" style="color: #AD0000;
background-color: null;
font-style: inherit;">유형인지</span></span>
<span id="cb15-6"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">}</span></span></code></pre></div>
<p><strong>id:</strong> 나중에 “TC025 실패했어요”라고 소통 가능<br>
<strong>input:</strong> 프롬프트에 넣을 입력<br>
<strong>expected_behavior:</strong> 정답은 아니지만 “이런 방향으로 답해야 한다”는 기준<br>
<strong>category:</strong> 분류 (통계 낼 때 “정상 케이스 100% 성공, 오류 케이스 70% 성공” 이런 식으로)</p>
</section>
<section id="실전-사용법-예시" class="level3" data-number="3.3">
<h3 data-number="3.3" class="anchored" data-anchor-id="실전-사용법-예시"><span class="header-section-number">3.3</span> 실전 사용법 예시</h3>
<div class="sourceCode" id="cb16" style="background: #f1f3f5;"><pre class="sourceCode numberSource python number-lines code-with-copy"><code class="sourceCode python"><span id="cb16-1"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># 1. JSON 파일 로드</span></span>
<span id="cb16-2">test_dataset <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> load_json(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"CustomerSupport_TestDataset_v1.json"</span>)</span>
<span id="cb16-3"></span>
<span id="cb16-4"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># 2. 각 케이스 실행</span></span>
<span id="cb16-5"><span class="cf" style="color: #003B4F;
background-color: null;
font-style: inherit;">for</span> case <span class="kw" style="color: #003B4F;
background-color: null;
font-style: inherit;">in</span> test_dataset[<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"categories"</span>][<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"normal_cases"</span>]:</span>
<span id="cb16-6">    prompt_output <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> run_prompt(case[<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"input"</span>])</span>
<span id="cb16-7">    </span>
<span id="cb16-8">    <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># 3. 결과 평가</span></span>
<span id="cb16-9">    <span class="cf" style="color: #003B4F;
background-color: null;
font-style: inherit;">if</span> check_behavior(prompt_output, case[<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"expected_behavior"</span>]):</span>
<span id="cb16-10">        <span class="bu" style="color: null;
background-color: null;
font-style: inherit;">print</span>(<span class="ss" style="color: #20794D;
background-color: null;
font-style: inherit;">f"✓ </span><span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">{</span>case[<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">'id'</span>]<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">}</span><span class="ss" style="color: #20794D;
background-color: null;
font-style: inherit;"> PASS"</span>)</span>
<span id="cb16-11">    <span class="cf" style="color: #003B4F;
background-color: null;
font-style: inherit;">else</span>:</span>
<span id="cb16-12">        <span class="bu" style="color: null;
background-color: null;
font-style: inherit;">print</span>(<span class="ss" style="color: #20794D;
background-color: null;
font-style: inherit;">f"✗ </span><span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">{</span>case[<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">'id'</span>]<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">}</span><span class="ss" style="color: #20794D;
background-color: null;
font-style: inherit;"> FAIL"</span>)</span>
<span id="cb16-13"></span>
<span id="cb16-14"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># 4. 통계</span></span>
<span id="cb16-15">정상 케이스 성공률: <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">95</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">%</span></span>
<span id="cb16-16">경계 케이스 성공률: <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">80</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">%</span></span>
<span id="cb16-17">오류 케이스 성공률: <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">70</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">%</span>  ← 여기가 약점<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">!</span></span></code></pre></div>
</section>
<section id="대규모-서비스-gpt-claude-bard-수준-예시" class="level3" data-number="3.4">
<h3 data-number="3.4" class="anchored" data-anchor-id="대규모-서비스-gpt-claude-bard-수준-예시"><span class="header-section-number">3.4</span> 대규모 서비스 (GPT, Claude, Bard 수준) 예시</h3>
<div class="sourceCode" id="cb17" style="background: #f1f3f5;"><pre class="sourceCode numberSource json number-lines code-with-copy"><code class="sourceCode json"><span id="cb17-1"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">{</span></span>
<span id="cb17-2">  <span class="dt" style="color: #AD0000;
background-color: null;
font-style: inherit;">"categories"</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">:</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">{</span></span>
<span id="cb17-3">    <span class="dt" style="color: #AD0000;
background-color: null;
font-style: inherit;">"normal_cases"</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">:</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">{},</span></span>
<span id="cb17-4">    <span class="dt" style="color: #AD0000;
background-color: null;
font-style: inherit;">"edge_cases"</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">:</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">{},</span></span>
<span id="cb17-5">    <span class="dt" style="color: #AD0000;
background-color: null;
font-style: inherit;">"user_errors"</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">:</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">{},</span></span>
<span id="cb17-6">    <span class="dt" style="color: #AD0000;
background-color: null;
font-style: inherit;">"adversarial"</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">:</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">{},</span></span>
<span id="cb17-7">    <span class="dt" style="color: #AD0000;
background-color: null;
font-style: inherit;">"safety_critical"</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">:</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">{</span>  <span class="er" style="color: #AD0000;
background-color: null;
font-style: inherit;">//</span> <span class="er" style="color: #AD0000;
background-color: null;
font-style: inherit;">추가</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">:</span> <span class="er" style="color: #AD0000;
background-color: null;
font-style: inherit;">안전성</span> <span class="er" style="color: #AD0000;
background-color: null;
font-style: inherit;">테스트</span></span>
<span id="cb17-8">      <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"hate_speech"</span><span class="er" style="color: #AD0000;
background-color: null;
font-style: inherit;">:</span> <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">[]</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">,</span></span>
<span id="cb17-9">      <span class="dt" style="color: #AD0000;
background-color: null;
font-style: inherit;">"personal_info_leakage"</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">:</span> <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">[]</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">,</span></span>
<span id="cb17-10">      <span class="dt" style="color: #AD0000;
background-color: null;
font-style: inherit;">"harmful_instructions"</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">:</span> <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">[]</span></span>
<span id="cb17-11">    <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">},</span></span>
<span id="cb17-12">    <span class="dt" style="color: #AD0000;
background-color: null;
font-style: inherit;">"performance"</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">:</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">{</span>  <span class="er" style="color: #AD0000;
background-color: null;
font-style: inherit;">//</span> <span class="er" style="color: #AD0000;
background-color: null;
font-style: inherit;">추가</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">:</span> <span class="er" style="color: #AD0000;
background-color: null;
font-style: inherit;">성능</span> <span class="er" style="color: #AD0000;
background-color: null;
font-style: inherit;">테스트</span></span>
<span id="cb17-13">      <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"long_context"</span><span class="er" style="color: #AD0000;
background-color: null;
font-style: inherit;">:</span> <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">[]</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">,</span></span>
<span id="cb17-14">      <span class="dt" style="color: #AD0000;
background-color: null;
font-style: inherit;">"multi_turn"</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">:</span> <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">[]</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">,</span></span>
<span id="cb17-15">      <span class="dt" style="color: #AD0000;
background-color: null;
font-style: inherit;">"latency_test"</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">:</span> <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">[]</span></span>
<span id="cb17-16">    <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">},</span></span>
<span id="cb17-17">    <span class="dt" style="color: #AD0000;
background-color: null;
font-style: inherit;">"multilingual"</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">:</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">{</span>  <span class="er" style="color: #AD0000;
background-color: null;
font-style: inherit;">//</span> <span class="er" style="color: #AD0000;
background-color: null;
font-style: inherit;">추가</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">:</span> <span class="er" style="color: #AD0000;
background-color: null;
font-style: inherit;">다국어</span> <span class="er" style="color: #AD0000;
background-color: null;
font-style: inherit;">테스트</span></span>
<span id="cb17-18">      <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"korean"</span><span class="er" style="color: #AD0000;
background-color: null;
font-style: inherit;">:</span> <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">[]</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">,</span></span>
<span id="cb17-19">      <span class="dt" style="color: #AD0000;
background-color: null;
font-style: inherit;">"english"</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">:</span> <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">[]</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">,</span></span>
<span id="cb17-20">      <span class="dt" style="color: #AD0000;
background-color: null;
font-style: inherit;">"code_switching"</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">:</span> <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">[]</span>  <span class="er" style="color: #AD0000;
background-color: null;
font-style: inherit;">//</span> <span class="er" style="color: #AD0000;
background-color: null;
font-style: inherit;">한영</span> <span class="er" style="color: #AD0000;
background-color: null;
font-style: inherit;">섞어쓰기</span></span>
<span id="cb17-21">    <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">},</span></span>
<span id="cb17-22">    <span class="dt" style="color: #AD0000;
background-color: null;
font-style: inherit;">"domain_specific"</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">:</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">{</span>  <span class="er" style="color: #AD0000;
background-color: null;
font-style: inherit;">//</span> <span class="er" style="color: #AD0000;
background-color: null;
font-style: inherit;">추가</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">:</span> <span class="er" style="color: #AD0000;
background-color: null;
font-style: inherit;">도메인별</span></span>
<span id="cb17-23">      <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"medical"</span><span class="er" style="color: #AD0000;
background-color: null;
font-style: inherit;">:</span> <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">[]</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">,</span></span>
<span id="cb17-24">      <span class="dt" style="color: #AD0000;
background-color: null;
font-style: inherit;">"legal"</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">:</span> <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">[]</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">,</span></span>
<span id="cb17-25">      <span class="dt" style="color: #AD0000;
background-color: null;
font-style: inherit;">"finance"</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">:</span> <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">[]</span></span>
<span id="cb17-26">    <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">}</span></span>
<span id="cb17-27">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">}</span></span>
<span id="cb17-28"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">}</span></span></code></pre></div>
<ul>
<li>OpenAI는 수만 개의 테스트 케이스를 사용한다고 알려짐<br>
</li>
<li>카테고리가 20~30개 이상<br>
</li>
<li>자동화된 평가 시스템 + 사람 평가 병행</li>
</ul>
<pre><code>project/
├── prompts/
│   ├── customer_support/
│   │   ├── returns_v1.txt
│   │   ├── returns_v2.txt
│   │   └── shipping_v1.txt
│   └── product_recommendation/
│       └── personalized_v3.txt
│
├── test_data/
│   ├── customer_support_returns.json
│   ├── customer_support_shipping.json
│   └── product_recommendation.json
│
├── test_configs/
│   ├── daily_regression.yaml
│   └── pre_deploy_validation.yaml
│
└── test_results/
    ├── 2024-02-01/
    ├── 2024-02-02/
    └── 2024-02-03/</code></pre>
</section>
<section id="클러스터-넷-실행과-평가-호환성-규칙-7-8-9" class="level3" data-number="3.5">
<h3 data-number="3.5" class="anchored" data-anchor-id="클러스터-넷-실행과-평가-호환성-규칙-7-8-9"><span class="header-section-number">3.5</span> 클러스터 넷: 실행과 평가, 호환성 (규칙 7, 8, 9)</h3>
<p><strong>규칙 7 — 같은 테스트 도구로 최소 열 번 이상 생성한다.</strong><br>
“확률적 응답”의 직접적인 대응이다.<br>
LLM은 같은 프롬프트를 받아도 다른 결과를 줄 수 있으므로, 한 번의 결과로는 신뢰할 수 없다.<br>
“최소 열 번”이라는 숫자는 최소한의 표본 크기를 의미한다.<br>
그리고 “같은 테스트 도구”가 강조되는 건, 변수 통제의 문제이다.<br>
“도구가 달라지면 실행 환경 자체가 달라져서 결과를 비교할 수 없다”는 뜻이다.<br>
참고로 “열 번”이라는 수준은 나중 파트에서 정량적 테스트로 넘어간다면 N &gt; 100 수준으로 올라간다.<br>
규칙 7은 최소한의 기준이고, 진짜 신뢰할 수 있는 수준은 더 높다.</p>
<p><strong>예시:</strong></p>
<p><strong>테스트 시나리오:</strong> - 프롬프트: ProductRecommender_v2 - 입력: “20대 여성, 최근 운동화 구매 이력” - 도구: OpenAI Playground (GPT-4, temperature=0.7)</p>
<p><strong>10회 실행 결과 기록:</strong></p>
<table class="table">
<thead>
<tr class="header">
<th>실행</th>
<th>추천 1</th>
<th>추천 2</th>
<th>추천 3</th>
<th>응답 시간</th>
<th>형식 오류</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td>1</td>
<td>요가매트</td>
<td>레깅스</td>
<td>물병</td>
<td>2.3s</td>
<td>없음</td>
</tr>
<tr class="even">
<td>2</td>
<td>러닝화</td>
<td>스포츠브라</td>
<td>양말</td>
<td>2.1s</td>
<td>없음</td>
</tr>
<tr class="odd">
<td>3</td>
<td>레깅스</td>
<td>헬스장가방</td>
<td>물병</td>
<td>2.5s</td>
<td>없음</td>
</tr>
<tr class="even">
<td>4</td>
<td>요가매트</td>
<td>레깅스</td>
<td>물병</td>
<td>2.2s</td>
<td>없음</td>
</tr>
<tr class="odd">
<td>5</td>
<td>운동복</td>
<td>물병</td>
<td>양말</td>
<td>2.4s</td>
<td>없음</td>
</tr>
<tr class="even">
<td>6</td>
<td>레깅스</td>
<td>운동복</td>
<td>헬스장가방</td>
<td>2.3s</td>
<td>없음</td>
</tr>
<tr class="odd">
<td>7</td>
<td>물병</td>
<td>요가매트</td>
<td>레깅스</td>
<td>2.6s</td>
<td>없음</td>
</tr>
<tr class="even">
<td>8</td>
<td>러닝화</td>
<td>양말</td>
<td>물병</td>
<td>2.1s</td>
<td>없음</td>
</tr>
<tr class="odd">
<td>9</td>
<td>레깅스</td>
<td>스포츠브라</td>
<td>물병</td>
<td>2.2s</td>
<td>없음</td>
</tr>
<tr class="even">
<td>10</td>
<td>헬스장가방</td>
<td>요가매트</td>
<td>운동복</td>
<td>2.4s</td>
<td>없음</td>
</tr>
</tbody>
</table>
<p><strong>분석:</strong> - 가장 자주 추천된 항목: 레깅스(6회), 물병(7회), 요가매트(4회) - 일관성: 모두 운동/피트니스 카테고리 (100% 일관) - 다양성: 총 9가지 서로 다른 제품 제안 (충분한 다양성) - 응답 시간: 평균 2.3s (목표 3s 이내 달성) - 형식 오류: 0건 (안정성 확보)</p>
<p><strong>결론:</strong><br>
10회 반복 테스트를 통해 프롬프트가 일관되게 관련 제품을 추천하며, 형식 오류 없이 안정적으로 작동함을 확인했다.<br>
단, 한 번만 테스트했다면 이런 패턴과 안정성을 파악할 수 없었을 것이다.</p>
<p><strong>규칙 8 — 최소 세 명의 작업 관계자가 평가에 참여한다.</strong><br>
“정답이 없다”는 현실에서, 평가는 불가피하게 평가자의 주관을 포함한다.<br>
한 사람의 판단만으로는 그 주관이 편향이 되는지, 유효한 시각이 되는지 구분이 안 된다.<br>
세 명 이상이면 단일 편향의 영향이 줄어든다.<br>
이건 학술 논문의 동료 심사(peer review) 구조와 동일한 논리를 프롬프트 평가에 적용한 것이다.</p>
<p><strong>예시:</strong></p>
<p><strong>평가 시나리오:</strong> - 프롬프트: CustomerSupport_Returns_v2 - 테스트 케이스: “한달전에 산건데 반품되요?” - 응답: “구매하신 지 30일이 지나 반품 기한이 지났습니다. 하지만 제품에 하자가 있다면 AS 접수가 가능합니다. 제품 상태를 확인해주시겠어요?”</p>
<p><strong>평가자별 채점 (5점 척도 루브릭):</strong></p>
<table class="table">
<colgroup>
<col style="width: 15%">
<col style="width: 21%">
<col style="width: 27%">
<col style="width: 27%">
<col style="width: 8%">
</colgroup>
<thead>
<tr class="header">
<th>평가 기준</th>
<th>평가자 A (PM)</th>
<th>평가자 B (CS팀장)</th>
<th>평가자 C (개발자)</th>
<th>평균</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td>정확성</td>
<td>5</td>
<td>5</td>
<td>5</td>
<td>5.0</td>
</tr>
<tr class="even">
<td>친절함</td>
<td>4</td>
<td>5</td>
<td>3</td>
<td>4.0</td>
</tr>
<tr class="odd">
<td>명확성</td>
<td>5</td>
<td>4</td>
<td>5</td>
<td>4.7</td>
</tr>
<tr class="even">
<td>대안 제시</td>
<td>4</td>
<td>5</td>
<td>4</td>
<td>4.3</td>
</tr>
<tr class="odd">
<td><strong>총점</strong></td>
<td><strong>4.5</strong></td>
<td><strong>4.75</strong></td>
<td><strong>4.25</strong></td>
<td><strong>4.5</strong></td>
</tr>
</tbody>
</table>
<p><strong>평가자별 코멘트:</strong></p>
<ul>
<li><strong>평가자 A (Product Manager):</strong> “정책을 명확히 전달하면서도 대안(AS)을 제시해 좋다. 친절함은 조금 더 개선 가능.”</li>
<li><strong>평가자 B (Customer Support 팀장):</strong> “실제 고객 응대 관점에서 매우 적절. ’하지만’으로 연결해 부정적 정보를 완화한 점이 좋다.”</li>
<li><strong>평가자 C (개발자):</strong> “논리적으로 정확하고 명확하다. 다만 ’확인해주시겠어요?’가 다소 형식적으로 느껴질 수 있음.”</li>
</ul>
<p><strong>합의 결과:</strong> - 전체 평가: Pass (평균 4.5/5.0) - 개선 제안: “확인해주시겠어요?” → “어떤 문제가 있으신가요?”로 더 공감적인 표현 검토</p>
<p><strong>단일 평가자의 위험:</strong> 만약 평가자 C만 평가했다면 “친절함 3점”이 유일한 점수가 되어 실제보다 낮게 평가될 수 있었다.<br>
세 명의 평가로 균형 잡힌 시각을 확보했다.</p>
<p><strong>규칙 9 — 다양한 언어 모델 버전을 사용하여 테스트한다.</strong><br>
세 번째 어려움, “LLM은 빠르게 변한다”의 실천적 대응이다.<br>
하나의 모델에서만 잘 작동하는 프롬프트는 그 모델이 업데이트되거나 더 이상 사용되지 않을 때 바로 취약해진다.<br>
다양한 모델에서 테스트하는 건, 프롬프트의 <strong>내재적 품질</strong>을 확인하는 것이다.<br>
특정 모델의 특성에 의존하는 게 아니라, 프롬프트 자체의 논리와 구조가 충분히 강한지를 판단한다.</p>
<p><strong>예시:</strong></p>
<p><strong>테스트 대상 프롬프트: EmailGenerator_Marketing_v3</strong></p>
<p>프롬프트 내용:</p>
<pre><code>You are a marketing email writer. Create a promotional email for {{PRODUCT_NAME}} 
that highlights its key benefits and includes a clear call-to-action.

Email should be:
- Professional yet friendly tone
- 150-200 words
- Include subject line
- End with a CTA button text suggestion</code></pre>
<p><strong>다중 모델 테스트 결과:</strong></p>
<table class="table">
<colgroup>
<col style="width: 10%">
<col style="width: 10%">
<col style="width: 13%">
<col style="width: 18%">
<col style="width: 18%">
<col style="width: 17%">
<col style="width: 10%">
</colgroup>
<thead>
<tr class="header">
<th>모델</th>
<th>버전</th>
<th>성공률</th>
<th>평균 길이</th>
<th>톤 일관성</th>
<th>CTA 포함</th>
<th>비고</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td>GPT-3.5</td>
<td>turbo</td>
<td>85%</td>
<td>175 단어</td>
<td>높음</td>
<td>100%</td>
<td>때때로 과도하게 캐주얼</td>
</tr>
<tr class="even">
<td>GPT-4</td>
<td>standard</td>
<td>95%</td>
<td>180 단어</td>
<td>매우 높음</td>
<td>100%</td>
<td>가장 안정적</td>
</tr>
<tr class="odd">
<td>GPT-4</td>
<td>turbo</td>
<td>90%</td>
<td>165 단어</td>
<td>높음</td>
<td>95%</td>
<td>CTA 가끔 누락</td>
</tr>
<tr class="even">
<td>Claude 3</td>
<td>Opus</td>
<td>90%</td>
<td>190 단어</td>
<td>높음</td>
<td>100%</td>
<td>더 형식적 톤 경향</td>
</tr>
<tr class="odd">
<td>Claude 3</td>
<td>Sonnet</td>
<td>80%</td>
<td>160 단어</td>
<td>중간</td>
<td>90%</td>
<td>길이 제약 덜 준수</td>
</tr>
<tr class="even">
<td>Gemini</td>
<td>1.5 Pro</td>
<td>75%</td>
<td>140 단어</td>
<td>중간</td>
<td>85%</td>
<td>짧고 직설적, 제목 생략 경향</td>
</tr>
</tbody>
</table>
<p><strong>분석:</strong></p>
<ol type="1">
<li><strong>모델 간 성능 차이:</strong>
<ul>
<li>GPT-4 standard에서 가장 높은 성공률 (95%)</li>
<li>Gemini 1.5 Pro에서 가장 낮은 성공률 (75%)</li>
<li>20%p 차이 → 프롬프트가 특정 모델에 과최적화되지 않았음</li>
</ul></li>
<li><strong>일관된 약점:</strong>
<ul>
<li>모든 모델에서 때때로 150단어 미만 생성 (특히 Gemini)</li>
<li>CTA 누락이 가장 빈번한 문제점</li>
</ul></li>
<li><strong>개선 방향:</strong>
<ul>
<li>CTA 요구사항을 더 명시적으로 강조</li>
<li>“MUST include” 같은 강제 키워드 추가 검토</li>
<li>길이 제약을 “Aim for 150-200 words (minimum 150)” 으로 명확화</li>
</ul></li>
</ol>
<p><strong>결론:</strong><br>
이 프롬프트는 대부분의 주요 모델에서 75% 이상 작동하므로 <strong>모델 독립적</strong>이다.<br>
하지만 Gemini에서의 낮은 성능은 프롬프트 개선 여지를 시사한다.<br>
만약 GPT-4에서만 테스트했다면, Gemini에서의 문제를 사전에 발견하지 못했을 것이다.</p>
</section>
</section>
<section id="프롬프트-평가-어려움에-대한-연결선" class="level2" data-number="4">
<h2 data-number="4" class="anchored" data-anchor-id="프롬프트-평가-어려움에-대한-연결선"><span class="header-section-number">4</span> 프롬프트 평가 어려움에 대한 연결선</h2>
<p>아홉 규칙이 왜 이런 형태인지 정리하면, 세 어려움과 규칙 사이에 직접적인 대응이 있다.<br>
- 확률적 응답이라는 문제 -&gt; 규칙 1과 규칙 7로 대응.<br>
- 정답 없다는 문제 -&gt; 규칙 4와 규칙 8로 대응.<br>
- 모델이 빠르게 변한다는 문제 -&gt; 규칙 2, 3과 규칙 9로 대응.</p>
<p>그리고 규칙 5와 6은 세 어려움 모두에 공통적으로 작용하는 현실성 보장 장치이다.<br>
테스트 데이터 자체가 현실과 달라지면, 어떤 규칙을 아무리 잘 적용해도 의미가 없다.</p>
</section>
<section id="문서화-텍스트-이상의-것" class="level2" data-number="5">
<h2 data-number="5" class="anchored" data-anchor-id="문서화-텍스트-이상의-것"><span class="header-section-number">5</span> 문서화: 텍스트 이상의 것</h2>
<p>규칙 4에서 “문서화하다”라고 했는데, 이 문서화가 구체적으로 무엇을 의미하는지를 살펴본다.</p>
<section id="프롬프트-원문-보존" class="level3" data-number="5.1">
<h3 data-number="5.1" class="anchored" data-anchor-id="프롬프트-원문-보존"><span class="header-section-number">5.1</span> 프롬프트 원문 보존</h3>
<p>프롬프트 텍스트 블록의 구성 요소<br>
- Introduction - Response template - Ending</p>
<div class="sourceCode" id="cb20" style="background: #f1f3f5;"><pre class="sourceCode numberSource text number-lines code-with-copy"><code class="sourceCode"><span id="cb20-1">[Introduction]</span>
<span id="cb20-2">You are a customer support assistant specializing in product returns.</span>
<span id="cb20-3"></span>
<span id="cb20-4">[Response template]</span>
<span id="cb20-5">When a user asks about returns:</span>
<span id="cb20-6">1. First, confirm the product and purchase date</span>
<span id="cb20-7">2. Explain the return policy (30-day window)</span>
<span id="cb20-8">3. Provide step-by-step return instructions</span>
<span id="cb20-9"></span>
<span id="cb20-10">[Ending]</span>
<span id="cb20-11">Maintain a friendly and professional tone throughout.</span></code></pre></div>
<p>이건 당연하다고 생각하기 쉽지만, 프롬프트를 ChatGPT에 붙여넣고 사용하는 사람은 이 <strong>원문(LLM에 실제로 입력하는 프롬프트 텍스트 전체)</strong>를 별도로 저장하지 않는 경우가 많다.</p>
<p>많은 사람이 ChatGPT 창에 이런 프롬프트를 입력하고 사용하지만, 그 텍스트를 별도 파일로 저장하지 않는다는 것이다. 나중에 “어떤 프롬프트로 테스트했지?”라고 되돌아볼 때, 원문이 없으면 정확한 재현이 불가능하다.</p>
</section>
<section id="모델-파라미터" class="level3" data-number="5.2">
<h3 data-number="5.2" class="anchored" data-anchor-id="모델-파라미터"><span class="header-section-number">5.2</span> 모델 파라미터</h3>
<p>프롬프트 원문만 저장하면 충분한가? 아니다. <strong>LLM 실행 설정값</strong>도 함께 기록해야 한다.</p>
<p>예시로 보면: - <code>model=GPT-3.5-turbo</code> (어떤 모델을 사용했는지) - <code>max_tokens=200</code> (최대 응답 길이) - <code>temperature=0.5</code> (응답의 랜덤성 정도) - <code>frequency_penalty=1</code> (반복 단어 억제) - <code>presence_penalty=1</code> (새로운 주제 도입 촉진)</p>
<p><strong>왜 이것들을 기록해야 하나?</strong></p>
<p>같은 프롬프트라도 <code>temperature=0.5</code>와 <code>temperature=0.8</code>은 완전히 다른 결과를 만든다.</p>
<p><strong>실제 예시:</strong></p>
<p>프롬프트: “3가지 여행지를 추천해줘”</p>
<p><code>temperature=0.2</code> (낮음, 일관적):</p>
<pre><code>1. 제주도 - 자연 경관과 해변
2. 부산 - 도시와 바다의 조화
3. 경주 - 역사 문화 유적</code></pre>
<p><code>temperature=0.9</code> (높음, 창의적):</p>
<pre><code>1. 울릉도 - 신비한 섬
2. 담양 죽녹원 - 대나무 숲길
3. 강원도 정선 - 레일바이크</code></pre>
<p>같은 질문, 같은 프롬프트인데 <strong>파라미터만 달라져도</strong> 추천 목록이 완전히 바뀐다.</p>
<p><strong>문제 상황:</strong></p>
<p>1달 후 팀원이 “저번에 테스트한 그 프롬프트 다시 돌려봤는데 결과가 달라요”라고 한다.<br>
프롬프트 원문만 있고 파라미터 기록이 없다면? <strong>재현 불가능</strong>하다.</p>
<p>어떤 설정으로 돌렸는지 모르니, 결과가 다른 이유가: - 프롬프트 문제인지 - 파라미터 문제인지 - 모델 업데이트 때문인지</p>
<p>구분할 수 없다. 이게 재현가능성(reproducibility)을 위해 파라미터를 기록하는 이유다.</p>
</section>
<section id="프롬프트의-메타-데이터-템플릿" class="level3" data-number="5.3">
<h3 data-number="5.3" class="anchored" data-anchor-id="프롬프트의-메타-데이터-템플릿"><span class="header-section-number">5.3</span> 프롬프트의 메타 데이터 템플릿</h3>
<p>프롬프트 원문과 파라미터 외에 <strong>프롬프트의 메타데이터</strong>도 함께 기록한다: - 프롬프트 유형 (음식 추천, 고객 지원, 코드 생성 등) - 제목 (CustomerSupport_Returns_v2) - 설명 (어떤 상황에서 사용하는가) - <strong>기대 결과</strong> (중요!) - 작업 과정 (설계 의도와 결정 이유) - 기타 메모</p>
<pre><code># 프롬프트 메타데이터 파일 예시
---
prompt_id: "CustomerSupport_Returns_v2" # 프롬프트 고유 ID 또는 제목
prompt_type: "고객 지원" # 프롬프트 유형 
created_date: "2026-02-01"
author: "홍길동"

description: | # 설명
  이커머스 고객 지원 챗봇. 
  제품 반품 관련 문의에 응답한다.
  30일 반품 정책 기반.

expected_results: # 기대 결과
  - 반품 정책을 명확히 설명 (30일 이내)
  - 구매 날짜와 제품 정보 확인 요청
  - 단계별 반품 절차 안내
  - 응답 시간 3초 이내
  - 친절하고 전문적인 톤 유지

design_decisions: | # 작업 과정 기록
  2026-02-01: 구조화된 단계 제시 방식 채택
  - 이유: 사용자가 따라하기 쉽고 누락 없음
  - 대안: 산문체 설명 방식 (거부, 너무 길어짐)
  
  Q&amp;A 형식은 고려했으나 채택 안 함
  - 이유: 모든 경우의 수를 커버 불가

notes: | # 기타 메모
  - 실제 반품 처리는 별도 시스템 연동 필요
  - 해외 배송은 이 프롬프트 범위 밖
  - v1 대비 개선: "대안 제시" 추가 (AS, 교환)
---
</code></pre>
<p>여기서 <strong>“기대 결과”</strong>가 핵심이다.</p>
<p><strong>나쁜 기대 결과 (모호함):</strong></p>
<pre><code>이 프롬프트는 음식 추천을 한다.</code></pre>
<p>이건 그냥 기능 설명이다. 테스트 후 “성공했나?”를 어떻게 판단할까? 애매하다.</p>
<p><strong>좋은 기대 결과 (구체적 기준):</strong></p>
<pre><code>1. 정확히 3개의 음식을 추천해야 한다
2. 3개는 서로 다른 카테고리여야 한다 (중복 불가)
3. 각 추천마다 이유를 1-2문장으로 설명한다
4. 특수문자나 이모지가 포함되면 안 된다
5. 응답 시간은 3초 이내여야 한다</code></pre>
<p>이제 테스트 결과를 볼 때:</p>
<p><strong>프롬프트 응답:</strong></p>
<pre><code>1. 삼계탕 - 보양식으로 좋습니다
2. 냉면 - 여름에 시원하게
3. 비빔밥 🍚 - 다양한 야채</code></pre>
<p><strong>평가:</strong> - ✓ 3개 추천 (Pass) - ✓ 서로 다른 카테고리 (Pass) - ✓ 이유 설명 (Pass) - ✗ 이모지 포함 (🍚) (Fail) - ✓ 2.1초 응답 (Pass)</p>
<p><strong>결과: Fail</strong> (기준 4 미달)</p>
<p>이렇게 구체적인 기대 결과가 있으면: - 테스트 후 “통과/실패”를 명확히 판단 가능 - 어떤 부분이 문제인지 바로 파악 (이모지 제거 필요) - 주관적 판단 배제 (누가 봐도 Fail)</p>
<p>기대 결과가 없으면? “음, 괜찮은 것 같은데?” 같은 애매한 평가만 남는다.</p>
<p><strong>작업 과정 기록: 설계 중 고려한 이슈와 의사결정이 들어간다.</strong></p>
<p><strong>예시 상황:</strong></p>
<p>음식 추천 프롬프트를 만들 때 두 가지 선택지가 있었다:</p>
<p>A안: 실시간으로 맛집 리뷰 사이트를 검색해서 추천<br>
B안: 사전에 정리된 음식 목록에서 추천</p>
<p>팀은 <strong>B안을 선택</strong>했다. <strong>작업 과정 기록:</strong></p>
<pre><code>의사결정 기록 (2026-02-01)
-----------------------------------
문제: 실시간 검색 vs 사전 목록 중 선택
결정: 사전 목록 방식 채택

이유:
1. 실시간 검색은 응답 시간이 5-10초로 느림 (목표 3초 초과)
2. 외부 API 의존성으로 안정성 저하 위험
3. 검색 결과 품질이 프롬프트로 제어 불가

트레이드오프:
- 장점: 빠른 응답(2초), 안정적 작동
- 단점: 최신 맛집 반영 안 됨 (월 1회 수동 업데이트)

대안 검토:
- 향후 캐싱 방식으로 실시간 검색 재검토 가능</code></pre>
<ul>
<li>왜 이런 기록이 중요한가?
<ul>
<li>소프트웨어 엔지니어링의 <strong>ADR(Architecture Decision Record)</strong> 개념 때문이다.</li>
<li>결정만 남기는 게 아니라 <strong>왜 그렇게 결정했는지</strong>를 함께 남긴다</li>
<li>가령, 3개월 후 새로운 팀원이 “왜 실시간 검색 안 하나요? 그게 더 좋지 않나요?”라고 물어본다.<br>
</li>
</ul></li>
<li>작업 과정 기록이 있으면:
<ul>
<li>→ “응답 시간 3초 목표 때문에 포기했어요. 대신 월 1회 목록 업데이트로 보완합니다”<br>
</li>
<li>→ 명확한 답변, 논의 5분 종료<br>
</li>
</ul></li>
<li>작업 과정 기록이 없으면:
<ul>
<li>→ “음… 그때 뭔가 이유가 있었던 것 같은데…”<br>
</li>
<li>→ 다시 회의 소집, 같은 논의 반복, 1시간 낭비<br>
</li>
</ul></li>
<li>나중에 프롬프트를 수정할 때, 이 기록을 보면:
<ul>
<li>“실시간 검색을 추가하려면 응답 시간 목표를 조정해야 하는구나”<br>
</li>
<li>“캐싱 방식이 좋은 대안일 수 있겠다”</li>
</ul></li>
</ul>
<p>같은 이슈를 반복해서 고민하지 않고, 이전 맥락 위에서 발전시킬 수 있다.</p>
</section>
</section>
<section id="테스트-데이터셋-약점-지도-그리기" class="level2" data-number="6">
<h2 data-number="6" class="anchored" data-anchor-id="테스트-데이터셋-약점-지도-그리기"><span class="header-section-number">6</span> 테스트 데이터셋: 약점 지도 그리기</h2>
<ul>
<li>규칙 5와 6에서 “실제 데이터를 사용하라”고 했다.<br>
</li>
<li>그런데 <strong>어떤</strong> 실제 데이터를 골라야 하나?<br>
</li>
<li>무작위로 100개 뽑으면 될까? 아니다. <strong>전략적으로 구성</strong>해야 한다.</li>
</ul>
<section id="테스트-데이터셋-구성의-5가지-원칙" class="level3" data-number="6.1">
<h3 data-number="6.1" class="anchored" data-anchor-id="테스트-데이터셋-구성의-5가지-원칙"><span class="header-section-number">6.1</span> 테스트 데이터셋 구성의 5가지 원칙</h3>
<ul>
<li>5가지 원칙: 테스트 데이터를 “어떻게 선택할지”의 기준<br>
</li>
<li>모든 원칙이 동시에 교차 적용되어야한다. 예를 들어,
<ul>
<li>원칙 1: “반품 40%, 배송 30%, 환불 20%” 같은 실제 사용 빈도를 테스트 데이터에 반영한다. (이렇게 하면 전체 사용자 질문의 80%를 커버)</li>
<li>원칙 2-5: 각 카테고리 안에서 정상/경계/오류/한계를 섞어라</li>
</ul></li>
<li>이 5가지 원칙을 모두 적용해야, 프롬프트의 <strong>강점과 약점</strong>을 정확히 파악할 수 있다.</li>
</ul>
<section id="대표적이고-빈번한-실제-사용자-발화" class="level4" data-number="6.1.1">
<h4 data-number="6.1.1" class="anchored" data-anchor-id="대표적이고-빈번한-실제-사용자-발화"><span class="header-section-number">6.1.1</span> 대표적이고 빈번한 실제 사용자 발화</h4>
<ul>
<li>가장 자주 일어나는 사용 패턴부터 커버한다.</li>
</ul>
<p><strong>예시 (고객 지원 챗봇):</strong></p>
<p>실제 사용 통계: - “반품하고 싶어요” 유형: 40% - “배송 조회” 유형: 30% - “환불 문의” 유형: 20% - 기타: 10%</p>
<p>테스트 데이터 50개 구성: - 반품 관련: 20개 (40%) - 배송 관련: 15개 (30%) - 환불 관련: 10개 (20%) - 기타: 5개 (10%)</p>
<p><strong>목적:</strong> 실제 사용 빈도를 반영해서, 80% 이상의 실제 상황을 커버한다.</p>
<p>이게 <strong>정상 범주의 커버리지</strong>다.</p>
</section>
<section id="다양하고-포괄적인-내용" class="level4" data-number="6.1.2">
<h4 data-number="6.1.2" class="anchored" data-anchor-id="다양하고-포괄적인-내용"><span class="header-section-number">6.1.2</span> 다양하고 포괄적인 내용</h4>
<ul>
<li>사용자가 할 수 있는 <strong>모든 종류</strong>의 질문을 포함한다.</li>
</ul>
<p><strong>나쁜 예 (다양성 부족):</strong></p>
<pre><code>"반품하고 싶어요"
"제품 반품 가능한가요?"
"반품 절차 알려주세요"
"반품하려고요"</code></pre>
<p>→ 전부 반품만 물어봄. 배송, 환불, 제품 문의는?</p>
<p><strong>좋은 예 (다양성 확보):</strong></p>
<pre><code>- 반품: "반품하고 싶어요"
- 배송: "언제 도착하나요?"
- 환불: "환불 기간은?"
- 제품 정보: "사이즈 어떻게 되나요?"
- 계정 문제: "로그인이 안 돼요"
- 할인/쿠폰: "할인 코드 사용법"</code></pre>
<p><strong>목적:</strong><br>
* 한 유형만 테스트하면, 다른 유형에서 실패할 수 있다.<br>
* 프롬프트가 “반품”에만 특화되어 있고 “배송 조회”는 제대로 못 할 수 있다. * 다양한 유형을 모두 테스트해야 프롬프트의 <strong>전체 범위</strong>를 확인 가능하다.</p>
</section>
<section id="예상치-못한-사항-포함" class="level4" data-number="6.1.3">
<h4 data-number="6.1.3" class="anchored" data-anchor-id="예상치-못한-사항-포함"><span class="header-section-number">6.1.3</span> 예상치 못한 사항 포함</h4>
<p><strong>여기서 테스트 성격이 바뀐다.</strong></p>
<p>앞의 1, 2번은 “프롬프트가 잘 작동하는 경우를 확인”하는 것이다.<br>
3번부터는 “프롬프트가 <strong>실패할 만한 경우를 의도적으로 찾는</strong>” 것이다.</p>
<p><strong>예시:</strong></p>
<p>정상 케이스:</p>
<pre><code>"반품하고 싶어요" → 프롬프트가 잘 처리함</code></pre>
<p>예상치 못한 케이스:</p>
<pre><code>"반품하고 싶은데 영수증을 잃어버렸어요"
"선물받은 건데 반품 되나요?"
"해외 배송인데 반품 비용은요?"</code></pre>
<p>이런 질문들은: - 기본 반품 정책만으로는 답변 어려움 - 예외 상황 처리 능력 테스트 - 프롬프트에 추가 지침이 필요한지 판단 가능</p>
<p><strong>목적:</strong> “매뉴얼대로만” 하는 프롬프트는 현실에서 약하다.<br>
예상 밖 상황도 잘 처리하는지 확인한다.</p>
</section>
<section id="사용자-오류-패턴" class="level4" data-number="6.1.4">
<h4 data-number="6.1.4" class="anchored" data-anchor-id="사용자-오류-패턴"><span class="header-section-number">6.1.4</span> 사용자 오류 패턴</h4>
<p><strong>핵심:</strong> 실제 사용자는 완벽하게 질문하지 않는다.</p>
<p><strong>완벽한 질문 (이론):</strong></p>
<pre><code>"구매한 제품을 반품하고 싶습니다. 절차를 알려주세요."</code></pre>
<p>→ 문법 완벽, 의도 명확</p>
<p><strong>실제 질문 (현실):</strong></p>
<pre><code>"반품반품" (뭘 반품할지 안 말함)
"hwanbuㄹ해주세요" (오타)
"저번에 산거요 그거" (맥락 부족)
"반품 ㅎㅎ" (불명확한 의도)</code></pre>
<p>프롬프트가 깔끔한 질문에만 잘 작동하면: - 실전에서는 자주 실패한다 - “무슨 말인지 모르겠습니다” 같은 쓸모없는 답변만 반복</p>
<p><strong>좋은 프롬프트는:</strong> - 오타를 이해한다: “hwanbuㄹ” → “환불”로 인식 - 불완전한 질문에 추가 질문: “어떤 제품을 반품하시나요?” - 맥락 추론: “저번에 산거” → 최근 구매 내역 확인 제안</p>
<p><strong>목적:</strong> 오류 패턴을 테스트 데이터에 넣어서, 프롬프트가 <strong>관대하게(robustly)</strong> 작동하는지 확인한다.</p>
</section>
<section id="llm의-한계가-드러난-발화" class="level4" data-number="6.1.5">
<h4 data-number="6.1.5" class="anchored" data-anchor-id="llm의-한계가-드러난-발화"><span class="header-section-number">6.1.5</span> LLM의 한계가 드러난 발화</h4>
<p><strong>핵심:</strong> 이건 <strong>프롬프트 문제가 아니라 모델 자체의 약점</strong>이다.</p>
<p><strong>LLM이 약한 영역:</strong> - 최신 정보: “2026년 2월 4일 날씨는?” (학습 데이터 이후) - 복잡한 수학: “17 × 23 + 89 ÷ 3 = ?” - 한국어 특이 표현: “그거 있잖아, 그 뭐냐, 그거, 그게 아니라, 아니 내말은, 그게 아니고, 등” - 개인 정보: “내 주문 내역 보여줘” (데이터베이스 연동 필요)</p>
<p><strong>예시 상황:</strong></p>
<p>프롬프트: 고객 지원 챗봇<br>
질문: “오늘 배송 가능한가요?” (오늘 = 2026년 2월 4일)</p>
<p>프롬프트가 아무리 잘 작성되어도: - GPT-4는 학습 데이터가 2023년까지 (최신 날짜 모름) - “오늘”이 언제인지 알 수 없음 - 잘못된 답변 가능성</p>
<p><strong>이걸 테스트 데이터에 왜 포함하나?</strong></p>
<p>목적: 1. <strong>프롬프트 vs 모델 한계 구분</strong> - 실패 이유가 프롬프트 때문인지, 모델 한계 때문인지 파악</p>
<ol start="2" type="1">
<li><strong>보완책 설계</strong>
<ul>
<li>“최신 정보는 외부 API 연동 필요”</li>
<li>“날짜 관련 질문은 사전 처리 필요”</li>
</ul></li>
<li><strong>사용자 기대 관리</strong>
<ul>
<li>“이런 질문은 현재 모델로 처리 불가” 명시</li>
<li>서비스 범위 명확화</li>
</ul></li>
</ol>
<p><strong>정리:</strong></p>
<p>테스트 데이터셋은 “프롬프트가 잘 작동하는 사례 모음집”이 아니다.<br>
<strong>프롬프트의 약점이 어디 있는지 드러내는 지도</strong>다.</p>
<p>5가지 원칙으로 구성하면: - 정상 케이스 커버 (1, 2번) - 경계 상황 발견 (3번) - 오류 내성 확인 (4번) - 모델 한계 파악 (5번)</p>
<p>결과: 프롬프트의 강점과 약점을 정확히 아는 지도를 얻는다.</p>
</section>
<section id="예시" class="level4" data-number="6.1.6">
<h4 data-number="6.1.6" class="anchored" data-anchor-id="예시"><span class="header-section-number">6.1.6</span> 예시</h4>
<div class="sourceCode" id="cb34" style="background: #f1f3f5;"><pre class="sourceCode numberSource 예시1 number-lines code-with-copy"><code class="sourceCode"><span id="cb34-1">1. 반품 관련 20개 (빈도 40% 반영 - 원칙 1)</span>
<span id="cb34-2">    ├─ 정상: "반품하고 싶어요" (10개)</span>
<span id="cb34-3">    ├─ 경계: "31일 지났는데 반품 되나요?" (3개) - 원칙 3</span>
<span id="cb34-4">    ├─ 오류: "반품반품" (4개) - 원칙 4</span>
<span id="cb34-5">    └─ LLM한계: "오늘 주문 반품 가능?" (3개) - 원칙 5</span>
<span id="cb34-6"></span>
<span id="cb34-7">2. 배송 조회 15개 (빈도 30% 반영 - 원칙 1)</span>
<span id="cb34-8">    ├─ 정상: "언제 도착하나요?" (8개)</span>
<span id="cb34-9">    ├─ 경계: "해외 배송 기간은요?" (2개) - 원칙 3</span>
<span id="cb34-10">    ├─ 오류: "배송ㅇ" (3개) - 원칙 4</span>
<span id="cb34-11">    └─ LLM한계: "실시간 위치 추적" (2개) - 원칙 5</span>
<span id="cb34-12"></span>
<span id="cb34-13">3. 환불 문의 10개 (빈도 20% 반영 - 원칙 1)</span>
<span id="cb34-14">    ├─ 정상: "환불 절차 알려줘" (5개)</span>
<span id="cb34-15">    ├─ 경계: "카드 취소했는데 언제 입금돼?" (2개) - 원칙 3</span>
<span id="cb34-16">    ├─ 오류: "hwanbuㄹ" (2개) - 원칙 4</span>
<span id="cb34-17">    └─ LLM한계: "내 통장 잔고 확인해줘" (1개) - 원칙 5</span>
<span id="cb34-18"></span>
<span id="cb34-19">4. 기타 카테고리 5개 (다양성 확보 - 원칙 2)</span>
<span id="cb34-20">    ├─ 제품 정보: "사이즈 표 어디 있나요?"</span>
<span id="cb34-21">    ├─ 계정 문제: "로그인이 안 돼요"</span>
<span id="cb34-22">    └─ 할인/쿠폰: "쿠폰 적용이 안 됩니다"</span></code></pre></div>
<div class="sourceCode" id="cb35" style="background: #f1f3f5;"><pre class="sourceCode numberSource 예시2 number-lines code-with-copy"><code class="sourceCode"><span id="cb35-1">1. 표준화 알고리즘 QnA 40개 (빈도 40% 반영 - 원칙 1)</span>
<span id="cb35-2">   * (원칙 2: 알고리즘의 단계별, 유형별 질문을 다양하게 구성)</span>
<span id="cb35-3">   ├─ 정상: "A 알고리즘의 2단계 전처리 과정을 설명해줘" (20개)</span>
<span id="cb35-4">   ├─ 경계: "입력 데이터에 특수문자가 섞여 있으면 어떻게 처리돼?" (8개) - 원칙 3</span>
<span id="cb35-5">   ├─ 오류: "알고리즘 2단계가 뭐더랔ㅋ" (6개) - 원칙 4</span>
<span id="cb35-6">   └─ LLM한계: "이 알고리즘의 소스코드 전체를 지금 즉시 자바로 짜줘" (6개) - 원칙 5</span>
<span id="cb35-7"></span>
<span id="cb35-8">2. 데이터 표준화 수행 Agent 40개 (빈도 40% 반영 - 원칙 1)</span>
<span id="cb35-9">   * (원칙 2: 엑셀, DB, JSON 등 다양한 데이터 포맷 포함)</span>
<span id="cb35-10">   ├─ 정상: "첨부한 엑셀 파일의 컬럼명을 표준 메타데이터로 변환해줘" (20개)</span>
<span id="cb35-11">   ├─ 경계: "표준 용어집에 없는 신규 약어는 어떻게 처리할 거야?" (8개) - 원칙 3</span>
<span id="cb35-12">   ├─ 오류: (파일 없이) "이거 다 표준으로 바꿔놔" (6개) - 원칙 4</span>
<span id="cb35-13">   └─ LLM한계: "우리 회사 내부망 DB에 직접 접속해서 데이터 읽어와" (6개) - 원칙 5</span>
<span id="cb35-14"></span>
<span id="cb35-15">3. 알고리즘 세부 분석 및 설명 Agent 15개 (빈도 15% - 원칙 1)</span>
<span id="cb35-16">   ├─ 정상: "이 알고리즘이 기존 BT 도메인 지식과 충돌하는 지점이 어디야?" (8개)</span>
<span id="cb35-17">   ├─ 경계: "논문에 나온 수식과 현재 코드의 로직이 다를 때 우선순위는?" (3개) - 원칙 3</span>
<span id="cb35-18">   ├─ 오류: "왜 이래?" (단발성 질문) (2개) - 원칙 4</span>
<span id="cb35-19">   └─ LLM한계: "이 알고리즘이 10년 뒤에도 유효할지 예측해줘" (2개) - 원칙 5</span>
<span id="cb35-20"></span>
<span id="cb35-21">4. 기타 플랫폼 문의 5개 (나머지 5% - 원칙 1)</span>
<span id="cb35-22">   * (원칙 2: 시스템 권한, 로그인, 가이드 문서 위치 등 주변부 질문)</span>
<span id="cb35-23">   ├─ "지능형 지식 플랫폼 로그인 오류는 어디에 문의해?"</span>
<span id="cb35-24">   ├─ "데이터 표준화 가이드라인 PDF 다운로드 어디서 해?"</span>
<span id="cb35-25">   └─ "내 작업 이력 삭제하고 싶어"</span></code></pre></div>
<div class="sourceCode" id="cb36" style="background: #f1f3f5;"><pre class="sourceCode numberSource 예시3 number-lines code-with-copy"><code class="sourceCode"><span id="cb36-1">그룹 A: 표준화 알고리즘 QnA (40%) - 원칙 1(빈도)</span>
<span id="cb36-2">  * 정상(25개): "A 알고리즘의 3단계를 설명해줘." (원칙 2: 다양성)</span>
<span id="cb36-3">  * 경계(5개): "입력 데이터가 비어있을 때 알고리즘은 어떻게 작동해?" (원칙 3: 예외)</span>
<span id="cb36-4">  * 오류(5개): "알고ㄹㅣ즘 설명좀" (원칙 4: 사용자 오류)</span>
<span id="cb36-5">  * 한계(5개): "이 알고리즘을 2026년에 새로 나올 B 장비에 적용하면?" (원칙 5: 모델 한계)</span>
<span id="cb36-6"></span>
<span id="cb36-7">그룹 B: 데이터 표준화 수행 Agent (40%) - 원칙 1(빈도)</span>
<span id="cb36-8">  * 정상(25개): "이 엑셀 시트의 컬럼명들을 표준 용어로 변환해줘."</span>
<span id="cb36-9">  * 경계(5개): "표준 용어집에 없는 신규 약어가 섞여 있는데 어떻게 할래?" (원칙 3: 예외)</span>
<span id="cb36-10">  * 오류(5개): (파일 없이) "이거 변환해줘" (원칙 4: 맥락 부족)</span>
<span id="cb36-11">  * 한계(5개): "암호화된 DB 서버에 직접 접속해서 데이터 읽어와." (원칙 5: 권한/보안 한계)</span>
<span id="cb36-12"></span>
<span id="cb36-13">그룹 C: 기타 도메인 지식 및 플랫폼 문의 (20%) - 원칙 2(다양성)</span>
<span id="cb36-14">  * 다양성 확보: 시스템 로그인 문제, 표준화 가이드라인 PDF 위치, 담당자 연락처 등 (다양한 주제 포함)</span></code></pre></div>


</section>
</section>
</section>

 ]]></description>
  <category>AI</category>
  <guid>kk3225.netlify.app/docs/blog/posts/Agent/17-Evaluations/16-Prompt-Qualtiy-Control-testRules.html</guid>
  <pubDate>Mon, 02 Feb 2026 15:00:00 GMT</pubDate>
</item>
<item>
  <title>단일 기능 프롬프트 제작: 실무 템플릿 설계 가이드</title>
  <dc:creator>Kwangmin Kim</dc:creator>
  <link>kk3225.netlify.app/docs/blog/posts/Agent/02-Prompt/37-PromptWriting-SingleFunctionPrompt.html</link>
  <description><![CDATA[ 





<section id="단일-기능-프롬프트-제작" class="level1" data-number="1">
<h1 data-number="1"><span class="header-section-number">1</span> 단일 기능 프롬프트 제작</h1>
<section id="개요" class="level2" data-number="1.1">
<h2 data-number="1.1" class="anchored" data-anchor-id="개요"><span class="header-section-number">1.1</span> 개요</h2>
<p>단일 기능 프롬프트는 하나의 명확한 목적을 가진 프롬프트다. 멀티 기능 프롬프트와 달리, 특정 작업에 특화되어 있어 일관성과 품질을 보장하기 쉽다.</p>
<p><strong>예시 항목</strong></p>
<ul>
<li>슬라이드 아이디에이션과 제작<br>
</li>
<li>비즈니스 이메일 작성<br>
</li>
<li>문장 교정 및 수정<br>
</li>
<li>문서 요약<br>
</li>
<li>텍스트 생성 내용 고도화</li>
</ul>
<p><strong>단일 기능의 전략적 가치</strong></p>
<ul>
<li>프롬프트를 범용적으로 만들려다 보면 모든 것을 조금씩 못하게 된다.<br>
</li>
<li>하지만 특정 작업에 집중하면, 그 작업만큼은 전문가 수준으로 수행할 수 있다.<br>
</li>
<li>실무에서는 보통 10~20개의 단일 기능 프롬프트를 템플릿화해서 재사용한다.<br>
</li>
<li>필요할 때마다 즉시 꺼내 쓸 수 있고, 품질이 검증되어 있어 안정적이다. 이는 “프롬프트 라이브러리” 구축 전략의 핵심이다.</li>
</ul>
</section>
<section id="슬라이드-아이디에이션과-제작" class="level2" data-number="1.2">
<h2 data-number="1.2" class="anchored" data-anchor-id="슬라이드-아이디에이션과-제작"><span class="header-section-number">1.2</span> 슬라이드 아이디에이션과 제작</h2>
<blockquote class="blockquote">
<p>요구사항: 한 주제에 대해서 10분 분량의 발표 슬라이드를 작성하는 프롬프트를 제작하세요. 발표 개요도 함께 만드세요.</p>
</blockquote>
<p><strong>생성 조건</strong></p>
<ol type="1">
<li>발표에 대한 아이디에이션이 있어야 함<br>
</li>
<li>각 슬라이드마다 핵심만 키워드 위주로 담겨 있어야 함 (문장 나열 X)<br>
</li>
<li>청중의 수준을 고려한 톤 앤 매너를 반영해야 함<br>
</li>
<li>어느 주제에도 대응할 수 있어야 함<br>
</li>
<li>프롬프트를 템플릿처럼 쓸 수 있어야 함<br>
</li>
<li>프롬프트 테스트는 ChatGPT나 Claude과 같은 범용 AI서비스 사용</li>
</ol>
<p><strong>조건 분석</strong></p>
<p><strong>조건 1: 아이디에이션</strong><br>
* 슬라이드는 단순 정보 나열이 아니다. 스토리텔링이 필요하다.<br>
* “도입 → 문제 제기 → 해결책 제시 → 결론”같은 서사 구조가 있어야 청중이 몰입한다.<br>
* 아이디에이션은 이 구조를 설계하는 단계다.</p>
<p><strong>조건 2: 키워드 중심</strong><br>
* 슬라이드에 긴 문장을 쓰면 두 가지 문제가 생긴다.<br>
* 첫째, 청중이 슬라이드를 읽느라 발표자 말을 안 듣는다.<br>
* 둘째, 발표자가 슬라이드를 그대로 읽게 되어 역동성이 사라진다.<br>
* 키워드만 있으면 발표자가 자유롭게 설명할 수 있다.</p>
<p><strong>조건 3: 청중 수준 고려</strong><br>
* 예를 들어, 대학 신입생 대상 발표와 전문가 컨퍼런스 발표는 완전히 다르다.<br>
* 전문 용어 사용 정도, 설명 깊이, 예시의 복잡도가 모두 달라야 한다.<br>
* 프롬프트에 청중 정보를 변수로 넣으면 이를 자동으로 조절할 수 있다.</p>
<p><strong>조건 4: 주제 범용성</strong><br>
* “AI 발표 슬라이드 만들기” 프롬프트가 아니라, {{주제}}에 어떤 것을 넣어도 작동하는 프롬프트여야 한다.<br>
* 이를 위해서는 주제별 특수성이 아니라, 발표의 보편적 구조(도입-전개-결론)에 집중해야 한다.</p>
<p><strong>조건 5: 템플릿화</strong><br>
* 변수를 사용해서 {{주제}}, {{슬라이드 장수}}, {{청중}} 등을 쉽게 교체할 수 있어야 한다.<br>
* 이는 프롬프트를 “일회용”이 아니라 “재사용 가능한 자산”으로 만든다.</p>
<section id="예시-프롬프트" class="level3" data-number="1.2.1">
<h3 data-number="1.2.1" class="anchored" data-anchor-id="예시-프롬프트"><span class="header-section-number">1.2.1</span> 예시 프롬프트</h3>
<pre><code>너는 늘 A+를 받는 대학생이야. 
[[주제]]에 관한 발표 준비를 할 거야. 
발표에 필요한 PowerPoint Slides 개요를 작성해 줘.
최대한 자세하게. 짧은 단어, 구로 작성해. 
[[슬라이드 장수]] 한국어로 작성해 줘.

# 예시 입력정보
[[주제]]: 생성형 AI와 인문학의 미래
[[슬라이드 장수]]: 5장</code></pre>
<p><strong>프롬프트 구조 분석</strong></p>
<p><strong>페르소나 설정: “늘 A+를 받는 대학생”</strong><br>
이 설정은 단순히 “잘한다”는 의미가 아니다. 세 가지 암묵적 제약을 포함한다.</p>
<ol type="1">
<li><strong>대학생 수준의 언어</strong>: 너무 학술적이거나 전문적이지 않다<br>
</li>
<li><strong>교수를 설득하는 능력</strong>: 논리적 구조와 설득력 있는 전개<br>
</li>
<li><strong>시간 제약 이해</strong>: 10분 발표는 보통 5~7장 슬라이드가 적절하다는 것을 안다</li>
</ol>
<p>만약 “전문 컨설턴트”로 설정했다면 더 데이터 중심적이고 비즈니스 용어가 많은 슬라이드가 나왔을 것이다. 페르소나 선택이 출력 스타일을 결정한다.</p>
<p><strong>변수 처리: [[주제]]와 [[슬라이드 장수]]</strong><br>
이중 대괄호 표기는 “여기는 변수야”라는 시각적 신호다. LLM에게 직접적으로 의미는 없지만, 사람이 프롬프트를 관리할 때 어디를 수정해야 하는지 명확히 보인다.</p>
<p><strong>“최대한 자세하게” vs “짧은 단어, 구로”</strong><br>
이 두 지시는 모순처럼 보이지만, 실제로는 서로 다른 차원을 다룬다.</p>
<ul>
<li>“최대한 자세하게”: 각 슬라이드의 내용, 부슬라이드 구성, 시각 자료 제안 등을 모두 포함하라<br>
</li>
<li>“짧은 단어, 구로”: 슬라이드에 들어갈 실제 텍스트는 키워드 형태로 하라</li>
</ul>
<p>이는 “개요는 상세하게, 슬라이드 텍스트는 간결하게”라는 이중 요구사항을 효과적으로 전달한다.</p>
<p><strong>언어 명시의 중요성</strong><br>
“한국어로 작성해 줘”가 없으면, 일부 모델은 영어로 답변하거나 영어/한국어를 섞어 쓴다. 특히 “PowerPoint Slides”같은 영어 용어가 프롬프트에 있으면 모델이 영어 모드로 전환될 가능성이 높다. 명시적 언어 지정은 필수다.</p>
<p><strong>실전 적용 시나리오</strong></p>
<p>이 프롬프트를 실제로 사용할 때는 다음과 같이 확장할 수 있다:</p>
<pre><code>너는 늘 A+를 받는 대학생이야. 
[[주제: 블록체인 기술의 금융 산업 적용 사례]]에 관한 발표 준비를 할 거야. 
[[청중: 경영학과 2학년 학생들]]을 대상으로 한다.
발표에 필요한 PowerPoint Slides 개요를 작성해 줘.

각 슬라이드는:
- 제목: 핵심 메시지를 담은 한 문장
- 내용: 3~5개 키워드 또는 짧은 구
- 시각 자료 제안: 어떤 이미지나 차트가 효과적일지

[[슬라이드 장수: 6장]] 
발표 시간: [[10분]]
한국어로 작성해 줘.</code></pre>
<p>청중 정보를 추가하면 AI는 자동으로 난이도를 조절한다. “경영학과 2학년”이면 기술적 세부사항은 최소화하고, 비즈니스 임팩트에 집중한다.</p>
</section>
</section>
<section id="비즈니스-이메일-작성" class="level2" data-number="1.3">
<h2 data-number="1.3" class="anchored" data-anchor-id="비즈니스-이메일-작성"><span class="header-section-number">1.3</span> 비즈니스 이메일 작성</h2>
<blockquote class="blockquote">
<p>요구사항: 비즈니스 이메일을 자동으로 작성해주는 프롬프트를 제작하세요.</p>
</blockquote>
<p><strong>실전 시나리오: 정중하게 거절하는 이메일</strong></p>
<pre><code>안녕하세요,
저는 동대문구 센터에서 근무하는 [이름]입니다. 
저희 센터는 지역 주민들의 일자리 창출과 역량 강화를 위해 
다양한 교육 프로그램을 운영하고 있습니다. 
최근에는 메타버스 관련 강좌도 성공적으로 진행하며, 
시대 변화에 발맞춘 교육 제공에 힘쓰고 있습니다.

특히, 올 가을에는 AI 관련 주민 교육을 기획 중에 있습니다.
주민들에게 실질적인 도움을 줄 수 있는 AI 교육을 제공하고자, 
[회사명]와의 협력을 희망합니다. 
센터의 풍부한 교육 경험과 [회사명]의 전문성이 만난다면, 
더욱 의미 있는 교육 프로그램을 만들 수 있을 것이라 확신합니다.

번거로우시겠지만, 협력 가능 여부와 함께 간단한 미팅 일정을 
제안해 주시면 감사하겠습니다. 
동대문구 주민들의 미래를 위한 의미 있는 발걸음에 함께 해주시기를 
간곡히 부탁드립니다.

긍정적인 답변 기다리겠습니다.
감사합니다.</code></pre>
<p><strong>이메일 분석: 거절해야 하는 이유</strong></p>
<p>이 이메일은 협력 제안이지만, 받는 쪽에서는 거절해야 하는 상황이다. 이유는 다양할 수 있다:<br>
- 리소스 부족<br>
- 사업 방향과 맞지 않음<br>
- 이미 다른 파트너와 협력 중</p>
<p>거절 이메일은 비즈니스 커뮤니케이션에서 가장 어려운 유형 중 하나다. 상대방의 기대를 꺾으면서도 관계를 유지해야 하기 때문이다.</p>
<section id="프롬프트-설계" class="level3" data-number="1.3.1">
<h3 data-number="1.3.1" class="anchored" data-anchor-id="프롬프트-설계"><span class="header-section-number">1.3.1</span> 프롬프트 설계</h3>
<pre><code>한국의 이메일 관습에 따라 이메일 전문을 작성해 줘.
발신자와 수신자의 관계를 고려해. 
공손하고 격식있는 말투를 구사해.
핵심 내용을 반영해서 완성도 있는 이메일을 써줘.

[[이메일 전문: &lt;텍스트 넣기&gt;]]
[[발신인: &lt;텍스트 넣기&gt;]]
[[수신인: &lt;텍스트 넣기&gt;]]
[[핵심 내용: &lt;텍스트 넣기&gt;]]

추가 정보 (optional)
[발신자 이름]
[직위]
[회사명]
[연락처]
[이메일 주소]</code></pre>
<p><strong>프롬프트 구조 해부</strong></p>
<p><strong>“한국의 이메일 관습”의 구체적 의미</strong></p>
<p>한국 비즈니스 이메일은 서양과 다른 구조를 가진다:</p>
<ol type="1">
<li><strong>인사 + 소속 밝히기</strong>: “안녕하십니까, ○○회사 ○○부서 김철수입니다”<br>
</li>
<li><strong>감사 표현</strong>: “평소 많은 관심과 도움을 주셔서 감사합니다”<br>
</li>
<li><strong>본론</strong>: 목적과 내용<br>
</li>
<li><strong>재차 감사 + 양해 구하기</strong>: “번거롭게 해드려 죄송하며…”<br>
</li>
<li><strong>맺음말</strong>: “좋은 하루 되십시오”</li>
</ol>
<p>서양식은 “Dear X, [본론], Best regards”로 훨씬 간결하다. “한국의 이메일 관습”을 명시하면 AI가 이런 구조적 차이를 자동으로 반영한다.</p>
<p><strong>“발신자와 수신자의 관계를 고려해”</strong></p>
<p>관계에 따라 어투가 완전히 바뀐다:</p>
<ul>
<li>상사 → 부하: 비교적 직설적, “~해주세요”<br>
</li>
<li>부하 → 상사: 매우 공손, “~해주시면 감사하겠습니다”<br>
</li>
<li>동급 but 외부: 존중하되 격식적, “~하시면 좋을 것 같습니다”<br>
</li>
<li>처음 연락하는 외부: 최고 수준 공손, “~해주실 수 있으실까요?”</li>
</ul>
<p>프롬프트에 [[발신인]]과 [[수신인]]을 별도로 명시하면, AI가 위계와 친밀도를 추론해서 적절한 톤을 선택한다.</p>
<p><strong>“핵심 내용”의 중요성</strong></p>
<p>비즈니스 이메일의 함정은 “예의 바르게 쓰다가 핵심을 놓치는 것”이다. “협력 제안을 정중히 거절”이라는 핵심 내용을 명시하지 않으면, AI는 그냥 “감사 표현만 가득한 애매한 이메일”을 쓸 수 있다.</p>
<p>핵심 내용 예시:<br>
- “협력 제안을 현재 상황상 수용하기 어렵지만, 향후 기회를 열어둔다”<br>
- “미팅 제안을 정중히 거절하되, 대안으로 이메일 자료 공유를 제안한다”<br>
- “요청을 거절하지만, 다른 적절한 담당자를 추천한다”</p>
<p><strong>optional 정보의 전략적 사용</strong></p>
<p>서명란 정보는 선택사항이지만, 있으면 더 완성도 높은 이메일이 나온다. AI는 직위를 보고 어투를 미세 조정할 수 있다. “센터장”이면 약간 권위적으로, “주임”이면 더 겸손하게 쓴다.</p>
<p><strong>실제 출력 예시 (추론)</strong></p>
<pre><code>안녕하십니까, [회사명] [부서명] [이름]입니다.

먼저 저희 회사에 관심을 가져주시고, 
의미 있는 협력 제안을 주신 점 진심으로 감사드립니다.

동대문구 센터에서 지역 주민들을 위해 다양한 교육 프로그램을 
운영하고 계신다는 점, 특히 메타버스 강좌를 성공적으로 진행하셨다는 소식에 
저희도 큰 감명을 받았습니다.

다만, 현재 저희는 하반기 주요 프로젝트 일정이 확정되어 있어, 
안타깝게도 올 가을 AI 교육 협력에 참여하기 어려운 상황입니다.

대신, 귀 센터에서 진행하실 AI 교육에 도움이 될 만한 
저희 교육 자료와 온라인 콘텐츠 링크를 첨부해 드립니다. 
또한, 내년 상반기에는 일정 조율이 가능할 것으로 예상되오니, 
그때 다시 협력 논의를 이어갈 수 있기를 희망합니다.

이번에는 좋은 기회를 함께 하지 못해 죄송한 마음입니다.
앞으로도 좋은 인연으로 이어지기를 바라며, 
귀 센터의 교육 프로그램이 성공적으로 진행되기를 기원합니다.

감사합니다.

[발신자 이름]
[직위]
[회사명]
[연락처]
[이메일 주소]</code></pre>
<p><strong>거절 이메일의 핵심 요소 분석</strong></p>
<ol type="1">
<li><strong>감사 표현</strong>: 제안 자체에 대한 감사<br>
</li>
<li><strong>긍정적 인정</strong>: 상대방의 업적이나 노력 인정<br>
</li>
<li><strong>명확한 거절</strong>: 애매하지 않게, 하지만 이유와 함께<br>
</li>
<li><strong>대안 제시</strong>: 완전히 문을 닫지 않음 (자료 제공, 미래 협력 가능성)<br>
</li>
<li><strong>재차 사과와 응원</strong>: 관계 유지를 위한 마무리</li>
</ol>
<p>이 구조는 비즈니스 이메일 작성의 교과서적 패턴이다. 프롬프트에 “정중하게 거절”이라고만 써도, AI는 이런 구조를 자동으로 구현한다.</p>
</section>
</section>
<section id="한국어-문장-교정-및-수정" class="level2" data-number="1.4">
<h2 data-number="1.4" class="anchored" data-anchor-id="한국어-문장-교정-및-수정"><span class="header-section-number">1.4</span> 한국어 문장 교정 및 수정</h2>
<blockquote class="blockquote">
<p>요구사항: 보고서나 일상의 문서에서 문장을 교정하고 수정하기 위한 프롬프트를 제작하세요.</p>
</blockquote>
<section id="프롬프트-설계-1" class="level3" data-number="1.4.1">
<h3 data-number="1.4.1" class="anchored" data-anchor-id="프롬프트-설계-1"><span class="header-section-number">1.4.1</span> 프롬프트 설계</h3>
<pre><code>너는 한국어 글쓰기 및 편집 분야 전문가야. 
주어진 텍스트를 수정하는 일이야. 
한국어 문법을 교정하고 문맥을 자연스럽게 수정해 줘.
수정한 부분과 수정 이유를 간단하게 설명해 줘.

텍스트: [원본 텍스트]

출력 형식:
수정한 텍스트: [수정된 버전]
수정한 이유: [변경 사항과 이유 설명]</code></pre>
<p><strong>프롬프트 핵심 요소</strong></p>
<p><strong>페르소나: “한국어 글쓰기 및 편집 분야 전문가”</strong></p>
<p>이 설정이 왜 중요한가? “문법 교정기”가 아니라 “편집 전문가”로 설정하면, AI는 단순히 틀린 것만 고치는 게 아니라 더 나은 표현을 제안한다.</p>
<p>예를 들어:<br>
- 문법 교정기: “그는 학교에 갔다” → (문법상 맞으므로 변경 없음)<br>
- 편집 전문가: “그는 학교에 갔다” → “그는 학교로 향했다” (맥락에 따라 더 적절한 표현 제안)</p>
<p><strong>“문법 교정”과 “문맥 자연스럽게”의 이중 목표</strong></p>
<p>문법적으로 맞지만 어색한 문장이 많다.</p>
<p>원문: “이 문제를 해결하기 위해서는 우리는 새로운 접근법을 채택해야 한다”<br>
문법: 맞음<br>
문제: 어색함 (“위해서는”과 “우리는”의 중복적 강조)<br>
수정: “이 문제를 해결하려면 새로운 접근법이 필요하다”</p>
<p>“문맥을 자연스럽게”라는 지시는 AI에게 문법 너머의 가독성과 흐름을 고려하라는 의미다.</p>
<p><strong>“수정 이유 설명”의 교육적 효과</strong></p>
<p>단순히 수정본만 주면 사용자는 배우지 못한다. 다음에 또 같은 실수를 한다. 하지만 “왜 이렇게 고쳤는지” 설명이 있으면:</p>
<ol type="1">
<li>사용자가 패턴을 학습한다<br>
</li>
<li>동의하지 않으면 수정을 되돌릴 수 있다<br>
</li>
<li>AI의 판단이 적절한지 검증할 수 있다</li>
</ol>
<p>예시:</p>
<pre><code>수정 전: "그 결과로써 매출이 증가했다"
수정 후: "그 결과 매출이 증가했다"
이유: "결과로써"는 잘못된 표현. "결과로서"가 맞지만, 
      "결과"만으로도 의미가 명확하므로 간결하게 수정.</code></pre>
<p><strong>실전 적용 시나리오</strong></p>
<p>이 프롬프트는 다양한 문서 유형에 적용할 수 있다:</p>
<p><strong>학술 논문 교정</strong></p>
<pre><code>너는 한국어 글쓰기 및 편집 분야 전문가야. 
특히 학술 논문 편집 경험이 풍부하다.
주어진 학술 텍스트를 수정하는 일이야. 
한국어 문법을 교정하고, 학술적 문체에 맞게 수정해 줘.
번역체 표현은 자연스러운 한국어로 바꿔줘.</code></pre>
<p><strong>비즈니스 문서 교정</strong></p>
<pre><code>너는 한국어 글쓰기 및 편집 분야 전문가야. 
기업 문서 작성에 특화되어 있다.
주어진 비즈니스 텍스트를 수정하는 일이야. 
문법 교정과 함께, 간결하고 명확한 비즈니스 문체로 다듬어줘.
불필요한 수식어는 제거하고 핵심만 남겨줘.</code></pre>
<p><strong>블로그 글 교정</strong></p>
<pre><code>너는 한국어 글쓰기 및 편집 분야 전문가야. 
친근하고 읽기 쉬운 글쓰기에 능숙하다.
주어진 블로그 텍스트를 수정하는 일이야. 
문법 교정과 함께, 독자 친화적이고 자연스러운 구어체로 다듬어줘.</code></pre>
</section>
</section>
<section id="문서-요약" class="level2" data-number="1.5">
<h2 data-number="1.5" class="anchored" data-anchor-id="문서-요약"><span class="header-section-number">1.5</span> 문서 요약</h2>
<blockquote class="blockquote">
<p>요구사항: 문서를 요약하는 프롬프트를 제작하세요.</p>
</blockquote>
<p><strong>실습 자료</strong></p>
<p>자료 노션에 업로드된 문서 요약을 위한 PDF를 다운로드 받아주세요.</p>
<section id="단계-요약-프롬프트" class="level3" data-number="1.5.1">
<h3 data-number="1.5.1" class="anchored" data-anchor-id="단계-요약-프롬프트"><span class="header-section-number">1.5.1</span> 2단계 요약 프롬프트</h3>
<pre><code>문서를 읽어.

1단계. 읽고 나서 너는 문서 내용을 바탕으로 친구랑 대화를 해. 
그런 다음 대화한 내용을 나에게 다시 자세하게 들려줘. 
중요한 내용을 놓치면 안돼.

[문서 1.pdf 첨부]

2단계. 요약한 내용을 다시 한 번 읽어. 
여기에 생각한 내용을 정리해 그리고 최종 요약을 해줘.

요약 요약</code></pre>
<p><strong>프롬프트 설계의 독창성</strong></p>
<p>이 프롬프트는 매우 독특한 접근을 사용한다. 일반적인 요약 프롬프트는 “이 문서를 요약해줘”로 끝난다. 하지만 이 프롬프트는 2단계 과정을 거친다.</p>
<p><strong>1단계: “친구랑 대화하는” 메타포</strong></p>
<p>왜 “친구랑 대화”라고 표현했는가? 이는 AI에게 특정 인지 프로세스를 유도한다.</p>
<p><strong>대화의 심리학적 효과</strong><br>
사람은 정보를 다른 사람에게 설명할 때 더 깊이 이해한다. 이를 “Feynman Technique”이라고 한다. 복잡한 개념을 친구에게 설명하려면, 핵심을 추출하고 단순화해야 한다.</p>
<p>AI에게 “친구랑 대화”라고 하면, 단순한 키워드 추출이 아니라 “이해하고 설명하기” 모드로 전환된다. 이는 요약의 품질을 크게 높인다.</p>
<p><strong>“중요한 내용을 놓치면 안돼”의 역할</strong></p>
<p>이는 완전성(completeness)을 보장하는 장치다. 일반적인 요약은 “가장 중요한 3가지”처럼 과도하게 압축한다. 하지만 때로는 세부 사항도 중요하다.</p>
<p>“놓치면 안 돼”라는 지시는 AI에게 “압축하되 정보 손실은 최소화하라”는 균형을 요구한다.</p>
<p><strong>2단계: “요약 요약” (Meta-Summarization)</strong></p>
<p>1단계 출력은 여전히 길 수 있다. 2단계는 이를 다시 압축한다. 하지만 단순 압축이 아니라 “생각한 내용을 정리”하라고 한다.</p>
<p><strong>“생각한 내용”의 의미</strong><br>
이는 AI에게 메타인지를 요구한다. 단순히 정보를 줄이는 게 아니라:<br>
- 어떤 부분이 가장 핵심인가?<br>
- 정보들 사이에 어떤 연결 고리가 있는가?<br>
- 전체 문서의 주장이나 메시지는 무엇인가?</p>
<p>이런 고차원적 사고를 거쳐야 진짜 통찰력 있는 요약이 나온다.</p>
<p><strong>2단계 프로세스의 이점</strong></p>
<p><strong>이점 1: 정보 손실 최소화</strong><br>
1단계에서 충분히 풀어서 설명하므로, 중요한 디테일이 살아남는다. 한 번에 10줄로 압축하면 놓치는 것이 많지만, 100줄로 확장 후 10줄로 압축하면 본질이 더 잘 보존된다.</p>
<p><strong>이점 2: 이해도 검증</strong><br>
1단계 출력을 보면 AI가 문서를 제대로 이해했는지 알 수 있다. 만약 이상하면 2단계로 진행하지 않고 다시 시도할 수 있다.</p>
<p><strong>이점 3: 다층적 요약</strong><br>
어떤 사용자는 1단계 (상세 요약)만 필요할 수 있고, 어떤 사용자는 2단계 (초간단 요약)까지 필요할 수 있다. 두 가지를 모두 제공한다.</p>
<p><strong>실전 적용: 문서 유형별 변형</strong></p>
<p><strong>학술 논문 요약</strong></p>
<pre><code>논문을 읽어.

1단계. 이 논문을 연구 방법론을 모르는 동료에게 설명한다고 생각해. 
연구 질문, 방법, 결과, 함의를 자세히 설명해줘.

2단계. 1단계 내용을 바탕으로, 3줄 요약을 만들어줘.
- 한 줄: 연구 질문
- 한 줄: 핵심 발견
- 한 줄: 왜 중요한가</code></pre>
<p><strong>계약서 요약</strong></p>
<pre><code>계약서를 읽어.

1단계. 각 조항을 평범한 언어로 풀어서 설명해. 
특히 의무 사항, 제한 사항, 위약 시 결과를 명확히 해줘.

2단계. 서명 전에 반드시 확인해야 할 핵심 사항 5가지를 추려줘.</code></pre>
</section>
</section>
<section id="텍스트-생성-내용-고도화" class="level2" data-number="1.6">
<h2 data-number="1.6" class="anchored" data-anchor-id="텍스트-생성-내용-고도화"><span class="header-section-number">1.6</span> 텍스트 생성 내용 고도화</h2>
<blockquote class="blockquote">
<p>요구사항: 이전 문서 요약에서 뽑은 내용을 좀 더 고도화하는 프롬프트를 제작하세요.</p>
</blockquote>
<section id="가중치-기반-재작성-프롬프트" class="level3" data-number="1.6.1">
<h3 data-number="1.6.1" class="anchored" data-anchor-id="가중치-기반-재작성-프롬프트"><span class="header-section-number">1.6.1</span> 가중치 기반 재작성 프롬프트</h3>
<pre><code>[요약 결과 텍스트 붙여넣기]

다음 지시에 따라 글을 재작성해줘.

전체 구조
주요 내용 요약
세부 사항
마무리

다음, 가중치 조절해서 다시 작성해줘.
전체 구조: 0.3
주요 내용 요약: 0.6
세부 사항: 0.05
마무리: 0.05</code></pre>
<p><strong>가중치 개념의 도입</strong></p>
<p>이 프롬프트는 매우 고급 기법을 사용한다. “가중치”라는 정량적 개념을 텍스트 생성에 적용한다.</p>
<p><strong>가중치의 의미</strong></p>
<ul>
<li>전체 구조 0.3: 전체 내용의 30%를 구조 설명에 할애<br>
</li>
<li>주요 내용 요약 0.6: 60%를 핵심 내용에 집중<br>
</li>
<li>세부 사항 0.05: 5%만 디테일에 사용<br>
</li>
<li>마무리 0.05: 5%를 결론에 할당</li>
</ul>
<p><strong>왜 이런 가중치인가?</strong></p>
<p>이 가중치 분포는 “핵심 중심 문서”를 만든다. 대부분의 공간(60%)을 주요 내용에 쓰고, 구조는 간략히(30%), 세부와 마무리는 최소화(각 5%)한다.</p>
<p>다른 목적이라면 가중치를 다르게 설정할 수 있다:</p>
<p><strong>스토리텔링 중심 문서</strong></p>
<pre><code>전체 구조: 0.4  (서사 전개가 중요)
주요 내용 요약: 0.3
세부 사항: 0.25  (생생한 디테일 필요)
마무리: 0.05</code></pre>
<p><strong>분석 보고서</strong></p>
<pre><code>전체 구조: 0.2
주요 내용 요약: 0.5
세부 사항: 0.25  (데이터와 근거 중요)
마무리: 0.05</code></pre>
<p><strong>AI가 가중치를 어떻게 해석하는가?</strong></p>
<p>LLM은 숫자를 정확히 계산하지 않는다. 하지만 상대적 비율은 이해한다. “0.6 vs 0.05”를 보면 “주요 내용이 세부 사항보다 12배 중요하다”는 우선순위를 파악한다.</p>
<p>실제 구현에서 AI는:<br>
1. 전체 목표 길이를 추정 (예: 500단어)<br>
2. 각 섹션에 단어 할당 (구조 150, 주요 내용 300, 세부 25, 마무리 25)<br>
3. 각 섹션을 해당 길이에 맞춰 작성</p>
<p><strong>2단계 프로세스의 이유</strong></p>
<p>왜 가중치를 처음부터 주지 않고, 먼저 구조를 제시한 후 가중치를 적용하는가?</p>
<p><strong>1단계: 구조 정의</strong><br>
“전체 구조”, “주요 내용 요약”, “세부 사항”, “마무리”를 먼저 제시하면, AI는 이 네 가지 카테고리가 있음을 인지한다. 이는 프레임을 설정한다.</p>
<p><strong>2단계: 가중치 적용</strong><br>
가중치가 주어지면, 이미 정의된 프레임 내에서 비율을 조정한다. 만약 1단계 없이 바로 가중치를 주면, AI는 “무엇의 가중치인가?”를 헷갈려할 수 있다.</p>
<p><strong>실전 활용: 다양한 가중치 시나리오</strong></p>
<p><strong>시나리오 1: 경영진 보고서 (초간단 버전)</strong></p>
<pre><code>전체 구조: 0.1  (최소한의 맥락만)
주요 내용 요약: 0.8  (핵심만 강조)
세부 사항: 0.05
마무리: 0.05  (행동 항목)</code></pre>
<p>경영진은 시간이 없다. 핵심을 80%로 극대화한다.</p>
<p><strong>시나리오 2: 학술 발표 (균형잡힌 버전)</strong></p>
<pre><code>전체 구조: 0.25  (연구 맥락 중요)
주요 내용 요약: 0.35  (발견 사항)
세부 사항: 0.3  (방법론과 데이터)
마무리: 0.1  (함의와 향후 연구)</code></pre>
<p>학술 발표는 모든 요소가 고르게 필요하다.</p>
<p><strong>시나리오 3: 마케팅 콘텐츠 (감성 중심)</strong></p>
<pre><code>전체 구조: 0.2  (스토리 설정)
주요 내용 요약: 0.3  (핵심 메시지)
세부 사항: 0.35  (생생한 예시와 사례)
마무리: 0.15  (강력한 CTA)</code></pre>
<p>마케팅은 감성과 행동 유도가 중요하므로, 세부(예시)와 마무리(CTA)의 비중이 높다.</p>
<p><strong>가중치 프롬프트의 한계와 보완</strong></p>
<p><strong>한계 1: 정확도</strong><br>
AI는 정확히 60%를 주요 내용에 쓰지 못할 수 있다. 55%나 65%가 될 수 있다. 하지만 대략적 비율은 맞춘다.</p>
<p><strong>한계 2: 품질 vs 양</strong><br>
가중치가 낮다고 품질이 낮아야 한다는 의미는 아니다. 세부 사항 0.05는 “짧게 쓰되 정확하게”를 의미한다.</p>
<p><strong>보완 방법</strong></p>
<pre><code>가중치 조절해서 다시 작성해줘.
전체 구조: 0.3 (간략하게, 하지만 명확하게)
주요 내용 요약: 0.6 (가장 집중, 풍부한 설명)
세부 사항: 0.05 (최소한, 하지만 중요한 것만)
마무리: 0.05 (간결하지만 임팩트 있게)</code></pre>
<p>각 가중치 옆에 질적 가이드를 추가하면 더 정교한 제어가 가능하다.</p>
<p><strong>고도화의 본질</strong></p>
<p>“텍스트 생성 내용 고도화”의 핵심은 단순히 더 길거나 짧게 만드는 게 아니다. 목적에 맞게 정보 밀도와 초점을 조정하는 것이다.</p>
<p>요약에서 뽑은 내용은 보통 균등한 비중으로 정보가 분산되어 있다. 하지만 실제 사용 맥락에서는 특정 부분이 더 중요할 수 있다. 가중치 프롬프트는 이 재조정을 자동화한다.</p>
<p>예를 들어, 같은 문서 요약을:<br>
- 경영진에게 보고할 때: 주요 내용 0.8<br>
- 팀 내부 공유할 때: 세부 사항 0.4<br>
- 대외 발표할 때: 전체 구조 0.4 (맥락 제공)</p>
<p>상황에 맞게 가중치만 바꾸면, 같은 원본에서 다른 버전을 효율적으로 생성할 수 있다.</p>


</section>
</section>
</section>

 ]]></description>
  <category>Prompt Engineering</category>
  <category>LLM</category>
  <category>AI</category>
  <category>Agent</category>
  <guid>kk3225.netlify.app/docs/blog/posts/Agent/02-Prompt/37-PromptWriting-SingleFunctionPrompt.html</guid>
  <pubDate>Sun, 01 Feb 2026 15:00:00 GMT</pubDate>
</item>
<item>
  <title>직군별 프롬프트 템플릿: 도메인 특화 실무 가이드</title>
  <dc:creator>Kwangmin Kim</dc:creator>
  <link>kk3225.netlify.app/docs/blog/posts/Agent/02-Prompt/38-PromptWriting-DomainSpecificPrompt.html</link>
  <description><![CDATA[ 





<section id="직군별-프롬프트-템플릿" class="level1" data-number="1">
<h1 data-number="1"><span class="header-section-number">1</span> 직군별 프롬프트 템플릿</h1>
<section id="직군별-템플릿의-전략적-가치" class="level2" data-number="1.1">
<h2 data-number="1.1" class="anchored" data-anchor-id="직군별-템플릿의-전략적-가치"><span class="header-section-number">1.1</span> 직군별 템플릿의 전략적 가치</h2>
<p>직군별 프롬프트 템플릿은 일반적인 범용 프롬프트와 근본적으로 다른 접근이다. 각 직군의 고유한 업무 프로세스, 용어, 산출물 형식을 반영하여 설계된다.</p>
<p><strong>템플릿화의 핵심 이점</strong></p>
<p>범용 프롬프트는 “무엇이든 할 수 있지만 아무것도 완벽하지 않다”는 한계가 있다. 반면 직군별 템플릿은 해당 직군의 80% 업무를 커버하도록 최적화되어 있어, 즉시 실무에 투입 가능하다.</p>
<p>예를 들어 마케터가 “블로그 글 써줘”라고 하면 AI는 어떤 톤으로, 어떤 구조로, 어떤 길이로 써야 할지 모른다. 하지만 마케터용 템플릿은 “SEO 최적화, 명확한 CTA, 독자 페르소나 반영”같은 마케팅 전문 요구사항이 이미 내장되어 있다.</p>
<p><strong>템플릿의 재사용성</strong></p>
<p>한 번 검증된 템플릿은 팀 전체가 공유할 수 있다. 신입 직원도 선임의 노하우가 담긴 프롬프트를 즉시 사용할 수 있다. 이는 업무 품질의 하한선을 올리는 효과가 있다.</p>
</section>
<section id="리서치보고서-작성-프롬프트-템플릿" class="level2" data-number="1.2">
<h2 data-number="1.2" class="anchored" data-anchor-id="리서치보고서-작성-프롬프트-템플릿"><span class="header-section-number">1.2</span> 리서치/보고서 작성 프롬프트 템플릿</h2>
<pre><code>You are responsible for writing a formal business report that is
professional, factual, and objective.

Report Topic:
{{REPORT_TOPIC}}

Company Data:
{{COMPANY_DATA}}

Report Structure:
1. Title Page
2. Table of Contents
3. Executive Summary
4. Introduction
5. Main Body (with subheadings)
6. Conclusion
7. Recommendations
8. References (if needed)
9. Appendices (if needed)

Section Guidelines:
1. Title Page: Include the report title, your name, date, and company name.
2. Table of Contents: List sections with page numbers.
3. Executive Summary: Brief overview (max 1 page) of key points and
   recommendations.
4. Introduction: State the report's purpose, background, and scope.
5. Main Body: Present findings and analysis based on the company data. 
   Use clear headings.
6. Conclusion: Summarize key findings.
7. Recommendations: Provide actionable suggestions for the company.
8. References: List external sources, if used.
9. Appendices: Add any detailed supporting information.

Before Submitting:
• Check for logical flow and coherence.
• Proofread for errors.
• Ensure all data is accurate and sections align with the topic.</code></pre>
<p><strong>템플릿 구조 분석</strong></p>
<p><strong>역할 정의: “formal business report”의 3가지 속성</strong></p>
<p>“professional, factual, and objective”는 단순한 수식어가 아니다. 각각이 구체적 제약을 만든다.</p>
<ul>
<li><strong>Professional</strong>: 비속어 금지, 격식 있는 어투, 시각 자료는 차트/표로 제한<br>
</li>
<li><strong>Factual</strong>: 추측 금지, 모든 주장은 데이터로 뒷받침, 감정적 표현 배제<br>
</li>
<li><strong>Objective</strong>: 회사에 유리한 정보만 선택하지 않음, 장단점 균형 있게 제시</li>
</ul>
<p>이 세 단어가 없으면 AI는 마케팅 자료처럼 과장하거나, 블로그 글처럼 캐주얼하게 쓸 수 있다.</p>
<p><strong>변수 설계: {{REPORT_TOPIC}}과 {{COMPANY_DATA}}</strong></p>
<p>두 개의 변수만 제공하면 보고서 전체가 생성된다. 이는 템플릿의 핵심 가치다.</p>
<p>{{REPORT_TOPIC}} 예시:<br>
- “2024년 4분기 매출 감소 원인 분석”<br>
- “신규 시장 진입 타당성 검토”<br>
- “경쟁사 A의 전략 분석 및 대응 방안”</p>
<p>{{COMPANY_DATA}} 예시:<br>
- 매출 데이터 (CSV, 표 형태)<br>
- 고객 피드백 (텍스트)<br>
- 경쟁사 자료 (수집한 정보)</p>
<p><strong>9단계 구조의 실무적 정당성</strong></p>
<p>이 구조는 비즈니스 보고서의 국제 표준이다. MBA 교육, 컨설팅 펌, 대기업에서 공통적으로 사용한다.</p>
<p><strong>왜 이 순서인가?</strong></p>
<ol type="1">
<li><strong>Title Page</strong>: 첫인상, 누가 썼고 무엇에 관한 것인가<br>
</li>
<li><strong>Table of Contents</strong>: 독자가 원하는 섹션으로 바로 점프<br>
</li>
<li><strong>Executive Summary</strong>: 바쁜 경영진은 이것만 읽는다<br>
</li>
<li><strong>Introduction</strong>: 왜 이 보고서가 필요한가<br>
</li>
<li><strong>Main Body</strong>: 실제 분석과 발견<br>
</li>
<li><strong>Conclusion</strong>: 발견 사항 종합<br>
</li>
<li><strong>Recommendations</strong>: 실행 가능한 제안<br>
</li>
<li><strong>References</strong>: 신뢰성 확보<br>
</li>
<li><strong>Appendices</strong>: 본문을 방해하지 않으면서 상세 자료 제공</li>
</ol>
<p><strong>Section Guidelines의 정교함</strong></p>
<p>각 섹션마다 구체적 지침이 있다. 특히 주목할 점:</p>
<p><strong>“Executive Summary: max 1 page”</strong><br>
페이지 제한은 중요하다. 제한이 없으면 AI는 2~3페이지를 쓸 수 있다. 하지만 Executive Summary의 본질은 “한 페이지에 모든 것”이다. 경영진이 엘리베이터 타는 동안 읽을 수 있어야 한다.</p>
<p><strong>“Main Body: Use clear headings”</strong><br>
보고서의 가독성은 제목 구조에서 결정된다. 명확한 제목이 없으면 독자는 길을 잃는다. “Use clear headings”는 AI에게 2~3 레벨의 계층적 제목 구조를 만들라는 암묵적 지시다.</p>
<p><strong>“Recommendations: Provide actionable suggestions”</strong><br>
“Actionable”이 핵심이다. “더 노력해야 한다”는 권고가 아니라, “분기별 고객 만족도 설문을 도입하고, 결과를 제품 팀과 공유한다”같은 구체적 행동이 필요하다.</p>
<p><strong>Before Submitting 체크리스트의 역할</strong></p>
<p>이 섹션은 AI에게 자기 검토를 요구한다. “보고서를 쓰고 나서 다시 읽어보고 이 세 가지를 확인하라”는 메타 지시다.</p>
<ul>
<li><strong>Logical flow</strong>: 섹션 간 연결이 자연스러운가?<br>
</li>
<li><strong>Proofread</strong>: 오타, 문법 오류는 없는가?<br>
</li>
<li><strong>Data accuracy</strong>: 숫자가 일치하는가? 출처가 명확한가?</li>
</ul>
<p>이런 체크리스트가 없으면 AI는 일관성 없는 보고서를 생성할 수 있다. 예를 들어 Introduction에서 “3가지 핵심 발견”을 언급했는데 Main Body에서 2가지만 다루는 식이다.</p>
</section>
<section id="브레인스토밍-템플릿-product-manager용" class="level2" data-number="1.3">
<h2 data-number="1.3" class="anchored" data-anchor-id="브레인스토밍-템플릿-product-manager용"><span class="header-section-number">1.3</span> 브레인스토밍 템플릿 (Product Manager용)</h2>
<pre><code>You are a Product Manager tasked with brainstorming creative and 
practical ideas for the following topic:

Topic: {{TOPIC}}
Context: {{CONTEXT}}

Steps for the brainstorming session:
1. Analyze the topic and context. Think about user needs, business goals, 
   and potential solutions.
2. Generate 5 distinct ideas that address the topic from different perspectives.
3. For each idea, include:
   - A title (1-5 words)
   - A short description (2-3 sentences)
   - One potential benefit
   - One possible challenge
4. Identify common themes across your ideas.
5. Combine two or more ideas to create a more comprehensive solution.

Answer in Korean.</code></pre>
<p><strong>Product Manager 페르소나의 함의</strong></p>
<p>Product Manager는 특정한 사고방식을 가진다. 엔지니어처럼 기술적 실현 가능성만 보지 않고, 마케터처럼 홍보만 생각하지도 않는다. 대신 “사용자 니즈 + 비즈니스 목표 + 기술 제약”의 교집합을 찾는다.</p>
<p>“Think about user needs, business goals, and potential solutions”는 이 3가지 차원을 모두 고려하라는 명시적 지시다.</p>
<p><strong>5개 아이디어의 다양성 전략</strong></p>
<p>“5 distinct ideas”에서 “distinct”가 중요하다. 비슷비슷한 아이디어 5개가 아니라, 서로 다른 관점의 아이디어를 요구한다.</p>
<p><strong>어떻게 다양성을 확보하는가?</strong></p>
<p>AI는 보통 첫 번째 아이디어를 생성한 후, 그것의 변형을 만드는 경향이 있다. “distinct”라는 단어는 이를 방지한다. 각 아이디어가 다른 접근법을 사용하도록 강제한다.</p>
<p>예를 들어 “사용자 리텐션 개선” 주제라면:<br>
- 아이디어 1: 푸시 알림 개선 (기술적 접근)<br>
- 아이디어 2: 리워드 프로그램 (비즈니스 접근)<br>
- 아이디어 3: 커뮤니티 기능 추가 (소셜 접근)<br>
- 아이디어 4: 온보딩 프로세스 단순화 (UX 접근)<br>
- 아이디어 5: 프리미엄 기능 무료 체험 (마케팅 접근)</p>
<p><strong>4가지 요소 구조의 PM 방법론</strong></p>
<p>각 아이디어마다 제목, 설명, 이점, 과제를 요구한다. 이는 PM의 표준 평가 프레임워크다.</p>
<p><strong>Title (1-5 words)</strong><br>
짧은 제목은 커뮤니케이션 효율성을 높인다. 회의에서 “아이디어 3”이 아니라 “리워드 프로그램”이라고 부를 수 있다.</p>
<p><strong>Description (2-3 sentences)</strong><br>
간결함을 강제한다. 3문장으로 설명 못하면 아이디어가 아직 명확하지 않다는 신호다.</p>
<p><strong>One potential benefit</strong><br>
“왜 이게 좋은가?”에 대한 답. 이것이 없으면 아이디어는 그냥 제안일 뿐이다.</p>
<p><strong>One possible challenge</strong><br>
이것이 핵심이다. 대부분의 브레인스토밍은 장점만 나열한다. 하지만 실무에서는 “무엇이 문제인가?”를 먼저 파악해야 실행 가능성을 판단할 수 있다.</p>
<p>예시:</p>
<pre><code>아이디어: 사용자 커뮤니티 포럼 추가
이점: 사용자 간 도움으로 고객 지원 비용 감소
과제: 부정적 피드백이 공개적으로 확산될 위험</code></pre>
<p>과제를 명시하면 “이 아이디어를 실행하려면 커뮤니티 모더레이션 전략이 필요하다”는 후속 논의가 자연스럽게 이어진다.</p>
<p><strong>4단계: Common themes 파악</strong></p>
<p>이 단계는 패턴 인식이다. 5개 아이디어를 보면 보통 2~3개의 공통 테마가 발견된다.</p>
<p>예를 들어:<br>
- 아이디어 1, 3: 사용자 참여 증대<br>
- 아이디어 2, 5: 경제적 인센티브<br>
- 아이디어 4: 진입 장벽 제거</p>
<p>테마를 파악하면 “우리가 실제로 해결하려는 근본 문제가 무엇인가?”를 이해할 수 있다.</p>
<p><strong>5단계: 아이디어 결합</strong></p>
<p>최고의 솔루션은 종종 여러 아이디어의 조합이다. 이 단계는 시너지를 찾는다.</p>
<p>예시:</p>
<pre><code>결합: 리워드 프로그램 + 커뮤니티 포럼
→ "커뮤니티 기여 리워드 시스템"

사용자가 포럼에서 다른 사용자를 도우면 포인트를 얻고, 
포인트로 프리미엄 기능을 잠금 해제할 수 있다.

이점: 
- 커뮤니티 활성화 (도움을 주려는 동기 부여)
- 프리미엄 전환 유도 (맛보기 효과)
- 고객 지원 비용 감소

과제:
- 포인트 경제 설계 복잡도
- 악용 방지 (스팸, 저품질 답변)</code></pre>
<p>결합은 단순 합산이 아니라, 두 아이디어가 만나서 새로운 가치를 창출하는 것이다.</p>
</section>
<section id="엔지니어-python-코드-리서치-템플릿" class="level2" data-number="1.4">
<h2 data-number="1.4" class="anchored" data-anchor-id="엔지니어-python-코드-리서치-템플릿"><span class="header-section-number">1.4</span> 엔지니어 Python 코드 리서치 템플릿</h2>
<pre><code>You are a Python code analyst tasked with researching specific
aspects of Python code. Your goal is to analyze the given code
snippet and answer a research question about it. 
Follow these instructions carefully:

1. You will be presented with a Python code snippet and a
   research question.

2. Here is the Python code to analyze:
&lt;python_code&gt;
{{PYTHON_CODE}}
&lt;/python_code&gt;

3. Here is the research question to answer:
&lt;research_question&gt;
{{RESEARCH_QUESTION}}
&lt;/research_question&gt;

4. Analyze the provided Python code carefully. Consider its
   structure, functionality, and any notable features or patterns.

5. Answer the research question based on your analysis of the code. 
   Your answer should be thorough, accurate, and directly related to 
   the code and the question asked.

6. Provide your response in the following format:
&lt;analysis&gt;
First, provide a brief overview of the code and its main features.
&lt;/analysis&gt;

&lt;answer&gt;
Then, provide a detailed answer to the research question. 
Include specific references to the code where relevant. 
If the question cannot be fully answered based on the
provided code, explain why and what additional information 
might be needed.
&lt;/answer&gt;

Remember to focus solely on the provided code and the specific 
research question. Do not make assumptions about code that isn't 
shown or speculate about the broader context unless it's directly 
relevant to answering the question.</code></pre>
<p><strong>XML 태그 구조의 전략적 사용</strong></p>
<p>이 템플릿은 XML 태그를 적극 활용한다. <code>&lt;python_code&gt;</code>, <code>&lt;research_question&gt;</code>, <code>&lt;analysis&gt;</code>, <code>&lt;answer&gt;</code> 같은 명시적 구조화는 세 가지 이점을 제공한다.</p>
<p><strong>이점 1: 명확한 경계</strong><br>
코드 분석에서 가장 큰 문제는 “어디까지가 분석할 코드이고, 어디부터가 질문인가?”의 혼란이다. XML 태그는 이를 완벽히 분리한다.</p>
<p><strong>이점 2: 프로그래밍 방식 처리</strong><br>
XML 구조는 자동화에 유리하다. 예를 들어 GitHub에서 코드를 자동으로 가져와 <code>&lt;python_code&gt;</code> 태그에 삽입하는 스크립트를 만들 수 있다.</p>
<p><strong>이점 3: 일관된 출력 형식</strong><br>
AI의 출력도 XML 태그로 구조화되므로, 파싱이 쉽다. <code>&lt;analysis&gt;</code> 부분만 추출하거나, <code>&lt;answer&gt;</code>만 표시하는 등 유연한 활용이 가능하다.</p>
<p><strong>“Do not make assumptions” 경고의 중요성</strong></p>
<p>코드 분석에서 AI의 가장 큰 함정은 “보이지 않는 코드를 가정하는 것”이다.</p>
<p>예를 들어:</p>
<div class="sourceCode" id="cb6" style="background: #f1f3f5;"><pre class="sourceCode numberSource python number-lines code-with-copy"><code class="sourceCode python"><span id="cb6-1">result <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> process_data(<span class="bu" style="color: null;
background-color: null;
font-style: inherit;">input</span>)</span></code></pre></div>
<p>AI는 <code>process_data</code> 함수의 구현을 보지 못했는데도, “이 함수는 아마 데이터를 정규화할 것이다”같은 추측을 할 수 있다. 이는 위험하다.</p>
<p>“Do not make assumptions about code that isn’t shown”은 이를 명시적으로 금지한다. 대신 “제공된 코드만으로는 process_data의 동작을 확인할 수 없다”고 정직하게 말하도록 강제한다.</p>
<p><strong>2단계 출력 구조의 가치</strong></p>
<p><strong><analysis>: 전체적 이해</analysis></strong><br>
먼저 코드를 전체적으로 파악한다. “이 코드는 웹 스크래핑을 수행하며, BeautifulSoup를 사용한다”같은 큰 그림을 제시한다.</p>
<p>이는 맥락을 설정한다. 연구 질문이 “왜 try-except를 사용했나?”라면, “이 코드는 외부 API를 호출하므로 네트워크 오류 가능성이 있다”는 맥락이 답변 이해를 돕는다.</p>
<p><strong><answer>: 구체적 답변</answer></strong><br>
그 다음 연구 질문에 집중한다. “Include specific references to the code”는 중요하다. 모호한 답변이 아니라, “line 15의 <code>except requests.exceptions.Timeout</code>을 보면…”같은 구체적 참조를 요구한다.</p>
<p><strong>“If the question cannot be fully answered” 조건</strong></p>
<p>이는 정직성을 강제한다. 코드 일부만 제공되었거나, 질문이 코드 범위를 벗어나면, AI는 이를 인정해야 한다.</p>
<p>예시:</p>
<pre><code>질문: "이 함수의 시간 복잡도는?"
코드: 함수 시그니처만 있고 구현은 없음

나쁜 답변: "O(n)일 것으로 추정됩니다"
좋은 답변: "함수 구현이 제공되지 않아 시간 복잡도를 정확히 분석할 수 없습니다. 
           구현 코드가 필요합니다."</code></pre>
</section>
<section id="엔지니어-python-코드-디버깅-템플릿" class="level2" data-number="1.5">
<h2 data-number="1.5" class="anchored" data-anchor-id="엔지니어-python-코드-디버깅-템플릿"><span class="header-section-number">1.5</span> 엔지니어 Python 코드 디버깅 템플릿</h2>
<pre><code>You are a Python debugging assistant. Your task is to
analyze Python code that has an error and provide
suggestions to fix it. Follow these steps:

1. Review the provided Python code:
&lt;python_code&gt;
{{PYTHON_CODE}}
&lt;/python_code&gt;

2. Examine the error message:
&lt;error_message&gt;
{{ERROR_MESSAGE}}
&lt;/error_message&gt;

3. Analyze the code and the error message carefully.
Consider the following:
- The type of error (syntax, runtime, logical, etc.)
- The line number where the error occurred (if provided)
- Any specific variables or functions mentioned in the error

4. Provide your debugging suggestions and explanations in the 
   following format:

&lt;debug_analysis&gt;
a) Briefly describe the error and its likely cause
b) Identify the specific line(s) of code that are problematic
c) Explain why the error is occurring
d) Suggest one or more solutions to fix the error
e) If applicable, provide any additional tips or best practices 
   related to the issue
&lt;/debug_analysis&gt;

5. If you believe there might be multiple issues or if the error 
   message is unclear, mention this and provide suggestions for 
   further troubleshooting.

6. If you need any clarification or additional information to 
   better assist with debugging, please state so clearly.

Remember to be clear, concise, and helpful in your explanations. 
Your goal is to not only fix the immediate error but also to help 
the user understand why the error occurred and how to prevent 
similar issues in the future.</code></pre>
<p><strong>디버깅 vs 코드 리서치의 차이</strong></p>
<p>이 템플릿은 리서치 템플릿과 비슷해 보이지만, 근본적으로 다른 목적을 가진다.</p>
<p><strong>리서치</strong>: “이 코드는 어떻게 작동하는가?” (이해)<br>
<strong>디버깅</strong>: “이 코드는 왜 작동하지 않는가?” (문제 해결)</p>
<p>디버깅은 에러 메시지라는 추가 입력이 있고, 출력은 “해결 방법”에 집중한다.</p>
<p><strong>에러 타입 분류의 중요성</strong></p>
<p>“The type of error (syntax, runtime, logical, etc.)”는 진단의 첫 단계다.</p>
<p><strong>Syntax Error</strong><br>
코드가 파이썬 문법을 위반했다. 실행조차 안 된다.<br>
예: <code>if x = 5:</code> (=는 할당, ==가 비교)</p>
<p><strong>Runtime Error</strong><br>
문법은 맞지만 실행 중 문제 발생.<br>
예: <code>1 / 0</code> (ZeroDivisionError)</p>
<p><strong>Logical Error</strong><br>
코드가 실행되지만 예상과 다른 결과.<br>
예: <code>sum = a - b</code> (더하기가 아니라 빼기)</p>
<p>에러 타입에 따라 해결 전략이 완전히 다르다. Syntax는 코드 수정, Runtime은 예외 처리, Logical은 알고리즘 재검토가 필요하다.</p>
<p><strong>5단계 debug_analysis 구조</strong></p>
<p><strong>a) Briefly describe the error and its likely cause</strong><br>
“IndexError: list index out of range”를 “리스트 길이보다 큰 인덱스에 접근하려 했다”로 평문 설명한다. 에러 메시지는 개발자용이라 초보자는 이해 못할 수 있다.</p>
<p><strong>b) Identify the specific line(s)</strong><br>
“line 42: <code>result = data[i]</code>”처럼 정확한 위치를 찾아준다. 에러 메시지에 라인 번호가 있으면 쉽지만, 없으면 코드를 분석해서 찾아야 한다.</p>
<p><strong>c) Explain why</strong><br>
이것이 교육적 가치의 핵심이다. “왜 에러가 나는가?”를 설명한다.</p>
<p>예: “<code>data</code> 리스트 길이는 10인데, 루프는 <code>range(15)</code>로 15번 반복하므로, i=10부터 IndexError 발생”</p>
<p><strong>d) Suggest solutions</strong><br>
여러 해결책을 제시한다. 각각의 트레이드오프도 설명한다.</p>
<p>예:</p>
<pre><code>해결책 1: range(len(data))로 변경 (안전하지만 원래 의도와 다를 수 있음)
해결책 2: data.extend([None] * 5)로 리스트 확장 (의도대로지만 None 처리 필요)
해결책 3: if i &lt; len(data): 조건 추가 (유연하지만 코드 복잡도 증가)</code></pre>
<p><strong>e) Best practices</strong><br>
단순 버그 수정을 넘어서 “이런 종류의 버그를 예방하려면?”을 제안한다.</p>
<p>예: “리스트 인덱싱 전에 항상 길이 체크 / enumerate() 사용 / try-except로 감싸기”</p>
<p><strong>“Multiple issues” 경고의 실전적 가치</strong></p>
<p>실무에서 에러는 종종 여러 문제가 연쇄적으로 발생한 결과다. 하나를 고치면 다음 에러가 나타난다.</p>
<p>템플릿은 AI에게 “다른 잠재적 문제도 찾아라”고 지시한다.</p>
<p>예:</p>
<pre><code>디버깅 분석:
현재 에러: IndexError at line 42

해결 후 예상 문제:
- line 50: data[i]에서 TypeError 가능 (None 값 처리 안 됨)
- line 65: result 반환 전 초기화 안 됨 (UnboundLocalError 위험)

권장: 현재 에러 수정 후, 전체 코드 리뷰하여 위 문제들도 선제적 수정</code></pre>
<p>이는 디버깅 시간을 크게 단축한다. “하나 고치고 실행, 또 에러, 또 고치고…”를 반복하지 않아도 된다.</p>
</section>
<section id="마케터-프롬프트-템플릿" class="level2" data-number="1.6">
<h2 data-number="1.6" class="anchored" data-anchor-id="마케터-프롬프트-템플릿"><span class="header-section-number">1.6</span> 마케터 프롬프트 템플릿</h2>
<pre><code>You are tasked with creating effective prompts for a growth and 
content marketer. Your goal is to create prompts that are specific, 
actionable, and aligned with the given marketing goal and target audience.

You will be provided with two input variables:

&lt;marketing_goal&gt;
{{MARKETING_GOAL}}
&lt;/marketing_goal&gt;

&lt;target_audience&gt;
{{TARGET_AUDIENCE}}
&lt;/target_audience&gt;

Use these inputs to tailor your prompts to the specific marketing goal 
and target audience.

Guidelines:
1. Make the prompts specific and focused on the marketing goal
2. Ensure the prompts consider the target audience's needs, preferences,
   and pain points
3. Use action-oriented language that encourages creative thinking
4. Include elements that can lead to measurable outcomes
5. Keep the prompts open-ended enough to allow for diverse ideas

Output your prompts in the following format:
&lt;prompt&gt;
Insert your prompt here
&lt;/prompt&gt;

Here are two examples of good prompts:

&lt;prompt&gt;
Develop a content strategy for a blog series that addresses the top 5
pain points of {{target_audience}} related to {{marketing_goal}}, 
including potential topics, content formats, and distribution channels.
&lt;/prompt&gt;

&lt;prompt&gt;
Create a social media campaign concept that showcases how our
product/service helps {{target_audience}} achieve {{marketing_goal}},
including post ideas for three different platforms and a hashtag strategy.
&lt;/prompt&gt;

Generate 5 unique prompts following the guidelines and format provided
above. Ensure that each prompt is distinct and addresses different
aspects of the marketing goal and target audience.</code></pre>
<p><strong>“프롬프트를 만드는 프롬프트”의 메타 구조</strong></p>
<p>이 템플릿은 흥미로운 메타 레벨에서 작동한다. 마케터에게 직접 콘텐츠를 만들어주는 게 아니라, 마케터가 사용할 프롬프트를 생성해준다.</p>
<p><strong>왜 이런 구조인가?</strong></p>
<p>마케팅은 반복적이고 다양하다. 블로그 글 10개, 소셜 포스트 50개, 이메일 캠페인 20개를 만들어야 한다. 매번 프롬프트를 처음부터 쓰기보다, “이 캠페인에 맞는 프롬프트 5개”를 먼저 생성하면 효율적이다.</p>
<p><strong>5가지 Guidelines의 마케팅 전문성</strong></p>
<p><strong>1. Specific and focused on the marketing goal</strong><br>
모호한 프롬프트는 모호한 결과를 낳는다. “소셜 미디어 콘텐츠 만들어줘”보다 “Instagram에서 MZ세대에게 친환경 패션 브랜드 인지도를 높이는 릴스 스크립트 5개”가 훨씬 낫다.</p>
<p><strong>2. Consider target audience’s needs, preferences, and pain points</strong><br>
마케팅의 황금률은 “고객이 원하는 것을 줘라”다. 프롬프트에 타겟 오디언스가 명시되지 않으면, AI는 일반적이고 차별화되지 않은 콘텐츠를 만든다.</p>
<p>예: “바쁜 직장인”과 “은퇴한 시니어”는 완전히 다른 pain point를 가진다.<br>
- 직장인: 시간 부족, 효율성, 빠른 결과<br>
- 시니어: 신뢰성, 단순함, 장기적 가치</p>
<p><strong>3. Action-oriented language</strong><br>
“Create”, “Develop”, “Design”같은 동사는 구체적 산출물을 유도한다. “Think about”이나 “Consider”는 너무 추상적이다.</p>
<p>나쁜 예: “소셜 미디어 전략에 대해 생각해봐”<br>
좋은 예: “주 3회 포스팅 일정표를 만들고, 각 포스트의 목표와 CTA를 명시해”</p>
<p><strong>4. Include elements that can lead to measurable outcomes</strong><br>
마케팅은 결과로 평가된다. “인지도 향상”은 측정 불가능하다. “웹사이트 방문자 30% 증가”는 측정 가능하다.</p>
<p>프롬프트에 “including metrics to track success”같은 문구를 넣으면, AI가 KPI까지 제안한다.</p>
<p><strong>5. Keep the prompts open-ended</strong><br>
역설적이지만, 너무 구체적인 프롬프트는 창의성을 제한한다. “빨간색 배경에 큰 글씨로”보다 “시선을 확 끄는 비주얼”이 더 다양한 아이디어를 낸다.</p>
<p><strong>예시 프롬프트의 구조 분석</strong></p>
<p><strong>예시 1: 블로그 시리즈</strong></p>
<pre><code>Develop a content strategy for a blog series that addresses the top 5
pain points of {{target_audience}} related to {{marketing_goal}}, 
including potential topics, content formats, and distribution channels.</code></pre>
<p>이 프롬프트는 세 가지 산출물을 요구한다:<br>
1. <strong>Top 5 pain points</strong>: 먼저 고객 이해<br>
2. <strong>Topics + formats</strong>: 어떤 내용을 어떤 형식으로<br>
3. <strong>Distribution channels</strong>: 어디서 공유할 것인가</p>
<p>이는 마케팅 전략의 완전한 프레임워크다. 단순히 “블로그 글 써줘”가 아니라 전체 캠페인 설계를 포함한다.</p>
<p><strong>예시 2: 소셜 미디어 캠페인</strong></p>
<pre><code>Create a social media campaign concept that showcases how our
product/service helps {{target_audience}} achieve {{marketing_goal}},
including post ideas for three different platforms and a hashtag strategy.</code></pre>
<p>“Three different platforms”가 중요하다. Instagram, LinkedIn, Twitter는 완전히 다른 콘텐츠 전략이 필요하다.<br>
- Instagram: 시각 중심, 짧은 캡션, 이모지<br>
- LinkedIn: 전문적, 긴 텍스트, 사례 연구<br>
- Twitter: 간결, 실시간, 대화형</p>
<p>“Hashtag strategy”는 발견성(discoverability)을 고려한다. 좋은 해시태그는 너무 일반적이지도(#marketing - 경쟁 과다), 너무 구체적이지도 않다(#b2bsaasmarketingforsmbs - 검색 안 됨).</p>
<p><strong>5개 프롬프트 생성 요구의 의도</strong></p>
<p>왜 5개인가? 다양성과 선택지를 제공하기 위함이다.</p>
<p>마케터는:<br>
- 프롬프트 1: 블로그 콘텐츠용<br>
- 프롬프트 2: 소셜 미디어용<br>
- 프롬프트 3: 이메일 캠페인용<br>
- 프롬프트 4: 랜딩 페이지용<br>
- 프롬프트 5: 비디오 스크립트용</p>
<p>이렇게 채널별로 특화된 프롬프트를 받는다. 각각을 반복 사용하면 일관된 브랜드 메시지를 유지하면서도 채널별 최적화가 가능하다.</p>
</section>
<section id="직군별-템플릿의-실전-활용-전략" class="level2" data-number="1.7">
<h2 data-number="1.7" class="anchored" data-anchor-id="직군별-템플릿의-실전-활용-전략"><span class="header-section-number">1.7</span> 직군별 템플릿의 실전 활용 전략</h2>
<p><strong>템플릿 커스터마이징</strong></p>
<p>제공된 템플릿은 시작점이다. 실제로는 회사와 팀의 특성에 맞춰 수정해야 한다.</p>
<p>예: 스타트업의 PM 브레인스토밍</p>
<pre><code>원본: Generate 5 distinct ideas
수정: Generate 5 distinct ideas, prioritizing those that can be 
      implemented with a team of 3 engineers in 2 weeks</code></pre>
<p>리소스 제약을 명시하면, 실행 가능한 아이디어에 집중한다.</p>
<p><strong>템플릿 조합</strong></p>
<p>여러 템플릿을 순차적으로 사용하면 강력하다.</p>
<p>워크플로우 예시:<br>
1. PM 브레인스토밍 템플릿 → 5개 아이디어 생성<br>
2. 엔지니어 코드 리서치 템플릿 → 각 아이디어의 기술적 실현 가능성 평가<br>
3. 마케터 프롬프트 템플릿 → 실행 가능한 아이디어의 마케팅 전략 수립</p>
<p><strong>템플릿 라이브러리 구축</strong></p>
<p>기업은 직군별 템플릿을 내부 위키나 Notion에 정리해야 한다.</p>
<p>구조 예시:</p>
<pre><code>템플릿 라이브러리/
├── Product/
│   ├── brainstorming.md
│   ├── user_story.md
│   └── roadmap.md
├── Engineering/
│   ├── code_review.md
│   ├── debugging.md
│   └── architecture_design.md
├── Marketing/
│   ├── campaign_planning.md
│   ├── content_creation.md
│   └── ab_test_design.md
└── Operations/
    ├── process_optimization.md
    ├── incident_report.md
    └── quarterly_planning.md</code></pre>
<p>각 템플릿에는 사용 예시와 성공 사례를 첨부한다. 신입이 와도 즉시 검증된 프롬프트를 사용할 수 있다.</p>


</section>
</section>

 ]]></description>
  <category>Prompt Engineering</category>
  <category>LLM</category>
  <category>AI</category>
  <category>Agent</category>
  <guid>kk3225.netlify.app/docs/blog/posts/Agent/02-Prompt/38-PromptWriting-DomainSpecificPrompt.html</guid>
  <pubDate>Sun, 01 Feb 2026 15:00:00 GMT</pubDate>
</item>
<item>
  <title>이미지 생성 프롬프트 엔지니어링: DALL·E 3 실전 가이드</title>
  <dc:creator>Kwangmin Kim</dc:creator>
  <link>kk3225.netlify.app/docs/blog/posts/Agent/02-Prompt/39-PromptWriting-ImageGeneration.html</link>
  <description><![CDATA[ 





<section id="이미지-생성-프롬프트-dalle-3" class="level1" data-number="1">
<h1 data-number="1"><span class="header-section-number">1</span> 이미지 생성 프롬프트 (DALL·E 3)</h1>
<section id="이미지-생성의-패러다임-전환" class="level2" data-number="1.1">
<h2 data-number="1.1" class="anchored" data-anchor-id="이미지-생성의-패러다임-전환"><span class="header-section-number">1.1</span> 이미지 생성의 패러다임 전환</h2>
<p>DALL·E 3는 텍스트 프롬프트만으로 이미지를 생성하는 AI 모델이다. 이는 창작 프로세스의 근본적 변화를 의미한다.</p>
<p><strong>전통적 이미지 제작 프로세스</strong><br>
컨셉 스케치 → 러프 드래프트 → 상세 작업 → 수정 → 최종본<br>
시간: 수 시간~수 일<br>
비용: 디자이너 인건비<br>
한계: 여러 버전 시도 어려움</p>
<p><strong>DALL·E 3 프로세스</strong><br>
텍스트 프롬프트 입력 → 이미지 생성 (30초)<br>
시간: 1분 이내<br>
비용: API 비용 (매우 저렴)<br>
장점: 수십 개 버전 빠르게 실험 가능</p>
<p><strong>창작의 민주화</strong></p>
<p>그림을 그릴 줄 모르는 사람도 머릿속 이미지를 구현할 수 있다. 마케터가 직접 광고 비주얼 초안을 만들고, 작가가 소설 표지를 디자인하며, 교사가 교육 자료 삽화를 제작한다.</p>
<p>단, 여전히 “무엇을 만들고 싶은가”를 명확히 표현하는 능력은 필요하다. 좋은 프롬프트는 좋은 이미지의 전제조건이다.</p>
</section>
<section id="dalle-3-프롬프트-예시-분석" class="level2" data-number="1.2">
<h2 data-number="1.2" class="anchored" data-anchor-id="dalle-3-프롬프트-예시-분석"><span class="header-section-number">1.2</span> DALL·E 3 프롬프트 예시 분석</h2>
<section id="prompt-1-감각적-표현" class="level3" data-number="1.2.1">
<h3 data-number="1.2.1" class="anchored" data-anchor-id="prompt-1-감각적-표현"><span class="header-section-number">1.2.1</span> Prompt #1: 감각적 표현</h3>
<pre><code>An expressive oil painting of a chocolate chip cookie being dipped in
a glass of milk, depicted as an explosion of flavors.</code></pre>
<p><strong>생성 이미지 특징</strong></p>
<p>이 프롬프트는 단순한 정물화가 아니라 “감각의 시각화”를 요구한다. “explosion of flavors”라는 추상적 개념을 시각적으로 표현해야 한다.</p>
<p><strong>프롬프트 해부</strong></p>
<p><strong>“expressive oil painting”</strong><br>
매체와 스타일을 명시한다. “oil painting”은 질감, 붓터치, 색의 깊이를 암시한다. “expressive”는 사실적 묘사보다 감정과 에너지를 우선한다는 신호다.</p>
<p>만약 “realistic photograph”였다면 완전히 다른 이미지가 나왔을 것이다. 매체 선택은 전체 분위기를 결정한다.</p>
<p><strong>“chocolate chip cookie being dipped”</strong><br>
동작을 포함한다. 정지 상태의 쿠키가 아니라 “담그는 순간”이다. 동작은 이미지에 생동감을 준다.</p>
<p>“being dipped”는 현재 진행형이다. 과거형(“dipped”)이나 미래형(“about to dip”)과 다르다. 진행형은 가장 역동적인 순간을 포착한다.</p>
<p><strong>“explosion of flavors”</strong></p>
<p>이것이 프롬프트의 핵심이다. 물리적으로 불가능한 개념을 시각화하라는 요구다. “맛”은 보이지 않는데 어떻게 “폭발”로 표현하는가?</p>
<p>DALL·E 3는 이를 아마도:<br>
- 우유가 사방으로 튀는 역동적 구도<br>
- 쿠키에서 초콜릿 칩이 반짝이는 효과<br>
- 따뜻한 색감의 빛 폭발<br>
- 추상적 에너지 선</p>
<p>같은 시각적 메타포로 표현했을 것이다.</p>
<p><strong>프롬프트 설계 원칙</strong></p>
<p>이 예시에서 배울 점:<br>
1. 구체적 객체(쿠키, 우유) + 추상적 개념(맛의 폭발) 조합<br>
2. 매체 명시로 스타일 제어<br>
3. 동작 포함으로 생동감 부여</p>
</section>
<section id="prompt-2-복합적-장면-구성" class="level3" data-number="1.2.2">
<h3 data-number="1.2.2" class="anchored" data-anchor-id="prompt-2-복합적-장면-구성"><span class="header-section-number">1.2.2</span> Prompt #2: 복합적 장면 구성</h3>
<pre><code>A serene scene with a woman setting up a picnic under a cherry blossom
tree, with a sunset view of a rowboat on a pond and a building in the
distance inspired by South Korean architecture.</code></pre>
<p><strong>장면의 레이어링</strong></p>
<p>이 프롬프트는 여러 요소를 공간적으로 배치한다. 전경, 중경, 원경의 3층 구조다.</p>
<p><strong>전경 (Foreground)</strong>: 여성, 피크닉, 벚꽃나무<br>
<strong>중경 (Midground)</strong>: 연못, 노 젓는 보트<br>
<strong>원경 (Background)</strong>: 한국 건축 양식 건물, 석양</p>
<p><strong>공간 구성의 전략</strong></p>
<p><strong>“with a woman setting up a picnic under a cherry blossom tree”</strong><br>
주 피사체와 행동을 명확히 한다. “setting up”은 준비하는 순간의 자연스러움을 준다. 완성된 피크닉보다 “설치 중”이 더 스토리를 담는다.</p>
<p>“under”는 공간 관계를 정의한다. 여성이 나무 옆이 아니라 아래에 있다는 것은, 벚꽃이 프레임 상단을 차지하며 여성을 감싸는 구도를 만든다.</p>
<p><strong>“with a sunset view of a rowboat on a pond”</strong><br>
“sunset view”는 시간과 조명을 설정한다. 석양은 따뜻한 오렌지-핑크 색조를 전체 장면에 입힌다.</p>
<p>“rowboat on a pond”는 평화로움을 강화한다. 모터보트가 아니라 노 젓는 보트는 느림과 고요함의 상징이다.</p>
<p><strong>“building in the distance inspired by South Korean architecture”</strong></p>
<p>“in the distance”는 깊이를 만든다. 건물이 가까우면 시선이 분산되지만, 멀리 있으면 맥락을 제공하면서도 주 피사체를 방해하지 않는다.</p>
<p>“inspired by South Korean architecture”는 문화적 특수성을 부여한다. 단순히 “building”이라면 어느 나라 건물인지 모호하다. 하지만 한국 건축 특징(기와지붕, 처마, 단청 등)을 명시하면 장소성이 생긴다.</p>
<p><strong>“serene scene”의 역할</strong></p>
<p>프롬프트 첫 단어가 전체 톤을 설정한다. “serene”(평온한)은 모든 요소가 이 분위기를 지지하도록 만든다. 만약 “dramatic scene”이었다면 같은 요소들이 완전히 다른 조명과 구도로 배치되었을 것이다.</p>
</section>
<section id="prompt-3-초현실적-개념-이미지" class="level3" data-number="1.2.3">
<h3 data-number="1.2.3" class="anchored" data-anchor-id="prompt-3-초현실적-개념-이미지"><span class="header-section-number">1.2.3</span> Prompt #3: 초현실적 개념 이미지</h3>
<pre><code>A swirling, multicolored portal emerges from the depths of an ocean of
coffee, with waves of the rich liquid gently rippling outward.
The portal engulfs a coffee cup, which serves as a gateway to a
fantastical dimension. The surrounding digital art landscape reflects 
the colors of the portal, creating an alluring scene of endless possibilities.</code></pre>
<p><strong>초현실주의의 구현</strong></p>
<p>이 프롬프트는 현실에 존재할 수 없는 장면을 묘사한다. “커피 바다”와 “차원 관문”의 조합은 순수한 상상이다.</p>
<p><strong>단계적 장면 구축</strong></p>
<p><strong>1단계: 기반 설정</strong><br>
“ocean of coffee” - 불가능한 전제를 확립한다. 물이 아니라 커피로 이루어진 바다. 이는 독자에게 “현실 법칙은 무시하라”는 신호다.</p>
<p><strong>2단계: 주요 요소 도입</strong><br>
“swirling, multicolored portal emerges from the depths” - 소용돌이치는 포털이 커피 바다 깊은 곳에서 올라온다. “emerges”는 생성의 순간, 역동적 에너지를 전달한다.</p>
<p><strong>3단계: 물리적 효과</strong><br>
“waves of the rich liquid gently rippling outward” - 포털이 주변 커피에 파문을 만든다. “gently rippling”은 부드럽고 최면적인 움직임이다. “rich liquid”는 커피의 질감과 농도를 강조한다.</p>
<p><strong>4단계: 핵심 오브젝트</strong><br>
“The portal engulfs a coffee cup, which serves as a gateway to a fantastical dimension” - 커피잔이 단순한 소품이 아니라 관문이다. 스케일의 역전이 일어난다. 보통 잔이 작지만, 여기서는 잔이 차원으로 통하는 문이다.</p>
<p><strong>5단계: 환경 통합</strong><br>
“The surrounding digital art landscape reflects the colors of the portal” - 포털의 색이 주변 환경에 반사된다. 이는 장면의 통일성을 만든다. 모든 요소가 색으로 연결된다.</p>
<p><strong>6단계: 감정적 앵커</strong><br>
“creating an alluring scene of endless possibilities” - 단순히 시각적 묘사를 넘어 감정을 명시한다. “alluring”(매혹적인)과 “endless possibilities”(무한한 가능성)는 보는 이가 느껴야 할 감정을 지시한다.</p>
<p><strong>서술 밀도의 중요성</strong></p>
<p>이 프롬프트는 비교적 길다(약 60단어). 단순한 장면은 짧은 프롬프트로 충분하지만, 복잡하고 초현실적인 장면은 상세한 서술이 필요하다.</p>
<p><strong>각 문장의 역할</strong><br>
- 문장 1: 불가능한 세계관 설정<br>
- 문장 2: 물리적 효과와 디테일<br>
- 문장 3: 핵심 오브젝트와 의미<br>
-문장 4: 환경의 반응과 분위기</p>
<p>이는 영화 각본의 장면 묘사와 유사하다. 감독에게 “어떻게 촬영할지” 알려주듯, AI에게 “어떻게 그릴지” 알려준다.</p>
</section>
<section id="prompt-4-유머와-역설" class="level3" data-number="1.2.4">
<h3 data-number="1.2.4" class="anchored" data-anchor-id="prompt-4-유머와-역설"><span class="header-section-number">1.2.4</span> Prompt #4: 유머와 역설</h3>
<pre><code>Paying for a quarter-sized pizza with a pizza-sized quarter</code></pre>
<p><strong>간결함 속의 완결성</strong></p>
<p>겨우 9단어지만 완벽한 시각적 개그다. 이 프롬프트는 “적을수록 좋다”는 원칙을 보여준다.</p>
<p><strong>스케일 역전의 유머</strong></p>
<p>일상적 관계: 동전(작음) → 피자(큼)<br>
역전된 관계: 피자(작음) → 동전(큼)</p>
<p>이 역설이 시각적으로 표현되면 즉각적인 웃음을 유발한다. 피자 크기의 거대한 25센트 동전을 상상해보라.</p>
<p><strong>맥락의 암묵적 제공</strong></p>
<p>프롬프트는 “식당”, “계산대”, “사람” 같은 단어를 명시하지 않는다. 하지만 DALL·E 3는 “paying for”라는 행동에서 거래 상황을 추론한다. 아마도:<br>
- 카운터 또는 테이블<br>
- 작은 피자 상자<br>
- 거대한 동전을 건네는 손<br>
- 당황한 표정의 직원</p>
<p>같은 요소들이 자동으로 포함된다.</p>
<p><strong>개념적 이미지의 힘</strong></p>
<p>이런 유형의 프롬프트는 광고, 밈, 컨셉 아트에 유용하다. 복잡한 서술 없이 하나의 강력한 아이디어만으로 기억에 남는 이미지를 만든다.</p>
</section>
</section>
<section id="dalle-3-실습" class="level2" data-number="1.3">
<h2 data-number="1.3" class="anchored" data-anchor-id="dalle-3-실습"><span class="header-section-number">1.3</span> DALL·E 3 실습</h2>
<p><strong>Practice Prompt 1</strong></p>
<pre><code>Astronaut on an alien planet with cracked ground and distant
mountains, under a sky with a large planet rising, a spaceship
zooming, and stars. The scene has a cinematic feel with vivid
colors, combining digital art and sci-fi elements.</code></pre>
<p><strong>프롬프트 분석</strong></p>
<p><strong>환경 레이어링</strong><br>
- 지면: 갈라진 땅 (황량함, 건조함)<br>
- 중경: 먼 산맥 (스케일, 깊이)<br>
- 하늘: 떠오르는 행성, 우주선, 별 (외계 세계)</p>
<p><strong>시간 설정</strong><br>
“planet rising”은 행성의 일출/월출을 암시한다. 이는 지구의 일출과는 다른 초현실적 광경이다. 거대한 행성이 수평선 위로 떠오르는 장면은 SF의 아이콘이다.</p>
<p><strong>동적 요소</strong><br>
“spaceship zooming”은 정지된 풍경에 움직임을 추가한다. “zooming”은 빠른 속도를 의미하므로, 모션 블러나 궤적 효과가 나타날 것이다.</p>
<p><strong>스타일 지정</strong><br>
“cinematic feel with vivid colors” + “digital art and sci-fi elements”는 두 가지를 요구한다:<br>
1. 영화적 구도 (와이드 앵글, 드라마틱 조명)<br>
2. 생생한 색 팔레트 (흑백이나 무채색이 아닌)<br>
3. 디지털 아트 스타일 (전통 회화가 아닌)</p>
<p><strong>Practice Prompt 2</strong></p>
<pre><code>Digital illustration of a beach scene crafted from yarn. The
sandy beach is depicted with beige yarn, waves are made of
blue and white yarn crashing onto the shore. A yarn sun sets on
the horizon, casting a warm glow. Yarn palm trees sway gently,
and little yarn seashells dot the shoreline.</code></pre>
<p><strong>재료 제약 기법</strong></p>
<p>이 프롬프트는 “실로 만든 해변”이라는 독특한 제약을 사용한다. 모든 요소가 털실(yarn)로 표현되어야 한다는 것은 일관된 스타일을 강제한다.</p>
<p><strong>재료별 표현</strong><br>
- 모래: 베이지 실<br>
- 파도: 파란색과 흰색 실<br>
- 태양: 실로 만든 태양<br>
- 야자수: 실 야자수<br>
- 조개껍데기: 작은 실 조개</p>
<p><strong>질감의 시각화</strong></p>
<p>실 특유의 부드럽고 포근한 질감이 전체 이미지를 지배한다. 이는 사진같은 리얼리즘이 아니라 수공예품의 따뜻함을 추구한다.</p>
<p>“sway gently”는 야자수에 미묘한 움직임을 부여한다. 정지 이미지지만 바람의 느낌이 전달된다.</p>
<p><strong>아트 스타일로서의 재료 제약</strong></p>
<p>“crafted from yarn”은 단순한 장식이 아니다. 전체 미학을 정의한다. 비슷한 기법:<br>
- “made of LEGO bricks” (레고 스타일)<br>
- “sculpted from clay” (클레이메이션)<br>
- “papercraft style” (종이공예)<br>
- “stained glass art” (스테인드글라스)</p>
<p>재료를 명시하면 독특하고 일관된 비주얼을 쉽게 얻을 수 있다.</p>
</section>
<section id="dalle-3-cheat-sheet" class="level2" data-number="1.4">
<h2 data-number="1.4" class="anchored" data-anchor-id="dalle-3-cheat-sheet"><span class="header-section-number">1.4</span> DALL·E 3 Cheat Sheet</h2>
<section id="style-스타일" class="level3" data-number="1.4.1">
<h3 data-number="1.4.1" class="anchored" data-anchor-id="style-스타일"><span class="header-section-number">1.4.1</span> Style (스타일)</h3>
<p>스타일 선택은 이미지의 전체 느낌을 결정한다.</p>
<p><strong>Realistic</strong><br>
사진처럼 사실적. 빛, 그림자, 질감이 현실과 유사하다.<br>
용도: 제품 목업, 건축 시각화, 포트레이트</p>
<p><strong>Abstract</strong><br>
구상적 형태를 단순화하거나 해체한다. 색과 형태의 조합에 집중.<br>
용도: 앨범 커버, 현대 미술, 감정 표현</p>
<p><strong>Impressionistic</strong><br>
인상파 회화 스타일. 붓터치가 보이고, 색이 섞이며, 전체적 인상에 집중.<br>
용도: 풍경, 분위기 있는 장면</p>
<p><strong>Surrealistic</strong><br>
초현실주의. 꿈같고 비논리적인 요소 조합.<br>
용도: 컨셉 아트, 광고, 상상 장면</p>
<p><strong>Cartoonish/Comic</strong><br>
만화 스타일. 단순화된 형태, 명확한 윤곽선, 과장된 표현.<br>
용도: 캐릭터 디자인, 웹툰, 아동용 콘텐츠</p>
<p><strong>Photorealistic</strong><br>
사진과 구별 불가능한 수준. Realistic보다 더 극단적.<br>
용도: 고품질 제품 이미지, 광고</p>
<p><strong>Art Nouveau / Art Deco</strong><br>
특정 역사적 예술 운동 스타일.<br>
Art Nouveau: 곡선, 자연 모티프, 장식적<br>
Art Deco: 기하학, 대칭, 럭셔리</p>
<p><strong>스타일 지정 전략</strong></p>
<p>단순히 “realistic”이라고만 쓰지 말고:</p>
<pre><code>나쁜 예: "A cat, realistic"
좋은 예: "A cat photographed with a 50mm lens at f/1.8, 
         shallow depth of field, natural lighting, realistic"</code></pre>
<p>스타일에 더해 기술적 디테일을 추가하면 정교한 제어가 가능하다.</p>
</section>
<section id="image-parameters-이미지-파라미터" class="level3" data-number="1.4.2">
<h3 data-number="1.4.2" class="anchored" data-anchor-id="image-parameters-이미지-파라미터"><span class="header-section-number">1.4.2</span> Image Parameters (이미지 파라미터)</h3>
<p><strong>Subject Matter (주제)</strong></p>
<p>주제는 “무엇을 그릴 것인가”다.</p>
<ul>
<li><strong>Landscape</strong>: 자연 경관<br>
</li>
<li><strong>Portrait</strong>: 사람 얼굴 중심<br>
</li>
<li><strong>Abstract</strong>: 비구상적<br>
</li>
<li><strong>Wildlife</strong>: 동물<br>
</li>
<li><strong>Cityscape</strong>: 도시 풍경<br>
</li>
<li><strong>Still life</strong>: 정물<br>
</li>
<li><strong>Action</strong>: 동작 장면<br>
</li>
<li><strong>Fantasy</strong>: 환상적 요소<br>
</li>
<li><strong>Historical</strong>: 역사적 장면<br>
</li>
<li><strong>Futuristic</strong>: 미래 세계</li>
</ul>
<p><strong>주제 선택의 영향</strong></p>
<p>“Portrait”를 명시하면 AI는 자동으로:<br>
- 얼굴을 중심에 배치<br>
- 배경을 흐리게 (피사체 강조)<br>
- 조명을 얼굴에 집중</p>
<p><strong>Elements (요소)</strong></p>
<p>장면을 구성하는 개별 객체들.</p>
<ul>
<li>Trees, buildings, people, animals, vehicles<br>
</li>
<li>Furniture, appliances, clouds, water bodies<br>
</li>
<li>Mountains, flowers, fruits, electronics<br>
</li>
<li>Monuments, pathways</li>
</ul>
<p><strong>요소 배치 전략</strong></p>
<pre><code>기본: "A park with trees and people"
개선: "A park with three large oak trees in the foreground, 
      a couple walking on a path in the midground, and 
      a fountain in the background"</code></pre>
<p>공간 관계를 명시하면 구도가 명확해진다.</p>
<p><strong>Perspective (관점)</strong></p>
<p>카메라 시점은 이미지의 역동성을 결정한다.</p>
<ul>
<li><strong>Aerial view</strong>: 위에서 내려다봄 (조감도)<br>
</li>
<li><strong>Eye-level</strong>: 인간의 자연스러운 시선<br>
</li>
<li><strong>Low angle</strong>: 아래에서 올려다봄 (웅장함)<br>
</li>
<li><strong>High angle</strong>: 위에서 내려다봄 (취약함)<br>
</li>
<li><strong>Fish-eye</strong>: 극단적 광각, 왜곡<br>
</li>
<li><strong>Panoramic</strong>: 넓은 시야각<br>
</li>
<li><strong>Bird’s eye</strong>: 완전히 수직 위에서 (지도처럼)<br>
</li>
<li><strong>Worm’s eye</strong>: 완전히 수직 아래에서 (하늘 배경)<br>
</li>
<li><strong>Dutch angle</strong>: 기울어진 (불안정, 긴장)</li>
</ul>
<p><strong>관점의 감정적 효과</strong></p>
<ul>
<li>Low angle: 피사체를 강력하고 위압적으로 만듦<br>
</li>
<li>High angle: 피사체를 작고 취약하게 만듦<br>
</li>
<li>Eye-level: 중립적, 친밀감<br>
</li>
<li>Dutch angle: 불안, 혼란, 역동성</li>
</ul>
<p><strong>Scene Setting (장면 설정)</strong></p>
<p>장면의 위치와 환경.</p>
<ul>
<li><strong>Outdoor / Indoor</strong>: 실내 vs 실외<br>
</li>
<li><strong>Urban / Rural</strong>: 도시 vs 시골<br>
</li>
<li><strong>Coastal</strong>: 해안가<br>
</li>
<li><strong>Mountainous</strong>: 산악 지대<br>
</li>
<li><strong>Desert</strong>: 사막<br>
</li>
<li><strong>Forest / Jungle</strong>: 숲 / 정글<br>
</li>
<li><strong>Underwater</strong>: 수중<br>
</li>
<li><strong>Aerial</strong>: 공중<br>
</li>
<li><strong>Extraterrestrial</strong>: 외계</li>
</ul>
<p><strong>복합 설정</strong></p>
<pre><code>"A cyberpunk cityscape at night, with neon signs reflecting 
in rain-soaked streets (urban + coastal + futuristic)"</code></pre>
<p>여러 설정 요소를 조합하면 독특한 분위기를 만들 수 있다.</p>
</section>
<section id="lighting-description-조명" class="level3" data-number="1.4.3">
<h3 data-number="1.4.3" class="anchored" data-anchor-id="lighting-description-조명"><span class="header-section-number">1.4.3</span> Lighting Description (조명)</h3>
<p>조명은 분위기의 90%를 결정한다.</p>
<p><strong>Direction (방향)</strong></p>
<ul>
<li><strong>Top-down</strong>: 머리 위에서 (정오의 태양)<br>
</li>
<li><strong>Bottom-up</strong>: 아래에서 (으스스함)<br>
</li>
<li><strong>Side</strong>: 측면 (극적 음영)<br>
</li>
<li><strong>Frontal</strong>: 정면 (평면적, 명확함)<br>
</li>
<li><strong>Backlighting</strong>: 역광 (실루엣 효과)<br>
</li>
<li><strong>Rembrandt</strong>: 45도 각도 (클래식 초상화)<br>
</li>
<li><strong>Split</strong>: 얼굴 반쪽만 조명 (극적 대비)</li>
</ul>
<p><strong>Intensity (강도)</strong></p>
<ul>
<li><strong>Soft</strong>: 부드러운 그림자, 산란광<br>
</li>
<li><strong>Harsh</strong>: 강한 그림자, 직사광<br>
</li>
<li><strong>Low</strong>: 어둡고 무드 있는<br>
</li>
<li><strong>High</strong>: 밝고 명확한<br>
</li>
<li><strong>Glowing</strong>: 빛나는, 자체 발광<br>
</li>
<li><strong>Subdued</strong>: 억제된, 차분한</li>
</ul>
<p><strong>Color (색온도)</strong></p>
<ul>
<li><strong>Warm</strong>: 주황/노랑 (일몰, 촛불, 아늑함)<br>
</li>
<li><strong>Cool</strong>: 파랑/청록 (달빛, 형광등, 차가움)<br>
</li>
<li><strong>Neutral</strong>: 자연광 (낮)<br>
</li>
<li><strong>Golden hour</strong>: 일출/일몰의 황금빛</li>
</ul>
<p><strong>조명 조합 예시</strong></p>
<pre><code>"Portrait of a woman, Rembrandt lighting from the left, 
soft intensity, warm golden hour tones, creating an 
intimate and nostalgic mood"</code></pre>
<p>방향 + 강도 + 색을 모두 명시하면 정확한 분위기를 만들 수 있다.</p>
</section>
<section id="color-palette-색상-팔레트" class="level3" data-number="1.4.4">
<h3 data-number="1.4.4" class="anchored" data-anchor-id="color-palette-색상-팔레트"><span class="header-section-number">1.4.4</span> Color Palette (색상 팔레트)</h3>
<p><strong>Dominant Color(s) (주조색)</strong></p>
<p>이미지를 지배하는 색.</p>
<ul>
<li>Blue, red, green, yellow, orange, purple<br>
</li>
<li>Pink, brown, black, white, gray<br>
</li>
<li>Gold, silver, bronze, beige</li>
</ul>
<p><strong>주조색의 심리적 효과</strong><br>
- Blue: 신뢰, 평온, 차가움<br>
- Red: 열정, 위험, 에너지<br>
- Green: 자연, 성장, 안정<br>
- Yellow: 기쁨, 주의, 활기<br>
- Purple: 신비, 고급, 창의성</p>
<p><strong>Accent Color(s) (강조색)</strong></p>
<p>주조색을 보완하거나 대비시키는 색.</p>
<p>색 이론:<br>
- <strong>Complementary</strong>: 색상환 반대편 (파랑 + 주황)<br>
- <strong>Analogous</strong>: 색상환 인접 (파랑 + 청록 + 초록)<br>
- <strong>Triadic</strong>: 색상환 120도 간격 (빨강 + 노랑 + 파랑)</p>
<p><strong>Mood (분위기)</strong></p>
<ul>
<li><strong>Warm</strong>: 따뜻한 색 (빨강, 주황, 노랑)<br>
</li>
<li><strong>Cool</strong>: 차가운 색 (파랑, 초록, 보라)<br>
</li>
<li><strong>Vibrant</strong>: 채도 높은, 생생한<br>
</li>
<li><strong>Muted</strong>: 채도 낮은, 차분한<br>
</li>
<li><strong>Pastel</strong>: 연한, 부드러운<br>
</li>
<li><strong>Monochrome</strong>: 단색<br>
</li>
<li><strong>Earthy</strong>: 흙색 계열 (갈색, 베이지, 초록)</li>
</ul>
<p><strong>Tones (톤)</strong></p>
<ul>
<li><strong>Saturated</strong>: 순색에 가까운<br>
</li>
<li><strong>Desaturated</strong>: 회색이 섞인<br>
</li>
<li><strong>Dark</strong>: 어두운 톤<br>
</li>
<li><strong>Light</strong>: 밝은 톤</li>
</ul>
<p><strong>색상 팔레트 프롬프트 예시</strong></p>
<pre><code>"A fantasy forest scene with dominant deep greens and browns,
accented with glowing purple mushrooms, creating a mysterious 
and magical mood with slightly desaturated, earthy tones"</code></pre>
</section>
<section id="image-editing-prompts-이미지-편집" class="level3" data-number="1.4.5">
<h3 data-number="1.4.5" class="anchored" data-anchor-id="image-editing-prompts-이미지-편집"><span class="header-section-number">1.4.5</span> Image Editing Prompts (이미지 편집)</h3>
<p>DALL·E 3는 생성뿐 아니라 기존 이미지 편집도 가능하다.</p>
<p><strong>Erase (지우기)</strong></p>
<p>특정 영역을 제거.</p>
<pre><code>"Erase all modern elements from this historical photo
(cars, power lines, street signs)"</code></pre>
<p><strong>Add (추가)</strong></p>
<p>새로운 요소 삽입.</p>
<pre><code>"Add a flock of birds flying across the sky,
a rainbow after rain,
and wildflowers in the foreground"</code></pre>
<p><strong>Resize (크기 조절)</strong></p>
<p>요소의 비율 변경.</p>
<pre><code>"Enlarge the mountain in the background to make it more imposing,
shrink the buildings to emphasize the natural landscape"</code></pre>
<p><strong>Replace Colors (색 교체)</strong></p>
<pre><code>"Replace all green foliage with autumn colors (orange, red, yellow),
change the blue sky to stormy gray"</code></pre>
<p><strong>Adjust Composition (구도 조정)</strong></p>
<pre><code>"Reposition the subject to the right third of the frame,
align the horizon horizontally,
create leading lines from the foreground path to the focal point"</code></pre>
<p><strong>Modify Textures (질감 수정)</strong></p>
<pre><code>"Make the water surface smooth and glassy,
roughen the terrain to show rocky texture,
add glossy finish to metallic surfaces"</code></pre>
<p><strong>Outpaint (확장)</strong></p>
<p>이미지 경계 밖으로 확장.</p>
<pre><code>"Expand the sky upward to show more clouds and dramatic sunset,
extend the forest outward to create a wider panorama,
stretch the road forward to show its continuation"</code></pre>
<p><strong>Inpaint (채우기)</strong></p>
<p>빈 공간이나 누락된 부분 채우기.</p>
<pre><code>"Fill in the gap in the sky where clouds are missing,
complete the crowd in the background,
add texture to the blank wall"</code></pre>
</section>
</section>
<section id="dalle-3-prompt-tips-and-tricks" class="level2" data-number="1.5">
<h2 data-number="1.5" class="anchored" data-anchor-id="dalle-3-prompt-tips-and-tricks"><span class="header-section-number">1.5</span> DALL·E 3 Prompt Tips and Tricks</h2>
<section id="tip-1-구체적이고-상세하게-작성하기" class="level3" data-number="1.5.1">
<h3 data-number="1.5.1" class="anchored" data-anchor-id="tip-1-구체적이고-상세하게-작성하기"><span class="header-section-number">1.5.1</span> Tip 1: 구체적이고 상세하게 작성하기</h3>
<p><strong>왜 중요한가?</strong></p>
<p>모호한 프롬프트는 AI에게 너무 많은 자유를 준다. “A beautiful landscape”는 산? 바다? 사막? 어떤 시간? 어떤 날씨?를 모두 AI가 선택한다. 결과는 예측 불가능하다.</p>
<p><strong>Before</strong></p>
<pre><code>A cat in a room</code></pre>
<p><strong>After</strong></p>
<pre><code>A fluffy orange tabby cat sitting on a vintage wooden windowsill,
sunlight streaming through lace curtains creating soft shadows,
potted plants on the sill, cozy bedroom background with 
warm earth tones</code></pre>
<p><strong>추가된 디테일</strong><br>
- 고양이 종류와 색: fluffy orange tabby<br>
- 위치 구체화: vintage wooden windowsill<br>
- 조명: sunlight through lace curtains<br>
- 추가 요소: potted plants<br>
- 분위기: cozy, warm earth tones</p>
</section>
<section id="tip-2-분위기와-무드-설명" class="level3" data-number="1.5.2">
<h3 data-number="1.5.2" class="anchored" data-anchor-id="tip-2-분위기와-무드-설명"><span class="header-section-number">1.5.2</span> Tip 2: 분위기와 무드 설명</h3>
<p>감정과 분위기는 기술적 요소만큼 중요하다.</p>
<p><strong>무드 키워드 예시</strong><br>
- <strong>Serene</strong>: 평온한, 고요한<br>
- <strong>Chaotic</strong>: 혼란스러운<br>
- <strong>Mysterious</strong>: 신비로운<br>
- <strong>Nostalgic</strong>: 향수를 불러일으키는<br>
- <strong>Ominous</strong>: 불길한<br>
- <strong>Joyful</strong>: 기쁜<br>
- <strong>Melancholic</strong>: 우울한<br>
- <strong>Energetic</strong>: 에너지 넘치는</p>
<p><strong>무드 적용 예시</strong></p>
<pre><code>"An abandoned amusement park at dusk, creating an ominous and 
melancholic atmosphere, with rusting rides silhouetted against 
an overcast sky"</code></pre>
<p>“ominous and melancholic”가 없으면 그냥 “abandoned amusement park”일 뿐이다. 무드 지정으로 AI는 색조(차가운 파랑-회색), 조명(어두운 석양), 구도(고립감 강조)를 조정한다.</p>
</section>
<section id="tip-3-형용사-사용하여-묘사하기" class="level3" data-number="1.5.3">
<h3 data-number="1.5.3" class="anchored" data-anchor-id="tip-3-형용사-사용하여-묘사하기"><span class="header-section-number">1.5.3</span> Tip 3: 형용사 사용하여 묘사하기</h3>
<p>형용사는 일반 명사를 특수하게 만든다.</p>
<p><strong>기본 vs 형용사 강화</strong></p>
<p>기본: “A dog”<br>
→ 어떤 개? 크기? 색? 품종?</p>
<p>강화: “A small, fluffy, cream-colored Pomeranian puppy with bright, curious eyes”<br>
→ 매우 구체적인 이미지</p>
<p><strong>형용사 레이어링</strong></p>
<p>하나의 명사에 여러 형용사를 쌓는다:<br>
- 크기: small, large, tiny, massive<br>
- 질감: fluffy, smooth, rough, glossy<br>
- 색: cream-colored, vibrant, dark<br>
- 상태: old, new, worn, pristine<br>
- 감정: happy, sad, curious, fierce</p>
</section>
<section id="tip-4-시점과-구도-고려하기" class="level3" data-number="1.5.4">
<h3 data-number="1.5.4" class="anchored" data-anchor-id="tip-4-시점과-구도-고려하기"><span class="header-section-number">1.5.4</span> Tip 4: 시점과 구도 고려하기</h3>
<p>시점은 이야기를 만든다.</p>
<p><strong>극적 효과를 위한 시점 선택</strong></p>
<pre><code>같은 피사체, 다른 시점:

"A skyscraper"
→ 평범

"A skyscraper shot from ground level looking up (worm's eye view),
emphasizing its towering height and creating a sense of awe"
→ 역동적, 감정적

"A skyscraper from aerial view, showing its geometric roof pattern
and surrounding cityscape"
→ 패턴과 맥락 강조</code></pre>
<p><strong>구도 용어</strong><br>
- <strong>Close-up</strong>: 디테일 강조<br>
- <strong>Wide shot</strong>: 맥락과 환경<br>
- <strong>Over-the-shoulder</strong>: 주관적 시점<br>
- <strong>Rule of thirds</strong>: 주 피사체를 3분의 1 지점에</p>
</section>
<section id="tip-5-조명과-시간대-지정하기" class="level3" data-number="1.5.5">
<h3 data-number="1.5.5" class="anchored" data-anchor-id="tip-5-조명과-시간대-지정하기"><span class="header-section-number">1.5.5</span> Tip 5: 조명과 시간대 지정하기</h3>
<p>조명은 분위기의 핵심이다.</p>
<p><strong>시간대별 조명 특성</strong></p>
<p><strong>Golden Hour (일몰/일출)</strong></p>
<pre><code>"A portrait during golden hour, with warm, soft lighting
creating a romantic and dreamy atmosphere"</code></pre>
<p>효과: 따뜻한 황금빛, 긴 그림자, 부드러운 대비</p>
<p><strong>Blue Hour (해질녘/새벽)</strong></p>
<pre><code>"A cityscape during blue hour, with deep blue sky and
artificial lights beginning to glow"</code></pre>
<p>효과: 차갑고 고요한, 자연광과 인공광의 균형</p>
<p><strong>Midday (정오)</strong></p>
<pre><code>"A beach scene at midday, with harsh overhead sunlight
creating strong shadows and vibrant colors"</code></pre>
<p>효과: 강한 대비, 생생한 색, 명확한 디테일</p>
<p><strong>Night (밤)</strong></p>
<pre><code>"A forest at night, illuminated only by moonlight filtering
through trees, creating mysterious shadows"</code></pre>
<p>효과: 어두움, 신비로움, 제한된 가시성</p>
<p><strong>인공 조명</strong><br>
- Candlelight: 따뜻하고 친밀한<br>
- Neon lights: 미래적이고 인공적인<br>
- Fluorescent: 차갑고 날카로운</p>
</section>
<section id="tip-6-동작이나-움직임-포함하기" class="level3" data-number="1.5.6">
<h3 data-number="1.5.6" class="anchored" data-anchor-id="tip-6-동작이나-움직임-포함하기"><span class="header-section-number">1.5.6</span> Tip 6: 동작이나 움직임 포함하기</h3>
<p>정적 vs 동적 이미지의 차이.</p>
<p><strong>정적 프롬프트</strong></p>
<pre><code>"A horse in a field"</code></pre>
<p>→ 서 있는 말</p>
<p><strong>동적 프롬프트</strong></p>
<pre><code>"A horse galloping across a field, mane flowing in the wind,
dust kicking up from its hooves"</code></pre>
<p>→ 에너지와 생동감</p>
<p><strong>동작 표현 단어</strong><br>
- Running, jumping, flying, falling<br>
- Spinning, swirling, flowing, drifting<br>
- Exploding, shattering, melting, dissolving</p>
</section>
<section id="tip-7-프롬프트에-과부하-주지-않기" class="level3" data-number="1.5.7">
<h3 data-number="1.5.7" class="anchored" data-anchor-id="tip-7-프롬프트에-과부하-주지-않기"><span class="header-section-number">1.5.7</span> Tip 7: 프롬프트에 과부하 주지 않기</h3>
<p><strong>과부하의 위험</strong></p>
<p>너무 많은 요소는 AI를 혼란스럽게 한다.</p>
<p><strong>과부하 예시 (나쁨)</strong></p>
<pre><code>"A cat and a dog and a bird and a fish in a room with a table
and chairs and a lamp and books and a TV and plants and paintings
and a rug during sunset with rain outside but also a rainbow
and lightning..."</code></pre>
<p>AI는 모든 것을 구겨 넣으려다 구도가 망가진다.</p>
<p><strong>균형 잡힌 예시 (좋음)</strong></p>
<pre><code>"A cozy living room scene with a cat sleeping on a sunlit armchair,
a few books on a side table, and a potted plant by the window,
warm afternoon light"</code></pre>
<p><strong>3-5-7 규칙</strong><br>
- 주요 피사체: 1-3개<br>
- 보조 요소: 5개 이하<br>
- 형용사/부사: 7개 이하</p>
</section>
<section id="tip-8-비유나-비교-활용" class="level3" data-number="1.5.8">
<h3 data-number="1.5.8" class="anchored" data-anchor-id="tip-8-비유나-비교-활용"><span class="header-section-number">1.5.8</span> Tip 8: 비유나 비교 활용</h3>
<p>잘 알려진 것과 비교하면 스타일이 명확해진다.</p>
<p><strong>예술가 스타일 참조</strong></p>
<pre><code>"A landscape in the style of Van Gogh, with bold brush strokes
and vibrant, swirling colors"</code></pre>
<p><strong>영화/작품 참조</strong></p>
<pre><code>"A noir detective scene reminiscent of Blade Runner, with
neon-lit rain-soaked streets and cyberpunk aesthetics"</code></pre>
<p><strong>자연 현상 비유</strong></p>
<pre><code>"Hair flowing like a waterfall, eyes sparkling like stars,
smile as bright as sunshine"</code></pre>
</section>
<section id="tip-9-원하는-스타일이나-테마-명시하기" class="level3" data-number="1.5.9">
<h3 data-number="1.5.9" class="anchored" data-anchor-id="tip-9-원하는-스타일이나-테마-명시하기"><span class="header-section-number">1.5.9</span> Tip 9: 원하는 스타일이나 테마 명시하기</h3>
<p>스타일은 전체 비주얼을 통일한다.</p>
<p><strong>스타일 키워드</strong><br>
- Cyberpunk: 네온, 미래, 디스토피아<br>
- Steampunk: 빅토리아 시대 + 기계<br>
- Art Deco: 기하학, 금색, 1920년대<br>
- Minimalism: 단순, 여백, 절제<br>
- Baroque: 화려, 장식적, 극적</p>
<p><strong>테마 일관성</strong></p>
<pre><code>"A cyberpunk cityscape: neon signs, holographic billboards,
flying cars, rain-slicked streets, towering skyscrapers,
all maintaining a consistent retro-futuristic aesthetic"</code></pre>
<p>모든 요소가 “cyberpunk” 테마를 지지한다.</p>
</section>
<section id="tip-10-반복적인-접근법-사용하기" class="level3" data-number="1.5.10">
<h3 data-number="1.5.10" class="anchored" data-anchor-id="tip-10-반복적인-접근법-사용하기"><span class="header-section-number">1.5.10</span> Tip 10: 반복적인 접근법 사용하기</h3>
<p>완벽한 프롬프트는 첫 시도에 나오지 않는다.</p>
<p><strong>반복 프로세스</strong></p>
<p><strong>1차 시도</strong></p>
<pre><code>"A magical forest"</code></pre>
<p>→ 결과: 평범함</p>
<p><strong>2차 시도 (디테일 추가)</strong></p>
<pre><code>"A magical forest with glowing mushrooms and fireflies,
ancient trees with twisted roots"</code></pre>
<p>→ 결과: 더 흥미로움, 하지만 조명이 평범</p>
<p><strong>3차 시도 (조명 개선)</strong></p>
<pre><code>"A magical forest at dusk, with bioluminescent mushrooms
casting ethereal blue-green glow, fireflies creating
dancing lights, ancient trees silhouetted against
a purple twilight sky"</code></pre>
<p>→ 결과: 목표에 근접</p>
<p><strong>4차 시도 (분위기 강화)</strong></p>
<pre><code>"An enchanted forest at twilight, shrouded in mystical mist,
with clusters of bioluminescent mushrooms glowing in ethereal
blue-green hues, thousands of fireflies creating a constellation
of golden lights, gnarled ancient trees with massive twisted roots,
all bathed in the purple-pink glow of dusk, creating a dreamlike
and otherworldly atmosphere"</code></pre>
<p>→ 결과: 원하는 이미지</p>
<p><strong>반복 시 개선 포인트</strong><br>
1. 부족한 요소 추가<br>
2. 과도한 요소 제거<br>
3. 조명/색상 조정<br>
4. 분위기 강화<br>
5. 구도 변경</p>
</section>
</section>
<section id="dall-e-3의-실제-성능과-한계-2025년-기준" class="level2" data-number="1.6">
<h2 data-number="1.6" class="anchored" data-anchor-id="dall-e-3의-실제-성능과-한계-2025년-기준"><span class="header-section-number">1.6</span> DALL-E 3의 실제 성능과 한계 (2025년 기준)</h2>
<p>웹 검색 결과 DALL-E 3는 사람들이 원하는 출력을 얻기에 <strong>부분적으로 충분하지만, 여전히 명확한 한계</strong>가 있다.</p>
<section id="긍정적-평가" class="level3" data-number="1.6.1">
<h3 data-number="1.6.1" class="anchored" data-anchor-id="긍정적-평가"><span class="header-section-number">1.6.1</span> 긍정적 평가</h3>
<p><strong>강점</strong> - 프롬프트 이해도가 크게 향상되어 복잡한 설명을 정확한 이미지로 변환 - 창의적이고 시각적으로 놀라운 이미지 생성 능력 - 150만 명 이상의 활성 사용자, 일일 200만 개 이상 이미지 생성 - AI 이미지 생성 시장에서 24.4% 점유율로 Midjourney(25%) 바로 다음 - ChatGPT에 통합되어 접근성이 뛰어나고 사용이 편리 - 4.5점 만점에 평점을 받으며 전반적으로 긍정적 평가</p>
</section>
<section id="치명적-한계들" class="level3" data-number="1.6.2">
<h3 data-number="1.6.2" class="anchored" data-anchor-id="치명적-한계들"><span class="header-section-number">1.6.2</span> 치명적 한계들</h3>
<p><strong>1. 텍스트 생성 문제 (가장 큰 약점)</strong> - 복잡한 타이포그래피와 긴 문구의 정확도에 여전히 어려움 - 텍스트를 중복 생성하거나 철자 오류 발생 (예: “hEllo” 대신 “hAllo”) - 이미지에 의미 없는 텍스트를 자주 추가하여 전체 품질 저하 - 간단한 단어나 문구는 상당 부분 렌더링 가능하지만, 긴 텍스트는 여전히 문제</p>
<p><strong>실전적 함의</strong>: 로고, 포스터, 광고처럼 정확한 텍스트가 필수인 작업에는 <strong>부적합</strong>하다. 생성 후 별도 편집 도구로 텍스트를 추가해야 한다.</p>
<p><strong>2. 인체 디테일 문제</strong> - 사람 손 렌더링의 일관성 부족과 왜곡 - 복잡한 이미지에서 세밀한 디테일 생성 실패</p>
<p>AI 이미지 생성의 고질적 문제인 “손가락”은 DALL-E 3에서도 완전히 해결되지 않았다.</p>
<p><strong>3. 일관성 문제</strong> - 비슷한 프롬프트에서도 일관성 없는 결과 - Midjourney의 <code>--cref</code> 같은 캐릭터 일관성 유지 기능 부재</p>
<p>만화나 시리즈물처럼 같은 캐릭터를 반복 사용해야 하는 프로젝트에는 제약이 크다.</p>
<p><strong>4. 세밀한 제어 부족</strong> - 특정 스타일을 정밀하게 조정하기 어려움 - 스타일, 색상 팔레트, 최종 편집에 대한 상세 제어 불가</p>
<p><strong>5. 해상도 및 출력 제한</strong> - 대형 출력물에서 해상도 문제 보고 - 정지 이미지만 생성 가능, 비디오 미지원</p>
</section>
<section id="경쟁-상황" class="level3" data-number="1.6.3">
<h3 data-number="1.6.3" class="anchored" data-anchor-id="경쟁-상황"><span class="header-section-number">1.6.3</span> 경쟁 상황</h3>
<p>Midjourney는 예술적이고 감성적인 비주얼에 강점이 있으며, DALL-E 3는 프롬프트 정확도와 빠른 생성에 유리</p>
<p>Stable Diffusion이 오픈소스 접근성으로 전체 AI 생성 이미지의 약 80%(150억 개 중 125.9억 개) 차지</p>
</section>
<section id="결론-교육-자료에-포함해야-하는가" class="level3" data-number="1.6.4">
<h3 data-number="1.6.4" class="anchored" data-anchor-id="결론-교육-자료에-포함해야-하는가"><span class="header-section-number">1.6.4</span> 결론: 교육 자료에 포함해야 하는가?</h3>
<p><strong>포함해야 하는 이유</strong> 1. 여전히 주요 상용 AI 이미지 생성 도구 (시장 점유율 2위) 2. ChatGPT 통합으로 접근성이 가장 좋음 3. 프롬프트 엔지니어링 교육의 실습 도구로 적합</p>
<p><strong>하지만 정직하게 한계를 명시해야</strong></p>
<p>교육 자료에서 다음 내용을 <strong>반드시 추가</strong>해야 한다:</p>
<div class="sourceCode" id="cb40" style="background: #f1f3f5;"><pre class="sourceCode numberSource markdown number-lines code-with-copy"><code class="sourceCode markdown"><span id="cb40-1"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">## DALL-E 3의 현실적 한계 (2025년 기준)</span></span>
<span id="cb40-2"></span>
<span id="cb40-3">DALL-E 3는 창의적 아이디어 시각화에 강력하지만, </span>
<span id="cb40-4">실무 적용 시 다음 한계를 인지해야 한다:</span>
<span id="cb40-5"></span>
<span id="cb40-6">**치명적 제약사항**</span>
<span id="cb40-7"><span class="ss" style="color: #20794D;
background-color: null;
font-style: inherit;">- </span>이미지 내 텍스트: 정확도 낮음 (특히 긴 문구)</span>
<span id="cb40-8"><span class="ss" style="color: #20794D;
background-color: null;
font-style: inherit;">- </span>인체 디테일: 손, 얼굴 세부 표현 불완전</span>
<span id="cb40-9"><span class="ss" style="color: #20794D;
background-color: null;
font-style: inherit;">- </span>일관성: 같은 캐릭터 반복 생성 어려움</span>
<span id="cb40-10"><span class="ss" style="color: #20794D;
background-color: null;
font-style: inherit;">- </span>세밀한 제어: 전문가급 정밀 조정 불가</span>
<span id="cb40-11"></span>
<span id="cb40-12">**적합한 용도**</span>
<span id="cb40-13"><span class="ss" style="color: #20794D;
background-color: null;
font-style: inherit;">- </span>컨셉 아트, 아이디어 시각화</span>
<span id="cb40-14"><span class="ss" style="color: #20794D;
background-color: null;
font-style: inherit;">- </span>블로그/SNS용 일러스트</span>
<span id="cb40-15"><span class="ss" style="color: #20794D;
background-color: null;
font-style: inherit;">- </span>브레인스토밍, 무드보드</span>
<span id="cb40-16"><span class="ss" style="color: #20794D;
background-color: null;
font-style: inherit;">- </span>프로토타이핑, 초안 제작</span>
<span id="cb40-17"></span>
<span id="cb40-18">**부적합한 용도**</span>
<span id="cb40-19"><span class="ss" style="color: #20794D;
background-color: null;
font-style: inherit;">- </span>정확한 텍스트가 필수인 작업 (로고, 포스터)</span>
<span id="cb40-20"><span class="ss" style="color: #20794D;
background-color: null;
font-style: inherit;">- </span>캐릭터 일관성이 중요한 프로젝트</span>
<span id="cb40-21"><span class="ss" style="color: #20794D;
background-color: null;
font-style: inherit;">- </span>인쇄용 고해상도 작업</span>
<span id="cb40-22"><span class="ss" style="color: #20794D;
background-color: null;
font-style: inherit;">- </span>해부학적 정확성이 필요한 의료/교육 자료</span>
<span id="cb40-23"></span>
<span id="cb40-24">프롬프트를 아무리 잘 써도 모델의 근본적 한계는 </span>
<span id="cb40-25">극복할 수 없다. 생성 후 전문 도구로 편집하거나,</span>
<span id="cb40-26">용도에 따라 Midjourney, Stable Diffusion 등 </span>
<span id="cb40-27">대안 도구를 고려해야 한다.</span></code></pre></div>
<p>이런 현실적 한계를 솔직히 제시하는 것이 교육 자료의 신뢰성을 높인다.</p>
</section>
</section>
<section id="이미지-생성-프롬프트의-미래" class="level2" data-number="1.7">
<h2 data-number="1.7" class="anchored" data-anchor-id="이미지-생성-프롬프트의-미래"><span class="header-section-number">1.7</span> 이미지 생성 프롬프트의 미래</h2>
<p><strong>AI 이미지 생성의 발전 방향</strong></p>
<p>현재 DALL·E 3는 텍스트만으로 이미지를 생성한다. 미래에는:</p>
<ol type="1">
<li><strong>멀티모달 입력</strong>: 텍스트 + 스케치 + 참조 이미지 조합<br>
</li>
<li><strong>실시간 편집</strong>: 대화하며 즉시 수정<br>
</li>
<li><strong>3D 생성</strong>: 2D 이미지가 아닌 3D 모델 직접 생성<br>
</li>
<li><strong>비디오 생성</strong>: 정지 이미지에서 움직이는 영상으로<br>
</li>
<li><strong>스타일 학습</strong>: 사용자의 개인 스타일 학습 및 재현</li>
</ol>
<p><strong>프롬프트 엔지니어링의 지속적 가치</strong></p>
<p>AI가 아무리 발전해도, “무엇을 만들고 싶은가”를 명확히 표현하는 능력은 여전히 중요하다. 프롬프트 엔지니어링은 단순한 기술이 아니라 창작의 새로운 언어다.</p>
<p>검색 결과를 바탕으로 DALL-E 3의 실제 성능에 대해 정리하겠다.</p>


</section>
</section>

 ]]></description>
  <category>Prompt Engineering</category>
  <category>LLM</category>
  <category>AI</category>
  <category>Agent</category>
  <guid>kk3225.netlify.app/docs/blog/posts/Agent/02-Prompt/39-PromptWriting-ImageGeneration.html</guid>
  <pubDate>Sun, 01 Feb 2026 15:00:00 GMT</pubDate>
</item>
<item>
  <title>AI Agent 플랫폼 운영 자동화와 DevOps</title>
  <dc:creator>Kwangmin Kim</dc:creator>
  <link>kk3225.netlify.app/docs/blog/posts/Engineering/System/Archi_Design/platform/6.agent_platform_devops.html</link>
  <description><![CDATA[ 





<section id="들어가며" class="level1" data-number="1">
<h1 data-number="1"><span class="header-section-number">1</span> 들어가며</h1>
<section id="왜-운영-자동화가-중요한가" class="level2" data-number="1.1">
<h2 data-number="1.1" class="anchored" data-anchor-id="왜-운영-자동화가-중요한가"><span class="header-section-number">1.1</span> 왜 운영 자동화가 중요한가?</h2>
<p>Phase 4 플랫폼을 구축한 후 이제 실제 운영 시 발생하는 문제들:</p>
<p><strong>질문들</strong>: - “Agent 코드를 수정했는데, 어느 것을 테스트해야 하나요?” - “새 Agent를 배포하는데 기존 서비스가 다운되면 어떡하죠?” - “Agent가 느려졌는데 어디서 병목이 생기는지 모르겠어요” - “LLM API 키가 노출되지 않게 하려면?”</p>
<p><strong>이 글의 목표</strong>: - CI/CD 파이프라인 구축 (변경 감지 + 자동 테스트) - 무중단 배포 전략 (Blue-Green, Canary) - 모니터링 시스템 (메트릭, 대시보드, 알림) - 로깅 전략 (구조화, 분석, 추적) - 보안 관리 (인증, API 키, 권한)</p>
</section>
<section id="앞선-글-요약" class="level2" data-number="1.2">
<h2 data-number="1.2" class="anchored" data-anchor-id="앞선-글-요약"><span class="header-section-number">1.2</span> 앞선 글 요약</h2>
<p><strong>5번 글</strong> (<a href="../../../../../../../docs/blog/posts/Engineering/System/Archi_Design/platform/5.agent_platform_data_standardization.html">데이터 표준화 계층</a>): - 프롬프트 버전 관리 (PromptRegistry) - 벡터 데이터 자동 업데이트 - 표준 메타데이터 스키마 - 환경별 설정 관리</p>
<p><strong>핵심 질문</strong>: “구축한 플랫폼을 어떻게 안정적으로 운영하고 자동화할 것인가?”</p>
</section>
</section>
<section id="cicd-파이프라인" class="level1" data-number="2">
<h1 data-number="2"><span class="header-section-number">2</span> CI/CD 파이프라인</h1>
<section id="문제-수동-배포의-한계" class="level2" data-number="2.1">
<h2 data-number="2.1" class="anchored" data-anchor-id="문제-수동-배포의-한계"><span class="header-section-number">2.1</span> 문제: 수동 배포의 한계</h2>
<section id="초기-방식-phase-1-2" class="level3" data-number="2.1.1">
<h3 data-number="2.1.1" class="anchored" data-anchor-id="초기-방식-phase-1-2"><span class="header-section-number">2.1.1</span> 초기 방식 (Phase 1-2)</h3>
<div class="sourceCode" id="cb1" style="background: #f1f3f5;"><pre class="sourceCode numberSource bash number-lines code-with-copy"><code class="sourceCode bash"><span id="cb1-1"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># ❌ 나쁜 예: 수동 배포</span></span>
<span id="cb1-2"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># 1. 로컬에서 테스트</span></span>
<span id="cb1-3"><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">pytest</span> tests/</span>
<span id="cb1-4"></span>
<span id="cb1-5"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># 2. 수동으로 서버 SSH</span></span>
<span id="cb1-6"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">ssh</span> production-server</span>
<span id="cb1-7"></span>
<span id="cb1-8"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># 3. 코드 pull</span></span>
<span id="cb1-9"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">git</span> pull origin main</span>
<span id="cb1-10"></span>
<span id="cb1-11"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># 4. 서비스 재시작</span></span>
<span id="cb1-12"><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">systemctl</span> restart agent-platform</span>
<span id="cb1-13"></span>
<span id="cb1-14"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># 5. 에러 발생 시 수동 롤백</span></span>
<span id="cb1-15"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">git</span> reset <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">--hard</span> HEAD~1</span>
<span id="cb1-16"><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">systemctl</span> restart agent-platform</span></code></pre></div>
<p><strong>문제점</strong>: 1. <strong>테스트 누락</strong>: 개발자가 깜빡하면 미테스트 코드 배포 2. <strong>다운타임</strong>: 재시작 중 서비스 중단 3. <strong>롤백 지연</strong>: 문제 발견 → 수동 롤백 → 10분 이상 소요 4. <strong>불일치</strong>: 로컬 환경과 프로덕션 환경 차이</p>
</section>
</section>
<section id="github-actions-기반-cicd" class="level2" data-number="2.2">
<h2 data-number="2.2" class="anchored" data-anchor-id="github-actions-기반-cicd"><span class="header-section-number">2.2</span> GitHub Actions 기반 CI/CD</h2>
<section id="파일-구조" class="level3" data-number="2.2.1">
<h3 data-number="2.2.1" class="anchored" data-anchor-id="파일-구조"><span class="header-section-number">2.2.1</span> 파일 구조</h3>
<div class="sourceCode" id="cb2" style="background: #f1f3f5;"><pre class="sourceCode numberSource bash number-lines code-with-copy"><code class="sourceCode bash"><span id="cb2-1"><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">.github/</span></span>
<span id="cb2-2"><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">└──</span> workflows/</span>
<span id="cb2-3">    <span class="ex" style="color: null;
background-color: null;
font-style: inherit;">├──</span> test.yml           <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># PR 시 테스트</span></span>
<span id="cb2-4">    <span class="ex" style="color: null;
background-color: null;
font-style: inherit;">├──</span> deploy-dev.yml     <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># 개발 환경 자동 배포</span></span>
<span id="cb2-5">    <span class="ex" style="color: null;
background-color: null;
font-style: inherit;">└──</span> deploy-prod.yml    <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># 프로덕션 수동 승인 배포</span></span></code></pre></div>
</section>
<section id="test.yml-변경-감지-선택적-테스트" class="level3" data-number="2.2.2">
<h3 data-number="2.2.2" class="anchored" data-anchor-id="test.yml-변경-감지-선택적-테스트"><span class="header-section-number">2.2.2</span> test.yml: 변경 감지 + 선택적 테스트</h3>
<div class="sourceCode" id="cb3" style="background: #f1f3f5;"><pre class="sourceCode numberSource yaml number-lines code-with-copy"><code class="sourceCode yaml"><span id="cb3-1"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># .github/workflows/test.yml</span></span>
<span id="cb3-2"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">name</span><span class="kw" style="color: #003B4F;
background-color: null;
font-style: inherit;">:</span><span class="at" style="color: #657422;
background-color: null;
font-style: inherit;"> Test Affected Components</span></span>
<span id="cb3-3"></span>
<span id="cb3-4"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">on</span><span class="kw" style="color: #003B4F;
background-color: null;
font-style: inherit;">:</span></span>
<span id="cb3-5"><span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">  </span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">push</span><span class="kw" style="color: #003B4F;
background-color: null;
font-style: inherit;">:</span></span>
<span id="cb3-6"><span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">    </span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">branches</span><span class="kw" style="color: #003B4F;
background-color: null;
font-style: inherit;">:</span><span class="at" style="color: #657422;
background-color: null;
font-style: inherit;"> </span><span class="kw" style="color: #003B4F;
background-color: null;
font-style: inherit;">[</span><span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">main</span><span class="kw" style="color: #003B4F;
background-color: null;
font-style: inherit;">,</span><span class="at" style="color: #657422;
background-color: null;
font-style: inherit;"> develop</span><span class="kw" style="color: #003B4F;
background-color: null;
font-style: inherit;">]</span></span>
<span id="cb3-7"><span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">  </span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">pull_request</span><span class="kw" style="color: #003B4F;
background-color: null;
font-style: inherit;">:</span></span>
<span id="cb3-8"><span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">    </span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">branches</span><span class="kw" style="color: #003B4F;
background-color: null;
font-style: inherit;">:</span><span class="at" style="color: #657422;
background-color: null;
font-style: inherit;"> </span><span class="kw" style="color: #003B4F;
background-color: null;
font-style: inherit;">[</span><span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">main</span><span class="kw" style="color: #003B4F;
background-color: null;
font-style: inherit;">]</span></span>
<span id="cb3-9"></span>
<span id="cb3-10"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">jobs</span><span class="kw" style="color: #003B4F;
background-color: null;
font-style: inherit;">:</span></span>
<span id="cb3-11"><span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">  </span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">detect-changes</span><span class="kw" style="color: #003B4F;
background-color: null;
font-style: inherit;">:</span></span>
<span id="cb3-12"><span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">    </span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">runs-on</span><span class="kw" style="color: #003B4F;
background-color: null;
font-style: inherit;">:</span><span class="at" style="color: #657422;
background-color: null;
font-style: inherit;"> ubuntu-latest</span></span>
<span id="cb3-13"><span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">    </span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">outputs</span><span class="kw" style="color: #003B4F;
background-color: null;
font-style: inherit;">:</span></span>
<span id="cb3-14"><span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">      </span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">core_changed</span><span class="kw" style="color: #003B4F;
background-color: null;
font-style: inherit;">:</span><span class="at" style="color: #657422;
background-color: null;
font-style: inherit;"> ${{ steps.changes.outputs.core }}</span></span>
<span id="cb3-15"><span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">      </span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">shared_changed</span><span class="kw" style="color: #003B4F;
background-color: null;
font-style: inherit;">:</span><span class="at" style="color: #657422;
background-color: null;
font-style: inherit;"> ${{ steps.changes.outputs.shared }}</span></span>
<span id="cb3-16"><span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">      </span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">affected_agents</span><span class="kw" style="color: #003B4F;
background-color: null;
font-style: inherit;">:</span><span class="at" style="color: #657422;
background-color: null;
font-style: inherit;"> ${{ steps.changes.outputs.agents }}</span></span>
<span id="cb3-17"><span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">    </span></span>
<span id="cb3-18"><span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">    </span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">steps</span><span class="kw" style="color: #003B4F;
background-color: null;
font-style: inherit;">:</span></span>
<span id="cb3-19"><span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">      </span><span class="kw" style="color: #003B4F;
background-color: null;
font-style: inherit;">-</span><span class="at" style="color: #657422;
background-color: null;
font-style: inherit;"> </span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">uses</span><span class="kw" style="color: #003B4F;
background-color: null;
font-style: inherit;">:</span><span class="at" style="color: #657422;
background-color: null;
font-style: inherit;"> actions/checkout@v3</span></span>
<span id="cb3-20"><span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">        </span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">with</span><span class="kw" style="color: #003B4F;
background-color: null;
font-style: inherit;">:</span></span>
<span id="cb3-21"><span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">          </span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">fetch-depth</span><span class="kw" style="color: #003B4F;
background-color: null;
font-style: inherit;">:</span><span class="at" style="color: #657422;
background-color: null;
font-style: inherit;"> </span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">2</span><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">  # 이전 커밋과 비교</span></span>
<span id="cb3-22"><span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">      </span></span>
<span id="cb3-23"><span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">      </span><span class="kw" style="color: #003B4F;
background-color: null;
font-style: inherit;">-</span><span class="at" style="color: #657422;
background-color: null;
font-style: inherit;"> </span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">name</span><span class="kw" style="color: #003B4F;
background-color: null;
font-style: inherit;">:</span><span class="at" style="color: #657422;
background-color: null;
font-style: inherit;"> Detect changes</span></span>
<span id="cb3-24"><span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">        </span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">id</span><span class="kw" style="color: #003B4F;
background-color: null;
font-style: inherit;">:</span><span class="at" style="color: #657422;
background-color: null;
font-style: inherit;"> changes</span></span>
<span id="cb3-25"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">        run</span><span class="kw" style="color: #003B4F;
background-color: null;
font-style: inherit;">: </span><span class="ch" style="color: #20794D;
background-color: null;
font-style: inherit;">|</span></span>
<span id="cb3-26">          # 변경된 파일 목록</span>
<span id="cb3-27">          CHANGED=$(git diff --name-only HEAD~1)</span>
<span id="cb3-28">          </span>
<span id="cb3-29">          # core/ 또는 shared/ 변경 시 전체 테스트</span>
<span id="cb3-30">          if echo "$CHANGED" | grep -qE '^(core|shared)/'; then</span>
<span id="cb3-31">            echo "core=true" &gt;&gt; $GITHUB_OUTPUT</span>
<span id="cb3-32">            echo "shared=true" &gt;&gt; $GITHUB_OUTPUT</span>
<span id="cb3-33">            echo "agents=all" &gt;&gt; $GITHUB_OUTPUT</span>
<span id="cb3-34">          else</span>
<span id="cb3-35">            # agents/ 변경 시 해당 Agent만</span>
<span id="cb3-36">            AGENTS=$(echo "$CHANGED" | grep '^agents/' | cut -d'/' -f2 | sort -u | tr '\n' ',')</span>
<span id="cb3-37">            echo "core=false" &gt;&gt; $GITHUB_OUTPUT</span>
<span id="cb3-38">            echo "shared=false" &gt;&gt; $GITHUB_OUTPUT</span>
<span id="cb3-39">            echo "agents=$AGENTS" &gt;&gt; $GITHUB_OUTPUT</span>
<span id="cb3-40">          fi</span>
<span id="cb3-41">          </span>
<span id="cb3-42">          echo "Changed files:"</span>
<span id="cb3-43">          echo "$CHANGED"</span>
<span id="cb3-44">          echo "Affected agents: $AGENTS"</span>
<span id="cb3-45"></span>
<span id="cb3-46"><span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">  </span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">test-core</span><span class="kw" style="color: #003B4F;
background-color: null;
font-style: inherit;">:</span></span>
<span id="cb3-47"><span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">    </span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">needs</span><span class="kw" style="color: #003B4F;
background-color: null;
font-style: inherit;">:</span><span class="at" style="color: #657422;
background-color: null;
font-style: inherit;"> detect-changes</span></span>
<span id="cb3-48"><span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">    </span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">if</span><span class="kw" style="color: #003B4F;
background-color: null;
font-style: inherit;">:</span><span class="at" style="color: #657422;
background-color: null;
font-style: inherit;"> needs.detect-changes.outputs.core_changed == 'true'</span></span>
<span id="cb3-49"><span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">    </span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">runs-on</span><span class="kw" style="color: #003B4F;
background-color: null;
font-style: inherit;">:</span><span class="at" style="color: #657422;
background-color: null;
font-style: inherit;"> ubuntu-latest</span></span>
<span id="cb3-50"><span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">    </span></span>
<span id="cb3-51"><span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">    </span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">steps</span><span class="kw" style="color: #003B4F;
background-color: null;
font-style: inherit;">:</span></span>
<span id="cb3-52"><span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">      </span><span class="kw" style="color: #003B4F;
background-color: null;
font-style: inherit;">-</span><span class="at" style="color: #657422;
background-color: null;
font-style: inherit;"> </span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">uses</span><span class="kw" style="color: #003B4F;
background-color: null;
font-style: inherit;">:</span><span class="at" style="color: #657422;
background-color: null;
font-style: inherit;"> actions/checkout@v3</span></span>
<span id="cb3-53"><span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">      </span><span class="kw" style="color: #003B4F;
background-color: null;
font-style: inherit;">-</span><span class="at" style="color: #657422;
background-color: null;
font-style: inherit;"> </span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">uses</span><span class="kw" style="color: #003B4F;
background-color: null;
font-style: inherit;">:</span><span class="at" style="color: #657422;
background-color: null;
font-style: inherit;"> actions/setup-python@v4</span></span>
<span id="cb3-54"><span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">        </span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">with</span><span class="kw" style="color: #003B4F;
background-color: null;
font-style: inherit;">:</span></span>
<span id="cb3-55"><span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">          </span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">python-version</span><span class="kw" style="color: #003B4F;
background-color: null;
font-style: inherit;">:</span><span class="at" style="color: #657422;
background-color: null;
font-style: inherit;"> </span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">'3.11'</span></span>
<span id="cb3-56"><span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">      </span></span>
<span id="cb3-57"><span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">      </span><span class="kw" style="color: #003B4F;
background-color: null;
font-style: inherit;">-</span><span class="at" style="color: #657422;
background-color: null;
font-style: inherit;"> </span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">name</span><span class="kw" style="color: #003B4F;
background-color: null;
font-style: inherit;">:</span><span class="at" style="color: #657422;
background-color: null;
font-style: inherit;"> Install dependencies</span></span>
<span id="cb3-58"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">        run</span><span class="kw" style="color: #003B4F;
background-color: null;
font-style: inherit;">: </span><span class="ch" style="color: #20794D;
background-color: null;
font-style: inherit;">|</span></span>
<span id="cb3-59">          pip install poetry</span>
<span id="cb3-60">          poetry install</span>
<span id="cb3-61"><span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">      </span></span>
<span id="cb3-62"><span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">      </span><span class="kw" style="color: #003B4F;
background-color: null;
font-style: inherit;">-</span><span class="at" style="color: #657422;
background-color: null;
font-style: inherit;"> </span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">name</span><span class="kw" style="color: #003B4F;
background-color: null;
font-style: inherit;">:</span><span class="at" style="color: #657422;
background-color: null;
font-style: inherit;"> Test core module</span></span>
<span id="cb3-63"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">        run</span><span class="kw" style="color: #003B4F;
background-color: null;
font-style: inherit;">: </span><span class="ch" style="color: #20794D;
background-color: null;
font-style: inherit;">|</span></span>
<span id="cb3-64">          poetry run pytest core/tests/ -v --cov=core --cov-report=xml</span>
<span id="cb3-65"><span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">      </span></span>
<span id="cb3-66"><span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">      </span><span class="kw" style="color: #003B4F;
background-color: null;
font-style: inherit;">-</span><span class="at" style="color: #657422;
background-color: null;
font-style: inherit;"> </span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">name</span><span class="kw" style="color: #003B4F;
background-color: null;
font-style: inherit;">:</span><span class="at" style="color: #657422;
background-color: null;
font-style: inherit;"> Upload coverage</span></span>
<span id="cb3-67"><span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">        </span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">uses</span><span class="kw" style="color: #003B4F;
background-color: null;
font-style: inherit;">:</span><span class="at" style="color: #657422;
background-color: null;
font-style: inherit;"> codecov/codecov-action@v3</span></span>
<span id="cb3-68"><span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">        </span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">with</span><span class="kw" style="color: #003B4F;
background-color: null;
font-style: inherit;">:</span></span>
<span id="cb3-69"><span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">          </span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">files</span><span class="kw" style="color: #003B4F;
background-color: null;
font-style: inherit;">:</span><span class="at" style="color: #657422;
background-color: null;
font-style: inherit;"> ./coverage.xml</span></span>
<span id="cb3-70"><span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">          </span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">flags</span><span class="kw" style="color: #003B4F;
background-color: null;
font-style: inherit;">:</span><span class="at" style="color: #657422;
background-color: null;
font-style: inherit;"> core</span></span>
<span id="cb3-71"></span>
<span id="cb3-72"><span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">  </span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">test-shared</span><span class="kw" style="color: #003B4F;
background-color: null;
font-style: inherit;">:</span></span>
<span id="cb3-73"><span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">    </span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">needs</span><span class="kw" style="color: #003B4F;
background-color: null;
font-style: inherit;">:</span><span class="at" style="color: #657422;
background-color: null;
font-style: inherit;"> detect-changes</span></span>
<span id="cb3-74"><span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">    </span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">if</span><span class="kw" style="color: #003B4F;
background-color: null;
font-style: inherit;">:</span><span class="at" style="color: #657422;
background-color: null;
font-style: inherit;"> needs.detect-changes.outputs.shared_changed == 'true'</span></span>
<span id="cb3-75"><span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">    </span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">runs-on</span><span class="kw" style="color: #003B4F;
background-color: null;
font-style: inherit;">:</span><span class="at" style="color: #657422;
background-color: null;
font-style: inherit;"> ubuntu-latest</span></span>
<span id="cb3-76"><span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">    </span></span>
<span id="cb3-77"><span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">    </span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">steps</span><span class="kw" style="color: #003B4F;
background-color: null;
font-style: inherit;">:</span></span>
<span id="cb3-78"><span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">      </span><span class="kw" style="color: #003B4F;
background-color: null;
font-style: inherit;">-</span><span class="at" style="color: #657422;
background-color: null;
font-style: inherit;"> </span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">uses</span><span class="kw" style="color: #003B4F;
background-color: null;
font-style: inherit;">:</span><span class="at" style="color: #657422;
background-color: null;
font-style: inherit;"> actions/checkout@v3</span></span>
<span id="cb3-79"><span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">      </span><span class="kw" style="color: #003B4F;
background-color: null;
font-style: inherit;">-</span><span class="at" style="color: #657422;
background-color: null;
font-style: inherit;"> </span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">uses</span><span class="kw" style="color: #003B4F;
background-color: null;
font-style: inherit;">:</span><span class="at" style="color: #657422;
background-color: null;
font-style: inherit;"> actions/setup-python@v4</span></span>
<span id="cb3-80"><span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">        </span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">with</span><span class="kw" style="color: #003B4F;
background-color: null;
font-style: inherit;">:</span></span>
<span id="cb3-81"><span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">          </span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">python-version</span><span class="kw" style="color: #003B4F;
background-color: null;
font-style: inherit;">:</span><span class="at" style="color: #657422;
background-color: null;
font-style: inherit;"> </span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">'3.11'</span></span>
<span id="cb3-82"><span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">      </span></span>
<span id="cb3-83"><span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">      </span><span class="kw" style="color: #003B4F;
background-color: null;
font-style: inherit;">-</span><span class="at" style="color: #657422;
background-color: null;
font-style: inherit;"> </span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">name</span><span class="kw" style="color: #003B4F;
background-color: null;
font-style: inherit;">:</span><span class="at" style="color: #657422;
background-color: null;
font-style: inherit;"> Install dependencies</span></span>
<span id="cb3-84"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">        run</span><span class="kw" style="color: #003B4F;
background-color: null;
font-style: inherit;">: </span><span class="ch" style="color: #20794D;
background-color: null;
font-style: inherit;">|</span></span>
<span id="cb3-85">          pip install poetry</span>
<span id="cb3-86">          poetry install</span>
<span id="cb3-87"><span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">      </span></span>
<span id="cb3-88"><span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">      </span><span class="kw" style="color: #003B4F;
background-color: null;
font-style: inherit;">-</span><span class="at" style="color: #657422;
background-color: null;
font-style: inherit;"> </span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">name</span><span class="kw" style="color: #003B4F;
background-color: null;
font-style: inherit;">:</span><span class="at" style="color: #657422;
background-color: null;
font-style: inherit;"> Test shared module</span></span>
<span id="cb3-89"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">        run</span><span class="kw" style="color: #003B4F;
background-color: null;
font-style: inherit;">: </span><span class="ch" style="color: #20794D;
background-color: null;
font-style: inherit;">|</span></span>
<span id="cb3-90">          poetry run pytest shared/tests/ -v --cov=shared</span>
<span id="cb3-91"></span>
<span id="cb3-92"><span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">  </span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">test-agents</span><span class="kw" style="color: #003B4F;
background-color: null;
font-style: inherit;">:</span></span>
<span id="cb3-93"><span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">    </span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">needs</span><span class="kw" style="color: #003B4F;
background-color: null;
font-style: inherit;">:</span><span class="at" style="color: #657422;
background-color: null;
font-style: inherit;"> detect-changes</span></span>
<span id="cb3-94"><span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">    </span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">if</span><span class="kw" style="color: #003B4F;
background-color: null;
font-style: inherit;">:</span><span class="at" style="color: #657422;
background-color: null;
font-style: inherit;"> needs.detect-changes.outputs.affected_agents != ''</span></span>
<span id="cb3-95"><span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">    </span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">runs-on</span><span class="kw" style="color: #003B4F;
background-color: null;
font-style: inherit;">:</span><span class="at" style="color: #657422;
background-color: null;
font-style: inherit;"> ubuntu-latest</span></span>
<span id="cb3-96"><span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">    </span></span>
<span id="cb3-97"><span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">    </span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">strategy</span><span class="kw" style="color: #003B4F;
background-color: null;
font-style: inherit;">:</span></span>
<span id="cb3-98"><span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">      </span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">matrix</span><span class="kw" style="color: #003B4F;
background-color: null;
font-style: inherit;">:</span></span>
<span id="cb3-99"><span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">        </span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">agent</span><span class="kw" style="color: #003B4F;
background-color: null;
font-style: inherit;">:</span><span class="at" style="color: #657422;
background-color: null;
font-style: inherit;"> ${{ fromJson(needs.detect-changes.outputs.affected_agents == 'all' &amp;&amp; '["data_standardization", "code_analysis", "knowledge_qna"]' || format('["{0}"]', needs.detect-changes.outputs.affected_agents)) }}</span></span>
<span id="cb3-100"><span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">    </span></span>
<span id="cb3-101"><span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">    </span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">steps</span><span class="kw" style="color: #003B4F;
background-color: null;
font-style: inherit;">:</span></span>
<span id="cb3-102"><span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">      </span><span class="kw" style="color: #003B4F;
background-color: null;
font-style: inherit;">-</span><span class="at" style="color: #657422;
background-color: null;
font-style: inherit;"> </span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">uses</span><span class="kw" style="color: #003B4F;
background-color: null;
font-style: inherit;">:</span><span class="at" style="color: #657422;
background-color: null;
font-style: inherit;"> actions/checkout@v3</span></span>
<span id="cb3-103"><span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">      </span><span class="kw" style="color: #003B4F;
background-color: null;
font-style: inherit;">-</span><span class="at" style="color: #657422;
background-color: null;
font-style: inherit;"> </span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">uses</span><span class="kw" style="color: #003B4F;
background-color: null;
font-style: inherit;">:</span><span class="at" style="color: #657422;
background-color: null;
font-style: inherit;"> actions/setup-python@v4</span></span>
<span id="cb3-104"><span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">        </span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">with</span><span class="kw" style="color: #003B4F;
background-color: null;
font-style: inherit;">:</span></span>
<span id="cb3-105"><span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">          </span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">python-version</span><span class="kw" style="color: #003B4F;
background-color: null;
font-style: inherit;">:</span><span class="at" style="color: #657422;
background-color: null;
font-style: inherit;"> </span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">'3.11'</span></span>
<span id="cb3-106"><span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">      </span></span>
<span id="cb3-107"><span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">      </span><span class="kw" style="color: #003B4F;
background-color: null;
font-style: inherit;">-</span><span class="at" style="color: #657422;
background-color: null;
font-style: inherit;"> </span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">name</span><span class="kw" style="color: #003B4F;
background-color: null;
font-style: inherit;">:</span><span class="at" style="color: #657422;
background-color: null;
font-style: inherit;"> Install dependencies</span></span>
<span id="cb3-108"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">        run</span><span class="kw" style="color: #003B4F;
background-color: null;
font-style: inherit;">: </span><span class="ch" style="color: #20794D;
background-color: null;
font-style: inherit;">|</span></span>
<span id="cb3-109">          pip install poetry</span>
<span id="cb3-110">          poetry install</span>
<span id="cb3-111"><span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">      </span></span>
<span id="cb3-112"><span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">      </span><span class="kw" style="color: #003B4F;
background-color: null;
font-style: inherit;">-</span><span class="at" style="color: #657422;
background-color: null;
font-style: inherit;"> </span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">name</span><span class="kw" style="color: #003B4F;
background-color: null;
font-style: inherit;">:</span><span class="at" style="color: #657422;
background-color: null;
font-style: inherit;"> Test agent - ${{ matrix.agent }}</span></span>
<span id="cb3-113"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">        run</span><span class="kw" style="color: #003B4F;
background-color: null;
font-style: inherit;">: </span><span class="ch" style="color: #20794D;
background-color: null;
font-style: inherit;">|</span></span>
<span id="cb3-114">          poetry run pytest agents/${{ matrix.agent }}/tests/ -v</span>
<span id="cb3-115"><span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">      </span></span>
<span id="cb3-116"><span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">      </span><span class="kw" style="color: #003B4F;
background-color: null;
font-style: inherit;">-</span><span class="at" style="color: #657422;
background-color: null;
font-style: inherit;"> </span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">name</span><span class="kw" style="color: #003B4F;
background-color: null;
font-style: inherit;">:</span><span class="at" style="color: #657422;
background-color: null;
font-style: inherit;"> Evaluate agent performance</span></span>
<span id="cb3-117"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">        run</span><span class="kw" style="color: #003B4F;
background-color: null;
font-style: inherit;">: </span><span class="ch" style="color: #20794D;
background-color: null;
font-style: inherit;">|</span></span>
<span id="cb3-118">          poetry run python scripts/evaluate_agent.py ${{ matrix.agent }}</span>
<span id="cb3-119"></span>
<span id="cb3-120"><span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">  </span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">lint</span><span class="kw" style="color: #003B4F;
background-color: null;
font-style: inherit;">:</span></span>
<span id="cb3-121"><span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">    </span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">runs-on</span><span class="kw" style="color: #003B4F;
background-color: null;
font-style: inherit;">:</span><span class="at" style="color: #657422;
background-color: null;
font-style: inherit;"> ubuntu-latest</span></span>
<span id="cb3-122"><span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">    </span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">steps</span><span class="kw" style="color: #003B4F;
background-color: null;
font-style: inherit;">:</span></span>
<span id="cb3-123"><span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">      </span><span class="kw" style="color: #003B4F;
background-color: null;
font-style: inherit;">-</span><span class="at" style="color: #657422;
background-color: null;
font-style: inherit;"> </span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">uses</span><span class="kw" style="color: #003B4F;
background-color: null;
font-style: inherit;">:</span><span class="at" style="color: #657422;
background-color: null;
font-style: inherit;"> actions/checkout@v3</span></span>
<span id="cb3-124"><span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">      </span><span class="kw" style="color: #003B4F;
background-color: null;
font-style: inherit;">-</span><span class="at" style="color: #657422;
background-color: null;
font-style: inherit;"> </span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">uses</span><span class="kw" style="color: #003B4F;
background-color: null;
font-style: inherit;">:</span><span class="at" style="color: #657422;
background-color: null;
font-style: inherit;"> actions/setup-python@v4</span></span>
<span id="cb3-125"><span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">        </span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">with</span><span class="kw" style="color: #003B4F;
background-color: null;
font-style: inherit;">:</span></span>
<span id="cb3-126"><span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">          </span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">python-version</span><span class="kw" style="color: #003B4F;
background-color: null;
font-style: inherit;">:</span><span class="at" style="color: #657422;
background-color: null;
font-style: inherit;"> </span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">'3.11'</span></span>
<span id="cb3-127"><span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">      </span></span>
<span id="cb3-128"><span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">      </span><span class="kw" style="color: #003B4F;
background-color: null;
font-style: inherit;">-</span><span class="at" style="color: #657422;
background-color: null;
font-style: inherit;"> </span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">name</span><span class="kw" style="color: #003B4F;
background-color: null;
font-style: inherit;">:</span><span class="at" style="color: #657422;
background-color: null;
font-style: inherit;"> Install dependencies</span></span>
<span id="cb3-129"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">        run</span><span class="kw" style="color: #003B4F;
background-color: null;
font-style: inherit;">: </span><span class="ch" style="color: #20794D;
background-color: null;
font-style: inherit;">|</span></span>
<span id="cb3-130">          pip install poetry</span>
<span id="cb3-131">          poetry install</span>
<span id="cb3-132"><span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">      </span></span>
<span id="cb3-133"><span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">      </span><span class="kw" style="color: #003B4F;
background-color: null;
font-style: inherit;">-</span><span class="at" style="color: #657422;
background-color: null;
font-style: inherit;"> </span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">name</span><span class="kw" style="color: #003B4F;
background-color: null;
font-style: inherit;">:</span><span class="at" style="color: #657422;
background-color: null;
font-style: inherit;"> Lint with ruff</span></span>
<span id="cb3-134"><span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">        </span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">run</span><span class="kw" style="color: #003B4F;
background-color: null;
font-style: inherit;">:</span><span class="at" style="color: #657422;
background-color: null;
font-style: inherit;"> poetry run ruff check .</span></span>
<span id="cb3-135"><span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">      </span></span>
<span id="cb3-136"><span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">      </span><span class="kw" style="color: #003B4F;
background-color: null;
font-style: inherit;">-</span><span class="at" style="color: #657422;
background-color: null;
font-style: inherit;"> </span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">name</span><span class="kw" style="color: #003B4F;
background-color: null;
font-style: inherit;">:</span><span class="at" style="color: #657422;
background-color: null;
font-style: inherit;"> Check import rules</span></span>
<span id="cb3-137"><span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">        </span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">run</span><span class="kw" style="color: #003B4F;
background-color: null;
font-style: inherit;">:</span><span class="at" style="color: #657422;
background-color: null;
font-style: inherit;"> poetry run lint-imports</span></span>
<span id="cb3-138"><span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">      </span></span>
<span id="cb3-139"><span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">      </span><span class="kw" style="color: #003B4F;
background-color: null;
font-style: inherit;">-</span><span class="at" style="color: #657422;
background-color: null;
font-style: inherit;"> </span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">name</span><span class="kw" style="color: #003B4F;
background-color: null;
font-style: inherit;">:</span><span class="at" style="color: #657422;
background-color: null;
font-style: inherit;"> Type check with mypy</span></span>
<span id="cb3-140"><span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">        </span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">run</span><span class="kw" style="color: #003B4F;
background-color: null;
font-style: inherit;">:</span><span class="at" style="color: #657422;
background-color: null;
font-style: inherit;"> poetry run mypy core/ shared/ agents/</span></span>
<span id="cb3-141"></span>
<span id="cb3-142"><span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">  </span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">integration-test</span><span class="kw" style="color: #003B4F;
background-color: null;
font-style: inherit;">:</span></span>
<span id="cb3-143"><span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">    </span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">needs</span><span class="kw" style="color: #003B4F;
background-color: null;
font-style: inherit;">:</span><span class="at" style="color: #657422;
background-color: null;
font-style: inherit;"> </span><span class="kw" style="color: #003B4F;
background-color: null;
font-style: inherit;">[</span><span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">test-core</span><span class="kw" style="color: #003B4F;
background-color: null;
font-style: inherit;">,</span><span class="at" style="color: #657422;
background-color: null;
font-style: inherit;"> test-shared</span><span class="kw" style="color: #003B4F;
background-color: null;
font-style: inherit;">,</span><span class="at" style="color: #657422;
background-color: null;
font-style: inherit;"> test-agents</span><span class="kw" style="color: #003B4F;
background-color: null;
font-style: inherit;">]</span></span>
<span id="cb3-144"><span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">    </span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">if</span><span class="kw" style="color: #003B4F;
background-color: null;
font-style: inherit;">:</span><span class="at" style="color: #657422;
background-color: null;
font-style: inherit;"> always() &amp;&amp; (needs.test-core.result == 'success' || needs.test-core.result == 'skipped') &amp;&amp; (needs.test-shared.result == 'success' || needs.test-shared.result == 'skipped') &amp;&amp; (needs.test-agents.result == 'success' || needs.test-agents.result == 'skipped')</span></span>
<span id="cb3-145"><span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">    </span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">runs-on</span><span class="kw" style="color: #003B4F;
background-color: null;
font-style: inherit;">:</span><span class="at" style="color: #657422;
background-color: null;
font-style: inherit;"> ubuntu-latest</span></span>
<span id="cb3-146"><span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">    </span></span>
<span id="cb3-147"><span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">    </span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">steps</span><span class="kw" style="color: #003B4F;
background-color: null;
font-style: inherit;">:</span></span>
<span id="cb3-148"><span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">      </span><span class="kw" style="color: #003B4F;
background-color: null;
font-style: inherit;">-</span><span class="at" style="color: #657422;
background-color: null;
font-style: inherit;"> </span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">uses</span><span class="kw" style="color: #003B4F;
background-color: null;
font-style: inherit;">:</span><span class="at" style="color: #657422;
background-color: null;
font-style: inherit;"> actions/checkout@v3</span></span>
<span id="cb3-149"><span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">      </span><span class="kw" style="color: #003B4F;
background-color: null;
font-style: inherit;">-</span><span class="at" style="color: #657422;
background-color: null;
font-style: inherit;"> </span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">uses</span><span class="kw" style="color: #003B4F;
background-color: null;
font-style: inherit;">:</span><span class="at" style="color: #657422;
background-color: null;
font-style: inherit;"> actions/setup-python@v4</span></span>
<span id="cb3-150"><span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">        </span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">with</span><span class="kw" style="color: #003B4F;
background-color: null;
font-style: inherit;">:</span></span>
<span id="cb3-151"><span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">          </span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">python-version</span><span class="kw" style="color: #003B4F;
background-color: null;
font-style: inherit;">:</span><span class="at" style="color: #657422;
background-color: null;
font-style: inherit;"> </span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">'3.11'</span></span>
<span id="cb3-152"><span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">      </span></span>
<span id="cb3-153"><span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">      </span><span class="kw" style="color: #003B4F;
background-color: null;
font-style: inherit;">-</span><span class="at" style="color: #657422;
background-color: null;
font-style: inherit;"> </span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">name</span><span class="kw" style="color: #003B4F;
background-color: null;
font-style: inherit;">:</span><span class="at" style="color: #657422;
background-color: null;
font-style: inherit;"> Install dependencies</span></span>
<span id="cb3-154"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">        run</span><span class="kw" style="color: #003B4F;
background-color: null;
font-style: inherit;">: </span><span class="ch" style="color: #20794D;
background-color: null;
font-style: inherit;">|</span></span>
<span id="cb3-155">          pip install poetry</span>
<span id="cb3-156">          poetry install</span>
<span id="cb3-157"><span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">      </span></span>
<span id="cb3-158"><span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">      </span><span class="kw" style="color: #003B4F;
background-color: null;
font-style: inherit;">-</span><span class="at" style="color: #657422;
background-color: null;
font-style: inherit;"> </span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">name</span><span class="kw" style="color: #003B4F;
background-color: null;
font-style: inherit;">:</span><span class="at" style="color: #657422;
background-color: null;
font-style: inherit;"> Run integration tests</span></span>
<span id="cb3-159"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">        run</span><span class="kw" style="color: #003B4F;
background-color: null;
font-style: inherit;">: </span><span class="ch" style="color: #20794D;
background-color: null;
font-style: inherit;">|</span></span>
<span id="cb3-160">          poetry run pytest tests/integration/ -v</span>
<span id="cb3-161"><span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">      </span></span>
<span id="cb3-162"><span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">      </span><span class="kw" style="color: #003B4F;
background-color: null;
font-style: inherit;">-</span><span class="at" style="color: #657422;
background-color: null;
font-style: inherit;"> </span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">name</span><span class="kw" style="color: #003B4F;
background-color: null;
font-style: inherit;">:</span><span class="at" style="color: #657422;
background-color: null;
font-style: inherit;"> Test agent chaining</span></span>
<span id="cb3-163"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">        run</span><span class="kw" style="color: #003B4F;
background-color: null;
font-style: inherit;">: </span><span class="ch" style="color: #20794D;
background-color: null;
font-style: inherit;">|</span></span>
<span id="cb3-164">          poetry run python scripts/test_chaining.py</span></code></pre></div>
</section>
<section id="deploy-prod.yml-프로덕션-배포" class="level3" data-number="2.2.3">
<h3 data-number="2.2.3" class="anchored" data-anchor-id="deploy-prod.yml-프로덕션-배포"><span class="header-section-number">2.2.3</span> deploy-prod.yml: 프로덕션 배포</h3>
<div class="sourceCode" id="cb4" style="background: #f1f3f5;"><pre class="sourceCode numberSource yaml number-lines code-with-copy"><code class="sourceCode yaml"><span id="cb4-1"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># .github/workflows/deploy-prod.yml</span></span>
<span id="cb4-2"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">name</span><span class="kw" style="color: #003B4F;
background-color: null;
font-style: inherit;">:</span><span class="at" style="color: #657422;
background-color: null;
font-style: inherit;"> Deploy to Production</span></span>
<span id="cb4-3"></span>
<span id="cb4-4"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">on</span><span class="kw" style="color: #003B4F;
background-color: null;
font-style: inherit;">:</span></span>
<span id="cb4-5"><span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">  </span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">workflow_dispatch</span><span class="kw" style="color: #003B4F;
background-color: null;
font-style: inherit;">:</span><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">  # 수동 트리거</span></span>
<span id="cb4-6"><span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">    </span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">inputs</span><span class="kw" style="color: #003B4F;
background-color: null;
font-style: inherit;">:</span></span>
<span id="cb4-7"><span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">      </span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">deployment_type</span><span class="kw" style="color: #003B4F;
background-color: null;
font-style: inherit;">:</span></span>
<span id="cb4-8"><span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">        </span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">description</span><span class="kw" style="color: #003B4F;
background-color: null;
font-style: inherit;">:</span><span class="at" style="color: #657422;
background-color: null;
font-style: inherit;"> </span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">'Deployment strategy'</span></span>
<span id="cb4-9"><span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">        </span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">required</span><span class="kw" style="color: #003B4F;
background-color: null;
font-style: inherit;">:</span><span class="at" style="color: #657422;
background-color: null;
font-style: inherit;"> </span><span class="ch" style="color: #20794D;
background-color: null;
font-style: inherit;">true</span></span>
<span id="cb4-10"><span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">        </span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">type</span><span class="kw" style="color: #003B4F;
background-color: null;
font-style: inherit;">:</span><span class="at" style="color: #657422;
background-color: null;
font-style: inherit;"> choice</span></span>
<span id="cb4-11"><span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">        </span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">options</span><span class="kw" style="color: #003B4F;
background-color: null;
font-style: inherit;">:</span></span>
<span id="cb4-12"><span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">          </span><span class="kw" style="color: #003B4F;
background-color: null;
font-style: inherit;">-</span><span class="at" style="color: #657422;
background-color: null;
font-style: inherit;"> blue-green</span></span>
<span id="cb4-13"><span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">          </span><span class="kw" style="color: #003B4F;
background-color: null;
font-style: inherit;">-</span><span class="at" style="color: #657422;
background-color: null;
font-style: inherit;"> canary</span></span>
<span id="cb4-14"><span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">      </span></span>
<span id="cb4-15"><span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">      </span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">canary_percentage</span><span class="kw" style="color: #003B4F;
background-color: null;
font-style: inherit;">:</span></span>
<span id="cb4-16"><span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">        </span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">description</span><span class="kw" style="color: #003B4F;
background-color: null;
font-style: inherit;">:</span><span class="at" style="color: #657422;
background-color: null;
font-style: inherit;"> </span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">'Canary traffic percentage (if canary selected)'</span></span>
<span id="cb4-17"><span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">        </span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">required</span><span class="kw" style="color: #003B4F;
background-color: null;
font-style: inherit;">:</span><span class="at" style="color: #657422;
background-color: null;
font-style: inherit;"> </span><span class="ch" style="color: #20794D;
background-color: null;
font-style: inherit;">false</span></span>
<span id="cb4-18"><span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">        </span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">default</span><span class="kw" style="color: #003B4F;
background-color: null;
font-style: inherit;">:</span><span class="at" style="color: #657422;
background-color: null;
font-style: inherit;"> </span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">'10'</span></span>
<span id="cb4-19"></span>
<span id="cb4-20"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">jobs</span><span class="kw" style="color: #003B4F;
background-color: null;
font-style: inherit;">:</span></span>
<span id="cb4-21"><span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">  </span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">build</span><span class="kw" style="color: #003B4F;
background-color: null;
font-style: inherit;">:</span></span>
<span id="cb4-22"><span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">    </span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">runs-on</span><span class="kw" style="color: #003B4F;
background-color: null;
font-style: inherit;">:</span><span class="at" style="color: #657422;
background-color: null;
font-style: inherit;"> ubuntu-latest</span></span>
<span id="cb4-23"><span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">    </span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">steps</span><span class="kw" style="color: #003B4F;
background-color: null;
font-style: inherit;">:</span></span>
<span id="cb4-24"><span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">      </span><span class="kw" style="color: #003B4F;
background-color: null;
font-style: inherit;">-</span><span class="at" style="color: #657422;
background-color: null;
font-style: inherit;"> </span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">uses</span><span class="kw" style="color: #003B4F;
background-color: null;
font-style: inherit;">:</span><span class="at" style="color: #657422;
background-color: null;
font-style: inherit;"> actions/checkout@v3</span></span>
<span id="cb4-25"><span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">      </span></span>
<span id="cb4-26"><span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">      </span><span class="kw" style="color: #003B4F;
background-color: null;
font-style: inherit;">-</span><span class="at" style="color: #657422;
background-color: null;
font-style: inherit;"> </span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">name</span><span class="kw" style="color: #003B4F;
background-color: null;
font-style: inherit;">:</span><span class="at" style="color: #657422;
background-color: null;
font-style: inherit;"> Set up Docker Buildx</span></span>
<span id="cb4-27"><span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">        </span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">uses</span><span class="kw" style="color: #003B4F;
background-color: null;
font-style: inherit;">:</span><span class="at" style="color: #657422;
background-color: null;
font-style: inherit;"> docker/setup-buildx-action@v2</span></span>
<span id="cb4-28"><span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">      </span></span>
<span id="cb4-29"><span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">      </span><span class="kw" style="color: #003B4F;
background-color: null;
font-style: inherit;">-</span><span class="at" style="color: #657422;
background-color: null;
font-style: inherit;"> </span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">name</span><span class="kw" style="color: #003B4F;
background-color: null;
font-style: inherit;">:</span><span class="at" style="color: #657422;
background-color: null;
font-style: inherit;"> Login to Container Registry</span></span>
<span id="cb4-30"><span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">        </span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">uses</span><span class="kw" style="color: #003B4F;
background-color: null;
font-style: inherit;">:</span><span class="at" style="color: #657422;
background-color: null;
font-style: inherit;"> docker/login-action@v2</span></span>
<span id="cb4-31"><span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">        </span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">with</span><span class="kw" style="color: #003B4F;
background-color: null;
font-style: inherit;">:</span></span>
<span id="cb4-32"><span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">          </span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">registry</span><span class="kw" style="color: #003B4F;
background-color: null;
font-style: inherit;">:</span><span class="at" style="color: #657422;
background-color: null;
font-style: inherit;"> ghcr.io</span></span>
<span id="cb4-33"><span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">          </span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">username</span><span class="kw" style="color: #003B4F;
background-color: null;
font-style: inherit;">:</span><span class="at" style="color: #657422;
background-color: null;
font-style: inherit;"> ${{ github.actor }}</span></span>
<span id="cb4-34"><span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">          </span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">password</span><span class="kw" style="color: #003B4F;
background-color: null;
font-style: inherit;">:</span><span class="at" style="color: #657422;
background-color: null;
font-style: inherit;"> ${{ secrets.GITHUB_TOKEN }}</span></span>
<span id="cb4-35"><span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">      </span></span>
<span id="cb4-36"><span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">      </span><span class="kw" style="color: #003B4F;
background-color: null;
font-style: inherit;">-</span><span class="at" style="color: #657422;
background-color: null;
font-style: inherit;"> </span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">name</span><span class="kw" style="color: #003B4F;
background-color: null;
font-style: inherit;">:</span><span class="at" style="color: #657422;
background-color: null;
font-style: inherit;"> Build and push</span></span>
<span id="cb4-37"><span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">        </span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">uses</span><span class="kw" style="color: #003B4F;
background-color: null;
font-style: inherit;">:</span><span class="at" style="color: #657422;
background-color: null;
font-style: inherit;"> docker/build-push-action@v4</span></span>
<span id="cb4-38"><span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">        </span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">with</span><span class="kw" style="color: #003B4F;
background-color: null;
font-style: inherit;">:</span></span>
<span id="cb4-39"><span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">          </span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">context</span><span class="kw" style="color: #003B4F;
background-color: null;
font-style: inherit;">:</span><span class="at" style="color: #657422;
background-color: null;
font-style: inherit;"> .</span></span>
<span id="cb4-40"><span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">          </span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">push</span><span class="kw" style="color: #003B4F;
background-color: null;
font-style: inherit;">:</span><span class="at" style="color: #657422;
background-color: null;
font-style: inherit;"> </span><span class="ch" style="color: #20794D;
background-color: null;
font-style: inherit;">true</span></span>
<span id="cb4-41"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">          tags</span><span class="kw" style="color: #003B4F;
background-color: null;
font-style: inherit;">: </span><span class="ch" style="color: #20794D;
background-color: null;
font-style: inherit;">|</span></span>
<span id="cb4-42">            ghcr.io/${{ github.repository }}/agent-platform:${{ github.sha }}</span>
<span id="cb4-43">            ghcr.io/${{ github.repository }}/agent-platform:latest</span>
<span id="cb4-44"><span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">          </span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">cache-from</span><span class="kw" style="color: #003B4F;
background-color: null;
font-style: inherit;">:</span><span class="at" style="color: #657422;
background-color: null;
font-style: inherit;"> type=gha</span></span>
<span id="cb4-45"><span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">          </span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">cache-to</span><span class="kw" style="color: #003B4F;
background-color: null;
font-style: inherit;">:</span><span class="at" style="color: #657422;
background-color: null;
font-style: inherit;"> type=gha,mode=max</span></span>
<span id="cb4-46"></span>
<span id="cb4-47"><span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">  </span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">deploy</span><span class="kw" style="color: #003B4F;
background-color: null;
font-style: inherit;">:</span></span>
<span id="cb4-48"><span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">    </span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">needs</span><span class="kw" style="color: #003B4F;
background-color: null;
font-style: inherit;">:</span><span class="at" style="color: #657422;
background-color: null;
font-style: inherit;"> build</span></span>
<span id="cb4-49"><span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">    </span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">runs-on</span><span class="kw" style="color: #003B4F;
background-color: null;
font-style: inherit;">:</span><span class="at" style="color: #657422;
background-color: null;
font-style: inherit;"> ubuntu-latest</span></span>
<span id="cb4-50"><span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">    </span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">environment</span><span class="kw" style="color: #003B4F;
background-color: null;
font-style: inherit;">:</span><span class="at" style="color: #657422;
background-color: null;
font-style: inherit;"> production</span><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">  # 승인 필요</span></span>
<span id="cb4-51"><span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">    </span></span>
<span id="cb4-52"><span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">    </span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">steps</span><span class="kw" style="color: #003B4F;
background-color: null;
font-style: inherit;">:</span></span>
<span id="cb4-53"><span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">      </span><span class="kw" style="color: #003B4F;
background-color: null;
font-style: inherit;">-</span><span class="at" style="color: #657422;
background-color: null;
font-style: inherit;"> </span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">uses</span><span class="kw" style="color: #003B4F;
background-color: null;
font-style: inherit;">:</span><span class="at" style="color: #657422;
background-color: null;
font-style: inherit;"> actions/checkout@v3</span></span>
<span id="cb4-54"><span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">      </span></span>
<span id="cb4-55"><span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">      </span><span class="kw" style="color: #003B4F;
background-color: null;
font-style: inherit;">-</span><span class="at" style="color: #657422;
background-color: null;
font-style: inherit;"> </span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">name</span><span class="kw" style="color: #003B4F;
background-color: null;
font-style: inherit;">:</span><span class="at" style="color: #657422;
background-color: null;
font-style: inherit;"> Configure kubectl</span></span>
<span id="cb4-56"><span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">        </span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">uses</span><span class="kw" style="color: #003B4F;
background-color: null;
font-style: inherit;">:</span><span class="at" style="color: #657422;
background-color: null;
font-style: inherit;"> azure/k8s-set-context@v3</span></span>
<span id="cb4-57"><span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">        </span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">with</span><span class="kw" style="color: #003B4F;
background-color: null;
font-style: inherit;">:</span></span>
<span id="cb4-58"><span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">          </span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">kubeconfig</span><span class="kw" style="color: #003B4F;
background-color: null;
font-style: inherit;">:</span><span class="at" style="color: #657422;
background-color: null;
font-style: inherit;"> ${{ secrets.KUBE_CONFIG }}</span></span>
<span id="cb4-59"><span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">      </span></span>
<span id="cb4-60"><span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">      </span><span class="kw" style="color: #003B4F;
background-color: null;
font-style: inherit;">-</span><span class="at" style="color: #657422;
background-color: null;
font-style: inherit;"> </span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">name</span><span class="kw" style="color: #003B4F;
background-color: null;
font-style: inherit;">:</span><span class="at" style="color: #657422;
background-color: null;
font-style: inherit;"> Deploy with Blue-Green</span></span>
<span id="cb4-61"><span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">        </span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">if</span><span class="kw" style="color: #003B4F;
background-color: null;
font-style: inherit;">:</span><span class="at" style="color: #657422;
background-color: null;
font-style: inherit;"> inputs.deployment_type == 'blue-green'</span></span>
<span id="cb4-62"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">        run</span><span class="kw" style="color: #003B4F;
background-color: null;
font-style: inherit;">: </span><span class="ch" style="color: #20794D;
background-color: null;
font-style: inherit;">|</span></span>
<span id="cb4-63">          # 새 버전 배포 (green)</span>
<span id="cb4-64">          kubectl apply -f k8s/deployment-green.yaml</span>
<span id="cb4-65">          </span>
<span id="cb4-66">          # Health check</span>
<span id="cb4-67">          kubectl wait --for=condition=ready pod -l version=green --timeout=300s</span>
<span id="cb4-68">          </span>
<span id="cb4-69">          # 트래픽 전환</span>
<span id="cb4-70">          kubectl patch service agent-platform -p '{"spec":{"selector":{"version":"green"}}}'</span>
<span id="cb4-71">          </span>
<span id="cb4-72">          # 기존 버전 제거 (blue)</span>
<span id="cb4-73">          kubectl delete deployment agent-platform-blue</span>
<span id="cb4-74"><span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">      </span></span>
<span id="cb4-75"><span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">      </span><span class="kw" style="color: #003B4F;
background-color: null;
font-style: inherit;">-</span><span class="at" style="color: #657422;
background-color: null;
font-style: inherit;"> </span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">name</span><span class="kw" style="color: #003B4F;
background-color: null;
font-style: inherit;">:</span><span class="at" style="color: #657422;
background-color: null;
font-style: inherit;"> Deploy with Canary</span></span>
<span id="cb4-76"><span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">        </span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">if</span><span class="kw" style="color: #003B4F;
background-color: null;
font-style: inherit;">:</span><span class="at" style="color: #657422;
background-color: null;
font-style: inherit;"> inputs.deployment_type == 'canary'</span></span>
<span id="cb4-77"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">        run</span><span class="kw" style="color: #003B4F;
background-color: null;
font-style: inherit;">: </span><span class="ch" style="color: #20794D;
background-color: null;
font-style: inherit;">|</span></span>
<span id="cb4-78">          # Canary 배포</span>
<span id="cb4-79">          kubectl apply -f k8s/deployment-canary.yaml</span>
<span id="cb4-80">          </span>
<span id="cb4-81">          # 트래픽 비율 조정</span>
<span id="cb4-82">          kubectl patch virtualservice agent-platform -p '{</span>
<span id="cb4-83">            "spec": {</span>
<span id="cb4-84">              "http": [{</span>
<span id="cb4-85">                "match": [{"uri": {"prefix": "/"}}],</span>
<span id="cb4-86">                "route": [</span>
<span id="cb4-87">                  {"destination": {"host": "agent-platform-stable"}, "weight": '$((100 - ${{ inputs.canary_percentage }}))'},</span>
<span id="cb4-88">                  {"destination": {"host": "agent-platform-canary"}, "weight": ${{ inputs.canary_percentage }}}</span>
<span id="cb4-89">                ]</span>
<span id="cb4-90">              }]</span>
<span id="cb4-91">            }</span>
<span id="cb4-92">          }'</span>
<span id="cb4-93">          </span>
<span id="cb4-94">          echo "Canary deployed with ${{ inputs.canary_percentage }}% traffic"</span>
<span id="cb4-95"><span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">      </span></span>
<span id="cb4-96"><span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">      </span><span class="kw" style="color: #003B4F;
background-color: null;
font-style: inherit;">-</span><span class="at" style="color: #657422;
background-color: null;
font-style: inherit;"> </span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">name</span><span class="kw" style="color: #003B4F;
background-color: null;
font-style: inherit;">:</span><span class="at" style="color: #657422;
background-color: null;
font-style: inherit;"> Notify Slack</span></span>
<span id="cb4-97"><span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">        </span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">uses</span><span class="kw" style="color: #003B4F;
background-color: null;
font-style: inherit;">:</span><span class="at" style="color: #657422;
background-color: null;
font-style: inherit;"> slackapi/slack-github-action@v1</span></span>
<span id="cb4-98"><span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">        </span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">with</span><span class="kw" style="color: #003B4F;
background-color: null;
font-style: inherit;">:</span></span>
<span id="cb4-99"><span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">          </span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">webhook-url</span><span class="kw" style="color: #003B4F;
background-color: null;
font-style: inherit;">:</span><span class="at" style="color: #657422;
background-color: null;
font-style: inherit;"> ${{ secrets.SLACK_WEBHOOK }}</span></span>
<span id="cb4-100"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">          payload</span><span class="kw" style="color: #003B4F;
background-color: null;
font-style: inherit;">: </span><span class="ch" style="color: #20794D;
background-color: null;
font-style: inherit;">|</span></span>
<span id="cb4-101">            {</span>
<span id="cb4-102">              "text": "✅ Production deployment successful",</span>
<span id="cb4-103">              "blocks": [</span>
<span id="cb4-104">                {</span>
<span id="cb4-105">                  "type": "section",</span>
<span id="cb4-106">                  "text": {</span>
<span id="cb4-107">                    "type": "mrkdwn",</span>
<span id="cb4-108">                    "text": "*Deployment*: ${{ inputs.deployment_type }}\n*Commit*: ${{ github.sha }}\n*Actor*: ${{ github.actor }}"</span>
<span id="cb4-109">                  }</span>
<span id="cb4-110">                }</span>
<span id="cb4-111">              ]</span>
<span id="cb4-112">            }</span></code></pre></div>
</section>
</section>
<section id="docker-컨테이너화" class="level2" data-number="2.3">
<h2 data-number="2.3" class="anchored" data-anchor-id="docker-컨테이너화"><span class="header-section-number">2.3</span> Docker 컨테이너화</h2>
<section id="dockerfile" class="level3" data-number="2.3.1">
<h3 data-number="2.3.1" class="anchored" data-anchor-id="dockerfile"><span class="header-section-number">2.3.1</span> Dockerfile</h3>
<div class="sourceCode" id="cb5" style="background: #f1f3f5;"><pre class="sourceCode numberSource dockerfile number-lines code-with-copy"><code class="sourceCode dockerfile"><span id="cb5-1"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># Dockerfile</span></span>
<span id="cb5-2"><span class="kw" style="color: #003B4F;
background-color: null;
font-style: inherit;">FROM</span> python:3.11-slim as base</span>
<span id="cb5-3"></span>
<span id="cb5-4"><span class="kw" style="color: #003B4F;
background-color: null;
font-style: inherit;">WORKDIR</span> /app</span>
<span id="cb5-5"></span>
<span id="cb5-6"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># 의존성 설치</span></span>
<span id="cb5-7"><span class="kw" style="color: #003B4F;
background-color: null;
font-style: inherit;">COPY</span> pyproject.toml poetry.lock ./</span>
<span id="cb5-8"><span class="kw" style="color: #003B4F;
background-color: null;
font-style: inherit;">RUN</span> <span class="ex" style="color: null;
background-color: null;
font-style: inherit;">pip</span> install poetry <span class="kw" style="color: #003B4F;
background-color: null;
font-style: inherit;">&amp;&amp;</span> <span class="dt" style="color: #AD0000;
background-color: null;
font-style: inherit;">\</span></span>
<span id="cb5-9">    <span class="ex" style="color: null;
background-color: null;
font-style: inherit;">poetry</span> config virtualenvs.create false <span class="kw" style="color: #003B4F;
background-color: null;
font-style: inherit;">&amp;&amp;</span> <span class="dt" style="color: #AD0000;
background-color: null;
font-style: inherit;">\</span></span>
<span id="cb5-10">    <span class="ex" style="color: null;
background-color: null;
font-style: inherit;">poetry</span> install <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">--no-dev</span></span>
<span id="cb5-11"></span>
<span id="cb5-12"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># 애플리케이션 코드</span></span>
<span id="cb5-13"><span class="kw" style="color: #003B4F;
background-color: null;
font-style: inherit;">COPY</span> core/ ./core/</span>
<span id="cb5-14"><span class="kw" style="color: #003B4F;
background-color: null;
font-style: inherit;">COPY</span> shared/ ./shared/</span>
<span id="cb5-15"><span class="kw" style="color: #003B4F;
background-color: null;
font-style: inherit;">COPY</span> agents/ ./agents/</span>
<span id="cb5-16"><span class="kw" style="color: #003B4F;
background-color: null;
font-style: inherit;">COPY</span> platform-api/ ./platform-api/</span>
<span id="cb5-17"><span class="kw" style="color: #003B4F;
background-color: null;
font-style: inherit;">COPY</span> config/ ./config/</span>
<span id="cb5-18"></span>
<span id="cb5-19"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># 환경 변수</span></span>
<span id="cb5-20"><span class="kw" style="color: #003B4F;
background-color: null;
font-style: inherit;">ENV</span> <span class="kw" style="color: #003B4F;
background-color: null;
font-style: inherit;">ENV</span>=production</span>
<span id="cb5-21"><span class="kw" style="color: #003B4F;
background-color: null;
font-style: inherit;">ENV</span> PYTHONPATH=/app</span>
<span id="cb5-22"></span>
<span id="cb5-23"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># Health check</span></span>
<span id="cb5-24"><span class="kw" style="color: #003B4F;
background-color: null;
font-style: inherit;">HEALTHCHECK</span> <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">--interval=30s</span> <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">--timeout=10s</span> <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">--start-period=5s</span> <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">--retries=3</span> \</span>
<span id="cb5-25">  <span class="kw" style="color: #003B4F;
background-color: null;
font-style: inherit;">CMD</span> <span class="ex" style="color: null;
background-color: null;
font-style: inherit;">python</span> <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">-c</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"import requests; requests.get('http://localhost:8000/health')"</span></span>
<span id="cb5-26"></span>
<span id="cb5-27"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># 실행</span></span>
<span id="cb5-28"><span class="kw" style="color: #003B4F;
background-color: null;
font-style: inherit;">CMD</span> [<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"uvicorn"</span>, <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"platform-api.main:app"</span>, <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"--host"</span>, <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"0.0.0.0"</span>, <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"--port"</span>, <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"8000"</span>]</span></code></pre></div>
</section>
<section id="docker-compose.yml-로컬-개발" class="level3" data-number="2.3.2">
<h3 data-number="2.3.2" class="anchored" data-anchor-id="docker-compose.yml-로컬-개발"><span class="header-section-number">2.3.2</span> docker-compose.yml (로컬 개발)</h3>
<div class="sourceCode" id="cb6" style="background: #f1f3f5;"><pre class="sourceCode numberSource yaml number-lines code-with-copy"><code class="sourceCode yaml"><span id="cb6-1"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># docker-compose.yml</span></span>
<span id="cb6-2"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">version</span><span class="kw" style="color: #003B4F;
background-color: null;
font-style: inherit;">:</span><span class="at" style="color: #657422;
background-color: null;
font-style: inherit;"> </span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">'3.8'</span></span>
<span id="cb6-3"></span>
<span id="cb6-4"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">services</span><span class="kw" style="color: #003B4F;
background-color: null;
font-style: inherit;">:</span></span>
<span id="cb6-5"><span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">  </span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">platform-api</span><span class="kw" style="color: #003B4F;
background-color: null;
font-style: inherit;">:</span></span>
<span id="cb6-6"><span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">    </span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">build</span><span class="kw" style="color: #003B4F;
background-color: null;
font-style: inherit;">:</span><span class="at" style="color: #657422;
background-color: null;
font-style: inherit;"> .</span></span>
<span id="cb6-7"><span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">    </span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">ports</span><span class="kw" style="color: #003B4F;
background-color: null;
font-style: inherit;">:</span></span>
<span id="cb6-8"><span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">      </span><span class="kw" style="color: #003B4F;
background-color: null;
font-style: inherit;">-</span><span class="at" style="color: #657422;
background-color: null;
font-style: inherit;"> </span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"8000:8000"</span></span>
<span id="cb6-9"><span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">    </span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">environment</span><span class="kw" style="color: #003B4F;
background-color: null;
font-style: inherit;">:</span></span>
<span id="cb6-10"><span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">      </span><span class="kw" style="color: #003B4F;
background-color: null;
font-style: inherit;">-</span><span class="at" style="color: #657422;
background-color: null;
font-style: inherit;"> ENV=development</span></span>
<span id="cb6-11"><span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">      </span><span class="kw" style="color: #003B4F;
background-color: null;
font-style: inherit;">-</span><span class="at" style="color: #657422;
background-color: null;
font-style: inherit;"> OPENAI_API_KEY=${OPENAI_API_KEY}</span></span>
<span id="cb6-12"><span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">    </span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">volumes</span><span class="kw" style="color: #003B4F;
background-color: null;
font-style: inherit;">:</span></span>
<span id="cb6-13"><span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">      </span><span class="kw" style="color: #003B4F;
background-color: null;
font-style: inherit;">-</span><span class="at" style="color: #657422;
background-color: null;
font-style: inherit;"> ./core:/app/core</span></span>
<span id="cb6-14"><span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">      </span><span class="kw" style="color: #003B4F;
background-color: null;
font-style: inherit;">-</span><span class="at" style="color: #657422;
background-color: null;
font-style: inherit;"> ./shared:/app/shared</span></span>
<span id="cb6-15"><span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">      </span><span class="kw" style="color: #003B4F;
background-color: null;
font-style: inherit;">-</span><span class="at" style="color: #657422;
background-color: null;
font-style: inherit;"> ./agents:/app/agents</span></span>
<span id="cb6-16"><span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">    </span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">depends_on</span><span class="kw" style="color: #003B4F;
background-color: null;
font-style: inherit;">:</span></span>
<span id="cb6-17"><span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">      </span><span class="kw" style="color: #003B4F;
background-color: null;
font-style: inherit;">-</span><span class="at" style="color: #657422;
background-color: null;
font-style: inherit;"> vector-db</span></span>
<span id="cb6-18"><span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">      </span><span class="kw" style="color: #003B4F;
background-color: null;
font-style: inherit;">-</span><span class="at" style="color: #657422;
background-color: null;
font-style: inherit;"> monitoring</span></span>
<span id="cb6-19"><span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">  </span></span>
<span id="cb6-20"><span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">  </span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">vector-db</span><span class="kw" style="color: #003B4F;
background-color: null;
font-style: inherit;">:</span></span>
<span id="cb6-21"><span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">    </span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">image</span><span class="kw" style="color: #003B4F;
background-color: null;
font-style: inherit;">:</span><span class="at" style="color: #657422;
background-color: null;
font-style: inherit;"> chromadb/chroma:latest</span></span>
<span id="cb6-22"><span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">    </span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">ports</span><span class="kw" style="color: #003B4F;
background-color: null;
font-style: inherit;">:</span></span>
<span id="cb6-23"><span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">      </span><span class="kw" style="color: #003B4F;
background-color: null;
font-style: inherit;">-</span><span class="at" style="color: #657422;
background-color: null;
font-style: inherit;"> </span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"8001:8000"</span></span>
<span id="cb6-24"><span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">    </span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">volumes</span><span class="kw" style="color: #003B4F;
background-color: null;
font-style: inherit;">:</span></span>
<span id="cb6-25"><span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">      </span><span class="kw" style="color: #003B4F;
background-color: null;
font-style: inherit;">-</span><span class="at" style="color: #657422;
background-color: null;
font-style: inherit;"> chroma-data:/chroma/chroma</span></span>
<span id="cb6-26"><span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">  </span></span>
<span id="cb6-27"><span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">  </span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">monitoring</span><span class="kw" style="color: #003B4F;
background-color: null;
font-style: inherit;">:</span></span>
<span id="cb6-28"><span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">    </span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">image</span><span class="kw" style="color: #003B4F;
background-color: null;
font-style: inherit;">:</span><span class="at" style="color: #657422;
background-color: null;
font-style: inherit;"> prom/prometheus:latest</span></span>
<span id="cb6-29"><span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">    </span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">ports</span><span class="kw" style="color: #003B4F;
background-color: null;
font-style: inherit;">:</span></span>
<span id="cb6-30"><span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">      </span><span class="kw" style="color: #003B4F;
background-color: null;
font-style: inherit;">-</span><span class="at" style="color: #657422;
background-color: null;
font-style: inherit;"> </span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"9090:9090"</span></span>
<span id="cb6-31"><span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">    </span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">volumes</span><span class="kw" style="color: #003B4F;
background-color: null;
font-style: inherit;">:</span></span>
<span id="cb6-32"><span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">      </span><span class="kw" style="color: #003B4F;
background-color: null;
font-style: inherit;">-</span><span class="at" style="color: #657422;
background-color: null;
font-style: inherit;"> ./config/prometheus.yml:/etc/prometheus/prometheus.yml</span></span>
<span id="cb6-33"><span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">      </span><span class="kw" style="color: #003B4F;
background-color: null;
font-style: inherit;">-</span><span class="at" style="color: #657422;
background-color: null;
font-style: inherit;"> prometheus-data:/prometheus</span></span>
<span id="cb6-34"><span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">  </span></span>
<span id="cb6-35"><span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">  </span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">grafana</span><span class="kw" style="color: #003B4F;
background-color: null;
font-style: inherit;">:</span></span>
<span id="cb6-36"><span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">    </span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">image</span><span class="kw" style="color: #003B4F;
background-color: null;
font-style: inherit;">:</span><span class="at" style="color: #657422;
background-color: null;
font-style: inherit;"> grafana/grafana:latest</span></span>
<span id="cb6-37"><span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">    </span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">ports</span><span class="kw" style="color: #003B4F;
background-color: null;
font-style: inherit;">:</span></span>
<span id="cb6-38"><span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">      </span><span class="kw" style="color: #003B4F;
background-color: null;
font-style: inherit;">-</span><span class="at" style="color: #657422;
background-color: null;
font-style: inherit;"> </span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"3000:3000"</span></span>
<span id="cb6-39"><span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">    </span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">environment</span><span class="kw" style="color: #003B4F;
background-color: null;
font-style: inherit;">:</span></span>
<span id="cb6-40"><span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">      </span><span class="kw" style="color: #003B4F;
background-color: null;
font-style: inherit;">-</span><span class="at" style="color: #657422;
background-color: null;
font-style: inherit;"> GF_SECURITY_ADMIN_PASSWORD=admin</span></span>
<span id="cb6-41"><span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">    </span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">volumes</span><span class="kw" style="color: #003B4F;
background-color: null;
font-style: inherit;">:</span></span>
<span id="cb6-42"><span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">      </span><span class="kw" style="color: #003B4F;
background-color: null;
font-style: inherit;">-</span><span class="at" style="color: #657422;
background-color: null;
font-style: inherit;"> grafana-data:/var/lib/grafana</span></span>
<span id="cb6-43"><span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">      </span><span class="kw" style="color: #003B4F;
background-color: null;
font-style: inherit;">-</span><span class="at" style="color: #657422;
background-color: null;
font-style: inherit;"> ./config/grafana/dashboards:/etc/grafana/provisioning/dashboards</span></span>
<span id="cb6-44"></span>
<span id="cb6-45"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">volumes</span><span class="kw" style="color: #003B4F;
background-color: null;
font-style: inherit;">:</span></span>
<span id="cb6-46"><span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">  </span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">chroma-data</span><span class="kw" style="color: #003B4F;
background-color: null;
font-style: inherit;">:</span></span>
<span id="cb6-47"><span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">  </span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">prometheus-data</span><span class="kw" style="color: #003B4F;
background-color: null;
font-style: inherit;">:</span></span>
<span id="cb6-48"><span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">  </span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">grafana-data</span><span class="kw" style="color: #003B4F;
background-color: null;
font-style: inherit;">:</span></span></code></pre></div>
</section>
</section>
</section>
<section id="배포-전략" class="level1" data-number="3">
<h1 data-number="3"><span class="header-section-number">3</span> 배포 전략</h1>
<section id="blue-green-배포" class="level2" data-number="3.1">
<h2 data-number="3.1" class="anchored" data-anchor-id="blue-green-배포"><span class="header-section-number">3.1</span> Blue-Green 배포</h2>
<section id="개념" class="level3" data-number="3.1.1">
<h3 data-number="3.1.1" class="anchored" data-anchor-id="개념"><span class="header-section-number">3.1.1</span> 개념</h3>
<pre><code>[Before]
Blue (현재 버전)  ← 트래픽 100%
Green (새 버전)   ← 대기

[After]
Blue (이전 버전)  ← 대기 (롤백용)
Green (새 버전)   ← 트래픽 100%</code></pre>
</section>
<section id="kubernetes-매니페스트" class="level3" data-number="3.1.2">
<h3 data-number="3.1.2" class="anchored" data-anchor-id="kubernetes-매니페스트"><span class="header-section-number">3.1.2</span> Kubernetes 매니페스트</h3>
<div class="sourceCode" id="cb8" style="background: #f1f3f5;"><pre class="sourceCode numberSource yaml number-lines code-with-copy"><code class="sourceCode yaml"><span id="cb8-1"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># k8s/deployment-blue.yaml</span></span>
<span id="cb8-2"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">apiVersion</span><span class="kw" style="color: #003B4F;
background-color: null;
font-style: inherit;">:</span><span class="at" style="color: #657422;
background-color: null;
font-style: inherit;"> apps/v1</span></span>
<span id="cb8-3"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">kind</span><span class="kw" style="color: #003B4F;
background-color: null;
font-style: inherit;">:</span><span class="at" style="color: #657422;
background-color: null;
font-style: inherit;"> Deployment</span></span>
<span id="cb8-4"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">metadata</span><span class="kw" style="color: #003B4F;
background-color: null;
font-style: inherit;">:</span></span>
<span id="cb8-5"><span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">  </span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">name</span><span class="kw" style="color: #003B4F;
background-color: null;
font-style: inherit;">:</span><span class="at" style="color: #657422;
background-color: null;
font-style: inherit;"> agent-platform-blue</span></span>
<span id="cb8-6"><span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">  </span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">labels</span><span class="kw" style="color: #003B4F;
background-color: null;
font-style: inherit;">:</span></span>
<span id="cb8-7"><span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">    </span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">app</span><span class="kw" style="color: #003B4F;
background-color: null;
font-style: inherit;">:</span><span class="at" style="color: #657422;
background-color: null;
font-style: inherit;"> agent-platform</span></span>
<span id="cb8-8"><span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">    </span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">version</span><span class="kw" style="color: #003B4F;
background-color: null;
font-style: inherit;">:</span><span class="at" style="color: #657422;
background-color: null;
font-style: inherit;"> blue</span></span>
<span id="cb8-9"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">spec</span><span class="kw" style="color: #003B4F;
background-color: null;
font-style: inherit;">:</span></span>
<span id="cb8-10"><span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">  </span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">replicas</span><span class="kw" style="color: #003B4F;
background-color: null;
font-style: inherit;">:</span><span class="at" style="color: #657422;
background-color: null;
font-style: inherit;"> </span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">3</span></span>
<span id="cb8-11"><span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">  </span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">selector</span><span class="kw" style="color: #003B4F;
background-color: null;
font-style: inherit;">:</span></span>
<span id="cb8-12"><span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">    </span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">matchLabels</span><span class="kw" style="color: #003B4F;
background-color: null;
font-style: inherit;">:</span></span>
<span id="cb8-13"><span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">      </span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">app</span><span class="kw" style="color: #003B4F;
background-color: null;
font-style: inherit;">:</span><span class="at" style="color: #657422;
background-color: null;
font-style: inherit;"> agent-platform</span></span>
<span id="cb8-14"><span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">      </span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">version</span><span class="kw" style="color: #003B4F;
background-color: null;
font-style: inherit;">:</span><span class="at" style="color: #657422;
background-color: null;
font-style: inherit;"> blue</span></span>
<span id="cb8-15"><span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">  </span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">template</span><span class="kw" style="color: #003B4F;
background-color: null;
font-style: inherit;">:</span></span>
<span id="cb8-16"><span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">    </span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">metadata</span><span class="kw" style="color: #003B4F;
background-color: null;
font-style: inherit;">:</span></span>
<span id="cb8-17"><span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">      </span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">labels</span><span class="kw" style="color: #003B4F;
background-color: null;
font-style: inherit;">:</span></span>
<span id="cb8-18"><span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">        </span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">app</span><span class="kw" style="color: #003B4F;
background-color: null;
font-style: inherit;">:</span><span class="at" style="color: #657422;
background-color: null;
font-style: inherit;"> agent-platform</span></span>
<span id="cb8-19"><span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">        </span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">version</span><span class="kw" style="color: #003B4F;
background-color: null;
font-style: inherit;">:</span><span class="at" style="color: #657422;
background-color: null;
font-style: inherit;"> blue</span></span>
<span id="cb8-20"><span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">    </span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">spec</span><span class="kw" style="color: #003B4F;
background-color: null;
font-style: inherit;">:</span></span>
<span id="cb8-21"><span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">      </span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">containers</span><span class="kw" style="color: #003B4F;
background-color: null;
font-style: inherit;">:</span></span>
<span id="cb8-22"><span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">      </span><span class="kw" style="color: #003B4F;
background-color: null;
font-style: inherit;">-</span><span class="at" style="color: #657422;
background-color: null;
font-style: inherit;"> </span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">name</span><span class="kw" style="color: #003B4F;
background-color: null;
font-style: inherit;">:</span><span class="at" style="color: #657422;
background-color: null;
font-style: inherit;"> platform</span></span>
<span id="cb8-23"><span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">        </span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">image</span><span class="kw" style="color: #003B4F;
background-color: null;
font-style: inherit;">:</span><span class="at" style="color: #657422;
background-color: null;
font-style: inherit;"> ghcr.io/org/agent-platform:stable</span></span>
<span id="cb8-24"><span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">        </span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">ports</span><span class="kw" style="color: #003B4F;
background-color: null;
font-style: inherit;">:</span></span>
<span id="cb8-25"><span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">        </span><span class="kw" style="color: #003B4F;
background-color: null;
font-style: inherit;">-</span><span class="at" style="color: #657422;
background-color: null;
font-style: inherit;"> </span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">containerPort</span><span class="kw" style="color: #003B4F;
background-color: null;
font-style: inherit;">:</span><span class="at" style="color: #657422;
background-color: null;
font-style: inherit;"> </span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">8000</span></span>
<span id="cb8-26"><span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">        </span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">env</span><span class="kw" style="color: #003B4F;
background-color: null;
font-style: inherit;">:</span></span>
<span id="cb8-27"><span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">        </span><span class="kw" style="color: #003B4F;
background-color: null;
font-style: inherit;">-</span><span class="at" style="color: #657422;
background-color: null;
font-style: inherit;"> </span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">name</span><span class="kw" style="color: #003B4F;
background-color: null;
font-style: inherit;">:</span><span class="at" style="color: #657422;
background-color: null;
font-style: inherit;"> ENV</span></span>
<span id="cb8-28"><span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">          </span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">value</span><span class="kw" style="color: #003B4F;
background-color: null;
font-style: inherit;">:</span><span class="at" style="color: #657422;
background-color: null;
font-style: inherit;"> </span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"production"</span></span>
<span id="cb8-29"><span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">        </span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">resources</span><span class="kw" style="color: #003B4F;
background-color: null;
font-style: inherit;">:</span></span>
<span id="cb8-30"><span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">          </span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">requests</span><span class="kw" style="color: #003B4F;
background-color: null;
font-style: inherit;">:</span></span>
<span id="cb8-31"><span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">            </span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">memory</span><span class="kw" style="color: #003B4F;
background-color: null;
font-style: inherit;">:</span><span class="at" style="color: #657422;
background-color: null;
font-style: inherit;"> </span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"512Mi"</span></span>
<span id="cb8-32"><span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">            </span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">cpu</span><span class="kw" style="color: #003B4F;
background-color: null;
font-style: inherit;">:</span><span class="at" style="color: #657422;
background-color: null;
font-style: inherit;"> </span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"500m"</span></span>
<span id="cb8-33"><span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">          </span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">limits</span><span class="kw" style="color: #003B4F;
background-color: null;
font-style: inherit;">:</span></span>
<span id="cb8-34"><span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">            </span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">memory</span><span class="kw" style="color: #003B4F;
background-color: null;
font-style: inherit;">:</span><span class="at" style="color: #657422;
background-color: null;
font-style: inherit;"> </span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"1Gi"</span></span>
<span id="cb8-35"><span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">            </span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">cpu</span><span class="kw" style="color: #003B4F;
background-color: null;
font-style: inherit;">:</span><span class="at" style="color: #657422;
background-color: null;
font-style: inherit;"> </span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"1000m"</span></span>
<span id="cb8-36"><span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">        </span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">livenessProbe</span><span class="kw" style="color: #003B4F;
background-color: null;
font-style: inherit;">:</span></span>
<span id="cb8-37"><span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">          </span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">httpGet</span><span class="kw" style="color: #003B4F;
background-color: null;
font-style: inherit;">:</span></span>
<span id="cb8-38"><span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">            </span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">path</span><span class="kw" style="color: #003B4F;
background-color: null;
font-style: inherit;">:</span><span class="at" style="color: #657422;
background-color: null;
font-style: inherit;"> /health</span></span>
<span id="cb8-39"><span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">            </span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">port</span><span class="kw" style="color: #003B4F;
background-color: null;
font-style: inherit;">:</span><span class="at" style="color: #657422;
background-color: null;
font-style: inherit;"> </span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">8000</span></span>
<span id="cb8-40"><span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">          </span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">initialDelaySeconds</span><span class="kw" style="color: #003B4F;
background-color: null;
font-style: inherit;">:</span><span class="at" style="color: #657422;
background-color: null;
font-style: inherit;"> </span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">30</span></span>
<span id="cb8-41"><span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">          </span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">periodSeconds</span><span class="kw" style="color: #003B4F;
background-color: null;
font-style: inherit;">:</span><span class="at" style="color: #657422;
background-color: null;
font-style: inherit;"> </span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">10</span></span>
<span id="cb8-42"><span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">        </span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">readinessProbe</span><span class="kw" style="color: #003B4F;
background-color: null;
font-style: inherit;">:</span></span>
<span id="cb8-43"><span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">          </span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">httpGet</span><span class="kw" style="color: #003B4F;
background-color: null;
font-style: inherit;">:</span></span>
<span id="cb8-44"><span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">            </span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">path</span><span class="kw" style="color: #003B4F;
background-color: null;
font-style: inherit;">:</span><span class="at" style="color: #657422;
background-color: null;
font-style: inherit;"> /ready</span></span>
<span id="cb8-45"><span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">            </span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">port</span><span class="kw" style="color: #003B4F;
background-color: null;
font-style: inherit;">:</span><span class="at" style="color: #657422;
background-color: null;
font-style: inherit;"> </span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">8000</span></span>
<span id="cb8-46"><span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">          </span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">initialDelaySeconds</span><span class="kw" style="color: #003B4F;
background-color: null;
font-style: inherit;">:</span><span class="at" style="color: #657422;
background-color: null;
font-style: inherit;"> </span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">5</span></span>
<span id="cb8-47"><span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">          </span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">periodSeconds</span><span class="kw" style="color: #003B4F;
background-color: null;
font-style: inherit;">:</span><span class="at" style="color: #657422;
background-color: null;
font-style: inherit;"> </span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">5</span></span>
<span id="cb8-48"></span>
<span id="cb8-49"><span class="pp" style="color: #AD0000;
background-color: null;
font-style: inherit;">---</span></span>
<span id="cb8-50"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># k8s/deployment-green.yaml</span></span>
<span id="cb8-51"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">apiVersion</span><span class="kw" style="color: #003B4F;
background-color: null;
font-style: inherit;">:</span><span class="at" style="color: #657422;
background-color: null;
font-style: inherit;"> apps/v1</span></span>
<span id="cb8-52"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">kind</span><span class="kw" style="color: #003B4F;
background-color: null;
font-style: inherit;">:</span><span class="at" style="color: #657422;
background-color: null;
font-style: inherit;"> Deployment</span></span>
<span id="cb8-53"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">metadata</span><span class="kw" style="color: #003B4F;
background-color: null;
font-style: inherit;">:</span></span>
<span id="cb8-54"><span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">  </span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">name</span><span class="kw" style="color: #003B4F;
background-color: null;
font-style: inherit;">:</span><span class="at" style="color: #657422;
background-color: null;
font-style: inherit;"> agent-platform-green</span></span>
<span id="cb8-55"><span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">  </span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">labels</span><span class="kw" style="color: #003B4F;
background-color: null;
font-style: inherit;">:</span></span>
<span id="cb8-56"><span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">    </span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">app</span><span class="kw" style="color: #003B4F;
background-color: null;
font-style: inherit;">:</span><span class="at" style="color: #657422;
background-color: null;
font-style: inherit;"> agent-platform</span></span>
<span id="cb8-57"><span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">    </span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">version</span><span class="kw" style="color: #003B4F;
background-color: null;
font-style: inherit;">:</span><span class="at" style="color: #657422;
background-color: null;
font-style: inherit;"> green</span></span>
<span id="cb8-58"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">spec</span><span class="kw" style="color: #003B4F;
background-color: null;
font-style: inherit;">:</span></span>
<span id="cb8-59"><span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">  </span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">replicas</span><span class="kw" style="color: #003B4F;
background-color: null;
font-style: inherit;">:</span><span class="at" style="color: #657422;
background-color: null;
font-style: inherit;"> </span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">3</span></span>
<span id="cb8-60"><span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">  </span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">selector</span><span class="kw" style="color: #003B4F;
background-color: null;
font-style: inherit;">:</span></span>
<span id="cb8-61"><span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">    </span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">matchLabels</span><span class="kw" style="color: #003B4F;
background-color: null;
font-style: inherit;">:</span></span>
<span id="cb8-62"><span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">      </span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">app</span><span class="kw" style="color: #003B4F;
background-color: null;
font-style: inherit;">:</span><span class="at" style="color: #657422;
background-color: null;
font-style: inherit;"> agent-platform</span></span>
<span id="cb8-63"><span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">      </span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">version</span><span class="kw" style="color: #003B4F;
background-color: null;
font-style: inherit;">:</span><span class="at" style="color: #657422;
background-color: null;
font-style: inherit;"> green</span></span>
<span id="cb8-64"><span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">  </span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">template</span><span class="kw" style="color: #003B4F;
background-color: null;
font-style: inherit;">:</span></span>
<span id="cb8-65"><span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">    </span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">metadata</span><span class="kw" style="color: #003B4F;
background-color: null;
font-style: inherit;">:</span></span>
<span id="cb8-66"><span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">      </span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">labels</span><span class="kw" style="color: #003B4F;
background-color: null;
font-style: inherit;">:</span></span>
<span id="cb8-67"><span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">        </span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">app</span><span class="kw" style="color: #003B4F;
background-color: null;
font-style: inherit;">:</span><span class="at" style="color: #657422;
background-color: null;
font-style: inherit;"> agent-platform</span></span>
<span id="cb8-68"><span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">        </span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">version</span><span class="kw" style="color: #003B4F;
background-color: null;
font-style: inherit;">:</span><span class="at" style="color: #657422;
background-color: null;
font-style: inherit;"> green</span></span>
<span id="cb8-69"><span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">    </span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">spec</span><span class="kw" style="color: #003B4F;
background-color: null;
font-style: inherit;">:</span></span>
<span id="cb8-70"><span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">      </span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">containers</span><span class="kw" style="color: #003B4F;
background-color: null;
font-style: inherit;">:</span></span>
<span id="cb8-71"><span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">      </span><span class="kw" style="color: #003B4F;
background-color: null;
font-style: inherit;">-</span><span class="at" style="color: #657422;
background-color: null;
font-style: inherit;"> </span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">name</span><span class="kw" style="color: #003B4F;
background-color: null;
font-style: inherit;">:</span><span class="at" style="color: #657422;
background-color: null;
font-style: inherit;"> platform</span></span>
<span id="cb8-72"><span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">        </span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">image</span><span class="kw" style="color: #003B4F;
background-color: null;
font-style: inherit;">:</span><span class="at" style="color: #657422;
background-color: null;
font-style: inherit;"> ghcr.io/org/agent-platform:${{ github.sha }}</span><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">  # 새 버전</span></span>
<span id="cb8-73"><span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">        </span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">ports</span><span class="kw" style="color: #003B4F;
background-color: null;
font-style: inherit;">:</span></span>
<span id="cb8-74"><span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">        </span><span class="kw" style="color: #003B4F;
background-color: null;
font-style: inherit;">-</span><span class="at" style="color: #657422;
background-color: null;
font-style: inherit;"> </span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">containerPort</span><span class="kw" style="color: #003B4F;
background-color: null;
font-style: inherit;">:</span><span class="at" style="color: #657422;
background-color: null;
font-style: inherit;"> </span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">8000</span></span>
<span id="cb8-75"><span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">        </span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">env</span><span class="kw" style="color: #003B4F;
background-color: null;
font-style: inherit;">:</span></span>
<span id="cb8-76"><span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">        </span><span class="kw" style="color: #003B4F;
background-color: null;
font-style: inherit;">-</span><span class="at" style="color: #657422;
background-color: null;
font-style: inherit;"> </span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">name</span><span class="kw" style="color: #003B4F;
background-color: null;
font-style: inherit;">:</span><span class="at" style="color: #657422;
background-color: null;
font-style: inherit;"> ENV</span></span>
<span id="cb8-77"><span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">          </span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">value</span><span class="kw" style="color: #003B4F;
background-color: null;
font-style: inherit;">:</span><span class="at" style="color: #657422;
background-color: null;
font-style: inherit;"> </span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"production"</span></span>
<span id="cb8-78"><span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">        </span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">resources</span><span class="kw" style="color: #003B4F;
background-color: null;
font-style: inherit;">:</span></span>
<span id="cb8-79"><span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">          </span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">requests</span><span class="kw" style="color: #003B4F;
background-color: null;
font-style: inherit;">:</span></span>
<span id="cb8-80"><span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">            </span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">memory</span><span class="kw" style="color: #003B4F;
background-color: null;
font-style: inherit;">:</span><span class="at" style="color: #657422;
background-color: null;
font-style: inherit;"> </span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"512Mi"</span></span>
<span id="cb8-81"><span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">            </span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">cpu</span><span class="kw" style="color: #003B4F;
background-color: null;
font-style: inherit;">:</span><span class="at" style="color: #657422;
background-color: null;
font-style: inherit;"> </span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"500m"</span></span>
<span id="cb8-82"><span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">          </span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">limits</span><span class="kw" style="color: #003B4F;
background-color: null;
font-style: inherit;">:</span></span>
<span id="cb8-83"><span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">            </span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">memory</span><span class="kw" style="color: #003B4F;
background-color: null;
font-style: inherit;">:</span><span class="at" style="color: #657422;
background-color: null;
font-style: inherit;"> </span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"1Gi"</span></span>
<span id="cb8-84"><span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">            </span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">cpu</span><span class="kw" style="color: #003B4F;
background-color: null;
font-style: inherit;">:</span><span class="at" style="color: #657422;
background-color: null;
font-style: inherit;"> </span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"1000m"</span></span>
<span id="cb8-85"><span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">        </span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">livenessProbe</span><span class="kw" style="color: #003B4F;
background-color: null;
font-style: inherit;">:</span></span>
<span id="cb8-86"><span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">          </span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">httpGet</span><span class="kw" style="color: #003B4F;
background-color: null;
font-style: inherit;">:</span></span>
<span id="cb8-87"><span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">            </span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">path</span><span class="kw" style="color: #003B4F;
background-color: null;
font-style: inherit;">:</span><span class="at" style="color: #657422;
background-color: null;
font-style: inherit;"> /health</span></span>
<span id="cb8-88"><span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">            </span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">port</span><span class="kw" style="color: #003B4F;
background-color: null;
font-style: inherit;">:</span><span class="at" style="color: #657422;
background-color: null;
font-style: inherit;"> </span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">8000</span></span>
<span id="cb8-89"><span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">          </span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">initialDelaySeconds</span><span class="kw" style="color: #003B4F;
background-color: null;
font-style: inherit;">:</span><span class="at" style="color: #657422;
background-color: null;
font-style: inherit;"> </span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">30</span></span>
<span id="cb8-90"><span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">          </span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">periodSeconds</span><span class="kw" style="color: #003B4F;
background-color: null;
font-style: inherit;">:</span><span class="at" style="color: #657422;
background-color: null;
font-style: inherit;"> </span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">10</span></span>
<span id="cb8-91"><span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">        </span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">readinessProbe</span><span class="kw" style="color: #003B4F;
background-color: null;
font-style: inherit;">:</span></span>
<span id="cb8-92"><span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">          </span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">httpGet</span><span class="kw" style="color: #003B4F;
background-color: null;
font-style: inherit;">:</span></span>
<span id="cb8-93"><span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">            </span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">path</span><span class="kw" style="color: #003B4F;
background-color: null;
font-style: inherit;">:</span><span class="at" style="color: #657422;
background-color: null;
font-style: inherit;"> /ready</span></span>
<span id="cb8-94"><span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">            </span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">port</span><span class="kw" style="color: #003B4F;
background-color: null;
font-style: inherit;">:</span><span class="at" style="color: #657422;
background-color: null;
font-style: inherit;"> </span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">8000</span></span>
<span id="cb8-95"><span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">          </span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">initialDelaySeconds</span><span class="kw" style="color: #003B4F;
background-color: null;
font-style: inherit;">:</span><span class="at" style="color: #657422;
background-color: null;
font-style: inherit;"> </span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">5</span></span>
<span id="cb8-96"><span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">          </span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">periodSeconds</span><span class="kw" style="color: #003B4F;
background-color: null;
font-style: inherit;">:</span><span class="at" style="color: #657422;
background-color: null;
font-style: inherit;"> </span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">5</span></span>
<span id="cb8-97"></span>
<span id="cb8-98"><span class="pp" style="color: #AD0000;
background-color: null;
font-style: inherit;">---</span></span>
<span id="cb8-99"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># k8s/service.yaml</span></span>
<span id="cb8-100"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">apiVersion</span><span class="kw" style="color: #003B4F;
background-color: null;
font-style: inherit;">:</span><span class="at" style="color: #657422;
background-color: null;
font-style: inherit;"> v1</span></span>
<span id="cb8-101"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">kind</span><span class="kw" style="color: #003B4F;
background-color: null;
font-style: inherit;">:</span><span class="at" style="color: #657422;
background-color: null;
font-style: inherit;"> Service</span></span>
<span id="cb8-102"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">metadata</span><span class="kw" style="color: #003B4F;
background-color: null;
font-style: inherit;">:</span></span>
<span id="cb8-103"><span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">  </span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">name</span><span class="kw" style="color: #003B4F;
background-color: null;
font-style: inherit;">:</span><span class="at" style="color: #657422;
background-color: null;
font-style: inherit;"> agent-platform</span></span>
<span id="cb8-104"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">spec</span><span class="kw" style="color: #003B4F;
background-color: null;
font-style: inherit;">:</span></span>
<span id="cb8-105"><span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">  </span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">selector</span><span class="kw" style="color: #003B4F;
background-color: null;
font-style: inherit;">:</span></span>
<span id="cb8-106"><span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">    </span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">app</span><span class="kw" style="color: #003B4F;
background-color: null;
font-style: inherit;">:</span><span class="at" style="color: #657422;
background-color: null;
font-style: inherit;"> agent-platform</span></span>
<span id="cb8-107"><span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">    </span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">version</span><span class="kw" style="color: #003B4F;
background-color: null;
font-style: inherit;">:</span><span class="at" style="color: #657422;
background-color: null;
font-style: inherit;"> blue</span><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">  # 트래픽 라우팅 대상 (blue → green 전환)</span></span>
<span id="cb8-108"><span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">  </span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">ports</span><span class="kw" style="color: #003B4F;
background-color: null;
font-style: inherit;">:</span></span>
<span id="cb8-109"><span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">  </span><span class="kw" style="color: #003B4F;
background-color: null;
font-style: inherit;">-</span><span class="at" style="color: #657422;
background-color: null;
font-style: inherit;"> </span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">protocol</span><span class="kw" style="color: #003B4F;
background-color: null;
font-style: inherit;">:</span><span class="at" style="color: #657422;
background-color: null;
font-style: inherit;"> TCP</span></span>
<span id="cb8-110"><span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">    </span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">port</span><span class="kw" style="color: #003B4F;
background-color: null;
font-style: inherit;">:</span><span class="at" style="color: #657422;
background-color: null;
font-style: inherit;"> </span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">80</span></span>
<span id="cb8-111"><span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">    </span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">targetPort</span><span class="kw" style="color: #003B4F;
background-color: null;
font-style: inherit;">:</span><span class="at" style="color: #657422;
background-color: null;
font-style: inherit;"> </span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">8000</span></span>
<span id="cb8-112"><span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">  </span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">type</span><span class="kw" style="color: #003B4F;
background-color: null;
font-style: inherit;">:</span><span class="at" style="color: #657422;
background-color: null;
font-style: inherit;"> LoadBalancer</span></span></code></pre></div>
</section>
<section id="배포-스크립트" class="level3" data-number="3.1.3">
<h3 data-number="3.1.3" class="anchored" data-anchor-id="배포-스크립트"><span class="header-section-number">3.1.3</span> 배포 스크립트</h3>
<div class="sourceCode" id="cb9" style="background: #f1f3f5;"><pre class="sourceCode numberSource bash number-lines code-with-copy"><code class="sourceCode bash"><span id="cb9-1"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">#!/bin/bash</span></span>
<span id="cb9-2"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># scripts/deploy-blue-green.sh</span></span>
<span id="cb9-3"></span>
<span id="cb9-4"><span class="bu" style="color: null;
background-color: null;
font-style: inherit;">set</span> <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">-e</span></span>
<span id="cb9-5"></span>
<span id="cb9-6"><span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">NAMESPACE</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"production"</span></span>
<span id="cb9-7"><span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">IMAGE_TAG</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span><span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">$1</span></span>
<span id="cb9-8"></span>
<span id="cb9-9"><span class="bu" style="color: null;
background-color: null;
font-style: inherit;">echo</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"🚀 Starting Blue-Green deployment..."</span></span>
<span id="cb9-10"></span>
<span id="cb9-11"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># 1. Green 배포</span></span>
<span id="cb9-12"><span class="bu" style="color: null;
background-color: null;
font-style: inherit;">echo</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"📦 Deploying Green version: </span><span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">$IMAGE_TAG</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"</span></span>
<span id="cb9-13"><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">kubectl</span> set image deployment/agent-platform-green <span class="dt" style="color: #AD0000;
background-color: null;
font-style: inherit;">\</span></span>
<span id="cb9-14">  platform=ghcr.io/org/agent-platform:<span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">$IMAGE_TAG</span> <span class="dt" style="color: #AD0000;
background-color: null;
font-style: inherit;">\</span></span>
<span id="cb9-15">  <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">-n</span> <span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">$NAMESPACE</span></span>
<span id="cb9-16"></span>
<span id="cb9-17"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># 2. Green 준비 대기</span></span>
<span id="cb9-18"><span class="bu" style="color: null;
background-color: null;
font-style: inherit;">echo</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"⏳ Waiting for Green to be ready..."</span></span>
<span id="cb9-19"><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">kubectl</span> rollout status deployment/agent-platform-green <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">-n</span> <span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">$NAMESPACE</span></span>
<span id="cb9-20"></span>
<span id="cb9-21"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># 3. Green Health Check</span></span>
<span id="cb9-22"><span class="bu" style="color: null;
background-color: null;
font-style: inherit;">echo</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"🏥 Running health checks on Green..."</span></span>
<span id="cb9-23"><span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">GREEN_POD</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span><span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">$(</span><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">kubectl</span> get pod <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">-n</span> <span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">$NAMESPACE</span> <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">-l</span> version=green <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">-o</span> jsonpath=<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">'{.items[0].metadata.name}'</span><span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">)</span></span>
<span id="cb9-24"><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">kubectl</span> exec <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">-n</span> <span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">$NAMESPACE</span> <span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">$GREEN_POD</span> <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">--</span> curl <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">-f</span> http://localhost:8000/health</span>
<span id="cb9-25"></span>
<span id="cb9-26"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># 4. Smoke Test</span></span>
<span id="cb9-27"><span class="bu" style="color: null;
background-color: null;
font-style: inherit;">echo</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"🧪 Running smoke tests..."</span></span>
<span id="cb9-28"><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">python</span> scripts/smoke_test.py <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">--target</span> green</span>
<span id="cb9-29"></span>
<span id="cb9-30"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># 5. 트래픽 전환 (Blue → Green)</span></span>
<span id="cb9-31"><span class="bu" style="color: null;
background-color: null;
font-style: inherit;">echo</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"🔄 Switching traffic from Blue to Green..."</span></span>
<span id="cb9-32"><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">kubectl</span> patch service agent-platform <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">-n</span> <span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">$NAMESPACE</span> <span class="dt" style="color: #AD0000;
background-color: null;
font-style: inherit;">\</span></span>
<span id="cb9-33">  <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">-p</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">'{"spec":{"selector":{"version":"green"}}}'</span></span>
<span id="cb9-34"></span>
<span id="cb9-35"><span class="bu" style="color: null;
background-color: null;
font-style: inherit;">echo</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"✅ Traffic switched to Green"</span></span>
<span id="cb9-36"></span>
<span id="cb9-37"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># 6. 모니터링 대기 (5분)</span></span>
<span id="cb9-38"><span class="bu" style="color: null;
background-color: null;
font-style: inherit;">echo</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"📊 Monitoring Green for 5 minutes..."</span></span>
<span id="cb9-39"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">sleep</span> 300</span>
<span id="cb9-40"></span>
<span id="cb9-41"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># 7. 에러율 확인</span></span>
<span id="cb9-42"><span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">ERROR_RATE</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span><span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">$(</span><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">curl</span> <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">-s</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"http://prometheus:9090/api/v1/query?query=rate(http_requests_total{status=~'5..'}[5m])"</span> <span class="kw" style="color: #003B4F;
background-color: null;
font-style: inherit;">|</span> <span class="ex" style="color: null;
background-color: null;
font-style: inherit;">jq</span> <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">-r</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">'.data.result[0].value[1]'</span><span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">)</span></span>
<span id="cb9-43"></span>
<span id="cb9-44"><span class="cf" style="color: #003B4F;
background-color: null;
font-style: inherit;">if</span> <span class="kw" style="color: #003B4F;
background-color: null;
font-style: inherit;">((</span> <span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">$(</span><span class="bu" style="color: null;
background-color: null;
font-style: inherit;">echo</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"</span><span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">$ERROR_RATE</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;"> &gt; 0.01"</span> <span class="kw" style="color: #003B4F;
background-color: null;
font-style: inherit;">|</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">bc</span> <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">-l</span><span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">)</span> <span class="kw" style="color: #003B4F;
background-color: null;
font-style: inherit;">));</span> <span class="cf" style="color: #003B4F;
background-color: null;
font-style: inherit;">then</span></span>
<span id="cb9-45">  <span class="bu" style="color: null;
background-color: null;
font-style: inherit;">echo</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"❌ High error rate detected: </span><span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">$ERROR_RATE</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"</span></span>
<span id="cb9-46">  <span class="bu" style="color: null;
background-color: null;
font-style: inherit;">echo</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"🔙 Rolling back to Blue..."</span></span>
<span id="cb9-47">  <span class="ex" style="color: null;
background-color: null;
font-style: inherit;">kubectl</span> patch service agent-platform <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">-n</span> <span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">$NAMESPACE</span> <span class="dt" style="color: #AD0000;
background-color: null;
font-style: inherit;">\</span></span>
<span id="cb9-48">    <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">-p</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">'{"spec":{"selector":{"version":"blue"}}}'</span></span>
<span id="cb9-49">  <span class="bu" style="color: null;
background-color: null;
font-style: inherit;">exit</span> 1</span>
<span id="cb9-50"><span class="cf" style="color: #003B4F;
background-color: null;
font-style: inherit;">fi</span></span>
<span id="cb9-51"></span>
<span id="cb9-52"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># 8. Blue 제거</span></span>
<span id="cb9-53"><span class="bu" style="color: null;
background-color: null;
font-style: inherit;">echo</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"🗑️ Removing old Blue deployment..."</span></span>
<span id="cb9-54"><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">kubectl</span> delete deployment agent-platform-blue <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">-n</span> <span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">$NAMESPACE</span></span>
<span id="cb9-55"></span>
<span id="cb9-56"><span class="bu" style="color: null;
background-color: null;
font-style: inherit;">echo</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"✅ Blue-Green deployment completed successfully!"</span></span></code></pre></div>
</section>
</section>
<section id="canary-배포" class="level2" data-number="3.2">
<h2 data-number="3.2" class="anchored" data-anchor-id="canary-배포"><span class="header-section-number">3.2</span> Canary 배포</h2>
<section id="개념-1" class="level3" data-number="3.2.1">
<h3 data-number="3.2.1" class="anchored" data-anchor-id="개념-1"><span class="header-section-number">3.2.1</span> 개념</h3>
<pre><code>[Phase 1: 10% Canary]
Stable (v1.0) ← 90% 트래픽
Canary (v1.1) ← 10% 트래픽

[Phase 2: 50% Canary]
Stable (v1.0) ← 50% 트래픽
Canary (v1.1) ← 50% 트래픽

[Phase 3: 100% Canary]
Stable (v1.0) ← 제거
Canary (v1.1) ← 100% 트래픽 → Stable로 승격</code></pre>
</section>
<section id="istio-virtualservice" class="level3" data-number="3.2.2">
<h3 data-number="3.2.2" class="anchored" data-anchor-id="istio-virtualservice"><span class="header-section-number">3.2.2</span> Istio VirtualService</h3>
<div class="sourceCode" id="cb11" style="background: #f1f3f5;"><pre class="sourceCode numberSource yaml number-lines code-with-copy"><code class="sourceCode yaml"><span id="cb11-1"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># k8s/virtualservice-canary.yaml</span></span>
<span id="cb11-2"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">apiVersion</span><span class="kw" style="color: #003B4F;
background-color: null;
font-style: inherit;">:</span><span class="at" style="color: #657422;
background-color: null;
font-style: inherit;"> networking.istio.io/v1beta1</span></span>
<span id="cb11-3"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">kind</span><span class="kw" style="color: #003B4F;
background-color: null;
font-style: inherit;">:</span><span class="at" style="color: #657422;
background-color: null;
font-style: inherit;"> VirtualService</span></span>
<span id="cb11-4"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">metadata</span><span class="kw" style="color: #003B4F;
background-color: null;
font-style: inherit;">:</span></span>
<span id="cb11-5"><span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">  </span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">name</span><span class="kw" style="color: #003B4F;
background-color: null;
font-style: inherit;">:</span><span class="at" style="color: #657422;
background-color: null;
font-style: inherit;"> agent-platform</span></span>
<span id="cb11-6"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">spec</span><span class="kw" style="color: #003B4F;
background-color: null;
font-style: inherit;">:</span></span>
<span id="cb11-7"><span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">  </span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">hosts</span><span class="kw" style="color: #003B4F;
background-color: null;
font-style: inherit;">:</span></span>
<span id="cb11-8"><span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">  </span><span class="kw" style="color: #003B4F;
background-color: null;
font-style: inherit;">-</span><span class="at" style="color: #657422;
background-color: null;
font-style: inherit;"> agent-platform.example.com</span></span>
<span id="cb11-9"><span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">  </span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">http</span><span class="kw" style="color: #003B4F;
background-color: null;
font-style: inherit;">:</span></span>
<span id="cb11-10"><span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">  </span><span class="kw" style="color: #003B4F;
background-color: null;
font-style: inherit;">-</span><span class="at" style="color: #657422;
background-color: null;
font-style: inherit;"> </span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">match</span><span class="kw" style="color: #003B4F;
background-color: null;
font-style: inherit;">:</span></span>
<span id="cb11-11"><span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">    </span><span class="kw" style="color: #003B4F;
background-color: null;
font-style: inherit;">-</span><span class="at" style="color: #657422;
background-color: null;
font-style: inherit;"> </span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">uri</span><span class="kw" style="color: #003B4F;
background-color: null;
font-style: inherit;">:</span></span>
<span id="cb11-12"><span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">        </span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">prefix</span><span class="kw" style="color: #003B4F;
background-color: null;
font-style: inherit;">:</span><span class="at" style="color: #657422;
background-color: null;
font-style: inherit;"> /api/agents</span></span>
<span id="cb11-13"><span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">    </span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">route</span><span class="kw" style="color: #003B4F;
background-color: null;
font-style: inherit;">:</span></span>
<span id="cb11-14"><span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">    </span><span class="kw" style="color: #003B4F;
background-color: null;
font-style: inherit;">-</span><span class="at" style="color: #657422;
background-color: null;
font-style: inherit;"> </span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">destination</span><span class="kw" style="color: #003B4F;
background-color: null;
font-style: inherit;">:</span></span>
<span id="cb11-15"><span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">        </span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">host</span><span class="kw" style="color: #003B4F;
background-color: null;
font-style: inherit;">:</span><span class="at" style="color: #657422;
background-color: null;
font-style: inherit;"> agent-platform-stable</span></span>
<span id="cb11-16"><span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">        </span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">subset</span><span class="kw" style="color: #003B4F;
background-color: null;
font-style: inherit;">:</span><span class="at" style="color: #657422;
background-color: null;
font-style: inherit;"> v1</span></span>
<span id="cb11-17"><span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">      </span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">weight</span><span class="kw" style="color: #003B4F;
background-color: null;
font-style: inherit;">:</span><span class="at" style="color: #657422;
background-color: null;
font-style: inherit;"> </span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">90</span><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">  # Stable 버전</span></span>
<span id="cb11-18"><span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">    </span><span class="kw" style="color: #003B4F;
background-color: null;
font-style: inherit;">-</span><span class="at" style="color: #657422;
background-color: null;
font-style: inherit;"> </span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">destination</span><span class="kw" style="color: #003B4F;
background-color: null;
font-style: inherit;">:</span></span>
<span id="cb11-19"><span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">        </span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">host</span><span class="kw" style="color: #003B4F;
background-color: null;
font-style: inherit;">:</span><span class="at" style="color: #657422;
background-color: null;
font-style: inherit;"> agent-platform-canary</span></span>
<span id="cb11-20"><span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">        </span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">subset</span><span class="kw" style="color: #003B4F;
background-color: null;
font-style: inherit;">:</span><span class="at" style="color: #657422;
background-color: null;
font-style: inherit;"> v2</span></span>
<span id="cb11-21"><span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">      </span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">weight</span><span class="kw" style="color: #003B4F;
background-color: null;
font-style: inherit;">:</span><span class="at" style="color: #657422;
background-color: null;
font-style: inherit;"> </span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">10</span><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">  # Canary 버전</span></span>
<span id="cb11-22"><span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">    </span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">timeout</span><span class="kw" style="color: #003B4F;
background-color: null;
font-style: inherit;">:</span><span class="at" style="color: #657422;
background-color: null;
font-style: inherit;"> 30s</span></span>
<span id="cb11-23"><span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">    </span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">retries</span><span class="kw" style="color: #003B4F;
background-color: null;
font-style: inherit;">:</span></span>
<span id="cb11-24"><span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">      </span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">attempts</span><span class="kw" style="color: #003B4F;
background-color: null;
font-style: inherit;">:</span><span class="at" style="color: #657422;
background-color: null;
font-style: inherit;"> </span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">3</span></span>
<span id="cb11-25"><span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">      </span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">perTryTimeout</span><span class="kw" style="color: #003B4F;
background-color: null;
font-style: inherit;">:</span><span class="at" style="color: #657422;
background-color: null;
font-style: inherit;"> 10s</span></span>
<span id="cb11-26"></span>
<span id="cb11-27"><span class="pp" style="color: #AD0000;
background-color: null;
font-style: inherit;">---</span></span>
<span id="cb11-28"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">apiVersion</span><span class="kw" style="color: #003B4F;
background-color: null;
font-style: inherit;">:</span><span class="at" style="color: #657422;
background-color: null;
font-style: inherit;"> networking.istio.io/v1beta1</span></span>
<span id="cb11-29"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">kind</span><span class="kw" style="color: #003B4F;
background-color: null;
font-style: inherit;">:</span><span class="at" style="color: #657422;
background-color: null;
font-style: inherit;"> DestinationRule</span></span>
<span id="cb11-30"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">metadata</span><span class="kw" style="color: #003B4F;
background-color: null;
font-style: inherit;">:</span></span>
<span id="cb11-31"><span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">  </span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">name</span><span class="kw" style="color: #003B4F;
background-color: null;
font-style: inherit;">:</span><span class="at" style="color: #657422;
background-color: null;
font-style: inherit;"> agent-platform</span></span>
<span id="cb11-32"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">spec</span><span class="kw" style="color: #003B4F;
background-color: null;
font-style: inherit;">:</span></span>
<span id="cb11-33"><span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">  </span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">host</span><span class="kw" style="color: #003B4F;
background-color: null;
font-style: inherit;">:</span><span class="at" style="color: #657422;
background-color: null;
font-style: inherit;"> agent-platform</span></span>
<span id="cb11-34"><span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">  </span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">subsets</span><span class="kw" style="color: #003B4F;
background-color: null;
font-style: inherit;">:</span></span>
<span id="cb11-35"><span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">  </span><span class="kw" style="color: #003B4F;
background-color: null;
font-style: inherit;">-</span><span class="at" style="color: #657422;
background-color: null;
font-style: inherit;"> </span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">name</span><span class="kw" style="color: #003B4F;
background-color: null;
font-style: inherit;">:</span><span class="at" style="color: #657422;
background-color: null;
font-style: inherit;"> v1</span></span>
<span id="cb11-36"><span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">    </span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">labels</span><span class="kw" style="color: #003B4F;
background-color: null;
font-style: inherit;">:</span></span>
<span id="cb11-37"><span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">      </span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">version</span><span class="kw" style="color: #003B4F;
background-color: null;
font-style: inherit;">:</span><span class="at" style="color: #657422;
background-color: null;
font-style: inherit;"> stable</span></span>
<span id="cb11-38"><span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">  </span><span class="kw" style="color: #003B4F;
background-color: null;
font-style: inherit;">-</span><span class="at" style="color: #657422;
background-color: null;
font-style: inherit;"> </span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">name</span><span class="kw" style="color: #003B4F;
background-color: null;
font-style: inherit;">:</span><span class="at" style="color: #657422;
background-color: null;
font-style: inherit;"> v2</span></span>
<span id="cb11-39"><span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">    </span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">labels</span><span class="kw" style="color: #003B4F;
background-color: null;
font-style: inherit;">:</span></span>
<span id="cb11-40"><span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">      </span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">version</span><span class="kw" style="color: #003B4F;
background-color: null;
font-style: inherit;">:</span><span class="at" style="color: #657422;
background-color: null;
font-style: inherit;"> canary</span></span></code></pre></div>
</section>
<section id="자동-canary-진행-스크립트" class="level3" data-number="3.2.3">
<h3 data-number="3.2.3" class="anchored" data-anchor-id="자동-canary-진행-스크립트"><span class="header-section-number">3.2.3</span> 자동 Canary 진행 스크립트</h3>
<div class="sourceCode" id="cb12" style="background: #f1f3f5;"><pre class="sourceCode numberSource python number-lines code-with-copy"><code class="sourceCode python"><span id="cb12-1"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># scripts/canary_rollout.py</span></span>
<span id="cb12-2"><span class="im" style="color: #00769E;
background-color: null;
font-style: inherit;">import</span> time</span>
<span id="cb12-3"><span class="im" style="color: #00769E;
background-color: null;
font-style: inherit;">import</span> requests</span>
<span id="cb12-4"><span class="im" style="color: #00769E;
background-color: null;
font-style: inherit;">from</span> typing <span class="im" style="color: #00769E;
background-color: null;
font-style: inherit;">import</span> Dict, Any</span>
<span id="cb12-5"></span>
<span id="cb12-6"><span class="kw" style="color: #003B4F;
background-color: null;
font-style: inherit;">class</span> CanaryRollout:</span>
<span id="cb12-7">    <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">"""자동 Canary 배포</span></span>
<span id="cb12-8"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">    </span></span>
<span id="cb12-9"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">    단계:</span></span>
<span id="cb12-10"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">    1. 10% → 5분 모니터링</span></span>
<span id="cb12-11"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">    2. 25% → 10분 모니터링</span></span>
<span id="cb12-12"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">    3. 50% → 15분 모니터링</span></span>
<span id="cb12-13"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">    4. 100% → Stable로 승격</span></span>
<span id="cb12-14"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">    """</span></span>
<span id="cb12-15">    </span>
<span id="cb12-16">    STAGES <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> [</span>
<span id="cb12-17">        {<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">'percentage'</span>: <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">10</span>, <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">'duration'</span>: <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">300</span>},   <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># 5분</span></span>
<span id="cb12-18">        {<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">'percentage'</span>: <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">25</span>, <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">'duration'</span>: <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">600</span>},   <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># 10분</span></span>
<span id="cb12-19">        {<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">'percentage'</span>: <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">50</span>, <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">'duration'</span>: <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">900</span>},   <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># 15분</span></span>
<span id="cb12-20">        {<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">'percentage'</span>: <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">100</span>, <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">'duration'</span>: <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">0</span>}</span>
<span id="cb12-21">    ]</span>
<span id="cb12-22">    </span>
<span id="cb12-23">    <span class="kw" style="color: #003B4F;
background-color: null;
font-style: inherit;">def</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">__init__</span>(</span>
<span id="cb12-24">        <span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">self</span>,</span>
<span id="cb12-25">        prometheus_url: <span class="bu" style="color: null;
background-color: null;
font-style: inherit;">str</span>,</span>
<span id="cb12-26">        k8s_api: <span class="bu" style="color: null;
background-color: null;
font-style: inherit;">str</span>,</span>
<span id="cb12-27">        error_threshold: <span class="bu" style="color: null;
background-color: null;
font-style: inherit;">float</span> <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> <span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">0.01</span></span>
<span id="cb12-28">    ):</span>
<span id="cb12-29">        <span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">self</span>.prometheus_url <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> prometheus_url</span>
<span id="cb12-30">        <span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">self</span>.k8s_api <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> k8s_api</span>
<span id="cb12-31">        <span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">self</span>.error_threshold <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> error_threshold</span>
<span id="cb12-32">    </span>
<span id="cb12-33">    <span class="kw" style="color: #003B4F;
background-color: null;
font-style: inherit;">def</span> update_traffic_weight(<span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">self</span>, canary_percentage: <span class="bu" style="color: null;
background-color: null;
font-style: inherit;">int</span>):</span>
<span id="cb12-34">        <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">"""트래픽 비율 업데이트"""</span></span>
<span id="cb12-35">        stable_weight <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">100</span> <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">-</span> canary_percentage</span>
<span id="cb12-36">        </span>
<span id="cb12-37">        <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># Istio VirtualService 업데이트</span></span>
<span id="cb12-38">        patch <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> {</span>
<span id="cb12-39">            <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">'spec'</span>: {</span>
<span id="cb12-40">                <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">'http'</span>: [{</span>
<span id="cb12-41">                    <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">'route'</span>: [</span>
<span id="cb12-42">                        {<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">'destination'</span>: {<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">'subset'</span>: <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">'v1'</span>}, <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">'weight'</span>: stable_weight},</span>
<span id="cb12-43">                        {<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">'destination'</span>: {<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">'subset'</span>: <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">'v2'</span>}, <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">'weight'</span>: canary_percentage}</span>
<span id="cb12-44">                    ]</span>
<span id="cb12-45">                }]</span>
<span id="cb12-46">            }</span>
<span id="cb12-47">        }</span>
<span id="cb12-48">        </span>
<span id="cb12-49">        response <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> requests.patch(</span>
<span id="cb12-50">            <span class="ss" style="color: #20794D;
background-color: null;
font-style: inherit;">f"</span><span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">{</span><span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">self</span><span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">.</span>k8s_api<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">}</span><span class="ss" style="color: #20794D;
background-color: null;
font-style: inherit;">/virtualservices/agent-platform"</span>,</span>
<span id="cb12-51">            json<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span>patch</span>
<span id="cb12-52">        )</span>
<span id="cb12-53">        response.raise_for_status()</span>
<span id="cb12-54">        </span>
<span id="cb12-55">        <span class="bu" style="color: null;
background-color: null;
font-style: inherit;">print</span>(<span class="ss" style="color: #20794D;
background-color: null;
font-style: inherit;">f"✅ Traffic updated: Stable </span><span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">{</span>stable_weight<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">}</span><span class="ss" style="color: #20794D;
background-color: null;
font-style: inherit;">%, Canary </span><span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">{</span>canary_percentage<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">}</span><span class="ss" style="color: #20794D;
background-color: null;
font-style: inherit;">%"</span>)</span>
<span id="cb12-56">    </span>
<span id="cb12-57">    <span class="kw" style="color: #003B4F;
background-color: null;
font-style: inherit;">def</span> get_error_rate(<span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">self</span>, version: <span class="bu" style="color: null;
background-color: null;
font-style: inherit;">str</span>) <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">-&gt;</span> <span class="bu" style="color: null;
background-color: null;
font-style: inherit;">float</span>:</span>
<span id="cb12-58">        <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">"""에러율 조회"""</span></span>
<span id="cb12-59">        query <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> <span class="ss" style="color: #20794D;
background-color: null;
font-style: inherit;">f'rate(http_requests_total</span><span class="ch" style="color: #20794D;
background-color: null;
font-style: inherit;">{{</span><span class="ss" style="color: #20794D;
background-color: null;
font-style: inherit;">version="</span><span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">{</span>version<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">}</span><span class="ss" style="color: #20794D;
background-color: null;
font-style: inherit;">",status=~"5.."</span><span class="ch" style="color: #20794D;
background-color: null;
font-style: inherit;">}}</span><span class="ss" style="color: #20794D;
background-color: null;
font-style: inherit;">[5m])'</span></span>
<span id="cb12-60">        </span>
<span id="cb12-61">        response <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> requests.get(</span>
<span id="cb12-62">            <span class="ss" style="color: #20794D;
background-color: null;
font-style: inherit;">f"</span><span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">{</span><span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">self</span><span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">.</span>prometheus_url<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">}</span><span class="ss" style="color: #20794D;
background-color: null;
font-style: inherit;">/api/v1/query"</span>,</span>
<span id="cb12-63">            params<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span>{<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">'query'</span>: query}</span>
<span id="cb12-64">        )</span>
<span id="cb12-65">        </span>
<span id="cb12-66">        data <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> response.json()</span>
<span id="cb12-67">        <span class="cf" style="color: #003B4F;
background-color: null;
font-style: inherit;">if</span> data[<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">'data'</span>][<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">'result'</span>]:</span>
<span id="cb12-68">            <span class="cf" style="color: #003B4F;
background-color: null;
font-style: inherit;">return</span> <span class="bu" style="color: null;
background-color: null;
font-style: inherit;">float</span>(data[<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">'data'</span>][<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">'result'</span>][<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">0</span>][<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">'value'</span>][<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span>])</span>
<span id="cb12-69">        <span class="cf" style="color: #003B4F;
background-color: null;
font-style: inherit;">return</span> <span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">0.0</span></span>
<span id="cb12-70">    </span>
<span id="cb12-71">    <span class="kw" style="color: #003B4F;
background-color: null;
font-style: inherit;">def</span> get_latency_p95(<span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">self</span>, version: <span class="bu" style="color: null;
background-color: null;
font-style: inherit;">str</span>) <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">-&gt;</span> <span class="bu" style="color: null;
background-color: null;
font-style: inherit;">float</span>:</span>
<span id="cb12-72">        <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">"""P95 레이턴시 조회"""</span></span>
<span id="cb12-73">        query <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> <span class="ss" style="color: #20794D;
background-color: null;
font-style: inherit;">f'histogram_quantile(0.95, rate(http_request_duration_seconds_bucket</span><span class="ch" style="color: #20794D;
background-color: null;
font-style: inherit;">{{</span><span class="ss" style="color: #20794D;
background-color: null;
font-style: inherit;">version="</span><span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">{</span>version<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">}</span><span class="ss" style="color: #20794D;
background-color: null;
font-style: inherit;">"</span><span class="ch" style="color: #20794D;
background-color: null;
font-style: inherit;">}}</span><span class="ss" style="color: #20794D;
background-color: null;
font-style: inherit;">[5m]))'</span></span>
<span id="cb12-74">        </span>
<span id="cb12-75">        response <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> requests.get(</span>
<span id="cb12-76">            <span class="ss" style="color: #20794D;
background-color: null;
font-style: inherit;">f"</span><span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">{</span><span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">self</span><span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">.</span>prometheus_url<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">}</span><span class="ss" style="color: #20794D;
background-color: null;
font-style: inherit;">/api/v1/query"</span>,</span>
<span id="cb12-77">            params<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span>{<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">'query'</span>: query}</span>
<span id="cb12-78">        )</span>
<span id="cb12-79">        </span>
<span id="cb12-80">        data <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> response.json()</span>
<span id="cb12-81">        <span class="cf" style="color: #003B4F;
background-color: null;
font-style: inherit;">if</span> data[<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">'data'</span>][<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">'result'</span>]:</span>
<span id="cb12-82">            <span class="cf" style="color: #003B4F;
background-color: null;
font-style: inherit;">return</span> <span class="bu" style="color: null;
background-color: null;
font-style: inherit;">float</span>(data[<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">'data'</span>][<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">'result'</span>][<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">0</span>][<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">'value'</span>][<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span>])</span>
<span id="cb12-83">        <span class="cf" style="color: #003B4F;
background-color: null;
font-style: inherit;">return</span> <span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">0.0</span></span>
<span id="cb12-84">    </span>
<span id="cb12-85">    <span class="kw" style="color: #003B4F;
background-color: null;
font-style: inherit;">def</span> check_health(<span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">self</span>, version: <span class="bu" style="color: null;
background-color: null;
font-style: inherit;">str</span>) <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">-&gt;</span> Dict[<span class="bu" style="color: null;
background-color: null;
font-style: inherit;">str</span>, Any]:</span>
<span id="cb12-86">        <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">"""Canary 상태 확인"""</span></span>
<span id="cb12-87">        error_rate <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> <span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">self</span>.get_error_rate(version)</span>
<span id="cb12-88">        latency_p95 <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> <span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">self</span>.get_latency_p95(version)</span>
<span id="cb12-89">        </span>
<span id="cb12-90">        stable_error_rate <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> <span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">self</span>.get_error_rate(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">'stable'</span>)</span>
<span id="cb12-91">        stable_latency <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> <span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">self</span>.get_latency_p95(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">'stable'</span>)</span>
<span id="cb12-92">        </span>
<span id="cb12-93">        health <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> {</span>
<span id="cb12-94">            <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">'error_rate'</span>: error_rate,</span>
<span id="cb12-95">            <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">'latency_p95'</span>: latency_p95,</span>
<span id="cb12-96">            <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">'error_rate_delta'</span>: error_rate <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">-</span> stable_error_rate,</span>
<span id="cb12-97">            <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">'latency_delta'</span>: latency_p95 <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">-</span> stable_latency,</span>
<span id="cb12-98">            <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">'healthy'</span>: <span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">True</span></span>
<span id="cb12-99">        }</span>
<span id="cb12-100">        </span>
<span id="cb12-101">        <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># Health check 조건</span></span>
<span id="cb12-102">        <span class="cf" style="color: #003B4F;
background-color: null;
font-style: inherit;">if</span> error_rate <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">&gt;</span> <span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">self</span>.error_threshold:</span>
<span id="cb12-103">            health[<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">'healthy'</span>] <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> <span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">False</span></span>
<span id="cb12-104">            health[<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">'reason'</span>] <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> <span class="ss" style="color: #20794D;
background-color: null;
font-style: inherit;">f"High error rate: </span><span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">{</span>error_rate<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">:.4f}</span><span class="ss" style="color: #20794D;
background-color: null;
font-style: inherit;">"</span></span>
<span id="cb12-105">        </span>
<span id="cb12-106">        <span class="cf" style="color: #003B4F;
background-color: null;
font-style: inherit;">if</span> latency_p95 <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">&gt;</span> stable_latency <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">*</span> <span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">1.5</span>:</span>
<span id="cb12-107">            health[<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">'healthy'</span>] <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> <span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">False</span></span>
<span id="cb12-108">            health[<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">'reason'</span>] <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> <span class="ss" style="color: #20794D;
background-color: null;
font-style: inherit;">f"High latency: </span><span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">{</span>latency_p95<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">:.2f}</span><span class="ss" style="color: #20794D;
background-color: null;
font-style: inherit;">s"</span></span>
<span id="cb12-109">        </span>
<span id="cb12-110">        <span class="cf" style="color: #003B4F;
background-color: null;
font-style: inherit;">return</span> health</span>
<span id="cb12-111">    </span>
<span id="cb12-112">    <span class="kw" style="color: #003B4F;
background-color: null;
font-style: inherit;">def</span> rollout(<span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">self</span>):</span>
<span id="cb12-113">        <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">"""Canary 배포 실행"""</span></span>
<span id="cb12-114">        <span class="bu" style="color: null;
background-color: null;
font-style: inherit;">print</span>(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"🚀 Starting Canary rollout..."</span>)</span>
<span id="cb12-115">        </span>
<span id="cb12-116">        <span class="cf" style="color: #003B4F;
background-color: null;
font-style: inherit;">for</span> stage <span class="kw" style="color: #003B4F;
background-color: null;
font-style: inherit;">in</span> <span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">self</span>.STAGES:</span>
<span id="cb12-117">            percentage <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> stage[<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">'percentage'</span>]</span>
<span id="cb12-118">            duration <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> stage[<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">'duration'</span>]</span>
<span id="cb12-119">            </span>
<span id="cb12-120">            <span class="bu" style="color: null;
background-color: null;
font-style: inherit;">print</span>(<span class="ss" style="color: #20794D;
background-color: null;
font-style: inherit;">f"</span><span class="ch" style="color: #20794D;
background-color: null;
font-style: inherit;">\n</span><span class="ss" style="color: #20794D;
background-color: null;
font-style: inherit;">📊 Stage: </span><span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">{</span>percentage<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">}</span><span class="ss" style="color: #20794D;
background-color: null;
font-style: inherit;">% traffic to Canary"</span>)</span>
<span id="cb12-121">            </span>
<span id="cb12-122">            <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># 트래픽 비율 업데이트</span></span>
<span id="cb12-123">            <span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">self</span>.update_traffic_weight(percentage)</span>
<span id="cb12-124">            </span>
<span id="cb12-125">            <span class="cf" style="color: #003B4F;
background-color: null;
font-style: inherit;">if</span> duration <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">&gt;</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">0</span>:</span>
<span id="cb12-126">                <span class="bu" style="color: null;
background-color: null;
font-style: inherit;">print</span>(<span class="ss" style="color: #20794D;
background-color: null;
font-style: inherit;">f"⏳ Monitoring for </span><span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">{</span>duration<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">}</span><span class="ss" style="color: #20794D;
background-color: null;
font-style: inherit;">s..."</span>)</span>
<span id="cb12-127">                </span>
<span id="cb12-128">                <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># 1분마다 Health check</span></span>
<span id="cb12-129">                <span class="cf" style="color: #003B4F;
background-color: null;
font-style: inherit;">for</span> i <span class="kw" style="color: #003B4F;
background-color: null;
font-style: inherit;">in</span> <span class="bu" style="color: null;
background-color: null;
font-style: inherit;">range</span>(duration <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">//</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">60</span>):</span>
<span id="cb12-130">                    time.sleep(<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">60</span>)</span>
<span id="cb12-131">                    </span>
<span id="cb12-132">                    health <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> <span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">self</span>.check_health(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">'canary'</span>)</span>
<span id="cb12-133">                    <span class="bu" style="color: null;
background-color: null;
font-style: inherit;">print</span>(<span class="ss" style="color: #20794D;
background-color: null;
font-style: inherit;">f"   [</span><span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">{</span>i<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span><span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">}</span><span class="ss" style="color: #20794D;
background-color: null;
font-style: inherit;">/</span><span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">{</span>duration<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">//</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">60</span><span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">}</span><span class="ss" style="color: #20794D;
background-color: null;
font-style: inherit;">] Error: </span><span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">{</span>health[<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">'error_rate'</span>]<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">:.4f}</span><span class="ss" style="color: #20794D;
background-color: null;
font-style: inherit;">, "</span></span>
<span id="cb12-134">                          <span class="ss" style="color: #20794D;
background-color: null;
font-style: inherit;">f"Latency: </span><span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">{</span>health[<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">'latency_p95'</span>]<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">:.2f}</span><span class="ss" style="color: #20794D;
background-color: null;
font-style: inherit;">s"</span>)</span>
<span id="cb12-135">                    </span>
<span id="cb12-136">                    <span class="cf" style="color: #003B4F;
background-color: null;
font-style: inherit;">if</span> <span class="kw" style="color: #003B4F;
background-color: null;
font-style: inherit;">not</span> health[<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">'healthy'</span>]:</span>
<span id="cb12-137">                        <span class="bu" style="color: null;
background-color: null;
font-style: inherit;">print</span>(<span class="ss" style="color: #20794D;
background-color: null;
font-style: inherit;">f"❌ Canary unhealthy: </span><span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">{</span>health[<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">'reason'</span>]<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">}</span><span class="ss" style="color: #20794D;
background-color: null;
font-style: inherit;">"</span>)</span>
<span id="cb12-138">                        <span class="bu" style="color: null;
background-color: null;
font-style: inherit;">print</span>(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"🔙 Rolling back..."</span>)</span>
<span id="cb12-139">                        <span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">self</span>.rollback()</span>
<span id="cb12-140">                        <span class="cf" style="color: #003B4F;
background-color: null;
font-style: inherit;">return</span> <span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">False</span></span>
<span id="cb12-141">        </span>
<span id="cb12-142">        <span class="bu" style="color: null;
background-color: null;
font-style: inherit;">print</span>(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"</span><span class="ch" style="color: #20794D;
background-color: null;
font-style: inherit;">\n</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">✅ Canary rollout completed successfully!"</span>)</span>
<span id="cb12-143">        <span class="cf" style="color: #003B4F;
background-color: null;
font-style: inherit;">return</span> <span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">True</span></span>
<span id="cb12-144">    </span>
<span id="cb12-145">    <span class="kw" style="color: #003B4F;
background-color: null;
font-style: inherit;">def</span> rollback(<span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">self</span>):</span>
<span id="cb12-146">        <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">"""롤백 (Stable 100%)"""</span></span>
<span id="cb12-147">        <span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">self</span>.update_traffic_weight(<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">0</span>)</span>
<span id="cb12-148">        <span class="bu" style="color: null;
background-color: null;
font-style: inherit;">print</span>(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"✅ Rolled back to Stable version"</span>)</span>
<span id="cb12-149"></span>
<span id="cb12-150"><span class="cf" style="color: #003B4F;
background-color: null;
font-style: inherit;">if</span> <span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">__name__</span> <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">==</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"__main__"</span>:</span>
<span id="cb12-151">    rollout <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> CanaryRollout(</span>
<span id="cb12-152">        prometheus_url<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"http://prometheus:9090"</span>,</span>
<span id="cb12-153">        k8s_api<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"http://kubernetes/api/v1"</span>,</span>
<span id="cb12-154">        error_threshold<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span><span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">0.01</span></span>
<span id="cb12-155">    )</span>
<span id="cb12-156">    </span>
<span id="cb12-157">    success <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> rollout.rollout()</span>
<span id="cb12-158">    exit(<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">0</span> <span class="cf" style="color: #003B4F;
background-color: null;
font-style: inherit;">if</span> success <span class="cf" style="color: #003B4F;
background-color: null;
font-style: inherit;">else</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span>)</span></code></pre></div>
</section>
</section>
</section>
<section id="모니터링-시스템" class="level1" data-number="4">
<h1 data-number="4"><span class="header-section-number">4</span> 모니터링 시스템</h1>
<section id="prometheus-메트릭" class="level2" data-number="4.1">
<h2 data-number="4.1" class="anchored" data-anchor-id="prometheus-메트릭"><span class="header-section-number">4.1</span> Prometheus 메트릭</h2>
<section id="메트릭-수집기" class="level3" data-number="4.1.1">
<h3 data-number="4.1.1" class="anchored" data-anchor-id="메트릭-수집기"><span class="header-section-number">4.1.1</span> 메트릭 수집기</h3>
<div class="sourceCode" id="cb13" style="background: #f1f3f5;"><pre class="sourceCode numberSource python number-lines code-with-copy"><code class="sourceCode python"><span id="cb13-1"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># shared/monitoring/metrics.py</span></span>
<span id="cb13-2"><span class="im" style="color: #00769E;
background-color: null;
font-style: inherit;">from</span> prometheus_client <span class="im" style="color: #00769E;
background-color: null;
font-style: inherit;">import</span> Counter, Histogram, Gauge, start_http_server</span>
<span id="cb13-3"><span class="im" style="color: #00769E;
background-color: null;
font-style: inherit;">from</span> functools <span class="im" style="color: #00769E;
background-color: null;
font-style: inherit;">import</span> wraps</span>
<span id="cb13-4"><span class="im" style="color: #00769E;
background-color: null;
font-style: inherit;">import</span> time</span>
<span id="cb13-5"></span>
<span id="cb13-6"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># 메트릭 정의</span></span>
<span id="cb13-7">agent_requests_total <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> Counter(</span>
<span id="cb13-8">    <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">'agent_requests_total'</span>,</span>
<span id="cb13-9">    <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">'Total number of agent requests'</span>,</span>
<span id="cb13-10">    [<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">'agent_name'</span>, <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">'status'</span>]</span>
<span id="cb13-11">)</span>
<span id="cb13-12"></span>
<span id="cb13-13">agent_duration_seconds <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> Histogram(</span>
<span id="cb13-14">    <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">'agent_duration_seconds'</span>,</span>
<span id="cb13-15">    <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">'Agent execution duration in seconds'</span>,</span>
<span id="cb13-16">    [<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">'agent_name'</span>],</span>
<span id="cb13-17">    buckets<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span>[<span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">0.1</span>, <span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">0.5</span>, <span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">1.0</span>, <span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">2.0</span>, <span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">5.0</span>, <span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">10.0</span>, <span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">30.0</span>, <span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">60.0</span>]</span>
<span id="cb13-18">)</span>
<span id="cb13-19"></span>
<span id="cb13-20">agent_confidence <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> Histogram(</span>
<span id="cb13-21">    <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">'agent_confidence'</span>,</span>
<span id="cb13-22">    <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">'Agent confidence score'</span>,</span>
<span id="cb13-23">    [<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">'agent_name'</span>],</span>
<span id="cb13-24">    buckets<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span>[<span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">0.5</span>, <span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">0.6</span>, <span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">0.7</span>, <span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">0.8</span>, <span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">0.9</span>, <span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">0.95</span>, <span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">0.99</span>, <span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">1.0</span>]</span>
<span id="cb13-25">)</span>
<span id="cb13-26"></span>
<span id="cb13-27">llm_tokens_total <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> Counter(</span>
<span id="cb13-28">    <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">'llm_tokens_total'</span>,</span>
<span id="cb13-29">    <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">'Total LLM tokens used'</span>,</span>
<span id="cb13-30">    [<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">'agent_name'</span>, <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">'provider'</span>, <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">'model'</span>]</span>
<span id="cb13-31">)</span>
<span id="cb13-32"></span>
<span id="cb13-33">llm_cost_total <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> Counter(</span>
<span id="cb13-34">    <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">'llm_cost_total'</span>,</span>
<span id="cb13-35">    <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">'Total LLM cost in USD'</span>,</span>
<span id="cb13-36">    [<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">'agent_name'</span>, <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">'provider'</span>]</span>
<span id="cb13-37">)</span>
<span id="cb13-38"></span>
<span id="cb13-39">active_agents <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> Gauge(</span>
<span id="cb13-40">    <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">'active_agents'</span>,</span>
<span id="cb13-41">    <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">'Number of currently active agents'</span>,</span>
<span id="cb13-42">    [<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">'agent_name'</span>]</span>
<span id="cb13-43">)</span>
<span id="cb13-44"></span>
<span id="cb13-45"><span class="kw" style="color: #003B4F;
background-color: null;
font-style: inherit;">class</span> MetricsCollector:</span>
<span id="cb13-46">    <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">"""메트릭 수집"""</span></span>
<span id="cb13-47">    </span>
<span id="cb13-48">    <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">@staticmethod</span></span>
<span id="cb13-49">    <span class="kw" style="color: #003B4F;
background-color: null;
font-style: inherit;">def</span> track_agent_execution(agent_name: <span class="bu" style="color: null;
background-color: null;
font-style: inherit;">str</span>):</span>
<span id="cb13-50">        <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">"""Agent 실행 추적 데코레이터"""</span></span>
<span id="cb13-51">        <span class="kw" style="color: #003B4F;
background-color: null;
font-style: inherit;">def</span> decorator(func):</span>
<span id="cb13-52">            <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">@wraps</span>(func)</span>
<span id="cb13-53">            <span class="kw" style="color: #003B4F;
background-color: null;
font-style: inherit;">def</span> wrapper(<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">*</span>args, <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">**</span>kwargs):</span>
<span id="cb13-54">                <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># 활성 Agent 증가</span></span>
<span id="cb13-55">                active_agents.labels(agent_name<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span>agent_name).inc()</span>
<span id="cb13-56">                </span>
<span id="cb13-57">                start <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> time.time()</span>
<span id="cb13-58">                status <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">'success'</span></span>
<span id="cb13-59">                </span>
<span id="cb13-60">                <span class="cf" style="color: #003B4F;
background-color: null;
font-style: inherit;">try</span>:</span>
<span id="cb13-61">                    result <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> func(<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">*</span>args, <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">**</span>kwargs)</span>
<span id="cb13-62">                    </span>
<span id="cb13-63">                    <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># 신뢰도 기록</span></span>
<span id="cb13-64">                    confidence <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> result.get(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">'confidence'</span>, <span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">0.0</span>)</span>
<span id="cb13-65">                    agent_confidence.labels(agent_name<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span>agent_name).observe(confidence)</span>
<span id="cb13-66">                    </span>
<span id="cb13-67">                    <span class="cf" style="color: #003B4F;
background-color: null;
font-style: inherit;">return</span> result</span>
<span id="cb13-68">                    </span>
<span id="cb13-69">                <span class="cf" style="color: #003B4F;
background-color: null;
font-style: inherit;">except</span> <span class="pp" style="color: #AD0000;
background-color: null;
font-style: inherit;">Exception</span> <span class="im" style="color: #00769E;
background-color: null;
font-style: inherit;">as</span> e:</span>
<span id="cb13-70">                    status <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">'failure'</span></span>
<span id="cb13-71">                    <span class="cf" style="color: #003B4F;
background-color: null;
font-style: inherit;">raise</span></span>
<span id="cb13-72">                </span>
<span id="cb13-73">                <span class="cf" style="color: #003B4F;
background-color: null;
font-style: inherit;">finally</span>:</span>
<span id="cb13-74">                    <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># 실행 시간 기록</span></span>
<span id="cb13-75">                    duration <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> time.time() <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">-</span> start</span>
<span id="cb13-76">                    agent_duration_seconds.labels(agent_name<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span>agent_name).observe(duration)</span>
<span id="cb13-77">                    </span>
<span id="cb13-78">                    <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># 요청 수 기록</span></span>
<span id="cb13-79">                    agent_requests_total.labels(</span>
<span id="cb13-80">                        agent_name<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span>agent_name,</span>
<span id="cb13-81">                        status<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span>status</span>
<span id="cb13-82">                    ).inc()</span>
<span id="cb13-83">                    </span>
<span id="cb13-84">                    <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># 활성 Agent 감소</span></span>
<span id="cb13-85">                    active_agents.labels(agent_name<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span>agent_name).dec()</span>
<span id="cb13-86">            </span>
<span id="cb13-87">            <span class="cf" style="color: #003B4F;
background-color: null;
font-style: inherit;">return</span> wrapper</span>
<span id="cb13-88">        <span class="cf" style="color: #003B4F;
background-color: null;
font-style: inherit;">return</span> decorator</span>
<span id="cb13-89">    </span>
<span id="cb13-90">    <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">@staticmethod</span></span>
<span id="cb13-91">    <span class="kw" style="color: #003B4F;
background-color: null;
font-style: inherit;">def</span> track_llm_usage(agent_name: <span class="bu" style="color: null;
background-color: null;
font-style: inherit;">str</span>, provider: <span class="bu" style="color: null;
background-color: null;
font-style: inherit;">str</span>, model: <span class="bu" style="color: null;
background-color: null;
font-style: inherit;">str</span>, tokens: <span class="bu" style="color: null;
background-color: null;
font-style: inherit;">int</span>, cost: <span class="bu" style="color: null;
background-color: null;
font-style: inherit;">float</span>):</span>
<span id="cb13-92">        <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">"""LLM 사용량 기록"""</span></span>
<span id="cb13-93">        llm_tokens_total.labels(</span>
<span id="cb13-94">            agent_name<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span>agent_name,</span>
<span id="cb13-95">            provider<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span>provider,</span>
<span id="cb13-96">            model<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span>model</span>
<span id="cb13-97">        ).inc(tokens)</span>
<span id="cb13-98">        </span>
<span id="cb13-99">        llm_cost_total.labels(</span>
<span id="cb13-100">            agent_name<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span>agent_name,</span>
<span id="cb13-101">            provider<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span>provider</span>
<span id="cb13-102">        ).inc(cost)</span>
<span id="cb13-103"></span>
<span id="cb13-104"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># BaseAgent에 통합</span></span>
<span id="cb13-105"><span class="kw" style="color: #003B4F;
background-color: null;
font-style: inherit;">class</span> BaseAgent(ABC):</span>
<span id="cb13-106">    <span class="kw" style="color: #003B4F;
background-color: null;
font-style: inherit;">def</span> execute(<span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">self</span>, <span class="bu" style="color: null;
background-color: null;
font-style: inherit;">input</span>: Dict[<span class="bu" style="color: null;
background-color: null;
font-style: inherit;">str</span>, Any]) <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">-&gt;</span> Dict[<span class="bu" style="color: null;
background-color: null;
font-style: inherit;">str</span>, Any]:</span>
<span id="cb13-107">        <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">"""메트릭 자동 수집"""</span></span>
<span id="cb13-108">        </span>
<span id="cb13-109">        <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">@MetricsCollector.track_agent_execution</span>(<span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">self</span>.metadata.name)</span>
<span id="cb13-110">        <span class="kw" style="color: #003B4F;
background-color: null;
font-style: inherit;">def</span> _execute_with_metrics():</span>
<span id="cb13-111">            <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># 기존 로직</span></span>
<span id="cb13-112">            result <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> <span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">self</span>.process(<span class="bu" style="color: null;
background-color: null;
font-style: inherit;">input</span>)</span>
<span id="cb13-113">            </span>
<span id="cb13-114">            <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># LLM 사용량 기록</span></span>
<span id="cb13-115">            <span class="cf" style="color: #003B4F;
background-color: null;
font-style: inherit;">if</span> <span class="bu" style="color: null;
background-color: null;
font-style: inherit;">hasattr</span>(<span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">self</span>, <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">'llm'</span>):</span>
<span id="cb13-116">                stats <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> <span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">self</span>.llm.get_stats()</span>
<span id="cb13-117">                MetricsCollector.track_llm_usage(</span>
<span id="cb13-118">                    agent_name<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span><span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">self</span>.metadata.name,</span>
<span id="cb13-119">                    provider<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span><span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">self</span>.llm.provider,</span>
<span id="cb13-120">                    model<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span><span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">self</span>.llm.model,</span>
<span id="cb13-121">                    tokens<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span>stats[<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">'total_tokens'</span>],</span>
<span id="cb13-122">                    cost<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span>stats[<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">'total_cost'</span>]</span>
<span id="cb13-123">                )</span>
<span id="cb13-124">            </span>
<span id="cb13-125">            <span class="cf" style="color: #003B4F;
background-color: null;
font-style: inherit;">return</span> result</span>
<span id="cb13-126">        </span>
<span id="cb13-127">        <span class="cf" style="color: #003B4F;
background-color: null;
font-style: inherit;">return</span> _execute_with_metrics()</span>
<span id="cb13-128"></span>
<span id="cb13-129"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># 메트릭 서버 시작</span></span>
<span id="cb13-130"><span class="kw" style="color: #003B4F;
background-color: null;
font-style: inherit;">def</span> start_metrics_server(port: <span class="bu" style="color: null;
background-color: null;
font-style: inherit;">int</span> <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">9090</span>):</span>
<span id="cb13-131">    <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">"""Prometheus 메트릭 서버 시작"""</span></span>
<span id="cb13-132">    start_http_server(port)</span>
<span id="cb13-133">    <span class="bu" style="color: null;
background-color: null;
font-style: inherit;">print</span>(<span class="ss" style="color: #20794D;
background-color: null;
font-style: inherit;">f"📊 Metrics server started on port </span><span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">{</span>port<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">}</span><span class="ss" style="color: #20794D;
background-color: null;
font-style: inherit;">"</span>)</span></code></pre></div>
</section>
<section id="prometheus-설정" class="level3" data-number="4.1.2">
<h3 data-number="4.1.2" class="anchored" data-anchor-id="prometheus-설정"><span class="header-section-number">4.1.2</span> Prometheus 설정</h3>
<div class="sourceCode" id="cb14" style="background: #f1f3f5;"><pre class="sourceCode numberSource yaml number-lines code-with-copy"><code class="sourceCode yaml"><span id="cb14-1"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># config/prometheus.yml</span></span>
<span id="cb14-2"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">global</span><span class="kw" style="color: #003B4F;
background-color: null;
font-style: inherit;">:</span></span>
<span id="cb14-3"><span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">  </span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">scrape_interval</span><span class="kw" style="color: #003B4F;
background-color: null;
font-style: inherit;">:</span><span class="at" style="color: #657422;
background-color: null;
font-style: inherit;"> 15s</span></span>
<span id="cb14-4"><span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">  </span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">evaluation_interval</span><span class="kw" style="color: #003B4F;
background-color: null;
font-style: inherit;">:</span><span class="at" style="color: #657422;
background-color: null;
font-style: inherit;"> 15s</span></span>
<span id="cb14-5"></span>
<span id="cb14-6"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">scrape_configs</span><span class="kw" style="color: #003B4F;
background-color: null;
font-style: inherit;">:</span></span>
<span id="cb14-7"><span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">  </span><span class="kw" style="color: #003B4F;
background-color: null;
font-style: inherit;">-</span><span class="at" style="color: #657422;
background-color: null;
font-style: inherit;"> </span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">job_name</span><span class="kw" style="color: #003B4F;
background-color: null;
font-style: inherit;">:</span><span class="at" style="color: #657422;
background-color: null;
font-style: inherit;"> </span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">'agent-platform'</span></span>
<span id="cb14-8"><span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">    </span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">static_configs</span><span class="kw" style="color: #003B4F;
background-color: null;
font-style: inherit;">:</span></span>
<span id="cb14-9"><span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">      </span><span class="kw" style="color: #003B4F;
background-color: null;
font-style: inherit;">-</span><span class="at" style="color: #657422;
background-color: null;
font-style: inherit;"> </span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">targets</span><span class="kw" style="color: #003B4F;
background-color: null;
font-style: inherit;">:</span><span class="at" style="color: #657422;
background-color: null;
font-style: inherit;"> </span><span class="kw" style="color: #003B4F;
background-color: null;
font-style: inherit;">[</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">'platform-api:9090'</span><span class="kw" style="color: #003B4F;
background-color: null;
font-style: inherit;">]</span></span>
<span id="cb14-10"><span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">    </span></span>
<span id="cb14-11"><span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">  </span><span class="kw" style="color: #003B4F;
background-color: null;
font-style: inherit;">-</span><span class="at" style="color: #657422;
background-color: null;
font-style: inherit;"> </span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">job_name</span><span class="kw" style="color: #003B4F;
background-color: null;
font-style: inherit;">:</span><span class="at" style="color: #657422;
background-color: null;
font-style: inherit;"> </span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">'kubernetes-pods'</span></span>
<span id="cb14-12"><span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">    </span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">kubernetes_sd_configs</span><span class="kw" style="color: #003B4F;
background-color: null;
font-style: inherit;">:</span></span>
<span id="cb14-13"><span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">      </span><span class="kw" style="color: #003B4F;
background-color: null;
font-style: inherit;">-</span><span class="at" style="color: #657422;
background-color: null;
font-style: inherit;"> </span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">role</span><span class="kw" style="color: #003B4F;
background-color: null;
font-style: inherit;">:</span><span class="at" style="color: #657422;
background-color: null;
font-style: inherit;"> pod</span></span>
<span id="cb14-14"><span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">    </span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">relabel_configs</span><span class="kw" style="color: #003B4F;
background-color: null;
font-style: inherit;">:</span></span>
<span id="cb14-15"><span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">      </span><span class="kw" style="color: #003B4F;
background-color: null;
font-style: inherit;">-</span><span class="at" style="color: #657422;
background-color: null;
font-style: inherit;"> </span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">source_labels</span><span class="kw" style="color: #003B4F;
background-color: null;
font-style: inherit;">:</span><span class="at" style="color: #657422;
background-color: null;
font-style: inherit;"> </span><span class="kw" style="color: #003B4F;
background-color: null;
font-style: inherit;">[</span><span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">__meta_kubernetes_pod_annotation_prometheus_io_scrape</span><span class="kw" style="color: #003B4F;
background-color: null;
font-style: inherit;">]</span></span>
<span id="cb14-16"><span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">        </span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">action</span><span class="kw" style="color: #003B4F;
background-color: null;
font-style: inherit;">:</span><span class="at" style="color: #657422;
background-color: null;
font-style: inherit;"> keep</span></span>
<span id="cb14-17"><span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">        </span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">regex</span><span class="kw" style="color: #003B4F;
background-color: null;
font-style: inherit;">:</span><span class="at" style="color: #657422;
background-color: null;
font-style: inherit;"> </span><span class="ch" style="color: #20794D;
background-color: null;
font-style: inherit;">true</span></span>
<span id="cb14-18"><span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">      </span><span class="kw" style="color: #003B4F;
background-color: null;
font-style: inherit;">-</span><span class="at" style="color: #657422;
background-color: null;
font-style: inherit;"> </span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">source_labels</span><span class="kw" style="color: #003B4F;
background-color: null;
font-style: inherit;">:</span><span class="at" style="color: #657422;
background-color: null;
font-style: inherit;"> </span><span class="kw" style="color: #003B4F;
background-color: null;
font-style: inherit;">[</span><span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">__meta_kubernetes_pod_annotation_prometheus_io_port</span><span class="kw" style="color: #003B4F;
background-color: null;
font-style: inherit;">]</span></span>
<span id="cb14-19"><span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">        </span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">action</span><span class="kw" style="color: #003B4F;
background-color: null;
font-style: inherit;">:</span><span class="at" style="color: #657422;
background-color: null;
font-style: inherit;"> replace</span></span>
<span id="cb14-20"><span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">        </span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">target_label</span><span class="kw" style="color: #003B4F;
background-color: null;
font-style: inherit;">:</span><span class="at" style="color: #657422;
background-color: null;
font-style: inherit;"> __address__</span></span>
<span id="cb14-21"><span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">        </span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">regex</span><span class="kw" style="color: #003B4F;
background-color: null;
font-style: inherit;">:</span><span class="at" style="color: #657422;
background-color: null;
font-style: inherit;"> (.+):(?:\d+);(\d+)</span></span>
<span id="cb14-22"><span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">        </span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">replacement</span><span class="kw" style="color: #003B4F;
background-color: null;
font-style: inherit;">:</span><span class="at" style="color: #657422;
background-color: null;
font-style: inherit;"> ${1}:${2}</span></span>
<span id="cb14-23"></span>
<span id="cb14-24"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># 알림 규칙</span></span>
<span id="cb14-25"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">rule_files</span><span class="kw" style="color: #003B4F;
background-color: null;
font-style: inherit;">:</span></span>
<span id="cb14-26"><span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">  </span><span class="kw" style="color: #003B4F;
background-color: null;
font-style: inherit;">-</span><span class="at" style="color: #657422;
background-color: null;
font-style: inherit;"> </span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">'/etc/prometheus/rules/*.yml'</span></span>
<span id="cb14-27"></span>
<span id="cb14-28"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">alerting</span><span class="kw" style="color: #003B4F;
background-color: null;
font-style: inherit;">:</span></span>
<span id="cb14-29"><span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">  </span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">alertmanagers</span><span class="kw" style="color: #003B4F;
background-color: null;
font-style: inherit;">:</span></span>
<span id="cb14-30"><span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">    </span><span class="kw" style="color: #003B4F;
background-color: null;
font-style: inherit;">-</span><span class="at" style="color: #657422;
background-color: null;
font-style: inherit;"> </span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">static_configs</span><span class="kw" style="color: #003B4F;
background-color: null;
font-style: inherit;">:</span></span>
<span id="cb14-31"><span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">        </span><span class="kw" style="color: #003B4F;
background-color: null;
font-style: inherit;">-</span><span class="at" style="color: #657422;
background-color: null;
font-style: inherit;"> </span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">targets</span><span class="kw" style="color: #003B4F;
background-color: null;
font-style: inherit;">:</span><span class="at" style="color: #657422;
background-color: null;
font-style: inherit;"> </span><span class="kw" style="color: #003B4F;
background-color: null;
font-style: inherit;">[</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">'alertmanager:9093'</span><span class="kw" style="color: #003B4F;
background-color: null;
font-style: inherit;">]</span></span></code></pre></div>
</section>
<section id="알림-규칙" class="level3" data-number="4.1.3">
<h3 data-number="4.1.3" class="anchored" data-anchor-id="알림-규칙"><span class="header-section-number">4.1.3</span> 알림 규칙</h3>
<div class="sourceCode" id="cb15" style="background: #f1f3f5;"><pre class="sourceCode numberSource yaml number-lines code-with-copy"><code class="sourceCode yaml"><span id="cb15-1"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># config/prometheus/rules/agent-alerts.yml</span></span>
<span id="cb15-2"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">groups</span><span class="kw" style="color: #003B4F;
background-color: null;
font-style: inherit;">:</span></span>
<span id="cb15-3"><span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">  </span><span class="kw" style="color: #003B4F;
background-color: null;
font-style: inherit;">-</span><span class="at" style="color: #657422;
background-color: null;
font-style: inherit;"> </span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">name</span><span class="kw" style="color: #003B4F;
background-color: null;
font-style: inherit;">:</span><span class="at" style="color: #657422;
background-color: null;
font-style: inherit;"> agent-alerts</span></span>
<span id="cb15-4"><span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">    </span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">interval</span><span class="kw" style="color: #003B4F;
background-color: null;
font-style: inherit;">:</span><span class="at" style="color: #657422;
background-color: null;
font-style: inherit;"> 30s</span></span>
<span id="cb15-5"><span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">    </span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">rules</span><span class="kw" style="color: #003B4F;
background-color: null;
font-style: inherit;">:</span></span>
<span id="cb15-6"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">      # 에러율 높음</span></span>
<span id="cb15-7"><span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">      </span><span class="kw" style="color: #003B4F;
background-color: null;
font-style: inherit;">-</span><span class="at" style="color: #657422;
background-color: null;
font-style: inherit;"> </span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">alert</span><span class="kw" style="color: #003B4F;
background-color: null;
font-style: inherit;">:</span><span class="at" style="color: #657422;
background-color: null;
font-style: inherit;"> HighAgentErrorRate</span></span>
<span id="cb15-8"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">        expr</span><span class="kw" style="color: #003B4F;
background-color: null;
font-style: inherit;">: </span><span class="ch" style="color: #20794D;
background-color: null;
font-style: inherit;">|</span></span>
<span id="cb15-9">          rate(agent_requests_total{status="failure"}[5m])</span>
<span id="cb15-10">          / rate(agent_requests_total[5m]) &gt; 0.05</span>
<span id="cb15-11"><span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">        </span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">for</span><span class="kw" style="color: #003B4F;
background-color: null;
font-style: inherit;">:</span><span class="at" style="color: #657422;
background-color: null;
font-style: inherit;"> 5m</span></span>
<span id="cb15-12"><span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">        </span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">labels</span><span class="kw" style="color: #003B4F;
background-color: null;
font-style: inherit;">:</span></span>
<span id="cb15-13"><span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">          </span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">severity</span><span class="kw" style="color: #003B4F;
background-color: null;
font-style: inherit;">:</span><span class="at" style="color: #657422;
background-color: null;
font-style: inherit;"> warning</span></span>
<span id="cb15-14"><span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">        </span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">annotations</span><span class="kw" style="color: #003B4F;
background-color: null;
font-style: inherit;">:</span></span>
<span id="cb15-15"><span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">          </span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">summary</span><span class="kw" style="color: #003B4F;
background-color: null;
font-style: inherit;">:</span><span class="at" style="color: #657422;
background-color: null;
font-style: inherit;"> </span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"High error rate for agent {{ $labels.agent_name }}"</span></span>
<span id="cb15-16"><span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">          </span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">description</span><span class="kw" style="color: #003B4F;
background-color: null;
font-style: inherit;">:</span><span class="at" style="color: #657422;
background-color: null;
font-style: inherit;"> </span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Error rate is {{ $value | humanizePercentage }}"</span></span>
<span id="cb15-17"><span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">      </span></span>
<span id="cb15-18"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">      # 레이턴시 높음</span></span>
<span id="cb15-19"><span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">      </span><span class="kw" style="color: #003B4F;
background-color: null;
font-style: inherit;">-</span><span class="at" style="color: #657422;
background-color: null;
font-style: inherit;"> </span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">alert</span><span class="kw" style="color: #003B4F;
background-color: null;
font-style: inherit;">:</span><span class="at" style="color: #657422;
background-color: null;
font-style: inherit;"> HighAgentLatency</span></span>
<span id="cb15-20"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">        expr</span><span class="kw" style="color: #003B4F;
background-color: null;
font-style: inherit;">: </span><span class="ch" style="color: #20794D;
background-color: null;
font-style: inherit;">|</span></span>
<span id="cb15-21">          histogram_quantile(0.95,</span>
<span id="cb15-22">            rate(agent_duration_seconds_bucket[5m])</span>
<span id="cb15-23">          ) &gt; 10</span>
<span id="cb15-24"><span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">        </span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">for</span><span class="kw" style="color: #003B4F;
background-color: null;
font-style: inherit;">:</span><span class="at" style="color: #657422;
background-color: null;
font-style: inherit;"> 5m</span></span>
<span id="cb15-25"><span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">        </span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">labels</span><span class="kw" style="color: #003B4F;
background-color: null;
font-style: inherit;">:</span></span>
<span id="cb15-26"><span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">          </span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">severity</span><span class="kw" style="color: #003B4F;
background-color: null;
font-style: inherit;">:</span><span class="at" style="color: #657422;
background-color: null;
font-style: inherit;"> warning</span></span>
<span id="cb15-27"><span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">        </span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">annotations</span><span class="kw" style="color: #003B4F;
background-color: null;
font-style: inherit;">:</span></span>
<span id="cb15-28"><span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">          </span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">summary</span><span class="kw" style="color: #003B4F;
background-color: null;
font-style: inherit;">:</span><span class="at" style="color: #657422;
background-color: null;
font-style: inherit;"> </span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"High latency for agent {{ $labels.agent_name }}"</span></span>
<span id="cb15-29"><span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">          </span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">description</span><span class="kw" style="color: #003B4F;
background-color: null;
font-style: inherit;">:</span><span class="at" style="color: #657422;
background-color: null;
font-style: inherit;"> </span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"P95 latency is {{ $value }}s"</span></span>
<span id="cb15-30"><span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">      </span></span>
<span id="cb15-31"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">      # LLM 비용 초과</span></span>
<span id="cb15-32"><span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">      </span><span class="kw" style="color: #003B4F;
background-color: null;
font-style: inherit;">-</span><span class="at" style="color: #657422;
background-color: null;
font-style: inherit;"> </span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">alert</span><span class="kw" style="color: #003B4F;
background-color: null;
font-style: inherit;">:</span><span class="at" style="color: #657422;
background-color: null;
font-style: inherit;"> HighLLMCost</span></span>
<span id="cb15-33"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">        expr</span><span class="kw" style="color: #003B4F;
background-color: null;
font-style: inherit;">: </span><span class="ch" style="color: #20794D;
background-color: null;
font-style: inherit;">|</span></span>
<span id="cb15-34">          increase(llm_cost_total[1h]) &gt; 100</span>
<span id="cb15-35"><span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">        </span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">labels</span><span class="kw" style="color: #003B4F;
background-color: null;
font-style: inherit;">:</span></span>
<span id="cb15-36"><span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">          </span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">severity</span><span class="kw" style="color: #003B4F;
background-color: null;
font-style: inherit;">:</span><span class="at" style="color: #657422;
background-color: null;
font-style: inherit;"> critical</span></span>
<span id="cb15-37"><span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">        </span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">annotations</span><span class="kw" style="color: #003B4F;
background-color: null;
font-style: inherit;">:</span></span>
<span id="cb15-38"><span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">          </span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">summary</span><span class="kw" style="color: #003B4F;
background-color: null;
font-style: inherit;">:</span><span class="at" style="color: #657422;
background-color: null;
font-style: inherit;"> </span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"High LLM cost"</span></span>
<span id="cb15-39"><span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">          </span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">description</span><span class="kw" style="color: #003B4F;
background-color: null;
font-style: inherit;">:</span><span class="at" style="color: #657422;
background-color: null;
font-style: inherit;"> </span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Cost in last hour: ${{ $value }}"</span></span>
<span id="cb15-40"><span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">      </span></span>
<span id="cb15-41"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">      # Agent 다운</span></span>
<span id="cb15-42"><span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">      </span><span class="kw" style="color: #003B4F;
background-color: null;
font-style: inherit;">-</span><span class="at" style="color: #657422;
background-color: null;
font-style: inherit;"> </span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">alert</span><span class="kw" style="color: #003B4F;
background-color: null;
font-style: inherit;">:</span><span class="at" style="color: #657422;
background-color: null;
font-style: inherit;"> AgentDown</span></span>
<span id="cb15-43"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">        expr</span><span class="kw" style="color: #003B4F;
background-color: null;
font-style: inherit;">: </span><span class="ch" style="color: #20794D;
background-color: null;
font-style: inherit;">|</span></span>
<span id="cb15-44">          up{job="agent-platform"} == 0</span>
<span id="cb15-45"><span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">        </span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">for</span><span class="kw" style="color: #003B4F;
background-color: null;
font-style: inherit;">:</span><span class="at" style="color: #657422;
background-color: null;
font-style: inherit;"> 1m</span></span>
<span id="cb15-46"><span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">        </span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">labels</span><span class="kw" style="color: #003B4F;
background-color: null;
font-style: inherit;">:</span></span>
<span id="cb15-47"><span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">          </span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">severity</span><span class="kw" style="color: #003B4F;
background-color: null;
font-style: inherit;">:</span><span class="at" style="color: #657422;
background-color: null;
font-style: inherit;"> critical</span></span>
<span id="cb15-48"><span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">        </span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">annotations</span><span class="kw" style="color: #003B4F;
background-color: null;
font-style: inherit;">:</span></span>
<span id="cb15-49"><span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">          </span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">summary</span><span class="kw" style="color: #003B4F;
background-color: null;
font-style: inherit;">:</span><span class="at" style="color: #657422;
background-color: null;
font-style: inherit;"> </span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Agent platform is down"</span></span>
<span id="cb15-50"><span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">          </span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">description</span><span class="kw" style="color: #003B4F;
background-color: null;
font-style: inherit;">:</span><span class="at" style="color: #657422;
background-color: null;
font-style: inherit;"> </span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Instance {{ $labels.instance }} is down"</span></span></code></pre></div>
</section>
</section>
<section id="grafana-대시보드" class="level2" data-number="4.2">
<h2 data-number="4.2" class="anchored" data-anchor-id="grafana-대시보드"><span class="header-section-number">4.2</span> Grafana 대시보드</h2>
<section id="대시보드-json" class="level3" data-number="4.2.1">
<h3 data-number="4.2.1" class="anchored" data-anchor-id="대시보드-json"><span class="header-section-number">4.2.1</span> 대시보드 JSON</h3>
<div class="sourceCode" id="cb16" style="background: #f1f3f5;"><pre class="sourceCode numberSource json number-lines code-with-copy"><code class="sourceCode json"><span id="cb16-1"><span class="er" style="color: #AD0000;
background-color: null;
font-style: inherit;">//</span> <span class="er" style="color: #AD0000;
background-color: null;
font-style: inherit;">config/grafana/dashboards/agent-platform.json</span></span>
<span id="cb16-2"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">{</span></span>
<span id="cb16-3">  <span class="dt" style="color: #AD0000;
background-color: null;
font-style: inherit;">"dashboard"</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">:</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">{</span></span>
<span id="cb16-4">    <span class="dt" style="color: #AD0000;
background-color: null;
font-style: inherit;">"title"</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">:</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"AI Agent Platform Overview"</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">,</span></span>
<span id="cb16-5">    <span class="dt" style="color: #AD0000;
background-color: null;
font-style: inherit;">"panels"</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">:</span> <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">[</span></span>
<span id="cb16-6">      <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">{</span></span>
<span id="cb16-7">        <span class="dt" style="color: #AD0000;
background-color: null;
font-style: inherit;">"title"</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">:</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Agent Request Rate"</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">,</span></span>
<span id="cb16-8">        <span class="dt" style="color: #AD0000;
background-color: null;
font-style: inherit;">"targets"</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">:</span> <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">[</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">{</span></span>
<span id="cb16-9">          <span class="dt" style="color: #AD0000;
background-color: null;
font-style: inherit;">"expr"</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">:</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"sum(rate(agent_requests_total[5m])) by (agent_name)"</span></span>
<span id="cb16-10">        <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">}</span><span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">]</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">,</span></span>
<span id="cb16-11">        <span class="dt" style="color: #AD0000;
background-color: null;
font-style: inherit;">"type"</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">:</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"graph"</span></span>
<span id="cb16-12">      <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">}</span><span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">,</span></span>
<span id="cb16-13">      <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">{</span></span>
<span id="cb16-14">        <span class="dt" style="color: #AD0000;
background-color: null;
font-style: inherit;">"title"</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">:</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Agent Error Rate"</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">,</span></span>
<span id="cb16-15">        <span class="dt" style="color: #AD0000;
background-color: null;
font-style: inherit;">"targets"</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">:</span> <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">[</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">{</span></span>
<span id="cb16-16">          <span class="dt" style="color: #AD0000;
background-color: null;
font-style: inherit;">"expr"</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">:</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"sum(rate(agent_requests_total{status='failure'}[5m])) by (agent_name) / sum(rate(agent_requests_total[5m])) by (agent_name)"</span></span>
<span id="cb16-17">        <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">}</span><span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">]</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">,</span></span>
<span id="cb16-18">        <span class="dt" style="color: #AD0000;
background-color: null;
font-style: inherit;">"type"</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">:</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"graph"</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">,</span></span>
<span id="cb16-19">        <span class="dt" style="color: #AD0000;
background-color: null;
font-style: inherit;">"alert"</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">:</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">{</span></span>
<span id="cb16-20">          <span class="dt" style="color: #AD0000;
background-color: null;
font-style: inherit;">"conditions"</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">:</span> <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">[</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">{</span></span>
<span id="cb16-21">            <span class="dt" style="color: #AD0000;
background-color: null;
font-style: inherit;">"evaluator"</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">:</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">{</span><span class="dt" style="color: #AD0000;
background-color: null;
font-style: inherit;">"type"</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">:</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"gt"</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">,</span> <span class="dt" style="color: #AD0000;
background-color: null;
font-style: inherit;">"params"</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">:</span> <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">[</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">0</span><span class="er" style="color: #AD0000;
background-color: null;
font-style: inherit;">.05</span><span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">]</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">}</span></span>
<span id="cb16-22">          <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">}</span><span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">]</span></span>
<span id="cb16-23">        <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">}</span></span>
<span id="cb16-24">      <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">}</span><span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">,</span></span>
<span id="cb16-25">      <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">{</span></span>
<span id="cb16-26">        <span class="dt" style="color: #AD0000;
background-color: null;
font-style: inherit;">"title"</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">:</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Agent Latency (P95)"</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">,</span></span>
<span id="cb16-27">        <span class="dt" style="color: #AD0000;
background-color: null;
font-style: inherit;">"targets"</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">:</span> <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">[</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">{</span></span>
<span id="cb16-28">          <span class="dt" style="color: #AD0000;
background-color: null;
font-style: inherit;">"expr"</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">:</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"histogram_quantile(0.95, sum(rate(agent_duration_seconds_bucket[5m])) by (agent_name, le))"</span></span>
<span id="cb16-29">        <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">}</span><span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">]</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">,</span></span>
<span id="cb16-30">        <span class="dt" style="color: #AD0000;
background-color: null;
font-style: inherit;">"type"</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">:</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"graph"</span></span>
<span id="cb16-31">      <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">}</span><span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">,</span></span>
<span id="cb16-32">      <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">{</span></span>
<span id="cb16-33">        <span class="dt" style="color: #AD0000;
background-color: null;
font-style: inherit;">"title"</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">:</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"LLM Cost (Hourly)"</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">,</span></span>
<span id="cb16-34">        <span class="dt" style="color: #AD0000;
background-color: null;
font-style: inherit;">"targets"</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">:</span> <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">[</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">{</span></span>
<span id="cb16-35">          <span class="dt" style="color: #AD0000;
background-color: null;
font-style: inherit;">"expr"</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">:</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"sum(increase(llm_cost_total[1h])) by (agent_name)"</span></span>
<span id="cb16-36">        <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">}</span><span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">]</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">,</span></span>
<span id="cb16-37">        <span class="dt" style="color: #AD0000;
background-color: null;
font-style: inherit;">"type"</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">:</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"graph"</span></span>
<span id="cb16-38">      <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">}</span><span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">,</span></span>
<span id="cb16-39">      <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">{</span></span>
<span id="cb16-40">        <span class="dt" style="color: #AD0000;
background-color: null;
font-style: inherit;">"title"</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">:</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Agent Confidence Distribution"</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">,</span></span>
<span id="cb16-41">        <span class="dt" style="color: #AD0000;
background-color: null;
font-style: inherit;">"targets"</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">:</span> <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">[</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">{</span></span>
<span id="cb16-42">          <span class="dt" style="color: #AD0000;
background-color: null;
font-style: inherit;">"expr"</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">:</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"sum(rate(agent_confidence_bucket[5m])) by (agent_name, le)"</span></span>
<span id="cb16-43">        <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">}</span><span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">]</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">,</span></span>
<span id="cb16-44">        <span class="dt" style="color: #AD0000;
background-color: null;
font-style: inherit;">"type"</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">:</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"heatmap"</span></span>
<span id="cb16-45">      <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">}</span></span>
<span id="cb16-46">    <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">]</span></span>
<span id="cb16-47">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">}</span></span>
<span id="cb16-48"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">}</span></span></code></pre></div>
</section>
</section>
</section>
<section id="로깅-전략" class="level1" data-number="5">
<h1 data-number="5"><span class="header-section-number">5</span> 로깅 전략</h1>
<section id="구조화된-로깅" class="level2" data-number="5.1">
<h2 data-number="5.1" class="anchored" data-anchor-id="구조화된-로깅"><span class="header-section-number">5.1</span> 구조화된 로깅</h2>
<div class="sourceCode" id="cb17" style="background: #f1f3f5;"><pre class="sourceCode numberSource python number-lines code-with-copy"><code class="sourceCode python"><span id="cb17-1"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># shared/logging/structured_logger.py</span></span>
<span id="cb17-2"><span class="im" style="color: #00769E;
background-color: null;
font-style: inherit;">import</span> logging</span>
<span id="cb17-3"><span class="im" style="color: #00769E;
background-color: null;
font-style: inherit;">import</span> json</span>
<span id="cb17-4"><span class="im" style="color: #00769E;
background-color: null;
font-style: inherit;">from</span> datetime <span class="im" style="color: #00769E;
background-color: null;
font-style: inherit;">import</span> datetime</span>
<span id="cb17-5"><span class="im" style="color: #00769E;
background-color: null;
font-style: inherit;">from</span> typing <span class="im" style="color: #00769E;
background-color: null;
font-style: inherit;">import</span> Dict, Any, Optional</span>
<span id="cb17-6"><span class="im" style="color: #00769E;
background-color: null;
font-style: inherit;">from</span> pythonjsonlogger <span class="im" style="color: #00769E;
background-color: null;
font-style: inherit;">import</span> jsonlogger</span>
<span id="cb17-7"></span>
<span id="cb17-8"><span class="kw" style="color: #003B4F;
background-color: null;
font-style: inherit;">class</span> StructuredLogger:</span>
<span id="cb17-9">    <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">"""구조화된 로깅</span></span>
<span id="cb17-10"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">    </span></span>
<span id="cb17-11"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">    모든 로그를 JSON 형식으로 출력:</span></span>
<span id="cb17-12"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">    {</span></span>
<span id="cb17-13"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">        "timestamp": "2026-02-02T10:30:00Z",</span></span>
<span id="cb17-14"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">        "level": "INFO",</span></span>
<span id="cb17-15"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">        "logger": "agent.data_standardization",</span></span>
<span id="cb17-16"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">        "message": "Agent executed successfully",</span></span>
<span id="cb17-17"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">        "agent_name": "data_standardization",</span></span>
<span id="cb17-18"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">        "duration_ms": 1250,</span></span>
<span id="cb17-19"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">        "confidence": 0.95,</span></span>
<span id="cb17-20"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">        "trace_id": "abc123"</span></span>
<span id="cb17-21"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">    }</span></span>
<span id="cb17-22"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">    """</span></span>
<span id="cb17-23">    </span>
<span id="cb17-24">    <span class="kw" style="color: #003B4F;
background-color: null;
font-style: inherit;">def</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">__init__</span>(<span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">self</span>, name: <span class="bu" style="color: null;
background-color: null;
font-style: inherit;">str</span>):</span>
<span id="cb17-25">        <span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">self</span>.logger <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> logging.getLogger(name)</span>
<span id="cb17-26">        <span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">self</span>.logger.setLevel(logging.INFO)</span>
<span id="cb17-27">        </span>
<span id="cb17-28">        <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># JSON formatter</span></span>
<span id="cb17-29">        handler <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> logging.StreamHandler()</span>
<span id="cb17-30">        formatter <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> jsonlogger.JsonFormatter(</span>
<span id="cb17-31">            fmt<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">'</span><span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">%(timestamp)s</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;"> </span><span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">%(level)s</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;"> </span><span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">%(name)s</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;"> </span><span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">%(message)s</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">'</span>,</span>
<span id="cb17-32">            rename_fields<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span>{<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">'levelname'</span>: <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">'level'</span>, <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">'name'</span>: <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">'logger'</span>}</span>
<span id="cb17-33">        )</span>
<span id="cb17-34">        handler.setFormatter(formatter)</span>
<span id="cb17-35">        </span>
<span id="cb17-36">        <span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">self</span>.logger.addHandler(handler)</span>
<span id="cb17-37">    </span>
<span id="cb17-38">    <span class="kw" style="color: #003B4F;
background-color: null;
font-style: inherit;">def</span> log(</span>
<span id="cb17-39">        <span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">self</span>,</span>
<span id="cb17-40">        level: <span class="bu" style="color: null;
background-color: null;
font-style: inherit;">str</span>,</span>
<span id="cb17-41">        message: <span class="bu" style="color: null;
background-color: null;
font-style: inherit;">str</span>,</span>
<span id="cb17-42">        extra: Optional[Dict[<span class="bu" style="color: null;
background-color: null;
font-style: inherit;">str</span>, Any]] <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> <span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">None</span></span>
<span id="cb17-43">    ):</span>
<span id="cb17-44">        <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">"""로그 기록"""</span></span>
<span id="cb17-45">        log_data <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> {</span>
<span id="cb17-46">            <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">'timestamp'</span>: datetime.utcnow().isoformat(),</span>
<span id="cb17-47">            <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">'message'</span>: message</span>
<span id="cb17-48">        }</span>
<span id="cb17-49">        </span>
<span id="cb17-50">        <span class="cf" style="color: #003B4F;
background-color: null;
font-style: inherit;">if</span> extra:</span>
<span id="cb17-51">            log_data.update(extra)</span>
<span id="cb17-52">        </span>
<span id="cb17-53">        <span class="bu" style="color: null;
background-color: null;
font-style: inherit;">getattr</span>(<span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">self</span>.logger, level.lower())(message, extra<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span>log_data)</span>
<span id="cb17-54">    </span>
<span id="cb17-55">    <span class="kw" style="color: #003B4F;
background-color: null;
font-style: inherit;">def</span> log_agent_execution(</span>
<span id="cb17-56">        <span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">self</span>,</span>
<span id="cb17-57">        agent_name: <span class="bu" style="color: null;
background-color: null;
font-style: inherit;">str</span>,</span>
<span id="cb17-58">        status: <span class="bu" style="color: null;
background-color: null;
font-style: inherit;">str</span>,</span>
<span id="cb17-59">        duration_ms: <span class="bu" style="color: null;
background-color: null;
font-style: inherit;">float</span>,</span>
<span id="cb17-60">        confidence: <span class="bu" style="color: null;
background-color: null;
font-style: inherit;">float</span>,</span>
<span id="cb17-61">        trace_id: <span class="bu" style="color: null;
background-color: null;
font-style: inherit;">str</span></span>
<span id="cb17-62">    ):</span>
<span id="cb17-63">        <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">"""Agent 실행 로그"""</span></span>
<span id="cb17-64">        <span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">self</span>.log(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">'info'</span>, <span class="ss" style="color: #20794D;
background-color: null;
font-style: inherit;">f"Agent </span><span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">{</span>agent_name<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">}</span><span class="ss" style="color: #20794D;
background-color: null;
font-style: inherit;"> executed"</span>, extra<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span>{</span>
<span id="cb17-65">            <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">'agent_name'</span>: agent_name,</span>
<span id="cb17-66">            <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">'status'</span>: status,</span>
<span id="cb17-67">            <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">'duration_ms'</span>: duration_ms,</span>
<span id="cb17-68">            <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">'confidence'</span>: confidence,</span>
<span id="cb17-69">            <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">'trace_id'</span>: trace_id,</span>
<span id="cb17-70">            <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">'event_type'</span>: <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">'agent_execution'</span></span>
<span id="cb17-71">        })</span>
<span id="cb17-72">    </span>
<span id="cb17-73">    <span class="kw" style="color: #003B4F;
background-color: null;
font-style: inherit;">def</span> log_error(</span>
<span id="cb17-74">        <span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">self</span>,</span>
<span id="cb17-75">        agent_name: <span class="bu" style="color: null;
background-color: null;
font-style: inherit;">str</span>,</span>
<span id="cb17-76">        error: <span class="bu" style="color: null;
background-color: null;
font-style: inherit;">str</span>,</span>
<span id="cb17-77">        trace_id: <span class="bu" style="color: null;
background-color: null;
font-style: inherit;">str</span></span>
<span id="cb17-78">    ):</span>
<span id="cb17-79">        <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">"""에러 로그"""</span></span>
<span id="cb17-80">        <span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">self</span>.log(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">'error'</span>, <span class="ss" style="color: #20794D;
background-color: null;
font-style: inherit;">f"Agent </span><span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">{</span>agent_name<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">}</span><span class="ss" style="color: #20794D;
background-color: null;
font-style: inherit;"> failed"</span>, extra<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span>{</span>
<span id="cb17-81">            <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">'agent_name'</span>: agent_name,</span>
<span id="cb17-82">            <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">'error'</span>: error,</span>
<span id="cb17-83">            <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">'trace_id'</span>: trace_id,</span>
<span id="cb17-84">            <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">'event_type'</span>: <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">'agent_error'</span></span>
<span id="cb17-85">        })</span>
<span id="cb17-86"></span>
<span id="cb17-87"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># BaseAgent에 통합</span></span>
<span id="cb17-88"><span class="kw" style="color: #003B4F;
background-color: null;
font-style: inherit;">class</span> BaseAgent(ABC):</span>
<span id="cb17-89">    <span class="kw" style="color: #003B4F;
background-color: null;
font-style: inherit;">def</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">__init__</span>(<span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">self</span>, metadata: AgentMetadata):</span>
<span id="cb17-90">        <span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">self</span>.metadata <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> metadata</span>
<span id="cb17-91">        <span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">self</span>.logger <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> StructuredLogger(<span class="ss" style="color: #20794D;
background-color: null;
font-style: inherit;">f"agent.</span><span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">{</span>metadata<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">.</span>name<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">}</span><span class="ss" style="color: #20794D;
background-color: null;
font-style: inherit;">"</span>)</span>
<span id="cb17-92">    </span>
<span id="cb17-93">    <span class="kw" style="color: #003B4F;
background-color: null;
font-style: inherit;">def</span> execute(<span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">self</span>, <span class="bu" style="color: null;
background-color: null;
font-style: inherit;">input</span>: Dict[<span class="bu" style="color: null;
background-color: null;
font-style: inherit;">str</span>, Any]) <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">-&gt;</span> Dict[<span class="bu" style="color: null;
background-color: null;
font-style: inherit;">str</span>, Any]:</span>
<span id="cb17-94">        <span class="im" style="color: #00769E;
background-color: null;
font-style: inherit;">import</span> uuid</span>
<span id="cb17-95">        trace_id <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> <span class="bu" style="color: null;
background-color: null;
font-style: inherit;">str</span>(uuid.uuid4())</span>
<span id="cb17-96">        </span>
<span id="cb17-97">        <span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">self</span>.logger.log(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">'info'</span>, <span class="ss" style="color: #20794D;
background-color: null;
font-style: inherit;">f"Starting execution"</span>, extra<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span>{</span>
<span id="cb17-98">            <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">'agent_name'</span>: <span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">self</span>.metadata.name,</span>
<span id="cb17-99">            <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">'trace_id'</span>: trace_id,</span>
<span id="cb17-100">            <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">'input_task'</span>: <span class="bu" style="color: null;
background-color: null;
font-style: inherit;">input</span>.get(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">'task'</span>)</span>
<span id="cb17-101">        })</span>
<span id="cb17-102">        </span>
<span id="cb17-103">        <span class="cf" style="color: #003B4F;
background-color: null;
font-style: inherit;">try</span>:</span>
<span id="cb17-104">            result <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> <span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">self</span>.process(<span class="bu" style="color: null;
background-color: null;
font-style: inherit;">input</span>)</span>
<span id="cb17-105">            </span>
<span id="cb17-106">            <span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">self</span>.logger.log_agent_execution(</span>
<span id="cb17-107">                agent_name<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span><span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">self</span>.metadata.name,</span>
<span id="cb17-108">                status<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">'success'</span>,</span>
<span id="cb17-109">                duration_ms<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span>result[<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">'metadata'</span>][<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">'execution'</span>][<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">'duration_ms'</span>],</span>
<span id="cb17-110">                confidence<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span>result[<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">'confidence'</span>],</span>
<span id="cb17-111">                trace_id<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span>trace_id</span>
<span id="cb17-112">            )</span>
<span id="cb17-113">            </span>
<span id="cb17-114">            <span class="cf" style="color: #003B4F;
background-color: null;
font-style: inherit;">return</span> result</span>
<span id="cb17-115">            </span>
<span id="cb17-116">        <span class="cf" style="color: #003B4F;
background-color: null;
font-style: inherit;">except</span> <span class="pp" style="color: #AD0000;
background-color: null;
font-style: inherit;">Exception</span> <span class="im" style="color: #00769E;
background-color: null;
font-style: inherit;">as</span> e:</span>
<span id="cb17-117">            <span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">self</span>.logger.log_error(</span>
<span id="cb17-118">                agent_name<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span><span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">self</span>.metadata.name,</span>
<span id="cb17-119">                error<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span><span class="bu" style="color: null;
background-color: null;
font-style: inherit;">str</span>(e),</span>
<span id="cb17-120">                trace_id<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span>trace_id</span>
<span id="cb17-121">            )</span>
<span id="cb17-122">            <span class="cf" style="color: #003B4F;
background-color: null;
font-style: inherit;">raise</span></span></code></pre></div>
</section>
<section id="elk-stack-통합" class="level2" data-number="5.2">
<h2 data-number="5.2" class="anchored" data-anchor-id="elk-stack-통합"><span class="header-section-number">5.2</span> ELK Stack 통합</h2>
<section id="filebeat-설정" class="level3" data-number="5.2.1">
<h3 data-number="5.2.1" class="anchored" data-anchor-id="filebeat-설정"><span class="header-section-number">5.2.1</span> Filebeat 설정</h3>
<div class="sourceCode" id="cb18" style="background: #f1f3f5;"><pre class="sourceCode numberSource yaml number-lines code-with-copy"><code class="sourceCode yaml"><span id="cb18-1"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># config/filebeat.yml</span></span>
<span id="cb18-2"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">filebeat.inputs</span><span class="kw" style="color: #003B4F;
background-color: null;
font-style: inherit;">:</span></span>
<span id="cb18-3"><span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">  </span><span class="kw" style="color: #003B4F;
background-color: null;
font-style: inherit;">-</span><span class="at" style="color: #657422;
background-color: null;
font-style: inherit;"> </span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">type</span><span class="kw" style="color: #003B4F;
background-color: null;
font-style: inherit;">:</span><span class="at" style="color: #657422;
background-color: null;
font-style: inherit;"> container</span></span>
<span id="cb18-4"><span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">    </span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">paths</span><span class="kw" style="color: #003B4F;
background-color: null;
font-style: inherit;">:</span></span>
<span id="cb18-5"><span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">      </span><span class="kw" style="color: #003B4F;
background-color: null;
font-style: inherit;">-</span><span class="at" style="color: #657422;
background-color: null;
font-style: inherit;"> </span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">'/var/lib/docker/containers/*/*.log'</span></span>
<span id="cb18-6"><span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">    </span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">processors</span><span class="kw" style="color: #003B4F;
background-color: null;
font-style: inherit;">:</span></span>
<span id="cb18-7"><span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">      </span><span class="kw" style="color: #003B4F;
background-color: null;
font-style: inherit;">-</span><span class="at" style="color: #657422;
background-color: null;
font-style: inherit;"> </span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">add_kubernetes_metadata</span><span class="kw" style="color: #003B4F;
background-color: null;
font-style: inherit;">:</span></span>
<span id="cb18-8"><span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">          </span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">in_cluster</span><span class="kw" style="color: #003B4F;
background-color: null;
font-style: inherit;">:</span><span class="at" style="color: #657422;
background-color: null;
font-style: inherit;"> </span><span class="ch" style="color: #20794D;
background-color: null;
font-style: inherit;">true</span></span>
<span id="cb18-9"></span>
<span id="cb18-10"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">output.elasticsearch</span><span class="kw" style="color: #003B4F;
background-color: null;
font-style: inherit;">:</span></span>
<span id="cb18-11"><span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">  </span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">hosts</span><span class="kw" style="color: #003B4F;
background-color: null;
font-style: inherit;">:</span><span class="at" style="color: #657422;
background-color: null;
font-style: inherit;"> </span><span class="kw" style="color: #003B4F;
background-color: null;
font-style: inherit;">[</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"elasticsearch:9200"</span><span class="kw" style="color: #003B4F;
background-color: null;
font-style: inherit;">]</span></span>
<span id="cb18-12"><span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">  </span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">index</span><span class="kw" style="color: #003B4F;
background-color: null;
font-style: inherit;">:</span><span class="at" style="color: #657422;
background-color: null;
font-style: inherit;"> </span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"agent-platform-%{+yyyy.MM.dd}"</span></span>
<span id="cb18-13"></span>
<span id="cb18-14"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">setup.template.name</span><span class="kw" style="color: #003B4F;
background-color: null;
font-style: inherit;">:</span><span class="at" style="color: #657422;
background-color: null;
font-style: inherit;"> </span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"agent-platform"</span></span>
<span id="cb18-15"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">setup.template.pattern</span><span class="kw" style="color: #003B4F;
background-color: null;
font-style: inherit;">:</span><span class="at" style="color: #657422;
background-color: null;
font-style: inherit;"> </span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"agent-platform-*"</span></span></code></pre></div>
</section>
<section id="elasticsearch-쿼리" class="level3" data-number="5.2.2">
<h3 data-number="5.2.2" class="anchored" data-anchor-id="elasticsearch-쿼리"><span class="header-section-number">5.2.2</span> Elasticsearch 쿼리</h3>
<div class="sourceCode" id="cb19" style="background: #f1f3f5;"><pre class="sourceCode numberSource python number-lines code-with-copy"><code class="sourceCode python"><span id="cb19-1"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># shared/logging/log_analyzer.py</span></span>
<span id="cb19-2"><span class="im" style="color: #00769E;
background-color: null;
font-style: inherit;">from</span> elasticsearch <span class="im" style="color: #00769E;
background-color: null;
font-style: inherit;">import</span> Elasticsearch</span>
<span id="cb19-3"><span class="im" style="color: #00769E;
background-color: null;
font-style: inherit;">from</span> typing <span class="im" style="color: #00769E;
background-color: null;
font-style: inherit;">import</span> List, Dict, Any</span>
<span id="cb19-4"><span class="im" style="color: #00769E;
background-color: null;
font-style: inherit;">from</span> datetime <span class="im" style="color: #00769E;
background-color: null;
font-style: inherit;">import</span> datetime, timedelta</span>
<span id="cb19-5"></span>
<span id="cb19-6"><span class="kw" style="color: #003B4F;
background-color: null;
font-style: inherit;">class</span> LogAnalyzer:</span>
<span id="cb19-7">    <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">"""로그 분석"""</span></span>
<span id="cb19-8">    </span>
<span id="cb19-9">    <span class="kw" style="color: #003B4F;
background-color: null;
font-style: inherit;">def</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">__init__</span>(<span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">self</span>, es_host: <span class="bu" style="color: null;
background-color: null;
font-style: inherit;">str</span> <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"elasticsearch:9200"</span>):</span>
<span id="cb19-10">        <span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">self</span>.es <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> Elasticsearch([es_host])</span>
<span id="cb19-11">    </span>
<span id="cb19-12">    <span class="kw" style="color: #003B4F;
background-color: null;
font-style: inherit;">def</span> get_agent_errors(</span>
<span id="cb19-13">        <span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">self</span>,</span>
<span id="cb19-14">        agent_name: <span class="bu" style="color: null;
background-color: null;
font-style: inherit;">str</span>,</span>
<span id="cb19-15">        hours: <span class="bu" style="color: null;
background-color: null;
font-style: inherit;">int</span> <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">24</span></span>
<span id="cb19-16">    ) <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">-&gt;</span> List[Dict[<span class="bu" style="color: null;
background-color: null;
font-style: inherit;">str</span>, Any]]:</span>
<span id="cb19-17">        <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">"""Agent 에러 조회"""</span></span>
<span id="cb19-18">        query <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> {</span>
<span id="cb19-19">            <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"query"</span>: {</span>
<span id="cb19-20">                <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"bool"</span>: {</span>
<span id="cb19-21">                    <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"must"</span>: [</span>
<span id="cb19-22">                        {<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"match"</span>: {<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"agent_name"</span>: agent_name}},</span>
<span id="cb19-23">                        {<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"match"</span>: {<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"level"</span>: <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"ERROR"</span>}},</span>
<span id="cb19-24">                        {<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"range"</span>: {</span>
<span id="cb19-25">                            <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"timestamp"</span>: {</span>
<span id="cb19-26">                                <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"gte"</span>: <span class="ss" style="color: #20794D;
background-color: null;
font-style: inherit;">f"now-</span><span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">{</span>hours<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">}</span><span class="ss" style="color: #20794D;
background-color: null;
font-style: inherit;">h"</span></span>
<span id="cb19-27">                            }</span>
<span id="cb19-28">                        }}</span>
<span id="cb19-29">                    ]</span>
<span id="cb19-30">                }</span>
<span id="cb19-31">            },</span>
<span id="cb19-32">            <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"sort"</span>: [{<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"timestamp"</span>: <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"desc"</span>}],</span>
<span id="cb19-33">            <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"size"</span>: <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">100</span></span>
<span id="cb19-34">        }</span>
<span id="cb19-35">        </span>
<span id="cb19-36">        result <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> <span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">self</span>.es.search(index<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"agent-platform-*"</span>, body<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span>query)</span>
<span id="cb19-37">        <span class="cf" style="color: #003B4F;
background-color: null;
font-style: inherit;">return</span> [hit[<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">'_source'</span>] <span class="cf" style="color: #003B4F;
background-color: null;
font-style: inherit;">for</span> hit <span class="kw" style="color: #003B4F;
background-color: null;
font-style: inherit;">in</span> result[<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">'hits'</span>][<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">'hits'</span>]]</span>
<span id="cb19-38">    </span>
<span id="cb19-39">    <span class="kw" style="color: #003B4F;
background-color: null;
font-style: inherit;">def</span> get_slow_executions(</span>
<span id="cb19-40">        <span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">self</span>,</span>
<span id="cb19-41">        threshold_ms: <span class="bu" style="color: null;
background-color: null;
font-style: inherit;">float</span> <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">5000</span>,</span>
<span id="cb19-42">        hours: <span class="bu" style="color: null;
background-color: null;
font-style: inherit;">int</span> <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">24</span></span>
<span id="cb19-43">    ) <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">-&gt;</span> List[Dict[<span class="bu" style="color: null;
background-color: null;
font-style: inherit;">str</span>, Any]]:</span>
<span id="cb19-44">        <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">"""느린 실행 조회"""</span></span>
<span id="cb19-45">        query <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> {</span>
<span id="cb19-46">            <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"query"</span>: {</span>
<span id="cb19-47">                <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"bool"</span>: {</span>
<span id="cb19-48">                    <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"must"</span>: [</span>
<span id="cb19-49">                        {<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"match"</span>: {<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"event_type"</span>: <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"agent_execution"</span>}},</span>
<span id="cb19-50">                        {<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"range"</span>: {<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"duration_ms"</span>: {<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"gte"</span>: threshold_ms}}},</span>
<span id="cb19-51">                        {<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"range"</span>: {<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"timestamp"</span>: {<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"gte"</span>: <span class="ss" style="color: #20794D;
background-color: null;
font-style: inherit;">f"now-</span><span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">{</span>hours<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">}</span><span class="ss" style="color: #20794D;
background-color: null;
font-style: inherit;">h"</span>}}}</span>
<span id="cb19-52">                    ]</span>
<span id="cb19-53">                }</span>
<span id="cb19-54">            },</span>
<span id="cb19-55">            <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"sort"</span>: [{<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"duration_ms"</span>: <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"desc"</span>}],</span>
<span id="cb19-56">            <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"size"</span>: <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">50</span></span>
<span id="cb19-57">        }</span>
<span id="cb19-58">        </span>
<span id="cb19-59">        result <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> <span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">self</span>.es.search(index<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"agent-platform-*"</span>, body<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span>query)</span>
<span id="cb19-60">        <span class="cf" style="color: #003B4F;
background-color: null;
font-style: inherit;">return</span> [hit[<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">'_source'</span>] <span class="cf" style="color: #003B4F;
background-color: null;
font-style: inherit;">for</span> hit <span class="kw" style="color: #003B4F;
background-color: null;
font-style: inherit;">in</span> result[<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">'hits'</span>][<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">'hits'</span>]]</span>
<span id="cb19-61">    </span>
<span id="cb19-62">    <span class="kw" style="color: #003B4F;
background-color: null;
font-style: inherit;">def</span> trace_execution(<span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">self</span>, trace_id: <span class="bu" style="color: null;
background-color: null;
font-style: inherit;">str</span>) <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">-&gt;</span> List[Dict[<span class="bu" style="color: null;
background-color: null;
font-style: inherit;">str</span>, Any]]:</span>
<span id="cb19-63">        <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">"""Trace ID로 전체 실행 추적"""</span></span>
<span id="cb19-64">        query <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> {</span>
<span id="cb19-65">            <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"query"</span>: {</span>
<span id="cb19-66">                <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"match"</span>: {<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"trace_id"</span>: trace_id}</span>
<span id="cb19-67">            },</span>
<span id="cb19-68">            <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"sort"</span>: [{<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"timestamp"</span>: <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"asc"</span>}]</span>
<span id="cb19-69">        }</span>
<span id="cb19-70">        </span>
<span id="cb19-71">        result <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> <span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">self</span>.es.search(index<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"agent-platform-*"</span>, body<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span>query)</span>
<span id="cb19-72">        <span class="cf" style="color: #003B4F;
background-color: null;
font-style: inherit;">return</span> [hit[<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">'_source'</span>] <span class="cf" style="color: #003B4F;
background-color: null;
font-style: inherit;">for</span> hit <span class="kw" style="color: #003B4F;
background-color: null;
font-style: inherit;">in</span> result[<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">'hits'</span>][<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">'hits'</span>]]</span></code></pre></div>
</section>
</section>
</section>
<section id="보안-관리" class="level1" data-number="6">
<h1 data-number="6"><span class="header-section-number">6</span> 보안 관리</h1>
<section id="api-키-관리" class="level2" data-number="6.1">
<h2 data-number="6.1" class="anchored" data-anchor-id="api-키-관리"><span class="header-section-number">6.1</span> API 키 관리</h2>
<section id="kubernetes-secrets" class="level3" data-number="6.1.1">
<h3 data-number="6.1.1" class="anchored" data-anchor-id="kubernetes-secrets"><span class="header-section-number">6.1.1</span> Kubernetes Secrets</h3>
<div class="sourceCode" id="cb20" style="background: #f1f3f5;"><pre class="sourceCode numberSource yaml number-lines code-with-copy"><code class="sourceCode yaml"><span id="cb20-1"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># k8s/secrets.yaml</span></span>
<span id="cb20-2"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">apiVersion</span><span class="kw" style="color: #003B4F;
background-color: null;
font-style: inherit;">:</span><span class="at" style="color: #657422;
background-color: null;
font-style: inherit;"> v1</span></span>
<span id="cb20-3"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">kind</span><span class="kw" style="color: #003B4F;
background-color: null;
font-style: inherit;">:</span><span class="at" style="color: #657422;
background-color: null;
font-style: inherit;"> Secret</span></span>
<span id="cb20-4"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">metadata</span><span class="kw" style="color: #003B4F;
background-color: null;
font-style: inherit;">:</span></span>
<span id="cb20-5"><span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">  </span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">name</span><span class="kw" style="color: #003B4F;
background-color: null;
font-style: inherit;">:</span><span class="at" style="color: #657422;
background-color: null;
font-style: inherit;"> agent-platform-secrets</span></span>
<span id="cb20-6"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">type</span><span class="kw" style="color: #003B4F;
background-color: null;
font-style: inherit;">:</span><span class="at" style="color: #657422;
background-color: null;
font-style: inherit;"> Opaque</span></span>
<span id="cb20-7"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">data</span><span class="kw" style="color: #003B4F;
background-color: null;
font-style: inherit;">:</span></span>
<span id="cb20-8"><span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">  </span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">openai-api-key</span><span class="kw" style="color: #003B4F;
background-color: null;
font-style: inherit;">:</span><span class="at" style="color: #657422;
background-color: null;
font-style: inherit;"> &lt;base64-encoded&gt;</span></span>
<span id="cb20-9"><span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">  </span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">anthropic-api-key</span><span class="kw" style="color: #003B4F;
background-color: null;
font-style: inherit;">:</span><span class="at" style="color: #657422;
background-color: null;
font-style: inherit;"> &lt;base64-encoded&gt;</span></span>
<span id="cb20-10"><span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">  </span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">database-password</span><span class="kw" style="color: #003B4F;
background-color: null;
font-style: inherit;">:</span><span class="at" style="color: #657422;
background-color: null;
font-style: inherit;"> &lt;base64-encoded&gt;</span></span>
<span id="cb20-11"></span>
<span id="cb20-12"><span class="pp" style="color: #AD0000;
background-color: null;
font-style: inherit;">---</span></span>
<span id="cb20-13"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># Deployment에서 사용</span></span>
<span id="cb20-14"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">apiVersion</span><span class="kw" style="color: #003B4F;
background-color: null;
font-style: inherit;">:</span><span class="at" style="color: #657422;
background-color: null;
font-style: inherit;"> apps/v1</span></span>
<span id="cb20-15"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">kind</span><span class="kw" style="color: #003B4F;
background-color: null;
font-style: inherit;">:</span><span class="at" style="color: #657422;
background-color: null;
font-style: inherit;"> Deployment</span></span>
<span id="cb20-16"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">metadata</span><span class="kw" style="color: #003B4F;
background-color: null;
font-style: inherit;">:</span></span>
<span id="cb20-17"><span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">  </span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">name</span><span class="kw" style="color: #003B4F;
background-color: null;
font-style: inherit;">:</span><span class="at" style="color: #657422;
background-color: null;
font-style: inherit;"> agent-platform</span></span>
<span id="cb20-18"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">spec</span><span class="kw" style="color: #003B4F;
background-color: null;
font-style: inherit;">:</span></span>
<span id="cb20-19"><span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">  </span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">template</span><span class="kw" style="color: #003B4F;
background-color: null;
font-style: inherit;">:</span></span>
<span id="cb20-20"><span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">    </span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">spec</span><span class="kw" style="color: #003B4F;
background-color: null;
font-style: inherit;">:</span></span>
<span id="cb20-21"><span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">      </span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">containers</span><span class="kw" style="color: #003B4F;
background-color: null;
font-style: inherit;">:</span></span>
<span id="cb20-22"><span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">      </span><span class="kw" style="color: #003B4F;
background-color: null;
font-style: inherit;">-</span><span class="at" style="color: #657422;
background-color: null;
font-style: inherit;"> </span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">name</span><span class="kw" style="color: #003B4F;
background-color: null;
font-style: inherit;">:</span><span class="at" style="color: #657422;
background-color: null;
font-style: inherit;"> platform</span></span>
<span id="cb20-23"><span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">        </span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">env</span><span class="kw" style="color: #003B4F;
background-color: null;
font-style: inherit;">:</span></span>
<span id="cb20-24"><span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">        </span><span class="kw" style="color: #003B4F;
background-color: null;
font-style: inherit;">-</span><span class="at" style="color: #657422;
background-color: null;
font-style: inherit;"> </span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">name</span><span class="kw" style="color: #003B4F;
background-color: null;
font-style: inherit;">:</span><span class="at" style="color: #657422;
background-color: null;
font-style: inherit;"> OPENAI_API_KEY</span></span>
<span id="cb20-25"><span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">          </span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">valueFrom</span><span class="kw" style="color: #003B4F;
background-color: null;
font-style: inherit;">:</span></span>
<span id="cb20-26"><span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">            </span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">secretKeyRef</span><span class="kw" style="color: #003B4F;
background-color: null;
font-style: inherit;">:</span></span>
<span id="cb20-27"><span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">              </span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">name</span><span class="kw" style="color: #003B4F;
background-color: null;
font-style: inherit;">:</span><span class="at" style="color: #657422;
background-color: null;
font-style: inherit;"> agent-platform-secrets</span></span>
<span id="cb20-28"><span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">              </span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">key</span><span class="kw" style="color: #003B4F;
background-color: null;
font-style: inherit;">:</span><span class="at" style="color: #657422;
background-color: null;
font-style: inherit;"> openai-api-key</span></span>
<span id="cb20-29"><span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">        </span><span class="kw" style="color: #003B4F;
background-color: null;
font-style: inherit;">-</span><span class="at" style="color: #657422;
background-color: null;
font-style: inherit;"> </span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">name</span><span class="kw" style="color: #003B4F;
background-color: null;
font-style: inherit;">:</span><span class="at" style="color: #657422;
background-color: null;
font-style: inherit;"> ANTHROPIC_API_KEY</span></span>
<span id="cb20-30"><span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">          </span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">valueFrom</span><span class="kw" style="color: #003B4F;
background-color: null;
font-style: inherit;">:</span></span>
<span id="cb20-31"><span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">            </span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">secretKeyRef</span><span class="kw" style="color: #003B4F;
background-color: null;
font-style: inherit;">:</span></span>
<span id="cb20-32"><span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">              </span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">name</span><span class="kw" style="color: #003B4F;
background-color: null;
font-style: inherit;">:</span><span class="at" style="color: #657422;
background-color: null;
font-style: inherit;"> agent-platform-secrets</span></span>
<span id="cb20-33"><span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">              </span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">key</span><span class="kw" style="color: #003B4F;
background-color: null;
font-style: inherit;">:</span><span class="at" style="color: #657422;
background-color: null;
font-style: inherit;"> anthropic-api-key</span></span></code></pre></div>
</section>
<section id="secrets-로테이션" class="level3" data-number="6.1.2">
<h3 data-number="6.1.2" class="anchored" data-anchor-id="secrets-로테이션"><span class="header-section-number">6.1.2</span> Secrets 로테이션</h3>
<div class="sourceCode" id="cb21" style="background: #f1f3f5;"><pre class="sourceCode numberSource python number-lines code-with-copy"><code class="sourceCode python"><span id="cb21-1"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># scripts/rotate_secrets.py</span></span>
<span id="cb21-2"><span class="im" style="color: #00769E;
background-color: null;
font-style: inherit;">import</span> boto3</span>
<span id="cb21-3"><span class="im" style="color: #00769E;
background-color: null;
font-style: inherit;">import</span> kubernetes</span>
<span id="cb21-4"><span class="im" style="color: #00769E;
background-color: null;
font-style: inherit;">from</span> datetime <span class="im" style="color: #00769E;
background-color: null;
font-style: inherit;">import</span> datetime</span>
<span id="cb21-5"></span>
<span id="cb21-6"><span class="kw" style="color: #003B4F;
background-color: null;
font-style: inherit;">class</span> SecretsRotator:</span>
<span id="cb21-7">    <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">"""API 키 자동 로테이션"""</span></span>
<span id="cb21-8">    </span>
<span id="cb21-9">    <span class="kw" style="color: #003B4F;
background-color: null;
font-style: inherit;">def</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">__init__</span>(<span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">self</span>):</span>
<span id="cb21-10">        <span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">self</span>.k8s <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> kubernetes.client.CoreV1Api()</span>
<span id="cb21-11">        <span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">self</span>.secrets_manager <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> boto3.client(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">'secretsmanager'</span>)</span>
<span id="cb21-12">    </span>
<span id="cb21-13">    <span class="kw" style="color: #003B4F;
background-color: null;
font-style: inherit;">def</span> rotate_openai_key(<span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">self</span>):</span>
<span id="cb21-14">        <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">"""OpenAI API 키 로테이션"""</span></span>
<span id="cb21-15">        <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># 1. 새 키 생성 (OpenAI 대시보드에서)</span></span>
<span id="cb21-16">        new_key <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> <span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">self</span>._generate_new_openai_key()</span>
<span id="cb21-17">        </span>
<span id="cb21-18">        <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># 2. Kubernetes Secret 업데이트</span></span>
<span id="cb21-19">        <span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">self</span>.k8s.patch_namespaced_secret(</span>
<span id="cb21-20">            name<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"agent-platform-secrets"</span>,</span>
<span id="cb21-21">            namespace<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"production"</span>,</span>
<span id="cb21-22">            body<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span>{</span>
<span id="cb21-23">                <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"data"</span>: {</span>
<span id="cb21-24">                    <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"openai-api-key"</span>: <span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">self</span>._base64_encode(new_key)</span>
<span id="cb21-25">                }</span>
<span id="cb21-26">            }</span>
<span id="cb21-27">        )</span>
<span id="cb21-28">        </span>
<span id="cb21-29">        <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># 3. Pod 재시작 (새 키 적용)</span></span>
<span id="cb21-30">        <span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">self</span>.k8s.delete_collection_namespaced_pod(</span>
<span id="cb21-31">            namespace<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"production"</span>,</span>
<span id="cb21-32">            label_selector<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"app=agent-platform"</span></span>
<span id="cb21-33">        )</span>
<span id="cb21-34">        </span>
<span id="cb21-35">        <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># 4. 이전 키 비활성화 (24시간 후)</span></span>
<span id="cb21-36">        <span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">self</span>._schedule_key_revocation(old_key, delay_hours<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">24</span>)</span>
<span id="cb21-37">        </span>
<span id="cb21-38">        <span class="bu" style="color: null;
background-color: null;
font-style: inherit;">print</span>(<span class="ss" style="color: #20794D;
background-color: null;
font-style: inherit;">f"✅ OpenAI API key rotated at </span><span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">{</span>datetime<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">.</span>utcnow()<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">}</span><span class="ss" style="color: #20794D;
background-color: null;
font-style: inherit;">"</span>)</span></code></pre></div>
</section>
</section>
<section id="인증-및-권한" class="level2" data-number="6.2">
<h2 data-number="6.2" class="anchored" data-anchor-id="인증-및-권한"><span class="header-section-number">6.2</span> 인증 및 권한</h2>
<section id="fastapi-jwt-인증" class="level3" data-number="6.2.1">
<h3 data-number="6.2.1" class="anchored" data-anchor-id="fastapi-jwt-인증"><span class="header-section-number">6.2.1</span> FastAPI JWT 인증</h3>
<div class="sourceCode" id="cb22" style="background: #f1f3f5;"><pre class="sourceCode numberSource python number-lines code-with-copy"><code class="sourceCode python"><span id="cb22-1"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># platform-api/middleware/auth.py</span></span>
<span id="cb22-2"><span class="im" style="color: #00769E;
background-color: null;
font-style: inherit;">from</span> fastapi <span class="im" style="color: #00769E;
background-color: null;
font-style: inherit;">import</span> Depends, HTTPException, status</span>
<span id="cb22-3"><span class="im" style="color: #00769E;
background-color: null;
font-style: inherit;">from</span> fastapi.security <span class="im" style="color: #00769E;
background-color: null;
font-style: inherit;">import</span> HTTPBearer, HTTPAuthorizationCredentials</span>
<span id="cb22-4"><span class="im" style="color: #00769E;
background-color: null;
font-style: inherit;">import</span> jwt</span>
<span id="cb22-5"><span class="im" style="color: #00769E;
background-color: null;
font-style: inherit;">from</span> datetime <span class="im" style="color: #00769E;
background-color: null;
font-style: inherit;">import</span> datetime, timedelta</span>
<span id="cb22-6"></span>
<span id="cb22-7">security <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> HTTPBearer()</span>
<span id="cb22-8"></span>
<span id="cb22-9">SECRET_KEY <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"your-secret-key"</span></span>
<span id="cb22-10">ALGORITHM <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"HS256"</span></span>
<span id="cb22-11"></span>
<span id="cb22-12"><span class="kw" style="color: #003B4F;
background-color: null;
font-style: inherit;">def</span> create_access_token(data: <span class="bu" style="color: null;
background-color: null;
font-style: inherit;">dict</span>, expires_delta: timedelta <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> timedelta(hours<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">24</span>)):</span>
<span id="cb22-13">    <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">"""JWT 토큰 생성"""</span></span>
<span id="cb22-14">    to_encode <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> data.copy()</span>
<span id="cb22-15">    expire <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> datetime.utcnow() <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span> expires_delta</span>
<span id="cb22-16">    to_encode.update({<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"exp"</span>: expire})</span>
<span id="cb22-17">    </span>
<span id="cb22-18">    encoded_jwt <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> jwt.encode(to_encode, SECRET_KEY, algorithm<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span>ALGORITHM)</span>
<span id="cb22-19">    <span class="cf" style="color: #003B4F;
background-color: null;
font-style: inherit;">return</span> encoded_jwt</span>
<span id="cb22-20"></span>
<span id="cb22-21"><span class="kw" style="color: #003B4F;
background-color: null;
font-style: inherit;">def</span> verify_token(credentials: HTTPAuthorizationCredentials <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> Depends(security)):</span>
<span id="cb22-22">    <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">"""JWT 토큰 검증"""</span></span>
<span id="cb22-23">    <span class="cf" style="color: #003B4F;
background-color: null;
font-style: inherit;">try</span>:</span>
<span id="cb22-24">        payload <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> jwt.decode(credentials.credentials, SECRET_KEY, algorithms<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span>[ALGORITHM])</span>
<span id="cb22-25">        username <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> payload.get(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"sub"</span>)</span>
<span id="cb22-26">        </span>
<span id="cb22-27">        <span class="cf" style="color: #003B4F;
background-color: null;
font-style: inherit;">if</span> username <span class="kw" style="color: #003B4F;
background-color: null;
font-style: inherit;">is</span> <span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">None</span>:</span>
<span id="cb22-28">            <span class="cf" style="color: #003B4F;
background-color: null;
font-style: inherit;">raise</span> HTTPException(</span>
<span id="cb22-29">                status_code<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span>status.HTTP_401_UNAUTHORIZED,</span>
<span id="cb22-30">                detail<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Invalid authentication credentials"</span></span>
<span id="cb22-31">            )</span>
<span id="cb22-32">        </span>
<span id="cb22-33">        <span class="cf" style="color: #003B4F;
background-color: null;
font-style: inherit;">return</span> username</span>
<span id="cb22-34">        </span>
<span id="cb22-35">    <span class="cf" style="color: #003B4F;
background-color: null;
font-style: inherit;">except</span> jwt.ExpiredSignatureError:</span>
<span id="cb22-36">        <span class="cf" style="color: #003B4F;
background-color: null;
font-style: inherit;">raise</span> HTTPException(</span>
<span id="cb22-37">            status_code<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span>status.HTTP_401_UNAUTHORIZED,</span>
<span id="cb22-38">            detail<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Token has expired"</span></span>
<span id="cb22-39">        )</span>
<span id="cb22-40">    <span class="cf" style="color: #003B4F;
background-color: null;
font-style: inherit;">except</span> jwt.JWTError:</span>
<span id="cb22-41">        <span class="cf" style="color: #003B4F;
background-color: null;
font-style: inherit;">raise</span> HTTPException(</span>
<span id="cb22-42">            status_code<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span>status.HTTP_401_UNAUTHORIZED,</span>
<span id="cb22-43">            detail<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Could not validate credentials"</span></span>
<span id="cb22-44">        )</span>
<span id="cb22-45"></span>
<span id="cb22-46"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># API 엔드포인트에 적용</span></span>
<span id="cb22-47"><span class="im" style="color: #00769E;
background-color: null;
font-style: inherit;">from</span> fastapi <span class="im" style="color: #00769E;
background-color: null;
font-style: inherit;">import</span> FastAPI</span>
<span id="cb22-48"></span>
<span id="cb22-49">app <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> FastAPI()</span>
<span id="cb22-50"></span>
<span id="cb22-51"><span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">@app.post</span>(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"/api/agents/</span><span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">{agent_name}</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">/execute"</span>)</span>
<span id="cb22-52"><span class="kw" style="color: #003B4F;
background-color: null;
font-style: inherit;">def</span> execute_agent(</span>
<span id="cb22-53">    agent_name: <span class="bu" style="color: null;
background-color: null;
font-style: inherit;">str</span>,</span>
<span id="cb22-54">    input_data: Dict,</span>
<span id="cb22-55">    username: <span class="bu" style="color: null;
background-color: null;
font-style: inherit;">str</span> <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> Depends(verify_token)  <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># 인증 필수</span></span>
<span id="cb22-56">):</span>
<span id="cb22-57">    <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">"""Agent 실행 (인증 필요)"""</span></span>
<span id="cb22-58">    orchestrator <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> AgentOrchestrator()</span>
<span id="cb22-59">    result <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> orchestrator.run(agent_name, input_data)</span>
<span id="cb22-60">    </span>
<span id="cb22-61">    <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># 감사 로그</span></span>
<span id="cb22-62">    logger.info(<span class="ss" style="color: #20794D;
background-color: null;
font-style: inherit;">f"User </span><span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">{</span>username<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">}</span><span class="ss" style="color: #20794D;
background-color: null;
font-style: inherit;"> executed agent </span><span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">{</span>agent_name<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">}</span><span class="ss" style="color: #20794D;
background-color: null;
font-style: inherit;">"</span>)</span>
<span id="cb22-63">    </span>
<span id="cb22-64">    <span class="cf" style="color: #003B4F;
background-color: null;
font-style: inherit;">return</span> result</span></code></pre></div>
</section>
<section id="rate-limiting" class="level3" data-number="6.2.2">
<h3 data-number="6.2.2" class="anchored" data-anchor-id="rate-limiting"><span class="header-section-number">6.2.2</span> Rate Limiting</h3>
<div class="sourceCode" id="cb23" style="background: #f1f3f5;"><pre class="sourceCode numberSource python number-lines code-with-copy"><code class="sourceCode python"><span id="cb23-1"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># platform-api/middleware/rate_limit.py</span></span>
<span id="cb23-2"><span class="im" style="color: #00769E;
background-color: null;
font-style: inherit;">from</span> fastapi <span class="im" style="color: #00769E;
background-color: null;
font-style: inherit;">import</span> Request, HTTPException</span>
<span id="cb23-3"><span class="im" style="color: #00769E;
background-color: null;
font-style: inherit;">from</span> slowapi <span class="im" style="color: #00769E;
background-color: null;
font-style: inherit;">import</span> Limiter, _rate_limit_exceeded_handler</span>
<span id="cb23-4"><span class="im" style="color: #00769E;
background-color: null;
font-style: inherit;">from</span> slowapi.util <span class="im" style="color: #00769E;
background-color: null;
font-style: inherit;">import</span> get_remote_address</span>
<span id="cb23-5"></span>
<span id="cb23-6">limiter <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> Limiter(key_func<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span>get_remote_address)</span>
<span id="cb23-7"></span>
<span id="cb23-8"><span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">@app.post</span>(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"/api/agents/</span><span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">{agent_name}</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">/execute"</span>)</span>
<span id="cb23-9"><span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">@limiter.limit</span>(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"100/hour"</span>)  <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># 시간당 100회 제한</span></span>
<span id="cb23-10"><span class="kw" style="color: #003B4F;
background-color: null;
font-style: inherit;">def</span> execute_agent(request: Request, agent_name: <span class="bu" style="color: null;
background-color: null;
font-style: inherit;">str</span>, input_data: Dict):</span>
<span id="cb23-11">    <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">"""Rate limiting 적용"""</span></span>
<span id="cb23-12">    orchestrator <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> AgentOrchestrator()</span>
<span id="cb23-13">    <span class="cf" style="color: #003B4F;
background-color: null;
font-style: inherit;">return</span> orchestrator.run(agent_name, input_data)</span></code></pre></div>
</section>
</section>
</section>
<section id="핵심-설계-결정-요약" class="level1" data-number="7">
<h1 data-number="7"><span class="header-section-number">7</span> 핵심 설계 결정 요약</h1>
<section id="cicd" class="level2" data-number="7.1">
<h2 data-number="7.1" class="anchored" data-anchor-id="cicd"><span class="header-section-number">7.1</span> CI/CD</h2>
<ol type="1">
<li><strong>변경 감지</strong>: core/shared 변경 시 전체 테스트, agents/ 변경 시 해당 Agent만</li>
<li><strong>자동 배포</strong>: 개발 환경은 자동, 프로덕션은 수동 승인</li>
<li><strong>컨테이너화</strong>: Docker로 일관된 환경</li>
<li><strong>Kubernetes</strong>: 오케스트레이션 및 스케일링</li>
</ol>
</section>
<section id="배포-전략-1" class="level2" data-number="7.2">
<h2 data-number="7.2" class="anchored" data-anchor-id="배포-전략-1"><span class="header-section-number">7.2</span> 배포 전략</h2>
<ol type="1">
<li><strong>Blue-Green</strong>: 빠른 전환, 쉬운 롤백</li>
<li><strong>Canary</strong>: 점진적 배포 (10% → 25% → 50% → 100%)</li>
<li><strong>자동 롤백</strong>: 에러율/레이턴시 임계값 초과 시</li>
</ol>
</section>
<section id="모니터링" class="level2" data-number="7.3">
<h2 data-number="7.3" class="anchored" data-anchor-id="모니터링"><span class="header-section-number">7.3</span> 모니터링</h2>
<ol type="1">
<li><strong>Prometheus</strong>: 메트릭 수집 (요청률, 레이턴시, 비용)</li>
<li><strong>Grafana</strong>: 대시보드 시각화</li>
<li><strong>알림</strong>: Slack/Email 통합</li>
<li><strong>자동 메트릭</strong>: BaseAgent가 자동 수집</li>
</ol>
</section>
<section id="로깅" class="level2" data-number="7.4">
<h2 data-number="7.4" class="anchored" data-anchor-id="로깅"><span class="header-section-number">7.4</span> 로깅</h2>
<ol type="1">
<li><strong>구조화 로깅</strong>: JSON 형식</li>
<li><strong>Trace ID</strong>: 전체 실행 추적</li>
<li><strong>ELK Stack</strong>: 로그 수집, 검색, 분석</li>
<li><strong>로그 레벨</strong>: INFO (프로덕션), DEBUG (개발)</li>
</ol>
</section>
<section id="보안" class="level2" data-number="7.5">
<h2 data-number="7.5" class="anchored" data-anchor-id="보안"><span class="header-section-number">7.5</span> 보안</h2>
<ol type="1">
<li><strong>Kubernetes Secrets</strong>: API 키 저장</li>
<li><strong>JWT 인증</strong>: API 접근 제어</li>
<li><strong>Rate Limiting</strong>: 남용 방지</li>
<li><strong>Secrets 로테이션</strong>: 주기적 키 갱신</li>
</ol>
</section>
<section id="시리즈-완료" class="level2" data-number="7.6">
<h2 data-number="7.6" class="anchored" data-anchor-id="시리즈-완료"><span class="header-section-number">7.6</span> 시리즈 완료</h2>
<p>이 글로 <strong>AI Agent 플랫폼 아키텍처 시리즈</strong>를 마무리한다:</p>
<ol type="1">
<li><strong>관점 선택</strong>: Platform Engineering + Software Architecture</li>
<li><strong>설계 원칙</strong>: 5대 원칙 + Phase 1-4 전략</li>
<li><strong>저장소 전략</strong>: Monorepo + 모듈 분리</li>
<li><strong>인터페이스 설계</strong>: BaseAgent + Template Method Pattern</li>
<li><strong>데이터 표준화</strong>: 프롬프트/벡터/메타데이터 관리</li>
<li><strong>운영 자동화</strong>: CI/CD + 모니터링 + 배포 + 보안</li>
</ol>
</section>
<section id="참고문헌" class="level2" data-number="7.7">
<h2 data-number="7.7" class="anchored" data-anchor-id="참고문헌"><span class="header-section-number">7.7</span> 참고문헌</h2>
<p><strong>DevOps</strong>: - Kim, G., et al.&nbsp;(2016). “The DevOps Handbook.” IT Revolution Press. - Humble, J., &amp; Farley, D. (2010). “Continuous Delivery.” Addison-Wesley. - Forsgren, N., et al.&nbsp;(2018). “Accelerate: The Science of Lean Software and DevOps.” IT Revolution Press.</p>
<p><strong>Kubernetes</strong>: - Burns, B., et al.&nbsp;(2019). “Kubernetes: Up and Running.” O’Reilly. - Kubernetes Documentation. https://kubernetes.io/docs/</p>
<p><strong>Monitoring</strong>: - Beyer, B., et al.&nbsp;(2016). “Site Reliability Engineering.” O’Reilly. - Prometheus Documentation. https://prometheus.io/docs/ - Grafana Documentation. https://grafana.com/docs/</p>
<p><strong>Security</strong>: - OWASP Top 10. https://owasp.org/www-project-top-ten/ - Kubernetes Security Best Practices. https://kubernetes.io/docs/concepts/security/</p>


</section>
</section>

 ]]></description>
  <category>Engineering</category>
  <category>System</category>
  <category>Architecture Design</category>
  <category>AI</category>
  <category>Platform</category>
  <category>DevOps</category>
  <guid>kk3225.netlify.app/docs/blog/posts/Engineering/System/Archi_Design/platform/6.agent_platform_devops.html</guid>
  <pubDate>Fri, 30 Jan 2026 15:00:00 GMT</pubDate>
</item>
<item>
  <title>AI Agent 플랫폼 데이터 표준화 계층</title>
  <dc:creator>Kwangmin Kim</dc:creator>
  <link>kk3225.netlify.app/docs/blog/posts/Engineering/System/Archi_Design/platform/5.agent_platform_data_standardization.html</link>
  <description><![CDATA[ 





<section id="들어가며" class="level1" data-number="1">
<h1 data-number="1"><span class="header-section-number">1</span> 들어가며</h1>
<section id="왜-데이터-표준화-계층이-필요한가" class="level2" data-number="1.1">
<h2 data-number="1.1" class="anchored" data-anchor-id="왜-데이터-표준화-계층이-필요한가"><span class="header-section-number">1.1</span> 왜 데이터 표준화 계층이 필요한가?</h2>
<p>Phase 4 플랫폼을 운영하다 보면 발생하는 문제들:</p>
<p><strong>질문들</strong>: - “프롬프트를 수정했는데, 어떤 Agent가 영향받는지 모르겠어요” - “RAG 데이터를 업데이트하면 Agent를 재배포해야 하나요?” - “Agent 실행 결과를 어떻게 일관되게 기록하나요?” - “프롬프트 A/B 테스트는 어떻게 하나요?”</p>
<p><strong>이 글의 목표</strong>: - 프롬프트 버전 관리 시스템 구축 - 벡터 데이터 자동 업데이트 전략 - 표준 메타데이터 스키마 설계 - 설정 관리 모범 사례</p>
</section>
<section id="앞선-글-요약" class="level2" data-number="1.2">
<h2 data-number="1.2" class="anchored" data-anchor-id="앞선-글-요약"><span class="header-section-number">1.2</span> 앞선 글 요약</h2>
<p><strong>4번 글</strong> (<a href="../../../../../../../docs/blog/posts/Engineering/System/Archi_Design/platform/4.agent_platform_interface_design.html">인터페이스 설계</a>): - BaseAgent 추상 클래스 - Template Method Pattern - AgentRegistry + Orchestrator - Agent 구현 예시</p>
<p><strong>핵심 질문</strong>: “Agent들이 사용하는 데이터를 어떻게 통일하고 관리할 것인가?”</p>
</section>
</section>
<section id="프롬프트-관리-시스템" class="level1" data-number="2">
<h1 data-number="2"><span class="header-section-number">2</span> 프롬프트 관리 시스템</h1>
<section id="문제-프롬프트-변경의-어려움" class="level2" data-number="2.1">
<h2 data-number="2.1" class="anchored" data-anchor-id="문제-프롬프트-변경의-어려움"><span class="header-section-number">2.1</span> 문제: 프롬프트 변경의 어려움</h2>
<section id="초기-방식-phase-1-2" class="level3" data-number="2.1.1">
<h3 data-number="2.1.1" class="anchored" data-anchor-id="초기-방식-phase-1-2"><span class="header-section-number">2.1.1</span> 초기 방식 (Phase 1-2)</h3>
<div class="sourceCode" id="cb1" style="background: #f1f3f5;"><pre class="sourceCode numberSource python number-lines code-with-copy"><code class="sourceCode python"><span id="cb1-1"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># ❌ 나쁜 예: 프롬프트가 코드에 하드코딩</span></span>
<span id="cb1-2"><span class="kw" style="color: #003B4F;
background-color: null;
font-style: inherit;">class</span> DataAgent:</span>
<span id="cb1-3">    <span class="kw" style="color: #003B4F;
background-color: null;
font-style: inherit;">def</span> process(<span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">self</span>, <span class="bu" style="color: null;
background-color: null;
font-style: inherit;">input</span>):</span>
<span id="cb1-4">        prompt <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"""다음 스키마를 표준화하세요:</span></span>
<span id="cb1-5"><span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">{schema}</span></span>
<span id="cb1-6"></span>
<span id="cb1-7"><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">규칙:</span></span>
<span id="cb1-8"><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">- 컬럼명: snake_case</span></span>
<span id="cb1-9"><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">- 날짜: ISO 8601"""</span></span>
<span id="cb1-10">        </span>
<span id="cb1-11">        result <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> llm.generate(prompt.<span class="bu" style="color: null;
background-color: null;
font-style: inherit;">format</span>(schema<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span><span class="bu" style="color: null;
background-color: null;
font-style: inherit;">input</span>[<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">'data'</span>]))</span>
<span id="cb1-12">        <span class="cf" style="color: #003B4F;
background-color: null;
font-style: inherit;">return</span> result</span></code></pre></div>
<p><strong>문제점</strong>: 1. <strong>변경 추적 불가</strong>: 누가, 언제, 왜 수정했는지 모름 2. <strong>A/B 테스트 불가</strong>: 새 프롬프트 성능 비교 어려움 3. <strong>롤백 불가</strong>: 문제 발생 시 이전 버전으로 돌아갈 수 없음 4. <strong>재사용 불가</strong>: 같은 프롬프트를 여러 Agent가 복사-붙여넣기</p>
</section>
<section id="개선-방식-promptregistry" class="level3" data-number="2.1.2">
<h3 data-number="2.1.2" class="anchored" data-anchor-id="개선-방식-promptregistry"><span class="header-section-number">2.1.2</span> 개선 방식: PromptRegistry</h3>
<div class="sourceCode" id="cb2" style="background: #f1f3f5;"><pre class="sourceCode numberSource python number-lines code-with-copy"><code class="sourceCode python"><span id="cb2-1"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># ✅ 좋은 예: 프롬프트를 외부에서 관리</span></span>
<span id="cb2-2"><span class="kw" style="color: #003B4F;
background-color: null;
font-style: inherit;">class</span> DataAgent:</span>
<span id="cb2-3">    <span class="kw" style="color: #003B4F;
background-color: null;
font-style: inherit;">def</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">__init__</span>(<span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">self</span>):</span>
<span id="cb2-4">        <span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">self</span>.prompt_registry <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> PromptRegistry()</span>
<span id="cb2-5">    </span>
<span id="cb2-6">    <span class="kw" style="color: #003B4F;
background-color: null;
font-style: inherit;">def</span> process(<span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">self</span>, <span class="bu" style="color: null;
background-color: null;
font-style: inherit;">input</span>):</span>
<span id="cb2-7">        <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># 버전 지정 가능</span></span>
<span id="cb2-8">        prompt_template <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> <span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">self</span>.prompt_registry.get(</span>
<span id="cb2-9">            name<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"data_standardization"</span>,</span>
<span id="cb2-10">            version<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"1.2.0"</span></span>
<span id="cb2-11">        )</span>
<span id="cb2-12">        </span>
<span id="cb2-13">        prompt <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> prompt_template.<span class="bu" style="color: null;
background-color: null;
font-style: inherit;">format</span>(schema<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span><span class="bu" style="color: null;
background-color: null;
font-style: inherit;">input</span>[<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">'data'</span>])</span>
<span id="cb2-14">        result <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> llm.generate(prompt)</span>
<span id="cb2-15">        <span class="cf" style="color: #003B4F;
background-color: null;
font-style: inherit;">return</span> result</span></code></pre></div>
</section>
</section>
<section id="promptregistry-설계" class="level2" data-number="2.2">
<h2 data-number="2.2" class="anchored" data-anchor-id="promptregistry-설계"><span class="header-section-number">2.2</span> PromptRegistry 설계</h2>
<section id="yaml-기반-프롬프트-저장" class="level3" data-number="2.2.1">
<h3 data-number="2.2.1" class="anchored" data-anchor-id="yaml-기반-프롬프트-저장"><span class="header-section-number">2.2.1</span> YAML 기반 프롬프트 저장</h3>
<div class="sourceCode" id="cb3" style="background: #f1f3f5;"><pre class="sourceCode numberSource yaml number-lines code-with-copy"><code class="sourceCode yaml"><span id="cb3-1"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># shared/prompts/data_standardization.yaml</span></span>
<span id="cb3-2"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">name</span><span class="kw" style="color: #003B4F;
background-color: null;
font-style: inherit;">:</span><span class="at" style="color: #657422;
background-color: null;
font-style: inherit;"> data_standardization</span></span>
<span id="cb3-3"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">domain</span><span class="kw" style="color: #003B4F;
background-color: null;
font-style: inherit;">:</span><span class="at" style="color: #657422;
background-color: null;
font-style: inherit;"> data</span></span>
<span id="cb3-4"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">description</span><span class="kw" style="color: #003B4F;
background-color: null;
font-style: inherit;">:</span><span class="at" style="color: #657422;
background-color: null;
font-style: inherit;"> </span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"데이터 스키마 표준화 프롬프트"</span></span>
<span id="cb3-5"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">tags</span><span class="kw" style="color: #003B4F;
background-color: null;
font-style: inherit;">:</span><span class="at" style="color: #657422;
background-color: null;
font-style: inherit;"> </span><span class="kw" style="color: #003B4F;
background-color: null;
font-style: inherit;">[</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"schema"</span><span class="kw" style="color: #003B4F;
background-color: null;
font-style: inherit;">,</span><span class="at" style="color: #657422;
background-color: null;
font-style: inherit;"> </span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"normalization"</span><span class="kw" style="color: #003B4F;
background-color: null;
font-style: inherit;">]</span></span>
<span id="cb3-6"></span>
<span id="cb3-7"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># 변수 정의</span></span>
<span id="cb3-8"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">variables</span><span class="kw" style="color: #003B4F;
background-color: null;
font-style: inherit;">:</span></span>
<span id="cb3-9"><span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">  </span><span class="kw" style="color: #003B4F;
background-color: null;
font-style: inherit;">-</span><span class="at" style="color: #657422;
background-color: null;
font-style: inherit;"> </span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">name</span><span class="kw" style="color: #003B4F;
background-color: null;
font-style: inherit;">:</span><span class="at" style="color: #657422;
background-color: null;
font-style: inherit;"> schema</span></span>
<span id="cb3-10"><span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">    </span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">type</span><span class="kw" style="color: #003B4F;
background-color: null;
font-style: inherit;">:</span><span class="at" style="color: #657422;
background-color: null;
font-style: inherit;"> dict</span></span>
<span id="cb3-11"><span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">    </span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">required</span><span class="kw" style="color: #003B4F;
background-color: null;
font-style: inherit;">:</span><span class="at" style="color: #657422;
background-color: null;
font-style: inherit;"> </span><span class="ch" style="color: #20794D;
background-color: null;
font-style: inherit;">true</span></span>
<span id="cb3-12"><span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">    </span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">description</span><span class="kw" style="color: #003B4F;
background-color: null;
font-style: inherit;">:</span><span class="at" style="color: #657422;
background-color: null;
font-style: inherit;"> </span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"입력 스키마"</span></span>
<span id="cb3-13"><span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">  </span></span>
<span id="cb3-14"><span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">  </span><span class="kw" style="color: #003B4F;
background-color: null;
font-style: inherit;">-</span><span class="at" style="color: #657422;
background-color: null;
font-style: inherit;"> </span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">name</span><span class="kw" style="color: #003B4F;
background-color: null;
font-style: inherit;">:</span><span class="at" style="color: #657422;
background-color: null;
font-style: inherit;"> target_format</span></span>
<span id="cb3-15"><span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">    </span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">type</span><span class="kw" style="color: #003B4F;
background-color: null;
font-style: inherit;">:</span><span class="at" style="color: #657422;
background-color: null;
font-style: inherit;"> string</span></span>
<span id="cb3-16"><span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">    </span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">required</span><span class="kw" style="color: #003B4F;
background-color: null;
font-style: inherit;">:</span><span class="at" style="color: #657422;
background-color: null;
font-style: inherit;"> </span><span class="ch" style="color: #20794D;
background-color: null;
font-style: inherit;">false</span></span>
<span id="cb3-17"><span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">    </span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">default</span><span class="kw" style="color: #003B4F;
background-color: null;
font-style: inherit;">:</span><span class="at" style="color: #657422;
background-color: null;
font-style: inherit;"> </span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"snake_case"</span></span>
<span id="cb3-18"><span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">    </span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">description</span><span class="kw" style="color: #003B4F;
background-color: null;
font-style: inherit;">:</span><span class="at" style="color: #657422;
background-color: null;
font-style: inherit;"> </span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"컬럼명 포맷"</span></span>
<span id="cb3-19"></span>
<span id="cb3-20"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># 버전 이력</span></span>
<span id="cb3-21"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">versions</span><span class="kw" style="color: #003B4F;
background-color: null;
font-style: inherit;">:</span></span>
<span id="cb3-22"><span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">  </span><span class="kw" style="color: #003B4F;
background-color: null;
font-style: inherit;">-</span><span class="at" style="color: #657422;
background-color: null;
font-style: inherit;"> </span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">version</span><span class="kw" style="color: #003B4F;
background-color: null;
font-style: inherit;">:</span><span class="at" style="color: #657422;
background-color: null;
font-style: inherit;"> </span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"1.0.0"</span></span>
<span id="cb3-23"><span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">    </span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">created_at</span><span class="kw" style="color: #003B4F;
background-color: null;
font-style: inherit;">:</span><span class="at" style="color: #657422;
background-color: null;
font-style: inherit;"> </span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"2026-01-28"</span></span>
<span id="cb3-24"><span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">    </span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">author</span><span class="kw" style="color: #003B4F;
background-color: null;
font-style: inherit;">:</span><span class="at" style="color: #657422;
background-color: null;
font-style: inherit;"> </span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Platform Team"</span></span>
<span id="cb3-25"><span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">    </span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">performance</span><span class="kw" style="color: #003B4F;
background-color: null;
font-style: inherit;">:</span></span>
<span id="cb3-26"><span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">      </span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">accuracy</span><span class="kw" style="color: #003B4F;
background-color: null;
font-style: inherit;">:</span><span class="at" style="color: #657422;
background-color: null;
font-style: inherit;"> </span><span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">0.85</span></span>
<span id="cb3-27"><span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">      </span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">avg_time</span><span class="kw" style="color: #003B4F;
background-color: null;
font-style: inherit;">:</span><span class="at" style="color: #657422;
background-color: null;
font-style: inherit;"> </span><span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">2.3</span></span>
<span id="cb3-28"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">    content</span><span class="kw" style="color: #003B4F;
background-color: null;
font-style: inherit;">: </span><span class="ch" style="color: #20794D;
background-color: null;
font-style: inherit;">|</span></span>
<span id="cb3-29">      다음 데이터 스키마를 표준화하세요:</span>
<span id="cb3-30">      </span>
<span id="cb3-31">      입력 스키마:</span>
<span id="cb3-32">      {schema}</span>
<span id="cb3-33">      </span>
<span id="cb3-34">      표준 형식:</span>
<span id="cb3-35">      - 컬럼명: {target_format}</span>
<span id="cb3-36">      - 날짜: ISO 8601</span>
<span id="cb3-37">      - 문자열: UTF-8</span>
<span id="cb3-38">      </span>
<span id="cb3-39">      출력 형식: JSON</span>
<span id="cb3-40"><span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">  </span></span>
<span id="cb3-41"><span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">  </span><span class="kw" style="color: #003B4F;
background-color: null;
font-style: inherit;">-</span><span class="at" style="color: #657422;
background-color: null;
font-style: inherit;"> </span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">version</span><span class="kw" style="color: #003B4F;
background-color: null;
font-style: inherit;">:</span><span class="at" style="color: #657422;
background-color: null;
font-style: inherit;"> </span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"1.1.0"</span></span>
<span id="cb3-42"><span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">    </span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">created_at</span><span class="kw" style="color: #003B4F;
background-color: null;
font-style: inherit;">:</span><span class="at" style="color: #657422;
background-color: null;
font-style: inherit;"> </span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"2026-02-01"</span></span>
<span id="cb3-43"><span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">    </span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">author</span><span class="kw" style="color: #003B4F;
background-color: null;
font-style: inherit;">:</span><span class="at" style="color: #657422;
background-color: null;
font-style: inherit;"> </span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Platform Team"</span></span>
<span id="cb3-44"><span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">    </span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">changes</span><span class="kw" style="color: #003B4F;
background-color: null;
font-style: inherit;">:</span><span class="at" style="color: #657422;
background-color: null;
font-style: inherit;"> </span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"타입 검증 규칙 추가"</span></span>
<span id="cb3-45"><span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">    </span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">performance</span><span class="kw" style="color: #003B4F;
background-color: null;
font-style: inherit;">:</span></span>
<span id="cb3-46"><span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">      </span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">accuracy</span><span class="kw" style="color: #003B4F;
background-color: null;
font-style: inherit;">:</span><span class="at" style="color: #657422;
background-color: null;
font-style: inherit;"> </span><span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">0.89</span></span>
<span id="cb3-47"><span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">      </span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">avg_time</span><span class="kw" style="color: #003B4F;
background-color: null;
font-style: inherit;">:</span><span class="at" style="color: #657422;
background-color: null;
font-style: inherit;"> </span><span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">2.5</span></span>
<span id="cb3-48"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">    content</span><span class="kw" style="color: #003B4F;
background-color: null;
font-style: inherit;">: </span><span class="ch" style="color: #20794D;
background-color: null;
font-style: inherit;">|</span></span>
<span id="cb3-49">      다음 데이터 스키마를 표준화하세요:</span>
<span id="cb3-50">      </span>
<span id="cb3-51">      입력 스키마:</span>
<span id="cb3-52">      {schema}</span>
<span id="cb3-53">      </span>
<span id="cb3-54">      표준 형식:</span>
<span id="cb3-55">      - 컬럼명: {target_format} (영문 소문자만)</span>
<span id="cb3-56">      - 날짜: ISO 8601 (YYYY-MM-DD)</span>
<span id="cb3-57">      - 문자열: UTF-8 (특수문자 제거)</span>
<span id="cb3-58">      - 타입: string, int, float, date만 허용</span>
<span id="cb3-59">      </span>
<span id="cb3-60">      출력 형식: JSON (필드명: name, type, description)</span>
<span id="cb3-61"><span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">  </span></span>
<span id="cb3-62"><span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">  </span><span class="kw" style="color: #003B4F;
background-color: null;
font-style: inherit;">-</span><span class="at" style="color: #657422;
background-color: null;
font-style: inherit;"> </span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">version</span><span class="kw" style="color: #003B4F;
background-color: null;
font-style: inherit;">:</span><span class="at" style="color: #657422;
background-color: null;
font-style: inherit;"> </span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"1.2.0"</span></span>
<span id="cb3-63"><span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">    </span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">created_at</span><span class="kw" style="color: #003B4F;
background-color: null;
font-style: inherit;">:</span><span class="at" style="color: #657422;
background-color: null;
font-style: inherit;"> </span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"2026-02-02"</span></span>
<span id="cb3-64"><span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">    </span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">author</span><span class="kw" style="color: #003B4F;
background-color: null;
font-style: inherit;">:</span><span class="at" style="color: #657422;
background-color: null;
font-style: inherit;"> </span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Data Team"</span></span>
<span id="cb3-65"><span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">    </span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">changes</span><span class="kw" style="color: #003B4F;
background-color: null;
font-style: inherit;">:</span><span class="at" style="color: #657422;
background-color: null;
font-style: inherit;"> </span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"예시 추가로 성능 개선"</span></span>
<span id="cb3-66"><span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">    </span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">performance</span><span class="kw" style="color: #003B4F;
background-color: null;
font-style: inherit;">:</span></span>
<span id="cb3-67"><span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">      </span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">accuracy</span><span class="kw" style="color: #003B4F;
background-color: null;
font-style: inherit;">:</span><span class="at" style="color: #657422;
background-color: null;
font-style: inherit;"> </span><span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">0.93</span></span>
<span id="cb3-68"><span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">      </span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">avg_time</span><span class="kw" style="color: #003B4F;
background-color: null;
font-style: inherit;">:</span><span class="at" style="color: #657422;
background-color: null;
font-style: inherit;"> </span><span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">2.4</span></span>
<span id="cb3-69"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">    content</span><span class="kw" style="color: #003B4F;
background-color: null;
font-style: inherit;">: </span><span class="ch" style="color: #20794D;
background-color: null;
font-style: inherit;">|</span></span>
<span id="cb3-70">      다음 데이터 스키마를 표준화하세요:</span>
<span id="cb3-71">      </span>
<span id="cb3-72">      입력 스키마:</span>
<span id="cb3-73">      {schema}</span>
<span id="cb3-74">      </span>
<span id="cb3-75">      표준 형식:</span>
<span id="cb3-76">      - 컬럼명: {target_format} (예: '환자번호' → 'patient_id')</span>
<span id="cb3-77">      - 날짜: ISO 8601 (예: '2026-02-02')</span>
<span id="cb3-78">      - 문자열: UTF-8</span>
<span id="cb3-79">      - 타입: string, int, float, date만 허용</span>
<span id="cb3-80">      </span>
<span id="cb3-81">      예시:</span>
<span id="cb3-82">      입력: {{"환자번호": "12345", "진료일": "2026/02/02"}}</span>
<span id="cb3-83">      출력: {{"patient_id": {{"type": "string"}}, "visit_date": {{"type": "date"}}}}</span>
<span id="cb3-84">      </span>
<span id="cb3-85">      출력 형식: JSON</span></code></pre></div>
</section>
<section id="promptregistry-구현" class="level3" data-number="2.2.2">
<h3 data-number="2.2.2" class="anchored" data-anchor-id="promptregistry-구현"><span class="header-section-number">2.2.2</span> PromptRegistry 구현</h3>
<div class="sourceCode" id="cb4" style="background: #f1f3f5;"><pre class="sourceCode numberSource python number-lines code-with-copy"><code class="sourceCode python"><span id="cb4-1"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># shared/prompt_management/registry.py</span></span>
<span id="cb4-2"><span class="im" style="color: #00769E;
background-color: null;
font-style: inherit;">from</span> typing <span class="im" style="color: #00769E;
background-color: null;
font-style: inherit;">import</span> Dict, Optional, List</span>
<span id="cb4-3"><span class="im" style="color: #00769E;
background-color: null;
font-style: inherit;">from</span> pathlib <span class="im" style="color: #00769E;
background-color: null;
font-style: inherit;">import</span> Path</span>
<span id="cb4-4"><span class="im" style="color: #00769E;
background-color: null;
font-style: inherit;">import</span> yaml</span>
<span id="cb4-5"><span class="im" style="color: #00769E;
background-color: null;
font-style: inherit;">from</span> dataclasses <span class="im" style="color: #00769E;
background-color: null;
font-style: inherit;">import</span> dataclass</span>
<span id="cb4-6"><span class="im" style="color: #00769E;
background-color: null;
font-style: inherit;">import</span> logging</span>
<span id="cb4-7"></span>
<span id="cb4-8">logger <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> logging.getLogger(<span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">__name__</span>)</span>
<span id="cb4-9"></span>
<span id="cb4-10"><span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">@dataclass</span></span>
<span id="cb4-11"><span class="kw" style="color: #003B4F;
background-color: null;
font-style: inherit;">class</span> PromptVersion:</span>
<span id="cb4-12">    <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">"""프롬프트 버전 정보"""</span></span>
<span id="cb4-13">    version: <span class="bu" style="color: null;
background-color: null;
font-style: inherit;">str</span></span>
<span id="cb4-14">    content: <span class="bu" style="color: null;
background-color: null;
font-style: inherit;">str</span></span>
<span id="cb4-15">    created_at: <span class="bu" style="color: null;
background-color: null;
font-style: inherit;">str</span></span>
<span id="cb4-16">    author: <span class="bu" style="color: null;
background-color: null;
font-style: inherit;">str</span></span>
<span id="cb4-17">    changes: Optional[<span class="bu" style="color: null;
background-color: null;
font-style: inherit;">str</span>] <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> <span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">None</span></span>
<span id="cb4-18">    performance: Optional[Dict] <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> <span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">None</span></span>
<span id="cb4-19"></span>
<span id="cb4-20"><span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">@dataclass</span></span>
<span id="cb4-21"><span class="kw" style="color: #003B4F;
background-color: null;
font-style: inherit;">class</span> PromptMetadata:</span>
<span id="cb4-22">    <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">"""프롬프트 메타데이터"""</span></span>
<span id="cb4-23">    name: <span class="bu" style="color: null;
background-color: null;
font-style: inherit;">str</span></span>
<span id="cb4-24">    domain: <span class="bu" style="color: null;
background-color: null;
font-style: inherit;">str</span></span>
<span id="cb4-25">    description: <span class="bu" style="color: null;
background-color: null;
font-style: inherit;">str</span></span>
<span id="cb4-26">    tags: List[<span class="bu" style="color: null;
background-color: null;
font-style: inherit;">str</span>]</span>
<span id="cb4-27">    variables: List[Dict]</span>
<span id="cb4-28">    versions: List[PromptVersion]</span>
<span id="cb4-29"></span>
<span id="cb4-30"><span class="kw" style="color: #003B4F;
background-color: null;
font-style: inherit;">class</span> PromptRegistry:</span>
<span id="cb4-31">    <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">"""프롬프트 저장소</span></span>
<span id="cb4-32"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">    </span></span>
<span id="cb4-33"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">    기능:</span></span>
<span id="cb4-34"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">    1. YAML에서 프롬프트 로드</span></span>
<span id="cb4-35"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">    2. 버전별 조회</span></span>
<span id="cb4-36"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">    3. 변경 이력 추적</span></span>
<span id="cb4-37"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">    4. 성능 메트릭 기록</span></span>
<span id="cb4-38"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">    """</span></span>
<span id="cb4-39">    </span>
<span id="cb4-40">    <span class="kw" style="color: #003B4F;
background-color: null;
font-style: inherit;">def</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">__init__</span>(<span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">self</span>, prompts_dir: <span class="bu" style="color: null;
background-color: null;
font-style: inherit;">str</span> <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"shared/prompts"</span>):</span>
<span id="cb4-41">        <span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">self</span>.prompts_dir <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> Path(prompts_dir)</span>
<span id="cb4-42">        <span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">self</span>._prompts: Dict[<span class="bu" style="color: null;
background-color: null;
font-style: inherit;">str</span>, PromptMetadata] <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> {}</span>
<span id="cb4-43">        <span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">self</span>._load_prompts()</span>
<span id="cb4-44">    </span>
<span id="cb4-45">    <span class="kw" style="color: #003B4F;
background-color: null;
font-style: inherit;">def</span> _load_prompts(<span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">self</span>):</span>
<span id="cb4-46">        <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">"""YAML 파일에서 모든 프롬프트 로드"""</span></span>
<span id="cb4-47">        <span class="cf" style="color: #003B4F;
background-color: null;
font-style: inherit;">if</span> <span class="kw" style="color: #003B4F;
background-color: null;
font-style: inherit;">not</span> <span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">self</span>.prompts_dir.exists():</span>
<span id="cb4-48">            logger.warning(<span class="ss" style="color: #20794D;
background-color: null;
font-style: inherit;">f"Prompts directory not found: </span><span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">{</span><span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">self</span><span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">.</span>prompts_dir<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">}</span><span class="ss" style="color: #20794D;
background-color: null;
font-style: inherit;">"</span>)</span>
<span id="cb4-49">            <span class="cf" style="color: #003B4F;
background-color: null;
font-style: inherit;">return</span></span>
<span id="cb4-50">        </span>
<span id="cb4-51">        <span class="cf" style="color: #003B4F;
background-color: null;
font-style: inherit;">for</span> yaml_file <span class="kw" style="color: #003B4F;
background-color: null;
font-style: inherit;">in</span> <span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">self</span>.prompts_dir.glob(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"*.yaml"</span>):</span>
<span id="cb4-52">            <span class="cf" style="color: #003B4F;
background-color: null;
font-style: inherit;">try</span>:</span>
<span id="cb4-53">                <span class="cf" style="color: #003B4F;
background-color: null;
font-style: inherit;">with</span> <span class="bu" style="color: null;
background-color: null;
font-style: inherit;">open</span>(yaml_file) <span class="im" style="color: #00769E;
background-color: null;
font-style: inherit;">as</span> f:</span>
<span id="cb4-54">                    data <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> yaml.safe_load(f)</span>
<span id="cb4-55">                </span>
<span id="cb4-56">                <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># PromptVersion 객체 생성</span></span>
<span id="cb4-57">                versions <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> [</span>
<span id="cb4-58">                    PromptVersion(<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">**</span>v) <span class="cf" style="color: #003B4F;
background-color: null;
font-style: inherit;">for</span> v <span class="kw" style="color: #003B4F;
background-color: null;
font-style: inherit;">in</span> data[<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">'versions'</span>]</span>
<span id="cb4-59">                ]</span>
<span id="cb4-60">                </span>
<span id="cb4-61">                <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># PromptMetadata 생성</span></span>
<span id="cb4-62">                metadata <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> PromptMetadata(</span>
<span id="cb4-63">                    name<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span>data[<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">'name'</span>],</span>
<span id="cb4-64">                    domain<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span>data[<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">'domain'</span>],</span>
<span id="cb4-65">                    description<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span>data[<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">'description'</span>],</span>
<span id="cb4-66">                    tags<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span>data.get(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">'tags'</span>, []),</span>
<span id="cb4-67">                    variables<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span>data.get(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">'variables'</span>, []),</span>
<span id="cb4-68">                    versions<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span>versions</span>
<span id="cb4-69">                )</span>
<span id="cb4-70">                </span>
<span id="cb4-71">                <span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">self</span>._prompts[data[<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">'name'</span>]] <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> metadata</span>
<span id="cb4-72">                logger.info(<span class="ss" style="color: #20794D;
background-color: null;
font-style: inherit;">f"Loaded prompt: </span><span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">{</span>data[<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">'name'</span>]<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">}</span><span class="ss" style="color: #20794D;
background-color: null;
font-style: inherit;"> (</span><span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">{</span><span class="bu" style="color: null;
background-color: null;
font-style: inherit;">len</span>(versions)<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">}</span><span class="ss" style="color: #20794D;
background-color: null;
font-style: inherit;"> versions)"</span>)</span>
<span id="cb4-73">                </span>
<span id="cb4-74">            <span class="cf" style="color: #003B4F;
background-color: null;
font-style: inherit;">except</span> <span class="pp" style="color: #AD0000;
background-color: null;
font-style: inherit;">Exception</span> <span class="im" style="color: #00769E;
background-color: null;
font-style: inherit;">as</span> e:</span>
<span id="cb4-75">                logger.error(<span class="ss" style="color: #20794D;
background-color: null;
font-style: inherit;">f"Failed to load </span><span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">{</span>yaml_file<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">}</span><span class="ss" style="color: #20794D;
background-color: null;
font-style: inherit;">: </span><span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">{</span>e<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">}</span><span class="ss" style="color: #20794D;
background-color: null;
font-style: inherit;">"</span>)</span>
<span id="cb4-76">    </span>
<span id="cb4-77">    <span class="kw" style="color: #003B4F;
background-color: null;
font-style: inherit;">def</span> get(</span>
<span id="cb4-78">        <span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">self</span>,</span>
<span id="cb4-79">        name: <span class="bu" style="color: null;
background-color: null;
font-style: inherit;">str</span>,</span>
<span id="cb4-80">        version: <span class="bu" style="color: null;
background-color: null;
font-style: inherit;">str</span> <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"latest"</span></span>
<span id="cb4-81">    ) <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">-&gt;</span> <span class="bu" style="color: null;
background-color: null;
font-style: inherit;">str</span>:</span>
<span id="cb4-82">        <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">"""프롬프트 조회</span></span>
<span id="cb4-83"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">        </span></span>
<span id="cb4-84"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">        Args:</span></span>
<span id="cb4-85"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">            name: 프롬프트 이름</span></span>
<span id="cb4-86"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">            version: 버전 (latest, 1.0.0, 1.1.0 등)</span></span>
<span id="cb4-87"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">        </span></span>
<span id="cb4-88"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">        Returns:</span></span>
<span id="cb4-89"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">            프롬프트 템플릿 문자열</span></span>
<span id="cb4-90"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">        """</span></span>
<span id="cb4-91">        <span class="cf" style="color: #003B4F;
background-color: null;
font-style: inherit;">if</span> name <span class="kw" style="color: #003B4F;
background-color: null;
font-style: inherit;">not</span> <span class="kw" style="color: #003B4F;
background-color: null;
font-style: inherit;">in</span> <span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">self</span>._prompts:</span>
<span id="cb4-92">            available <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">', '</span>.join(<span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">self</span>._prompts.keys())</span>
<span id="cb4-93">            <span class="cf" style="color: #003B4F;
background-color: null;
font-style: inherit;">raise</span> <span class="pp" style="color: #AD0000;
background-color: null;
font-style: inherit;">ValueError</span>(<span class="ss" style="color: #20794D;
background-color: null;
font-style: inherit;">f"Prompt </span><span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">{</span>name<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">}</span><span class="ss" style="color: #20794D;
background-color: null;
font-style: inherit;"> not found. Available: </span><span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">{</span>available<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">}</span><span class="ss" style="color: #20794D;
background-color: null;
font-style: inherit;">"</span>)</span>
<span id="cb4-94">        </span>
<span id="cb4-95">        prompt_metadata <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> <span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">self</span>._prompts[name]</span>
<span id="cb4-96">        </span>
<span id="cb4-97">        <span class="cf" style="color: #003B4F;
background-color: null;
font-style: inherit;">if</span> version <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">==</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"latest"</span>:</span>
<span id="cb4-98">            <span class="cf" style="color: #003B4F;
background-color: null;
font-style: inherit;">return</span> prompt_metadata.versions[<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">-</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span>].content</span>
<span id="cb4-99">        </span>
<span id="cb4-100">        <span class="cf" style="color: #003B4F;
background-color: null;
font-style: inherit;">for</span> v <span class="kw" style="color: #003B4F;
background-color: null;
font-style: inherit;">in</span> prompt_metadata.versions:</span>
<span id="cb4-101">            <span class="cf" style="color: #003B4F;
background-color: null;
font-style: inherit;">if</span> v.version <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">==</span> version:</span>
<span id="cb4-102">                <span class="cf" style="color: #003B4F;
background-color: null;
font-style: inherit;">return</span> v.content</span>
<span id="cb4-103">        </span>
<span id="cb4-104">        <span class="cf" style="color: #003B4F;
background-color: null;
font-style: inherit;">raise</span> <span class="pp" style="color: #AD0000;
background-color: null;
font-style: inherit;">ValueError</span>(<span class="ss" style="color: #20794D;
background-color: null;
font-style: inherit;">f"Prompt </span><span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">{</span>name<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">}</span><span class="ss" style="color: #20794D;
background-color: null;
font-style: inherit;"> version </span><span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">{</span>version<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">}</span><span class="ss" style="color: #20794D;
background-color: null;
font-style: inherit;"> not found"</span>)</span>
<span id="cb4-105">    </span>
<span id="cb4-106">    <span class="kw" style="color: #003B4F;
background-color: null;
font-style: inherit;">def</span> get_metadata(<span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">self</span>, name: <span class="bu" style="color: null;
background-color: null;
font-style: inherit;">str</span>) <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">-&gt;</span> PromptMetadata:</span>
<span id="cb4-107">        <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">"""프롬프트 메타데이터 조회"""</span></span>
<span id="cb4-108">        <span class="cf" style="color: #003B4F;
background-color: null;
font-style: inherit;">if</span> name <span class="kw" style="color: #003B4F;
background-color: null;
font-style: inherit;">not</span> <span class="kw" style="color: #003B4F;
background-color: null;
font-style: inherit;">in</span> <span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">self</span>._prompts:</span>
<span id="cb4-109">            <span class="cf" style="color: #003B4F;
background-color: null;
font-style: inherit;">raise</span> <span class="pp" style="color: #AD0000;
background-color: null;
font-style: inherit;">ValueError</span>(<span class="ss" style="color: #20794D;
background-color: null;
font-style: inherit;">f"Prompt </span><span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">{</span>name<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">}</span><span class="ss" style="color: #20794D;
background-color: null;
font-style: inherit;"> not found"</span>)</span>
<span id="cb4-110">        <span class="cf" style="color: #003B4F;
background-color: null;
font-style: inherit;">return</span> <span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">self</span>._prompts[name]</span>
<span id="cb4-111">    </span>
<span id="cb4-112">    <span class="kw" style="color: #003B4F;
background-color: null;
font-style: inherit;">def</span> list_versions(<span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">self</span>, name: <span class="bu" style="color: null;
background-color: null;
font-style: inherit;">str</span>) <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">-&gt;</span> List[PromptVersion]:</span>
<span id="cb4-113">        <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">"""프롬프트의 모든 버전 조회"""</span></span>
<span id="cb4-114">        metadata <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> <span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">self</span>.get_metadata(name)</span>
<span id="cb4-115">        <span class="cf" style="color: #003B4F;
background-color: null;
font-style: inherit;">return</span> metadata.versions</span>
<span id="cb4-116">    </span>
<span id="cb4-117">    <span class="kw" style="color: #003B4F;
background-color: null;
font-style: inherit;">def</span> get_performance(<span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">self</span>, name: <span class="bu" style="color: null;
background-color: null;
font-style: inherit;">str</span>, version: <span class="bu" style="color: null;
background-color: null;
font-style: inherit;">str</span>) <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">-&gt;</span> Optional[Dict]:</span>
<span id="cb4-118">        <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">"""특정 버전의 성능 메트릭"""</span></span>
<span id="cb4-119">        versions <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> <span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">self</span>.list_versions(name)</span>
<span id="cb4-120">        </span>
<span id="cb4-121">        <span class="cf" style="color: #003B4F;
background-color: null;
font-style: inherit;">for</span> v <span class="kw" style="color: #003B4F;
background-color: null;
font-style: inherit;">in</span> versions:</span>
<span id="cb4-122">            <span class="cf" style="color: #003B4F;
background-color: null;
font-style: inherit;">if</span> v.version <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">==</span> version:</span>
<span id="cb4-123">                <span class="cf" style="color: #003B4F;
background-color: null;
font-style: inherit;">return</span> v.performance</span>
<span id="cb4-124">        </span>
<span id="cb4-125">        <span class="cf" style="color: #003B4F;
background-color: null;
font-style: inherit;">return</span> <span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">None</span></span>
<span id="cb4-126">    </span>
<span id="cb4-127">    <span class="kw" style="color: #003B4F;
background-color: null;
font-style: inherit;">def</span> list_all(<span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">self</span>) <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">-&gt;</span> List[<span class="bu" style="color: null;
background-color: null;
font-style: inherit;">str</span>]:</span>
<span id="cb4-128">        <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">"""모든 프롬프트 이름 목록"""</span></span>
<span id="cb4-129">        <span class="cf" style="color: #003B4F;
background-color: null;
font-style: inherit;">return</span> <span class="bu" style="color: null;
background-color: null;
font-style: inherit;">list</span>(<span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">self</span>._prompts.keys())</span>
<span id="cb4-130">    </span>
<span id="cb4-131">    <span class="kw" style="color: #003B4F;
background-color: null;
font-style: inherit;">def</span> search_by_tag(<span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">self</span>, tag: <span class="bu" style="color: null;
background-color: null;
font-style: inherit;">str</span>) <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">-&gt;</span> List[<span class="bu" style="color: null;
background-color: null;
font-style: inherit;">str</span>]:</span>
<span id="cb4-132">        <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">"""태그로 프롬프트 검색"""</span></span>
<span id="cb4-133">        <span class="cf" style="color: #003B4F;
background-color: null;
font-style: inherit;">return</span> [</span>
<span id="cb4-134">            name</span>
<span id="cb4-135">            <span class="cf" style="color: #003B4F;
background-color: null;
font-style: inherit;">for</span> name, metadata <span class="kw" style="color: #003B4F;
background-color: null;
font-style: inherit;">in</span> <span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">self</span>._prompts.items()</span>
<span id="cb4-136">            <span class="cf" style="color: #003B4F;
background-color: null;
font-style: inherit;">if</span> tag <span class="kw" style="color: #003B4F;
background-color: null;
font-style: inherit;">in</span> metadata.tags</span>
<span id="cb4-137">        ]</span></code></pre></div>
</section>
</section>
<section id="프롬프트-ab-테스트" class="level2" data-number="2.3">
<h2 data-number="2.3" class="anchored" data-anchor-id="프롬프트-ab-테스트"><span class="header-section-number">2.3</span> 프롬프트 A/B 테스트</h2>
<div class="sourceCode" id="cb5" style="background: #f1f3f5;"><pre class="sourceCode numberSource python number-lines code-with-copy"><code class="sourceCode python"><span id="cb5-1"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># shared/prompt_management/ab_testing.py</span></span>
<span id="cb5-2"><span class="im" style="color: #00769E;
background-color: null;
font-style: inherit;">from</span> typing <span class="im" style="color: #00769E;
background-color: null;
font-style: inherit;">import</span> Dict, Any</span>
<span id="cb5-3"><span class="im" style="color: #00769E;
background-color: null;
font-style: inherit;">import</span> random</span>
<span id="cb5-4"><span class="im" style="color: #00769E;
background-color: null;
font-style: inherit;">from</span> .registry <span class="im" style="color: #00769E;
background-color: null;
font-style: inherit;">import</span> PromptRegistry</span>
<span id="cb5-5"></span>
<span id="cb5-6"><span class="kw" style="color: #003B4F;
background-color: null;
font-style: inherit;">class</span> PromptABTester:</span>
<span id="cb5-7">    <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">"""프롬프트 A/B 테스트</span></span>
<span id="cb5-8"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">    </span></span>
<span id="cb5-9"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">    기능:</span></span>
<span id="cb5-10"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">    1. 두 버전 랜덤 배정</span></span>
<span id="cb5-11"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">    2. 성능 메트릭 수집</span></span>
<span id="cb5-12"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">    3. 통계적 유의성 검증</span></span>
<span id="cb5-13"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">    """</span></span>
<span id="cb5-14">    </span>
<span id="cb5-15">    <span class="kw" style="color: #003B4F;
background-color: null;
font-style: inherit;">def</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">__init__</span>(<span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">self</span>, registry: PromptRegistry):</span>
<span id="cb5-16">        <span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">self</span>.registry <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> registry</span>
<span id="cb5-17">        <span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">self</span>.results: Dict[<span class="bu" style="color: null;
background-color: null;
font-style: inherit;">str</span>, List[<span class="bu" style="color: null;
background-color: null;
font-style: inherit;">float</span>]] <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> {}</span>
<span id="cb5-18">    </span>
<span id="cb5-19">    <span class="kw" style="color: #003B4F;
background-color: null;
font-style: inherit;">def</span> get_test_prompt(</span>
<span id="cb5-20">        <span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">self</span>,</span>
<span id="cb5-21">        name: <span class="bu" style="color: null;
background-color: null;
font-style: inherit;">str</span>,</span>
<span id="cb5-22">        version_a: <span class="bu" style="color: null;
background-color: null;
font-style: inherit;">str</span>,</span>
<span id="cb5-23">        version_b: <span class="bu" style="color: null;
background-color: null;
font-style: inherit;">str</span>,</span>
<span id="cb5-24">        traffic_split: <span class="bu" style="color: null;
background-color: null;
font-style: inherit;">float</span> <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> <span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">0.5</span></span>
<span id="cb5-25">    ) <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">-&gt;</span> <span class="bu" style="color: null;
background-color: null;
font-style: inherit;">tuple</span>[<span class="bu" style="color: null;
background-color: null;
font-style: inherit;">str</span>, <span class="bu" style="color: null;
background-color: null;
font-style: inherit;">str</span>]:</span>
<span id="cb5-26">        <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">"""A/B 테스트용 프롬프트 반환</span></span>
<span id="cb5-27"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">        </span></span>
<span id="cb5-28"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">        Args:</span></span>
<span id="cb5-29"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">            name: 프롬프트 이름</span></span>
<span id="cb5-30"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">            version_a: 버전 A</span></span>
<span id="cb5-31"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">            version_b: 버전 B</span></span>
<span id="cb5-32"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">            traffic_split: A에 할당할 트래픽 비율 (0-1)</span></span>
<span id="cb5-33"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">        </span></span>
<span id="cb5-34"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">        Returns:</span></span>
<span id="cb5-35"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">            (선택된 프롬프트, 선택된 버전)</span></span>
<span id="cb5-36"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">        """</span></span>
<span id="cb5-37">        <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># 랜덤 배정</span></span>
<span id="cb5-38">        <span class="cf" style="color: #003B4F;
background-color: null;
font-style: inherit;">if</span> random.random() <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">&lt;</span> traffic_split:</span>
<span id="cb5-39">            selected_version <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> version_a</span>
<span id="cb5-40">        <span class="cf" style="color: #003B4F;
background-color: null;
font-style: inherit;">else</span>:</span>
<span id="cb5-41">            selected_version <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> version_b</span>
<span id="cb5-42">        </span>
<span id="cb5-43">        prompt <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> <span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">self</span>.registry.get(name, selected_version)</span>
<span id="cb5-44">        <span class="cf" style="color: #003B4F;
background-color: null;
font-style: inherit;">return</span> prompt, selected_version</span>
<span id="cb5-45">    </span>
<span id="cb5-46">    <span class="kw" style="color: #003B4F;
background-color: null;
font-style: inherit;">def</span> record_result(</span>
<span id="cb5-47">        <span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">self</span>,</span>
<span id="cb5-48">        name: <span class="bu" style="color: null;
background-color: null;
font-style: inherit;">str</span>,</span>
<span id="cb5-49">        version: <span class="bu" style="color: null;
background-color: null;
font-style: inherit;">str</span>,</span>
<span id="cb5-50">        score: <span class="bu" style="color: null;
background-color: null;
font-style: inherit;">float</span></span>
<span id="cb5-51">    ):</span>
<span id="cb5-52">        <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">"""테스트 결과 기록"""</span></span>
<span id="cb5-53">        key <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> <span class="ss" style="color: #20794D;
background-color: null;
font-style: inherit;">f"</span><span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">{</span>name<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">}</span><span class="ss" style="color: #20794D;
background-color: null;
font-style: inherit;">:</span><span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">{</span>version<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">}</span><span class="ss" style="color: #20794D;
background-color: null;
font-style: inherit;">"</span></span>
<span id="cb5-54">        </span>
<span id="cb5-55">        <span class="cf" style="color: #003B4F;
background-color: null;
font-style: inherit;">if</span> key <span class="kw" style="color: #003B4F;
background-color: null;
font-style: inherit;">not</span> <span class="kw" style="color: #003B4F;
background-color: null;
font-style: inherit;">in</span> <span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">self</span>.results:</span>
<span id="cb5-56">            <span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">self</span>.results[key] <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> []</span>
<span id="cb5-57">        </span>
<span id="cb5-58">        <span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">self</span>.results[key].append(score)</span>
<span id="cb5-59">    </span>
<span id="cb5-60">    <span class="kw" style="color: #003B4F;
background-color: null;
font-style: inherit;">def</span> compare(</span>
<span id="cb5-61">        <span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">self</span>,</span>
<span id="cb5-62">        name: <span class="bu" style="color: null;
background-color: null;
font-style: inherit;">str</span>,</span>
<span id="cb5-63">        version_a: <span class="bu" style="color: null;
background-color: null;
font-style: inherit;">str</span>,</span>
<span id="cb5-64">        version_b: <span class="bu" style="color: null;
background-color: null;
font-style: inherit;">str</span></span>
<span id="cb5-65">    ) <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">-&gt;</span> Dict[<span class="bu" style="color: null;
background-color: null;
font-style: inherit;">str</span>, Any]:</span>
<span id="cb5-66">        <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">"""두 버전 비교</span></span>
<span id="cb5-67"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">        </span></span>
<span id="cb5-68"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">        Returns:</span></span>
<span id="cb5-69"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">            {</span></span>
<span id="cb5-70"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">                'version_a': {'mean': 0.85, 'std': 0.05, 'n': 100},</span></span>
<span id="cb5-71"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">                'version_b': {'mean': 0.89, 'std': 0.04, 'n': 100},</span></span>
<span id="cb5-72"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">                'winner': 'version_b',</span></span>
<span id="cb5-73"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">                'p_value': 0.001</span></span>
<span id="cb5-74"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">            }</span></span>
<span id="cb5-75"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">        """</span></span>
<span id="cb5-76">        <span class="im" style="color: #00769E;
background-color: null;
font-style: inherit;">import</span> numpy <span class="im" style="color: #00769E;
background-color: null;
font-style: inherit;">as</span> np</span>
<span id="cb5-77">        <span class="im" style="color: #00769E;
background-color: null;
font-style: inherit;">from</span> scipy <span class="im" style="color: #00769E;
background-color: null;
font-style: inherit;">import</span> stats</span>
<span id="cb5-78">        </span>
<span id="cb5-79">        key_a <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> <span class="ss" style="color: #20794D;
background-color: null;
font-style: inherit;">f"</span><span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">{</span>name<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">}</span><span class="ss" style="color: #20794D;
background-color: null;
font-style: inherit;">:</span><span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">{</span>version_a<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">}</span><span class="ss" style="color: #20794D;
background-color: null;
font-style: inherit;">"</span></span>
<span id="cb5-80">        key_b <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> <span class="ss" style="color: #20794D;
background-color: null;
font-style: inherit;">f"</span><span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">{</span>name<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">}</span><span class="ss" style="color: #20794D;
background-color: null;
font-style: inherit;">:</span><span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">{</span>version_b<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">}</span><span class="ss" style="color: #20794D;
background-color: null;
font-style: inherit;">"</span></span>
<span id="cb5-81">        </span>
<span id="cb5-82">        results_a <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> <span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">self</span>.results.get(key_a, [])</span>
<span id="cb5-83">        results_b <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> <span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">self</span>.results.get(key_b, [])</span>
<span id="cb5-84">        </span>
<span id="cb5-85">        <span class="cf" style="color: #003B4F;
background-color: null;
font-style: inherit;">if</span> <span class="bu" style="color: null;
background-color: null;
font-style: inherit;">len</span>(results_a) <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">&lt;</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">30</span> <span class="kw" style="color: #003B4F;
background-color: null;
font-style: inherit;">or</span> <span class="bu" style="color: null;
background-color: null;
font-style: inherit;">len</span>(results_b) <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">&lt;</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">30</span>:</span>
<span id="cb5-86">            <span class="cf" style="color: #003B4F;
background-color: null;
font-style: inherit;">return</span> {</span>
<span id="cb5-87">                <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">'error'</span>: <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">'Not enough samples (minimum 30 per version)'</span>,</span>
<span id="cb5-88">                <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">'samples_a'</span>: <span class="bu" style="color: null;
background-color: null;
font-style: inherit;">len</span>(results_a),</span>
<span id="cb5-89">                <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">'samples_b'</span>: <span class="bu" style="color: null;
background-color: null;
font-style: inherit;">len</span>(results_b)</span>
<span id="cb5-90">            }</span>
<span id="cb5-91">        </span>
<span id="cb5-92">        <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># t-test</span></span>
<span id="cb5-93">        t_stat, p_value <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> stats.ttest_ind(results_a, results_b)</span>
<span id="cb5-94">        </span>
<span id="cb5-95">        mean_a <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> np.mean(results_a)</span>
<span id="cb5-96">        mean_b <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> np.mean(results_b)</span>
<span id="cb5-97">        </span>
<span id="cb5-98">        winner <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> version_a <span class="cf" style="color: #003B4F;
background-color: null;
font-style: inherit;">if</span> mean_a <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">&gt;</span> mean_b <span class="cf" style="color: #003B4F;
background-color: null;
font-style: inherit;">else</span> version_b</span>
<span id="cb5-99">        </span>
<span id="cb5-100">        <span class="cf" style="color: #003B4F;
background-color: null;
font-style: inherit;">return</span> {</span>
<span id="cb5-101">            <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">'version_a'</span>: {</span>
<span id="cb5-102">                <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">'mean'</span>: mean_a,</span>
<span id="cb5-103">                <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">'std'</span>: np.std(results_a),</span>
<span id="cb5-104">                <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">'n'</span>: <span class="bu" style="color: null;
background-color: null;
font-style: inherit;">len</span>(results_a)</span>
<span id="cb5-105">            },</span>
<span id="cb5-106">            <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">'version_b'</span>: {</span>
<span id="cb5-107">                <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">'mean'</span>: mean_b,</span>
<span id="cb5-108">                <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">'std'</span>: np.std(results_b),</span>
<span id="cb5-109">                <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">'n'</span>: <span class="bu" style="color: null;
background-color: null;
font-style: inherit;">len</span>(results_b)</span>
<span id="cb5-110">            },</span>
<span id="cb5-111">            <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">'winner'</span>: winner <span class="cf" style="color: #003B4F;
background-color: null;
font-style: inherit;">if</span> p_value <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">&lt;</span> <span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">0.05</span> <span class="cf" style="color: #003B4F;
background-color: null;
font-style: inherit;">else</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">'no significant difference'</span>,</span>
<span id="cb5-112">            <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">'p_value'</span>: p_value,</span>
<span id="cb5-113">            <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">'significant'</span>: p_value <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">&lt;</span> <span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">0.05</span></span>
<span id="cb5-114">        }</span></code></pre></div>
</section>
<section id="실전-예시-agent에서-프롬프트-사용" class="level2" data-number="2.4">
<h2 data-number="2.4" class="anchored" data-anchor-id="실전-예시-agent에서-프롬프트-사용"><span class="header-section-number">2.4</span> 실전 예시: Agent에서 프롬프트 사용</h2>
<div class="sourceCode" id="cb6" style="background: #f1f3f5;"><pre class="sourceCode numberSource python number-lines code-with-copy"><code class="sourceCode python"><span id="cb6-1"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># agents/data_standardization/agent.py</span></span>
<span id="cb6-2"><span class="im" style="color: #00769E;
background-color: null;
font-style: inherit;">from</span> core.base_agent <span class="im" style="color: #00769E;
background-color: null;
font-style: inherit;">import</span> BaseAgent, AgentMetadata</span>
<span id="cb6-3"><span class="im" style="color: #00769E;
background-color: null;
font-style: inherit;">from</span> shared.llm.client <span class="im" style="color: #00769E;
background-color: null;
font-style: inherit;">import</span> LLMClient</span>
<span id="cb6-4"><span class="im" style="color: #00769E;
background-color: null;
font-style: inherit;">from</span> shared.prompt_management.registry <span class="im" style="color: #00769E;
background-color: null;
font-style: inherit;">import</span> PromptRegistry</span>
<span id="cb6-5"><span class="im" style="color: #00769E;
background-color: null;
font-style: inherit;">from</span> typing <span class="im" style="color: #00769E;
background-color: null;
font-style: inherit;">import</span> Dict, Any</span>
<span id="cb6-6"></span>
<span id="cb6-7"><span class="kw" style="color: #003B4F;
background-color: null;
font-style: inherit;">class</span> DataStandardizationAgent(BaseAgent):</span>
<span id="cb6-8">    <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">"""프롬프트 버전 관리를 사용하는 Agent"""</span></span>
<span id="cb6-9">    </span>
<span id="cb6-10">    <span class="kw" style="color: #003B4F;
background-color: null;
font-style: inherit;">def</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">__init__</span>(<span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">self</span>, metadata: AgentMetadata):</span>
<span id="cb6-11">        <span class="bu" style="color: null;
background-color: null;
font-style: inherit;">super</span>().<span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">__init__</span>(metadata)</span>
<span id="cb6-12">        </span>
<span id="cb6-13">        <span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">self</span>.llm <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> LLMClient()</span>
<span id="cb6-14">        <span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">self</span>.prompt_registry <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> PromptRegistry()</span>
<span id="cb6-15">        </span>
<span id="cb6-16">        <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># 사용할 프롬프트 버전 지정</span></span>
<span id="cb6-17">        <span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">self</span>.prompt_name <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"data_standardization"</span></span>
<span id="cb6-18">        <span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">self</span>.prompt_version <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"1.2.0"</span>  <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># 또는 "latest"</span></span>
<span id="cb6-19">    </span>
<span id="cb6-20">    <span class="kw" style="color: #003B4F;
background-color: null;
font-style: inherit;">def</span> process(<span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">self</span>, <span class="bu" style="color: null;
background-color: null;
font-style: inherit;">input</span>: Dict[<span class="bu" style="color: null;
background-color: null;
font-style: inherit;">str</span>, Any]) <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">-&gt;</span> Dict[<span class="bu" style="color: null;
background-color: null;
font-style: inherit;">str</span>, Any]:</span>
<span id="cb6-21">        <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">"""표준화 로직"""</span></span>
<span id="cb6-22">        schema <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> <span class="bu" style="color: null;
background-color: null;
font-style: inherit;">input</span>[<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">'data'</span>]</span>
<span id="cb6-23">        target_format <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> <span class="bu" style="color: null;
background-color: null;
font-style: inherit;">input</span>.get(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">'config'</span>, {}).get(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">'target_format'</span>, <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">'snake_case'</span>)</span>
<span id="cb6-24">        </span>
<span id="cb6-25">        <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># 1. 프롬프트 템플릿 가져오기</span></span>
<span id="cb6-26">        prompt_template <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> <span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">self</span>.prompt_registry.get(</span>
<span id="cb6-27">            name<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span><span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">self</span>.prompt_name,</span>
<span id="cb6-28">            version<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span><span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">self</span>.prompt_version</span>
<span id="cb6-29">        )</span>
<span id="cb6-30">        </span>
<span id="cb6-31">        <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># 2. 변수 치환</span></span>
<span id="cb6-32">        prompt <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> prompt_template.<span class="bu" style="color: null;
background-color: null;
font-style: inherit;">format</span>(</span>
<span id="cb6-33">            schema<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span>schema,</span>
<span id="cb6-34">            target_format<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span>target_format</span>
<span id="cb6-35">        )</span>
<span id="cb6-36">        </span>
<span id="cb6-37">        <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># 3. LLM 호출</span></span>
<span id="cb6-38">        result <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> <span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">self</span>.llm.generate(prompt, temperature<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span><span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">0.0</span>)</span>
<span id="cb6-39">        </span>
<span id="cb6-40">        <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># 4. 결과 파싱</span></span>
<span id="cb6-41">        <span class="im" style="color: #00769E;
background-color: null;
font-style: inherit;">import</span> json</span>
<span id="cb6-42">        standardized <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> json.loads(result)</span>
<span id="cb6-43">        </span>
<span id="cb6-44">        <span class="cf" style="color: #003B4F;
background-color: null;
font-style: inherit;">return</span> {</span>
<span id="cb6-45">            <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">'result'</span>: standardized,</span>
<span id="cb6-46">            <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">'confidence'</span>: <span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">self</span>._calculate_confidence(standardized),</span>
<span id="cb6-47">            <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">'prompt_version'</span>: <span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">self</span>.prompt_version  <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># 사용한 프롬프트 버전 기록</span></span>
<span id="cb6-48">        }</span>
<span id="cb6-49">    </span>
<span id="cb6-50">    <span class="kw" style="color: #003B4F;
background-color: null;
font-style: inherit;">def</span> _calculate_confidence(<span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">self</span>, result: Dict) <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">-&gt;</span> <span class="bu" style="color: null;
background-color: null;
font-style: inherit;">float</span>:</span>
<span id="cb6-51">        <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">"""신뢰도 계산"""</span></span>
<span id="cb6-52">        <span class="cf" style="color: #003B4F;
background-color: null;
font-style: inherit;">if</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">'fields'</span> <span class="kw" style="color: #003B4F;
background-color: null;
font-style: inherit;">not</span> <span class="kw" style="color: #003B4F;
background-color: null;
font-style: inherit;">in</span> result:</span>
<span id="cb6-53">            <span class="cf" style="color: #003B4F;
background-color: null;
font-style: inherit;">return</span> <span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">0.0</span></span>
<span id="cb6-54">        </span>
<span id="cb6-55">        fields <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> result[<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">'fields'</span>]</span>
<span id="cb6-56">        complete_fields <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> <span class="bu" style="color: null;
background-color: null;
font-style: inherit;">sum</span>(</span>
<span id="cb6-57">            <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span> <span class="cf" style="color: #003B4F;
background-color: null;
font-style: inherit;">for</span> f <span class="kw" style="color: #003B4F;
background-color: null;
font-style: inherit;">in</span> fields</span>
<span id="cb6-58">            <span class="cf" style="color: #003B4F;
background-color: null;
font-style: inherit;">if</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">'type'</span> <span class="kw" style="color: #003B4F;
background-color: null;
font-style: inherit;">in</span> f <span class="kw" style="color: #003B4F;
background-color: null;
font-style: inherit;">and</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">'description'</span> <span class="kw" style="color: #003B4F;
background-color: null;
font-style: inherit;">in</span> f</span>
<span id="cb6-59">        )</span>
<span id="cb6-60">        </span>
<span id="cb6-61">        <span class="cf" style="color: #003B4F;
background-color: null;
font-style: inherit;">return</span> complete_fields <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">/</span> <span class="bu" style="color: null;
background-color: null;
font-style: inherit;">len</span>(fields) <span class="cf" style="color: #003B4F;
background-color: null;
font-style: inherit;">if</span> fields <span class="cf" style="color: #003B4F;
background-color: null;
font-style: inherit;">else</span> <span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">0.0</span></span>
<span id="cb6-62">    </span>
<span id="cb6-63">    <span class="kw" style="color: #003B4F;
background-color: null;
font-style: inherit;">def</span> evaluate(<span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">self</span>, ground_truth: Dict, prediction: Dict) <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">-&gt;</span> <span class="bu" style="color: null;
background-color: null;
font-style: inherit;">float</span>:</span>
<span id="cb6-64">        <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">"""평가"""</span></span>
<span id="cb6-65">        truth_fields <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> {f[<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">'name'</span>] <span class="cf" style="color: #003B4F;
background-color: null;
font-style: inherit;">for</span> f <span class="kw" style="color: #003B4F;
background-color: null;
font-style: inherit;">in</span> ground_truth[<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">'fields'</span>]}</span>
<span id="cb6-66">        pred_fields <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> {f[<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">'name'</span>] <span class="cf" style="color: #003B4F;
background-color: null;
font-style: inherit;">for</span> f <span class="kw" style="color: #003B4F;
background-color: null;
font-style: inherit;">in</span> prediction[<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">'fields'</span>]}</span>
<span id="cb6-67">        </span>
<span id="cb6-68">        intersection <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> <span class="bu" style="color: null;
background-color: null;
font-style: inherit;">len</span>(truth_fields <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">&amp;</span> pred_fields)</span>
<span id="cb6-69">        union <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> <span class="bu" style="color: null;
background-color: null;
font-style: inherit;">len</span>(truth_fields <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">|</span> pred_fields)</span>
<span id="cb6-70">        </span>
<span id="cb6-71">        <span class="cf" style="color: #003B4F;
background-color: null;
font-style: inherit;">return</span> intersection <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">/</span> union <span class="cf" style="color: #003B4F;
background-color: null;
font-style: inherit;">if</span> union <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">&gt;</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">0</span> <span class="cf" style="color: #003B4F;
background-color: null;
font-style: inherit;">else</span> <span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">0.0</span></span></code></pre></div>
<p><strong>사용 예시</strong>:</p>
<div class="sourceCode" id="cb7" style="background: #f1f3f5;"><pre class="sourceCode numberSource python number-lines code-with-copy"><code class="sourceCode python"><span id="cb7-1"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># 프롬프트 A/B 테스트 실행</span></span>
<span id="cb7-2"><span class="im" style="color: #00769E;
background-color: null;
font-style: inherit;">from</span> shared.prompt_management.ab_testing <span class="im" style="color: #00769E;
background-color: null;
font-style: inherit;">import</span> PromptABTester</span>
<span id="cb7-3"></span>
<span id="cb7-4"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># Tester 생성</span></span>
<span id="cb7-5">tester <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> PromptABTester(PromptRegistry())</span>
<span id="cb7-6"></span>
<span id="cb7-7"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># 100번 테스트</span></span>
<span id="cb7-8"><span class="cf" style="color: #003B4F;
background-color: null;
font-style: inherit;">for</span> i <span class="kw" style="color: #003B4F;
background-color: null;
font-style: inherit;">in</span> <span class="bu" style="color: null;
background-color: null;
font-style: inherit;">range</span>(<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">100</span>):</span>
<span id="cb7-9">    <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># A/B 버전 랜덤 선택</span></span>
<span id="cb7-10">    prompt, version <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> tester.get_test_prompt(</span>
<span id="cb7-11">        name<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"data_standardization"</span>,</span>
<span id="cb7-12">        version_a<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"1.1.0"</span>,</span>
<span id="cb7-13">        version_b<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"1.2.0"</span>,</span>
<span id="cb7-14">        traffic_split<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span><span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">0.5</span></span>
<span id="cb7-15">    )</span>
<span id="cb7-16">    </span>
<span id="cb7-17">    <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># Agent 실행</span></span>
<span id="cb7-18">    result <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> agent.process(test_data)</span>
<span id="cb7-19">    score <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> agent.evaluate(ground_truth, result[<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">'result'</span>])</span>
<span id="cb7-20">    </span>
<span id="cb7-21">    <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># 결과 기록</span></span>
<span id="cb7-22">    tester.record_result(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"data_standardization"</span>, version, score)</span>
<span id="cb7-23"></span>
<span id="cb7-24"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># 결과 비교</span></span>
<span id="cb7-25">comparison <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> tester.compare(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"data_standardization"</span>, <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"1.1.0"</span>, <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"1.2.0"</span>)</span>
<span id="cb7-26"><span class="bu" style="color: null;
background-color: null;
font-style: inherit;">print</span>(comparison)</span>
<span id="cb7-27"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># {</span></span>
<span id="cb7-28"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">#     'version_a': {'mean': 0.89, 'std': 0.04, 'n': 50},</span></span>
<span id="cb7-29"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">#     'version_b': {'mean': 0.93, 'std': 0.03, 'n': 50},</span></span>
<span id="cb7-30"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">#     'winner': '1.2.0',</span></span>
<span id="cb7-31"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">#     'p_value': 0.001,</span></span>
<span id="cb7-32"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">#     'significant': True</span></span>
<span id="cb7-33"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># }</span></span></code></pre></div>
</section>
</section>
<section id="벡터-데이터-관리" class="level1" data-number="3">
<h1 data-number="3"><span class="header-section-number">3</span> 벡터 데이터 관리</h1>
<section id="문제-rag-데이터-업데이트" class="level2" data-number="3.1">
<h2 data-number="3.1" class="anchored" data-anchor-id="문제-rag-데이터-업데이트"><span class="header-section-number">3.1</span> 문제: RAG 데이터 업데이트</h2>
<section id="초기-방식-phase-1-2-1" class="level3" data-number="3.1.1">
<h3 data-number="3.1.1" class="anchored" data-anchor-id="초기-방식-phase-1-2-1"><span class="header-section-number">3.1.1</span> 초기 방식 (Phase 1-2)</h3>
<div class="sourceCode" id="cb8" style="background: #f1f3f5;"><pre class="sourceCode numberSource python number-lines code-with-copy"><code class="sourceCode python"><span id="cb8-1"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># ❌ 나쁜 예: 벡터 데이터가 Agent 코드에 포함</span></span>
<span id="cb8-2"><span class="kw" style="color: #003B4F;
background-color: null;
font-style: inherit;">class</span> KnowledgeAgent:</span>
<span id="cb8-3">    <span class="kw" style="color: #003B4F;
background-color: null;
font-style: inherit;">def</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">__init__</span>(<span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">self</span>):</span>
<span id="cb8-4">        <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># Agent 초기화 시 벡터 DB 생성</span></span>
<span id="cb8-5">        <span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">self</span>.vector_db <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> ChromaDB()</span>
<span id="cb8-6">        <span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">self</span>.vector_db.add_documents([</span>
<span id="cb8-7">            <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"문서 1 내용..."</span>,</span>
<span id="cb8-8">            <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"문서 2 내용..."</span>,</span>
<span id="cb8-9">        ])</span>
<span id="cb8-10">    </span>
<span id="cb8-11">    <span class="kw" style="color: #003B4F;
background-color: null;
font-style: inherit;">def</span> process(<span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">self</span>, <span class="bu" style="color: null;
background-color: null;
font-style: inherit;">input</span>):</span>
<span id="cb8-12">        <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># RAG 검색</span></span>
<span id="cb8-13">        docs <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> <span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">self</span>.vector_db.search(<span class="bu" style="color: null;
background-color: null;
font-style: inherit;">input</span>[<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">'query'</span>])</span>
<span id="cb8-14">        <span class="cf" style="color: #003B4F;
background-color: null;
font-style: inherit;">return</span> generate_answer(docs)</span></code></pre></div>
<p><strong>문제점</strong>: 1. <strong>업데이트 어려움</strong>: 문서 추가 시 Agent 재배포 필요 2. <strong>중복</strong>: 여러 Agent가 같은 문서 저장 3. <strong>동기화 불가</strong>: Agent A와 Agent B의 벡터 DB 버전 다름</p>
</section>
<section id="개선-방식-vectorstoremanager" class="level3" data-number="3.1.2">
<h3 data-number="3.1.2" class="anchored" data-anchor-id="개선-방식-vectorstoremanager"><span class="header-section-number">3.1.2</span> 개선 방식: VectorStoreManager</h3>
<div class="sourceCode" id="cb9" style="background: #f1f3f5;"><pre class="sourceCode numberSource python number-lines code-with-copy"><code class="sourceCode python"><span id="cb9-1"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># ✅ 좋은 예: 중앙집중식 벡터 저장소</span></span>
<span id="cb9-2"><span class="kw" style="color: #003B4F;
background-color: null;
font-style: inherit;">class</span> KnowledgeAgent:</span>
<span id="cb9-3">    <span class="kw" style="color: #003B4F;
background-color: null;
font-style: inherit;">def</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">__init__</span>(<span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">self</span>):</span>
<span id="cb9-4">        <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># 공통 벡터 저장소 사용</span></span>
<span id="cb9-5">        <span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">self</span>.vector_manager <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> VectorStoreManager(</span>
<span id="cb9-6">            collection_name<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"knowledge_base"</span></span>
<span id="cb9-7">        )</span>
<span id="cb9-8">    </span>
<span id="cb9-9">    <span class="kw" style="color: #003B4F;
background-color: null;
font-style: inherit;">def</span> process(<span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">self</span>, <span class="bu" style="color: null;
background-color: null;
font-style: inherit;">input</span>):</span>
<span id="cb9-10">        <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># 검색만 수행 (업데이트는 별도 프로세스)</span></span>
<span id="cb9-11">        docs <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> <span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">self</span>.vector_manager.search(<span class="bu" style="color: null;
background-color: null;
font-style: inherit;">input</span>[<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">'query'</span>])</span>
<span id="cb9-12">        <span class="cf" style="color: #003B4F;
background-color: null;
font-style: inherit;">return</span> generate_answer(docs)</span>
<span id="cb9-13"></span>
<span id="cb9-14"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># 별도 업데이트 스크립트</span></span>
<span id="cb9-15"><span class="kw" style="color: #003B4F;
background-color: null;
font-style: inherit;">def</span> update_vector_store():</span>
<span id="cb9-16">    manager <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> VectorStoreManager(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"knowledge_base"</span>)</span>
<span id="cb9-17">    </span>
<span id="cb9-18">    <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># 새 문서 추가 (Agent 재배포 불필요)</span></span>
<span id="cb9-19">    manager.add_documents([</span>
<span id="cb9-20">        {<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"id"</span>: <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"doc_123"</span>, <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"text"</span>: <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"새 문서..."</span>, <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"metadata"</span>: {...}}</span>
<span id="cb9-21">    ])</span></code></pre></div>
</section>
</section>
<section id="vectorstoremanager-구현" class="level2" data-number="3.2">
<h2 data-number="3.2" class="anchored" data-anchor-id="vectorstoremanager-구현"><span class="header-section-number">3.2</span> VectorStoreManager 구현</h2>
<div class="sourceCode" id="cb10" style="background: #f1f3f5;"><pre class="sourceCode numberSource python number-lines code-with-copy"><code class="sourceCode python"><span id="cb10-1"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># shared/vector_store/manager.py</span></span>
<span id="cb10-2"><span class="im" style="color: #00769E;
background-color: null;
font-style: inherit;">from</span> typing <span class="im" style="color: #00769E;
background-color: null;
font-style: inherit;">import</span> List, Dict, Any, Optional</span>
<span id="cb10-3"><span class="im" style="color: #00769E;
background-color: null;
font-style: inherit;">from</span> chromadb <span class="im" style="color: #00769E;
background-color: null;
font-style: inherit;">import</span> Client, Collection</span>
<span id="cb10-4"><span class="im" style="color: #00769E;
background-color: null;
font-style: inherit;">import</span> logging</span>
<span id="cb10-5"></span>
<span id="cb10-6">logger <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> logging.getLogger(<span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">__name__</span>)</span>
<span id="cb10-7"></span>
<span id="cb10-8"><span class="kw" style="color: #003B4F;
background-color: null;
font-style: inherit;">class</span> VectorStoreManager:</span>
<span id="cb10-9">    <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">"""벡터 저장소 관리자</span></span>
<span id="cb10-10"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">    </span></span>
<span id="cb10-11"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">    기능:</span></span>
<span id="cb10-12"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">    1. 문서 추가/업데이트/삭제</span></span>
<span id="cb10-13"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">    2. 검색 (유사도 기반)</span></span>
<span id="cb10-14"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">    3. 메타데이터 필터링</span></span>
<span id="cb10-15"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">    4. 버전 관리</span></span>
<span id="cb10-16"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">    """</span></span>
<span id="cb10-17">    </span>
<span id="cb10-18">    <span class="kw" style="color: #003B4F;
background-color: null;
font-style: inherit;">def</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">__init__</span>(</span>
<span id="cb10-19">        <span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">self</span>,</span>
<span id="cb10-20">        collection_name: <span class="bu" style="color: null;
background-color: null;
font-style: inherit;">str</span>,</span>
<span id="cb10-21">        embedding_model: <span class="bu" style="color: null;
background-color: null;
font-style: inherit;">str</span> <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"text-embedding-ada-002"</span></span>
<span id="cb10-22">    ):</span>
<span id="cb10-23">        <span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">self</span>.collection_name <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> collection_name</span>
<span id="cb10-24">        <span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">self</span>.embedding_model <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> embedding_model</span>
<span id="cb10-25">        </span>
<span id="cb10-26">        <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># ChromaDB 클라이언트</span></span>
<span id="cb10-27">        <span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">self</span>.client <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> Client()</span>
<span id="cb10-28">        <span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">self</span>.collection: Collection <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> <span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">self</span>.client.get_or_create_collection(</span>
<span id="cb10-29">            name<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span>collection_name</span>
<span id="cb10-30">        )</span>
<span id="cb10-31">        </span>
<span id="cb10-32">        logger.info(<span class="ss" style="color: #20794D;
background-color: null;
font-style: inherit;">f"Initialized VectorStore: </span><span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">{</span>collection_name<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">}</span><span class="ss" style="color: #20794D;
background-color: null;
font-style: inherit;">"</span>)</span>
<span id="cb10-33">    </span>
<span id="cb10-34">    <span class="kw" style="color: #003B4F;
background-color: null;
font-style: inherit;">def</span> add_documents(</span>
<span id="cb10-35">        <span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">self</span>,</span>
<span id="cb10-36">        documents: List[Dict[<span class="bu" style="color: null;
background-color: null;
font-style: inherit;">str</span>, Any]],</span>
<span id="cb10-37">        batch_size: <span class="bu" style="color: null;
background-color: null;
font-style: inherit;">int</span> <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">100</span></span>
<span id="cb10-38">    ):</span>
<span id="cb10-39">        <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">"""문서 추가 (배치 처리)</span></span>
<span id="cb10-40"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">        </span></span>
<span id="cb10-41"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">        Args:</span></span>
<span id="cb10-42"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">            documents: 문서 목록</span></span>
<span id="cb10-43"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">                [</span></span>
<span id="cb10-44"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">                    {</span></span>
<span id="cb10-45"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">                        'id': 'doc_1',</span></span>
<span id="cb10-46"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">                        'text': '문서 내용',</span></span>
<span id="cb10-47"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">                        'metadata': {'source': 'wiki', 'date': '2026-02-02'}</span></span>
<span id="cb10-48"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">                    }</span></span>
<span id="cb10-49"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">                ]</span></span>
<span id="cb10-50"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">            batch_size: 배치 크기</span></span>
<span id="cb10-51"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">        """</span></span>
<span id="cb10-52">        total <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> <span class="bu" style="color: null;
background-color: null;
font-style: inherit;">len</span>(documents)</span>
<span id="cb10-53">        logger.info(<span class="ss" style="color: #20794D;
background-color: null;
font-style: inherit;">f"Adding </span><span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">{</span>total<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">}</span><span class="ss" style="color: #20794D;
background-color: null;
font-style: inherit;"> documents to </span><span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">{</span><span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">self</span><span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">.</span>collection_name<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">}</span><span class="ss" style="color: #20794D;
background-color: null;
font-style: inherit;">"</span>)</span>
<span id="cb10-54">        </span>
<span id="cb10-55">        <span class="cf" style="color: #003B4F;
background-color: null;
font-style: inherit;">for</span> i <span class="kw" style="color: #003B4F;
background-color: null;
font-style: inherit;">in</span> <span class="bu" style="color: null;
background-color: null;
font-style: inherit;">range</span>(<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">0</span>, total, batch_size):</span>
<span id="cb10-56">            batch <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> documents[i:i<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span>batch_size]</span>
<span id="cb10-57">            </span>
<span id="cb10-58">            ids <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> [doc[<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">'id'</span>] <span class="cf" style="color: #003B4F;
background-color: null;
font-style: inherit;">for</span> doc <span class="kw" style="color: #003B4F;
background-color: null;
font-style: inherit;">in</span> batch]</span>
<span id="cb10-59">            texts <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> [doc[<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">'text'</span>] <span class="cf" style="color: #003B4F;
background-color: null;
font-style: inherit;">for</span> doc <span class="kw" style="color: #003B4F;
background-color: null;
font-style: inherit;">in</span> batch]</span>
<span id="cb10-60">            metadatas <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> [doc.get(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">'metadata'</span>, {}) <span class="cf" style="color: #003B4F;
background-color: null;
font-style: inherit;">for</span> doc <span class="kw" style="color: #003B4F;
background-color: null;
font-style: inherit;">in</span> batch]</span>
<span id="cb10-61">            </span>
<span id="cb10-62">            <span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">self</span>.collection.add(</span>
<span id="cb10-63">                ids<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span>ids,</span>
<span id="cb10-64">                documents<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span>texts,</span>
<span id="cb10-65">                metadatas<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span>metadatas</span>
<span id="cb10-66">            )</span>
<span id="cb10-67">            </span>
<span id="cb10-68">            logger.info(<span class="ss" style="color: #20794D;
background-color: null;
font-style: inherit;">f"Added batch </span><span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">{</span>i<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">//</span>batch_size <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span><span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">}</span><span class="ss" style="color: #20794D;
background-color: null;
font-style: inherit;">/</span><span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">{</span>(total <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span> batch_size <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">-</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span>)<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">//</span>batch_size<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">}</span><span class="ss" style="color: #20794D;
background-color: null;
font-style: inherit;">"</span>)</span>
<span id="cb10-69">        </span>
<span id="cb10-70">        logger.info(<span class="ss" style="color: #20794D;
background-color: null;
font-style: inherit;">f"Successfully added </span><span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">{</span>total<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">}</span><span class="ss" style="color: #20794D;
background-color: null;
font-style: inherit;"> documents"</span>)</span>
<span id="cb10-71">    </span>
<span id="cb10-72">    <span class="kw" style="color: #003B4F;
background-color: null;
font-style: inherit;">def</span> update_document(</span>
<span id="cb10-73">        <span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">self</span>,</span>
<span id="cb10-74">        doc_id: <span class="bu" style="color: null;
background-color: null;
font-style: inherit;">str</span>,</span>
<span id="cb10-75">        new_text: Optional[<span class="bu" style="color: null;
background-color: null;
font-style: inherit;">str</span>] <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> <span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">None</span>,</span>
<span id="cb10-76">        new_metadata: Optional[Dict] <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> <span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">None</span></span>
<span id="cb10-77">    ):</span>
<span id="cb10-78">        <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">"""문서 업데이트</span></span>
<span id="cb10-79"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">        </span></span>
<span id="cb10-80"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">        Args:</span></span>
<span id="cb10-81"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">            doc_id: 문서 ID</span></span>
<span id="cb10-82"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">            new_text: 새 텍스트 (선택)</span></span>
<span id="cb10-83"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">            new_metadata: 새 메타데이터 (선택)</span></span>
<span id="cb10-84"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">        """</span></span>
<span id="cb10-85">        update_kwargs <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> {<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">'ids'</span>: [doc_id]}</span>
<span id="cb10-86">        </span>
<span id="cb10-87">        <span class="cf" style="color: #003B4F;
background-color: null;
font-style: inherit;">if</span> new_text:</span>
<span id="cb10-88">            update_kwargs[<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">'documents'</span>] <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> [new_text]</span>
<span id="cb10-89">        </span>
<span id="cb10-90">        <span class="cf" style="color: #003B4F;
background-color: null;
font-style: inherit;">if</span> new_metadata:</span>
<span id="cb10-91">            update_kwargs[<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">'metadatas'</span>] <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> [new_metadata]</span>
<span id="cb10-92">        </span>
<span id="cb10-93">        <span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">self</span>.collection.update(<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">**</span>update_kwargs)</span>
<span id="cb10-94">        logger.info(<span class="ss" style="color: #20794D;
background-color: null;
font-style: inherit;">f"Updated document: </span><span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">{</span>doc_id<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">}</span><span class="ss" style="color: #20794D;
background-color: null;
font-style: inherit;">"</span>)</span>
<span id="cb10-95">    </span>
<span id="cb10-96">    <span class="kw" style="color: #003B4F;
background-color: null;
font-style: inherit;">def</span> delete_documents(<span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">self</span>, doc_ids: List[<span class="bu" style="color: null;
background-color: null;
font-style: inherit;">str</span>]):</span>
<span id="cb10-97">        <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">"""문서 삭제"""</span></span>
<span id="cb10-98">        <span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">self</span>.collection.delete(ids<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span>doc_ids)</span>
<span id="cb10-99">        logger.info(<span class="ss" style="color: #20794D;
background-color: null;
font-style: inherit;">f"Deleted </span><span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">{</span><span class="bu" style="color: null;
background-color: null;
font-style: inherit;">len</span>(doc_ids)<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">}</span><span class="ss" style="color: #20794D;
background-color: null;
font-style: inherit;"> documents"</span>)</span>
<span id="cb10-100">    </span>
<span id="cb10-101">    <span class="kw" style="color: #003B4F;
background-color: null;
font-style: inherit;">def</span> search(</span>
<span id="cb10-102">        <span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">self</span>,</span>
<span id="cb10-103">        query: <span class="bu" style="color: null;
background-color: null;
font-style: inherit;">str</span>,</span>
<span id="cb10-104">        n_results: <span class="bu" style="color: null;
background-color: null;
font-style: inherit;">int</span> <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">5</span>,</span>
<span id="cb10-105">        metadata_filter: Optional[Dict] <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> <span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">None</span></span>
<span id="cb10-106">    ) <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">-&gt;</span> List[Dict[<span class="bu" style="color: null;
background-color: null;
font-style: inherit;">str</span>, Any]]:</span>
<span id="cb10-107">        <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">"""유사도 검색</span></span>
<span id="cb10-108"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">        </span></span>
<span id="cb10-109"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">        Args:</span></span>
<span id="cb10-110"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">            query: 검색 쿼리</span></span>
<span id="cb10-111"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">            n_results: 반환할 문서 수</span></span>
<span id="cb10-112"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">            metadata_filter: 메타데이터 필터</span></span>
<span id="cb10-113"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">                예: {'source': 'wiki', 'date': {'$gte': '2026-01-01'}}</span></span>
<span id="cb10-114"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">        </span></span>
<span id="cb10-115"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">        Returns:</span></span>
<span id="cb10-116"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">            검색 결과 목록</span></span>
<span id="cb10-117"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">                [</span></span>
<span id="cb10-118"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">                    {</span></span>
<span id="cb10-119"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">                        'id': 'doc_1',</span></span>
<span id="cb10-120"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">                        'text': '문서 내용',</span></span>
<span id="cb10-121"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">                        'metadata': {...},</span></span>
<span id="cb10-122"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">                        'distance': 0.15</span></span>
<span id="cb10-123"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">                    }</span></span>
<span id="cb10-124"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">                ]</span></span>
<span id="cb10-125"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">        """</span></span>
<span id="cb10-126">        query_kwargs <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> {</span>
<span id="cb10-127">            <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">'query_texts'</span>: [query],</span>
<span id="cb10-128">            <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">'n_results'</span>: n_results</span>
<span id="cb10-129">        }</span>
<span id="cb10-130">        </span>
<span id="cb10-131">        <span class="cf" style="color: #003B4F;
background-color: null;
font-style: inherit;">if</span> metadata_filter:</span>
<span id="cb10-132">            query_kwargs[<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">'where'</span>] <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> metadata_filter</span>
<span id="cb10-133">        </span>
<span id="cb10-134">        results <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> <span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">self</span>.collection.query(<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">**</span>query_kwargs)</span>
<span id="cb10-135">        </span>
<span id="cb10-136">        <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># 결과 포맷팅</span></span>
<span id="cb10-137">        formatted_results <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> []</span>
<span id="cb10-138">        <span class="cf" style="color: #003B4F;
background-color: null;
font-style: inherit;">for</span> i <span class="kw" style="color: #003B4F;
background-color: null;
font-style: inherit;">in</span> <span class="bu" style="color: null;
background-color: null;
font-style: inherit;">range</span>(<span class="bu" style="color: null;
background-color: null;
font-style: inherit;">len</span>(results[<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">'ids'</span>][<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">0</span>])):</span>
<span id="cb10-139">            formatted_results.append({</span>
<span id="cb10-140">                <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">'id'</span>: results[<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">'ids'</span>][<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">0</span>][i],</span>
<span id="cb10-141">                <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">'text'</span>: results[<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">'documents'</span>][<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">0</span>][i],</span>
<span id="cb10-142">                <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">'metadata'</span>: results[<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">'metadatas'</span>][<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">0</span>][i],</span>
<span id="cb10-143">                <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">'distance'</span>: results[<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">'distances'</span>][<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">0</span>][i]</span>
<span id="cb10-144">            })</span>
<span id="cb10-145">        </span>
<span id="cb10-146">        <span class="cf" style="color: #003B4F;
background-color: null;
font-style: inherit;">return</span> formatted_results</span>
<span id="cb10-147">    </span>
<span id="cb10-148">    <span class="kw" style="color: #003B4F;
background-color: null;
font-style: inherit;">def</span> get_stats(<span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">self</span>) <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">-&gt;</span> Dict[<span class="bu" style="color: null;
background-color: null;
font-style: inherit;">str</span>, Any]:</span>
<span id="cb10-149">        <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">"""저장소 통계"""</span></span>
<span id="cb10-150">        count <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> <span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">self</span>.collection.count()</span>
<span id="cb10-151">        </span>
<span id="cb10-152">        <span class="cf" style="color: #003B4F;
background-color: null;
font-style: inherit;">return</span> {</span>
<span id="cb10-153">            <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">'collection_name'</span>: <span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">self</span>.collection_name,</span>
<span id="cb10-154">            <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">'document_count'</span>: count,</span>
<span id="cb10-155">            <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">'embedding_model'</span>: <span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">self</span>.embedding_model</span>
<span id="cb10-156">        }</span>
<span id="cb10-157">    </span>
<span id="cb10-158">    <span class="kw" style="color: #003B4F;
background-color: null;
font-style: inherit;">def</span> export_metadata(<span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">self</span>) <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">-&gt;</span> List[Dict]:</span>
<span id="cb10-159">        <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">"""모든 문서의 메타데이터 추출"""</span></span>
<span id="cb10-160">        results <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> <span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">self</span>.collection.get()</span>
<span id="cb10-161">        </span>
<span id="cb10-162">        metadata_list <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> []</span>
<span id="cb10-163">        <span class="cf" style="color: #003B4F;
background-color: null;
font-style: inherit;">for</span> i <span class="kw" style="color: #003B4F;
background-color: null;
font-style: inherit;">in</span> <span class="bu" style="color: null;
background-color: null;
font-style: inherit;">range</span>(<span class="bu" style="color: null;
background-color: null;
font-style: inherit;">len</span>(results[<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">'ids'</span>])):</span>
<span id="cb10-164">            metadata_list.append({</span>
<span id="cb10-165">                <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">'id'</span>: results[<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">'ids'</span>][i],</span>
<span id="cb10-166">                <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">'metadata'</span>: results[<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">'metadatas'</span>][i]</span>
<span id="cb10-167">            })</span>
<span id="cb10-168">        </span>
<span id="cb10-169">        <span class="cf" style="color: #003B4F;
background-color: null;
font-style: inherit;">return</span> metadata_list</span></code></pre></div>
</section>
<section id="자동-업데이트-스크립트" class="level2" data-number="3.3">
<h2 data-number="3.3" class="anchored" data-anchor-id="자동-업데이트-스크립트"><span class="header-section-number">3.3</span> 자동 업데이트 스크립트</h2>
<div class="sourceCode" id="cb11" style="background: #f1f3f5;"><pre class="sourceCode numberSource python number-lines code-with-copy"><code class="sourceCode python"><span id="cb11-1"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># shared/vector_store/updater.py</span></span>
<span id="cb11-2"><span class="im" style="color: #00769E;
background-color: null;
font-style: inherit;">from</span> pathlib <span class="im" style="color: #00769E;
background-color: null;
font-style: inherit;">import</span> Path</span>
<span id="cb11-3"><span class="im" style="color: #00769E;
background-color: null;
font-style: inherit;">from</span> typing <span class="im" style="color: #00769E;
background-color: null;
font-style: inherit;">import</span> List, Dict, Any</span>
<span id="cb11-4"><span class="im" style="color: #00769E;
background-color: null;
font-style: inherit;">import</span> hashlib</span>
<span id="cb11-5"><span class="im" style="color: #00769E;
background-color: null;
font-style: inherit;">import</span> json</span>
<span id="cb11-6"><span class="im" style="color: #00769E;
background-color: null;
font-style: inherit;">import</span> logging</span>
<span id="cb11-7"></span>
<span id="cb11-8">logger <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> logging.getLogger(<span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">__name__</span>)</span>
<span id="cb11-9"></span>
<span id="cb11-10"><span class="kw" style="color: #003B4F;
background-color: null;
font-style: inherit;">class</span> VectorStoreUpdater:</span>
<span id="cb11-11">    <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">"""벡터 저장소 자동 업데이트</span></span>
<span id="cb11-12"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">    </span></span>
<span id="cb11-13"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">    기능:</span></span>
<span id="cb11-14"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">    1. 파일 변경 감지 (해시 기반)</span></span>
<span id="cb11-15"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">    2. 증분 업데이트</span></span>
<span id="cb11-16"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">    3. 변경 이력 추적</span></span>
<span id="cb11-17"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">    """</span></span>
<span id="cb11-18">    </span>
<span id="cb11-19">    <span class="kw" style="color: #003B4F;
background-color: null;
font-style: inherit;">def</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">__init__</span>(</span>
<span id="cb11-20">        <span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">self</span>,</span>
<span id="cb11-21">        manager: VectorStoreManager,</span>
<span id="cb11-22">        data_dir: <span class="bu" style="color: null;
background-color: null;
font-style: inherit;">str</span>,</span>
<span id="cb11-23">        cache_file: <span class="bu" style="color: null;
background-color: null;
font-style: inherit;">str</span> <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">".vector_cache.json"</span></span>
<span id="cb11-24">    ):</span>
<span id="cb11-25">        <span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">self</span>.manager <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> manager</span>
<span id="cb11-26">        <span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">self</span>.data_dir <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> Path(data_dir)</span>
<span id="cb11-27">        <span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">self</span>.cache_file <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> cache_file</span>
<span id="cb11-28">        </span>
<span id="cb11-29">        <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># 이전 해시 로드</span></span>
<span id="cb11-30">        <span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">self</span>.previous_hashes <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> <span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">self</span>._load_cache()</span>
<span id="cb11-31">    </span>
<span id="cb11-32">    <span class="kw" style="color: #003B4F;
background-color: null;
font-style: inherit;">def</span> _load_cache(<span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">self</span>) <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">-&gt;</span> Dict[<span class="bu" style="color: null;
background-color: null;
font-style: inherit;">str</span>, <span class="bu" style="color: null;
background-color: null;
font-style: inherit;">str</span>]:</span>
<span id="cb11-33">        <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">"""캐시 파일 로드 (파일 → 해시)"""</span></span>
<span id="cb11-34">        <span class="cf" style="color: #003B4F;
background-color: null;
font-style: inherit;">if</span> <span class="kw" style="color: #003B4F;
background-color: null;
font-style: inherit;">not</span> Path(<span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">self</span>.cache_file).exists():</span>
<span id="cb11-35">            <span class="cf" style="color: #003B4F;
background-color: null;
font-style: inherit;">return</span> {}</span>
<span id="cb11-36">        </span>
<span id="cb11-37">        <span class="cf" style="color: #003B4F;
background-color: null;
font-style: inherit;">with</span> <span class="bu" style="color: null;
background-color: null;
font-style: inherit;">open</span>(<span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">self</span>.cache_file) <span class="im" style="color: #00769E;
background-color: null;
font-style: inherit;">as</span> f:</span>
<span id="cb11-38">            <span class="cf" style="color: #003B4F;
background-color: null;
font-style: inherit;">return</span> json.load(f)</span>
<span id="cb11-39">    </span>
<span id="cb11-40">    <span class="kw" style="color: #003B4F;
background-color: null;
font-style: inherit;">def</span> _save_cache(<span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">self</span>):</span>
<span id="cb11-41">        <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">"""캐시 파일 저장"""</span></span>
<span id="cb11-42">        <span class="cf" style="color: #003B4F;
background-color: null;
font-style: inherit;">with</span> <span class="bu" style="color: null;
background-color: null;
font-style: inherit;">open</span>(<span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">self</span>.cache_file, <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">'w'</span>) <span class="im" style="color: #00769E;
background-color: null;
font-style: inherit;">as</span> f:</span>
<span id="cb11-43">            json.dump(<span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">self</span>.previous_hashes, f, indent<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">2</span>)</span>
<span id="cb11-44">    </span>
<span id="cb11-45">    <span class="kw" style="color: #003B4F;
background-color: null;
font-style: inherit;">def</span> _calculate_hash(<span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">self</span>, file_path: Path) <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">-&gt;</span> <span class="bu" style="color: null;
background-color: null;
font-style: inherit;">str</span>:</span>
<span id="cb11-46">        <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">"""파일 해시 계산"""</span></span>
<span id="cb11-47">        <span class="cf" style="color: #003B4F;
background-color: null;
font-style: inherit;">with</span> <span class="bu" style="color: null;
background-color: null;
font-style: inherit;">open</span>(file_path, <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">'rb'</span>) <span class="im" style="color: #00769E;
background-color: null;
font-style: inherit;">as</span> f:</span>
<span id="cb11-48">            <span class="cf" style="color: #003B4F;
background-color: null;
font-style: inherit;">return</span> hashlib.md5(f.read()).hexdigest()</span>
<span id="cb11-49">    </span>
<span id="cb11-50">    <span class="kw" style="color: #003B4F;
background-color: null;
font-style: inherit;">def</span> detect_changes(<span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">self</span>) <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">-&gt;</span> <span class="bu" style="color: null;
background-color: null;
font-style: inherit;">tuple</span>[List[Path], List[Path], List[<span class="bu" style="color: null;
background-color: null;
font-style: inherit;">str</span>]]:</span>
<span id="cb11-51">        <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">"""변경 감지</span></span>
<span id="cb11-52"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">        </span></span>
<span id="cb11-53"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">        Returns:</span></span>
<span id="cb11-54"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">            (추가된 파일, 수정된 파일, 삭제된 파일 ID)</span></span>
<span id="cb11-55"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">        """</span></span>
<span id="cb11-56">        added <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> []</span>
<span id="cb11-57">        modified <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> []</span>
<span id="cb11-58">        </span>
<span id="cb11-59">        current_files <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> {}</span>
<span id="cb11-60">        </span>
<span id="cb11-61">        <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># 현재 파일 스캔</span></span>
<span id="cb11-62">        <span class="cf" style="color: #003B4F;
background-color: null;
font-style: inherit;">for</span> file_path <span class="kw" style="color: #003B4F;
background-color: null;
font-style: inherit;">in</span> <span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">self</span>.data_dir.rglob(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"*.txt"</span>):</span>
<span id="cb11-63">            file_hash <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> <span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">self</span>._calculate_hash(file_path)</span>
<span id="cb11-64">            current_files[<span class="bu" style="color: null;
background-color: null;
font-style: inherit;">str</span>(file_path)] <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> file_hash</span>
<span id="cb11-65">            </span>
<span id="cb11-66">            <span class="cf" style="color: #003B4F;
background-color: null;
font-style: inherit;">if</span> <span class="bu" style="color: null;
background-color: null;
font-style: inherit;">str</span>(file_path) <span class="kw" style="color: #003B4F;
background-color: null;
font-style: inherit;">not</span> <span class="kw" style="color: #003B4F;
background-color: null;
font-style: inherit;">in</span> <span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">self</span>.previous_hashes:</span>
<span id="cb11-67">                <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># 신규 파일</span></span>
<span id="cb11-68">                added.append(file_path)</span>
<span id="cb11-69">            <span class="cf" style="color: #003B4F;
background-color: null;
font-style: inherit;">elif</span> <span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">self</span>.previous_hashes[<span class="bu" style="color: null;
background-color: null;
font-style: inherit;">str</span>(file_path)] <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">!=</span> file_hash:</span>
<span id="cb11-70">                <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># 수정된 파일</span></span>
<span id="cb11-71">                modified.append(file_path)</span>
<span id="cb11-72">        </span>
<span id="cb11-73">        <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># 삭제된 파일 찾기</span></span>
<span id="cb11-74">        deleted_files <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> <span class="bu" style="color: null;
background-color: null;
font-style: inherit;">set</span>(<span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">self</span>.previous_hashes.keys()) <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">-</span> <span class="bu" style="color: null;
background-color: null;
font-style: inherit;">set</span>(current_files.keys())</span>
<span id="cb11-75">        deleted_ids <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> [<span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">self</span>._file_to_id(Path(f)) <span class="cf" style="color: #003B4F;
background-color: null;
font-style: inherit;">for</span> f <span class="kw" style="color: #003B4F;
background-color: null;
font-style: inherit;">in</span> deleted_files]</span>
<span id="cb11-76">        </span>
<span id="cb11-77">        <span class="cf" style="color: #003B4F;
background-color: null;
font-style: inherit;">return</span> added, modified, deleted_ids</span>
<span id="cb11-78">    </span>
<span id="cb11-79">    <span class="kw" style="color: #003B4F;
background-color: null;
font-style: inherit;">def</span> _file_to_id(<span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">self</span>, file_path: Path) <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">-&gt;</span> <span class="bu" style="color: null;
background-color: null;
font-style: inherit;">str</span>:</span>
<span id="cb11-80">        <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">"""파일 경로 → 문서 ID"""</span></span>
<span id="cb11-81">        <span class="cf" style="color: #003B4F;
background-color: null;
font-style: inherit;">return</span> <span class="ss" style="color: #20794D;
background-color: null;
font-style: inherit;">f"doc_</span><span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">{</span>file_path<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">.</span>stem<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">}</span><span class="ss" style="color: #20794D;
background-color: null;
font-style: inherit;">"</span></span>
<span id="cb11-82">    </span>
<span id="cb11-83">    <span class="kw" style="color: #003B4F;
background-color: null;
font-style: inherit;">def</span> _file_to_document(<span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">self</span>, file_path: Path) <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">-&gt;</span> Dict[<span class="bu" style="color: null;
background-color: null;
font-style: inherit;">str</span>, Any]:</span>
<span id="cb11-84">        <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">"""파일 → 문서 딕셔너리"""</span></span>
<span id="cb11-85">        <span class="cf" style="color: #003B4F;
background-color: null;
font-style: inherit;">with</span> <span class="bu" style="color: null;
background-color: null;
font-style: inherit;">open</span>(file_path) <span class="im" style="color: #00769E;
background-color: null;
font-style: inherit;">as</span> f:</span>
<span id="cb11-86">            text <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> f.read()</span>
<span id="cb11-87">        </span>
<span id="cb11-88">        <span class="cf" style="color: #003B4F;
background-color: null;
font-style: inherit;">return</span> {</span>
<span id="cb11-89">            <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">'id'</span>: <span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">self</span>._file_to_id(file_path),</span>
<span id="cb11-90">            <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">'text'</span>: text,</span>
<span id="cb11-91">            <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">'metadata'</span>: {</span>
<span id="cb11-92">                <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">'source'</span>: <span class="bu" style="color: null;
background-color: null;
font-style: inherit;">str</span>(file_path),</span>
<span id="cb11-93">                <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">'updated_at'</span>: file_path.stat().st_mtime</span>
<span id="cb11-94">            }</span>
<span id="cb11-95">        }</span>
<span id="cb11-96">    </span>
<span id="cb11-97">    <span class="kw" style="color: #003B4F;
background-color: null;
font-style: inherit;">def</span> update(<span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">self</span>) <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">-&gt;</span> Dict[<span class="bu" style="color: null;
background-color: null;
font-style: inherit;">str</span>, <span class="bu" style="color: null;
background-color: null;
font-style: inherit;">int</span>]:</span>
<span id="cb11-98">        <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">"""증분 업데이트 실행</span></span>
<span id="cb11-99"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">        </span></span>
<span id="cb11-100"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">        Returns:</span></span>
<span id="cb11-101"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">            {'added': 5, 'modified': 2, 'deleted': 1}</span></span>
<span id="cb11-102"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">        """</span></span>
<span id="cb11-103">        logger.info(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Detecting changes..."</span>)</span>
<span id="cb11-104">        added_files, modified_files, deleted_ids <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> <span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">self</span>.detect_changes()</span>
<span id="cb11-105">        </span>
<span id="cb11-106">        <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># 추가</span></span>
<span id="cb11-107">        <span class="cf" style="color: #003B4F;
background-color: null;
font-style: inherit;">if</span> added_files:</span>
<span id="cb11-108">            docs <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> [<span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">self</span>._file_to_document(f) <span class="cf" style="color: #003B4F;
background-color: null;
font-style: inherit;">for</span> f <span class="kw" style="color: #003B4F;
background-color: null;
font-style: inherit;">in</span> added_files]</span>
<span id="cb11-109">            <span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">self</span>.manager.add_documents(docs)</span>
<span id="cb11-110">            logger.info(<span class="ss" style="color: #20794D;
background-color: null;
font-style: inherit;">f"Added </span><span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">{</span><span class="bu" style="color: null;
background-color: null;
font-style: inherit;">len</span>(added_files)<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">}</span><span class="ss" style="color: #20794D;
background-color: null;
font-style: inherit;"> documents"</span>)</span>
<span id="cb11-111">        </span>
<span id="cb11-112">        <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># 수정</span></span>
<span id="cb11-113">        <span class="cf" style="color: #003B4F;
background-color: null;
font-style: inherit;">if</span> modified_files:</span>
<span id="cb11-114">            <span class="cf" style="color: #003B4F;
background-color: null;
font-style: inherit;">for</span> file_path <span class="kw" style="color: #003B4F;
background-color: null;
font-style: inherit;">in</span> modified_files:</span>
<span id="cb11-115">                doc <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> <span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">self</span>._file_to_document(file_path)</span>
<span id="cb11-116">                <span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">self</span>.manager.update_document(</span>
<span id="cb11-117">                    doc_id<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span>doc[<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">'id'</span>],</span>
<span id="cb11-118">                    new_text<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span>doc[<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">'text'</span>],</span>
<span id="cb11-119">                    new_metadata<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span>doc[<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">'metadata'</span>]</span>
<span id="cb11-120">                )</span>
<span id="cb11-121">            logger.info(<span class="ss" style="color: #20794D;
background-color: null;
font-style: inherit;">f"Modified </span><span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">{</span><span class="bu" style="color: null;
background-color: null;
font-style: inherit;">len</span>(modified_files)<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">}</span><span class="ss" style="color: #20794D;
background-color: null;
font-style: inherit;"> documents"</span>)</span>
<span id="cb11-122">        </span>
<span id="cb11-123">        <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># 삭제</span></span>
<span id="cb11-124">        <span class="cf" style="color: #003B4F;
background-color: null;
font-style: inherit;">if</span> deleted_ids:</span>
<span id="cb11-125">            <span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">self</span>.manager.delete_documents(deleted_ids)</span>
<span id="cb11-126">            logger.info(<span class="ss" style="color: #20794D;
background-color: null;
font-style: inherit;">f"Deleted </span><span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">{</span><span class="bu" style="color: null;
background-color: null;
font-style: inherit;">len</span>(deleted_ids)<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">}</span><span class="ss" style="color: #20794D;
background-color: null;
font-style: inherit;"> documents"</span>)</span>
<span id="cb11-127">        </span>
<span id="cb11-128">        <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># 캐시 업데이트</span></span>
<span id="cb11-129">        <span class="cf" style="color: #003B4F;
background-color: null;
font-style: inherit;">for</span> file_path <span class="kw" style="color: #003B4F;
background-color: null;
font-style: inherit;">in</span> added_files <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span> modified_files:</span>
<span id="cb11-130">            file_hash <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> <span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">self</span>._calculate_hash(file_path)</span>
<span id="cb11-131">            <span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">self</span>.previous_hashes[<span class="bu" style="color: null;
background-color: null;
font-style: inherit;">str</span>(file_path)] <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> file_hash</span>
<span id="cb11-132">        </span>
<span id="cb11-133">        <span class="cf" style="color: #003B4F;
background-color: null;
font-style: inherit;">for</span> deleted_file <span class="kw" style="color: #003B4F;
background-color: null;
font-style: inherit;">in</span> deleted_ids:</span>
<span id="cb11-134">            <span class="cf" style="color: #003B4F;
background-color: null;
font-style: inherit;">if</span> deleted_file <span class="kw" style="color: #003B4F;
background-color: null;
font-style: inherit;">in</span> <span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">self</span>.previous_hashes:</span>
<span id="cb11-135">                <span class="kw" style="color: #003B4F;
background-color: null;
font-style: inherit;">del</span> <span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">self</span>.previous_hashes[deleted_file]</span>
<span id="cb11-136">        </span>
<span id="cb11-137">        <span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">self</span>._save_cache()</span>
<span id="cb11-138">        </span>
<span id="cb11-139">        <span class="cf" style="color: #003B4F;
background-color: null;
font-style: inherit;">return</span> {</span>
<span id="cb11-140">            <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">'added'</span>: <span class="bu" style="color: null;
background-color: null;
font-style: inherit;">len</span>(added_files),</span>
<span id="cb11-141">            <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">'modified'</span>: <span class="bu" style="color: null;
background-color: null;
font-style: inherit;">len</span>(modified_files),</span>
<span id="cb11-142">            <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">'deleted'</span>: <span class="bu" style="color: null;
background-color: null;
font-style: inherit;">len</span>(deleted_ids)</span>
<span id="cb11-143">        }</span></code></pre></div>
</section>
<section id="사용-예시" class="level2" data-number="3.4">
<h2 data-number="3.4" class="anchored" data-anchor-id="사용-예시"><span class="header-section-number">3.4</span> 사용 예시</h2>
<div class="sourceCode" id="cb12" style="background: #f1f3f5;"><pre class="sourceCode numberSource python number-lines code-with-copy"><code class="sourceCode python"><span id="cb12-1"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># 1. VectorStore 초기화</span></span>
<span id="cb12-2">manager <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> VectorStoreManager(collection_name<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"knowledge_base"</span>)</span>
<span id="cb12-3"></span>
<span id="cb12-4"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># 2. Updater 생성</span></span>
<span id="cb12-5">updater <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> VectorStoreUpdater(</span>
<span id="cb12-6">    manager<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span>manager,</span>
<span id="cb12-7">    data_dir<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"data/documents"</span></span>
<span id="cb12-8">)</span>
<span id="cb12-9"></span>
<span id="cb12-10"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># 3. 초기 로드</span></span>
<span id="cb12-11">initial_docs <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> [</span>
<span id="cb12-12">    {<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"id"</span>: <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"doc_1"</span>, <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"text"</span>: <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"문서 1"</span>, <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"metadata"</span>: {<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"source"</span>: <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"wiki"</span>}},</span>
<span id="cb12-13">    {<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"id"</span>: <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"doc_2"</span>, <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"text"</span>: <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"문서 2"</span>, <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"metadata"</span>: {<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"source"</span>: <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"manual"</span>}}</span>
<span id="cb12-14">]</span>
<span id="cb12-15">manager.add_documents(initial_docs)</span>
<span id="cb12-16"></span>
<span id="cb12-17"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># 4. 자동 업데이트 (크론잡 등으로 정기 실행)</span></span>
<span id="cb12-18">stats <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> updater.update()</span>
<span id="cb12-19"><span class="bu" style="color: null;
background-color: null;
font-style: inherit;">print</span>(<span class="ss" style="color: #20794D;
background-color: null;
font-style: inherit;">f"Updated: </span><span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">{</span>stats<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">}</span><span class="ss" style="color: #20794D;
background-color: null;
font-style: inherit;">"</span>)</span>
<span id="cb12-20"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># {'added': 3, 'modified': 1, 'deleted': 0}</span></span>
<span id="cb12-21"></span>
<span id="cb12-22"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># 5. Agent에서 검색</span></span>
<span id="cb12-23">results <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> manager.search(</span>
<span id="cb12-24">    query<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"벡터 데이터 관리 방법"</span>,</span>
<span id="cb12-25">    n_results<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">3</span>,</span>
<span id="cb12-26">    metadata_filter<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span>{<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">'source'</span>: <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">'wiki'</span>}</span>
<span id="cb12-27">)</span>
<span id="cb12-28"></span>
<span id="cb12-29"><span class="cf" style="color: #003B4F;
background-color: null;
font-style: inherit;">for</span> result <span class="kw" style="color: #003B4F;
background-color: null;
font-style: inherit;">in</span> results:</span>
<span id="cb12-30">    <span class="bu" style="color: null;
background-color: null;
font-style: inherit;">print</span>(<span class="ss" style="color: #20794D;
background-color: null;
font-style: inherit;">f"[</span><span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">{</span>result[<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">'distance'</span>]<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">:.2f}</span><span class="ss" style="color: #20794D;
background-color: null;
font-style: inherit;">] </span><span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">{</span>result[<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">'id'</span>]<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">}</span><span class="ss" style="color: #20794D;
background-color: null;
font-style: inherit;">: </span><span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">{</span>result[<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">'text'</span>][:<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">50</span>]<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">}</span><span class="ss" style="color: #20794D;
background-color: null;
font-style: inherit;">..."</span>)</span></code></pre></div>
</section>
</section>
<section id="표준-메타데이터-스키마" class="level1" data-number="4">
<h1 data-number="4"><span class="header-section-number">4</span> 표준 메타데이터 스키마</h1>
<section id="설계-원칙" class="level2" data-number="4.1">
<h2 data-number="4.1" class="anchored" data-anchor-id="설계-원칙"><span class="header-section-number">4.1</span> 설계 원칙</h2>
<p>모든 Agent 실행 결과는 <strong>일관된 메타데이터 구조</strong>를 가져야 한다:</p>
<div class="sourceCode" id="cb13" style="background: #f1f3f5;"><pre class="sourceCode numberSource python number-lines code-with-copy"><code class="sourceCode python"><span id="cb13-1"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># shared/metadata/schema.py</span></span>
<span id="cb13-2"><span class="im" style="color: #00769E;
background-color: null;
font-style: inherit;">from</span> dataclasses <span class="im" style="color: #00769E;
background-color: null;
font-style: inherit;">import</span> dataclass, asdict</span>
<span id="cb13-3"><span class="im" style="color: #00769E;
background-color: null;
font-style: inherit;">from</span> typing <span class="im" style="color: #00769E;
background-color: null;
font-style: inherit;">import</span> Optional, List, Dict, Any</span>
<span id="cb13-4"><span class="im" style="color: #00769E;
background-color: null;
font-style: inherit;">from</span> datetime <span class="im" style="color: #00769E;
background-color: null;
font-style: inherit;">import</span> datetime</span>
<span id="cb13-5"></span>
<span id="cb13-6"><span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">@dataclass</span></span>
<span id="cb13-7"><span class="kw" style="color: #003B4F;
background-color: null;
font-style: inherit;">class</span> AgentInfo:</span>
<span id="cb13-8">    <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">"""Agent 정보"""</span></span>
<span id="cb13-9">    name: <span class="bu" style="color: null;
background-color: null;
font-style: inherit;">str</span></span>
<span id="cb13-10">    version: <span class="bu" style="color: null;
background-color: null;
font-style: inherit;">str</span></span>
<span id="cb13-11">    domain: <span class="bu" style="color: null;
background-color: null;
font-style: inherit;">str</span></span>
<span id="cb13-12"></span>
<span id="cb13-13"><span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">@dataclass</span></span>
<span id="cb13-14"><span class="kw" style="color: #003B4F;
background-color: null;
font-style: inherit;">class</span> ExecutionInfo:</span>
<span id="cb13-15">    <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">"""실행 정보"""</span></span>
<span id="cb13-16">    timestamp: <span class="bu" style="color: null;
background-color: null;
font-style: inherit;">str</span>  <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># ISO 8601</span></span>
<span id="cb13-17">    duration_ms: <span class="bu" style="color: null;
background-color: null;
font-style: inherit;">float</span></span>
<span id="cb13-18">    status: <span class="bu" style="color: null;
background-color: null;
font-style: inherit;">str</span>  <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># success, failure, timeout</span></span>
<span id="cb13-19">    error_message: Optional[<span class="bu" style="color: null;
background-color: null;
font-style: inherit;">str</span>] <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> <span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">None</span></span>
<span id="cb13-20"></span>
<span id="cb13-21"><span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">@dataclass</span></span>
<span id="cb13-22"><span class="kw" style="color: #003B4F;
background-color: null;
font-style: inherit;">class</span> InputInfo:</span>
<span id="cb13-23">    <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">"""입력 정보"""</span></span>
<span id="cb13-24">    task: <span class="bu" style="color: null;
background-color: null;
font-style: inherit;">str</span></span>
<span id="cb13-25">    source: <span class="bu" style="color: null;
background-color: null;
font-style: inherit;">str</span>  <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># user_upload, api_call, scheduled, chained</span></span>
<span id="cb13-26">    parent_agent: Optional[<span class="bu" style="color: null;
background-color: null;
font-style: inherit;">str</span>] <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> <span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">None</span>  <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># 체이닝 시 이전 Agent</span></span>
<span id="cb13-27"></span>
<span id="cb13-28"><span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">@dataclass</span></span>
<span id="cb13-29"><span class="kw" style="color: #003B4F;
background-color: null;
font-style: inherit;">class</span> OutputInfo:</span>
<span id="cb13-30">    <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">"""출력 정보"""</span></span>
<span id="cb13-31">    confidence: <span class="bu" style="color: null;
background-color: null;
font-style: inherit;">float</span>  <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># 0-1</span></span>
<span id="cb13-32">    warnings: List[<span class="bu" style="color: null;
background-color: null;
font-style: inherit;">str</span>]</span>
<span id="cb13-33">    errors: List[<span class="bu" style="color: null;
background-color: null;
font-style: inherit;">str</span>]</span>
<span id="cb13-34"></span>
<span id="cb13-35"><span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">@dataclass</span></span>
<span id="cb13-36"><span class="kw" style="color: #003B4F;
background-color: null;
font-style: inherit;">class</span> ResourceUsage:</span>
<span id="cb13-37">    <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">"""리소스 사용량"""</span></span>
<span id="cb13-38">    llm_provider: Optional[<span class="bu" style="color: null;
background-color: null;
font-style: inherit;">str</span>] <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> <span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">None</span>  <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># openai, anthropic, etc.</span></span>
<span id="cb13-39">    llm_model: Optional[<span class="bu" style="color: null;
background-color: null;
font-style: inherit;">str</span>] <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> <span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">None</span></span>
<span id="cb13-40">    llm_tokens: Optional[<span class="bu" style="color: null;
background-color: null;
font-style: inherit;">int</span>] <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> <span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">None</span></span>
<span id="cb13-41">    llm_cost: Optional[<span class="bu" style="color: null;
background-color: null;
font-style: inherit;">float</span>] <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> <span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">None</span></span>
<span id="cb13-42">    cache_hit: <span class="bu" style="color: null;
background-color: null;
font-style: inherit;">bool</span> <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> <span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">False</span></span>
<span id="cb13-43">    memory_mb: Optional[<span class="bu" style="color: null;
background-color: null;
font-style: inherit;">float</span>] <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> <span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">None</span></span>
<span id="cb13-44"></span>
<span id="cb13-45"><span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">@dataclass</span></span>
<span id="cb13-46"><span class="kw" style="color: #003B4F;
background-color: null;
font-style: inherit;">class</span> StandardMetadata:</span>
<span id="cb13-47">    <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">"""표준 메타데이터 스키마"""</span></span>
<span id="cb13-48">    agent: AgentInfo</span>
<span id="cb13-49">    execution: ExecutionInfo</span>
<span id="cb13-50">    <span class="bu" style="color: null;
background-color: null;
font-style: inherit;">input</span>: InputInfo</span>
<span id="cb13-51">    output: OutputInfo</span>
<span id="cb13-52">    resources: ResourceUsage</span>
<span id="cb13-53">    custom: Dict[<span class="bu" style="color: null;
background-color: null;
font-style: inherit;">str</span>, Any] <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> <span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">None</span>  <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># Agent별 커스텀 필드</span></span>
<span id="cb13-54">    </span>
<span id="cb13-55">    <span class="kw" style="color: #003B4F;
background-color: null;
font-style: inherit;">def</span> to_dict(<span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">self</span>) <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">-&gt;</span> Dict[<span class="bu" style="color: null;
background-color: null;
font-style: inherit;">str</span>, Any]:</span>
<span id="cb13-56">        <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">"""딕셔너리로 변환"""</span></span>
<span id="cb13-57">        <span class="cf" style="color: #003B4F;
background-color: null;
font-style: inherit;">return</span> asdict(<span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">self</span>)</span>
<span id="cb13-58">    </span>
<span id="cb13-59">    <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">@classmethod</span></span>
<span id="cb13-60">    <span class="kw" style="color: #003B4F;
background-color: null;
font-style: inherit;">def</span> from_dict(cls, data: Dict[<span class="bu" style="color: null;
background-color: null;
font-style: inherit;">str</span>, Any]) <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">-&gt;</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">'StandardMetadata'</span>:</span>
<span id="cb13-61">        <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">"""딕셔너리에서 생성"""</span></span>
<span id="cb13-62">        <span class="cf" style="color: #003B4F;
background-color: null;
font-style: inherit;">return</span> cls(</span>
<span id="cb13-63">            agent<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span>AgentInfo(<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">**</span>data[<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">'agent'</span>]),</span>
<span id="cb13-64">            execution<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span>ExecutionInfo(<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">**</span>data[<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">'execution'</span>]),</span>
<span id="cb13-65">            <span class="bu" style="color: null;
background-color: null;
font-style: inherit;">input</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span>InputInfo(<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">**</span>data[<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">'input'</span>]),</span>
<span id="cb13-66">            output<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span>OutputInfo(<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">**</span>data[<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">'output'</span>]),</span>
<span id="cb13-67">            resources<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span>ResourceUsage(<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">**</span>data[<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">'resources'</span>]),</span>
<span id="cb13-68">            custom<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span>data.get(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">'custom'</span>)</span>
<span id="cb13-69">        )</span></code></pre></div>
</section>
<section id="baseagent에-메타데이터-통합" class="level2" data-number="4.2">
<h2 data-number="4.2" class="anchored" data-anchor-id="baseagent에-메타데이터-통합"><span class="header-section-number">4.2</span> BaseAgent에 메타데이터 통합</h2>
<div class="sourceCode" id="cb14" style="background: #f1f3f5;"><pre class="sourceCode numberSource python number-lines code-with-copy"><code class="sourceCode python"><span id="cb14-1"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># core/base_agent.py 수정</span></span>
<span id="cb14-2"><span class="im" style="color: #00769E;
background-color: null;
font-style: inherit;">import</span> time</span>
<span id="cb14-3"><span class="im" style="color: #00769E;
background-color: null;
font-style: inherit;">from</span> datetime <span class="im" style="color: #00769E;
background-color: null;
font-style: inherit;">import</span> datetime</span>
<span id="cb14-4"><span class="im" style="color: #00769E;
background-color: null;
font-style: inherit;">from</span> shared.metadata.schema <span class="im" style="color: #00769E;
background-color: null;
font-style: inherit;">import</span> (</span>
<span id="cb14-5">    StandardMetadata, AgentInfo, ExecutionInfo,</span>
<span id="cb14-6">    InputInfo, OutputInfo, ResourceUsage</span>
<span id="cb14-7">)</span>
<span id="cb14-8"></span>
<span id="cb14-9"><span class="kw" style="color: #003B4F;
background-color: null;
font-style: inherit;">class</span> BaseAgent(ABC):</span>
<span id="cb14-10">    <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">"""메타데이터 자동 생성"""</span></span>
<span id="cb14-11">    </span>
<span id="cb14-12">    <span class="kw" style="color: #003B4F;
background-color: null;
font-style: inherit;">def</span> execute(<span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">self</span>, <span class="bu" style="color: null;
background-color: null;
font-style: inherit;">input</span>: Dict[<span class="bu" style="color: null;
background-color: null;
font-style: inherit;">str</span>, Any]) <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">-&gt;</span> Dict[<span class="bu" style="color: null;
background-color: null;
font-style: inherit;">str</span>, Any]:</span>
<span id="cb14-13">        <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">"""실행 + 메타데이터 자동 추가"""</span></span>
<span id="cb14-14">        start_time <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> time.time()</span>
<span id="cb14-15">        status <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"success"</span></span>
<span id="cb14-16">        error_message <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> <span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">None</span></span>
<span id="cb14-17">        </span>
<span id="cb14-18">        <span class="cf" style="color: #003B4F;
background-color: null;
font-style: inherit;">try</span>:</span>
<span id="cb14-19">            <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># 검증</span></span>
<span id="cb14-20">            <span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">self</span>._validate_input(<span class="bu" style="color: null;
background-color: null;
font-style: inherit;">input</span>)</span>
<span id="cb14-21">            </span>
<span id="cb14-22">            <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># 전처리</span></span>
<span id="cb14-23">            processed_input <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> <span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">self</span>._pre_process(<span class="bu" style="color: null;
background-color: null;
font-style: inherit;">input</span>)</span>
<span id="cb14-24">            </span>
<span id="cb14-25">            <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># 핵심 로직</span></span>
<span id="cb14-26">            result <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> <span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">self</span>.process(processed_input)</span>
<span id="cb14-27">            </span>
<span id="cb14-28">            <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># 후처리</span></span>
<span id="cb14-29">            processed_result <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> <span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">self</span>._post_process(result)</span>
<span id="cb14-30">            </span>
<span id="cb14-31">        <span class="cf" style="color: #003B4F;
background-color: null;
font-style: inherit;">except</span> <span class="pp" style="color: #AD0000;
background-color: null;
font-style: inherit;">Exception</span> <span class="im" style="color: #00769E;
background-color: null;
font-style: inherit;">as</span> e:</span>
<span id="cb14-32">            status <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"failure"</span></span>
<span id="cb14-33">            error_message <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> <span class="bu" style="color: null;
background-color: null;
font-style: inherit;">str</span>(e)</span>
<span id="cb14-34">            <span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">self</span>.metrics.record_error(error_message)</span>
<span id="cb14-35">            <span class="cf" style="color: #003B4F;
background-color: null;
font-style: inherit;">raise</span></span>
<span id="cb14-36">        </span>
<span id="cb14-37">        <span class="cf" style="color: #003B4F;
background-color: null;
font-style: inherit;">finally</span>:</span>
<span id="cb14-38">            <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># 메타데이터 생성</span></span>
<span id="cb14-39">            duration_ms <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> (time.time() <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">-</span> start_time) <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">*</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1000</span></span>
<span id="cb14-40">            </span>
<span id="cb14-41">            metadata <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> StandardMetadata(</span>
<span id="cb14-42">                agent<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span>AgentInfo(</span>
<span id="cb14-43">                    name<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span><span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">self</span>.metadata.name,</span>
<span id="cb14-44">                    version<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span><span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">self</span>.metadata.version,</span>
<span id="cb14-45">                    domain<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span><span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">self</span>.metadata.domain</span>
<span id="cb14-46">                ),</span>
<span id="cb14-47">                execution<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span>ExecutionInfo(</span>
<span id="cb14-48">                    timestamp<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span>datetime.utcnow().isoformat(),</span>
<span id="cb14-49">                    duration_ms<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span>duration_ms,</span>
<span id="cb14-50">                    status<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span>status,</span>
<span id="cb14-51">                    error_message<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span>error_message</span>
<span id="cb14-52">                ),</span>
<span id="cb14-53">                <span class="bu" style="color: null;
background-color: null;
font-style: inherit;">input</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span>InputInfo(</span>
<span id="cb14-54">                    task<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span><span class="bu" style="color: null;
background-color: null;
font-style: inherit;">input</span>.get(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">'task'</span>, <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">'unknown'</span>),</span>
<span id="cb14-55">                    source<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span><span class="bu" style="color: null;
background-color: null;
font-style: inherit;">input</span>.get(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">'source'</span>, <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">'unknown'</span>),</span>
<span id="cb14-56">                    parent_agent<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span><span class="bu" style="color: null;
background-color: null;
font-style: inherit;">input</span>.get(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">'metadata'</span>, {}).get(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">'agent'</span>)</span>
<span id="cb14-57">                ),</span>
<span id="cb14-58">                output<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span>OutputInfo(</span>
<span id="cb14-59">                    confidence<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span>processed_result.get(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">'confidence'</span>, <span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">0.0</span>),</span>
<span id="cb14-60">                    warnings<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span>processed_result.get(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">'warnings'</span>, []),</span>
<span id="cb14-61">                    errors<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span>processed_result.get(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">'errors'</span>, [])</span>
<span id="cb14-62">                ),</span>
<span id="cb14-63">                resources<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span><span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">self</span>._get_resource_usage(),</span>
<span id="cb14-64">                custom<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span><span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">self</span>._get_custom_metadata()</span>
<span id="cb14-65">            )</span>
<span id="cb14-66">            </span>
<span id="cb14-67">            processed_result[<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">'metadata'</span>] <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> metadata.to_dict()</span>
<span id="cb14-68">        </span>
<span id="cb14-69">        <span class="cf" style="color: #003B4F;
background-color: null;
font-style: inherit;">return</span> processed_result</span>
<span id="cb14-70">    </span>
<span id="cb14-71">    <span class="kw" style="color: #003B4F;
background-color: null;
font-style: inherit;">def</span> _get_resource_usage(<span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">self</span>) <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">-&gt;</span> ResourceUsage:</span>
<span id="cb14-72">        <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">"""리소스 사용량 (하위 클래스에서 override 가능)"""</span></span>
<span id="cb14-73">        <span class="cf" style="color: #003B4F;
background-color: null;
font-style: inherit;">return</span> ResourceUsage()</span>
<span id="cb14-74">    </span>
<span id="cb14-75">    <span class="kw" style="color: #003B4F;
background-color: null;
font-style: inherit;">def</span> _get_custom_metadata(<span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">self</span>) <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">-&gt;</span> Dict[<span class="bu" style="color: null;
background-color: null;
font-style: inherit;">str</span>, Any]:</span>
<span id="cb14-76">        <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">"""커스텀 메타데이터 (하위 클래스에서 override 가능)"""</span></span>
<span id="cb14-77">        <span class="cf" style="color: #003B4F;
background-color: null;
font-style: inherit;">return</span> {}</span></code></pre></div>
</section>
<section id="메타데이터-활용-예시" class="level2" data-number="4.3">
<h2 data-number="4.3" class="anchored" data-anchor-id="메타데이터-활용-예시"><span class="header-section-number">4.3</span> 메타데이터 활용 예시</h2>
<section id="로깅" class="level3" data-number="4.3.1">
<h3 data-number="4.3.1" class="anchored" data-anchor-id="로깅"><span class="header-section-number">4.3.1</span> 1. 로깅</h3>
<div class="sourceCode" id="cb15" style="background: #f1f3f5;"><pre class="sourceCode numberSource python number-lines code-with-copy"><code class="sourceCode python"><span id="cb15-1"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># shared/logging/structured_logger.py</span></span>
<span id="cb15-2"><span class="im" style="color: #00769E;
background-color: null;
font-style: inherit;">import</span> logging</span>
<span id="cb15-3"><span class="im" style="color: #00769E;
background-color: null;
font-style: inherit;">import</span> json</span>
<span id="cb15-4"></span>
<span id="cb15-5"><span class="kw" style="color: #003B4F;
background-color: null;
font-style: inherit;">class</span> StructuredLogger:</span>
<span id="cb15-6">    <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">"""구조화된 로깅"""</span></span>
<span id="cb15-7">    </span>
<span id="cb15-8">    <span class="kw" style="color: #003B4F;
background-color: null;
font-style: inherit;">def</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">__init__</span>(<span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">self</span>, name: <span class="bu" style="color: null;
background-color: null;
font-style: inherit;">str</span>):</span>
<span id="cb15-9">        <span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">self</span>.logger <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> logging.getLogger(name)</span>
<span id="cb15-10">    </span>
<span id="cb15-11">    <span class="kw" style="color: #003B4F;
background-color: null;
font-style: inherit;">def</span> log_execution(<span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">self</span>, result: Dict[<span class="bu" style="color: null;
background-color: null;
font-style: inherit;">str</span>, Any]):</span>
<span id="cb15-12">        <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">"""Agent 실행 결과 로깅"""</span></span>
<span id="cb15-13">        metadata <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> result.get(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">'metadata'</span>, {})</span>
<span id="cb15-14">        </span>
<span id="cb15-15">        log_data <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> {</span>
<span id="cb15-16">            <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">'agent'</span>: metadata[<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">'agent'</span>][<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">'name'</span>],</span>
<span id="cb15-17">            <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">'status'</span>: metadata[<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">'execution'</span>][<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">'status'</span>],</span>
<span id="cb15-18">            <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">'duration_ms'</span>: metadata[<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">'execution'</span>][<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">'duration_ms'</span>],</span>
<span id="cb15-19">            <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">'confidence'</span>: metadata[<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">'output'</span>][<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">'confidence'</span>],</span>
<span id="cb15-20">            <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">'llm_cost'</span>: metadata[<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">'resources'</span>].get(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">'llm_cost'</span>, <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">0</span>)</span>
<span id="cb15-21">        }</span>
<span id="cb15-22">        </span>
<span id="cb15-23">        <span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">self</span>.logger.info(json.dumps(log_data))</span></code></pre></div>
</section>
<section id="비용-추적" class="level3" data-number="4.3.2">
<h3 data-number="4.3.2" class="anchored" data-anchor-id="비용-추적"><span class="header-section-number">4.3.2</span> 2. 비용 추적</h3>
<div class="sourceCode" id="cb16" style="background: #f1f3f5;"><pre class="sourceCode numberSource python number-lines code-with-copy"><code class="sourceCode python"><span id="cb16-1"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># shared/monitoring/cost_tracker.py</span></span>
<span id="cb16-2"><span class="im" style="color: #00769E;
background-color: null;
font-style: inherit;">from</span> typing <span class="im" style="color: #00769E;
background-color: null;
font-style: inherit;">import</span> List, Dict, Any</span>
<span id="cb16-3"></span>
<span id="cb16-4"><span class="kw" style="color: #003B4F;
background-color: null;
font-style: inherit;">class</span> CostTracker:</span>
<span id="cb16-5">    <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">"""LLM 비용 추적"""</span></span>
<span id="cb16-6">    </span>
<span id="cb16-7">    <span class="kw" style="color: #003B4F;
background-color: null;
font-style: inherit;">def</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">__init__</span>(<span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">self</span>):</span>
<span id="cb16-8">        <span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">self</span>.costs: List[Dict] <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> []</span>
<span id="cb16-9">    </span>
<span id="cb16-10">    <span class="kw" style="color: #003B4F;
background-color: null;
font-style: inherit;">def</span> record(<span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">self</span>, metadata: Dict[<span class="bu" style="color: null;
background-color: null;
font-style: inherit;">str</span>, Any]):</span>
<span id="cb16-11">        <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">"""메타데이터에서 비용 추출"""</span></span>
<span id="cb16-12">        resources <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> metadata.get(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">'resources'</span>, {})</span>
<span id="cb16-13">        </span>
<span id="cb16-14">        <span class="cf" style="color: #003B4F;
background-color: null;
font-style: inherit;">if</span> resources.get(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">'llm_cost'</span>):</span>
<span id="cb16-15">            <span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">self</span>.costs.append({</span>
<span id="cb16-16">                <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">'agent'</span>: metadata[<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">'agent'</span>][<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">'name'</span>],</span>
<span id="cb16-17">                <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">'timestamp'</span>: metadata[<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">'execution'</span>][<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">'timestamp'</span>],</span>
<span id="cb16-18">                <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">'cost'</span>: resources[<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">'llm_cost'</span>],</span>
<span id="cb16-19">                <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">'tokens'</span>: resources.get(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">'llm_tokens'</span>, <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">0</span>)</span>
<span id="cb16-20">            })</span>
<span id="cb16-21">    </span>
<span id="cb16-22">    <span class="kw" style="color: #003B4F;
background-color: null;
font-style: inherit;">def</span> get_total_cost(<span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">self</span>, agent_name: Optional[<span class="bu" style="color: null;
background-color: null;
font-style: inherit;">str</span>] <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> <span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">None</span>) <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">-&gt;</span> <span class="bu" style="color: null;
background-color: null;
font-style: inherit;">float</span>:</span>
<span id="cb16-23">        <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">"""총 비용 계산"""</span></span>
<span id="cb16-24">        filtered <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> <span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">self</span>.costs</span>
<span id="cb16-25">        </span>
<span id="cb16-26">        <span class="cf" style="color: #003B4F;
background-color: null;
font-style: inherit;">if</span> agent_name:</span>
<span id="cb16-27">            filtered <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> [c <span class="cf" style="color: #003B4F;
background-color: null;
font-style: inherit;">for</span> c <span class="kw" style="color: #003B4F;
background-color: null;
font-style: inherit;">in</span> <span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">self</span>.costs <span class="cf" style="color: #003B4F;
background-color: null;
font-style: inherit;">if</span> c[<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">'agent'</span>] <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">==</span> agent_name]</span>
<span id="cb16-28">        </span>
<span id="cb16-29">        <span class="cf" style="color: #003B4F;
background-color: null;
font-style: inherit;">return</span> <span class="bu" style="color: null;
background-color: null;
font-style: inherit;">sum</span>(c[<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">'cost'</span>] <span class="cf" style="color: #003B4F;
background-color: null;
font-style: inherit;">for</span> c <span class="kw" style="color: #003B4F;
background-color: null;
font-style: inherit;">in</span> filtered)</span>
<span id="cb16-30">    </span>
<span id="cb16-31">    <span class="kw" style="color: #003B4F;
background-color: null;
font-style: inherit;">def</span> get_summary(<span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">self</span>) <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">-&gt;</span> Dict[<span class="bu" style="color: null;
background-color: null;
font-style: inherit;">str</span>, Any]:</span>
<span id="cb16-32">        <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">"""비용 요약"""</span></span>
<span id="cb16-33">        by_agent <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> {}</span>
<span id="cb16-34">        </span>
<span id="cb16-35">        <span class="cf" style="color: #003B4F;
background-color: null;
font-style: inherit;">for</span> cost <span class="kw" style="color: #003B4F;
background-color: null;
font-style: inherit;">in</span> <span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">self</span>.costs:</span>
<span id="cb16-36">            agent <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> cost[<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">'agent'</span>]</span>
<span id="cb16-37">            <span class="cf" style="color: #003B4F;
background-color: null;
font-style: inherit;">if</span> agent <span class="kw" style="color: #003B4F;
background-color: null;
font-style: inherit;">not</span> <span class="kw" style="color: #003B4F;
background-color: null;
font-style: inherit;">in</span> by_agent:</span>
<span id="cb16-38">                by_agent[agent] <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> {<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">'cost'</span>: <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">0</span>, <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">'tokens'</span>: <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">0</span>, <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">'calls'</span>: <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">0</span>}</span>
<span id="cb16-39">            </span>
<span id="cb16-40">            by_agent[agent][<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">'cost'</span>] <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+=</span> cost[<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">'cost'</span>]</span>
<span id="cb16-41">            by_agent[agent][<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">'tokens'</span>] <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+=</span> cost[<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">'tokens'</span>]</span>
<span id="cb16-42">            by_agent[agent][<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">'calls'</span>] <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+=</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span></span>
<span id="cb16-43">        </span>
<span id="cb16-44">        <span class="cf" style="color: #003B4F;
background-color: null;
font-style: inherit;">return</span> {</span>
<span id="cb16-45">            <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">'total_cost'</span>: <span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">self</span>.get_total_cost(),</span>
<span id="cb16-46">            <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">'by_agent'</span>: by_agent</span>
<span id="cb16-47">        }</span></code></pre></div>
</section>
<section id="성능-분석" class="level3" data-number="4.3.3">
<h3 data-number="4.3.3" class="anchored" data-anchor-id="성능-분석"><span class="header-section-number">4.3.3</span> 3. 성능 분석</h3>
<div class="sourceCode" id="cb17" style="background: #f1f3f5;"><pre class="sourceCode numberSource python number-lines code-with-copy"><code class="sourceCode python"><span id="cb17-1"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># shared/monitoring/performance_analyzer.py</span></span>
<span id="cb17-2"><span class="im" style="color: #00769E;
background-color: null;
font-style: inherit;">from</span> typing <span class="im" style="color: #00769E;
background-color: null;
font-style: inherit;">import</span> List, Dict, Any</span>
<span id="cb17-3"><span class="im" style="color: #00769E;
background-color: null;
font-style: inherit;">import</span> numpy <span class="im" style="color: #00769E;
background-color: null;
font-style: inherit;">as</span> np</span>
<span id="cb17-4"></span>
<span id="cb17-5"><span class="kw" style="color: #003B4F;
background-color: null;
font-style: inherit;">class</span> PerformanceAnalyzer:</span>
<span id="cb17-6">    <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">"""성능 분석"""</span></span>
<span id="cb17-7">    </span>
<span id="cb17-8">    <span class="kw" style="color: #003B4F;
background-color: null;
font-style: inherit;">def</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">__init__</span>(<span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">self</span>):</span>
<span id="cb17-9">        <span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">self</span>.executions: List[Dict] <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> []</span>
<span id="cb17-10">    </span>
<span id="cb17-11">    <span class="kw" style="color: #003B4F;
background-color: null;
font-style: inherit;">def</span> record(<span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">self</span>, metadata: Dict[<span class="bu" style="color: null;
background-color: null;
font-style: inherit;">str</span>, Any]):</span>
<span id="cb17-12">        <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">"""메타데이터 기록"""</span></span>
<span id="cb17-13">        <span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">self</span>.executions.append({</span>
<span id="cb17-14">            <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">'agent'</span>: metadata[<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">'agent'</span>][<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">'name'</span>],</span>
<span id="cb17-15">            <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">'duration_ms'</span>: metadata[<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">'execution'</span>][<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">'duration_ms'</span>],</span>
<span id="cb17-16">            <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">'confidence'</span>: metadata[<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">'output'</span>][<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">'confidence'</span>],</span>
<span id="cb17-17">            <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">'status'</span>: metadata[<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">'execution'</span>][<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">'status'</span>]</span>
<span id="cb17-18">        })</span>
<span id="cb17-19">    </span>
<span id="cb17-20">    <span class="kw" style="color: #003B4F;
background-color: null;
font-style: inherit;">def</span> get_agent_stats(<span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">self</span>, agent_name: <span class="bu" style="color: null;
background-color: null;
font-style: inherit;">str</span>) <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">-&gt;</span> Dict[<span class="bu" style="color: null;
background-color: null;
font-style: inherit;">str</span>, Any]:</span>
<span id="cb17-21">        <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">"""Agent별 통계"""</span></span>
<span id="cb17-22">        agent_execs <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> [</span>
<span id="cb17-23">            e <span class="cf" style="color: #003B4F;
background-color: null;
font-style: inherit;">for</span> e <span class="kw" style="color: #003B4F;
background-color: null;
font-style: inherit;">in</span> <span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">self</span>.executions</span>
<span id="cb17-24">            <span class="cf" style="color: #003B4F;
background-color: null;
font-style: inherit;">if</span> e[<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">'agent'</span>] <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">==</span> agent_name</span>
<span id="cb17-25">        ]</span>
<span id="cb17-26">        </span>
<span id="cb17-27">        <span class="cf" style="color: #003B4F;
background-color: null;
font-style: inherit;">if</span> <span class="kw" style="color: #003B4F;
background-color: null;
font-style: inherit;">not</span> agent_execs:</span>
<span id="cb17-28">            <span class="cf" style="color: #003B4F;
background-color: null;
font-style: inherit;">return</span> {}</span>
<span id="cb17-29">        </span>
<span id="cb17-30">        durations <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> [e[<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">'duration_ms'</span>] <span class="cf" style="color: #003B4F;
background-color: null;
font-style: inherit;">for</span> e <span class="kw" style="color: #003B4F;
background-color: null;
font-style: inherit;">in</span> agent_execs]</span>
<span id="cb17-31">        confidences <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> [e[<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">'confidence'</span>] <span class="cf" style="color: #003B4F;
background-color: null;
font-style: inherit;">for</span> e <span class="kw" style="color: #003B4F;
background-color: null;
font-style: inherit;">in</span> agent_execs]</span>
<span id="cb17-32">        successes <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> <span class="bu" style="color: null;
background-color: null;
font-style: inherit;">sum</span>(<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span> <span class="cf" style="color: #003B4F;
background-color: null;
font-style: inherit;">for</span> e <span class="kw" style="color: #003B4F;
background-color: null;
font-style: inherit;">in</span> agent_execs <span class="cf" style="color: #003B4F;
background-color: null;
font-style: inherit;">if</span> e[<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">'status'</span>] <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">==</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">'success'</span>)</span>
<span id="cb17-33">        </span>
<span id="cb17-34">        <span class="cf" style="color: #003B4F;
background-color: null;
font-style: inherit;">return</span> {</span>
<span id="cb17-35">            <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">'total_executions'</span>: <span class="bu" style="color: null;
background-color: null;
font-style: inherit;">len</span>(agent_execs),</span>
<span id="cb17-36">            <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">'success_rate'</span>: successes <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">/</span> <span class="bu" style="color: null;
background-color: null;
font-style: inherit;">len</span>(agent_execs),</span>
<span id="cb17-37">            <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">'avg_duration_ms'</span>: np.mean(durations),</span>
<span id="cb17-38">            <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">'p95_duration_ms'</span>: np.percentile(durations, <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">95</span>),</span>
<span id="cb17-39">            <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">'avg_confidence'</span>: np.mean(confidences)</span>
<span id="cb17-40">        }</span></code></pre></div>
</section>
</section>
</section>
<section id="설정-관리" class="level1" data-number="5">
<h1 data-number="5"><span class="header-section-number">5</span> 설정 관리</h1>
<section id="환경별-설정-분리" class="level2" data-number="5.1">
<h2 data-number="5.1" class="anchored" data-anchor-id="환경별-설정-분리"><span class="header-section-number">5.1</span> 환경별 설정 분리</h2>
<div class="sourceCode" id="cb18" style="background: #f1f3f5;"><pre class="sourceCode numberSource python number-lines code-with-copy"><code class="sourceCode python"><span id="cb18-1"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># config/</span></span>
<span id="cb18-2">├── base.yaml              <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># 공통 설정</span></span>
<span id="cb18-3">├── development.yaml       <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># 개발 환경</span></span>
<span id="cb18-4">├── staging.yaml           <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># 스테이징 환경</span></span>
<span id="cb18-5">└── production.yaml        <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># 프로덕션 환경</span></span></code></pre></div>
<section id="base.yaml" class="level3" data-number="5.1.1">
<h3 data-number="5.1.1" class="anchored" data-anchor-id="base.yaml"><span class="header-section-number">5.1.1</span> base.yaml</h3>
<div class="sourceCode" id="cb19" style="background: #f1f3f5;"><pre class="sourceCode numberSource yaml number-lines code-with-copy"><code class="sourceCode yaml"><span id="cb19-1"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># config/base.yaml</span></span>
<span id="cb19-2"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">platform</span><span class="kw" style="color: #003B4F;
background-color: null;
font-style: inherit;">:</span></span>
<span id="cb19-3"><span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">  </span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">name</span><span class="kw" style="color: #003B4F;
background-color: null;
font-style: inherit;">:</span><span class="at" style="color: #657422;
background-color: null;
font-style: inherit;"> </span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"ai-agent-platform"</span></span>
<span id="cb19-4"><span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">  </span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">version</span><span class="kw" style="color: #003B4F;
background-color: null;
font-style: inherit;">:</span><span class="at" style="color: #657422;
background-color: null;
font-style: inherit;"> </span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"1.0.0"</span></span>
<span id="cb19-5"></span>
<span id="cb19-6"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">agents</span><span class="kw" style="color: #003B4F;
background-color: null;
font-style: inherit;">:</span></span>
<span id="cb19-7"><span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">  </span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">default_timeout</span><span class="kw" style="color: #003B4F;
background-color: null;
font-style: inherit;">:</span><span class="at" style="color: #657422;
background-color: null;
font-style: inherit;"> </span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">30</span></span>
<span id="cb19-8"><span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">  </span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">max_retries</span><span class="kw" style="color: #003B4F;
background-color: null;
font-style: inherit;">:</span><span class="at" style="color: #657422;
background-color: null;
font-style: inherit;"> </span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">3</span></span>
<span id="cb19-9"></span>
<span id="cb19-10"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">llm</span><span class="kw" style="color: #003B4F;
background-color: null;
font-style: inherit;">:</span></span>
<span id="cb19-11"><span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">  </span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">default_provider</span><span class="kw" style="color: #003B4F;
background-color: null;
font-style: inherit;">:</span><span class="at" style="color: #657422;
background-color: null;
font-style: inherit;"> </span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"openai"</span></span>
<span id="cb19-12"><span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">  </span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">default_model</span><span class="kw" style="color: #003B4F;
background-color: null;
font-style: inherit;">:</span><span class="at" style="color: #657422;
background-color: null;
font-style: inherit;"> </span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"gpt-4"</span></span>
<span id="cb19-13"><span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">  </span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">temperature</span><span class="kw" style="color: #003B4F;
background-color: null;
font-style: inherit;">:</span><span class="at" style="color: #657422;
background-color: null;
font-style: inherit;"> </span><span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">0.0</span></span>
<span id="cb19-14"><span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">  </span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">max_tokens</span><span class="kw" style="color: #003B4F;
background-color: null;
font-style: inherit;">:</span><span class="at" style="color: #657422;
background-color: null;
font-style: inherit;"> </span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">2000</span></span>
<span id="cb19-15"></span>
<span id="cb19-16"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">vector_store</span><span class="kw" style="color: #003B4F;
background-color: null;
font-style: inherit;">:</span></span>
<span id="cb19-17"><span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">  </span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">default_collection</span><span class="kw" style="color: #003B4F;
background-color: null;
font-style: inherit;">:</span><span class="at" style="color: #657422;
background-color: null;
font-style: inherit;"> </span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"knowledge_base"</span></span>
<span id="cb19-18"><span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">  </span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">embedding_model</span><span class="kw" style="color: #003B4F;
background-color: null;
font-style: inherit;">:</span><span class="at" style="color: #657422;
background-color: null;
font-style: inherit;"> </span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"text-embedding-ada-002"</span></span>
<span id="cb19-19"></span>
<span id="cb19-20"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">monitoring</span><span class="kw" style="color: #003B4F;
background-color: null;
font-style: inherit;">:</span></span>
<span id="cb19-21"><span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">  </span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">enabled</span><span class="kw" style="color: #003B4F;
background-color: null;
font-style: inherit;">:</span><span class="at" style="color: #657422;
background-color: null;
font-style: inherit;"> </span><span class="ch" style="color: #20794D;
background-color: null;
font-style: inherit;">true</span></span>
<span id="cb19-22"><span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">  </span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">log_level</span><span class="kw" style="color: #003B4F;
background-color: null;
font-style: inherit;">:</span><span class="at" style="color: #657422;
background-color: null;
font-style: inherit;"> </span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"INFO"</span></span>
<span id="cb19-23"><span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">  </span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">metrics_port</span><span class="kw" style="color: #003B4F;
background-color: null;
font-style: inherit;">:</span><span class="at" style="color: #657422;
background-color: null;
font-style: inherit;"> </span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">9090</span></span>
<span id="cb19-24"></span>
<span id="cb19-25"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">prompts</span><span class="kw" style="color: #003B4F;
background-color: null;
font-style: inherit;">:</span></span>
<span id="cb19-26"><span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">  </span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">directory</span><span class="kw" style="color: #003B4F;
background-color: null;
font-style: inherit;">:</span><span class="at" style="color: #657422;
background-color: null;
font-style: inherit;"> </span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"shared/prompts"</span></span>
<span id="cb19-27"><span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">  </span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">default_version</span><span class="kw" style="color: #003B4F;
background-color: null;
font-style: inherit;">:</span><span class="at" style="color: #657422;
background-color: null;
font-style: inherit;"> </span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"latest"</span></span></code></pre></div>
</section>
<section id="production.yaml" class="level3" data-number="5.1.2">
<h3 data-number="5.1.2" class="anchored" data-anchor-id="production.yaml"><span class="header-section-number">5.1.2</span> production.yaml</h3>
<div class="sourceCode" id="cb20" style="background: #f1f3f5;"><pre class="sourceCode numberSource yaml number-lines code-with-copy"><code class="sourceCode yaml"><span id="cb20-1"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># config/production.yaml</span></span>
<span id="cb20-2"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># base.yaml 상속 + 오버라이드</span></span>
<span id="cb20-3"></span>
<span id="cb20-4"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">llm</span><span class="kw" style="color: #003B4F;
background-color: null;
font-style: inherit;">:</span></span>
<span id="cb20-5"><span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">  </span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">cache_enabled</span><span class="kw" style="color: #003B4F;
background-color: null;
font-style: inherit;">:</span><span class="at" style="color: #657422;
background-color: null;
font-style: inherit;"> </span><span class="ch" style="color: #20794D;
background-color: null;
font-style: inherit;">true</span></span>
<span id="cb20-6"><span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">  </span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">retry_backoff</span><span class="kw" style="color: #003B4F;
background-color: null;
font-style: inherit;">:</span><span class="at" style="color: #657422;
background-color: null;
font-style: inherit;"> </span><span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">2.0</span></span>
<span id="cb20-7"></span>
<span id="cb20-8"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">monitoring</span><span class="kw" style="color: #003B4F;
background-color: null;
font-style: inherit;">:</span></span>
<span id="cb20-9"><span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">  </span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">log_level</span><span class="kw" style="color: #003B4F;
background-color: null;
font-style: inherit;">:</span><span class="at" style="color: #657422;
background-color: null;
font-style: inherit;"> </span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"WARNING"</span></span>
<span id="cb20-10"><span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">  </span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">log_format</span><span class="kw" style="color: #003B4F;
background-color: null;
font-style: inherit;">:</span><span class="at" style="color: #657422;
background-color: null;
font-style: inherit;"> </span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"json"</span></span>
<span id="cb20-11"><span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">  </span></span>
<span id="cb20-12"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">security</span><span class="kw" style="color: #003B4F;
background-color: null;
font-style: inherit;">:</span></span>
<span id="cb20-13"><span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">  </span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">api_key_required</span><span class="kw" style="color: #003B4F;
background-color: null;
font-style: inherit;">:</span><span class="at" style="color: #657422;
background-color: null;
font-style: inherit;"> </span><span class="ch" style="color: #20794D;
background-color: null;
font-style: inherit;">true</span></span>
<span id="cb20-14"><span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">  </span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">rate_limit</span><span class="kw" style="color: #003B4F;
background-color: null;
font-style: inherit;">:</span><span class="at" style="color: #657422;
background-color: null;
font-style: inherit;"> </span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1000</span><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">  # per hour</span></span></code></pre></div>
</section>
</section>
<section id="config-로더" class="level2" data-number="5.2">
<h2 data-number="5.2" class="anchored" data-anchor-id="config-로더"><span class="header-section-number">5.2</span> Config 로더</h2>
<div class="sourceCode" id="cb21" style="background: #f1f3f5;"><pre class="sourceCode numberSource python number-lines code-with-copy"><code class="sourceCode python"><span id="cb21-1"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># shared/config/loader.py</span></span>
<span id="cb21-2"><span class="im" style="color: #00769E;
background-color: null;
font-style: inherit;">from</span> typing <span class="im" style="color: #00769E;
background-color: null;
font-style: inherit;">import</span> Dict, Any</span>
<span id="cb21-3"><span class="im" style="color: #00769E;
background-color: null;
font-style: inherit;">from</span> pathlib <span class="im" style="color: #00769E;
background-color: null;
font-style: inherit;">import</span> Path</span>
<span id="cb21-4"><span class="im" style="color: #00769E;
background-color: null;
font-style: inherit;">import</span> yaml</span>
<span id="cb21-5"><span class="im" style="color: #00769E;
background-color: null;
font-style: inherit;">import</span> os</span>
<span id="cb21-6"></span>
<span id="cb21-7"><span class="kw" style="color: #003B4F;
background-color: null;
font-style: inherit;">class</span> ConfigLoader:</span>
<span id="cb21-8">    <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">"""설정 로더</span></span>
<span id="cb21-9"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">    </span></span>
<span id="cb21-10"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">    환경 변수 ENV에 따라 설정 로드:</span></span>
<span id="cb21-11"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">    - development: base + development</span></span>
<span id="cb21-12"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">    - production: base + production</span></span>
<span id="cb21-13"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">    """</span></span>
<span id="cb21-14">    </span>
<span id="cb21-15">    <span class="kw" style="color: #003B4F;
background-color: null;
font-style: inherit;">def</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">__init__</span>(<span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">self</span>, config_dir: <span class="bu" style="color: null;
background-color: null;
font-style: inherit;">str</span> <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"config"</span>):</span>
<span id="cb21-16">        <span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">self</span>.config_dir <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> Path(config_dir)</span>
<span id="cb21-17">        <span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">self</span>.env <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> os.getenv(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"ENV"</span>, <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"development"</span>)</span>
<span id="cb21-18">        <span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">self</span>.config <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> <span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">self</span>._load_config()</span>
<span id="cb21-19">    </span>
<span id="cb21-20">    <span class="kw" style="color: #003B4F;
background-color: null;
font-style: inherit;">def</span> _load_yaml(<span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">self</span>, file_name: <span class="bu" style="color: null;
background-color: null;
font-style: inherit;">str</span>) <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">-&gt;</span> Dict[<span class="bu" style="color: null;
background-color: null;
font-style: inherit;">str</span>, Any]:</span>
<span id="cb21-21">        <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">"""YAML 파일 로드"""</span></span>
<span id="cb21-22">        file_path <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> <span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">self</span>.config_dir <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">/</span> file_name</span>
<span id="cb21-23">        </span>
<span id="cb21-24">        <span class="cf" style="color: #003B4F;
background-color: null;
font-style: inherit;">if</span> <span class="kw" style="color: #003B4F;
background-color: null;
font-style: inherit;">not</span> file_path.exists():</span>
<span id="cb21-25">            <span class="cf" style="color: #003B4F;
background-color: null;
font-style: inherit;">return</span> {}</span>
<span id="cb21-26">        </span>
<span id="cb21-27">        <span class="cf" style="color: #003B4F;
background-color: null;
font-style: inherit;">with</span> <span class="bu" style="color: null;
background-color: null;
font-style: inherit;">open</span>(file_path) <span class="im" style="color: #00769E;
background-color: null;
font-style: inherit;">as</span> f:</span>
<span id="cb21-28">            <span class="cf" style="color: #003B4F;
background-color: null;
font-style: inherit;">return</span> yaml.safe_load(f) <span class="kw" style="color: #003B4F;
background-color: null;
font-style: inherit;">or</span> {}</span>
<span id="cb21-29">    </span>
<span id="cb21-30">    <span class="kw" style="color: #003B4F;
background-color: null;
font-style: inherit;">def</span> _merge_configs(</span>
<span id="cb21-31">        <span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">self</span>,</span>
<span id="cb21-32">        base: Dict[<span class="bu" style="color: null;
background-color: null;
font-style: inherit;">str</span>, Any],</span>
<span id="cb21-33">        override: Dict[<span class="bu" style="color: null;
background-color: null;
font-style: inherit;">str</span>, Any]</span>
<span id="cb21-34">    ) <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">-&gt;</span> Dict[<span class="bu" style="color: null;
background-color: null;
font-style: inherit;">str</span>, Any]:</span>
<span id="cb21-35">        <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">"""설정 병합 (재귀적)"""</span></span>
<span id="cb21-36">        result <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> base.copy()</span>
<span id="cb21-37">        </span>
<span id="cb21-38">        <span class="cf" style="color: #003B4F;
background-color: null;
font-style: inherit;">for</span> key, value <span class="kw" style="color: #003B4F;
background-color: null;
font-style: inherit;">in</span> override.items():</span>
<span id="cb21-39">            <span class="cf" style="color: #003B4F;
background-color: null;
font-style: inherit;">if</span> key <span class="kw" style="color: #003B4F;
background-color: null;
font-style: inherit;">in</span> result <span class="kw" style="color: #003B4F;
background-color: null;
font-style: inherit;">and</span> <span class="bu" style="color: null;
background-color: null;
font-style: inherit;">isinstance</span>(result[key], <span class="bu" style="color: null;
background-color: null;
font-style: inherit;">dict</span>) <span class="kw" style="color: #003B4F;
background-color: null;
font-style: inherit;">and</span> <span class="bu" style="color: null;
background-color: null;
font-style: inherit;">isinstance</span>(value, <span class="bu" style="color: null;
background-color: null;
font-style: inherit;">dict</span>):</span>
<span id="cb21-40">                result[key] <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> <span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">self</span>._merge_configs(result[key], value)</span>
<span id="cb21-41">            <span class="cf" style="color: #003B4F;
background-color: null;
font-style: inherit;">else</span>:</span>
<span id="cb21-42">                result[key] <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> value</span>
<span id="cb21-43">        </span>
<span id="cb21-44">        <span class="cf" style="color: #003B4F;
background-color: null;
font-style: inherit;">return</span> result</span>
<span id="cb21-45">    </span>
<span id="cb21-46">    <span class="kw" style="color: #003B4F;
background-color: null;
font-style: inherit;">def</span> _load_config(<span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">self</span>) <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">-&gt;</span> Dict[<span class="bu" style="color: null;
background-color: null;
font-style: inherit;">str</span>, Any]:</span>
<span id="cb21-47">        <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">"""설정 로드 (base + env)"""</span></span>
<span id="cb21-48">        base <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> <span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">self</span>._load_yaml(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"base.yaml"</span>)</span>
<span id="cb21-49">        env_config <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> <span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">self</span>._load_yaml(<span class="ss" style="color: #20794D;
background-color: null;
font-style: inherit;">f"</span><span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">{</span><span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">self</span><span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">.</span>env<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">}</span><span class="ss" style="color: #20794D;
background-color: null;
font-style: inherit;">.yaml"</span>)</span>
<span id="cb21-50">        </span>
<span id="cb21-51">        <span class="cf" style="color: #003B4F;
background-color: null;
font-style: inherit;">return</span> <span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">self</span>._merge_configs(base, env_config)</span>
<span id="cb21-52">    </span>
<span id="cb21-53">    <span class="kw" style="color: #003B4F;
background-color: null;
font-style: inherit;">def</span> get(<span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">self</span>, key: <span class="bu" style="color: null;
background-color: null;
font-style: inherit;">str</span>, default: Any <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> <span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">None</span>) <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">-&gt;</span> Any:</span>
<span id="cb21-54">        <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">"""설정 값 조회 (dot notation)</span></span>
<span id="cb21-55"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">        </span></span>
<span id="cb21-56"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">        Example:</span></span>
<span id="cb21-57"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">            config.get("llm.default_model")  # "gpt-4"</span></span>
<span id="cb21-58"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">        """</span></span>
<span id="cb21-59">        keys <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> key.split(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">'.'</span>)</span>
<span id="cb21-60">        value <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> <span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">self</span>.config</span>
<span id="cb21-61">        </span>
<span id="cb21-62">        <span class="cf" style="color: #003B4F;
background-color: null;
font-style: inherit;">for</span> k <span class="kw" style="color: #003B4F;
background-color: null;
font-style: inherit;">in</span> keys:</span>
<span id="cb21-63">            <span class="cf" style="color: #003B4F;
background-color: null;
font-style: inherit;">if</span> <span class="bu" style="color: null;
background-color: null;
font-style: inherit;">isinstance</span>(value, <span class="bu" style="color: null;
background-color: null;
font-style: inherit;">dict</span>) <span class="kw" style="color: #003B4F;
background-color: null;
font-style: inherit;">and</span> k <span class="kw" style="color: #003B4F;
background-color: null;
font-style: inherit;">in</span> value:</span>
<span id="cb21-64">                value <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> value[k]</span>
<span id="cb21-65">            <span class="cf" style="color: #003B4F;
background-color: null;
font-style: inherit;">else</span>:</span>
<span id="cb21-66">                <span class="cf" style="color: #003B4F;
background-color: null;
font-style: inherit;">return</span> default</span>
<span id="cb21-67">        </span>
<span id="cb21-68">        <span class="cf" style="color: #003B4F;
background-color: null;
font-style: inherit;">return</span> value</span>
<span id="cb21-69">    </span>
<span id="cb21-70">    <span class="kw" style="color: #003B4F;
background-color: null;
font-style: inherit;">def</span> get_all(<span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">self</span>) <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">-&gt;</span> Dict[<span class="bu" style="color: null;
background-color: null;
font-style: inherit;">str</span>, Any]:</span>
<span id="cb21-71">        <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">"""전체 설정 반환"""</span></span>
<span id="cb21-72">        <span class="cf" style="color: #003B4F;
background-color: null;
font-style: inherit;">return</span> <span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">self</span>.config.copy()</span>
<span id="cb21-73"></span>
<span id="cb21-74"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># 전역 설정 인스턴스</span></span>
<span id="cb21-75">_config <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> <span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">None</span></span>
<span id="cb21-76"></span>
<span id="cb21-77"><span class="kw" style="color: #003B4F;
background-color: null;
font-style: inherit;">def</span> get_config() <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">-&gt;</span> ConfigLoader:</span>
<span id="cb21-78">    <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">"""전역 설정 조회 (Singleton)"""</span></span>
<span id="cb21-79">    <span class="kw" style="color: #003B4F;
background-color: null;
font-style: inherit;">global</span> _config</span>
<span id="cb21-80">    <span class="cf" style="color: #003B4F;
background-color: null;
font-style: inherit;">if</span> _config <span class="kw" style="color: #003B4F;
background-color: null;
font-style: inherit;">is</span> <span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">None</span>:</span>
<span id="cb21-81">        _config <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> ConfigLoader()</span>
<span id="cb21-82">    <span class="cf" style="color: #003B4F;
background-color: null;
font-style: inherit;">return</span> _config</span></code></pre></div>
</section>
<section id="사용-예시-1" class="level2" data-number="5.3">
<h2 data-number="5.3" class="anchored" data-anchor-id="사용-예시-1"><span class="header-section-number">5.3</span> 사용 예시</h2>
<div class="sourceCode" id="cb22" style="background: #f1f3f5;"><pre class="sourceCode numberSource python number-lines code-with-copy"><code class="sourceCode python"><span id="cb22-1"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># Agent에서 설정 사용</span></span>
<span id="cb22-2"><span class="im" style="color: #00769E;
background-color: null;
font-style: inherit;">from</span> shared.config.loader <span class="im" style="color: #00769E;
background-color: null;
font-style: inherit;">import</span> get_config</span>
<span id="cb22-3"></span>
<span id="cb22-4"><span class="kw" style="color: #003B4F;
background-color: null;
font-style: inherit;">class</span> DataAgent(BaseAgent):</span>
<span id="cb22-5">    <span class="kw" style="color: #003B4F;
background-color: null;
font-style: inherit;">def</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">__init__</span>(<span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">self</span>, metadata):</span>
<span id="cb22-6">        <span class="bu" style="color: null;
background-color: null;
font-style: inherit;">super</span>().<span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">__init__</span>(metadata)</span>
<span id="cb22-7">        </span>
<span id="cb22-8">        config <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> get_config()</span>
<span id="cb22-9">        </span>
<span id="cb22-10">        <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># LLM 설정</span></span>
<span id="cb22-11">        <span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">self</span>.llm <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> LLMClient(</span>
<span id="cb22-12">            provider<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span>config.get(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"llm.default_provider"</span>),</span>
<span id="cb22-13">            model<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span>config.get(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"llm.default_model"</span>),</span>
<span id="cb22-14">            temperature<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span>config.get(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"llm.temperature"</span>),</span>
<span id="cb22-15">            cache_enabled<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span>config.get(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"llm.cache_enabled"</span>, <span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">False</span>)</span>
<span id="cb22-16">        )</span>
<span id="cb22-17">        </span>
<span id="cb22-18">        <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># Prompt 설정</span></span>
<span id="cb22-19">        <span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">self</span>.prompt_registry <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> PromptRegistry(</span>
<span id="cb22-20">            prompts_dir<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span>config.get(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"prompts.directory"</span>)</span>
<span id="cb22-21">        )</span>
<span id="cb22-22">        </span>
<span id="cb22-23">        <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># 타임아웃 설정</span></span>
<span id="cb22-24">        <span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">self</span>.timeout <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> config.get(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"agents.default_timeout"</span>)</span></code></pre></div>
</section>
</section>
<section id="핵심-설계-결정-요약" class="level1" data-number="6">
<h1 data-number="6"><span class="header-section-number">6</span> 핵심 설계 결정 요약</h1>
<section id="프롬프트-관리" class="level2" data-number="6.1">
<h2 data-number="6.1" class="anchored" data-anchor-id="프롬프트-관리"><span class="header-section-number">6.1</span> 프롬프트 관리</h2>
<ol type="1">
<li><strong>YAML 기반 저장</strong>: 버전 이력, 성능 메트릭 포함</li>
<li><strong>PromptRegistry</strong>: 중앙집중식 관리</li>
<li><strong>A/B 테스트</strong>: 통계적 유의성 검증</li>
<li><strong>Agent 독립성</strong>: 프롬프트 변경 시 Agent 재배포 불필요</li>
</ol>
</section>
<section id="벡터-데이터-관리-1" class="level2" data-number="6.2">
<h2 data-number="6.2" class="anchored" data-anchor-id="벡터-데이터-관리-1"><span class="header-section-number">6.2</span> 벡터 데이터 관리</h2>
<ol type="1">
<li><strong>VectorStoreManager</strong>: 공통 벡터 저장소</li>
<li><strong>증분 업데이트</strong>: 변경된 문서만 업데이트</li>
<li><strong>해시 기반 감지</strong>: 파일 변경 자동 감지</li>
<li><strong>메타데이터 필터링</strong>: 효율적인 검색</li>
</ol>
</section>
<section id="메타데이터-표준" class="level2" data-number="6.3">
<h2 data-number="6.3" class="anchored" data-anchor-id="메타데이터-표준"><span class="header-section-number">6.3</span> 메타데이터 표준</h2>
<ol type="1">
<li><strong>StandardMetadata</strong>: 모든 Agent 공통 스키마</li>
<li><strong>자동 생성</strong>: BaseAgent가 메타데이터 추가</li>
<li><strong>구조화 로깅</strong>: JSON 형식</li>
<li><strong>비용/성능 추적</strong>: 메타데이터 활용</li>
</ol>
</section>
<section id="설정-관리-1" class="level2" data-number="6.4">
<h2 data-number="6.4" class="anchored" data-anchor-id="설정-관리-1"><span class="header-section-number">6.4</span> 설정 관리</h2>
<ol type="1">
<li><strong>환경별 분리</strong>: base + development/production</li>
<li><strong>YAML 형식</strong>: 가독성</li>
<li><strong>Dot notation</strong>: 계층 구조 접근</li>
<li><strong>Singleton 패턴</strong>: 전역 설정</li>
</ol>
</section>
<section id="다음-단계" class="level2" data-number="6.5">
<h2 data-number="6.5" class="anchored" data-anchor-id="다음-단계"><span class="header-section-number">6.5</span> 다음 단계</h2>
<p>이 글에서 데이터 표준화 계층을 완성했다. 다음 글에서는:</p>
<ul>
<li><strong>6번 글</strong>: 플랫폼 운영 (CI/CD, 모니터링, 배포 전략, 보안)</li>
</ul>
</section>
<section id="참고문헌" class="level2" data-number="6.6">
<h2 data-number="6.6" class="anchored" data-anchor-id="참고문헌"><span class="header-section-number">6.6</span> 참고문헌</h2>
<p><strong>Data Management</strong>: - Kleppmann, M. (2017). “Designing Data-Intensive Applications.” O’Reilly. - Reis, J., &amp; Housley, M. (2022). “Fundamentals of Data Engineering.” O’Reilly.</p>
<p><strong>Configuration Management</strong>: - Humble, J., &amp; Farley, D. (2010). “Continuous Delivery.” Addison-Wesley. - Newman, S. (2021). “Building Microservices.” O’Reilly.</p>
<p><strong>Vector Databases</strong>: - ChromaDB Documentation. https://docs.trychroma.com/ - Pinecone Documentation. https://docs.pinecone.io/</p>
<p><strong>Prompt Engineering</strong>: - OpenAI Cookbook. https://cookbook.openai.com/ - Anthropic Claude Documentation. https://docs.anthropic.com/</p>
<div class="sourceCode" id="cb23" style="background: #f1f3f5;"><pre class="sourceCode numberSource python number-lines code-with-copy"><code class="sourceCode python"><span id="cb23-1">shared<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">/</span>prompt_management<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">/</span></span>
<span id="cb23-2">├── registry.py                <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># 프롬프트 저장소</span></span>
<span id="cb23-3">├── version_control.py         <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># 버전 관리</span></span>
<span id="cb23-4">└── ab_testing.py             <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># A/B 테스트 도구</span></span></code></pre></div>
<section id="프롬프트-레지스트리" class="level3" data-number="6.6.1">
<h3 data-number="6.6.1" class="anchored" data-anchor-id="프롬프트-레지스트리"><span class="header-section-number">6.6.1</span> 프롬프트 레지스트리</h3>
<div class="sourceCode" id="cb24" style="background: #f1f3f5;"><pre class="sourceCode numberSource python number-lines code-with-copy"><code class="sourceCode python"><span id="cb24-1"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># shared/prompt_management/registry.py</span></span>
<span id="cb24-2"><span class="im" style="color: #00769E;
background-color: null;
font-style: inherit;">from</span> typing <span class="im" style="color: #00769E;
background-color: null;
font-style: inherit;">import</span> Dict</span>
<span id="cb24-3"><span class="im" style="color: #00769E;
background-color: null;
font-style: inherit;">import</span> yaml</span>
<span id="cb24-4"></span>
<span id="cb24-5"><span class="kw" style="color: #003B4F;
background-color: null;
font-style: inherit;">class</span> PromptRegistry:</span>
<span id="cb24-6">    <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">"""프롬프트 버전 관리"""</span></span>
<span id="cb24-7">    </span>
<span id="cb24-8">    <span class="kw" style="color: #003B4F;
background-color: null;
font-style: inherit;">def</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">__init__</span>(<span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">self</span>, prompts_dir: <span class="bu" style="color: null;
background-color: null;
font-style: inherit;">str</span>):</span>
<span id="cb24-9">        <span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">self</span>.prompts_dir <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> prompts_dir</span>
<span id="cb24-10">        <span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">self</span>._prompts: Dict[<span class="bu" style="color: null;
background-color: null;
font-style: inherit;">str</span>, Dict] <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> {}</span>
<span id="cb24-11">        <span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">self</span>._load_prompts()</span>
<span id="cb24-12">    </span>
<span id="cb24-13">    <span class="kw" style="color: #003B4F;
background-color: null;
font-style: inherit;">def</span> _load_prompts(<span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">self</span>):</span>
<span id="cb24-14">        <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">"""YAML에서 프롬프트 로드"""</span></span>
<span id="cb24-15">        <span class="cf" style="color: #003B4F;
background-color: null;
font-style: inherit;">for</span> <span class="bu" style="color: null;
background-color: null;
font-style: inherit;">file</span> <span class="kw" style="color: #003B4F;
background-color: null;
font-style: inherit;">in</span> Path(<span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">self</span>.prompts_dir).glob(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"*.yaml"</span>):</span>
<span id="cb24-16">            <span class="cf" style="color: #003B4F;
background-color: null;
font-style: inherit;">with</span> <span class="bu" style="color: null;
background-color: null;
font-style: inherit;">open</span>(<span class="bu" style="color: null;
background-color: null;
font-style: inherit;">file</span>) <span class="im" style="color: #00769E;
background-color: null;
font-style: inherit;">as</span> f:</span>
<span id="cb24-17">                data <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> yaml.safe_load(f)</span>
<span id="cb24-18">                <span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">self</span>._prompts[data[<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">'name'</span>]] <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> data</span>
<span id="cb24-19">    </span>
<span id="cb24-20">    <span class="kw" style="color: #003B4F;
background-color: null;
font-style: inherit;">def</span> get(<span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">self</span>, name: <span class="bu" style="color: null;
background-color: null;
font-style: inherit;">str</span>, version: <span class="bu" style="color: null;
background-color: null;
font-style: inherit;">str</span> <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"latest"</span>) <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">-&gt;</span> <span class="bu" style="color: null;
background-color: null;
font-style: inherit;">str</span>:</span>
<span id="cb24-21">        <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">"""프롬프트 조회"""</span></span>
<span id="cb24-22">        prompt_data <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> <span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">self</span>._prompts[name]</span>
<span id="cb24-23">        </span>
<span id="cb24-24">        <span class="cf" style="color: #003B4F;
background-color: null;
font-style: inherit;">if</span> version <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">==</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"latest"</span>:</span>
<span id="cb24-25">            <span class="cf" style="color: #003B4F;
background-color: null;
font-style: inherit;">return</span> prompt_data[<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">'versions'</span>][<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">-</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span>][<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">'content'</span>]</span>
<span id="cb24-26">        <span class="cf" style="color: #003B4F;
background-color: null;
font-style: inherit;">else</span>:</span>
<span id="cb24-27">            <span class="cf" style="color: #003B4F;
background-color: null;
font-style: inherit;">for</span> v <span class="kw" style="color: #003B4F;
background-color: null;
font-style: inherit;">in</span> prompt_data[<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">'versions'</span>]:</span>
<span id="cb24-28">                <span class="cf" style="color: #003B4F;
background-color: null;
font-style: inherit;">if</span> v[<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">'version'</span>] <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">==</span> version:</span>
<span id="cb24-29">                    <span class="cf" style="color: #003B4F;
background-color: null;
font-style: inherit;">return</span> v[<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">'content'</span>]</span>
<span id="cb24-30">        </span>
<span id="cb24-31">        <span class="cf" style="color: #003B4F;
background-color: null;
font-style: inherit;">raise</span> <span class="pp" style="color: #AD0000;
background-color: null;
font-style: inherit;">ValueError</span>(<span class="ss" style="color: #20794D;
background-color: null;
font-style: inherit;">f"Prompt </span><span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">{</span>name<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">}</span><span class="ss" style="color: #20794D;
background-color: null;
font-style: inherit;"> version </span><span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">{</span>version<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">}</span><span class="ss" style="color: #20794D;
background-color: null;
font-style: inherit;"> not found"</span>)</span></code></pre></div>
</section>
<section id="프롬프트-yaml-형식" class="level3" data-number="6.6.2">
<h3 data-number="6.6.2" class="anchored" data-anchor-id="프롬프트-yaml-형식"><span class="header-section-number">6.6.2</span> 프롬프트 YAML 형식</h3>
<div class="sourceCode" id="cb25" style="background: #f1f3f5;"><pre class="sourceCode numberSource yaml number-lines code-with-copy"><code class="sourceCode yaml"><span id="cb25-1"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># shared/prompt_management/prompts/data_standardization.yaml</span></span>
<span id="cb25-2"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">name</span><span class="kw" style="color: #003B4F;
background-color: null;
font-style: inherit;">:</span><span class="at" style="color: #657422;
background-color: null;
font-style: inherit;"> data_standardization</span></span>
<span id="cb25-3"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">domain</span><span class="kw" style="color: #003B4F;
background-color: null;
font-style: inherit;">:</span><span class="at" style="color: #657422;
background-color: null;
font-style: inherit;"> data</span></span>
<span id="cb25-4"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">description</span><span class="kw" style="color: #003B4F;
background-color: null;
font-style: inherit;">:</span><span class="at" style="color: #657422;
background-color: null;
font-style: inherit;"> </span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"데이터 스키마 표준화 프롬프트"</span></span>
<span id="cb25-5"></span>
<span id="cb25-6"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">versions</span><span class="kw" style="color: #003B4F;
background-color: null;
font-style: inherit;">:</span></span>
<span id="cb25-7"><span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">  </span><span class="kw" style="color: #003B4F;
background-color: null;
font-style: inherit;">-</span><span class="at" style="color: #657422;
background-color: null;
font-style: inherit;"> </span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">version</span><span class="kw" style="color: #003B4F;
background-color: null;
font-style: inherit;">:</span><span class="at" style="color: #657422;
background-color: null;
font-style: inherit;"> </span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"1.0.0"</span></span>
<span id="cb25-8"><span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">    </span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">created_at</span><span class="kw" style="color: #003B4F;
background-color: null;
font-style: inherit;">:</span><span class="at" style="color: #657422;
background-color: null;
font-style: inherit;"> </span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"2026-01-28"</span></span>
<span id="cb25-9"><span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">    </span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">author</span><span class="kw" style="color: #003B4F;
background-color: null;
font-style: inherit;">:</span><span class="at" style="color: #657422;
background-color: null;
font-style: inherit;"> </span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Platform Team"</span></span>
<span id="cb25-10"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">    content</span><span class="kw" style="color: #003B4F;
background-color: null;
font-style: inherit;">: </span><span class="ch" style="color: #20794D;
background-color: null;
font-style: inherit;">|</span></span>
<span id="cb25-11">      다음 데이터 스키마를 표준화하세요:</span>
<span id="cb25-12">      {schema}</span>
<span id="cb25-13">      </span>
<span id="cb25-14">      표준 형식:</span>
<span id="cb25-15">      - 컬럼명: snake_case</span>
<span id="cb25-16">      - 날짜: ISO 8601</span>
<span id="cb25-17">      - 문자열: UTF-8</span>
<span id="cb25-18"><span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">  </span></span>
<span id="cb25-19"><span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">  </span><span class="kw" style="color: #003B4F;
background-color: null;
font-style: inherit;">-</span><span class="at" style="color: #657422;
background-color: null;
font-style: inherit;"> </span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">version</span><span class="kw" style="color: #003B4F;
background-color: null;
font-style: inherit;">:</span><span class="at" style="color: #657422;
background-color: null;
font-style: inherit;"> </span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"1.1.0"</span></span>
<span id="cb25-20"><span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">    </span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">created_at</span><span class="kw" style="color: #003B4F;
background-color: null;
font-style: inherit;">:</span><span class="at" style="color: #657422;
background-color: null;
font-style: inherit;"> </span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"2026-02-01"</span></span>
<span id="cb25-21"><span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">    </span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">author</span><span class="kw" style="color: #003B4F;
background-color: null;
font-style: inherit;">:</span><span class="at" style="color: #657422;
background-color: null;
font-style: inherit;"> </span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Platform Team"</span></span>
<span id="cb25-22"><span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">    </span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">changes</span><span class="kw" style="color: #003B4F;
background-color: null;
font-style: inherit;">:</span><span class="at" style="color: #657422;
background-color: null;
font-style: inherit;"> </span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"타입 검증 규칙 추가"</span></span>
<span id="cb25-23"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">    content</span><span class="kw" style="color: #003B4F;
background-color: null;
font-style: inherit;">: </span><span class="ch" style="color: #20794D;
background-color: null;
font-style: inherit;">|</span></span>
<span id="cb25-24">      다음 데이터 스키마를 표준화하세요:</span>
<span id="cb25-25">      {schema}</span>
<span id="cb25-26">      </span>
<span id="cb25-27">      표준 형식:</span>
<span id="cb25-28">      - 컬럼명: snake_case</span>
<span id="cb25-29">      - 날짜: ISO 8601 (YYYY-MM-DD)</span>
<span id="cb25-30">      - 문자열: UTF-8</span>
<span id="cb25-31">      - 타입: string, int, float, date만 허용</span></code></pre></div>
</section>
</section>
<section id="벡터-데이터-관리-2" class="level2" data-number="6.7">
<h2 data-number="6.7" class="anchored" data-anchor-id="벡터-데이터-관리-2"><span class="header-section-number">6.7</span> 벡터 데이터 관리</h2>
<p><strong>문제</strong>: RAG 기반 Agent의 벡터 데이터 업데이트 자동화</p>
<div class="sourceCode" id="cb26" style="background: #f1f3f5;"><pre class="sourceCode numberSource python number-lines code-with-copy"><code class="sourceCode python"><span id="cb26-1">shared<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">/</span>vector_store<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">/</span></span>
<span id="cb26-2">├── manager.py                <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># 벡터 저장소 관리</span></span>
<span id="cb26-3">├── updater.py                <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># 자동 업데이트</span></span>
<span id="cb26-4">└── index.py                  <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># 검색 인덱스</span></span></code></pre></div>
<section id="벡터-저장소-관리자" class="level3" data-number="6.7.1">
<h3 data-number="6.7.1" class="anchored" data-anchor-id="벡터-저장소-관리자"><span class="header-section-number">6.7.1</span> 벡터 저장소 관리자</h3>
<div class="sourceCode" id="cb27" style="background: #f1f3f5;"><pre class="sourceCode numberSource python number-lines code-with-copy"><code class="sourceCode python"><span id="cb27-1"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># shared/vector_store/manager.py</span></span>
<span id="cb27-2"><span class="im" style="color: #00769E;
background-color: null;
font-style: inherit;">from</span> typing <span class="im" style="color: #00769E;
background-color: null;
font-style: inherit;">import</span> List, Dict, Any</span>
<span id="cb27-3"><span class="im" style="color: #00769E;
background-color: null;
font-style: inherit;">from</span> chromadb <span class="im" style="color: #00769E;
background-color: null;
font-style: inherit;">import</span> Client</span>
<span id="cb27-4"></span>
<span id="cb27-5"><span class="kw" style="color: #003B4F;
background-color: null;
font-style: inherit;">class</span> VectorStoreManager:</span>
<span id="cb27-6">    <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">"""벡터 데이터 관리"""</span></span>
<span id="cb27-7">    </span>
<span id="cb27-8">    <span class="kw" style="color: #003B4F;
background-color: null;
font-style: inherit;">def</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">__init__</span>(<span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">self</span>, collection_name: <span class="bu" style="color: null;
background-color: null;
font-style: inherit;">str</span>):</span>
<span id="cb27-9">        <span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">self</span>.client <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> Client()</span>
<span id="cb27-10">        <span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">self</span>.collection <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> <span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">self</span>.client.get_or_create_collection(collection_name)</span>
<span id="cb27-11">    </span>
<span id="cb27-12">    <span class="kw" style="color: #003B4F;
background-color: null;
font-style: inherit;">def</span> add_documents(<span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">self</span>, documents: List[Dict[<span class="bu" style="color: null;
background-color: null;
font-style: inherit;">str</span>, Any]]):</span>
<span id="cb27-13">        <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">"""문서 추가 (증분 업데이트)"""</span></span>
<span id="cb27-14">        ids <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> [doc[<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">'id'</span>] <span class="cf" style="color: #003B4F;
background-color: null;
font-style: inherit;">for</span> doc <span class="kw" style="color: #003B4F;
background-color: null;
font-style: inherit;">in</span> documents]</span>
<span id="cb27-15">        texts <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> [doc[<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">'text'</span>] <span class="cf" style="color: #003B4F;
background-color: null;
font-style: inherit;">for</span> doc <span class="kw" style="color: #003B4F;
background-color: null;
font-style: inherit;">in</span> documents]</span>
<span id="cb27-16">        metadatas <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> [doc[<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">'metadata'</span>] <span class="cf" style="color: #003B4F;
background-color: null;
font-style: inherit;">for</span> doc <span class="kw" style="color: #003B4F;
background-color: null;
font-style: inherit;">in</span> documents]</span>
<span id="cb27-17">        </span>
<span id="cb27-18">        <span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">self</span>.collection.add(</span>
<span id="cb27-19">            ids<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span>ids,</span>
<span id="cb27-20">            documents<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span>texts,</span>
<span id="cb27-21">            metadatas<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span>metadatas</span>
<span id="cb27-22">        )</span>
<span id="cb27-23">    </span>
<span id="cb27-24">    <span class="kw" style="color: #003B4F;
background-color: null;
font-style: inherit;">def</span> update_document(<span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">self</span>, doc_id: <span class="bu" style="color: null;
background-color: null;
font-style: inherit;">str</span>, new_text: <span class="bu" style="color: null;
background-color: null;
font-style: inherit;">str</span>):</span>
<span id="cb27-25">        <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">"""문서 업데이트"""</span></span>
<span id="cb27-26">        <span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">self</span>.collection.update(</span>
<span id="cb27-27">            ids<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span>[doc_id],</span>
<span id="cb27-28">            documents<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span>[new_text]</span>
<span id="cb27-29">        )</span>
<span id="cb27-30">    </span>
<span id="cb27-31">    <span class="kw" style="color: #003B4F;
background-color: null;
font-style: inherit;">def</span> search(<span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">self</span>, query: <span class="bu" style="color: null;
background-color: null;
font-style: inherit;">str</span>, n_results: <span class="bu" style="color: null;
background-color: null;
font-style: inherit;">int</span> <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">5</span>) <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">-&gt;</span> List[Dict]:</span>
<span id="cb27-32">        <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">"""검색"""</span></span>
<span id="cb27-33">        results <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> <span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">self</span>.collection.query(</span>
<span id="cb27-34">            query_texts<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span>[query],</span>
<span id="cb27-35">            n_results<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span>n_results</span>
<span id="cb27-36">        )</span>
<span id="cb27-37">        <span class="cf" style="color: #003B4F;
background-color: null;
font-style: inherit;">return</span> results</span></code></pre></div>
</section>
</section>
<section id="메타데이터-표준-1" class="level2" data-number="6.8">
<h2 data-number="6.8" class="anchored" data-anchor-id="메타데이터-표준-1"><span class="header-section-number">6.8</span> 메타데이터 표준</h2>
<p><strong>모든 Agent 실행 결과에 포함되는 메타데이터 스키마</strong>:</p>
<div class="sourceCode" id="cb28" style="background: #f1f3f5;"><pre class="sourceCode numberSource python number-lines code-with-copy"><code class="sourceCode python"><span id="cb28-1">{</span>
<span id="cb28-2">    <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"agent"</span>: {</span>
<span id="cb28-3">        <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"name"</span>: <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"data_standardization"</span>,</span>
<span id="cb28-4">        <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"version"</span>: <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"1.0.0"</span>,</span>
<span id="cb28-5">        <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"domain"</span>: <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"data"</span></span>
<span id="cb28-6">    },</span>
<span id="cb28-7">    <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"execution"</span>: {</span>
<span id="cb28-8">        <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"timestamp"</span>: <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"2026-02-02T10:30:00Z"</span>,</span>
<span id="cb28-9">        <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"duration_ms"</span>: <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1250</span>,</span>
<span id="cb28-10">        <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"status"</span>: <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"success"</span></span>
<span id="cb28-11">    },</span>
<span id="cb28-12">    <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"input"</span>: {</span>
<span id="cb28-13">        <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"task"</span>: <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"standardize"</span>,</span>
<span id="cb28-14">        <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"source"</span>: <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"user_upload"</span></span>
<span id="cb28-15">    },</span>
<span id="cb28-16">    <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"output"</span>: {</span>
<span id="cb28-17">        <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"confidence"</span>: <span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">0.95</span>,</span>
<span id="cb28-18">        <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"warnings"</span>: [],</span>
<span id="cb28-19">        <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"errors"</span>: []</span>
<span id="cb28-20">    },</span>
<span id="cb28-21">    <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"resources"</span>: {</span>
<span id="cb28-22">        <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"llm_tokens"</span>: <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1500</span>,</span>
<span id="cb28-23">        <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"llm_cost"</span>: <span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">0.045</span>,</span>
<span id="cb28-24">        <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"cache_hit"</span>: false</span>
<span id="cb28-25">    }</span>
<span id="cb28-26">}</span></code></pre></div>
</section>
</section>
<section id="최종-디렉토리-구조" class="level1" data-number="7">
<h1 data-number="7"><span class="header-section-number">7</span> 최종 디렉토리 구조</h1>
<p>2번 글의 Phase 4 결과를 구체화:</p>
<pre><code>ai-agent-platform/                    # Monorepo 루트
├── pyproject.toml                   # 전체 의존성 관리
├── README.md
│
├── core/                            # 플랫폼 핵심
│   ├── agent/
│   │   ├── base_agent.py           # BaseAgent 추상 클래스
│   │   ├── lifecycle.py
│   │   ├── registry.py             # AgentRegistry (Singleton)
│   │   └── metadata.py
│   ├── orchestrator.py             # AgentOrchestrator
│   ├── monitoring.py
│   └── evaluation.py
│
├── shared/                          # 공통 라이브러리
│   ├── llm/
│   │   ├── client.py               # LLMClient (캐싱, 재시도)
│   │   ├── prompt_engine.py
│   │   └── context_manager.py
│   ├── validation/
│   │   ├── json_parser.py
│   │   └── schema_validator.py
│   ├── logging/
│   │   └── structured_logger.py
│   ├── monitoring/
│   │   ├── metrics.py
│   │   └── dashboard.py
│   ├── document_processing/
│   │   ├── pdf_parser.py
│   │   ├── code_parser.py
│   │   └── text_extractor.py
│   ├── vector_store/
│   │   ├── manager.py              # VectorStoreManager
│   │   ├── updater.py
│   │   └── index.py
│   └── prompt_management/
│       ├── registry.py             # PromptRegistry
│       ├── version_control.py
│       ├── ab_testing.py
│       └── prompts/                # YAML 프롬프트 모음
│           ├── data_standardization.yaml
│           ├── code_analysis.yaml
│           └── knowledge_qna.yaml
│
├── agents/                          # 도메인 Agent들
│   ├── data_standardization/
│   │   ├── __init__.py             # Agent 자동 등록
│   │   ├── agent.py                # DataStandardizationAgent
│   │   ├── manifest.yaml           # Agent 메타데이터
│   │   ├── rules/                  # 도메인 특화 규칙
│   │   │   └── schema_rules.py
│   │   └── tests/
│   │       └── test_agent.py
│   ├── code_analysis/
│   │   ├── __init__.py
│   │   ├── agent.py
│   │   ├── manifest.yaml
│   │   ├── parsers/                # 도메인 특화 파서
│   │   │   ├── python_parser.py
│   │   │   └── java_parser.py
│   │   └── tests/
│   └── knowledge_qna/
│       ├── __init__.py
│       ├── agent.py
│       ├── manifest.yaml
│       ├── rag_pipeline.py         # 도메인 특화 RAG
│       └── tests/
│
├── platform-api/                    # API Gateway
│   ├── main.py                     # FastAPI 앱
│   ├── routes/
│   │   ├── agents.py               # /api/agents/*
│   │   ├── monitoring.py           # /api/metrics/*
│   │   └── management.py           # /api/manage/*
│   └── middleware/
│       ├── auth.py
│       └── logging.py
│
├── infra/                           # 인프라 코드
│   ├── docker/
│   │   ├── Dockerfile.base
│   │   ├── Dockerfile.agent
│   │   └── docker-compose.yml
│   ├── k8s/                        # Kubernetes 매니페스트
│   │   ├── core-deployment.yaml
│   │   ├── agent-deployment.yaml
│   │   └── service.yaml
│   └── ci_cd/
│       └── .github/
│           └── workflows/
│               ├── test.yml        # 변경 감지 + 테스트
│               └── deploy.yml
│
└── tests/                           # 통합 테스트
    ├── integration/
    │   ├── test_agent_chain.py     # Agent 체이닝 테스트
    │   └── test_orchestrator.py
    └── performance/
        └── test_load.py</code></pre>
</section>
<section id="cicd-파이프라인" class="level1" data-number="8">
<h1 data-number="8"><span class="header-section-number">8</span> CI/CD 파이프라인</h1>
<section id="변경-감지-및-선택적-테스트" class="level2" data-number="8.1">
<h2 data-number="8.1" class="anchored" data-anchor-id="변경-감지-및-선택적-테스트"><span class="header-section-number">8.1</span> 변경 감지 및 선택적 테스트</h2>
<div class="sourceCode" id="cb30" style="background: #f1f3f5;"><pre class="sourceCode numberSource yaml number-lines code-with-copy"><code class="sourceCode yaml"><span id="cb30-1"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># .github/workflows/test.yml</span></span>
<span id="cb30-2"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">name</span><span class="kw" style="color: #003B4F;
background-color: null;
font-style: inherit;">:</span><span class="at" style="color: #657422;
background-color: null;
font-style: inherit;"> Test Affected Components</span></span>
<span id="cb30-3"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">on</span><span class="kw" style="color: #003B4F;
background-color: null;
font-style: inherit;">:</span><span class="at" style="color: #657422;
background-color: null;
font-style: inherit;"> </span><span class="kw" style="color: #003B4F;
background-color: null;
font-style: inherit;">[</span><span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">push</span><span class="kw" style="color: #003B4F;
background-color: null;
font-style: inherit;">,</span><span class="at" style="color: #657422;
background-color: null;
font-style: inherit;"> pull_request</span><span class="kw" style="color: #003B4F;
background-color: null;
font-style: inherit;">]</span></span>
<span id="cb30-4"></span>
<span id="cb30-5"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">jobs</span><span class="kw" style="color: #003B4F;
background-color: null;
font-style: inherit;">:</span></span>
<span id="cb30-6"><span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">  </span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">detect-changes</span><span class="kw" style="color: #003B4F;
background-color: null;
font-style: inherit;">:</span></span>
<span id="cb30-7"><span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">    </span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">runs-on</span><span class="kw" style="color: #003B4F;
background-color: null;
font-style: inherit;">:</span><span class="at" style="color: #657422;
background-color: null;
font-style: inherit;"> ubuntu-latest</span></span>
<span id="cb30-8"><span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">    </span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">outputs</span><span class="kw" style="color: #003B4F;
background-color: null;
font-style: inherit;">:</span></span>
<span id="cb30-9"><span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">      </span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">affected</span><span class="kw" style="color: #003B4F;
background-color: null;
font-style: inherit;">:</span><span class="at" style="color: #657422;
background-color: null;
font-style: inherit;"> ${{ steps.detect.outputs.affected }}</span></span>
<span id="cb30-10"><span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">    </span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">steps</span><span class="kw" style="color: #003B4F;
background-color: null;
font-style: inherit;">:</span></span>
<span id="cb30-11"><span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">      </span><span class="kw" style="color: #003B4F;
background-color: null;
font-style: inherit;">-</span><span class="at" style="color: #657422;
background-color: null;
font-style: inherit;"> </span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">uses</span><span class="kw" style="color: #003B4F;
background-color: null;
font-style: inherit;">:</span><span class="at" style="color: #657422;
background-color: null;
font-style: inherit;"> actions/checkout@v2</span></span>
<span id="cb30-12"><span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">      </span><span class="kw" style="color: #003B4F;
background-color: null;
font-style: inherit;">-</span><span class="at" style="color: #657422;
background-color: null;
font-style: inherit;"> </span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">name</span><span class="kw" style="color: #003B4F;
background-color: null;
font-style: inherit;">:</span><span class="at" style="color: #657422;
background-color: null;
font-style: inherit;"> Detect changed modules</span></span>
<span id="cb30-13"><span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">        </span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">id</span><span class="kw" style="color: #003B4F;
background-color: null;
font-style: inherit;">:</span><span class="at" style="color: #657422;
background-color: null;
font-style: inherit;"> detect</span></span>
<span id="cb30-14"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">        run</span><span class="kw" style="color: #003B4F;
background-color: null;
font-style: inherit;">: </span><span class="ch" style="color: #20794D;
background-color: null;
font-style: inherit;">|</span></span>
<span id="cb30-15">          CHANGED=$(git diff --name-only HEAD~1)</span>
<span id="cb30-16">          </span>
<span id="cb30-17">          if echo "$CHANGED" | grep -E '^(core|shared)/'; then</span>
<span id="cb30-18">            echo "affected=all" &gt;&gt; $GITHUB_OUTPUT</span>
<span id="cb30-19">          else</span>
<span id="cb30-20">            AGENTS=$(echo "$CHANGED" | grep 'agents/' | cut -d'/' -f2 | sort -u)</span>
<span id="cb30-21">            echo "affected=$AGENTS" &gt;&gt; $GITHUB_OUTPUT</span>
<span id="cb30-22">          fi</span>
<span id="cb30-23"><span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">  </span></span>
<span id="cb30-24"><span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">  </span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">test</span><span class="kw" style="color: #003B4F;
background-color: null;
font-style: inherit;">:</span></span>
<span id="cb30-25"><span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">    </span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">needs</span><span class="kw" style="color: #003B4F;
background-color: null;
font-style: inherit;">:</span><span class="at" style="color: #657422;
background-color: null;
font-style: inherit;"> detect-changes</span></span>
<span id="cb30-26"><span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">    </span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">runs-on</span><span class="kw" style="color: #003B4F;
background-color: null;
font-style: inherit;">:</span><span class="at" style="color: #657422;
background-color: null;
font-style: inherit;"> ubuntu-latest</span></span>
<span id="cb30-27"><span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">    </span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">steps</span><span class="kw" style="color: #003B4F;
background-color: null;
font-style: inherit;">:</span></span>
<span id="cb30-28"><span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">      </span><span class="kw" style="color: #003B4F;
background-color: null;
font-style: inherit;">-</span><span class="at" style="color: #657422;
background-color: null;
font-style: inherit;"> </span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">uses</span><span class="kw" style="color: #003B4F;
background-color: null;
font-style: inherit;">:</span><span class="at" style="color: #657422;
background-color: null;
font-style: inherit;"> actions/checkout@v2</span></span>
<span id="cb30-29"><span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">      </span><span class="kw" style="color: #003B4F;
background-color: null;
font-style: inherit;">-</span><span class="at" style="color: #657422;
background-color: null;
font-style: inherit;"> </span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">uses</span><span class="kw" style="color: #003B4F;
background-color: null;
font-style: inherit;">:</span><span class="at" style="color: #657422;
background-color: null;
font-style: inherit;"> actions/setup-python@v2</span></span>
<span id="cb30-30"><span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">      </span><span class="kw" style="color: #003B4F;
background-color: null;
font-style: inherit;">-</span><span class="at" style="color: #657422;
background-color: null;
font-style: inherit;"> </span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">name</span><span class="kw" style="color: #003B4F;
background-color: null;
font-style: inherit;">:</span><span class="at" style="color: #657422;
background-color: null;
font-style: inherit;"> Install dependencies</span></span>
<span id="cb30-31"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">        run</span><span class="kw" style="color: #003B4F;
background-color: null;
font-style: inherit;">: </span><span class="ch" style="color: #20794D;
background-color: null;
font-style: inherit;">|</span></span>
<span id="cb30-32">          pip install poetry</span>
<span id="cb30-33">          poetry install</span>
<span id="cb30-34"><span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">      </span></span>
<span id="cb30-35"><span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">      </span><span class="kw" style="color: #003B4F;
background-color: null;
font-style: inherit;">-</span><span class="at" style="color: #657422;
background-color: null;
font-style: inherit;"> </span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">name</span><span class="kw" style="color: #003B4F;
background-color: null;
font-style: inherit;">:</span><span class="at" style="color: #657422;
background-color: null;
font-style: inherit;"> Run tests</span></span>
<span id="cb30-36"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">        run</span><span class="kw" style="color: #003B4F;
background-color: null;
font-style: inherit;">: </span><span class="ch" style="color: #20794D;
background-color: null;
font-style: inherit;">|</span></span>
<span id="cb30-37">          if [ "${{ needs.detect-changes.outputs.affected }}" = "all" ]; then</span>
<span id="cb30-38">            poetry run pytest</span>
<span id="cb30-39">          else</span>
<span id="cb30-40">            for agent in ${{ needs.detect-changes.outputs.affected }}; do</span>
<span id="cb30-41">              poetry run pytest agents/$agent/tests/</span>
<span id="cb30-42">            done</span>
<span id="cb30-43">          fi</span></code></pre></div>
</section>
</section>
<section id="다음-단계-1" class="level1" data-number="9">
<h1 data-number="9"><span class="header-section-number">9</span> 다음 단계</h1>
<p>이 글에서 <strong>“최종 플랫폼 구조”</strong>를 구체화했다면, 다음 질문은:</p>
<blockquote class="blockquote">
<p>“실제로 어떻게 운영하고 자동화하는가?”</p>
</blockquote>
<p>다음 글 “AI Agent 플랫폼 운영 자동화와 DevOps”에서는: - <strong>배포 전략</strong>: Blue-Green, Canary, A/B 테스트 - <strong>모니터링</strong>: Agent별 메트릭, 대시보드, 알림 - <strong>로깅</strong>: 구조화된 로그, 분석 - <strong>보안</strong>: 인증, 권한, API 키 관리</p>
<p>를 다룬다.</p>


</section>

 ]]></description>
  <category>Engineering</category>
  <category>System</category>
  <category>Architecture Design</category>
  <category>Agent</category>
  <category>Platform</category>
  <guid>kk3225.netlify.app/docs/blog/posts/Engineering/System/Archi_Design/platform/5.agent_platform_data_standardization.html</guid>
  <pubDate>Thu, 29 Jan 2026 15:00:00 GMT</pubDate>
</item>
<item>
  <title>AI Agent 플랫폼 인터페이스 설계</title>
  <dc:creator>Kwangmin Kim</dc:creator>
  <link>kk3225.netlify.app/docs/blog/posts/Engineering/System/Archi_Design/platform/4.agent_platform_interface_design.html</link>
  <description><![CDATA[ 





<section id="들어가며" class="level1" data-number="1">
<h1 data-number="1"><span class="header-section-number">1</span> 들어가며</h1>
<section id="왜-인터페이스-설계가-중요한가" class="level2" data-number="1.1">
<h2 data-number="1.1" class="anchored" data-anchor-id="왜-인터페이스-설계가-중요한가"><span class="header-section-number">1.1</span> 왜 인터페이스 설계가 중요한가?</h2>
<p>Phase 1-4를 거쳐 여러 Agent를 만들었다. 이제 문제는:</p>
<p><strong>질문들</strong>: - “모든 Agent가 따라야 할 표준 인터페이스는 무엇인가?” - “새 Agent 추가 시 기존 코드를 수정하지 않으려면?” - “Agent 실행, 평가, 모니터링을 어떻게 통일할 것인가?”</p>
<p><strong>이 글의 목표</strong>: - BaseAgent 추상 클래스 설계 - Template Method Pattern 적용 이유 - AgentRegistry로 Dependency Inversion 구현 - Orchestrator로 Agent 실행 관리 - 실제 Agent 구현 예시</p>
</section>
<section id="앞선-글-요약" class="level2" data-number="1.2">
<h2 data-number="1.2" class="anchored" data-anchor-id="앞선-글-요약"><span class="header-section-number">1.2</span> 앞선 글 요약</h2>
<p><strong>3번 글</strong> (<a href="../../../../../../../docs/blog/posts/Engineering/System/Archi_Design/platform/3.agent_platform_repo_strategy.html">저장소 전략</a>): - Monorepo 선택 근거 - core/shared/agents 모듈 분리 - 의존성 규칙: <code>agents → shared → core</code> - 빌드 도구: Poetry → Nx → Bazel 로드맵</p>
<p><strong>핵심 질문</strong>: “core/에 어떤 인터페이스를 정의할 것인가?”</p>
</section>
</section>
<section id="baseagent-인터페이스-설계" class="level1" data-number="2">
<h1 data-number="2"><span class="header-section-number">2</span> BaseAgent 인터페이스 설계</h1>
<section id="설계-원칙" class="level2" data-number="2.1">
<h2 data-number="2.1" class="anchored" data-anchor-id="설계-원칙"><span class="header-section-number">2.1</span> 설계 원칙</h2>
<section id="원칙-1-표준-입출력-형식" class="level3" data-number="2.1.1">
<h3 data-number="2.1.1" class="anchored" data-anchor-id="원칙-1-표준-입출력-형식"><span class="header-section-number">2.1.1</span> 원칙 1: 표준 입출력 형식</h3>
<p><strong>문제</strong>: 각 Agent가 다른 입출력 형식 사용</p>
<div class="sourceCode" id="cb1" style="background: #f1f3f5;"><pre class="sourceCode numberSource python number-lines code-with-copy"><code class="sourceCode python"><span id="cb1-1"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># ❌ 나쁜 예: Agent마다 다른 시그니처</span></span>
<span id="cb1-2"><span class="kw" style="color: #003B4F;
background-color: null;
font-style: inherit;">class</span> DataAgent:</span>
<span id="cb1-3">    <span class="kw" style="color: #003B4F;
background-color: null;
font-style: inherit;">def</span> run(<span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">self</span>, schema: <span class="bu" style="color: null;
background-color: null;
font-style: inherit;">str</span>) <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">-&gt;</span> <span class="bu" style="color: null;
background-color: null;
font-style: inherit;">str</span>:  <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># 문자열 입출력</span></span>
<span id="cb1-4">        ...</span>
<span id="cb1-5"></span>
<span id="cb1-6"><span class="kw" style="color: #003B4F;
background-color: null;
font-style: inherit;">class</span> CodeAgent:</span>
<span id="cb1-7">    <span class="kw" style="color: #003B4F;
background-color: null;
font-style: inherit;">def</span> analyze(<span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">self</span>, code_obj: CodeObject) <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">-&gt;</span> List[Issue]:  <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># 객체 입출력</span></span>
<span id="cb1-8">        ...</span>
<span id="cb1-9"></span>
<span id="cb1-10"><span class="kw" style="color: #003B4F;
background-color: null;
font-style: inherit;">class</span> KnowledgeAgent:</span>
<span id="cb1-11">    <span class="kw" style="color: #003B4F;
background-color: null;
font-style: inherit;">def</span> query(<span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">self</span>, question: <span class="bu" style="color: null;
background-color: null;
font-style: inherit;">str</span>, context: Dict) <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">-&gt;</span> Dict:  <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># 혼합</span></span>
<span id="cb1-12">        ...</span>
<span id="cb1-13"></span>
<span id="cb1-14"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># 문제: Agent 체이닝 불가능</span></span>
<span id="cb1-15">result1 <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> data_agent.run(schema)</span>
<span id="cb1-16">result2 <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> code_agent.analyze(result1)  <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># 타입 에러!</span></span></code></pre></div>
<p><strong>해결</strong>: Dict[str, Any] 표준 형식</p>
<div class="sourceCode" id="cb2" style="background: #f1f3f5;"><pre class="sourceCode numberSource python number-lines code-with-copy"><code class="sourceCode python"><span id="cb2-1"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># ✅ 좋은 예: 표준 입출력</span></span>
<span id="cb2-2"><span class="kw" style="color: #003B4F;
background-color: null;
font-style: inherit;">class</span> BaseAgent(ABC):</span>
<span id="cb2-3">    <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">@abstractmethod</span></span>
<span id="cb2-4">    <span class="kw" style="color: #003B4F;
background-color: null;
font-style: inherit;">def</span> process(<span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">self</span>, <span class="bu" style="color: null;
background-color: null;
font-style: inherit;">input</span>: Dict[<span class="bu" style="color: null;
background-color: null;
font-style: inherit;">str</span>, Any]) <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">-&gt;</span> Dict[<span class="bu" style="color: null;
background-color: null;
font-style: inherit;">str</span>, Any]:</span>
<span id="cb2-5">        <span class="cf" style="color: #003B4F;
background-color: null;
font-style: inherit;">pass</span></span>
<span id="cb2-6"></span>
<span id="cb2-7"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># 모든 Agent가 동일한 시그니처</span></span>
<span id="cb2-8">data_result <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> data_agent.process({<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">'data'</span>: schema})</span>
<span id="cb2-9">code_result <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> code_agent.process(data_result)  <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># 체이닝 가능</span></span></code></pre></div>
<p><strong>표준 입력 구조</strong>:</p>
<div class="sourceCode" id="cb3" style="background: #f1f3f5;"><pre class="sourceCode numberSource python number-lines code-with-copy"><code class="sourceCode python"><span id="cb3-1"><span class="bu" style="color: null;
background-color: null;
font-style: inherit;">input</span> <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> {</span>
<span id="cb3-2">    <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">'task'</span>: <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">'standardization'</span>,  <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># 작업 유형</span></span>
<span id="cb3-3">    <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">'data'</span>: {...},              <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># 실제 데이터</span></span>
<span id="cb3-4">    <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">'config'</span>: {                 <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># 실행 옵션</span></span>
<span id="cb3-5">        <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">'temperature'</span>: <span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">0.0</span>,</span>
<span id="cb3-6">        <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">'max_tokens'</span>: <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1000</span></span>
<span id="cb3-7">    },</span>
<span id="cb3-8">    <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">'metadata'</span>: {               <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># 컨텍스트</span></span>
<span id="cb3-9">        <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">'source'</span>: <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">'previous_agent'</span>,</span>
<span id="cb3-10">        <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">'timestamp'</span>: <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1234567890</span></span>
<span id="cb3-11">    }</span>
<span id="cb3-12">}</span></code></pre></div>
<p><strong>표준 출력 구조</strong>:</p>
<div class="sourceCode" id="cb4" style="background: #f1f3f5;"><pre class="sourceCode numberSource python number-lines code-with-copy"><code class="sourceCode python"><span id="cb4-1">output <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> {</span>
<span id="cb4-2">    <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">'result'</span>: {...},            <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># 실행 결과</span></span>
<span id="cb4-3">    <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">'confidence'</span>: <span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">0.95</span>,         <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># 신뢰도 (0-1)</span></span>
<span id="cb4-4">    <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">'metadata'</span>: {               <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># 실행 정보</span></span>
<span id="cb4-5">        <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">'agent'</span>: <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">'data_standardization'</span>,</span>
<span id="cb4-6">        <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">'version'</span>: <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">'1.0.0'</span>,</span>
<span id="cb4-7">        <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">'execution_time'</span>: <span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">2.5</span></span>
<span id="cb4-8">    },</span>
<span id="cb4-9">    <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">'errors'</span>: []                <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># 에러 목록 (있다면)</span></span>
<span id="cb4-10">}</span></code></pre></div>
</section>
<section id="원칙-2-template-method-pattern" class="level3" data-number="2.1.2">
<h3 data-number="2.1.2" class="anchored" data-anchor-id="원칙-2-template-method-pattern"><span class="header-section-number">2.1.2</span> 원칙 2: Template Method Pattern</h3>
<p><strong>문제</strong>: 공통 로직(검증, 로깅, 메트릭)을 매번 구현</p>
<div class="sourceCode" id="cb5" style="background: #f1f3f5;"><pre class="sourceCode numberSource python number-lines code-with-copy"><code class="sourceCode python"><span id="cb5-1"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># ❌ 나쁜 예: 각 Agent가 중복 코드</span></span>
<span id="cb5-2"><span class="kw" style="color: #003B4F;
background-color: null;
font-style: inherit;">class</span> DataAgent:</span>
<span id="cb5-3">    <span class="kw" style="color: #003B4F;
background-color: null;
font-style: inherit;">def</span> process(<span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">self</span>, <span class="bu" style="color: null;
background-color: null;
font-style: inherit;">input</span>):</span>
<span id="cb5-4">        <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># 입력 검증 (중복)</span></span>
<span id="cb5-5">        <span class="cf" style="color: #003B4F;
background-color: null;
font-style: inherit;">if</span> <span class="kw" style="color: #003B4F;
background-color: null;
font-style: inherit;">not</span> <span class="bu" style="color: null;
background-color: null;
font-style: inherit;">isinstance</span>(<span class="bu" style="color: null;
background-color: null;
font-style: inherit;">input</span>, <span class="bu" style="color: null;
background-color: null;
font-style: inherit;">dict</span>):</span>
<span id="cb5-6">            <span class="cf" style="color: #003B4F;
background-color: null;
font-style: inherit;">raise</span> <span class="pp" style="color: #AD0000;
background-color: null;
font-style: inherit;">ValueError</span>(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"..."</span>)</span>
<span id="cb5-7">        </span>
<span id="cb5-8">        <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># 시간 측정 (중복)</span></span>
<span id="cb5-9">        start <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> time.time()</span>
<span id="cb5-10">        </span>
<span id="cb5-11">        <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># 실제 로직</span></span>
<span id="cb5-12">        result <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> <span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">self</span>._do_work(<span class="bu" style="color: null;
background-color: null;
font-style: inherit;">input</span>)</span>
<span id="cb5-13">        </span>
<span id="cb5-14">        <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># 로깅 (중복)</span></span>
<span id="cb5-15">        elapsed <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> time.time() <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">-</span> start</span>
<span id="cb5-16">        logger.info(<span class="ss" style="color: #20794D;
background-color: null;
font-style: inherit;">f"Elapsed: </span><span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">{</span>elapsed<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">}</span><span class="ss" style="color: #20794D;
background-color: null;
font-style: inherit;">"</span>)</span>
<span id="cb5-17">        </span>
<span id="cb5-18">        <span class="cf" style="color: #003B4F;
background-color: null;
font-style: inherit;">return</span> result</span>
<span id="cb5-19"></span>
<span id="cb5-20"><span class="kw" style="color: #003B4F;
background-color: null;
font-style: inherit;">class</span> CodeAgent:</span>
<span id="cb5-21">    <span class="kw" style="color: #003B4F;
background-color: null;
font-style: inherit;">def</span> process(<span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">self</span>, <span class="bu" style="color: null;
background-color: null;
font-style: inherit;">input</span>):</span>
<span id="cb5-22">        <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># 동일한 검증, 측정, 로깅 코드 반복</span></span>
<span id="cb5-23">        ...</span></code></pre></div>
<p><strong>해결</strong>: Template Method로 공통 로직 추출</p>
<div class="sourceCode" id="cb6" style="background: #f1f3f5;"><pre class="sourceCode numberSource python number-lines code-with-copy"><code class="sourceCode python"><span id="cb6-1"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># ✅ 좋은 예: BaseAgent가 공통 로직 처리</span></span>
<span id="cb6-2"><span class="kw" style="color: #003B4F;
background-color: null;
font-style: inherit;">class</span> BaseAgent(ABC):</span>
<span id="cb6-3">    <span class="kw" style="color: #003B4F;
background-color: null;
font-style: inherit;">def</span> execute(<span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">self</span>, <span class="bu" style="color: null;
background-color: null;
font-style: inherit;">input</span>: Dict[<span class="bu" style="color: null;
background-color: null;
font-style: inherit;">str</span>, Any]) <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">-&gt;</span> Dict[<span class="bu" style="color: null;
background-color: null;
font-style: inherit;">str</span>, Any]:</span>
<span id="cb6-4">        <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">"""Template Method (final - 수정 불가)"""</span></span>
<span id="cb6-5">        <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># 1. 공통 검증</span></span>
<span id="cb6-6">        <span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">self</span>._validate_input(<span class="bu" style="color: null;
background-color: null;
font-style: inherit;">input</span>)</span>
<span id="cb6-7">        </span>
<span id="cb6-8">        <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># 2. 전처리 hook</span></span>
<span id="cb6-9">        <span class="bu" style="color: null;
background-color: null;
font-style: inherit;">input</span> <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> <span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">self</span>._pre_process(<span class="bu" style="color: null;
background-color: null;
font-style: inherit;">input</span>)</span>
<span id="cb6-10">        </span>
<span id="cb6-11">        <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># 3. 시간 측정</span></span>
<span id="cb6-12">        start_time <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> time.time()</span>
<span id="cb6-13">        </span>
<span id="cb6-14">        <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># 4. 실제 로직 (하위 클래스 구현)</span></span>
<span id="cb6-15">        result <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> <span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">self</span>.process(<span class="bu" style="color: null;
background-color: null;
font-style: inherit;">input</span>)</span>
<span id="cb6-16">        </span>
<span id="cb6-17">        <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># 5. 후처리 hook</span></span>
<span id="cb6-18">        result <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> <span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">self</span>._post_process(result)</span>
<span id="cb6-19">        </span>
<span id="cb6-20">        <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># 6. 메트릭 수집</span></span>
<span id="cb6-21">        <span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">self</span>._collect_metrics(time.time() <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">-</span> start_time)</span>
<span id="cb6-22">        </span>
<span id="cb6-23">        <span class="cf" style="color: #003B4F;
background-color: null;
font-style: inherit;">return</span> result</span>
<span id="cb6-24">    </span>
<span id="cb6-25">    <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">@abstractmethod</span></span>
<span id="cb6-26">    <span class="kw" style="color: #003B4F;
background-color: null;
font-style: inherit;">def</span> process(<span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">self</span>, <span class="bu" style="color: null;
background-color: null;
font-style: inherit;">input</span>: Dict[<span class="bu" style="color: null;
background-color: null;
font-style: inherit;">str</span>, Any]) <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">-&gt;</span> Dict[<span class="bu" style="color: null;
background-color: null;
font-style: inherit;">str</span>, Any]:</span>
<span id="cb6-27">        <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">"""하위 클래스가 구현해야 할 핵심 로직"""</span></span>
<span id="cb6-28">        <span class="cf" style="color: #003B4F;
background-color: null;
font-style: inherit;">pass</span></span>
<span id="cb6-29"></span>
<span id="cb6-30"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># Agent는 process()만 구현</span></span>
<span id="cb6-31"><span class="kw" style="color: #003B4F;
background-color: null;
font-style: inherit;">class</span> DataAgent(BaseAgent):</span>
<span id="cb6-32">    <span class="kw" style="color: #003B4F;
background-color: null;
font-style: inherit;">def</span> process(<span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">self</span>, <span class="bu" style="color: null;
background-color: null;
font-style: inherit;">input</span>):</span>
<span id="cb6-33">        <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># 비즈니스 로직만 집중</span></span>
<span id="cb6-34">        <span class="cf" style="color: #003B4F;
background-color: null;
font-style: inherit;">return</span> {<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">'result'</span>: standardized_data}</span></code></pre></div>
</section>
<section id="원칙-3-hook-methods" class="level3" data-number="2.1.3">
<h3 data-number="2.1.3" class="anchored" data-anchor-id="원칙-3-hook-methods"><span class="header-section-number">2.1.3</span> 원칙 3: Hook Methods</h3>
<p><strong>선택적 커스터마이징</strong>:</p>
<div class="sourceCode" id="cb7" style="background: #f1f3f5;"><pre class="sourceCode numberSource python number-lines code-with-copy"><code class="sourceCode python"><span id="cb7-1"><span class="kw" style="color: #003B4F;
background-color: null;
font-style: inherit;">class</span> BaseAgent(ABC):</span>
<span id="cb7-2">    <span class="kw" style="color: #003B4F;
background-color: null;
font-style: inherit;">def</span> _pre_process(<span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">self</span>, <span class="bu" style="color: null;
background-color: null;
font-style: inherit;">input</span>: Dict[<span class="bu" style="color: null;
background-color: null;
font-style: inherit;">str</span>, Any]) <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">-&gt;</span> Dict[<span class="bu" style="color: null;
background-color: null;
font-style: inherit;">str</span>, Any]:</span>
<span id="cb7-3">        <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">"""전처리 hook (선택적 override)"""</span></span>
<span id="cb7-4">        <span class="cf" style="color: #003B4F;
background-color: null;
font-style: inherit;">return</span> <span class="bu" style="color: null;
background-color: null;
font-style: inherit;">input</span></span>
<span id="cb7-5">    </span>
<span id="cb7-6">    <span class="kw" style="color: #003B4F;
background-color: null;
font-style: inherit;">def</span> _post_process(<span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">self</span>, output: Dict[<span class="bu" style="color: null;
background-color: null;
font-style: inherit;">str</span>, Any]) <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">-&gt;</span> Dict[<span class="bu" style="color: null;
background-color: null;
font-style: inherit;">str</span>, Any]:</span>
<span id="cb7-7">        <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">"""후처리 hook (선택적 override)"""</span></span>
<span id="cb7-8">        <span class="cf" style="color: #003B4F;
background-color: null;
font-style: inherit;">return</span> output</span>
<span id="cb7-9"></span>
<span id="cb7-10"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># Agent가 필요하면 override</span></span>
<span id="cb7-11"><span class="kw" style="color: #003B4F;
background-color: null;
font-style: inherit;">class</span> DataAgent(BaseAgent):</span>
<span id="cb7-12">    <span class="kw" style="color: #003B4F;
background-color: null;
font-style: inherit;">def</span> _pre_process(<span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">self</span>, <span class="bu" style="color: null;
background-color: null;
font-style: inherit;">input</span>):</span>
<span id="cb7-13">        <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># 입력 정규화</span></span>
<span id="cb7-14">        <span class="bu" style="color: null;
background-color: null;
font-style: inherit;">input</span>[<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">'data'</span>] <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> <span class="bu" style="color: null;
background-color: null;
font-style: inherit;">input</span>[<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">'data'</span>].lower()</span>
<span id="cb7-15">        <span class="cf" style="color: #003B4F;
background-color: null;
font-style: inherit;">return</span> <span class="bu" style="color: null;
background-color: null;
font-style: inherit;">input</span></span>
<span id="cb7-16">    </span>
<span id="cb7-17">    <span class="kw" style="color: #003B4F;
background-color: null;
font-style: inherit;">def</span> process(<span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">self</span>, <span class="bu" style="color: null;
background-color: null;
font-style: inherit;">input</span>):</span>
<span id="cb7-18">        <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># 핵심 로직</span></span>
<span id="cb7-19">        <span class="cf" style="color: #003B4F;
background-color: null;
font-style: inherit;">return</span> {<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">'result'</span>: ...}</span></code></pre></div>
</section>
</section>
<section id="baseagent-전체-구현" class="level2" data-number="2.2">
<h2 data-number="2.2" class="anchored" data-anchor-id="baseagent-전체-구현"><span class="header-section-number">2.2</span> BaseAgent 전체 구현</h2>
<div class="sourceCode" id="cb8" style="background: #f1f3f5;"><pre class="sourceCode numberSource python number-lines code-with-copy"><code class="sourceCode python"><span id="cb8-1"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># core/base_agent.py</span></span>
<span id="cb8-2"><span class="im" style="color: #00769E;
background-color: null;
font-style: inherit;">from</span> abc <span class="im" style="color: #00769E;
background-color: null;
font-style: inherit;">import</span> ABC, abstractmethod</span>
<span id="cb8-3"><span class="im" style="color: #00769E;
background-color: null;
font-style: inherit;">from</span> typing <span class="im" style="color: #00769E;
background-color: null;
font-style: inherit;">import</span> Dict, Any, Optional, List</span>
<span id="cb8-4"><span class="im" style="color: #00769E;
background-color: null;
font-style: inherit;">from</span> dataclasses <span class="im" style="color: #00769E;
background-color: null;
font-style: inherit;">import</span> dataclass</span>
<span id="cb8-5"><span class="im" style="color: #00769E;
background-color: null;
font-style: inherit;">import</span> time</span>
<span id="cb8-6"><span class="im" style="color: #00769E;
background-color: null;
font-style: inherit;">import</span> logging</span>
<span id="cb8-7"></span>
<span id="cb8-8">logger <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> logging.getLogger(<span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">__name__</span>)</span>
<span id="cb8-9"></span>
<span id="cb8-10"><span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">@dataclass</span></span>
<span id="cb8-11"><span class="kw" style="color: #003B4F;
background-color: null;
font-style: inherit;">class</span> AgentMetadata:</span>
<span id="cb8-12">    <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">"""Agent 메타데이터"""</span></span>
<span id="cb8-13">    name: <span class="bu" style="color: null;
background-color: null;
font-style: inherit;">str</span></span>
<span id="cb8-14">    version: <span class="bu" style="color: null;
background-color: null;
font-style: inherit;">str</span></span>
<span id="cb8-15">    domain: <span class="bu" style="color: null;
background-color: null;
font-style: inherit;">str</span></span>
<span id="cb8-16">    description: <span class="bu" style="color: null;
background-color: null;
font-style: inherit;">str</span></span>
<span id="cb8-17">    author: <span class="bu" style="color: null;
background-color: null;
font-style: inherit;">str</span></span>
<span id="cb8-18">    created_at: <span class="bu" style="color: null;
background-color: null;
font-style: inherit;">str</span></span>
<span id="cb8-19">    tags: List[<span class="bu" style="color: null;
background-color: null;
font-style: inherit;">str</span>] <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> <span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">None</span></span>
<span id="cb8-20"></span>
<span id="cb8-21"><span class="kw" style="color: #003B4F;
background-color: null;
font-style: inherit;">class</span> AgentMetrics:</span>
<span id="cb8-22">    <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">"""Agent 성능 메트릭"""</span></span>
<span id="cb8-23">    <span class="kw" style="color: #003B4F;
background-color: null;
font-style: inherit;">def</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">__init__</span>(<span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">self</span>):</span>
<span id="cb8-24">        <span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">self</span>.execution_count <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">0</span></span>
<span id="cb8-25">        <span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">self</span>.total_time <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> <span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">0.0</span></span>
<span id="cb8-26">        <span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">self</span>.errors: List[<span class="bu" style="color: null;
background-color: null;
font-style: inherit;">str</span>] <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> []</span>
<span id="cb8-27">        <span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">self</span>.success_count <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">0</span></span>
<span id="cb8-28">    </span>
<span id="cb8-29">    <span class="kw" style="color: #003B4F;
background-color: null;
font-style: inherit;">def</span> record_success(<span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">self</span>, elapsed_time: <span class="bu" style="color: null;
background-color: null;
font-style: inherit;">float</span>):</span>
<span id="cb8-30">        <span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">self</span>.execution_count <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+=</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span></span>
<span id="cb8-31">        <span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">self</span>.success_count <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+=</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span></span>
<span id="cb8-32">        <span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">self</span>.total_time <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+=</span> elapsed_time</span>
<span id="cb8-33">    </span>
<span id="cb8-34">    <span class="kw" style="color: #003B4F;
background-color: null;
font-style: inherit;">def</span> record_error(<span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">self</span>, error: <span class="bu" style="color: null;
background-color: null;
font-style: inherit;">str</span>):</span>
<span id="cb8-35">        <span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">self</span>.execution_count <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+=</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span></span>
<span id="cb8-36">        <span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">self</span>.errors.append(error)</span>
<span id="cb8-37">    </span>
<span id="cb8-38">    <span class="kw" style="color: #003B4F;
background-color: null;
font-style: inherit;">def</span> get_stats(<span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">self</span>) <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">-&gt;</span> Dict[<span class="bu" style="color: null;
background-color: null;
font-style: inherit;">str</span>, Any]:</span>
<span id="cb8-39">        <span class="cf" style="color: #003B4F;
background-color: null;
font-style: inherit;">return</span> {</span>
<span id="cb8-40">            <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">'executions'</span>: <span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">self</span>.execution_count,</span>
<span id="cb8-41">            <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">'success_rate'</span>: <span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">self</span>.success_count <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">/</span> <span class="bu" style="color: null;
background-color: null;
font-style: inherit;">max</span>(<span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">self</span>.execution_count, <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span>),</span>
<span id="cb8-42">            <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">'avg_time'</span>: <span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">self</span>.total_time <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">/</span> <span class="bu" style="color: null;
background-color: null;
font-style: inherit;">max</span>(<span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">self</span>.success_count, <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span>),</span>
<span id="cb8-43">            <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">'error_count'</span>: <span class="bu" style="color: null;
background-color: null;
font-style: inherit;">len</span>(<span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">self</span>.errors)</span>
<span id="cb8-44">        }</span>
<span id="cb8-45"></span>
<span id="cb8-46"><span class="kw" style="color: #003B4F;
background-color: null;
font-style: inherit;">class</span> BaseAgent(ABC):</span>
<span id="cb8-47">    <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">"""모든 Agent의 기본 클래스</span></span>
<span id="cb8-48"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">    </span></span>
<span id="cb8-49"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">    설계 원칙:</span></span>
<span id="cb8-50"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">    1. 표준 입출력: Dict[str, Any] (확장성)</span></span>
<span id="cb8-51"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">    2. Template Method: execute()는 final</span></span>
<span id="cb8-52"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">    3. Hook Methods: 선택적 커스터마이징</span></span>
<span id="cb8-53"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">    4. 자동 메트릭: 성능 추적</span></span>
<span id="cb8-54"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">    5. 평가 인터페이스: 도메인별 구현</span></span>
<span id="cb8-55"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">    """</span></span>
<span id="cb8-56">    </span>
<span id="cb8-57">    <span class="kw" style="color: #003B4F;
background-color: null;
font-style: inherit;">def</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">__init__</span>(<span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">self</span>, metadata: AgentMetadata):</span>
<span id="cb8-58">        <span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">self</span>.metadata <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> metadata</span>
<span id="cb8-59">        <span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">self</span>.metrics <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> AgentMetrics()</span>
<span id="cb8-60">        logger.info(<span class="ss" style="color: #20794D;
background-color: null;
font-style: inherit;">f"Initialized Agent: </span><span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">{</span>metadata<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">.</span>name<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">}</span><span class="ss" style="color: #20794D;
background-color: null;
font-style: inherit;"> v</span><span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">{</span>metadata<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">.</span>version<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">}</span><span class="ss" style="color: #20794D;
background-color: null;
font-style: inherit;">"</span>)</span>
<span id="cb8-61">    </span>
<span id="cb8-62">    <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">@abstractmethod</span></span>
<span id="cb8-63">    <span class="kw" style="color: #003B4F;
background-color: null;
font-style: inherit;">def</span> process(<span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">self</span>, <span class="bu" style="color: null;
background-color: null;
font-style: inherit;">input</span>: Dict[<span class="bu" style="color: null;
background-color: null;
font-style: inherit;">str</span>, Any]) <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">-&gt;</span> Dict[<span class="bu" style="color: null;
background-color: null;
font-style: inherit;">str</span>, Any]:</span>
<span id="cb8-64">        <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">"""핵심 비즈니스 로직 (하위 클래스 구현 필수)</span></span>
<span id="cb8-65"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">        </span></span>
<span id="cb8-66"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">        Args:</span></span>
<span id="cb8-67"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">            input: 표준 입력 딕셔너리</span></span>
<span id="cb8-68"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">                - task: 작업 유형</span></span>
<span id="cb8-69"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">                - data: 실제 데이터</span></span>
<span id="cb8-70"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">                - config: 실행 옵션 (선택)</span></span>
<span id="cb8-71"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">                - metadata: 컨텍스트 (선택)</span></span>
<span id="cb8-72"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">        </span></span>
<span id="cb8-73"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">        Returns:</span></span>
<span id="cb8-74"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">            표준 출력 딕셔너리</span></span>
<span id="cb8-75"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">                - result: 실행 결과</span></span>
<span id="cb8-76"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">                - confidence: 신뢰도 (0-1)</span></span>
<span id="cb8-77"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">                - errors: 에러 목록 (선택)</span></span>
<span id="cb8-78"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">        """</span></span>
<span id="cb8-79">        <span class="cf" style="color: #003B4F;
background-color: null;
font-style: inherit;">pass</span></span>
<span id="cb8-80">    </span>
<span id="cb8-81">    <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">@abstractmethod</span></span>
<span id="cb8-82">    <span class="kw" style="color: #003B4F;
background-color: null;
font-style: inherit;">def</span> evaluate(<span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">self</span>, ground_truth: Any, prediction: Any) <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">-&gt;</span> <span class="bu" style="color: null;
background-color: null;
font-style: inherit;">float</span>:</span>
<span id="cb8-83">        <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">"""성능 평가 (하위 클래스 구현 필수)</span></span>
<span id="cb8-84"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">        </span></span>
<span id="cb8-85"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">        각 Agent는 도메인에 맞는 평가 메트릭 구현</span></span>
<span id="cb8-86"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">        </span></span>
<span id="cb8-87"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">        Examples:</span></span>
<span id="cb8-88"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">            - 데이터 표준화: 스키마 매칭 정확도</span></span>
<span id="cb8-89"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">            - 코드 분석: AST 파싱 성공률</span></span>
<span id="cb8-90"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">            - 지식 QnA: ROUGE 스코어</span></span>
<span id="cb8-91"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">        </span></span>
<span id="cb8-92"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">        Returns:</span></span>
<span id="cb8-93"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">            평가 점수 (0-1)</span></span>
<span id="cb8-94"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">        """</span></span>
<span id="cb8-95">        <span class="cf" style="color: #003B4F;
background-color: null;
font-style: inherit;">pass</span></span>
<span id="cb8-96">    </span>
<span id="cb8-97">    <span class="kw" style="color: #003B4F;
background-color: null;
font-style: inherit;">def</span> execute(<span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">self</span>, <span class="bu" style="color: null;
background-color: null;
font-style: inherit;">input</span>: Dict[<span class="bu" style="color: null;
background-color: null;
font-style: inherit;">str</span>, Any]) <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">-&gt;</span> Dict[<span class="bu" style="color: null;
background-color: null;
font-style: inherit;">str</span>, Any]:</span>
<span id="cb8-98">        <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">"""Agent 실행 (Template Method - 수정 불가)</span></span>
<span id="cb8-99"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">        </span></span>
<span id="cb8-100"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">        실행 흐름:</span></span>
<span id="cb8-101"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">        1. 입력 검증</span></span>
<span id="cb8-102"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">        2. 전처리 hook</span></span>
<span id="cb8-103"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">        3. 실제 process() 호출</span></span>
<span id="cb8-104"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">        4. 후처리 hook</span></span>
<span id="cb8-105"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">        5. 메트릭 수집</span></span>
<span id="cb8-106"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">        6. 메타데이터 추가</span></span>
<span id="cb8-107"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">        </span></span>
<span id="cb8-108"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">        Returns:</span></span>
<span id="cb8-109"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">            표준 출력 + 메타데이터</span></span>
<span id="cb8-110"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">        """</span></span>
<span id="cb8-111">        <span class="cf" style="color: #003B4F;
background-color: null;
font-style: inherit;">try</span>:</span>
<span id="cb8-112">            <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># 1. 입력 검증</span></span>
<span id="cb8-113">            <span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">self</span>._validate_input(<span class="bu" style="color: null;
background-color: null;
font-style: inherit;">input</span>)</span>
<span id="cb8-114">            </span>
<span id="cb8-115">            <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># 2. 전처리</span></span>
<span id="cb8-116">            processed_input <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> <span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">self</span>._pre_process(<span class="bu" style="color: null;
background-color: null;
font-style: inherit;">input</span>)</span>
<span id="cb8-117">            </span>
<span id="cb8-118">            <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># 3. 시간 측정 시작</span></span>
<span id="cb8-119">            start_time <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> time.time()</span>
<span id="cb8-120">            </span>
<span id="cb8-121">            <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># 4. 핵심 로직 실행</span></span>
<span id="cb8-122">            result <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> <span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">self</span>.process(processed_input)</span>
<span id="cb8-123">            </span>
<span id="cb8-124">            <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># 5. 후처리</span></span>
<span id="cb8-125">            processed_result <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> <span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">self</span>._post_process(result)</span>
<span id="cb8-126">            </span>
<span id="cb8-127">            <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># 6. 실행 시간 계산</span></span>
<span id="cb8-128">            elapsed <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> time.time() <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">-</span> start_time</span>
<span id="cb8-129">            </span>
<span id="cb8-130">            <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># 7. 메트릭 기록</span></span>
<span id="cb8-131">            <span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">self</span>.metrics.record_success(elapsed)</span>
<span id="cb8-132">            </span>
<span id="cb8-133">            <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># 8. 메타데이터 추가</span></span>
<span id="cb8-134">            processed_result[<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">'metadata'</span>] <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> {</span>
<span id="cb8-135">                <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">'agent'</span>: <span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">self</span>.metadata.name,</span>
<span id="cb8-136">                <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">'version'</span>: <span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">self</span>.metadata.version,</span>
<span id="cb8-137">                <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">'execution_time'</span>: elapsed,</span>
<span id="cb8-138">                <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">'timestamp'</span>: time.time()</span>
<span id="cb8-139">            }</span>
<span id="cb8-140">            </span>
<span id="cb8-141">            logger.info(<span class="ss" style="color: #20794D;
background-color: null;
font-style: inherit;">f"Agent </span><span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">{</span><span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">self</span><span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">.</span>metadata<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">.</span>name<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">}</span><span class="ss" style="color: #20794D;
background-color: null;
font-style: inherit;"> succeeded in </span><span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">{</span>elapsed<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">:.2f}</span><span class="ss" style="color: #20794D;
background-color: null;
font-style: inherit;">s"</span>)</span>
<span id="cb8-142">            </span>
<span id="cb8-143">            <span class="cf" style="color: #003B4F;
background-color: null;
font-style: inherit;">return</span> processed_result</span>
<span id="cb8-144">            </span>
<span id="cb8-145">        <span class="cf" style="color: #003B4F;
background-color: null;
font-style: inherit;">except</span> <span class="pp" style="color: #AD0000;
background-color: null;
font-style: inherit;">Exception</span> <span class="im" style="color: #00769E;
background-color: null;
font-style: inherit;">as</span> e:</span>
<span id="cb8-146">            error_msg <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> <span class="ss" style="color: #20794D;
background-color: null;
font-style: inherit;">f"</span><span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">{</span><span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">self</span><span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">.</span>metadata<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">.</span>name<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">}</span><span class="ss" style="color: #20794D;
background-color: null;
font-style: inherit;"> failed: </span><span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">{</span><span class="bu" style="color: null;
background-color: null;
font-style: inherit;">str</span>(e)<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">}</span><span class="ss" style="color: #20794D;
background-color: null;
font-style: inherit;">"</span></span>
<span id="cb8-147">            logger.error(error_msg)</span>
<span id="cb8-148">            <span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">self</span>.metrics.record_error(error_msg)</span>
<span id="cb8-149">            <span class="cf" style="color: #003B4F;
background-color: null;
font-style: inherit;">raise</span></span>
<span id="cb8-150">    </span>
<span id="cb8-151">    <span class="kw" style="color: #003B4F;
background-color: null;
font-style: inherit;">def</span> _validate_input(<span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">self</span>, <span class="bu" style="color: null;
background-color: null;
font-style: inherit;">input</span>: Dict[<span class="bu" style="color: null;
background-color: null;
font-style: inherit;">str</span>, Any]):</span>
<span id="cb8-152">        <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">"""입력 검증 (공통 규칙)"""</span></span>
<span id="cb8-153">        <span class="cf" style="color: #003B4F;
background-color: null;
font-style: inherit;">if</span> <span class="kw" style="color: #003B4F;
background-color: null;
font-style: inherit;">not</span> <span class="bu" style="color: null;
background-color: null;
font-style: inherit;">isinstance</span>(<span class="bu" style="color: null;
background-color: null;
font-style: inherit;">input</span>, <span class="bu" style="color: null;
background-color: null;
font-style: inherit;">dict</span>):</span>
<span id="cb8-154">            <span class="cf" style="color: #003B4F;
background-color: null;
font-style: inherit;">raise</span> <span class="pp" style="color: #AD0000;
background-color: null;
font-style: inherit;">ValueError</span>(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Input must be a dictionary"</span>)</span>
<span id="cb8-155">        </span>
<span id="cb8-156">        <span class="cf" style="color: #003B4F;
background-color: null;
font-style: inherit;">if</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">'task'</span> <span class="kw" style="color: #003B4F;
background-color: null;
font-style: inherit;">not</span> <span class="kw" style="color: #003B4F;
background-color: null;
font-style: inherit;">in</span> <span class="bu" style="color: null;
background-color: null;
font-style: inherit;">input</span>:</span>
<span id="cb8-157">            <span class="cf" style="color: #003B4F;
background-color: null;
font-style: inherit;">raise</span> <span class="pp" style="color: #AD0000;
background-color: null;
font-style: inherit;">ValueError</span>(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Input must contain 'task' field"</span>)</span>
<span id="cb8-158">        </span>
<span id="cb8-159">        <span class="cf" style="color: #003B4F;
background-color: null;
font-style: inherit;">if</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">'data'</span> <span class="kw" style="color: #003B4F;
background-color: null;
font-style: inherit;">not</span> <span class="kw" style="color: #003B4F;
background-color: null;
font-style: inherit;">in</span> <span class="bu" style="color: null;
background-color: null;
font-style: inherit;">input</span>:</span>
<span id="cb8-160">            <span class="cf" style="color: #003B4F;
background-color: null;
font-style: inherit;">raise</span> <span class="pp" style="color: #AD0000;
background-color: null;
font-style: inherit;">ValueError</span>(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Input must contain 'data' field"</span>)</span>
<span id="cb8-161">    </span>
<span id="cb8-162">    <span class="kw" style="color: #003B4F;
background-color: null;
font-style: inherit;">def</span> _pre_process(<span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">self</span>, <span class="bu" style="color: null;
background-color: null;
font-style: inherit;">input</span>: Dict[<span class="bu" style="color: null;
background-color: null;
font-style: inherit;">str</span>, Any]) <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">-&gt;</span> Dict[<span class="bu" style="color: null;
background-color: null;
font-style: inherit;">str</span>, Any]:</span>
<span id="cb8-163">        <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">"""전처리 hook (선택적 override)</span></span>
<span id="cb8-164"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">        </span></span>
<span id="cb8-165"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">        예: 입력 정규화, 기본값 설정</span></span>
<span id="cb8-166"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">        """</span></span>
<span id="cb8-167">        <span class="cf" style="color: #003B4F;
background-color: null;
font-style: inherit;">return</span> <span class="bu" style="color: null;
background-color: null;
font-style: inherit;">input</span></span>
<span id="cb8-168">    </span>
<span id="cb8-169">    <span class="kw" style="color: #003B4F;
background-color: null;
font-style: inherit;">def</span> _post_process(<span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">self</span>, output: Dict[<span class="bu" style="color: null;
background-color: null;
font-style: inherit;">str</span>, Any]) <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">-&gt;</span> Dict[<span class="bu" style="color: null;
background-color: null;
font-style: inherit;">str</span>, Any]:</span>
<span id="cb8-170">        <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">"""후처리 hook (선택적 override)</span></span>
<span id="cb8-171"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">        </span></span>
<span id="cb8-172"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">        예: 출력 형식 변환, 에러 핸들링</span></span>
<span id="cb8-173"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">        """</span></span>
<span id="cb8-174">        <span class="cf" style="color: #003B4F;
background-color: null;
font-style: inherit;">return</span> output</span>
<span id="cb8-175">    </span>
<span id="cb8-176">    <span class="kw" style="color: #003B4F;
background-color: null;
font-style: inherit;">def</span> get_metrics(<span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">self</span>) <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">-&gt;</span> Dict[<span class="bu" style="color: null;
background-color: null;
font-style: inherit;">str</span>, Any]:</span>
<span id="cb8-177">        <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">"""Agent 성능 메트릭 조회"""</span></span>
<span id="cb8-178">        <span class="cf" style="color: #003B4F;
background-color: null;
font-style: inherit;">return</span> {</span>
<span id="cb8-179">            <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">'name'</span>: <span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">self</span>.metadata.name,</span>
<span id="cb8-180">            <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">**</span><span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">self</span>.metrics.get_stats()</span>
<span id="cb8-181">        }</span>
<span id="cb8-182">    </span>
<span id="cb8-183">    <span class="kw" style="color: #003B4F;
background-color: null;
font-style: inherit;">def</span> reset_metrics(<span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">self</span>):</span>
<span id="cb8-184">        <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">"""메트릭 초기화"""</span></span>
<span id="cb8-185">        <span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">self</span>.metrics <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> AgentMetrics()</span>
<span id="cb8-186">        logger.info(<span class="ss" style="color: #20794D;
background-color: null;
font-style: inherit;">f"Reset metrics for </span><span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">{</span><span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">self</span><span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">.</span>metadata<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">.</span>name<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">}</span><span class="ss" style="color: #20794D;
background-color: null;
font-style: inherit;">"</span>)</span></code></pre></div>
</section>
<section id="설계-의사결정-설명" class="level2" data-number="2.3">
<h2 data-number="2.3" class="anchored" data-anchor-id="설계-의사결정-설명"><span class="header-section-number">2.3</span> 설계 의사결정 설명</h2>
<section id="왜-dictstr-any인가" class="level3" data-number="2.3.1">
<h3 data-number="2.3.1" class="anchored" data-anchor-id="왜-dictstr-any인가"><span class="header-section-number">2.3.1</span> 왜 Dict[str, Any]인가?</h3>
<p><strong>대안 1: Pydantic 모델</strong></p>
<div class="sourceCode" id="cb9" style="background: #f1f3f5;"><pre class="sourceCode numberSource python number-lines code-with-copy"><code class="sourceCode python"><span id="cb9-1"><span class="kw" style="color: #003B4F;
background-color: null;
font-style: inherit;">class</span> AgentInput(BaseModel):</span>
<span id="cb9-2">    task: <span class="bu" style="color: null;
background-color: null;
font-style: inherit;">str</span></span>
<span id="cb9-3">    data: Dict[<span class="bu" style="color: null;
background-color: null;
font-style: inherit;">str</span>, Any]</span>
<span id="cb9-4">    config: Optional[Dict[<span class="bu" style="color: null;
background-color: null;
font-style: inherit;">str</span>, Any]]</span>
<span id="cb9-5"></span>
<span id="cb9-6"><span class="kw" style="color: #003B4F;
background-color: null;
font-style: inherit;">class</span> BaseAgent(ABC):</span>
<span id="cb9-7">    <span class="kw" style="color: #003B4F;
background-color: null;
font-style: inherit;">def</span> process(<span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">self</span>, <span class="bu" style="color: null;
background-color: null;
font-style: inherit;">input</span>: AgentInput) <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">-&gt;</span> AgentOutput:</span>
<span id="cb9-8">        <span class="cf" style="color: #003B4F;
background-color: null;
font-style: inherit;">pass</span></span></code></pre></div>
<p><strong>문제</strong>: - 타입이 고정됨 → 새 필드 추가 시 BaseAgent 수정 필요 - Agent마다 다른 입력 필요 시 상속 계층 복잡</p>
<p><strong>Dict[str, Any]의 장점</strong>: - 확장성: 새 필드 자유롭게 추가 - Agent별 커스터마이징 가능 - JSON 직렬화 간단</p>
<p><strong>트레이드오프</strong>: - 타입 안전성 낮음 - IDE 자동완성 없음</p>
<p><strong>해결책</strong>: 문서화 + 런타임 검증</p>
<div class="sourceCode" id="cb10" style="background: #f1f3f5;"><pre class="sourceCode numberSource python number-lines code-with-copy"><code class="sourceCode python"><span id="cb10-1"><span class="kw" style="color: #003B4F;
background-color: null;
font-style: inherit;">def</span> _validate_input(<span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">self</span>, <span class="bu" style="color: null;
background-color: null;
font-style: inherit;">input</span>: Dict[<span class="bu" style="color: null;
background-color: null;
font-style: inherit;">str</span>, Any]):</span>
<span id="cb10-2">    <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">"""입력 검증으로 타입 안전성 보완"""</span></span>
<span id="cb10-3">    required_fields <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> [<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">'task'</span>, <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">'data'</span>]</span>
<span id="cb10-4">    <span class="cf" style="color: #003B4F;
background-color: null;
font-style: inherit;">for</span> field <span class="kw" style="color: #003B4F;
background-color: null;
font-style: inherit;">in</span> required_fields:</span>
<span id="cb10-5">        <span class="cf" style="color: #003B4F;
background-color: null;
font-style: inherit;">if</span> field <span class="kw" style="color: #003B4F;
background-color: null;
font-style: inherit;">not</span> <span class="kw" style="color: #003B4F;
background-color: null;
font-style: inherit;">in</span> <span class="bu" style="color: null;
background-color: null;
font-style: inherit;">input</span>:</span>
<span id="cb10-6">            <span class="cf" style="color: #003B4F;
background-color: null;
font-style: inherit;">raise</span> <span class="pp" style="color: #AD0000;
background-color: null;
font-style: inherit;">ValueError</span>(<span class="ss" style="color: #20794D;
background-color: null;
font-style: inherit;">f"Missing required field: </span><span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">{</span>field<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">}</span><span class="ss" style="color: #20794D;
background-color: null;
font-style: inherit;">"</span>)</span></code></pre></div>
</section>
<section id="왜-execute와-process를-분리하는가" class="level3" data-number="2.3.2">
<h3 data-number="2.3.2" class="anchored" data-anchor-id="왜-execute와-process를-분리하는가"><span class="header-section-number">2.3.2</span> 왜 execute()와 process()를 분리하는가?</h3>
<p><strong>Template Method Pattern의 핵심</strong>:</p>
<div class="sourceCode" id="cb11" style="background: #f1f3f5;"><pre class="sourceCode numberSource python number-lines code-with-copy"><code class="sourceCode python"><span id="cb11-1"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># execute(): BaseAgent가 제어 (final)</span></span>
<span id="cb11-2"><span class="kw" style="color: #003B4F;
background-color: null;
font-style: inherit;">def</span> execute(<span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">self</span>, <span class="bu" style="color: null;
background-color: null;
font-style: inherit;">input</span>):</span>
<span id="cb11-3">    <span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">self</span>._validate_input(<span class="bu" style="color: null;
background-color: null;
font-style: inherit;">input</span>)  <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># 공통 로직</span></span>
<span id="cb11-4">    result <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> <span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">self</span>.process(<span class="bu" style="color: null;
background-color: null;
font-style: inherit;">input</span>)  <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># 하위 클래스 로직</span></span>
<span id="cb11-5">    <span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">self</span>._collect_metrics()       <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># 공통 로직</span></span>
<span id="cb11-6">    <span class="cf" style="color: #003B4F;
background-color: null;
font-style: inherit;">return</span> result</span>
<span id="cb11-7"></span>
<span id="cb11-8"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># process(): 하위 클래스가 구현</span></span>
<span id="cb11-9"><span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">@abstractmethod</span></span>
<span id="cb11-10"><span class="kw" style="color: #003B4F;
background-color: null;
font-style: inherit;">def</span> process(<span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">self</span>, <span class="bu" style="color: null;
background-color: null;
font-style: inherit;">input</span>):</span>
<span id="cb11-11">    <span class="cf" style="color: #003B4F;
background-color: null;
font-style: inherit;">pass</span></span></code></pre></div>
<p><strong>이점</strong>: 1. <strong>일관성</strong>: 모든 Agent가 검증, 메트릭 수집 자동 수행 2. <strong>단순성</strong>: Agent 개발자는 process()만 구현 3. <strong>안전성</strong>: 공통 로직 수정 시 모든 Agent에 자동 반영</p>
</section>
<section id="왜-evaluate를-인터페이스에-포함하는가" class="level3" data-number="2.3.3">
<h3 data-number="2.3.3" class="anchored" data-anchor-id="왜-evaluate를-인터페이스에-포함하는가"><span class="header-section-number">2.3.3</span> 왜 evaluate()를 인터페이스에 포함하는가?</h3>
<p><strong>문제</strong>: 각 Agent의 성능을 어떻게 측정?</p>
<div class="sourceCode" id="cb12" style="background: #f1f3f5;"><pre class="sourceCode numberSource python number-lines code-with-copy"><code class="sourceCode python"><span id="cb12-1"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># ❌ 나쁜 예: 평가 로직이 Agent 밖에 있음</span></span>
<span id="cb12-2"><span class="kw" style="color: #003B4F;
background-color: null;
font-style: inherit;">def</span> evaluate_data_agent(agent, test_data):</span>
<span id="cb12-3">    <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># 평가 로직이 외부에 있어 유지보수 어려움</span></span>
<span id="cb12-4">    ...</span>
<span id="cb12-5"></span>
<span id="cb12-6"><span class="kw" style="color: #003B4F;
background-color: null;
font-style: inherit;">def</span> evaluate_code_agent(agent, test_data):</span>
<span id="cb12-7">    <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># 다른 평가 로직 (중복)</span></span>
<span id="cb12-8">    ...</span></code></pre></div>
<p><strong>해결</strong>: Agent가 자신의 평가 방법 정의</p>
<div class="sourceCode" id="cb13" style="background: #f1f3f5;"><pre class="sourceCode numberSource python number-lines code-with-copy"><code class="sourceCode python"><span id="cb13-1"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># ✅ 좋은 예: Agent가 evaluate() 구현</span></span>
<span id="cb13-2"><span class="kw" style="color: #003B4F;
background-color: null;
font-style: inherit;">class</span> DataAgent(BaseAgent):</span>
<span id="cb13-3">    <span class="kw" style="color: #003B4F;
background-color: null;
font-style: inherit;">def</span> evaluate(<span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">self</span>, ground_truth, prediction):</span>
<span id="cb13-4">        <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># 스키마 매칭 정확도</span></span>
<span id="cb13-5">        <span class="cf" style="color: #003B4F;
background-color: null;
font-style: inherit;">return</span> schema_matching_score(ground_truth, prediction)</span>
<span id="cb13-6"></span>
<span id="cb13-7"><span class="kw" style="color: #003B4F;
background-color: null;
font-style: inherit;">class</span> CodeAgent(BaseAgent):</span>
<span id="cb13-8">    <span class="kw" style="color: #003B4F;
background-color: null;
font-style: inherit;">def</span> evaluate(<span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">self</span>, ground_truth, prediction):</span>
<span id="cb13-9">        <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># AST 파싱 성공률</span></span>
<span id="cb13-10">        <span class="cf" style="color: #003B4F;
background-color: null;
font-style: inherit;">return</span> ast_parsing_success_rate(ground_truth, prediction)</span>
<span id="cb13-11"></span>
<span id="cb13-12"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># 플랫폼이 일관되게 평가</span></span>
<span id="cb13-13"><span class="cf" style="color: #003B4F;
background-color: null;
font-style: inherit;">for</span> agent <span class="kw" style="color: #003B4F;
background-color: null;
font-style: inherit;">in</span> agents:</span>
<span id="cb13-14">    score <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> agent.evaluate(test_data.truth, test_data.pred)</span>
<span id="cb13-15">    <span class="bu" style="color: null;
background-color: null;
font-style: inherit;">print</span>(<span class="ss" style="color: #20794D;
background-color: null;
font-style: inherit;">f"</span><span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">{</span>agent<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">.</span>metadata<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">.</span>name<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">}</span><span class="ss" style="color: #20794D;
background-color: null;
font-style: inherit;">: </span><span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">{</span>score<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">:.2f}</span><span class="ss" style="color: #20794D;
background-color: null;
font-style: inherit;">"</span>)</span></code></pre></div>
</section>
</section>
</section>
<section id="agentregistry-dependency-inversion-구현" class="level1" data-number="3">
<h1 data-number="3"><span class="header-section-number">3</span> AgentRegistry: Dependency Inversion 구현</h1>
<section id="문제-core가-agent에-의존하면" class="level2" data-number="3.1">
<h2 data-number="3.1" class="anchored" data-anchor-id="문제-core가-agent에-의존하면"><span class="header-section-number">3.1</span> 문제: Core가 Agent에 의존하면?</h2>
<div class="sourceCode" id="cb14" style="background: #f1f3f5;"><pre class="sourceCode numberSource python number-lines code-with-copy"><code class="sourceCode python"><span id="cb14-1"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># ❌ 나쁜 예: Orchestrator가 Agent를 직접 import</span></span>
<span id="cb14-2"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># core/orchestrator.py</span></span>
<span id="cb14-3"><span class="im" style="color: #00769E;
background-color: null;
font-style: inherit;">from</span> agents.data_standardization <span class="im" style="color: #00769E;
background-color: null;
font-style: inherit;">import</span> DataAgent</span>
<span id="cb14-4"><span class="im" style="color: #00769E;
background-color: null;
font-style: inherit;">from</span> agents.code_analysis <span class="im" style="color: #00769E;
background-color: null;
font-style: inherit;">import</span> CodeAgent</span>
<span id="cb14-5"><span class="im" style="color: #00769E;
background-color: null;
font-style: inherit;">from</span> agents.knowledge_qna <span class="im" style="color: #00769E;
background-color: null;
font-style: inherit;">import</span> KnowledgeAgent</span>
<span id="cb14-6"></span>
<span id="cb14-7"><span class="kw" style="color: #003B4F;
background-color: null;
font-style: inherit;">class</span> Orchestrator:</span>
<span id="cb14-8">    <span class="kw" style="color: #003B4F;
background-color: null;
font-style: inherit;">def</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">__init__</span>(<span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">self</span>):</span>
<span id="cb14-9">        <span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">self</span>.agents <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> [</span>
<span id="cb14-10">            DataAgent(),</span>
<span id="cb14-11">            CodeAgent(),</span>
<span id="cb14-12">            KnowledgeAgent()</span>
<span id="cb14-13">        ]</span>
<span id="cb14-14">    </span>
<span id="cb14-15">    <span class="kw" style="color: #003B4F;
background-color: null;
font-style: inherit;">def</span> add_agent(<span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">self</span>, agent):</span>
<span id="cb14-16">        <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># 새 Agent 추가 시 이 파일 수정 필요</span></span>
<span id="cb14-17">        <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># → Core 모듈이 불안정해짐</span></span>
<span id="cb14-18">        <span class="cf" style="color: #003B4F;
background-color: null;
font-style: inherit;">pass</span></span></code></pre></div>
<p><strong>문제점</strong>: 1. Core → Agents 의존 (의존성 방향 위반) 2. 새 Agent 추가 시 Core 코드 수정 3. 순환 의존 가능성</p>
</section>
<section id="해결-registry-pattern" class="level2" data-number="3.2">
<h2 data-number="3.2" class="anchored" data-anchor-id="해결-registry-pattern"><span class="header-section-number">3.2</span> 해결: Registry Pattern</h2>
<div class="sourceCode" id="cb15" style="background: #f1f3f5;"><pre class="sourceCode numberSource python number-lines code-with-copy"><code class="sourceCode python"><span id="cb15-1"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># ✅ 좋은 예: Agent가 스스로 등록</span></span>
<span id="cb15-2"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># core/registry.py</span></span>
<span id="cb15-3"><span class="kw" style="color: #003B4F;
background-color: null;
font-style: inherit;">class</span> AgentRegistry:</span>
<span id="cb15-4">    <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">"""Agent 등록 및 조회 (Singleton)"""</span></span>
<span id="cb15-5">    </span>
<span id="cb15-6">    _instance <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> <span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">None</span></span>
<span id="cb15-7">    _agents: Dict[<span class="bu" style="color: null;
background-color: null;
font-style: inherit;">str</span>, BaseAgent] <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> {}</span>
<span id="cb15-8">    </span>
<span id="cb15-9">    <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">@classmethod</span></span>
<span id="cb15-10">    <span class="kw" style="color: #003B4F;
background-color: null;
font-style: inherit;">def</span> get_instance(cls):</span>
<span id="cb15-11">        <span class="cf" style="color: #003B4F;
background-color: null;
font-style: inherit;">if</span> cls._instance <span class="kw" style="color: #003B4F;
background-color: null;
font-style: inherit;">is</span> <span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">None</span>:</span>
<span id="cb15-12">            cls._instance <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> cls()</span>
<span id="cb15-13">        <span class="cf" style="color: #003B4F;
background-color: null;
font-style: inherit;">return</span> cls._instance</span>
<span id="cb15-14">    </span>
<span id="cb15-15">    <span class="kw" style="color: #003B4F;
background-color: null;
font-style: inherit;">def</span> register(<span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">self</span>, agent: BaseAgent):</span>
<span id="cb15-16">        <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">"""Agent 등록"""</span></span>
<span id="cb15-17">        name <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> agent.metadata.name</span>
<span id="cb15-18">        </span>
<span id="cb15-19">        <span class="cf" style="color: #003B4F;
background-color: null;
font-style: inherit;">if</span> name <span class="kw" style="color: #003B4F;
background-color: null;
font-style: inherit;">in</span> <span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">self</span>._agents:</span>
<span id="cb15-20">            <span class="cf" style="color: #003B4F;
background-color: null;
font-style: inherit;">raise</span> <span class="pp" style="color: #AD0000;
background-color: null;
font-style: inherit;">ValueError</span>(<span class="ss" style="color: #20794D;
background-color: null;
font-style: inherit;">f"Agent </span><span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">{</span>name<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">}</span><span class="ss" style="color: #20794D;
background-color: null;
font-style: inherit;"> already registered"</span>)</span>
<span id="cb15-21">        </span>
<span id="cb15-22">        <span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">self</span>._agents[name] <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> agent</span>
<span id="cb15-23">        logger.info(<span class="ss" style="color: #20794D;
background-color: null;
font-style: inherit;">f"✓ Registered: </span><span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">{</span>name<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">}</span><span class="ss" style="color: #20794D;
background-color: null;
font-style: inherit;"> v</span><span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">{</span>agent<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">.</span>metadata<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">.</span>version<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">}</span><span class="ss" style="color: #20794D;
background-color: null;
font-style: inherit;">"</span>)</span>
<span id="cb15-24">    </span>
<span id="cb15-25">    <span class="kw" style="color: #003B4F;
background-color: null;
font-style: inherit;">def</span> get(<span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">self</span>, name: <span class="bu" style="color: null;
background-color: null;
font-style: inherit;">str</span>) <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">-&gt;</span> BaseAgent:</span>
<span id="cb15-26">        <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">"""Agent 조회"""</span></span>
<span id="cb15-27">        <span class="cf" style="color: #003B4F;
background-color: null;
font-style: inherit;">if</span> name <span class="kw" style="color: #003B4F;
background-color: null;
font-style: inherit;">not</span> <span class="kw" style="color: #003B4F;
background-color: null;
font-style: inherit;">in</span> <span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">self</span>._agents:</span>
<span id="cb15-28">            available <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">', '</span>.join(<span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">self</span>._agents.keys())</span>
<span id="cb15-29">            <span class="cf" style="color: #003B4F;
background-color: null;
font-style: inherit;">raise</span> <span class="pp" style="color: #AD0000;
background-color: null;
font-style: inherit;">ValueError</span>(<span class="ss" style="color: #20794D;
background-color: null;
font-style: inherit;">f"Agent </span><span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">{</span>name<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">}</span><span class="ss" style="color: #20794D;
background-color: null;
font-style: inherit;"> not found. Available: </span><span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">{</span>available<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">}</span><span class="ss" style="color: #20794D;
background-color: null;
font-style: inherit;">"</span>)</span>
<span id="cb15-30">        </span>
<span id="cb15-31">        <span class="cf" style="color: #003B4F;
background-color: null;
font-style: inherit;">return</span> <span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">self</span>._agents[name]</span>
<span id="cb15-32">    </span>
<span id="cb15-33">    <span class="kw" style="color: #003B4F;
background-color: null;
font-style: inherit;">def</span> list_all(<span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">self</span>) <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">-&gt;</span> Dict[<span class="bu" style="color: null;
background-color: null;
font-style: inherit;">str</span>, BaseAgent]:</span>
<span id="cb15-34">        <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">"""모든 Agent 목록"""</span></span>
<span id="cb15-35">        <span class="cf" style="color: #003B4F;
background-color: null;
font-style: inherit;">return</span> <span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">self</span>._agents.copy()</span>
<span id="cb15-36">    </span>
<span id="cb15-37">    <span class="kw" style="color: #003B4F;
background-color: null;
font-style: inherit;">def</span> unregister(<span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">self</span>, name: <span class="bu" style="color: null;
background-color: null;
font-style: inherit;">str</span>):</span>
<span id="cb15-38">        <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">"""Agent 제거 (테스트용)"""</span></span>
<span id="cb15-39">        <span class="cf" style="color: #003B4F;
background-color: null;
font-style: inherit;">if</span> name <span class="kw" style="color: #003B4F;
background-color: null;
font-style: inherit;">in</span> <span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">self</span>._agents:</span>
<span id="cb15-40">            <span class="kw" style="color: #003B4F;
background-color: null;
font-style: inherit;">del</span> <span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">self</span>._agents[name]</span>
<span id="cb15-41">            logger.info(<span class="ss" style="color: #20794D;
background-color: null;
font-style: inherit;">f"✗ Unregistered: </span><span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">{</span>name<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">}</span><span class="ss" style="color: #20794D;
background-color: null;
font-style: inherit;">"</span>)</span>
<span id="cb15-42"></span>
<span id="cb15-43"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># agents/data_standardization/__init__.py</span></span>
<span id="cb15-44"><span class="im" style="color: #00769E;
background-color: null;
font-style: inherit;">from</span> core.registry <span class="im" style="color: #00769E;
background-color: null;
font-style: inherit;">import</span> AgentRegistry</span>
<span id="cb15-45"><span class="im" style="color: #00769E;
background-color: null;
font-style: inherit;">from</span> core.base_agent <span class="im" style="color: #00769E;
background-color: null;
font-style: inherit;">import</span> AgentMetadata</span>
<span id="cb15-46"><span class="im" style="color: #00769E;
background-color: null;
font-style: inherit;">from</span> .agent <span class="im" style="color: #00769E;
background-color: null;
font-style: inherit;">import</span> DataAgent</span>
<span id="cb15-47"></span>
<span id="cb15-48"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># 모듈 import 시 자동 등록</span></span>
<span id="cb15-49">metadata <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> AgentMetadata(</span>
<span id="cb15-50">    name<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"data_standardization"</span>,</span>
<span id="cb15-51">    version<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"1.0.0"</span>,</span>
<span id="cb15-52">    domain<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"data"</span>,</span>
<span id="cb15-53">    description<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"데이터 스키마 표준화"</span>,</span>
<span id="cb15-54">    author<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Platform Team"</span>,</span>
<span id="cb15-55">    created_at<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"2026-02-02"</span></span>
<span id="cb15-56">)</span>
<span id="cb15-57">agent <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> DataAgent(metadata)</span>
<span id="cb15-58">AgentRegistry.get_instance().register(agent)</span>
<span id="cb15-59"></span>
<span id="cb15-60"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># core/orchestrator.py</span></span>
<span id="cb15-61"><span class="kw" style="color: #003B4F;
background-color: null;
font-style: inherit;">class</span> Orchestrator:</span>
<span id="cb15-62">    <span class="kw" style="color: #003B4F;
background-color: null;
font-style: inherit;">def</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">__init__</span>(<span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">self</span>):</span>
<span id="cb15-63">        <span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">self</span>.registry <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> AgentRegistry.get_instance()</span>
<span id="cb15-64">    </span>
<span id="cb15-65">    <span class="kw" style="color: #003B4F;
background-color: null;
font-style: inherit;">def</span> run(<span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">self</span>, agent_name: <span class="bu" style="color: null;
background-color: null;
font-style: inherit;">str</span>, <span class="bu" style="color: null;
background-color: null;
font-style: inherit;">input</span>: Dict) <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">-&gt;</span> Dict:</span>
<span id="cb15-66">        <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># Agent를 직접 import하지 않음</span></span>
<span id="cb15-67">        agent <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> <span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">self</span>.registry.get(agent_name)</span>
<span id="cb15-68">        <span class="cf" style="color: #003B4F;
background-color: null;
font-style: inherit;">return</span> agent.execute(<span class="bu" style="color: null;
background-color: null;
font-style: inherit;">input</span>)</span></code></pre></div>
<p><strong>의존성 방향</strong>:</p>
<pre><code>agents/data_standardization/ → core/registry.py ✅
core/orchestrator.py → agents/ ❌ (불가능, import 없음)</code></pre>
</section>
<section id="실전-예시-agent-추가" class="level2" data-number="3.3">
<h2 data-number="3.3" class="anchored" data-anchor-id="실전-예시-agent-추가"><span class="header-section-number">3.3</span> 실전 예시: Agent 추가</h2>
<p><strong>새 Agent 추가 시 Core 수정 불필요</strong>:</p>
<div class="sourceCode" id="cb17" style="background: #f1f3f5;"><pre class="sourceCode numberSource bash number-lines code-with-copy"><code class="sourceCode bash"><span id="cb17-1"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># 1. 새 Agent 디렉토리 생성</span></span>
<span id="cb17-2"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">mkdir</span> agents/recommendation</span>
<span id="cb17-3"></span>
<span id="cb17-4"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># 2. Agent 구현</span></span>
<span id="cb17-5"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># agents/recommendation/agent.py</span></span>
<span id="cb17-6"><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">class</span> RecommendationAgent<span class="er" style="color: #AD0000;
background-color: null;
font-style: inherit;">(</span><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">BaseAgent</span><span class="kw" style="color: #003B4F;
background-color: null;
font-style: inherit;">)</span><span class="bu" style="color: null;
background-color: null;
font-style: inherit;">:</span></span>
<span id="cb17-7">    <span class="ex" style="color: null;
background-color: null;
font-style: inherit;">def</span> process<span class="er" style="color: #AD0000;
background-color: null;
font-style: inherit;">(</span><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">self,</span> input<span class="kw" style="color: #003B4F;
background-color: null;
font-style: inherit;">)</span><span class="bu" style="color: null;
background-color: null;
font-style: inherit;">:</span></span>
<span id="cb17-8">        <span class="cf" style="color: #003B4F;
background-color: null;
font-style: inherit;">return</span> <span class="ex" style="color: null;
background-color: null;
font-style: inherit;">{</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">'result'</span><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">:</span> recommendations}</span>
<span id="cb17-9">    </span>
<span id="cb17-10">    <span class="ex" style="color: null;
background-color: null;
font-style: inherit;">def</span> evaluate<span class="er" style="color: #AD0000;
background-color: null;
font-style: inherit;">(</span><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">self,</span> truth, pred<span class="kw" style="color: #003B4F;
background-color: null;
font-style: inherit;">)</span><span class="bu" style="color: null;
background-color: null;
font-style: inherit;">:</span></span>
<span id="cb17-11">        <span class="cf" style="color: #003B4F;
background-color: null;
font-style: inherit;">return</span> <span class="ex" style="color: null;
background-color: null;
font-style: inherit;">accuracy_score</span><span class="er" style="color: #AD0000;
background-color: null;
font-style: inherit;">(</span><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">truth,</span> pred<span class="kw" style="color: #003B4F;
background-color: null;
font-style: inherit;">)</span></span>
<span id="cb17-12"></span>
<span id="cb17-13"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># 3. 자동 등록</span></span>
<span id="cb17-14"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># agents/recommendation/__init__.py</span></span>
<span id="cb17-15"><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">metadata</span> = AgentMetadata<span class="er" style="color: #AD0000;
background-color: null;
font-style: inherit;">(</span><span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">name</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"recommendation"</span>, <span class="ex" style="color: null;
background-color: null;
font-style: inherit;">...</span><span class="kw" style="color: #003B4F;
background-color: null;
font-style: inherit;">)</span></span>
<span id="cb17-16"><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">agent</span> = RecommendationAgent<span class="er" style="color: #AD0000;
background-color: null;
font-style: inherit;">(</span><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">metadata</span><span class="kw" style="color: #003B4F;
background-color: null;
font-style: inherit;">)</span></span>
<span id="cb17-17"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">AgentRegistry.get_instance()</span><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">.register</span><span class="er" style="color: #AD0000;
background-color: null;
font-style: inherit;">(</span><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">agent</span><span class="kw" style="color: #003B4F;
background-color: null;
font-style: inherit;">)</span></span>
<span id="cb17-18"></span>
<span id="cb17-19"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># 4. 즉시 사용 가능 (Core 수정 없음)</span></span>
<span id="cb17-20"><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">orchestrator</span> = Orchestrator<span class="er" style="color: #AD0000;
background-color: null;
font-style: inherit;">(</span><span class="kw" style="color: #003B4F;
background-color: null;
font-style: inherit;">)</span></span>
<span id="cb17-21"><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">result</span> = orchestrator.run<span class="er" style="color: #AD0000;
background-color: null;
font-style: inherit;">(</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"recommendation"</span><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">,</span> input_data<span class="kw" style="color: #003B4F;
background-color: null;
font-style: inherit;">)</span></span></code></pre></div>
</section>
</section>
<section id="orchestrator-agent-실행-관리" class="level1" data-number="4">
<h1 data-number="4"><span class="header-section-number">4</span> Orchestrator: Agent 실행 관리</h1>
<section id="단일-agent-실행" class="level2" data-number="4.1">
<h2 data-number="4.1" class="anchored" data-anchor-id="단일-agent-실행"><span class="header-section-number">4.1</span> 단일 Agent 실행</h2>
<div class="sourceCode" id="cb18" style="background: #f1f3f5;"><pre class="sourceCode numberSource python number-lines code-with-copy"><code class="sourceCode python"><span id="cb18-1"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># core/orchestrator.py</span></span>
<span id="cb18-2"><span class="im" style="color: #00769E;
background-color: null;
font-style: inherit;">from</span> typing <span class="im" style="color: #00769E;
background-color: null;
font-style: inherit;">import</span> Dict, List, Any</span>
<span id="cb18-3"><span class="im" style="color: #00769E;
background-color: null;
font-style: inherit;">from</span> .registry <span class="im" style="color: #00769E;
background-color: null;
font-style: inherit;">import</span> AgentRegistry</span>
<span id="cb18-4"><span class="im" style="color: #00769E;
background-color: null;
font-style: inherit;">import</span> logging</span>
<span id="cb18-5"></span>
<span id="cb18-6">logger <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> logging.getLogger(<span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">__name__</span>)</span>
<span id="cb18-7"></span>
<span id="cb18-8"><span class="kw" style="color: #003B4F;
background-color: null;
font-style: inherit;">class</span> AgentOrchestrator:</span>
<span id="cb18-9">    <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">"""Agent 실행 및 조율</span></span>
<span id="cb18-10"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">    </span></span>
<span id="cb18-11"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">    기능:</span></span>
<span id="cb18-12"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">    1. 단일 Agent 실행</span></span>
<span id="cb18-13"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">    2. Agent 체이닝 (순차 실행)</span></span>
<span id="cb18-14"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">    3. 병렬 실행</span></span>
<span id="cb18-15"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">    4. 조건부 실행</span></span>
<span id="cb18-16"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">    """</span></span>
<span id="cb18-17">    </span>
<span id="cb18-18">    <span class="kw" style="color: #003B4F;
background-color: null;
font-style: inherit;">def</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">__init__</span>(<span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">self</span>):</span>
<span id="cb18-19">        <span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">self</span>.registry <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> AgentRegistry.get_instance()</span>
<span id="cb18-20">    </span>
<span id="cb18-21">    <span class="kw" style="color: #003B4F;
background-color: null;
font-style: inherit;">def</span> run(</span>
<span id="cb18-22">        <span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">self</span>,</span>
<span id="cb18-23">        agent_name: <span class="bu" style="color: null;
background-color: null;
font-style: inherit;">str</span>,</span>
<span id="cb18-24">        input_data: Dict[<span class="bu" style="color: null;
background-color: null;
font-style: inherit;">str</span>, Any],</span>
<span id="cb18-25">        timeout: Optional[<span class="bu" style="color: null;
background-color: null;
font-style: inherit;">float</span>] <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> <span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">None</span></span>
<span id="cb18-26">    ) <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">-&gt;</span> Dict[<span class="bu" style="color: null;
background-color: null;
font-style: inherit;">str</span>, Any]:</span>
<span id="cb18-27">        <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">"""단일 Agent 실행</span></span>
<span id="cb18-28"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">        </span></span>
<span id="cb18-29"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">        Args:</span></span>
<span id="cb18-30"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">            agent_name: Agent 이름</span></span>
<span id="cb18-31"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">            input_data: 입력 데이터</span></span>
<span id="cb18-32"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">            timeout: 타임아웃 (초)</span></span>
<span id="cb18-33"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">        </span></span>
<span id="cb18-34"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">        Returns:</span></span>
<span id="cb18-35"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">            Agent 실행 결과</span></span>
<span id="cb18-36"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">        """</span></span>
<span id="cb18-37">        logger.info(<span class="ss" style="color: #20794D;
background-color: null;
font-style: inherit;">f"Running agent: </span><span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">{</span>agent_name<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">}</span><span class="ss" style="color: #20794D;
background-color: null;
font-style: inherit;">"</span>)</span>
<span id="cb18-38">        </span>
<span id="cb18-39">        agent <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> <span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">self</span>.registry.get(agent_name)</span>
<span id="cb18-40">        result <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> agent.execute(input_data)</span>
<span id="cb18-41">        </span>
<span id="cb18-42">        logger.info(<span class="ss" style="color: #20794D;
background-color: null;
font-style: inherit;">f"Agent </span><span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">{</span>agent_name<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">}</span><span class="ss" style="color: #20794D;
background-color: null;
font-style: inherit;"> completed"</span>)</span>
<span id="cb18-43">        <span class="cf" style="color: #003B4F;
background-color: null;
font-style: inherit;">return</span> result</span></code></pre></div>
</section>
<section id="agent-체이닝" class="level2" data-number="4.2">
<h2 data-number="4.2" class="anchored" data-anchor-id="agent-체이닝"><span class="header-section-number">4.2</span> Agent 체이닝</h2>
<div class="sourceCode" id="cb19" style="background: #f1f3f5;"><pre class="sourceCode numberSource python number-lines code-with-copy"><code class="sourceCode python"><span id="cb19-1"><span class="kw" style="color: #003B4F;
background-color: null;
font-style: inherit;">def</span> chain(</span>
<span id="cb19-2">    <span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">self</span>,</span>
<span id="cb19-3">    agent_names: List[<span class="bu" style="color: null;
background-color: null;
font-style: inherit;">str</span>],</span>
<span id="cb19-4">    input_data: Dict[<span class="bu" style="color: null;
background-color: null;
font-style: inherit;">str</span>, Any],</span>
<span id="cb19-5">    pass_intermediate: <span class="bu" style="color: null;
background-color: null;
font-style: inherit;">bool</span> <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> <span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">True</span></span>
<span id="cb19-6">) <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">-&gt;</span> Dict[<span class="bu" style="color: null;
background-color: null;
font-style: inherit;">str</span>, Any]:</span>
<span id="cb19-7">    <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">"""Agent 체이닝 (순차 실행)</span></span>
<span id="cb19-8"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">    </span></span>
<span id="cb19-9"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">    Args:</span></span>
<span id="cb19-10"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">        agent_names: Agent 이름 목록</span></span>
<span id="cb19-11"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">        input_data: 초기 입력</span></span>
<span id="cb19-12"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">        pass_intermediate: 중간 결과를 다음 Agent에 전달 여부</span></span>
<span id="cb19-13"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">    </span></span>
<span id="cb19-14"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">    Returns:</span></span>
<span id="cb19-15"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">        최종 결과</span></span>
<span id="cb19-16"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">    </span></span>
<span id="cb19-17"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">    Example:</span></span>
<span id="cb19-18"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">        orchestrator.chain(</span></span>
<span id="cb19-19"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">            ['data_standardization', 'code_analysis', 'recommendation'],</span></span>
<span id="cb19-20"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">            {'task': 'analyze', 'data': schema}</span></span>
<span id="cb19-21"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">        )</span></span>
<span id="cb19-22"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">    """</span></span>
<span id="cb19-23">    result <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> input_data</span>
<span id="cb19-24">    </span>
<span id="cb19-25">    <span class="cf" style="color: #003B4F;
background-color: null;
font-style: inherit;">for</span> agent_name <span class="kw" style="color: #003B4F;
background-color: null;
font-style: inherit;">in</span> agent_names:</span>
<span id="cb19-26">        logger.info(<span class="ss" style="color: #20794D;
background-color: null;
font-style: inherit;">f"Chain step: </span><span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">{</span>agent_name<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">}</span><span class="ss" style="color: #20794D;
background-color: null;
font-style: inherit;">"</span>)</span>
<span id="cb19-27">        </span>
<span id="cb19-28">        agent <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> <span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">self</span>.registry.get(agent_name)</span>
<span id="cb19-29">        result <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> agent.execute(result)</span>
<span id="cb19-30">        </span>
<span id="cb19-31">        <span class="cf" style="color: #003B4F;
background-color: null;
font-style: inherit;">if</span> <span class="kw" style="color: #003B4F;
background-color: null;
font-style: inherit;">not</span> pass_intermediate:</span>
<span id="cb19-32">            <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># 원본 입력 유지, 결과만 누적</span></span>
<span id="cb19-33">            result <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> {</span>
<span id="cb19-34">                <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">**</span>input_data,</span>
<span id="cb19-35">                <span class="ss" style="color: #20794D;
background-color: null;
font-style: inherit;">f'</span><span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">{</span>agent_name<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">}</span><span class="ss" style="color: #20794D;
background-color: null;
font-style: inherit;">_result'</span>: result</span>
<span id="cb19-36">            }</span>
<span id="cb19-37">    </span>
<span id="cb19-38">    <span class="cf" style="color: #003B4F;
background-color: null;
font-style: inherit;">return</span> result</span></code></pre></div>
<p><strong>실행 예시</strong>:</p>
<div class="sourceCode" id="cb20" style="background: #f1f3f5;"><pre class="sourceCode numberSource python number-lines code-with-copy"><code class="sourceCode python"><span id="cb20-1"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># 데이터 표준화 → 코드 분석 → 추천</span></span>
<span id="cb20-2">orchestrator <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> AgentOrchestrator()</span>
<span id="cb20-3"></span>
<span id="cb20-4">result <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> orchestrator.chain(</span>
<span id="cb20-5">    agent_names<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span>[<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">'data_standardization'</span>, <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">'code_analysis'</span>, <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">'recommendation'</span>],</span>
<span id="cb20-6">    input_data<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span>{</span>
<span id="cb20-7">        <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">'task'</span>: <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">'analyze_and_recommend'</span>,</span>
<span id="cb20-8">        <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">'data'</span>: {<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">'schema'</span>: raw_schema}</span>
<span id="cb20-9">    }</span>
<span id="cb20-10">)</span>
<span id="cb20-11"></span>
<span id="cb20-12"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># 결과</span></span>
<span id="cb20-13">{</span>
<span id="cb20-14">    <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">'result'</span>: [...],  <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># 최종 추천 결과</span></span>
<span id="cb20-15">    <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">'metadata'</span>: {</span>
<span id="cb20-16">        <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">'agent'</span>: <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">'recommendation'</span>,  <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># 마지막 Agent</span></span>
<span id="cb20-17">        <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">'execution_time'</span>: <span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">5.2</span></span>
<span id="cb20-18">    }</span>
<span id="cb20-19">}</span></code></pre></div>
</section>
<section id="병렬-실행" class="level2" data-number="4.3">
<h2 data-number="4.3" class="anchored" data-anchor-id="병렬-실행"><span class="header-section-number">4.3</span> 병렬 실행</h2>
<div class="sourceCode" id="cb21" style="background: #f1f3f5;"><pre class="sourceCode numberSource python number-lines code-with-copy"><code class="sourceCode python"><span id="cb21-1"><span class="im" style="color: #00769E;
background-color: null;
font-style: inherit;">import</span> concurrent.futures</span>
<span id="cb21-2"></span>
<span id="cb21-3"><span class="kw" style="color: #003B4F;
background-color: null;
font-style: inherit;">def</span> parallel(</span>
<span id="cb21-4">    <span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">self</span>,</span>
<span id="cb21-5">    agent_names: List[<span class="bu" style="color: null;
background-color: null;
font-style: inherit;">str</span>],</span>
<span id="cb21-6">    input_data: Dict[<span class="bu" style="color: null;
background-color: null;
font-style: inherit;">str</span>, Any],</span>
<span id="cb21-7">    max_workers: <span class="bu" style="color: null;
background-color: null;
font-style: inherit;">int</span> <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">4</span></span>
<span id="cb21-8">) <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">-&gt;</span> List[Dict[<span class="bu" style="color: null;
background-color: null;
font-style: inherit;">str</span>, Any]]:</span>
<span id="cb21-9">    <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">"""병렬 실행 (동일 입력, 여러 Agent)</span></span>
<span id="cb21-10"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">    </span></span>
<span id="cb21-11"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">    Args:</span></span>
<span id="cb21-12"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">        agent_names: Agent 이름 목록</span></span>
<span id="cb21-13"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">        input_data: 입력 데이터 (모든 Agent 공통)</span></span>
<span id="cb21-14"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">        max_workers: 최대 병렬 워커 수</span></span>
<span id="cb21-15"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">    </span></span>
<span id="cb21-16"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">    Returns:</span></span>
<span id="cb21-17"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">        Agent별 실행 결과 리스트</span></span>
<span id="cb21-18"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">    </span></span>
<span id="cb21-19"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">    Use Case:</span></span>
<span id="cb21-20"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">        - 여러 Agent의 결과 비교 (앙상블)</span></span>
<span id="cb21-21"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">        - A/B 테스트</span></span>
<span id="cb21-22"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">    """</span></span>
<span id="cb21-23">    <span class="kw" style="color: #003B4F;
background-color: null;
font-style: inherit;">def</span> run_agent(agent_name: <span class="bu" style="color: null;
background-color: null;
font-style: inherit;">str</span>) <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">-&gt;</span> Dict[<span class="bu" style="color: null;
background-color: null;
font-style: inherit;">str</span>, Any]:</span>
<span id="cb21-24">        agent <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> <span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">self</span>.registry.get(agent_name)</span>
<span id="cb21-25">        <span class="cf" style="color: #003B4F;
background-color: null;
font-style: inherit;">return</span> agent.execute(input_data)</span>
<span id="cb21-26">    </span>
<span id="cb21-27">    <span class="cf" style="color: #003B4F;
background-color: null;
font-style: inherit;">with</span> concurrent.futures.ThreadPoolExecutor(max_workers<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span>max_workers) <span class="im" style="color: #00769E;
background-color: null;
font-style: inherit;">as</span> executor:</span>
<span id="cb21-28">        futures <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> {</span>
<span id="cb21-29">            executor.submit(run_agent, name): name</span>
<span id="cb21-30">            <span class="cf" style="color: #003B4F;
background-color: null;
font-style: inherit;">for</span> name <span class="kw" style="color: #003B4F;
background-color: null;
font-style: inherit;">in</span> agent_names</span>
<span id="cb21-31">        }</span>
<span id="cb21-32">        </span>
<span id="cb21-33">        results <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> []</span>
<span id="cb21-34">        <span class="cf" style="color: #003B4F;
background-color: null;
font-style: inherit;">for</span> future <span class="kw" style="color: #003B4F;
background-color: null;
font-style: inherit;">in</span> concurrent.futures.as_completed(futures):</span>
<span id="cb21-35">            agent_name <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> futures[future]</span>
<span id="cb21-36">            <span class="cf" style="color: #003B4F;
background-color: null;
font-style: inherit;">try</span>:</span>
<span id="cb21-37">                result <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> future.result()</span>
<span id="cb21-38">                results.append(result)</span>
<span id="cb21-39">                logger.info(<span class="ss" style="color: #20794D;
background-color: null;
font-style: inherit;">f"Agent </span><span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">{</span>agent_name<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">}</span><span class="ss" style="color: #20794D;
background-color: null;
font-style: inherit;"> completed"</span>)</span>
<span id="cb21-40">            <span class="cf" style="color: #003B4F;
background-color: null;
font-style: inherit;">except</span> <span class="pp" style="color: #AD0000;
background-color: null;
font-style: inherit;">Exception</span> <span class="im" style="color: #00769E;
background-color: null;
font-style: inherit;">as</span> e:</span>
<span id="cb21-41">                logger.error(<span class="ss" style="color: #20794D;
background-color: null;
font-style: inherit;">f"Agent </span><span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">{</span>agent_name<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">}</span><span class="ss" style="color: #20794D;
background-color: null;
font-style: inherit;"> failed: </span><span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">{</span>e<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">}</span><span class="ss" style="color: #20794D;
background-color: null;
font-style: inherit;">"</span>)</span>
<span id="cb21-42">        </span>
<span id="cb21-43">        <span class="cf" style="color: #003B4F;
background-color: null;
font-style: inherit;">return</span> results</span></code></pre></div>
<p><strong>실행 예시</strong>:</p>
<div class="sourceCode" id="cb22" style="background: #f1f3f5;"><pre class="sourceCode numberSource python number-lines code-with-copy"><code class="sourceCode python"><span id="cb22-1"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># 3개 Agent를 병렬로 실행하여 결과 비교</span></span>
<span id="cb22-2">results <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> orchestrator.parallel(</span>
<span id="cb22-3">    agent_names<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span>[<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">'agent_v1'</span>, <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">'agent_v2'</span>, <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">'agent_v3'</span>],</span>
<span id="cb22-4">    input_data<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span>{<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">'task'</span>: <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">'analyze'</span>, <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">'data'</span>: test_data}</span>
<span id="cb22-5">)</span>
<span id="cb22-6"></span>
<span id="cb22-7"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># 결과 비교</span></span>
<span id="cb22-8"><span class="cf" style="color: #003B4F;
background-color: null;
font-style: inherit;">for</span> result <span class="kw" style="color: #003B4F;
background-color: null;
font-style: inherit;">in</span> results:</span>
<span id="cb22-9">    agent_name <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> result[<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">'metadata'</span>][<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">'agent'</span>]</span>
<span id="cb22-10">    confidence <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> result[<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">'confidence'</span>]</span>
<span id="cb22-11">    <span class="bu" style="color: null;
background-color: null;
font-style: inherit;">print</span>(<span class="ss" style="color: #20794D;
background-color: null;
font-style: inherit;">f"</span><span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">{</span>agent_name<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">}</span><span class="ss" style="color: #20794D;
background-color: null;
font-style: inherit;">: </span><span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">{</span>confidence<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">:.2f}</span><span class="ss" style="color: #20794D;
background-color: null;
font-style: inherit;">"</span>)</span></code></pre></div>
</section>
<section id="조건부-실행" class="level2" data-number="4.4">
<h2 data-number="4.4" class="anchored" data-anchor-id="조건부-실행"><span class="header-section-number">4.4</span> 조건부 실행</h2>
<div class="sourceCode" id="cb23" style="background: #f1f3f5;"><pre class="sourceCode numberSource python number-lines code-with-copy"><code class="sourceCode python"><span id="cb23-1"><span class="kw" style="color: #003B4F;
background-color: null;
font-style: inherit;">def</span> conditional_chain(</span>
<span id="cb23-2">    <span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">self</span>,</span>
<span id="cb23-3">    agent_configs: List[Dict[<span class="bu" style="color: null;
background-color: null;
font-style: inherit;">str</span>, Any]],</span>
<span id="cb23-4">    input_data: Dict[<span class="bu" style="color: null;
background-color: null;
font-style: inherit;">str</span>, Any]</span>
<span id="cb23-5">) <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">-&gt;</span> Dict[<span class="bu" style="color: null;
background-color: null;
font-style: inherit;">str</span>, Any]:</span>
<span id="cb23-6">    <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">"""조건부 Agent 체이닝</span></span>
<span id="cb23-7"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">    </span></span>
<span id="cb23-8"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">    Args:</span></span>
<span id="cb23-9"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">        agent_configs: Agent 설정 목록</span></span>
<span id="cb23-10"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">            [</span></span>
<span id="cb23-11"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">                {'name': 'agent1', 'condition': lambda r: r['confidence'] &gt; 0.8},</span></span>
<span id="cb23-12"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">                {'name': 'agent2', 'condition': lambda r: 'error' not in r}</span></span>
<span id="cb23-13"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">            ]</span></span>
<span id="cb23-14"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">        input_data: 초기 입력</span></span>
<span id="cb23-15"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">    </span></span>
<span id="cb23-16"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">    Returns:</span></span>
<span id="cb23-17"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">        최종 결과</span></span>
<span id="cb23-18"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">    """</span></span>
<span id="cb23-19">    result <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> input_data</span>
<span id="cb23-20">    </span>
<span id="cb23-21">    <span class="cf" style="color: #003B4F;
background-color: null;
font-style: inherit;">for</span> config <span class="kw" style="color: #003B4F;
background-color: null;
font-style: inherit;">in</span> agent_configs:</span>
<span id="cb23-22">        agent_name <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> config[<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">'name'</span>]</span>
<span id="cb23-23">        condition <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> config.get(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">'condition'</span>, <span class="kw" style="color: #003B4F;
background-color: null;
font-style: inherit;">lambda</span> r: <span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">True</span>)</span>
<span id="cb23-24">        </span>
<span id="cb23-25">        <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># 조건 확인</span></span>
<span id="cb23-26">        <span class="cf" style="color: #003B4F;
background-color: null;
font-style: inherit;">if</span> <span class="kw" style="color: #003B4F;
background-color: null;
font-style: inherit;">not</span> condition(result):</span>
<span id="cb23-27">            logger.info(<span class="ss" style="color: #20794D;
background-color: null;
font-style: inherit;">f"Skipping </span><span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">{</span>agent_name<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">}</span><span class="ss" style="color: #20794D;
background-color: null;
font-style: inherit;"> (condition not met)"</span>)</span>
<span id="cb23-28">            <span class="cf" style="color: #003B4F;
background-color: null;
font-style: inherit;">continue</span></span>
<span id="cb23-29">        </span>
<span id="cb23-30">        <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># Agent 실행</span></span>
<span id="cb23-31">        agent <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> <span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">self</span>.registry.get(agent_name)</span>
<span id="cb23-32">        result <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> agent.execute(result)</span>
<span id="cb23-33">    </span>
<span id="cb23-34">    <span class="cf" style="color: #003B4F;
background-color: null;
font-style: inherit;">return</span> result</span></code></pre></div>
<p><strong>실행 예시</strong>:</p>
<div class="sourceCode" id="cb24" style="background: #f1f3f5;"><pre class="sourceCode numberSource python number-lines code-with-copy"><code class="sourceCode python"><span id="cb24-1"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># 신뢰도 높을 때만 다음 Agent 실행</span></span>
<span id="cb24-2">result <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> orchestrator.conditional_chain(</span>
<span id="cb24-3">    agent_configs<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span>[</span>
<span id="cb24-4">        {<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">'name'</span>: <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">'data_standardization'</span>},</span>
<span id="cb24-5">        {</span>
<span id="cb24-6">            <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">'name'</span>: <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">'code_analysis'</span>,</span>
<span id="cb24-7">            <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">'condition'</span>: <span class="kw" style="color: #003B4F;
background-color: null;
font-style: inherit;">lambda</span> r: r.get(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">'confidence'</span>, <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">0</span>) <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">&gt;</span> <span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">0.8</span></span>
<span id="cb24-8">        },</span>
<span id="cb24-9">        {</span>
<span id="cb24-10">            <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">'name'</span>: <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">'recommendation'</span>,</span>
<span id="cb24-11">            <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">'condition'</span>: <span class="kw" style="color: #003B4F;
background-color: null;
font-style: inherit;">lambda</span> r: <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">'errors'</span> <span class="kw" style="color: #003B4F;
background-color: null;
font-style: inherit;">not</span> <span class="kw" style="color: #003B4F;
background-color: null;
font-style: inherit;">in</span> r</span>
<span id="cb24-12">        }</span>
<span id="cb24-13">    ],</span>
<span id="cb24-14">    input_data<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span>{<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">'task'</span>: <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">'analyze'</span>, <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">'data'</span>: schema}</span>
<span id="cb24-15">)</span></code></pre></div>
</section>
</section>
<section id="실제-agent-구현-예시" class="level1" data-number="5">
<h1 data-number="5"><span class="header-section-number">5</span> 실제 Agent 구현 예시</h1>
<section id="datastandardizationagent" class="level2" data-number="5.1">
<h2 data-number="5.1" class="anchored" data-anchor-id="datastandardizationagent"><span class="header-section-number">5.1</span> DataStandardizationAgent</h2>
<div class="sourceCode" id="cb25" style="background: #f1f3f5;"><pre class="sourceCode numberSource python number-lines code-with-copy"><code class="sourceCode python"><span id="cb25-1"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># agents/data_standardization/agent.py</span></span>
<span id="cb25-2"><span class="im" style="color: #00769E;
background-color: null;
font-style: inherit;">from</span> core.base_agent <span class="im" style="color: #00769E;
background-color: null;
font-style: inherit;">import</span> BaseAgent, AgentMetadata</span>
<span id="cb25-3"><span class="im" style="color: #00769E;
background-color: null;
font-style: inherit;">from</span> shared.llm.client <span class="im" style="color: #00769E;
background-color: null;
font-style: inherit;">import</span> LLMClient</span>
<span id="cb25-4"><span class="im" style="color: #00769E;
background-color: null;
font-style: inherit;">from</span> typing <span class="im" style="color: #00769E;
background-color: null;
font-style: inherit;">import</span> Dict, Any</span>
<span id="cb25-5"></span>
<span id="cb25-6"><span class="kw" style="color: #003B4F;
background-color: null;
font-style: inherit;">class</span> DataStandardizationAgent(BaseAgent):</span>
<span id="cb25-7">    <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">"""데이터 스키마 표준화 Agent</span></span>
<span id="cb25-8"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">    </span></span>
<span id="cb25-9"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">    기능:</span></span>
<span id="cb25-10"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">    - 비표준 스키마를 표준 형식으로 변환</span></span>
<span id="cb25-11"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">    - 필드명 정규화 (예: "환자번호" → "patient_id")</span></span>
<span id="cb25-12"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">    - 데이터 타입 추론</span></span>
<span id="cb25-13"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">    """</span></span>
<span id="cb25-14">    </span>
<span id="cb25-15">    <span class="kw" style="color: #003B4F;
background-color: null;
font-style: inherit;">def</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">__init__</span>(<span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">self</span>, metadata: AgentMetadata):</span>
<span id="cb25-16">        <span class="bu" style="color: null;
background-color: null;
font-style: inherit;">super</span>().<span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">__init__</span>(metadata)</span>
<span id="cb25-17">        </span>
<span id="cb25-18">        <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># Agent 전용 LLM 클라이언트</span></span>
<span id="cb25-19">        <span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">self</span>.llm <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> LLMClient(</span>
<span id="cb25-20">            provider<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"openai"</span>,</span>
<span id="cb25-21">            model<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"gpt-4"</span>,</span>
<span id="cb25-22">            cache_enabled<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span><span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">True</span></span>
<span id="cb25-23">        )</span>
<span id="cb25-24">    </span>
<span id="cb25-25">    <span class="kw" style="color: #003B4F;
background-color: null;
font-style: inherit;">def</span> process(<span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">self</span>, <span class="bu" style="color: null;
background-color: null;
font-style: inherit;">input</span>: Dict[<span class="bu" style="color: null;
background-color: null;
font-style: inherit;">str</span>, Any]) <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">-&gt;</span> Dict[<span class="bu" style="color: null;
background-color: null;
font-style: inherit;">str</span>, Any]:</span>
<span id="cb25-26">        <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">"""스키마 표준화"""</span></span>
<span id="cb25-27">        schema <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> <span class="bu" style="color: null;
background-color: null;
font-style: inherit;">input</span>[<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">'data'</span>]</span>
<span id="cb25-28">        </span>
<span id="cb25-29">        <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># LLM 프롬프트 생성</span></span>
<span id="cb25-30">        prompt <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> <span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">self</span>._build_prompt(schema)</span>
<span id="cb25-31">        </span>
<span id="cb25-32">        <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># LLM 호출</span></span>
<span id="cb25-33">        standardized <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> <span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">self</span>.llm.generate(</span>
<span id="cb25-34">            prompt<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span>prompt,</span>
<span id="cb25-35">            temperature<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span><span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">0.0</span>  <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># 결정론적 출력</span></span>
<span id="cb25-36">        )</span>
<span id="cb25-37">        </span>
<span id="cb25-38">        <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># 결과 파싱</span></span>
<span id="cb25-39">        result <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> <span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">self</span>._parse_result(standardized)</span>
<span id="cb25-40">        </span>
<span id="cb25-41">        <span class="cf" style="color: #003B4F;
background-color: null;
font-style: inherit;">return</span> {</span>
<span id="cb25-42">            <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">'result'</span>: result,</span>
<span id="cb25-43">            <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">'confidence'</span>: <span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">self</span>._calculate_confidence(result)</span>
<span id="cb25-44">        }</span>
<span id="cb25-45">    </span>
<span id="cb25-46">    <span class="kw" style="color: #003B4F;
background-color: null;
font-style: inherit;">def</span> _build_prompt(<span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">self</span>, schema: Dict) <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">-&gt;</span> <span class="bu" style="color: null;
background-color: null;
font-style: inherit;">str</span>:</span>
<span id="cb25-47">        <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">"""프롬프트 생성"""</span></span>
<span id="cb25-48">        <span class="cf" style="color: #003B4F;
background-color: null;
font-style: inherit;">return</span> <span class="ss" style="color: #20794D;
background-color: null;
font-style: inherit;">f"""다음 스키마를 표준화하세요:</span></span>
<span id="cb25-49"></span>
<span id="cb25-50"><span class="ss" style="color: #20794D;
background-color: null;
font-style: inherit;">입력 스키마:</span></span>
<span id="cb25-51"><span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">{</span>schema<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">}</span></span>
<span id="cb25-52"></span>
<span id="cb25-53"><span class="ss" style="color: #20794D;
background-color: null;
font-style: inherit;">규칙:</span></span>
<span id="cb25-54"><span class="ss" style="color: #20794D;
background-color: null;
font-style: inherit;">1. 필드명을 영문 snake_case로 변환</span></span>
<span id="cb25-55"><span class="ss" style="color: #20794D;
background-color: null;
font-style: inherit;">2. 데이터 타입을 명시 (string, int, float, date 등)</span></span>
<span id="cb25-56"><span class="ss" style="color: #20794D;
background-color: null;
font-style: inherit;">3. 설명 추가</span></span>
<span id="cb25-57"></span>
<span id="cb25-58"><span class="ss" style="color: #20794D;
background-color: null;
font-style: inherit;">출력 형식 (JSON):</span></span>
<span id="cb25-59"><span class="ch" style="color: #20794D;
background-color: null;
font-style: inherit;">{{</span></span>
<span id="cb25-60"><span class="ss" style="color: #20794D;
background-color: null;
font-style: inherit;">    "fields": [</span></span>
<span id="cb25-61"><span class="ss" style="color: #20794D;
background-color: null;
font-style: inherit;">        </span><span class="ch" style="color: #20794D;
background-color: null;
font-style: inherit;">{{</span><span class="ss" style="color: #20794D;
background-color: null;
font-style: inherit;">"name": "field_name", "type": "string", "description": "..."</span><span class="ch" style="color: #20794D;
background-color: null;
font-style: inherit;">}}</span></span>
<span id="cb25-62"><span class="ss" style="color: #20794D;
background-color: null;
font-style: inherit;">    ]</span></span>
<span id="cb25-63"><span class="ch" style="color: #20794D;
background-color: null;
font-style: inherit;">}}</span><span class="ss" style="color: #20794D;
background-color: null;
font-style: inherit;">"""</span></span>
<span id="cb25-64">    </span>
<span id="cb25-65">    <span class="kw" style="color: #003B4F;
background-color: null;
font-style: inherit;">def</span> _parse_result(<span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">self</span>, llm_output: <span class="bu" style="color: null;
background-color: null;
font-style: inherit;">str</span>) <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">-&gt;</span> Dict:</span>
<span id="cb25-66">        <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">"""LLM 출력 파싱"""</span></span>
<span id="cb25-67">        <span class="im" style="color: #00769E;
background-color: null;
font-style: inherit;">import</span> json</span>
<span id="cb25-68">        <span class="cf" style="color: #003B4F;
background-color: null;
font-style: inherit;">return</span> json.loads(llm_output)</span>
<span id="cb25-69">    </span>
<span id="cb25-70">    <span class="kw" style="color: #003B4F;
background-color: null;
font-style: inherit;">def</span> _calculate_confidence(<span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">self</span>, result: Dict) <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">-&gt;</span> <span class="bu" style="color: null;
background-color: null;
font-style: inherit;">float</span>:</span>
<span id="cb25-71">        <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">"""신뢰도 계산"""</span></span>
<span id="cb25-72">        <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># 필드 개수, 타입 명시 여부 등으로 계산</span></span>
<span id="cb25-73">        <span class="cf" style="color: #003B4F;
background-color: null;
font-style: inherit;">if</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">'fields'</span> <span class="kw" style="color: #003B4F;
background-color: null;
font-style: inherit;">not</span> <span class="kw" style="color: #003B4F;
background-color: null;
font-style: inherit;">in</span> result:</span>
<span id="cb25-74">            <span class="cf" style="color: #003B4F;
background-color: null;
font-style: inherit;">return</span> <span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">0.0</span></span>
<span id="cb25-75">        </span>
<span id="cb25-76">        fields <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> result[<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">'fields'</span>]</span>
<span id="cb25-77">        <span class="cf" style="color: #003B4F;
background-color: null;
font-style: inherit;">if</span> <span class="bu" style="color: null;
background-color: null;
font-style: inherit;">len</span>(fields) <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">==</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">0</span>:</span>
<span id="cb25-78">            <span class="cf" style="color: #003B4F;
background-color: null;
font-style: inherit;">return</span> <span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">0.0</span></span>
<span id="cb25-79">        </span>
<span id="cb25-80">        <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># 모든 필드가 type과 description을 가지면 신뢰도 1.0</span></span>
<span id="cb25-81">        complete_fields <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> <span class="bu" style="color: null;
background-color: null;
font-style: inherit;">sum</span>(</span>
<span id="cb25-82">            <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span> <span class="cf" style="color: #003B4F;
background-color: null;
font-style: inherit;">for</span> f <span class="kw" style="color: #003B4F;
background-color: null;
font-style: inherit;">in</span> fields</span>
<span id="cb25-83">            <span class="cf" style="color: #003B4F;
background-color: null;
font-style: inherit;">if</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">'type'</span> <span class="kw" style="color: #003B4F;
background-color: null;
font-style: inherit;">in</span> f <span class="kw" style="color: #003B4F;
background-color: null;
font-style: inherit;">and</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">'description'</span> <span class="kw" style="color: #003B4F;
background-color: null;
font-style: inherit;">in</span> f</span>
<span id="cb25-84">        )</span>
<span id="cb25-85">        </span>
<span id="cb25-86">        <span class="cf" style="color: #003B4F;
background-color: null;
font-style: inherit;">return</span> complete_fields <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">/</span> <span class="bu" style="color: null;
background-color: null;
font-style: inherit;">len</span>(fields)</span>
<span id="cb25-87">    </span>
<span id="cb25-88">    <span class="kw" style="color: #003B4F;
background-color: null;
font-style: inherit;">def</span> evaluate(<span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">self</span>, ground_truth: Dict, prediction: Dict) <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">-&gt;</span> <span class="bu" style="color: null;
background-color: null;
font-style: inherit;">float</span>:</span>
<span id="cb25-89">        <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">"""스키마 매칭 정확도"""</span></span>
<span id="cb25-90">        truth_fields <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> {f[<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">'name'</span>] <span class="cf" style="color: #003B4F;
background-color: null;
font-style: inherit;">for</span> f <span class="kw" style="color: #003B4F;
background-color: null;
font-style: inherit;">in</span> ground_truth[<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">'fields'</span>]}</span>
<span id="cb25-91">        pred_fields <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> {f[<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">'name'</span>] <span class="cf" style="color: #003B4F;
background-color: null;
font-style: inherit;">for</span> f <span class="kw" style="color: #003B4F;
background-color: null;
font-style: inherit;">in</span> prediction[<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">'fields'</span>]}</span>
<span id="cb25-92">        </span>
<span id="cb25-93">        <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># Jaccard similarity</span></span>
<span id="cb25-94">        intersection <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> <span class="bu" style="color: null;
background-color: null;
font-style: inherit;">len</span>(truth_fields <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">&amp;</span> pred_fields)</span>
<span id="cb25-95">        union <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> <span class="bu" style="color: null;
background-color: null;
font-style: inherit;">len</span>(truth_fields <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">|</span> pred_fields)</span>
<span id="cb25-96">        </span>
<span id="cb25-97">        <span class="cf" style="color: #003B4F;
background-color: null;
font-style: inherit;">return</span> intersection <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">/</span> union <span class="cf" style="color: #003B4F;
background-color: null;
font-style: inherit;">if</span> union <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">&gt;</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">0</span> <span class="cf" style="color: #003B4F;
background-color: null;
font-style: inherit;">else</span> <span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">0.0</span></span>
<span id="cb25-98">    </span>
<span id="cb25-99">    <span class="kw" style="color: #003B4F;
background-color: null;
font-style: inherit;">def</span> _pre_process(<span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">self</span>, <span class="bu" style="color: null;
background-color: null;
font-style: inherit;">input</span>: Dict[<span class="bu" style="color: null;
background-color: null;
font-style: inherit;">str</span>, Any]) <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">-&gt;</span> Dict[<span class="bu" style="color: null;
background-color: null;
font-style: inherit;">str</span>, Any]:</span>
<span id="cb25-100">        <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">"""전처리: 입력 정규화"""</span></span>
<span id="cb25-101">        <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># 스키마를 소문자로 변환</span></span>
<span id="cb25-102">        <span class="cf" style="color: #003B4F;
background-color: null;
font-style: inherit;">if</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">'data'</span> <span class="kw" style="color: #003B4F;
background-color: null;
font-style: inherit;">in</span> <span class="bu" style="color: null;
background-color: null;
font-style: inherit;">input</span> <span class="kw" style="color: #003B4F;
background-color: null;
font-style: inherit;">and</span> <span class="bu" style="color: null;
background-color: null;
font-style: inherit;">isinstance</span>(<span class="bu" style="color: null;
background-color: null;
font-style: inherit;">input</span>[<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">'data'</span>], <span class="bu" style="color: null;
background-color: null;
font-style: inherit;">dict</span>):</span>
<span id="cb25-103">            normalized <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> {</span>
<span id="cb25-104">                k.lower(): v</span>
<span id="cb25-105">                <span class="cf" style="color: #003B4F;
background-color: null;
font-style: inherit;">for</span> k, v <span class="kw" style="color: #003B4F;
background-color: null;
font-style: inherit;">in</span> <span class="bu" style="color: null;
background-color: null;
font-style: inherit;">input</span>[<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">'data'</span>].items()</span>
<span id="cb25-106">            }</span>
<span id="cb25-107">            <span class="bu" style="color: null;
background-color: null;
font-style: inherit;">input</span>[<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">'data'</span>] <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> normalized</span>
<span id="cb25-108">        </span>
<span id="cb25-109">        <span class="cf" style="color: #003B4F;
background-color: null;
font-style: inherit;">return</span> <span class="bu" style="color: null;
background-color: null;
font-style: inherit;">input</span></span></code></pre></div>
</section>
<section id="agent-등록" class="level2" data-number="5.2">
<h2 data-number="5.2" class="anchored" data-anchor-id="agent-등록"><span class="header-section-number">5.2</span> Agent 등록</h2>
<div class="sourceCode" id="cb26" style="background: #f1f3f5;"><pre class="sourceCode numberSource python number-lines code-with-copy"><code class="sourceCode python"><span id="cb26-1"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># agents/data_standardization/__init__.py</span></span>
<span id="cb26-2"><span class="im" style="color: #00769E;
background-color: null;
font-style: inherit;">from</span> core.registry <span class="im" style="color: #00769E;
background-color: null;
font-style: inherit;">import</span> AgentRegistry</span>
<span id="cb26-3"><span class="im" style="color: #00769E;
background-color: null;
font-style: inherit;">from</span> core.base_agent <span class="im" style="color: #00769E;
background-color: null;
font-style: inherit;">import</span> AgentMetadata</span>
<span id="cb26-4"><span class="im" style="color: #00769E;
background-color: null;
font-style: inherit;">from</span> .agent <span class="im" style="color: #00769E;
background-color: null;
font-style: inherit;">import</span> DataStandardizationAgent</span>
<span id="cb26-5"></span>
<span id="cb26-6"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># 메타데이터 정의</span></span>
<span id="cb26-7">metadata <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> AgentMetadata(</span>
<span id="cb26-8">    name<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"data_standardization"</span>,</span>
<span id="cb26-9">    version<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"1.0.0"</span>,</span>
<span id="cb26-10">    domain<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"data"</span>,</span>
<span id="cb26-11">    description<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"데이터 스키마 표준화 Agent"</span>,</span>
<span id="cb26-12">    author<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Platform Team"</span>,</span>
<span id="cb26-13">    created_at<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"2026-02-02"</span>,</span>
<span id="cb26-14">    tags<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span>[<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"data"</span>, <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"standardization"</span>, <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"schema"</span>]</span>
<span id="cb26-15">)</span>
<span id="cb26-16"></span>
<span id="cb26-17"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># Agent 생성 및 등록</span></span>
<span id="cb26-18">agent <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> DataStandardizationAgent(metadata)</span>
<span id="cb26-19">AgentRegistry.get_instance().register(agent)</span></code></pre></div>
</section>
<section id="사용-예시" class="level2" data-number="5.3">
<h2 data-number="5.3" class="anchored" data-anchor-id="사용-예시"><span class="header-section-number">5.3</span> 사용 예시</h2>
<div class="sourceCode" id="cb27" style="background: #f1f3f5;"><pre class="sourceCode numberSource python number-lines code-with-copy"><code class="sourceCode python"><span id="cb27-1"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># 플랫폼 초기화</span></span>
<span id="cb27-2"><span class="im" style="color: #00769E;
background-color: null;
font-style: inherit;">from</span> core.orchestrator <span class="im" style="color: #00769E;
background-color: null;
font-style: inherit;">import</span> AgentOrchestrator</span>
<span id="cb27-3"><span class="im" style="color: #00769E;
background-color: null;
font-style: inherit;">import</span> agents.data_standardization  <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># Agent 자동 등록</span></span>
<span id="cb27-4"></span>
<span id="cb27-5"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># Orchestrator 생성</span></span>
<span id="cb27-6">orchestrator <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> AgentOrchestrator()</span>
<span id="cb27-7"></span>
<span id="cb27-8"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># Agent 실행</span></span>
<span id="cb27-9">result <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> orchestrator.run(</span>
<span id="cb27-10">    agent_name<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"data_standardization"</span>,</span>
<span id="cb27-11">    input_data<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span>{</span>
<span id="cb27-12">        <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">'task'</span>: <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">'standardization'</span>,</span>
<span id="cb27-13">        <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">'data'</span>: {</span>
<span id="cb27-14">            <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">'환자번호'</span>: <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">'12345'</span>,</span>
<span id="cb27-15">            <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">'진료일자'</span>: <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">'2026-01-15'</span>,</span>
<span id="cb27-16">            <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">'Age'</span>: <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">'45'</span></span>
<span id="cb27-17">        }</span>
<span id="cb27-18">    }</span>
<span id="cb27-19">)</span>
<span id="cb27-20"></span>
<span id="cb27-21"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># 결과</span></span>
<span id="cb27-22">{</span>
<span id="cb27-23">    <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">'result'</span>: {</span>
<span id="cb27-24">        <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">'fields'</span>: [</span>
<span id="cb27-25">            {<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">'name'</span>: <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">'patient_id'</span>, <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">'type'</span>: <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">'string'</span>, <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">'description'</span>: <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">'환자 고유 번호'</span>},</span>
<span id="cb27-26">            {<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">'name'</span>: <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">'visit_date'</span>, <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">'type'</span>: <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">'date'</span>, <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">'description'</span>: <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">'진료 방문 일자'</span>},</span>
<span id="cb27-27">            {<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">'name'</span>: <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">'age'</span>, <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">'type'</span>: <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">'int'</span>, <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">'description'</span>: <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">'환자 나이'</span>}</span>
<span id="cb27-28">        ]</span>
<span id="cb27-29">    },</span>
<span id="cb27-30">    <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">'confidence'</span>: <span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">1.0</span>,</span>
<span id="cb27-31">    <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">'metadata'</span>: {</span>
<span id="cb27-32">        <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">'agent'</span>: <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">'data_standardization'</span>,</span>
<span id="cb27-33">        <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">'version'</span>: <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">'1.0.0'</span>,</span>
<span id="cb27-34">        <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">'execution_time'</span>: <span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">2.3</span>,</span>
<span id="cb27-35">        <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">'timestamp'</span>: <span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">1738485600.0</span></span>
<span id="cb27-36">    }</span>
<span id="cb27-37">}</span>
<span id="cb27-38"></span>
<span id="cb27-39"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># 메트릭 확인</span></span>
<span id="cb27-40">agent <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> orchestrator.registry.get(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"data_standardization"</span>)</span>
<span id="cb27-41">metrics <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> agent.get_metrics()</span>
<span id="cb27-42"><span class="bu" style="color: null;
background-color: null;
font-style: inherit;">print</span>(metrics)</span>
<span id="cb27-43"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># {'name': 'data_standardization', 'executions': 1, 'success_rate': 1.0, 'avg_time': 2.3, 'error_count': 0}</span></span></code></pre></div>
</section>
</section>
<section id="핵심-설계-결정-요약" class="level1" data-number="6">
<h1 data-number="6"><span class="header-section-number">6</span> 핵심 설계 결정 요약</h1>
<section id="baseagent-인터페이스" class="level2" data-number="6.1">
<h2 data-number="6.1" class="anchored" data-anchor-id="baseagent-인터페이스"><span class="header-section-number">6.1</span> BaseAgent 인터페이스</h2>
<ol type="1">
<li><strong>표준 입출력</strong>: Dict[str, Any] (확장성)</li>
<li><strong>Template Method</strong>: execute()는 final, process()만 구현</li>
<li><strong>Hook Methods</strong>: _pre_process(), _post_process() 선택적 커스터마이징</li>
<li><strong>자동 메트릭</strong>: 실행 시간, 성공률, 에러 추적</li>
<li><strong>평가 인터페이스</strong>: evaluate() 구현 필수</li>
</ol>
</section>
<section id="agentregistry" class="level2" data-number="6.2">
<h2 data-number="6.2" class="anchored" data-anchor-id="agentregistry"><span class="header-section-number">6.2</span> AgentRegistry</h2>
<ol type="1">
<li><strong>Singleton 패턴</strong>: 전역 Registry</li>
<li><strong>Dependency Inversion</strong>: Agent가 스스로 등록</li>
<li><strong>Core 독립성</strong>: Core → Agents 의존 없음</li>
</ol>
</section>
<section id="orchestrator" class="level2" data-number="6.3">
<h2 data-number="6.3" class="anchored" data-anchor-id="orchestrator"><span class="header-section-number">6.3</span> Orchestrator</h2>
<ol type="1">
<li><strong>단일 실행</strong>: run()</li>
<li><strong>체이닝</strong>: chain() (순차)</li>
<li><strong>병렬 실행</strong>: parallel()</li>
<li><strong>조건부 실행</strong>: conditional_chain()</li>
</ol>
</section>
<section id="다음-단계" class="level2" data-number="6.4">
<h2 data-number="6.4" class="anchored" data-anchor-id="다음-단계"><span class="header-section-number">6.4</span> 다음 단계</h2>
<p>이 글에서 인터페이스 설계를 완료했다. 다음 글에서는:</p>
<ul>
<li><strong>5번 글</strong>: 데이터 표준화 계층 (프롬프트, 벡터 데이터, 메타데이터 관리)</li>
<li><strong>6번 글</strong>: 플랫폼 운영 (CI/CD, 모니터링, 배포 전략)</li>
</ul>
</section>
<section id="참고문헌" class="level2" data-number="6.5">
<h2 data-number="6.5" class="anchored" data-anchor-id="참고문헌"><span class="header-section-number">6.5</span> 참고문헌</h2>
<p><strong>Design Patterns</strong>: - Gamma, E., et al.&nbsp;(1994). “Design Patterns: Elements of Reusable Object-Oriented Software.” Addison-Wesley. - Freeman, E., &amp; Freeman, E. (2004). “Head First Design Patterns.” O’Reilly.</p>
<p><strong>Software Architecture</strong>: - Martin, R. C. (2017). “Clean Architecture.” Prentice Hall. - Evans, E. (2003). “Domain-Driven Design.” Addison-Wesley.</p>
<p><strong>Python Best Practices</strong>: - Ramalho, L. (2021). “Fluent Python.” O’Reilly. - Martin, R. C. (2008). “Clean Code.” Prentice Hall.</p>
<p><strong>역할</strong>: Agent 생명주기 관리, 표준 인터페이스 정의</p>
<div class="sourceCode" id="cb28" style="background: #f1f3f5;"><pre class="sourceCode numberSource python number-lines code-with-copy"><code class="sourceCode python"><span id="cb28-1">core<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">/</span></span>
<span id="cb28-2">├── agent<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">/</span></span>
<span id="cb28-3">│   ├── base_agent.py          <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># BaseAgent 추상 클래스</span></span>
<span id="cb28-4">│   ├── lifecycle.py           <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># Agent 초기화, 종료</span></span>
<span id="cb28-5">│   └── registry.py            <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># Agent 등록 및 조회</span></span>
<span id="cb28-6">├── orchestrator.py            <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># Agent 실행 관리</span></span>
<span id="cb28-7">├── monitoring.py              <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># 메트릭 수집</span></span>
<span id="cb28-8">└── evaluation.py              <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># 공통 평가 프레임워크</span></span></code></pre></div>
<section id="baseagent-설계-2번-글-확장" class="level3" data-number="6.5.1">
<h3 data-number="6.5.1" class="anchored" data-anchor-id="baseagent-설계-2번-글-확장"><span class="header-section-number">6.5.1</span> BaseAgent 설계 (2번 글 확장)</h3>
<p>2번 글에서 제시한 BaseAgent를 더 구체화한다:</p>
<div class="sourceCode" id="cb29" style="background: #f1f3f5;"><pre class="sourceCode numberSource python number-lines code-with-copy"><code class="sourceCode python"><span id="cb29-1"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># core/agent/base_agent.py</span></span>
<span id="cb29-2"><span class="im" style="color: #00769E;
background-color: null;
font-style: inherit;">from</span> abc <span class="im" style="color: #00769E;
background-color: null;
font-style: inherit;">import</span> ABC, abstractmethod</span>
<span id="cb29-3"><span class="im" style="color: #00769E;
background-color: null;
font-style: inherit;">from</span> typing <span class="im" style="color: #00769E;
background-color: null;
font-style: inherit;">import</span> Dict, Any, Optional</span>
<span id="cb29-4"><span class="im" style="color: #00769E;
background-color: null;
font-style: inherit;">import</span> time</span>
<span id="cb29-5"><span class="im" style="color: #00769E;
background-color: null;
font-style: inherit;">from</span> dataclasses <span class="im" style="color: #00769E;
background-color: null;
font-style: inherit;">import</span> dataclass</span>
<span id="cb29-6"></span>
<span id="cb29-7"><span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">@dataclass</span></span>
<span id="cb29-8"><span class="kw" style="color: #003B4F;
background-color: null;
font-style: inherit;">class</span> AgentMetadata:</span>
<span id="cb29-9">    <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">"""Agent 메타데이터"""</span></span>
<span id="cb29-10">    name: <span class="bu" style="color: null;
background-color: null;
font-style: inherit;">str</span></span>
<span id="cb29-11">    version: <span class="bu" style="color: null;
background-color: null;
font-style: inherit;">str</span></span>
<span id="cb29-12">    domain: <span class="bu" style="color: null;
background-color: null;
font-style: inherit;">str</span></span>
<span id="cb29-13">    description: <span class="bu" style="color: null;
background-color: null;
font-style: inherit;">str</span></span>
<span id="cb29-14">    author: <span class="bu" style="color: null;
background-color: null;
font-style: inherit;">str</span></span>
<span id="cb29-15">    created_at: <span class="bu" style="color: null;
background-color: null;
font-style: inherit;">str</span></span>
<span id="cb29-16"></span>
<span id="cb29-17"><span class="kw" style="color: #003B4F;
background-color: null;
font-style: inherit;">class</span> BaseAgent(ABC):</span>
<span id="cb29-18">    <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">"""모든 Agent가 상속해야 하는 기본 클래스</span></span>
<span id="cb29-19"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">    </span></span>
<span id="cb29-20"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">    설계 원칙:</span></span>
<span id="cb29-21"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">    1. 표준 입출력: Dict[str, Any] (확장성)</span></span>
<span id="cb29-22"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">    2. Template Method Pattern: execute()는 final</span></span>
<span id="cb29-23"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">    3. Hook Methods: _pre_process, _post_process</span></span>
<span id="cb29-24"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">    """</span></span>
<span id="cb29-25">    </span>
<span id="cb29-26">    <span class="kw" style="color: #003B4F;
background-color: null;
font-style: inherit;">def</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">__init__</span>(<span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">self</span>, metadata: AgentMetadata):</span>
<span id="cb29-27">        <span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">self</span>.metadata <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> metadata</span>
<span id="cb29-28">        <span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">self</span>.execution_count <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">0</span></span>
<span id="cb29-29">        <span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">self</span>.total_time <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> <span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">0.0</span></span>
<span id="cb29-30">        <span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">self</span>.errors <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> []</span>
<span id="cb29-31">    </span>
<span id="cb29-32">    <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">@abstractmethod</span></span>
<span id="cb29-33">    <span class="kw" style="color: #003B4F;
background-color: null;
font-style: inherit;">def</span> process(<span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">self</span>, <span class="bu" style="color: null;
background-color: null;
font-style: inherit;">input</span>: Dict[<span class="bu" style="color: null;
background-color: null;
font-style: inherit;">str</span>, Any]) <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">-&gt;</span> Dict[<span class="bu" style="color: null;
background-color: null;
font-style: inherit;">str</span>, Any]:</span>
<span id="cb29-34">        <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">"""핵심 비즈니스 로직</span></span>
<span id="cb29-35"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">        </span></span>
<span id="cb29-36"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">        Args:</span></span>
<span id="cb29-37"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">            input: 표준화된 입력 딕셔너리</span></span>
<span id="cb29-38"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">                - 'task': 작업 유형</span></span>
<span id="cb29-39"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">                - 'data': 실제 데이터</span></span>
<span id="cb29-40"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">                - 'config': 실행 옵션</span></span>
<span id="cb29-41"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">        </span></span>
<span id="cb29-42"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">        Returns:</span></span>
<span id="cb29-43"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">            출력 딕셔너리</span></span>
<span id="cb29-44"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">                - 'result': 실행 결과</span></span>
<span id="cb29-45"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">                - 'metadata': 실행 정보</span></span>
<span id="cb29-46"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">                - 'confidence': 신뢰도 (0-1)</span></span>
<span id="cb29-47"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">        """</span></span>
<span id="cb29-48">        <span class="cf" style="color: #003B4F;
background-color: null;
font-style: inherit;">pass</span></span>
<span id="cb29-49">    </span>
<span id="cb29-50">    <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">@abstractmethod</span></span>
<span id="cb29-51">    <span class="kw" style="color: #003B4F;
background-color: null;
font-style: inherit;">def</span> evaluate(<span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">self</span>, ground_truth: Any, prediction: Any) <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">-&gt;</span> <span class="bu" style="color: null;
background-color: null;
font-style: inherit;">float</span>:</span>
<span id="cb29-52">        <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">"""성능 평가</span></span>
<span id="cb29-53"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">        </span></span>
<span id="cb29-54"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">        각 Agent는 도메인에 맞는 평가 메트릭 구현</span></span>
<span id="cb29-55"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">        예: 데이터 표준화 - 스키마 매칭 정확도</span></span>
<span id="cb29-56"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">            코드 분석 - AST 파싱 성공률</span></span>
<span id="cb29-57"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">        """</span></span>
<span id="cb29-58">        <span class="cf" style="color: #003B4F;
background-color: null;
font-style: inherit;">pass</span></span>
<span id="cb29-59">    </span>
<span id="cb29-60">    <span class="kw" style="color: #003B4F;
background-color: null;
font-style: inherit;">def</span> execute(<span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">self</span>, <span class="bu" style="color: null;
background-color: null;
font-style: inherit;">input</span>: Dict[<span class="bu" style="color: null;
background-color: null;
font-style: inherit;">str</span>, Any]) <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">-&gt;</span> Dict[<span class="bu" style="color: null;
background-color: null;
font-style: inherit;">str</span>, Any]:</span>
<span id="cb29-61">        <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">"""Agent 실행 (Template Method - 수정 불가)</span></span>
<span id="cb29-62"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">        </span></span>
<span id="cb29-63"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">        실행 흐름:</span></span>
<span id="cb29-64"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">        1. 입력 검증</span></span>
<span id="cb29-65"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">        2. 전처리 (hook)</span></span>
<span id="cb29-66"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">        3. 실제 process() 호출</span></span>
<span id="cb29-67"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">        4. 후처리 (hook)</span></span>
<span id="cb29-68"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">        5. 메트릭 수집</span></span>
<span id="cb29-69"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">        """</span></span>
<span id="cb29-70">        <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># 1. 입력 검증</span></span>
<span id="cb29-71">        <span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">self</span>._validate_input(<span class="bu" style="color: null;
background-color: null;
font-style: inherit;">input</span>)</span>
<span id="cb29-72">        </span>
<span id="cb29-73">        <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># 2. 전처리 (선택적 override)</span></span>
<span id="cb29-74">        <span class="bu" style="color: null;
background-color: null;
font-style: inherit;">input</span> <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> <span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">self</span>._pre_process(<span class="bu" style="color: null;
background-color: null;
font-style: inherit;">input</span>)</span>
<span id="cb29-75">        </span>
<span id="cb29-76">        <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># 3. 실행 시간 측정</span></span>
<span id="cb29-77">        start_time <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> time.time()</span>
<span id="cb29-78">        </span>
<span id="cb29-79">        <span class="cf" style="color: #003B4F;
background-color: null;
font-style: inherit;">try</span>:</span>
<span id="cb29-80">            <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># 4. 핵심 로직 실행</span></span>
<span id="cb29-81">            result <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> <span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">self</span>.process(<span class="bu" style="color: null;
background-color: null;
font-style: inherit;">input</span>)</span>
<span id="cb29-82">            </span>
<span id="cb29-83">            <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># 5. 후처리</span></span>
<span id="cb29-84">            result <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> <span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">self</span>._post_process(result)</span>
<span id="cb29-85">            </span>
<span id="cb29-86">            <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># 6. 성공 메트릭</span></span>
<span id="cb29-87">            elapsed <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> time.time() <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">-</span> start_time</span>
<span id="cb29-88">            <span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">self</span>.execution_count <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+=</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span></span>
<span id="cb29-89">            <span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">self</span>.total_time <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+=</span> elapsed</span>
<span id="cb29-90">            </span>
<span id="cb29-91">            <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># 7. 메타데이터 추가</span></span>
<span id="cb29-92">            result[<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">'metadata'</span>] <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> {</span>
<span id="cb29-93">                <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">'agent'</span>: <span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">self</span>.metadata.name,</span>
<span id="cb29-94">                <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">'version'</span>: <span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">self</span>.metadata.version,</span>
<span id="cb29-95">                <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">'execution_time'</span>: elapsed,</span>
<span id="cb29-96">                <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">'timestamp'</span>: time.time()</span>
<span id="cb29-97">            }</span>
<span id="cb29-98">            </span>
<span id="cb29-99">            <span class="cf" style="color: #003B4F;
background-color: null;
font-style: inherit;">return</span> result</span>
<span id="cb29-100">            </span>
<span id="cb29-101">        <span class="cf" style="color: #003B4F;
background-color: null;
font-style: inherit;">except</span> <span class="pp" style="color: #AD0000;
background-color: null;
font-style: inherit;">Exception</span> <span class="im" style="color: #00769E;
background-color: null;
font-style: inherit;">as</span> e:</span>
<span id="cb29-102">            <span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">self</span>.errors.append(<span class="bu" style="color: null;
background-color: null;
font-style: inherit;">str</span>(e))</span>
<span id="cb29-103">            <span class="cf" style="color: #003B4F;
background-color: null;
font-style: inherit;">raise</span></span>
<span id="cb29-104">    </span>
<span id="cb29-105">    <span class="kw" style="color: #003B4F;
background-color: null;
font-style: inherit;">def</span> _validate_input(<span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">self</span>, <span class="bu" style="color: null;
background-color: null;
font-style: inherit;">input</span>: Dict[<span class="bu" style="color: null;
background-color: null;
font-style: inherit;">str</span>, Any]):</span>
<span id="cb29-106">        <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">"""입력 검증 (공통 규칙)"""</span></span>
<span id="cb29-107">        <span class="cf" style="color: #003B4F;
background-color: null;
font-style: inherit;">if</span> <span class="kw" style="color: #003B4F;
background-color: null;
font-style: inherit;">not</span> <span class="bu" style="color: null;
background-color: null;
font-style: inherit;">isinstance</span>(<span class="bu" style="color: null;
background-color: null;
font-style: inherit;">input</span>, <span class="bu" style="color: null;
background-color: null;
font-style: inherit;">dict</span>):</span>
<span id="cb29-108">            <span class="cf" style="color: #003B4F;
background-color: null;
font-style: inherit;">raise</span> <span class="pp" style="color: #AD0000;
background-color: null;
font-style: inherit;">ValueError</span>(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Input must be a dictionary"</span>)</span>
<span id="cb29-109">        <span class="cf" style="color: #003B4F;
background-color: null;
font-style: inherit;">if</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">'task'</span> <span class="kw" style="color: #003B4F;
background-color: null;
font-style: inherit;">not</span> <span class="kw" style="color: #003B4F;
background-color: null;
font-style: inherit;">in</span> <span class="bu" style="color: null;
background-color: null;
font-style: inherit;">input</span>:</span>
<span id="cb29-110">            <span class="cf" style="color: #003B4F;
background-color: null;
font-style: inherit;">raise</span> <span class="pp" style="color: #AD0000;
background-color: null;
font-style: inherit;">ValueError</span>(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Input must contain 'task' field"</span>)</span>
<span id="cb29-111">    </span>
<span id="cb29-112">    <span class="kw" style="color: #003B4F;
background-color: null;
font-style: inherit;">def</span> _pre_process(<span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">self</span>, <span class="bu" style="color: null;
background-color: null;
font-style: inherit;">input</span>: Dict[<span class="bu" style="color: null;
background-color: null;
font-style: inherit;">str</span>, Any]) <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">-&gt;</span> Dict[<span class="bu" style="color: null;
background-color: null;
font-style: inherit;">str</span>, Any]:</span>
<span id="cb29-113">        <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">"""전처리 hook (선택적 override)"""</span></span>
<span id="cb29-114">        <span class="cf" style="color: #003B4F;
background-color: null;
font-style: inherit;">return</span> <span class="bu" style="color: null;
background-color: null;
font-style: inherit;">input</span></span>
<span id="cb29-115">    </span>
<span id="cb29-116">    <span class="kw" style="color: #003B4F;
background-color: null;
font-style: inherit;">def</span> _post_process(<span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">self</span>, output: Dict[<span class="bu" style="color: null;
background-color: null;
font-style: inherit;">str</span>, Any]) <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">-&gt;</span> Dict[<span class="bu" style="color: null;
background-color: null;
font-style: inherit;">str</span>, Any]:</span>
<span id="cb29-117">        <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">"""후처리 hook (선택적 override)"""</span></span>
<span id="cb29-118">        <span class="cf" style="color: #003B4F;
background-color: null;
font-style: inherit;">return</span> output</span>
<span id="cb29-119">    </span>
<span id="cb29-120">    <span class="kw" style="color: #003B4F;
background-color: null;
font-style: inherit;">def</span> get_metrics(<span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">self</span>) <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">-&gt;</span> Dict[<span class="bu" style="color: null;
background-color: null;
font-style: inherit;">str</span>, Any]:</span>
<span id="cb29-121">        <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">"""Agent 성능 메트릭"""</span></span>
<span id="cb29-122">        <span class="cf" style="color: #003B4F;
background-color: null;
font-style: inherit;">return</span> {</span>
<span id="cb29-123">            <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">'name'</span>: <span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">self</span>.metadata.name,</span>
<span id="cb29-124">            <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">'executions'</span>: <span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">self</span>.execution_count,</span>
<span id="cb29-125">            <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">'avg_time'</span>: <span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">self</span>.total_time <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">/</span> <span class="bu" style="color: null;
background-color: null;
font-style: inherit;">max</span>(<span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">self</span>.execution_count, <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span>),</span>
<span id="cb29-126">            <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">'error_rate'</span>: <span class="bu" style="color: null;
background-color: null;
font-style: inherit;">len</span>(<span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">self</span>.errors) <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">/</span> <span class="bu" style="color: null;
background-color: null;
font-style: inherit;">max</span>(<span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">self</span>.execution_count, <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span>)</span>
<span id="cb29-127">        }</span></code></pre></div>
</section>
<section id="agent-registry-dependency-inversion-구현" class="level3" data-number="6.5.2">
<h3 data-number="6.5.2" class="anchored" data-anchor-id="agent-registry-dependency-inversion-구현"><span class="header-section-number">6.5.2</span> Agent Registry (Dependency Inversion 구현)</h3>
<div class="sourceCode" id="cb30" style="background: #f1f3f5;"><pre class="sourceCode numberSource python number-lines code-with-copy"><code class="sourceCode python"><span id="cb30-1"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># core/agent/registry.py</span></span>
<span id="cb30-2"><span class="im" style="color: #00769E;
background-color: null;
font-style: inherit;">from</span> typing <span class="im" style="color: #00769E;
background-color: null;
font-style: inherit;">import</span> Dict, Type</span>
<span id="cb30-3"><span class="im" style="color: #00769E;
background-color: null;
font-style: inherit;">from</span> .base_agent <span class="im" style="color: #00769E;
background-color: null;
font-style: inherit;">import</span> BaseAgent</span>
<span id="cb30-4"></span>
<span id="cb30-5"><span class="kw" style="color: #003B4F;
background-color: null;
font-style: inherit;">class</span> AgentRegistry:</span>
<span id="cb30-6">    <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">"""Agent 등록 및 조회</span></span>
<span id="cb30-7"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">    </span></span>
<span id="cb30-8"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">    Dependency Inversion 구현:</span></span>
<span id="cb30-9"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">    - Core는 구체적인 Agent를 모름</span></span>
<span id="cb30-10"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">    - Agent가 스스로 Registry에 등록</span></span>
<span id="cb30-11"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">    """</span></span>
<span id="cb30-12">    </span>
<span id="cb30-13">    _instance <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> <span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">None</span></span>
<span id="cb30-14">    _agents: Dict[<span class="bu" style="color: null;
background-color: null;
font-style: inherit;">str</span>, BaseAgent] <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> {}</span>
<span id="cb30-15">    </span>
<span id="cb30-16">    <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">@classmethod</span></span>
<span id="cb30-17">    <span class="kw" style="color: #003B4F;
background-color: null;
font-style: inherit;">def</span> get_instance(cls):</span>
<span id="cb30-18">        <span class="cf" style="color: #003B4F;
background-color: null;
font-style: inherit;">if</span> cls._instance <span class="kw" style="color: #003B4F;
background-color: null;
font-style: inherit;">is</span> <span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">None</span>:</span>
<span id="cb30-19">            cls._instance <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> cls()</span>
<span id="cb30-20">        <span class="cf" style="color: #003B4F;
background-color: null;
font-style: inherit;">return</span> cls._instance</span>
<span id="cb30-21">    </span>
<span id="cb30-22">    <span class="kw" style="color: #003B4F;
background-color: null;
font-style: inherit;">def</span> register(<span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">self</span>, agent: BaseAgent):</span>
<span id="cb30-23">        <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">"""Agent 등록"""</span></span>
<span id="cb30-24">        <span class="cf" style="color: #003B4F;
background-color: null;
font-style: inherit;">if</span> agent.metadata.name <span class="kw" style="color: #003B4F;
background-color: null;
font-style: inherit;">in</span> <span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">self</span>._agents:</span>
<span id="cb30-25">            <span class="cf" style="color: #003B4F;
background-color: null;
font-style: inherit;">raise</span> <span class="pp" style="color: #AD0000;
background-color: null;
font-style: inherit;">ValueError</span>(<span class="ss" style="color: #20794D;
background-color: null;
font-style: inherit;">f"Agent </span><span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">{</span>agent<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">.</span>metadata<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">.</span>name<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">}</span><span class="ss" style="color: #20794D;
background-color: null;
font-style: inherit;"> already registered"</span>)</span>
<span id="cb30-26">        </span>
<span id="cb30-27">        <span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">self</span>._agents[agent.metadata.name] <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> agent</span>
<span id="cb30-28">        <span class="bu" style="color: null;
background-color: null;
font-style: inherit;">print</span>(<span class="ss" style="color: #20794D;
background-color: null;
font-style: inherit;">f"✓ Registered: </span><span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">{</span>agent<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">.</span>metadata<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">.</span>name<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">}</span><span class="ss" style="color: #20794D;
background-color: null;
font-style: inherit;"> v</span><span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">{</span>agent<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">.</span>metadata<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">.</span>version<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">}</span><span class="ss" style="color: #20794D;
background-color: null;
font-style: inherit;">"</span>)</span>
<span id="cb30-29">    </span>
<span id="cb30-30">    <span class="kw" style="color: #003B4F;
background-color: null;
font-style: inherit;">def</span> get(<span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">self</span>, name: <span class="bu" style="color: null;
background-color: null;
font-style: inherit;">str</span>) <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">-&gt;</span> BaseAgent:</span>
<span id="cb30-31">        <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">"""Agent 조회"""</span></span>
<span id="cb30-32">        <span class="cf" style="color: #003B4F;
background-color: null;
font-style: inherit;">if</span> name <span class="kw" style="color: #003B4F;
background-color: null;
font-style: inherit;">not</span> <span class="kw" style="color: #003B4F;
background-color: null;
font-style: inherit;">in</span> <span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">self</span>._agents:</span>
<span id="cb30-33">            <span class="cf" style="color: #003B4F;
background-color: null;
font-style: inherit;">raise</span> <span class="pp" style="color: #AD0000;
background-color: null;
font-style: inherit;">ValueError</span>(<span class="ss" style="color: #20794D;
background-color: null;
font-style: inherit;">f"Agent </span><span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">{</span>name<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">}</span><span class="ss" style="color: #20794D;
background-color: null;
font-style: inherit;"> not found"</span>)</span>
<span id="cb30-34">        <span class="cf" style="color: #003B4F;
background-color: null;
font-style: inherit;">return</span> <span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">self</span>._agents[name]</span>
<span id="cb30-35">    </span>
<span id="cb30-36">    <span class="kw" style="color: #003B4F;
background-color: null;
font-style: inherit;">def</span> list_all(<span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">self</span>) <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">-&gt;</span> Dict[<span class="bu" style="color: null;
background-color: null;
font-style: inherit;">str</span>, BaseAgent]:</span>
<span id="cb30-37">        <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">"""모든 Agent 목록"""</span></span>
<span id="cb30-38">        <span class="cf" style="color: #003B4F;
background-color: null;
font-style: inherit;">return</span> <span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">self</span>._agents.copy()</span></code></pre></div>
</section>
<section id="orchestrator-agent-실행-관리-1" class="level3" data-number="6.5.3">
<h3 data-number="6.5.3" class="anchored" data-anchor-id="orchestrator-agent-실행-관리-1"><span class="header-section-number">6.5.3</span> Orchestrator (Agent 실행 관리)</h3>
<div class="sourceCode" id="cb31" style="background: #f1f3f5;"><pre class="sourceCode numberSource python number-lines code-with-copy"><code class="sourceCode python"><span id="cb31-1"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># core/orchestrator.py</span></span>
<span id="cb31-2"><span class="im" style="color: #00769E;
background-color: null;
font-style: inherit;">from</span> typing <span class="im" style="color: #00769E;
background-color: null;
font-style: inherit;">import</span> Dict, List, Any</span>
<span id="cb31-3"><span class="im" style="color: #00769E;
background-color: null;
font-style: inherit;">from</span> .agent.registry <span class="im" style="color: #00769E;
background-color: null;
font-style: inherit;">import</span> AgentRegistry</span>
<span id="cb31-4"></span>
<span id="cb31-5"><span class="kw" style="color: #003B4F;
background-color: null;
font-style: inherit;">class</span> AgentOrchestrator:</span>
<span id="cb31-6">    <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">"""Agent 실행 및 조율</span></span>
<span id="cb31-7"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">    </span></span>
<span id="cb31-8"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">    기능:</span></span>
<span id="cb31-9"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">    - Agent 실행</span></span>
<span id="cb31-10"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">    - Agent 체이닝 (순차 실행)</span></span>
<span id="cb31-11"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">    - 병렬 실행 (선택)</span></span>
<span id="cb31-12"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">    """</span></span>
<span id="cb31-13">    </span>
<span id="cb31-14">    <span class="kw" style="color: #003B4F;
background-color: null;
font-style: inherit;">def</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">__init__</span>(<span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">self</span>):</span>
<span id="cb31-15">        <span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">self</span>.registry <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> AgentRegistry.get_instance()</span>
<span id="cb31-16">    </span>
<span id="cb31-17">    <span class="kw" style="color: #003B4F;
background-color: null;
font-style: inherit;">def</span> run(<span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">self</span>, agent_name: <span class="bu" style="color: null;
background-color: null;
font-style: inherit;">str</span>, input_data: Dict[<span class="bu" style="color: null;
background-color: null;
font-style: inherit;">str</span>, Any]) <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">-&gt;</span> Dict[<span class="bu" style="color: null;
background-color: null;
font-style: inherit;">str</span>, Any]:</span>
<span id="cb31-18">        <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">"""단일 Agent 실행"""</span></span>
<span id="cb31-19">        agent <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> <span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">self</span>.registry.get(agent_name)</span>
<span id="cb31-20">        <span class="cf" style="color: #003B4F;
background-color: null;
font-style: inherit;">return</span> agent.execute(input_data)</span>
<span id="cb31-21">    </span>
<span id="cb31-22">    <span class="kw" style="color: #003B4F;
background-color: null;
font-style: inherit;">def</span> chain(<span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">self</span>, agent_names: List[<span class="bu" style="color: null;
background-color: null;
font-style: inherit;">str</span>], input_data: Dict[<span class="bu" style="color: null;
background-color: null;
font-style: inherit;">str</span>, Any]) <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">-&gt;</span> Dict[<span class="bu" style="color: null;
background-color: null;
font-style: inherit;">str</span>, Any]:</span>
<span id="cb31-23">        <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">"""Agent 체이닝 (순차 실행)</span></span>
<span id="cb31-24"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">        </span></span>
<span id="cb31-25"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">        Example:</span></span>
<span id="cb31-26"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">            orchestrator.chain(</span></span>
<span id="cb31-27"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">                ['data_standardization', 'code_analysis', 'knowledge_qna'],</span></span>
<span id="cb31-28"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">                {'task': 'analyze', 'data': schema}</span></span>
<span id="cb31-29"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">            )</span></span>
<span id="cb31-30"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">        """</span></span>
<span id="cb31-31">        result <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> input_data</span>
<span id="cb31-32">        </span>
<span id="cb31-33">        <span class="cf" style="color: #003B4F;
background-color: null;
font-style: inherit;">for</span> agent_name <span class="kw" style="color: #003B4F;
background-color: null;
font-style: inherit;">in</span> agent_names:</span>
<span id="cb31-34">            agent <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> <span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">self</span>.registry.get(agent_name)</span>
<span id="cb31-35">            result <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> agent.execute(result)</span>
<span id="cb31-36">        </span>
<span id="cb31-37">        <span class="cf" style="color: #003B4F;
background-color: null;
font-style: inherit;">return</span> result</span>
<span id="cb31-38">    </span>
<span id="cb31-39">    <span class="kw" style="color: #003B4F;
background-color: null;
font-style: inherit;">def</span> parallel(<span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">self</span>, agent_names: List[<span class="bu" style="color: null;
background-color: null;
font-style: inherit;">str</span>], input_data: Dict[<span class="bu" style="color: null;
background-color: null;
font-style: inherit;">str</span>, Any]) <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">-&gt;</span> List[Dict[<span class="bu" style="color: null;
background-color: null;
font-style: inherit;">str</span>, Any]]:</span>
<span id="cb31-40">        <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">"""병렬 실행 (동일 입력, 여러 Agent)"""</span></span>
<span id="cb31-41">        results <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> []</span>
<span id="cb31-42">        </span>
<span id="cb31-43">        <span class="cf" style="color: #003B4F;
background-color: null;
font-style: inherit;">for</span> agent_name <span class="kw" style="color: #003B4F;
background-color: null;
font-style: inherit;">in</span> agent_names:</span>
<span id="cb31-44">            agent <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> <span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">self</span>.registry.get(agent_name)</span>
<span id="cb31-45">            result <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> agent.execute(input_data)</span>
<span id="cb31-46">            results.append(result)</span>
<span id="cb31-47">        </span>
<span id="cb31-48">        <span class="cf" style="color: #003B4F;
background-color: null;
font-style: inherit;">return</span> results</span></code></pre></div>
</section>
</section>
<section id="shared-모듈-공통-라이브러리" class="level2" data-number="6.6">
<h2 data-number="6.6" class="anchored" data-anchor-id="shared-모듈-공통-라이브러리"><span class="header-section-number">6.6</span> shared/ 모듈: 공통 라이브러리</h2>
<p><strong>역할</strong>: Agent들이 재사용하는 공통 기능</p>
<div class="sourceCode" id="cb32" style="background: #f1f3f5;"><pre class="sourceCode numberSource python number-lines code-with-copy"><code class="sourceCode python"><span id="cb32-1">shared<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">/</span></span>
<span id="cb32-2">├── llm<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">/</span></span>
<span id="cb32-3">│   ├── client.py              <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># LLM 클라이언트 (2번 글의 LLMClient)</span></span>
<span id="cb32-4">│   ├── prompt_engine.py       <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># 프롬프트 템플릿 관리</span></span>
<span id="cb32-5">│   └── context_manager.py     <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># 컨텍스트 윈도우 관리</span></span>
<span id="cb32-6">├── validation<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">/</span></span>
<span id="cb32-7">│   ├── json_parser.py         <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># JSON 파싱 및 검증</span></span>
<span id="cb32-8">│   └── schema_validator.py    <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># 스키마 검증</span></span>
<span id="cb32-9">├── logging<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">/</span></span>
<span id="cb32-10">│   └── structured_logger.py   <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># 구조화된 로깅</span></span>
<span id="cb32-11">├── monitoring<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">/</span></span>
<span id="cb32-12">│   ├── metrics.py             <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># 메트릭 수집</span></span>
<span id="cb32-13">│   └── dashboard.py           <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># 대시보드 연동</span></span>
<span id="cb32-14">└── document_processing<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">/</span></span>
<span id="cb32-15">    ├── pdf_parser.py</span>
<span id="cb32-16">    ├── code_parser.py</span>
<span id="cb32-17">    └── text_extractor.py</span></code></pre></div>
<section id="llm-클라이언트-2번-글-확장" class="level3" data-number="6.6.1">
<h3 data-number="6.6.1" class="anchored" data-anchor-id="llm-클라이언트-2번-글-확장"><span class="header-section-number">6.6.1</span> LLM 클라이언트 (2번 글 확장)</h3>
<div class="sourceCode" id="cb33" style="background: #f1f3f5;"><pre class="sourceCode numberSource python number-lines code-with-copy"><code class="sourceCode python"><span id="cb33-1"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># shared/llm/client.py</span></span>
<span id="cb33-2"><span class="im" style="color: #00769E;
background-color: null;
font-style: inherit;">from</span> typing <span class="im" style="color: #00769E;
background-color: null;
font-style: inherit;">import</span> Optional, Dict, Any</span>
<span id="cb33-3"><span class="im" style="color: #00769E;
background-color: null;
font-style: inherit;">from</span> openai <span class="im" style="color: #00769E;
background-color: null;
font-style: inherit;">import</span> OpenAI</span>
<span id="cb33-4"><span class="im" style="color: #00769E;
background-color: null;
font-style: inherit;">from</span> anthropic <span class="im" style="color: #00769E;
background-color: null;
font-style: inherit;">import</span> Anthropic</span>
<span id="cb33-5"><span class="im" style="color: #00769E;
background-color: null;
font-style: inherit;">import</span> time</span>
<span id="cb33-6"></span>
<span id="cb33-7"><span class="kw" style="color: #003B4F;
background-color: null;
font-style: inherit;">class</span> LLMClient:</span>
<span id="cb33-8">    <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">"""통합 LLM 클라이언트</span></span>
<span id="cb33-9"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">    </span></span>
<span id="cb33-10"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">    2번 글의 LLMClient를 확장:</span></span>
<span id="cb33-11"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">    - 토큰 카운팅</span></span>
<span id="cb33-12"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">    - 비용 추적</span></span>
<span id="cb33-13"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">    - 캐싱</span></span>
<span id="cb33-14"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">    """</span></span>
<span id="cb33-15">    </span>
<span id="cb33-16">    <span class="kw" style="color: #003B4F;
background-color: null;
font-style: inherit;">def</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">__init__</span>(</span>
<span id="cb33-17">        <span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">self</span>,</span>
<span id="cb33-18">        provider: <span class="bu" style="color: null;
background-color: null;
font-style: inherit;">str</span> <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"openai"</span>,</span>
<span id="cb33-19">        model: <span class="bu" style="color: null;
background-color: null;
font-style: inherit;">str</span> <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"gpt-4"</span>,</span>
<span id="cb33-20">        max_retries: <span class="bu" style="color: null;
background-color: null;
font-style: inherit;">int</span> <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">3</span>,</span>
<span id="cb33-21">        cache_enabled: <span class="bu" style="color: null;
background-color: null;
font-style: inherit;">bool</span> <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> <span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">True</span></span>
<span id="cb33-22">    ):</span>
<span id="cb33-23">        <span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">self</span>.provider <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> provider</span>
<span id="cb33-24">        <span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">self</span>.model <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> model</span>
<span id="cb33-25">        <span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">self</span>.max_retries <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> max_retries</span>
<span id="cb33-26">        <span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">self</span>.cache_enabled <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> cache_enabled</span>
<span id="cb33-27">        </span>
<span id="cb33-28">        <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># 캐시</span></span>
<span id="cb33-29">        <span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">self</span>._cache: Dict[<span class="bu" style="color: null;
background-color: null;
font-style: inherit;">str</span>, <span class="bu" style="color: null;
background-color: null;
font-style: inherit;">str</span>] <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> {}</span>
<span id="cb33-30">        </span>
<span id="cb33-31">        <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># 비용 추적</span></span>
<span id="cb33-32">        <span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">self</span>.total_tokens <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">0</span></span>
<span id="cb33-33">        <span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">self</span>.total_cost <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> <span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">0.0</span></span>
<span id="cb33-34">        </span>
<span id="cb33-35">        <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># 클라이언트 초기화</span></span>
<span id="cb33-36">        <span class="cf" style="color: #003B4F;
background-color: null;
font-style: inherit;">if</span> provider <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">==</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"openai"</span>:</span>
<span id="cb33-37">            <span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">self</span>.client <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> OpenAI()</span>
<span id="cb33-38">            <span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">self</span>.cost_per_token <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> <span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">0.00003</span>  <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># GPT-4 가격</span></span>
<span id="cb33-39">        <span class="cf" style="color: #003B4F;
background-color: null;
font-style: inherit;">elif</span> provider <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">==</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"anthropic"</span>:</span>
<span id="cb33-40">            <span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">self</span>.client <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> Anthropic()</span>
<span id="cb33-41">            <span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">self</span>.cost_per_token <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> <span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">0.00008</span>  <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># Claude 가격</span></span>
<span id="cb33-42">    </span>
<span id="cb33-43">    <span class="kw" style="color: #003B4F;
background-color: null;
font-style: inherit;">def</span> generate(</span>
<span id="cb33-44">        <span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">self</span>,</span>
<span id="cb33-45">        prompt: <span class="bu" style="color: null;
background-color: null;
font-style: inherit;">str</span>,</span>
<span id="cb33-46">        system_message: Optional[<span class="bu" style="color: null;
background-color: null;
font-style: inherit;">str</span>] <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> <span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">None</span>,</span>
<span id="cb33-47">        temperature: <span class="bu" style="color: null;
background-color: null;
font-style: inherit;">float</span> <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> <span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">0.0</span></span>
<span id="cb33-48">    ) <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">-&gt;</span> <span class="bu" style="color: null;
background-color: null;
font-style: inherit;">str</span>:</span>
<span id="cb33-49">        <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">"""텍스트 생성 (캐싱 + 재시도)"""</span></span>
<span id="cb33-50">        </span>
<span id="cb33-51">        <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># 캐시 확인</span></span>
<span id="cb33-52">        cache_key <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> <span class="ss" style="color: #20794D;
background-color: null;
font-style: inherit;">f"</span><span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">{</span>prompt<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">}</span><span class="ss" style="color: #20794D;
background-color: null;
font-style: inherit;">:</span><span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">{</span>system_message<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">}</span><span class="ss" style="color: #20794D;
background-color: null;
font-style: inherit;">:</span><span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">{</span>temperature<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">}</span><span class="ss" style="color: #20794D;
background-color: null;
font-style: inherit;">"</span></span>
<span id="cb33-53">        <span class="cf" style="color: #003B4F;
background-color: null;
font-style: inherit;">if</span> <span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">self</span>.cache_enabled <span class="kw" style="color: #003B4F;
background-color: null;
font-style: inherit;">and</span> cache_key <span class="kw" style="color: #003B4F;
background-color: null;
font-style: inherit;">in</span> <span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">self</span>._cache:</span>
<span id="cb33-54">            <span class="cf" style="color: #003B4F;
background-color: null;
font-style: inherit;">return</span> <span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">self</span>._cache[cache_key]</span>
<span id="cb33-55">        </span>
<span id="cb33-56">        <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># 재시도 로직</span></span>
<span id="cb33-57">        <span class="cf" style="color: #003B4F;
background-color: null;
font-style: inherit;">for</span> attempt <span class="kw" style="color: #003B4F;
background-color: null;
font-style: inherit;">in</span> <span class="bu" style="color: null;
background-color: null;
font-style: inherit;">range</span>(<span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">self</span>.max_retries):</span>
<span id="cb33-58">            <span class="cf" style="color: #003B4F;
background-color: null;
font-style: inherit;">try</span>:</span>
<span id="cb33-59">                <span class="cf" style="color: #003B4F;
background-color: null;
font-style: inherit;">if</span> <span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">self</span>.provider <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">==</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"openai"</span>:</span>
<span id="cb33-60">                    response <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> <span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">self</span>._call_openai(prompt, system_message, temperature)</span>
<span id="cb33-61">                <span class="cf" style="color: #003B4F;
background-color: null;
font-style: inherit;">elif</span> <span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">self</span>.provider <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">==</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"anthropic"</span>:</span>
<span id="cb33-62">                    response <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> <span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">self</span>._call_anthropic(prompt, system_message, temperature)</span>
<span id="cb33-63">                </span>
<span id="cb33-64">                <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># 캐시 저장</span></span>
<span id="cb33-65">                <span class="cf" style="color: #003B4F;
background-color: null;
font-style: inherit;">if</span> <span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">self</span>.cache_enabled:</span>
<span id="cb33-66">                    <span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">self</span>._cache[cache_key] <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> response</span>
<span id="cb33-67">                </span>
<span id="cb33-68">                <span class="cf" style="color: #003B4F;
background-color: null;
font-style: inherit;">return</span> response</span>
<span id="cb33-69">                </span>
<span id="cb33-70">            <span class="cf" style="color: #003B4F;
background-color: null;
font-style: inherit;">except</span> <span class="pp" style="color: #AD0000;
background-color: null;
font-style: inherit;">Exception</span> <span class="im" style="color: #00769E;
background-color: null;
font-style: inherit;">as</span> e:</span>
<span id="cb33-71">                <span class="cf" style="color: #003B4F;
background-color: null;
font-style: inherit;">if</span> attempt <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">&lt;</span> <span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">self</span>.max_retries <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">-</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span>:</span>
<span id="cb33-72">                    wait_time <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">2</span> <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">**</span> attempt</span>
<span id="cb33-73">                    time.sleep(wait_time)</span>
<span id="cb33-74">                <span class="cf" style="color: #003B4F;
background-color: null;
font-style: inherit;">else</span>:</span>
<span id="cb33-75">                    <span class="cf" style="color: #003B4F;
background-color: null;
font-style: inherit;">raise</span></span>
<span id="cb33-76">    </span>
<span id="cb33-77">    <span class="kw" style="color: #003B4F;
background-color: null;
font-style: inherit;">def</span> _call_openai(<span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">self</span>, prompt: <span class="bu" style="color: null;
background-color: null;
font-style: inherit;">str</span>, system_message: Optional[<span class="bu" style="color: null;
background-color: null;
font-style: inherit;">str</span>], temperature: <span class="bu" style="color: null;
background-color: null;
font-style: inherit;">float</span>) <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">-&gt;</span> <span class="bu" style="color: null;
background-color: null;
font-style: inherit;">str</span>:</span>
<span id="cb33-78">        <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">"""OpenAI API 호출"""</span></span>
<span id="cb33-79">        messages <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> []</span>
<span id="cb33-80">        <span class="cf" style="color: #003B4F;
background-color: null;
font-style: inherit;">if</span> system_message:</span>
<span id="cb33-81">            messages.append({<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"role"</span>: <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"system"</span>, <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"content"</span>: system_message})</span>
<span id="cb33-82">        messages.append({<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"role"</span>: <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"user"</span>, <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"content"</span>: prompt})</span>
<span id="cb33-83">        </span>
<span id="cb33-84">        response <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> <span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">self</span>.client.chat.completions.create(</span>
<span id="cb33-85">            model<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span><span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">self</span>.model,</span>
<span id="cb33-86">            messages<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span>messages,</span>
<span id="cb33-87">            temperature<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span>temperature</span>
<span id="cb33-88">        )</span>
<span id="cb33-89">        </span>
<span id="cb33-90">        <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># 토큰 및 비용 추적</span></span>
<span id="cb33-91">        tokens <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> response.usage.total_tokens</span>
<span id="cb33-92">        <span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">self</span>.total_tokens <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+=</span> tokens</span>
<span id="cb33-93">        <span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">self</span>.total_cost <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+=</span> tokens <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">*</span> <span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">self</span>.cost_per_token</span>
<span id="cb33-94">        </span>
<span id="cb33-95">        <span class="cf" style="color: #003B4F;
background-color: null;
font-style: inherit;">return</span> response.choices[<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">0</span>].message.content</span>
<span id="cb33-96">    </span>
<span id="cb33-97">    <span class="kw" style="color: #003B4F;
background-color: null;
font-style: inherit;">def</span> get_stats(<span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">self</span>) <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">-&gt;</span> Dict[<span class="bu" style="color: null;
background-color: null;
font-style: inherit;">str</span>, Any]:</span>
<span id="cb33-98">        <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">"""사용 통계"""</span></span>
<span id="cb33-99">        <span class="cf" style="color: #003B4F;
background-color: null;
font-style: inherit;">return</span> {</span>
<span id="cb33-100">            <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">'total_tokens'</span>: <span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">self</span>.total_tokens,</span>
<span id="cb33-101">            <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">'total_cost'</span>: <span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">self</span>.total_cost,</span>
<span id="cb33-102">            <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">'cache_size'</span>: <span class="bu" style="color: null;
background-color: null;
font-style: inherit;">len</span>(<span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">self</span>._cache)</span>
<span id="cb33-103">        }</span></code></pre></div>
</section>
</section>
<section id="agents-모듈-도메인-agent" class="level2" data-number="6.7">
<h2 data-number="6.7" class="anchored" data-anchor-id="agents-모듈-도메인-agent"><span class="header-section-number">6.7</span> agents/ 모듈: 도메인 Agent</h2>
<p><strong>역할</strong>: 실제 비즈니스 로직 구현</p>
<div class="sourceCode" id="cb34" style="background: #f1f3f5;"><pre class="sourceCode numberSource python number-lines code-with-copy"><code class="sourceCode python"><span id="cb34-1">agents<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">/</span></span>
<span id="cb34-2">├── data_standardization<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">/</span></span>
<span id="cb34-3">│   ├── <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">__init__</span>.py            <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># Agent 자동 등록</span></span>
<span id="cb34-4">│   ├── agent.py               <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># DataStandardizationAgent</span></span>
<span id="cb34-5">│   ├── manifest.yaml          <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># Agent 메타데이터</span></span>
<span id="cb34-6">│   ├── prompts<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">/</span></span>
<span id="cb34-7">│   │   ├── system.txt</span>
<span id="cb34-8">│   │   └── user_template.txt</span>
<span id="cb34-9">│   └── tests<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">/</span></span>
<span id="cb34-10">│       └── test_agent.py</span>
<span id="cb34-11">├── code_analysis<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">/</span></span>
<span id="cb34-12">│   ├── <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">__init__</span>.py</span>
<span id="cb34-13">│   ├── agent.py</span>
<span id="cb34-14">│   ├── manifest.yaml</span>
<span id="cb34-15">│   ├── parsers<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">/</span>               <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># Agent 전용 모듈</span></span>
<span id="cb34-16">│   │   ├── python_parser.py</span>
<span id="cb34-17">│   │   └── java_parser.py</span>
<span id="cb34-18">│   └── tests<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">/</span></span>
<span id="cb34-19">└── knowledge_qna<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">/</span></span>
<span id="cb34-20">    ├── <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">__init__</span>.py</span>
<span id="cb34-21">    ├── agent.py</span>
<span id="cb34-22">    ├── manifest.yaml</span>
<span id="cb34-23">    ├── rag_pipeline.py        <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># Agent 전용 RAG</span></span>
<span id="cb34-24">    └── tests<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">/</span></span></code></pre></div>
<section id="agent-구현-예시" class="level3" data-number="6.7.1">
<h3 data-number="6.7.1" class="anchored" data-anchor-id="agent-구현-예시"><span class="header-section-number">6.7.1</span> Agent 구현 예시</h3>
<div class="sourceCode" id="cb35" style="background: #f1f3f5;"><pre class="sourceCode numberSource python number-lines code-with-copy"><code class="sourceCode python"><span id="cb35-1"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># agents/data_standardization/agent.py</span></span>
<span id="cb35-2"><span class="im" style="color: #00769E;
background-color: null;
font-style: inherit;">from</span> core.agent <span class="im" style="color: #00769E;
background-color: null;
font-style: inherit;">import</span> BaseAgent, AgentMetadata</span>
<span id="cb35-3"><span class="im" style="color: #00769E;
background-color: null;
font-style: inherit;">from</span> shared.llm <span class="im" style="color: #00769E;
background-color: null;
font-style: inherit;">import</span> LLMClient</span>
<span id="cb35-4"><span class="im" style="color: #00769E;
background-color: null;
font-style: inherit;">from</span> typing <span class="im" style="color: #00769E;
background-color: null;
font-style: inherit;">import</span> Dict, Any</span>
<span id="cb35-5"></span>
<span id="cb35-6"><span class="kw" style="color: #003B4F;
background-color: null;
font-style: inherit;">class</span> DataStandardizationAgent(BaseAgent):</span>
<span id="cb35-7">    <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">"""데이터 스키마 표준화 Agent"""</span></span>
<span id="cb35-8">    </span>
<span id="cb35-9">    <span class="kw" style="color: #003B4F;
background-color: null;
font-style: inherit;">def</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">__init__</span>(<span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">self</span>):</span>
<span id="cb35-10">        metadata <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> AgentMetadata(</span>
<span id="cb35-11">            name<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"data_standardization"</span>,</span>
<span id="cb35-12">            version<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"1.0.0"</span>,</span>
<span id="cb35-13">            domain<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"data"</span>,</span>
<span id="cb35-14">            description<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"데이터 스키마 표준화"</span>,</span>
<span id="cb35-15">            author<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Platform Team"</span>,</span>
<span id="cb35-16">            created_at<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"2026-01-28"</span></span>
<span id="cb35-17">        )</span>
<span id="cb35-18">        <span class="bu" style="color: null;
background-color: null;
font-style: inherit;">super</span>().<span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">__init__</span>(metadata)</span>
<span id="cb35-19">        </span>
<span id="cb35-20">        <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># Agent 전용 LLM 클라이언트</span></span>
<span id="cb35-21">        <span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">self</span>.llm <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> LLMClient(provider<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"openai"</span>, model<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"gpt-4"</span>)</span>
<span id="cb35-22">    </span>
<span id="cb35-23">    <span class="kw" style="color: #003B4F;
background-color: null;
font-style: inherit;">def</span> process(<span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">self</span>, <span class="bu" style="color: null;
background-color: null;
font-style: inherit;">input</span>: Dict[<span class="bu" style="color: null;
background-color: null;
font-style: inherit;">str</span>, Any]) <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">-&gt;</span> Dict[<span class="bu" style="color: null;
background-color: null;
font-style: inherit;">str</span>, Any]:</span>
<span id="cb35-24">        <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">"""표준화 로직"""</span></span>
<span id="cb35-25">        schema <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> <span class="bu" style="color: null;
background-color: null;
font-style: inherit;">input</span>[<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">'data'</span>]</span>
<span id="cb35-26">        </span>
<span id="cb35-27">        <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># LLM 호출</span></span>
<span id="cb35-28">        prompt <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> <span class="ss" style="color: #20794D;
background-color: null;
font-style: inherit;">f"다음 스키마를 표준화하세요: </span><span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">{</span>schema<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">}</span><span class="ss" style="color: #20794D;
background-color: null;
font-style: inherit;">"</span></span>
<span id="cb35-29">        standardized <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> <span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">self</span>.llm.generate(prompt)</span>
<span id="cb35-30">        </span>
<span id="cb35-31">        <span class="cf" style="color: #003B4F;
background-color: null;
font-style: inherit;">return</span> {</span>
<span id="cb35-32">            <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">'result'</span>: standardized,</span>
<span id="cb35-33">            <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">'confidence'</span>: <span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">0.95</span></span>
<span id="cb35-34">        }</span>
<span id="cb35-35">    </span>
<span id="cb35-36">    <span class="kw" style="color: #003B4F;
background-color: null;
font-style: inherit;">def</span> evaluate(<span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">self</span>, ground_truth: Any, prediction: Any) <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">-&gt;</span> <span class="bu" style="color: null;
background-color: null;
font-style: inherit;">float</span>:</span>
<span id="cb35-37">        <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">"""정확도 평가"""</span></span>
<span id="cb35-38">        <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># 스키마 매칭 로직</span></span>
<span id="cb35-39">        <span class="cf" style="color: #003B4F;
background-color: null;
font-style: inherit;">return</span> <span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">0.9</span></span>
<span id="cb35-40"></span>
<span id="cb35-41"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># agents/data_standardization/__init__.py</span></span>
<span id="cb35-42"><span class="im" style="color: #00769E;
background-color: null;
font-style: inherit;">from</span> core.agent.registry <span class="im" style="color: #00769E;
background-color: null;
font-style: inherit;">import</span> AgentRegistry</span>
<span id="cb35-43"><span class="im" style="color: #00769E;
background-color: null;
font-style: inherit;">from</span> .agent <span class="im" style="color: #00769E;
background-color: null;
font-style: inherit;">import</span> DataStandardizationAgent</span>
<span id="cb35-44"></span>
<span id="cb35-45"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># Agent 자동 등록 (Dependency Inversion)</span></span>
<span id="cb35-46">agent <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> DataStandardizationAgent()</span>
<span id="cb35-47">AgentRegistry.get_instance().register(agent)</span></code></pre></div>
</section>
<section id="agent-manifest" class="level3" data-number="6.7.2">
<h3 data-number="6.7.2" class="anchored" data-anchor-id="agent-manifest"><span class="header-section-number">6.7.2</span> Agent Manifest</h3>
<div class="sourceCode" id="cb36" style="background: #f1f3f5;"><pre class="sourceCode numberSource yaml number-lines code-with-copy"><code class="sourceCode yaml"><span id="cb36-1"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># agents/data_standardization/manifest.yaml</span></span>
<span id="cb36-2"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">name</span><span class="kw" style="color: #003B4F;
background-color: null;
font-style: inherit;">:</span><span class="at" style="color: #657422;
background-color: null;
font-style: inherit;"> data_standardization_agent</span></span>
<span id="cb36-3"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">version</span><span class="kw" style="color: #003B4F;
background-color: null;
font-style: inherit;">:</span><span class="at" style="color: #657422;
background-color: null;
font-style: inherit;"> </span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"1.0.0"</span></span>
<span id="cb36-4"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">domain</span><span class="kw" style="color: #003B4F;
background-color: null;
font-style: inherit;">:</span><span class="at" style="color: #657422;
background-color: null;
font-style: inherit;"> data_standardization</span></span>
<span id="cb36-5"></span>
<span id="cb36-6"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">description</span><span class="kw" style="color: #003B4F;
background-color: null;
font-style: inherit;">: </span><span class="ch" style="color: #20794D;
background-color: null;
font-style: inherit;">|</span></span>
<span id="cb36-7">  데이터 스키마를 표준화하여 일관된 형식으로 변환</span>
<span id="cb36-8"></span>
<span id="cb36-9"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">inputs</span><span class="kw" style="color: #003B4F;
background-color: null;
font-style: inherit;">:</span></span>
<span id="cb36-10"><span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">  </span><span class="kw" style="color: #003B4F;
background-color: null;
font-style: inherit;">-</span><span class="at" style="color: #657422;
background-color: null;
font-style: inherit;"> </span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">name</span><span class="kw" style="color: #003B4F;
background-color: null;
font-style: inherit;">:</span><span class="at" style="color: #657422;
background-color: null;
font-style: inherit;"> raw_schema</span></span>
<span id="cb36-11"><span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">    </span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">type</span><span class="kw" style="color: #003B4F;
background-color: null;
font-style: inherit;">:</span><span class="at" style="color: #657422;
background-color: null;
font-style: inherit;"> dict</span></span>
<span id="cb36-12"><span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">    </span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">required</span><span class="kw" style="color: #003B4F;
background-color: null;
font-style: inherit;">:</span><span class="at" style="color: #657422;
background-color: null;
font-style: inherit;"> </span><span class="ch" style="color: #20794D;
background-color: null;
font-style: inherit;">true</span></span>
<span id="cb36-13"></span>
<span id="cb36-14"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">outputs</span><span class="kw" style="color: #003B4F;
background-color: null;
font-style: inherit;">:</span></span>
<span id="cb36-15"><span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">  </span><span class="kw" style="color: #003B4F;
background-color: null;
font-style: inherit;">-</span><span class="at" style="color: #657422;
background-color: null;
font-style: inherit;"> </span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">name</span><span class="kw" style="color: #003B4F;
background-color: null;
font-style: inherit;">:</span><span class="at" style="color: #657422;
background-color: null;
font-style: inherit;"> standardized_schema</span></span>
<span id="cb36-16"><span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">    </span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">type</span><span class="kw" style="color: #003B4F;
background-color: null;
font-style: inherit;">:</span><span class="at" style="color: #657422;
background-color: null;
font-style: inherit;"> dict</span></span>
<span id="cb36-17"></span>
<span id="cb36-18"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">dependencies</span><span class="kw" style="color: #003B4F;
background-color: null;
font-style: inherit;">:</span></span>
<span id="cb36-19"><span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">  </span><span class="kw" style="color: #003B4F;
background-color: null;
font-style: inherit;">-</span><span class="at" style="color: #657422;
background-color: null;
font-style: inherit;"> core.agent&gt;=1.0.0</span></span>
<span id="cb36-20"><span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">  </span><span class="kw" style="color: #003B4F;
background-color: null;
font-style: inherit;">-</span><span class="at" style="color: #657422;
background-color: null;
font-style: inherit;"> shared.llm&gt;=1.0.0</span></span>
<span id="cb36-21"><span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">  </span><span class="kw" style="color: #003B4F;
background-color: null;
font-style: inherit;">-</span><span class="at" style="color: #657422;
background-color: null;
font-style: inherit;"> shared.validation&gt;=1.0.0</span></span>
<span id="cb36-22"></span>
<span id="cb36-23"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">resources</span><span class="kw" style="color: #003B4F;
background-color: null;
font-style: inherit;">:</span></span>
<span id="cb36-24"><span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">  </span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">memory</span><span class="kw" style="color: #003B4F;
background-color: null;
font-style: inherit;">:</span><span class="at" style="color: #657422;
background-color: null;
font-style: inherit;"> 512MB</span></span>
<span id="cb36-25"><span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">  </span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">cpu</span><span class="kw" style="color: #003B4F;
background-color: null;
font-style: inherit;">:</span><span class="at" style="color: #657422;
background-color: null;
font-style: inherit;"> </span><span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">0.5</span></span>
<span id="cb36-26"></span>
<span id="cb36-27"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">monitoring</span><span class="kw" style="color: #003B4F;
background-color: null;
font-style: inherit;">:</span></span>
<span id="cb36-28"><span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">  </span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">metrics</span><span class="kw" style="color: #003B4F;
background-color: null;
font-style: inherit;">:</span></span>
<span id="cb36-29"><span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">    </span><span class="kw" style="color: #003B4F;
background-color: null;
font-style: inherit;">-</span><span class="at" style="color: #657422;
background-color: null;
font-style: inherit;"> </span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">name</span><span class="kw" style="color: #003B4F;
background-color: null;
font-style: inherit;">:</span><span class="at" style="color: #657422;
background-color: null;
font-style: inherit;"> accuracy</span></span>
<span id="cb36-30"><span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">      </span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">type</span><span class="kw" style="color: #003B4F;
background-color: null;
font-style: inherit;">:</span><span class="at" style="color: #657422;
background-color: null;
font-style: inherit;"> gauge</span></span>
<span id="cb36-31"><span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">    </span><span class="kw" style="color: #003B4F;
background-color: null;
font-style: inherit;">-</span><span class="at" style="color: #657422;
background-color: null;
font-style: inherit;"> </span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">name</span><span class="kw" style="color: #003B4F;
background-color: null;
font-style: inherit;">:</span><span class="at" style="color: #657422;
background-color: null;
font-style: inherit;"> processing_time</span></span>
<span id="cb36-32"><span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">      </span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">type</span><span class="kw" style="color: #003B4F;
background-color: null;
font-style: inherit;">:</span><span class="at" style="color: #657422;
background-color: null;
font-style: inherit;"> histogram</span></span></code></pre></div>


</section>
</section>
</section>

 ]]></description>
  <category>Engineering</category>
  <category>System</category>
  <category>Architecture Design</category>
  <category>Agent</category>
  <category>Platform</category>
  <guid>kk3225.netlify.app/docs/blog/posts/Engineering/System/Archi_Design/platform/4.agent_platform_interface_design.html</guid>
  <pubDate>Wed, 28 Jan 2026 15:00:00 GMT</pubDate>
</item>
<item>
  <title>AI Agent 플랫폼 저장소 전략</title>
  <dc:creator>Kwangmin Kim</dc:creator>
  <link>kk3225.netlify.app/docs/blog/posts/Engineering/System/Archi_Design/platform/3.agent_platform_repo_strategy.html</link>
  <description><![CDATA[ 





<section id="들어가며" class="level1" data-number="1">
<h1 data-number="1"><span class="header-section-number">1</span> 들어가며</h1>
<section id="왜-저장소-전략이-중요한가" class="level2" data-number="1.1">
<h2 data-number="1.1" class="anchored" data-anchor-id="왜-저장소-전략이-중요한가"><span class="header-section-number">1.1</span> 왜 저장소 전략이 중요한가?</h2>
<p>Phase 1-4를 거쳐 3개 POC Agent를 만들었다. 이제 플랫폼으로 통합해야 한다:</p>
<p><strong>질문들</strong>: - “각 Agent를 별도 저장소에 둘 것인가, 하나로 통합할 것인가?” - “공통 코드를 어떻게 재사용할 것인가?” - “새 Agent 추가 시 기존 코드 수정을 최소화하려면?”</p>
<p><strong>이 글의 목표</strong>: - Monorepo vs Polyrepo 선택 기준 - Monorepo 디렉토리 구조 설계 - core/shared/agents 모듈 분리 원칙 - 의존성 관리 규칙 - 빌드 도구 선택 (Poetry, Nx, Bazel)</p>
</section>
<section id="앞선-글-요약" class="level2" data-number="1.2">
<h2 data-number="1.2" class="anchored" data-anchor-id="앞선-글-요약"><span class="header-section-number">1.2</span> 앞선 글 요약</h2>
<p><strong>1번 글</strong> (<a href="../../../../../../../docs/blog/posts/Engineering/System/Archi_Design/platform/1.agent_platform_overview.html">플랫폼 구축의 관점 선택</a>): - Platform Engineering + Software Architecture 융합 - 개발자 경험(DX)과 유지보수성 두 축</p>
<p><strong>2번 글</strong> (<a href="../../../../../../../docs/blog/posts/Engineering/System/Archi_Design/platform/2.agent_platform_design_strategy.html">5대 원칙과 점진적 추상화</a>): - 5대 원칙: Interface Segregation, Dependency Inversion 등 - Phase 1-4: POC → 패턴 발견 → 추상화 → 플랫폼 완성</p>
<p><strong>핵심 질문</strong>: “Phase 4에서 어떤 저장소 구조를 선택할 것인가?”</p>
</section>
</section>
<section id="저장소-구조-설계" class="level1" data-number="2">
<h1 data-number="2"><span class="header-section-number">2</span> 저장소 구조 설계</h1>
<section id="monorepo-선택-근거" class="level2" data-number="2.1">
<h2 data-number="2.1" class="anchored" data-anchor-id="monorepo-선택-근거"><span class="header-section-number">2.1</span> Monorepo 선택 근거</h2>
<p>2번 글의 Phase 1-4 전략을 따르면 <strong>Monorepo가 자연스러운 결과</strong>다:</p>
<p><strong>Phase 1-3에서 발견한 사실</strong>:<br>
- 3개 POC 모두 LLM 클라이언트 재사용 (100%)<br>
- 검증 로직 공통 패턴 발견 (70%)<br>
- Agent 간 체이닝 필요성 확인</p>
<p><strong>Monorepo의 이점</strong> (실증 데이터):<br>
- 공통 모듈 재사용률: 67% (Uber ML Platform)<br>
- 의존성 충돌: 78% 감소 (Microsoft)<br>
- 새 Agent 추가 시간: 3주 → 1일 (Uber)</p>
<p><strong>결정</strong>: POC 3개를 Monorepo로 통합 → Phase 4 플랫폼 구조로 발전</p>
</section>
<section id="monorepo-디렉토리-구조-원칙" class="level2" data-number="2.2">
<h2 data-number="2.2" class="anchored" data-anchor-id="monorepo-디렉토리-구조-원칙"><span class="header-section-number">2.2</span> Monorepo 디렉토리 구조 원칙</h2>
<section id="핵심-규칙" class="level3" data-number="2.2.1">
<h3 data-number="2.2.1" class="anchored" data-anchor-id="핵심-규칙"><span class="header-section-number">2.2.1</span> 핵심 규칙</h3>
<div class="sourceCode" id="cb1" style="background: #f1f3f5;"><pre class="sourceCode numberSource python number-lines code-with-copy"><code class="sourceCode python"><span id="cb1-1"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># 의존성 방향 규칙</span></span>
<span id="cb1-2">agents<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">/</span>  → shared<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">/</span>  ✅  <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># Agent가 공통 라이브러리 사용</span></span>
<span id="cb1-3">agents<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">/</span>  → core<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">/</span>    ✅  <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># Agent가 BaseAgent 상속</span></span>
<span id="cb1-4">shared<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">/</span>  → core<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">/</span>    ✅  <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># 공통 모듈이 Core 사용</span></span>
<span id="cb1-5"></span>
<span id="cb1-6">core<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">/</span>    → agents<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">/</span>  ❌  <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># Core는 Agent를 몰라야 함 (Dependency Inversion)</span></span>
<span id="cb1-7">shared<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">/</span>  → agents<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">/</span>  ❌  <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># 공통 모듈은 Agent에 의존 금지</span></span>
<span id="cb1-8">agents<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">/</span>A → agents<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">/</span>B ❌  <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># Agent 간 직접 의존 금지</span></span></code></pre></div>
<p><strong>왜 이 규칙이 중요한가?</strong></p>
<div class="sourceCode" id="cb2" style="background: #f1f3f5;"><pre class="sourceCode numberSource python number-lines code-with-copy"><code class="sourceCode python"><span id="cb2-1"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># ❌ 잘못된 예: Core가 Agent에 의존</span></span>
<span id="cb2-2"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># core/orchestrator.py</span></span>
<span id="cb2-3"><span class="im" style="color: #00769E;
background-color: null;
font-style: inherit;">from</span> agents.data_standardization <span class="im" style="color: #00769E;
background-color: null;
font-style: inherit;">import</span> DataStandardizationAgent</span>
<span id="cb2-4"><span class="im" style="color: #00769E;
background-color: null;
font-style: inherit;">from</span> agents.code_analysis <span class="im" style="color: #00769E;
background-color: null;
font-style: inherit;">import</span> CodeAnalysisAgent</span>
<span id="cb2-5"></span>
<span id="cb2-6"><span class="kw" style="color: #003B4F;
background-color: null;
font-style: inherit;">class</span> Orchestrator:</span>
<span id="cb2-7">    <span class="kw" style="color: #003B4F;
background-color: null;
font-style: inherit;">def</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">__init__</span>(<span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">self</span>):</span>
<span id="cb2-8">        <span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">self</span>.data_agent <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> DataStandardizationAgent()  <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># Core가 Agent 알고 있음</span></span>
<span id="cb2-9">        </span>
<span id="cb2-10"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># 문제: 새 Agent 추가 시 Core 수정 필요 → Core 불안정</span></span>
<span id="cb2-11"></span>
<span id="cb2-12"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># ✅ 올바른 예: Agent가 Core에 등록</span></span>
<span id="cb2-13"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># core/orchestrator.py</span></span>
<span id="cb2-14"><span class="kw" style="color: #003B4F;
background-color: null;
font-style: inherit;">class</span> Orchestrator:</span>
<span id="cb2-15">    <span class="kw" style="color: #003B4F;
background-color: null;
font-style: inherit;">def</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">__init__</span>(<span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">self</span>):</span>
<span id="cb2-16">        <span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">self</span>.agents: Dict[<span class="bu" style="color: null;
background-color: null;
font-style: inherit;">str</span>, BaseAgent] <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> {}</span>
<span id="cb2-17">    </span>
<span id="cb2-18">    <span class="kw" style="color: #003B4F;
background-color: null;
font-style: inherit;">def</span> register(<span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">self</span>, agent: BaseAgent):</span>
<span id="cb2-19">        <span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">self</span>.agents[agent.name] <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> agent</span>
<span id="cb2-20"></span>
<span id="cb2-21"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># agents/data_standardization/__init__.py</span></span>
<span id="cb2-22"><span class="im" style="color: #00769E;
background-color: null;
font-style: inherit;">from</span> core.orchestrator <span class="im" style="color: #00769E;
background-color: null;
font-style: inherit;">import</span> get_orchestrator</span>
<span id="cb2-23"><span class="im" style="color: #00769E;
background-color: null;
font-style: inherit;">from</span> .agent <span class="im" style="color: #00769E;
background-color: null;
font-style: inherit;">import</span> DataStandardizationAgent</span>
<span id="cb2-24"></span>
<span id="cb2-25">agent <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> DataStandardizationAgent()</span>
<span id="cb2-26">get_orchestrator().register(agent)  <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># Agent가 스스로 등록</span></span></code></pre></div>
</section>
<section id="빌드-도구-선택" class="level3" data-number="2.2.2">
<h3 data-number="2.2.2" class="anchored" data-anchor-id="빌드-도구-선택"><span class="header-section-number">2.2.2</span> 빌드 도구 선택</h3>
<p><strong>초기 (Agent 5개 미만)</strong>: - Poetry: 의존성 관리 - pytest: 테스트 - GitHub Actions: CI/CD</p>
<p><strong>성장기 (Agent 5-20개)</strong>: - Nx 또는 Turborepo 추가 - 변경된 Agent만 빌드/테스트 (Incremental Build) - 캐싱으로 빌드 시간 단축</p>
<p><strong>성숙기 (Agent 20개 이상)</strong>: - Bazel 고려 (Google 스타일) - Monorepo 전용 빌드 시스템 - 초기 설정 복잡하지만 확장성 최고</p>
</section>
</section>
<section id="monorepo-vs-polyrepo-비교" class="level2" data-number="2.3">
<h2 data-number="2.3" class="anchored" data-anchor-id="monorepo-vs-polyrepo-비교"><span class="header-section-number">2.3</span> Monorepo vs Polyrepo 비교</h2>
<section id="polyrepo-시나리오-권장하지-않음" class="level3" data-number="2.3.1">
<h3 data-number="2.3.1" class="anchored" data-anchor-id="polyrepo-시나리오-권장하지-않음"><span class="header-section-number">2.3.1</span> Polyrepo 시나리오 (권장하지 않음)</h3>
<div class="sourceCode" id="cb3" style="background: #f1f3f5;"><pre class="sourceCode numberSource bash number-lines code-with-copy"><code class="sourceCode bash"><span id="cb3-1"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># 각 Agent별 별도 저장소</span></span>
<span id="cb3-2"><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">agent-data-standardization/</span></span>
<span id="cb3-3">  <span class="ex" style="color: null;
background-color: null;
font-style: inherit;">└──</span> pyproject.toml</span>
<span id="cb3-4"><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">agent-code-analysis/</span></span>
<span id="cb3-5">  <span class="ex" style="color: null;
background-color: null;
font-style: inherit;">└──</span> pyproject.toml</span>
<span id="cb3-6"><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">agent-recommendation/</span></span>
<span id="cb3-7">  <span class="ex" style="color: null;
background-color: null;
font-style: inherit;">└──</span> pyproject.toml</span>
<span id="cb3-8"><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">shared-llm-client/</span>  <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># 공통 라이브러리를 별도 패키지로</span></span>
<span id="cb3-9">  <span class="ex" style="color: null;
background-color: null;
font-style: inherit;">└──</span> pyproject.toml</span></code></pre></div>
<p><strong>문제점</strong>:</p>
<ol type="1">
<li><strong>의존성 지옥</strong>:</li>
</ol>
<div class="sourceCode" id="cb4" style="background: #f1f3f5;"><pre class="sourceCode numberSource toml number-lines code-with-copy"><code class="sourceCode toml"><span id="cb4-1"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># agent-data-standardization/pyproject.toml</span></span>
<span id="cb4-2"><span class="kw" style="color: #003B4F;
background-color: null;
font-style: inherit;">[tool.poetry.dependencies]</span></span>
<span id="cb4-3"><span class="dt" style="color: #AD0000;
background-color: null;
font-style: inherit;">shared-llm-client</span> <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"^0.1.5"</span>  <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># 버전 고정</span></span>
<span id="cb4-4"></span>
<span id="cb4-5"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># agent-code-analysis/pyproject.toml</span></span>
<span id="cb4-6"><span class="kw" style="color: #003B4F;
background-color: null;
font-style: inherit;">[tool.poetry.dependencies]</span></span>
<span id="cb4-7"><span class="dt" style="color: #AD0000;
background-color: null;
font-style: inherit;">shared-llm-client</span> <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"^0.2.0"</span>  <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># 다른 버전 필요</span></span>
<span id="cb4-8"></span>
<span id="cb4-9"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># 결과: 두 Agent를 함께 사용할 수 없음</span></span></code></pre></div>
<ol start="2" type="1">
<li><strong>변경 파급 비용</strong>:</li>
</ol>
<div class="sourceCode" id="cb5" style="background: #f1f3f5;"><pre class="sourceCode numberSource python number-lines code-with-copy"><code class="sourceCode python"><span id="cb5-1"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># shared-llm-client 업데이트 시</span></span>
<span id="cb5-2"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># 1. shared-llm-client PR 생성 + 리뷰 + 머지</span></span>
<span id="cb5-3"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># 2. PyPI에 새 버전 배포</span></span>
<span id="cb5-4"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># 3. agent-data-standardization에서 버전 업데이트 PR</span></span>
<span id="cb5-5"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># 4. agent-code-analysis에서 버전 업데이트 PR</span></span>
<span id="cb5-6"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># 5. agent-recommendation에서 버전 업데이트 PR</span></span>
<span id="cb5-7"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># → 최소 4개 PR, 일주일 소요</span></span></code></pre></div>
<ol start="3" type="1">
<li><strong>통합 테스트 불가능</strong>:</li>
</ol>
<ul>
<li>Agent A + Agent B 체이닝 테스트를 어떻게?</li>
<li>각 저장소 CI는 독립적으로 성공하지만, 통합 시 실패</li>
</ul>
</section>
<section id="monorepo-시나리오-권장" class="level3" data-number="2.3.2">
<h3 data-number="2.3.2" class="anchored" data-anchor-id="monorepo-시나리오-권장"><span class="header-section-number">2.3.2</span> Monorepo 시나리오 (권장)</h3>
<div class="sourceCode" id="cb6" style="background: #f1f3f5;"><pre class="sourceCode numberSource bash number-lines code-with-copy"><code class="sourceCode bash"><span id="cb6-1"><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">ai-agent-platform/</span></span>
<span id="cb6-2">  <span class="ex" style="color: null;
background-color: null;
font-style: inherit;">core/</span></span>
<span id="cb6-3">    <span class="ex" style="color: null;
background-color: null;
font-style: inherit;">base_agent.py</span></span>
<span id="cb6-4">  <span class="ex" style="color: null;
background-color: null;
font-style: inherit;">shared/</span></span>
<span id="cb6-5">    <span class="ex" style="color: null;
background-color: null;
font-style: inherit;">llm_client.py</span></span>
<span id="cb6-6">  <span class="ex" style="color: null;
background-color: null;
font-style: inherit;">agents/</span></span>
<span id="cb6-7">    <span class="ex" style="color: null;
background-color: null;
font-style: inherit;">data_standardization/</span></span>
<span id="cb6-8">    <span class="ex" style="color: null;
background-color: null;
font-style: inherit;">code_analysis/</span></span>
<span id="cb6-9">    <span class="ex" style="color: null;
background-color: null;
font-style: inherit;">recommendation/</span></span>
<span id="cb6-10">  <span class="ex" style="color: null;
background-color: null;
font-style: inherit;">pyproject.toml</span>  <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># 단일 의존성 관리</span></span></code></pre></div>
<p><strong>이점</strong>:</p>
<ol type="1">
<li><strong>원자적 변경</strong>:</li>
</ol>
<div class="sourceCode" id="cb7" style="background: #f1f3f5;"><pre class="sourceCode numberSource bash number-lines code-with-copy"><code class="sourceCode bash"><span id="cb7-1"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># 하나의 PR로 모든 변경 완료</span></span>
<span id="cb7-2"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">git</span> commit <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">-m</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"feat: LLMClient에 retry 추가 + 모든 Agent 업데이트"</span></span>
<span id="cb7-3"></span>
<span id="cb7-4"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># CI에서 전체 플랫폼 테스트</span></span>
<span id="cb7-5"><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">pytest</span> tests/  <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># 모든 Agent + 통합 테스트</span></span></code></pre></div>
<ol start="2" type="1">
<li><strong>의존성 단순화</strong>:</li>
</ol>
<div class="sourceCode" id="cb8" style="background: #f1f3f5;"><pre class="sourceCode numberSource toml number-lines code-with-copy"><code class="sourceCode toml"><span id="cb8-1"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># pyproject.toml (루트)</span></span>
<span id="cb8-2"><span class="kw" style="color: #003B4F;
background-color: null;
font-style: inherit;">[tool.poetry.dependencies]</span></span>
<span id="cb8-3"><span class="dt" style="color: #AD0000;
background-color: null;
font-style: inherit;">openai</span> <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"^1.0.0"</span></span>
<span id="cb8-4"><span class="dt" style="color: #AD0000;
background-color: null;
font-style: inherit;">langchain</span> <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"^0.1.0"</span></span>
<span id="cb8-5"></span>
<span id="cb8-6"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># 모든 Agent가 동일한 버전 사용</span></span></code></pre></div>
<ol start="3" type="1">
<li><strong>리팩토링 안전성</strong>:</li>
</ol>
<div class="sourceCode" id="cb9" style="background: #f1f3f5;"><pre class="sourceCode numberSource python number-lines code-with-copy"><code class="sourceCode python"><span id="cb9-1"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># core/base_agent.py 수정 시</span></span>
<span id="cb9-2"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># IDE가 모든 사용처 찾아줌</span></span>
<span id="cb9-3"><span class="kw" style="color: #003B4F;
background-color: null;
font-style: inherit;">class</span> BaseAgent:</span>
<span id="cb9-4">    <span class="kw" style="color: #003B4F;
background-color: null;
font-style: inherit;">def</span> process(<span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">self</span>, data: Dict) <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">-&gt;</span> Dict:  <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># 시그니처 변경</span></span>
<span id="cb9-5">        ...</span>
<span id="cb9-6"></span>
<span id="cb9-7"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># agents/data_standardization/agent.py</span></span>
<span id="cb9-8"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># IDE가 자동으로 에러 표시 → 즉시 수정 가능</span></span></code></pre></div>
</section>
</section>
</section>
<section id="모듈-아키텍처-설계" class="level1" data-number="3">
<h1 data-number="3"><span class="header-section-number">3</span> 모듈 아키텍처 설계</h1>
<section id="core-shared-agents-분리-원칙" class="level2" data-number="3.1">
<h2 data-number="3.1" class="anchored" data-anchor-id="core-shared-agents-분리-원칙"><span class="header-section-number">3.1</span> core/ shared/ agents/ 분리 원칙</h2>
<section id="각-모듈의-역할" class="level3" data-number="3.1.1">
<h3 data-number="3.1.1" class="anchored" data-anchor-id="각-모듈의-역할"><span class="header-section-number">3.1.1</span> 각 모듈의 역할</h3>
<p><strong>core/</strong>: 플랫폼 핵심 추상화 - BaseAgent 인터페이스 - AgentRegistry (Agent 등록/검색) - Orchestrator (Agent 체이닝) - 변경 빈도: <strong>매우 낮음</strong> (안정성 중요)</p>
<p><strong>shared/</strong>: 공통 라이브러리 - LLMClient (GPT, Claude 등) - PromptRegistry - VectorStoreManager - 변경 빈도: <strong>낮음</strong> (재사용성 중요)</p>
<p><strong>agents/</strong>: 개별 Agent 구현 - 각 Agent는 독립적인 디렉토리 - BaseAgent 인터페이스 구현 - 변경 빈도: <strong>높음</strong> (비즈니스 로직)</p>
</section>
<section id="의존성-규칙-solid의-dip-적용" class="level3" data-number="3.1.2">
<h3 data-number="3.1.2" class="anchored" data-anchor-id="의존성-규칙-solid의-dip-적용"><span class="header-section-number">3.1.2</span> 의존성 규칙 (SOLID의 DIP 적용)</h3>
<div class="sourceCode" id="cb10" style="background: #f1f3f5;"><pre class="sourceCode numberSource python number-lines code-with-copy"><code class="sourceCode python"><span id="cb10-1"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># ✅ 허용되는 의존성</span></span>
<span id="cb10-2">agents.data_standardization → shared.llm_client</span>
<span id="cb10-3">agents.data_standardization → core.base_agent</span>
<span id="cb10-4">shared.llm_client → core.config</span>
<span id="cb10-5"></span>
<span id="cb10-6"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># ❌ 금지된 의존성</span></span>
<span id="cb10-7">core.orchestrator → agents.data_standardization  <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># Core가 Agent 알면 안됨</span></span>
<span id="cb10-8">shared.llm_client → agents.code_analysis  <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># 공통 모듈이 Agent 알면 안됨</span></span>
<span id="cb10-9">agents.A → agents.B  <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># Agent 간 직접 의존 금지</span></span></code></pre></div>
<p><strong>왜 이 규칙이 중요한가?</strong></p>
<div class="sourceCode" id="cb11" style="background: #f1f3f5;"><pre class="sourceCode numberSource python number-lines code-with-copy"><code class="sourceCode python"><span id="cb11-1"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># ❌ 나쁜 예: Orchestrator가 Agent를 직접 import</span></span>
<span id="cb11-2"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># core/orchestrator.py</span></span>
<span id="cb11-3"><span class="im" style="color: #00769E;
background-color: null;
font-style: inherit;">from</span> agents.data_standardization <span class="im" style="color: #00769E;
background-color: null;
font-style: inherit;">import</span> DataStandardizationAgent</span>
<span id="cb11-4"><span class="im" style="color: #00769E;
background-color: null;
font-style: inherit;">from</span> agents.code_analysis <span class="im" style="color: #00769E;
background-color: null;
font-style: inherit;">import</span> CodeAnalysisAgent</span>
<span id="cb11-5"></span>
<span id="cb11-6"><span class="kw" style="color: #003B4F;
background-color: null;
font-style: inherit;">class</span> Orchestrator:</span>
<span id="cb11-7">    <span class="kw" style="color: #003B4F;
background-color: null;
font-style: inherit;">def</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">__init__</span>(<span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">self</span>):</span>
<span id="cb11-8">        <span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">self</span>.agents <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> [</span>
<span id="cb11-9">            DataStandardizationAgent(),</span>
<span id="cb11-10">            CodeAnalysisAgent()</span>
<span id="cb11-11">        ]</span>
<span id="cb11-12">    </span>
<span id="cb11-13">    <span class="kw" style="color: #003B4F;
background-color: null;
font-style: inherit;">def</span> add_new_agent(<span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">self</span>, agent):</span>
<span id="cb11-14">        <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># 새 Agent 추가 시 이 파일 수정 필요</span></span>
<span id="cb11-15">        <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># → Core가 불안정해짐</span></span>
<span id="cb11-16">        <span class="cf" style="color: #003B4F;
background-color: null;
font-style: inherit;">pass</span></span>
<span id="cb11-17"></span>
<span id="cb11-18"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># ✅ 좋은 예: Agent가 스스로 등록 (Dependency Inversion)</span></span>
<span id="cb11-19"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># core/orchestrator.py</span></span>
<span id="cb11-20"><span class="kw" style="color: #003B4F;
background-color: null;
font-style: inherit;">class</span> Orchestrator:</span>
<span id="cb11-21">    <span class="kw" style="color: #003B4F;
background-color: null;
font-style: inherit;">def</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">__init__</span>(<span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">self</span>):</span>
<span id="cb11-22">        <span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">self</span>.agents: Dict[<span class="bu" style="color: null;
background-color: null;
font-style: inherit;">str</span>, BaseAgent] <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> {}</span>
<span id="cb11-23">    </span>
<span id="cb11-24">    <span class="kw" style="color: #003B4F;
background-color: null;
font-style: inherit;">def</span> register(<span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">self</span>, name: <span class="bu" style="color: null;
background-color: null;
font-style: inherit;">str</span>, agent: BaseAgent):</span>
<span id="cb11-25">        <span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">self</span>.agents[name] <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> agent</span>
<span id="cb11-26"></span>
<span id="cb11-27"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># agents/data_standardization/__init__.py</span></span>
<span id="cb11-28"><span class="im" style="color: #00769E;
background-color: null;
font-style: inherit;">from</span> core.orchestrator <span class="im" style="color: #00769E;
background-color: null;
font-style: inherit;">import</span> get_orchestrator</span>
<span id="cb11-29"><span class="im" style="color: #00769E;
background-color: null;
font-style: inherit;">from</span> .agent <span class="im" style="color: #00769E;
background-color: null;
font-style: inherit;">import</span> DataStandardizationAgent</span>
<span id="cb11-30"></span>
<span id="cb11-31"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># 모듈 import 시 자동 등록</span></span>
<span id="cb11-32">_agent <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> DataStandardizationAgent()</span>
<span id="cb11-33">get_orchestrator().register(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"data_standardization"</span>, _agent)</span></code></pre></div>
</section>
<section id="모듈-독립성-검증" class="level3" data-number="3.1.3">
<h3 data-number="3.1.3" class="anchored" data-anchor-id="모듈-독립성-검증"><span class="header-section-number">3.1.3</span> 모듈 독립성 검증</h3>
<p><strong>import-linter 설정</strong>:</p>
<div class="sourceCode" id="cb12" style="background: #f1f3f5;"><pre class="sourceCode numberSource toml number-lines code-with-copy"><code class="sourceCode toml"><span id="cb12-1"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># pyproject.toml</span></span>
<span id="cb12-2"><span class="kw" style="color: #003B4F;
background-color: null;
font-style: inherit;">[tool.importlinter]</span></span>
<span id="cb12-3"><span class="dt" style="color: #AD0000;
background-color: null;
font-style: inherit;">root_package</span> <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"."</span></span>
<span id="cb12-4"></span>
<span id="cb12-5"><span class="kw" style="color: #003B4F;
background-color: null;
font-style: inherit;">[[tool.importlinter.contracts]]</span></span>
<span id="cb12-6"><span class="dt" style="color: #AD0000;
background-color: null;
font-style: inherit;">name</span> <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Core는 Agent에 의존 금지"</span></span>
<span id="cb12-7"><span class="dt" style="color: #AD0000;
background-color: null;
font-style: inherit;">type</span> <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"forbidden"</span></span>
<span id="cb12-8"><span class="dt" style="color: #AD0000;
background-color: null;
font-style: inherit;">source_modules</span> <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">[</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"core"</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">]</span></span>
<span id="cb12-9"><span class="dt" style="color: #AD0000;
background-color: null;
font-style: inherit;">forbidden_modules</span> <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">[</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"agents"</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">]</span></span>
<span id="cb12-10"></span>
<span id="cb12-11"><span class="kw" style="color: #003B4F;
background-color: null;
font-style: inherit;">[[tool.importlinter.contracts]]</span></span>
<span id="cb12-12"><span class="dt" style="color: #AD0000;
background-color: null;
font-style: inherit;">name</span> <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Shared는 Agent에 의존 금지"</span></span>
<span id="cb12-13"><span class="dt" style="color: #AD0000;
background-color: null;
font-style: inherit;">type</span> <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"forbidden"</span></span>
<span id="cb12-14"><span class="dt" style="color: #AD0000;
background-color: null;
font-style: inherit;">source_modules</span> <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">[</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"shared"</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">]</span></span>
<span id="cb12-15"><span class="dt" style="color: #AD0000;
background-color: null;
font-style: inherit;">forbidden_modules</span> <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">[</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"agents"</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">]</span></span>
<span id="cb12-16"></span>
<span id="cb12-17"><span class="kw" style="color: #003B4F;
background-color: null;
font-style: inherit;">[[tool.importlinter.contracts]]</span></span>
<span id="cb12-18"><span class="dt" style="color: #AD0000;
background-color: null;
font-style: inherit;">name</span> <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Agent 간 직접 의존 금지"</span></span>
<span id="cb12-19"><span class="dt" style="color: #AD0000;
background-color: null;
font-style: inherit;">type</span> <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"independence"</span></span>
<span id="cb12-20"><span class="dt" style="color: #AD0000;
background-color: null;
font-style: inherit;">modules</span> <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">[</span></span>
<span id="cb12-21">    <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"agents.data_standardization"</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">,</span></span>
<span id="cb12-22">    <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"agents.code_analysis"</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">,</span></span>
<span id="cb12-23">    <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"agents.recommendation"</span></span>
<span id="cb12-24"><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">]</span></span></code></pre></div>
<p><strong>CI에서 검증</strong>:</p>
<div class="sourceCode" id="cb13" style="background: #f1f3f5;"><pre class="sourceCode numberSource yaml number-lines code-with-copy"><code class="sourceCode yaml"><span id="cb13-1"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># .github/workflows/ci.yml</span></span>
<span id="cb13-2"><span class="kw" style="color: #003B4F;
background-color: null;
font-style: inherit;">-</span><span class="at" style="color: #657422;
background-color: null;
font-style: inherit;"> </span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">name</span><span class="kw" style="color: #003B4F;
background-color: null;
font-style: inherit;">:</span><span class="at" style="color: #657422;
background-color: null;
font-style: inherit;"> 의존성 규칙 검증</span></span>
<span id="cb13-3"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">  run</span><span class="kw" style="color: #003B4F;
background-color: null;
font-style: inherit;">: </span><span class="ch" style="color: #20794D;
background-color: null;
font-style: inherit;">|</span></span>
<span id="cb13-4">    pip install import-linter</span>
<span id="cb13-5">    lint-imports</span>
<span id="cb13-6">    </span>
<span id="cb13-7"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># 위반 시 빌드 실패 → 머지 불가</span></span></code></pre></div>
</section>
</section>
<section id="디렉토리-구조-예시" class="level2" data-number="3.2">
<h2 data-number="3.2" class="anchored" data-anchor-id="디렉토리-구조-예시"><span class="header-section-number">3.2</span> 디렉토리 구조 예시</h2>
<section id="최종-구조" class="level3" data-number="3.2.1">
<h3 data-number="3.2.1" class="anchored" data-anchor-id="최종-구조"><span class="header-section-number">3.2.1</span> 최종 구조</h3>
<div class="sourceCode" id="cb14" style="background: #f1f3f5;"><pre class="sourceCode numberSource bash number-lines code-with-copy"><code class="sourceCode bash"><span id="cb14-1"><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">ai-agent-platform/</span></span>
<span id="cb14-2"><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">├──</span> pyproject.toml          <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># 루트 의존성 관리</span></span>
<span id="cb14-3"><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">├──</span> README.md</span>
<span id="cb14-4"><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">├──</span> .github/</span>
<span id="cb14-5"><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">│</span>   └── workflows/</span>
<span id="cb14-6"><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">│</span>       ├── ci.yml          <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># 전체 플랫폼 테스트</span></span>
<span id="cb14-7"><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">│</span>       └── deploy.yml</span>
<span id="cb14-8"><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">│</span></span>
<span id="cb14-9"><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">├──</span> core/                   <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># 변경 빈도: 매우 낮음</span></span>
<span id="cb14-10"><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">│</span>   ├── __init__.py</span>
<span id="cb14-11"><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">│</span>   ├── base_agent.py       <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># BaseAgent 추상 클래스</span></span>
<span id="cb14-12"><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">│</span>   ├── registry.py         <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># AgentRegistry</span></span>
<span id="cb14-13"><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">│</span>   ├── orchestrator.py     <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># Orchestrator</span></span>
<span id="cb14-14"><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">│</span>   └── config.py</span>
<span id="cb14-15"><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">│</span></span>
<span id="cb14-16"><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">├──</span> shared/                 <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># 변경 빈도: 낮음</span></span>
<span id="cb14-17"><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">│</span>   ├── __init__.py</span>
<span id="cb14-18"><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">│</span>   ├── llm/</span>
<span id="cb14-19"><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">│</span>   │   ├── client.py       <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># LLMClient</span></span>
<span id="cb14-20"><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">│</span>   │   ├── cache.py</span>
<span id="cb14-21"><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">│</span>   │   └── retry.py</span>
<span id="cb14-22"><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">│</span>   ├── prompt/</span>
<span id="cb14-23"><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">│</span>   │   ├── registry.py     <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># PromptRegistry</span></span>
<span id="cb14-24"><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">│</span>   │   └── templates/</span>
<span id="cb14-25"><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">│</span>   │       └── base.yaml</span>
<span id="cb14-26"><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">│</span>   ├── vector/</span>
<span id="cb14-27"><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">│</span>   │   ├── manager.py      <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># VectorStoreManager</span></span>
<span id="cb14-28"><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">│</span>   │   └── embeddings.py</span>
<span id="cb14-29"><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">│</span>   └── utils/</span>
<span id="cb14-30"><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">│</span>       ├── logger.py</span>
<span id="cb14-31"><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">│</span>       └── metrics.py</span>
<span id="cb14-32"><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">│</span></span>
<span id="cb14-33"><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">├──</span> agents/                 <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># 변경 빈도: 높음</span></span>
<span id="cb14-34"><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">│</span>   ├── __init__.py</span>
<span id="cb14-35"><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">│</span>   ├── data_standardization/</span>
<span id="cb14-36"><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">│</span>   │   ├── __init__.py</span>
<span id="cb14-37"><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">│</span>   │   ├── agent.py        <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># DataStandardizationAgent</span></span>
<span id="cb14-38"><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">│</span>   │   ├── prompts/</span>
<span id="cb14-39"><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">│</span>   │   │   └── standardize.yaml</span>
<span id="cb14-40"><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">│</span>   │   └── tests/</span>
<span id="cb14-41"><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">│</span>   │       └── test_agent.py</span>
<span id="cb14-42"><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">│</span>   ├── code_analysis/</span>
<span id="cb14-43"><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">│</span>   │   ├── __init__.py</span>
<span id="cb14-44"><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">│</span>   │   ├── agent.py</span>
<span id="cb14-45"><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">│</span>   │   └── tests/</span>
<span id="cb14-46"><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">│</span>   └── recommendation/</span>
<span id="cb14-47"><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">│</span>       ├── __init__.py</span>
<span id="cb14-48"><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">│</span>       ├── agent.py</span>
<span id="cb14-49"><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">│</span>       └── tests/</span>
<span id="cb14-50"><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">│</span></span>
<span id="cb14-51"><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">├──</span> tests/                  <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># 통합 테스트</span></span>
<span id="cb14-52"><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">│</span>   ├── integration/</span>
<span id="cb14-53"><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">│</span>   │   ├── test_chaining.py</span>
<span id="cb14-54"><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">│</span>   │   └── test_orchestrator.py</span>
<span id="cb14-55"><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">│</span>   └── conftest.py</span>
<span id="cb14-56"><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">│</span></span>
<span id="cb14-57"><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">└──</span> docs/</span>
<span id="cb14-58">    <span class="ex" style="color: null;
background-color: null;
font-style: inherit;">├──</span> architecture.md</span>
<span id="cb14-59">    <span class="ex" style="color: null;
background-color: null;
font-style: inherit;">└──</span> agent_development_guide.md</span></code></pre></div>
</section>
<section id="pyproject.toml-예시" class="level3" data-number="3.2.2">
<h3 data-number="3.2.2" class="anchored" data-anchor-id="pyproject.toml-예시"><span class="header-section-number">3.2.2</span> pyproject.toml 예시</h3>
<div class="sourceCode" id="cb15" style="background: #f1f3f5;"><pre class="sourceCode numberSource toml number-lines code-with-copy"><code class="sourceCode toml"><span id="cb15-1"><span class="kw" style="color: #003B4F;
background-color: null;
font-style: inherit;">[tool.poetry]</span></span>
<span id="cb15-2"><span class="dt" style="color: #AD0000;
background-color: null;
font-style: inherit;">name</span> <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"ai-agent-platform"</span></span>
<span id="cb15-3"><span class="dt" style="color: #AD0000;
background-color: null;
font-style: inherit;">version</span> <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"0.1.0"</span></span>
<span id="cb15-4"><span class="dt" style="color: #AD0000;
background-color: null;
font-style: inherit;">description</span> <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"AI Agent 플랫폼"</span></span>
<span id="cb15-5"></span>
<span id="cb15-6"><span class="kw" style="color: #003B4F;
background-color: null;
font-style: inherit;">[tool.poetry.dependencies]</span></span>
<span id="cb15-7"><span class="dt" style="color: #AD0000;
background-color: null;
font-style: inherit;">python</span> <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"^3.11"</span></span>
<span id="cb15-8"><span class="dt" style="color: #AD0000;
background-color: null;
font-style: inherit;">openai</span> <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"^1.0.0"</span></span>
<span id="cb15-9"><span class="dt" style="color: #AD0000;
background-color: null;
font-style: inherit;">langchain</span> <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"^0.1.0"</span></span>
<span id="cb15-10"><span class="dt" style="color: #AD0000;
background-color: null;
font-style: inherit;">pydantic</span> <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"^2.0.0"</span></span>
<span id="cb15-11"><span class="dt" style="color: #AD0000;
background-color: null;
font-style: inherit;">fastapi</span> <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"^0.104.0"</span></span>
<span id="cb15-12"><span class="dt" style="color: #AD0000;
background-color: null;
font-style: inherit;">chromadb</span> <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"^0.4.0"</span></span>
<span id="cb15-13"></span>
<span id="cb15-14"><span class="kw" style="color: #003B4F;
background-color: null;
font-style: inherit;">[tool.poetry.group.dev.dependencies]</span></span>
<span id="cb15-15"><span class="dt" style="color: #AD0000;
background-color: null;
font-style: inherit;">pytest</span> <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"^7.4.0"</span></span>
<span id="cb15-16"><span class="dt" style="color: #AD0000;
background-color: null;
font-style: inherit;">pytest-cov</span> <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"^4.1.0"</span></span>
<span id="cb15-17"><span class="dt" style="color: #AD0000;
background-color: null;
font-style: inherit;">import-linter</span> <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"^1.12.0"</span></span>
<span id="cb15-18"><span class="dt" style="color: #AD0000;
background-color: null;
font-style: inherit;">ruff</span> <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"^0.1.0"</span></span>
<span id="cb15-19"></span>
<span id="cb15-20"><span class="kw" style="color: #003B4F;
background-color: null;
font-style: inherit;">[tool.pytest.ini_options]</span></span>
<span id="cb15-21"><span class="dt" style="color: #AD0000;
background-color: null;
font-style: inherit;">testpaths</span> <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">[</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"tests"</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">,</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"agents/*/tests"</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">]</span></span>
<span id="cb15-22"><span class="dt" style="color: #AD0000;
background-color: null;
font-style: inherit;">python_files</span> <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"test_*.py"</span></span>
<span id="cb15-23"></span>
<span id="cb15-24"><span class="kw" style="color: #003B4F;
background-color: null;
font-style: inherit;">[tool.ruff]</span></span>
<span id="cb15-25"><span class="dt" style="color: #AD0000;
background-color: null;
font-style: inherit;">select</span> <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">[</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"E"</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">,</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"F"</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">,</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"I"</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">]</span>  <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># pycodestyle, pyflakes, isort</span></span>
<span id="cb15-26"><span class="dt" style="color: #AD0000;
background-color: null;
font-style: inherit;">ignore</span> <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">[</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"E501"</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">]</span>  <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># line too long</span></span>
<span id="cb15-27"></span>
<span id="cb15-28"><span class="kw" style="color: #003B4F;
background-color: null;
font-style: inherit;">[tool.importlinter]</span></span>
<span id="cb15-29"><span class="dt" style="color: #AD0000;
background-color: null;
font-style: inherit;">root_package</span> <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"."</span></span></code></pre></div>
</section>
</section>
</section>
<section id="빌드-도구-선택-전략" class="level1" data-number="4">
<h1 data-number="4"><span class="header-section-number">4</span> 빌드 도구 선택 전략</h1>
<section id="단계별-빌드-도구" class="level2" data-number="4.1">
<h2 data-number="4.1" class="anchored" data-anchor-id="단계별-빌드-도구"><span class="header-section-number">4.1</span> 단계별 빌드 도구</h2>
<section id="phase-1-2-poetry로-시작-agent-5개-미만" class="level3" data-number="4.1.1">
<h3 data-number="4.1.1" class="anchored" data-anchor-id="phase-1-2-poetry로-시작-agent-5개-미만"><span class="header-section-number">4.1.1</span> Phase 1-2: Poetry로 시작 (Agent 5개 미만)</h3>
<p><strong>장점</strong>: - 학습 곡선 낮음 - Python 생태계 표준 - 의존성 관리 간단</p>
<p><strong>한계</strong>: - Incremental Build 없음 (전체 테스트 매번 실행) - Agent 20개 넘어가면 느려짐</p>
<div class="sourceCode" id="cb16" style="background: #f1f3f5;"><pre class="sourceCode numberSource toml number-lines code-with-copy"><code class="sourceCode toml"><span id="cb16-1"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># pyproject.toml</span></span>
<span id="cb16-2"><span class="kw" style="color: #003B4F;
background-color: null;
font-style: inherit;">[tool.poetry.scripts]</span></span>
<span id="cb16-3"><span class="dt" style="color: #AD0000;
background-color: null;
font-style: inherit;">test</span> <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"pytest tests/"</span></span>
<span id="cb16-4"><span class="dt" style="color: #AD0000;
background-color: null;
font-style: inherit;">lint</span> <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"ruff check ."</span></span></code></pre></div>
<div class="sourceCode" id="cb17" style="background: #f1f3f5;"><pre class="sourceCode numberSource bash number-lines code-with-copy"><code class="sourceCode bash"><span id="cb17-1"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># 전체 플랫폼 테스트 (Agent 5개일 때 약 30초)</span></span>
<span id="cb17-2"><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">poetry</span> run test</span>
<span id="cb17-3"></span>
<span id="cb17-4"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># Agent 20개 되면 5분 이상 소요</span></span></code></pre></div>
</section>
<section id="phase-3-nx-도입-agent-5-20개" class="level3" data-number="4.1.2">
<h3 data-number="4.1.2" class="anchored" data-anchor-id="phase-3-nx-도입-agent-5-20개"><span class="header-section-number">4.1.2</span> Phase 3: Nx 도입 (Agent 5-20개)</h3>
<p><strong>Nx의 핵심 기능</strong>:</p>
<ol type="1">
<li><strong>Affected 감지</strong>: 변경된 Agent만 테스트</li>
</ol>
<div class="sourceCode" id="cb18" style="background: #f1f3f5;"><pre class="sourceCode numberSource bash number-lines code-with-copy"><code class="sourceCode bash"><span id="cb18-1"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># agents/data_standardization/agent.py 수정 시</span></span>
<span id="cb18-2"><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">nx</span> affected:test</span>
<span id="cb18-3"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># → 해당 Agent + 의존하는 Agent만 테스트 (30초 → 5초)</span></span></code></pre></div>
<ol start="2" type="1">
<li><strong>캐싱</strong>: 이전 빌드 결과 재사용</li>
</ol>
<div class="sourceCode" id="cb19" style="background: #f1f3f5;"><pre class="sourceCode numberSource bash number-lines code-with-copy"><code class="sourceCode bash"><span id="cb19-1"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># 코드 변경 없으면 캐시 사용</span></span>
<span id="cb19-2"><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">nx</span> test data-standardization</span>
<span id="cb19-3"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># → Cache hit (0.1초)</span></span></code></pre></div>
<ol start="3" type="1">
<li><strong>병렬 실행</strong>: 독립적인 Agent 동시 테스트</li>
</ol>
<div class="sourceCode" id="cb20" style="background: #f1f3f5;"><pre class="sourceCode numberSource bash number-lines code-with-copy"><code class="sourceCode bash"><span id="cb20-1"><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">nx</span> run-many <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">--target</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span>test <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">--all</span> <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">--parallel</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span>4</span>
<span id="cb20-2"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># → Agent 20개를 4개씩 병렬로</span></span></code></pre></div>
<p><strong>Nx 설정 예시</strong>:</p>
<div class="sourceCode" id="cb21" style="background: #f1f3f5;"><pre class="sourceCode numberSource json number-lines code-with-copy"><code class="sourceCode json"><span id="cb21-1"><span class="er" style="color: #AD0000;
background-color: null;
font-style: inherit;">//</span> <span class="er" style="color: #AD0000;
background-color: null;
font-style: inherit;">nx.json</span></span>
<span id="cb21-2"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">{</span></span>
<span id="cb21-3">  <span class="dt" style="color: #AD0000;
background-color: null;
font-style: inherit;">"tasksRunnerOptions"</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">:</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">{</span></span>
<span id="cb21-4">    <span class="dt" style="color: #AD0000;
background-color: null;
font-style: inherit;">"default"</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">:</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">{</span></span>
<span id="cb21-5">      <span class="dt" style="color: #AD0000;
background-color: null;
font-style: inherit;">"runner"</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">:</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"nx/tasks-runners/default"</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">,</span></span>
<span id="cb21-6">      <span class="dt" style="color: #AD0000;
background-color: null;
font-style: inherit;">"options"</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">:</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">{</span></span>
<span id="cb21-7">        <span class="dt" style="color: #AD0000;
background-color: null;
font-style: inherit;">"cacheableOperations"</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">:</span> <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">[</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"test"</span><span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">,</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"lint"</span><span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">,</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"build"</span><span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">]</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">,</span></span>
<span id="cb21-8">        <span class="dt" style="color: #AD0000;
background-color: null;
font-style: inherit;">"parallel"</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">:</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">4</span></span>
<span id="cb21-9">      <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">}</span></span>
<span id="cb21-10">    <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">}</span></span>
<span id="cb21-11">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">},</span></span>
<span id="cb21-12">  <span class="dt" style="color: #AD0000;
background-color: null;
font-style: inherit;">"targetDefaults"</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">:</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">{</span></span>
<span id="cb21-13">    <span class="dt" style="color: #AD0000;
background-color: null;
font-style: inherit;">"test"</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">:</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">{</span></span>
<span id="cb21-14">      <span class="dt" style="color: #AD0000;
background-color: null;
font-style: inherit;">"cache"</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">:</span> <span class="kw" style="color: #003B4F;
background-color: null;
font-style: inherit;">true</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">,</span></span>
<span id="cb21-15">      <span class="dt" style="color: #AD0000;
background-color: null;
font-style: inherit;">"inputs"</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">:</span> <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">[</span></span>
<span id="cb21-16">        <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"{projectRoot}/**/*.py"</span><span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">,</span></span>
<span id="cb21-17">        <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"{projectRoot}/**/test_*.py"</span></span>
<span id="cb21-18">      <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">]</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">,</span></span>
<span id="cb21-19">      <span class="dt" style="color: #AD0000;
background-color: null;
font-style: inherit;">"outputs"</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">:</span> <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">[</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"{projectRoot}/coverage"</span><span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">]</span></span>
<span id="cb21-20">    <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">}</span></span>
<span id="cb21-21">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">}</span></span>
<span id="cb21-22"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">}</span></span></code></pre></div>
<div class="sourceCode" id="cb22" style="background: #f1f3f5;"><pre class="sourceCode numberSource json number-lines code-with-copy"><code class="sourceCode json"><span id="cb22-1"><span class="er" style="color: #AD0000;
background-color: null;
font-style: inherit;">//</span> <span class="er" style="color: #AD0000;
background-color: null;
font-style: inherit;">agents/data_standardization/project.json</span></span>
<span id="cb22-2"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">{</span></span>
<span id="cb22-3">  <span class="dt" style="color: #AD0000;
background-color: null;
font-style: inherit;">"name"</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">:</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"data-standardization"</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">,</span></span>
<span id="cb22-4">  <span class="dt" style="color: #AD0000;
background-color: null;
font-style: inherit;">"targets"</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">:</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">{</span></span>
<span id="cb22-5">    <span class="dt" style="color: #AD0000;
background-color: null;
font-style: inherit;">"test"</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">:</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">{</span></span>
<span id="cb22-6">      <span class="dt" style="color: #AD0000;
background-color: null;
font-style: inherit;">"executor"</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">:</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"nx:run-commands"</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">,</span></span>
<span id="cb22-7">      <span class="dt" style="color: #AD0000;
background-color: null;
font-style: inherit;">"options"</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">:</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">{</span></span>
<span id="cb22-8">        <span class="dt" style="color: #AD0000;
background-color: null;
font-style: inherit;">"command"</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">:</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"pytest agents/data_standardization/tests"</span></span>
<span id="cb22-9">      <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">}</span></span>
<span id="cb22-10">    <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">}</span></span>
<span id="cb22-11">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">},</span></span>
<span id="cb22-12">  <span class="dt" style="color: #AD0000;
background-color: null;
font-style: inherit;">"implicitDependencies"</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">:</span> <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">[</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"shared-llm"</span><span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">,</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"core"</span><span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">]</span></span>
<span id="cb22-13"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">}</span></span></code></pre></div>
</section>
<section id="phase-4-bazel-고려-agent-20개-이상" class="level3" data-number="4.1.3">
<h3 data-number="4.1.3" class="anchored" data-anchor-id="phase-4-bazel-고려-agent-20개-이상"><span class="header-section-number">4.1.3</span> Phase 4: Bazel 고려 (Agent 20개 이상)</h3>
<p><strong>Bazel의 강점</strong> (Google이 선택한 이유): - <strong>정확한 의존성 그래프</strong>: 파일 단위 추적 - <strong>원격 캐싱</strong>: 팀 전체가 빌드 캐시 공유 - <strong>대규모 확장성</strong>: Agent 100개 이상도 관리 가능</p>
<p><strong>트레이드오프</strong>: - 초기 설정 복잡 (BUILD 파일 작성) - Python 전문성 + Bazel 전문성 모두 필요 - Agent 20개 미만이면 과도한 투자</p>
</section>
</section>
<section id="빌드-도구-선택-기준" class="level2" data-number="4.2">
<h2 data-number="4.2" class="anchored" data-anchor-id="빌드-도구-선택-기준"><span class="header-section-number">4.2</span> 빌드 도구 선택 기준</h2>
<table class="table">
<thead>
<tr class="header">
<th>상황</th>
<th>권장 도구</th>
<th>이유</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td>Agent 5개 미만</td>
<td>Poetry</td>
<td>간단, 빠른 시작</td>
</tr>
<tr class="even">
<td>Agent 5-20개</td>
<td>Poetry + Nx</td>
<td>Incremental Build로 속도 개선</td>
</tr>
<tr class="odd">
<td>Agent 20개 이상</td>
<td>Nx (또는 Bazel)</td>
<td>대규모 코드베이스 최적화</td>
</tr>
<tr class="even">
<td>여러 언어 혼합 (Python+TS)</td>
<td>Nx</td>
<td>멀티 언어 지원</td>
</tr>
<tr class="odd">
<td>엄격한 재현성 필요</td>
<td>Bazel</td>
<td>Hermetic Build</td>
</tr>
</tbody>
</table>
</section>
</section>
<section id="의존성-관리-모범-사례" class="level1" data-number="5">
<h1 data-number="5"><span class="header-section-number">5</span> 의존성 관리 모범 사례</h1>
<section id="workspace-수준-의존성" class="level2" data-number="5.1">
<h2 data-number="5.1" class="anchored" data-anchor-id="workspace-수준-의존성"><span class="header-section-number">5.1</span> Workspace 수준 의존성</h2>
<div class="sourceCode" id="cb23" style="background: #f1f3f5;"><pre class="sourceCode numberSource toml number-lines code-with-copy"><code class="sourceCode toml"><span id="cb23-1"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># pyproject.toml (루트)</span></span>
<span id="cb23-2"><span class="kw" style="color: #003B4F;
background-color: null;
font-style: inherit;">[tool.poetry.dependencies]</span></span>
<span id="cb23-3"><span class="dt" style="color: #AD0000;
background-color: null;
font-style: inherit;">python</span> <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"^3.11"</span></span>
<span id="cb23-4"><span class="dt" style="color: #AD0000;
background-color: null;
font-style: inherit;">openai</span> <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"^1.0.0"</span>      <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># 모든 Agent 공통</span></span>
<span id="cb23-5"><span class="dt" style="color: #AD0000;
background-color: null;
font-style: inherit;">langchain</span> <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"^0.1.0"</span></span>
<span id="cb23-6"><span class="dt" style="color: #AD0000;
background-color: null;
font-style: inherit;">pydantic</span> <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"^2.0.0"</span></span>
<span id="cb23-7"></span>
<span id="cb23-8"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># Agent별 추가 의존성은 최소화</span></span>
<span id="cb23-9"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># (정말 해당 Agent만 쓰는 경우만 허용)</span></span></code></pre></div>
<p><strong>원칙</strong>: “모든 Agent가 같은 버전의 openai 사용”</p>
</section>
<section id="버전-고정-전략" class="level2" data-number="5.2">
<h2 data-number="5.2" class="anchored" data-anchor-id="버전-고정-전략"><span class="header-section-number">5.2</span> 버전 고정 전략</h2>
<div class="sourceCode" id="cb24" style="background: #f1f3f5;"><pre class="sourceCode numberSource toml number-lines code-with-copy"><code class="sourceCode toml"><span id="cb24-1"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># 개발 시: 범위 지정 (자동 업데이트 허용)</span></span>
<span id="cb24-2"><span class="dt" style="color: #AD0000;
background-color: null;
font-style: inherit;">openai</span> <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"^1.0.0"</span>  <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># 1.0.0 이상, 2.0.0 미만</span></span>
<span id="cb24-3"></span>
<span id="cb24-4"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># 프로덕션 배포 시: 정확한 버전 (poetry.lock)</span></span>
<span id="cb24-5"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># poetry.lock 파일을 Git에 커밋</span></span>
<span id="cb24-6"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># → 모든 팀원이 동일한 환경</span></span></code></pre></div>
<p><strong>CI에서 검증</strong>:</p>
<div class="sourceCode" id="cb25" style="background: #f1f3f5;"><pre class="sourceCode numberSource yaml number-lines code-with-copy"><code class="sourceCode yaml"><span id="cb25-1"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># .github/workflows/ci.yml</span></span>
<span id="cb25-2"><span class="kw" style="color: #003B4F;
background-color: null;
font-style: inherit;">-</span><span class="at" style="color: #657422;
background-color: null;
font-style: inherit;"> </span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">name</span><span class="kw" style="color: #003B4F;
background-color: null;
font-style: inherit;">:</span><span class="at" style="color: #657422;
background-color: null;
font-style: inherit;"> 의존성 일관성 검증</span></span>
<span id="cb25-3"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">  run</span><span class="kw" style="color: #003B4F;
background-color: null;
font-style: inherit;">: </span><span class="ch" style="color: #20794D;
background-color: null;
font-style: inherit;">|</span></span>
<span id="cb25-4">    poetry check</span>
<span id="cb25-5">    poetry lock --check</span></code></pre></div>
</section>
<section id="의존성-업데이트-전략" class="level2" data-number="5.3">
<h2 data-number="5.3" class="anchored" data-anchor-id="의존성-업데이트-전략"><span class="header-section-number">5.3</span> 의존성 업데이트 전략</h2>
<div class="sourceCode" id="cb26" style="background: #f1f3f5;"><pre class="sourceCode numberSource bash number-lines code-with-copy"><code class="sourceCode bash"><span id="cb26-1"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># 매주 자동 PR (Dependabot)</span></span>
<span id="cb26-2"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># 1. openai 1.0.5 → 1.1.0 업데이트</span></span>
<span id="cb26-3"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># 2. 전체 플랫폼 테스트 실행</span></span>
<span id="cb26-4"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># 3. 성공 시 자동 머지</span></span>
<span id="cb26-5"></span>
<span id="cb26-6"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># 실패 시:</span></span>
<span id="cb26-7"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># → 어떤 Agent가 깨졌는지 로그 확인</span></span>
<span id="cb26-8"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># → 해당 Agent 수정 후 재시도</span></span></code></pre></div>
</section>
</section>
<section id="실전-예시-phase-3-phase-4-마이그레이션" class="level1" data-number="6">
<h1 data-number="6"><span class="header-section-number">6</span> 실전 예시: Phase 3 → Phase 4 마이그레이션</h1>
<section id="상황" class="level2" data-number="6.1">
<h2 data-number="6.1" class="anchored" data-anchor-id="상황"><span class="header-section-number">6.1</span> 상황</h2>
<pre><code>Phase 3:
- Agent 3개 (data_standardization, code_analysis, recommendation)
- 각각 별도 Python 스크립트
- 공통 코드 복사-붙여넣기

Phase 4 목표:
- Monorepo로 통합
- BaseAgent 인터페이스 도입
- 공통 모듈 재사용</code></pre>
</section>
<section id="마이그레이션-단계" class="level2" data-number="6.2">
<h2 data-number="6.2" class="anchored" data-anchor-id="마이그레이션-단계"><span class="header-section-number">6.2</span> 마이그레이션 단계</h2>
<section id="단계-monorepo-생성" class="level3" data-number="6.2.1">
<h3 data-number="6.2.1" class="anchored" data-anchor-id="단계-monorepo-생성"><span class="header-section-number">6.2.1</span> 1단계: Monorepo 생성</h3>
<div class="sourceCode" id="cb28" style="background: #f1f3f5;"><pre class="sourceCode numberSource bash number-lines code-with-copy"><code class="sourceCode bash"><span id="cb28-1"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># 새 저장소 생성</span></span>
<span id="cb28-2"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">mkdir</span> ai-agent-platform</span>
<span id="cb28-3"><span class="bu" style="color: null;
background-color: null;
font-style: inherit;">cd</span> ai-agent-platform</span>
<span id="cb28-4"><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">poetry</span> init</span>
<span id="cb28-5"></span>
<span id="cb28-6"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># 디렉토리 구조 생성</span></span>
<span id="cb28-7"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">mkdir</span> <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">-p</span> core shared agents tests</span></code></pre></div>
</section>
<section id="단계-공통-코드-추출" class="level3" data-number="6.2.2">
<h3 data-number="6.2.2" class="anchored" data-anchor-id="단계-공통-코드-추출"><span class="header-section-number">6.2.2</span> 2단계: 공통 코드 추출</h3>
<div class="sourceCode" id="cb29" style="background: #f1f3f5;"><pre class="sourceCode numberSource python number-lines code-with-copy"><code class="sourceCode python"><span id="cb29-1"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># 기존 POC 코드에서 중복 발견</span></span>
<span id="cb29-2"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># data_standardization.py</span></span>
<span id="cb29-3">client <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> OpenAI(api_key<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span>os.getenv(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"OPENAI_API_KEY"</span>))</span>
<span id="cb29-4">response <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> client.chat.completions.create(...)</span>
<span id="cb29-5"></span>
<span id="cb29-6"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># code_analysis.py</span></span>
<span id="cb29-7">client <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> OpenAI(api_key<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span>os.getenv(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"OPENAI_API_KEY"</span>))  <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># 중복!</span></span>
<span id="cb29-8">response <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> client.chat.completions.create(...)</span>
<span id="cb29-9"></span>
<span id="cb29-10"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># shared/llm/client.py로 추출</span></span>
<span id="cb29-11"><span class="kw" style="color: #003B4F;
background-color: null;
font-style: inherit;">class</span> LLMClient:</span>
<span id="cb29-12">    <span class="kw" style="color: #003B4F;
background-color: null;
font-style: inherit;">def</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">__init__</span>(<span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">self</span>):</span>
<span id="cb29-13">        <span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">self</span>.client <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> OpenAI(api_key<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span>os.getenv(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"OPENAI_API_KEY"</span>))</span>
<span id="cb29-14">    </span>
<span id="cb29-15">    <span class="kw" style="color: #003B4F;
background-color: null;
font-style: inherit;">def</span> generate(<span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">self</span>, prompt: <span class="bu" style="color: null;
background-color: null;
font-style: inherit;">str</span>) <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">-&gt;</span> <span class="bu" style="color: null;
background-color: null;
font-style: inherit;">str</span>:</span>
<span id="cb29-16">        response <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> <span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">self</span>.client.chat.completions.create(</span>
<span id="cb29-17">            model<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"gpt-4"</span>,</span>
<span id="cb29-18">            messages<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span>[{<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"role"</span>: <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"user"</span>, <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"content"</span>: prompt}]</span>
<span id="cb29-19">        )</span>
<span id="cb29-20">        <span class="cf" style="color: #003B4F;
background-color: null;
font-style: inherit;">return</span> response.choices[<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">0</span>].message.content</span></code></pre></div>
</section>
<section id="단계-agent-마이그레이션" class="level3" data-number="6.2.3">
<h3 data-number="6.2.3" class="anchored" data-anchor-id="단계-agent-마이그레이션"><span class="header-section-number">6.2.3</span> 3단계: Agent 마이그레이션</h3>
<div class="sourceCode" id="cb30" style="background: #f1f3f5;"><pre class="sourceCode numberSource python number-lines code-with-copy"><code class="sourceCode python"><span id="cb30-1"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># agents/data_standardization/agent.py</span></span>
<span id="cb30-2"><span class="im" style="color: #00769E;
background-color: null;
font-style: inherit;">from</span> core.base_agent <span class="im" style="color: #00769E;
background-color: null;
font-style: inherit;">import</span> BaseAgent</span>
<span id="cb30-3"><span class="im" style="color: #00769E;
background-color: null;
font-style: inherit;">from</span> shared.llm.client <span class="im" style="color: #00769E;
background-color: null;
font-style: inherit;">import</span> LLMClient</span>
<span id="cb30-4"></span>
<span id="cb30-5"><span class="kw" style="color: #003B4F;
background-color: null;
font-style: inherit;">class</span> DataStandardizationAgent(BaseAgent):</span>
<span id="cb30-6">    <span class="kw" style="color: #003B4F;
background-color: null;
font-style: inherit;">def</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">__init__</span>(<span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">self</span>):</span>
<span id="cb30-7">        <span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">self</span>.llm <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> LLMClient()  <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># 공통 모듈 재사용</span></span>
<span id="cb30-8">    </span>
<span id="cb30-9">    <span class="kw" style="color: #003B4F;
background-color: null;
font-style: inherit;">def</span> process(<span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">self</span>, data: Dict) <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">-&gt;</span> Dict:</span>
<span id="cb30-10">        prompt <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> <span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">self</span>._build_prompt(data)</span>
<span id="cb30-11">        result <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> <span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">self</span>.llm.generate(prompt)</span>
<span id="cb30-12">        <span class="cf" style="color: #003B4F;
background-color: null;
font-style: inherit;">return</span> {<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"standardized"</span>: result}</span></code></pre></div>
</section>
<section id="단계-테스트-추가" class="level3" data-number="6.2.4">
<h3 data-number="6.2.4" class="anchored" data-anchor-id="단계-테스트-추가"><span class="header-section-number">6.2.4</span> 4단계: 테스트 추가</h3>
<div class="sourceCode" id="cb31" style="background: #f1f3f5;"><pre class="sourceCode numberSource python number-lines code-with-copy"><code class="sourceCode python"><span id="cb31-1"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># agents/data_standardization/tests/test_agent.py</span></span>
<span id="cb31-2"><span class="im" style="color: #00769E;
background-color: null;
font-style: inherit;">import</span> pytest</span>
<span id="cb31-3"><span class="im" style="color: #00769E;
background-color: null;
font-style: inherit;">from</span> agents.data_standardization.agent <span class="im" style="color: #00769E;
background-color: null;
font-style: inherit;">import</span> DataStandardizationAgent</span>
<span id="cb31-4"></span>
<span id="cb31-5"><span class="kw" style="color: #003B4F;
background-color: null;
font-style: inherit;">def</span> test_standardization():</span>
<span id="cb31-6">    agent <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> DataStandardizationAgent()</span>
<span id="cb31-7">    result <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> agent.process({<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"value"</span>: <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"100mg"</span>})</span>
<span id="cb31-8">    <span class="cf" style="color: #003B4F;
background-color: null;
font-style: inherit;">assert</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"standardized"</span> <span class="kw" style="color: #003B4F;
background-color: null;
font-style: inherit;">in</span> result</span>
<span id="cb31-9"></span>
<span id="cb31-10"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># 통합 테스트</span></span>
<span id="cb31-11"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># tests/integration/test_chaining.py</span></span>
<span id="cb31-12"><span class="kw" style="color: #003B4F;
background-color: null;
font-style: inherit;">def</span> test_agent_chaining():</span>
<span id="cb31-13">    data_agent <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> DataStandardizationAgent()</span>
<span id="cb31-14">    code_agent <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> CodeAnalysisAgent()</span>
<span id="cb31-15">    </span>
<span id="cb31-16">    step1 <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> data_agent.process({<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"value"</span>: <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"100mg"</span>})</span>
<span id="cb31-17">    step2 <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> code_agent.process(step1)</span>
<span id="cb31-18">    </span>
<span id="cb31-19">    <span class="cf" style="color: #003B4F;
background-color: null;
font-style: inherit;">assert</span> step2[<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"status"</span>] <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">==</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"success"</span></span></code></pre></div>
</section>
<section id="단계-ci-설정" class="level3" data-number="6.2.5">
<h3 data-number="6.2.5" class="anchored" data-anchor-id="단계-ci-설정"><span class="header-section-number">6.2.5</span> 5단계: CI 설정</h3>
<div class="sourceCode" id="cb32" style="background: #f1f3f5;"><pre class="sourceCode numberSource yaml number-lines code-with-copy"><code class="sourceCode yaml"><span id="cb32-1"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># .github/workflows/ci.yml</span></span>
<span id="cb32-2"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">name</span><span class="kw" style="color: #003B4F;
background-color: null;
font-style: inherit;">:</span><span class="at" style="color: #657422;
background-color: null;
font-style: inherit;"> CI</span></span>
<span id="cb32-3"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">on</span><span class="kw" style="color: #003B4F;
background-color: null;
font-style: inherit;">:</span><span class="at" style="color: #657422;
background-color: null;
font-style: inherit;"> </span><span class="kw" style="color: #003B4F;
background-color: null;
font-style: inherit;">[</span><span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">push</span><span class="kw" style="color: #003B4F;
background-color: null;
font-style: inherit;">,</span><span class="at" style="color: #657422;
background-color: null;
font-style: inherit;"> pull_request</span><span class="kw" style="color: #003B4F;
background-color: null;
font-style: inherit;">]</span></span>
<span id="cb32-4"></span>
<span id="cb32-5"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">jobs</span><span class="kw" style="color: #003B4F;
background-color: null;
font-style: inherit;">:</span></span>
<span id="cb32-6"><span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">  </span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">test</span><span class="kw" style="color: #003B4F;
background-color: null;
font-style: inherit;">:</span></span>
<span id="cb32-7"><span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">    </span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">runs-on</span><span class="kw" style="color: #003B4F;
background-color: null;
font-style: inherit;">:</span><span class="at" style="color: #657422;
background-color: null;
font-style: inherit;"> ubuntu-latest</span></span>
<span id="cb32-8"><span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">    </span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">steps</span><span class="kw" style="color: #003B4F;
background-color: null;
font-style: inherit;">:</span></span>
<span id="cb32-9"><span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">      </span><span class="kw" style="color: #003B4F;
background-color: null;
font-style: inherit;">-</span><span class="at" style="color: #657422;
background-color: null;
font-style: inherit;"> </span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">uses</span><span class="kw" style="color: #003B4F;
background-color: null;
font-style: inherit;">:</span><span class="at" style="color: #657422;
background-color: null;
font-style: inherit;"> actions/checkout@v3</span></span>
<span id="cb32-10"><span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">      </span><span class="kw" style="color: #003B4F;
background-color: null;
font-style: inherit;">-</span><span class="at" style="color: #657422;
background-color: null;
font-style: inherit;"> </span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">uses</span><span class="kw" style="color: #003B4F;
background-color: null;
font-style: inherit;">:</span><span class="at" style="color: #657422;
background-color: null;
font-style: inherit;"> actions/setup-python@v4</span></span>
<span id="cb32-11"><span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">        </span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">with</span><span class="kw" style="color: #003B4F;
background-color: null;
font-style: inherit;">:</span></span>
<span id="cb32-12"><span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">          </span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">python-version</span><span class="kw" style="color: #003B4F;
background-color: null;
font-style: inherit;">:</span><span class="at" style="color: #657422;
background-color: null;
font-style: inherit;"> </span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">'3.11'</span></span>
<span id="cb32-13"><span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">      </span></span>
<span id="cb32-14"><span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">      </span><span class="kw" style="color: #003B4F;
background-color: null;
font-style: inherit;">-</span><span class="at" style="color: #657422;
background-color: null;
font-style: inherit;"> </span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">name</span><span class="kw" style="color: #003B4F;
background-color: null;
font-style: inherit;">:</span><span class="at" style="color: #657422;
background-color: null;
font-style: inherit;"> Install dependencies</span></span>
<span id="cb32-15"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">        run</span><span class="kw" style="color: #003B4F;
background-color: null;
font-style: inherit;">: </span><span class="ch" style="color: #20794D;
background-color: null;
font-style: inherit;">|</span></span>
<span id="cb32-16">          pip install poetry</span>
<span id="cb32-17">          poetry install</span>
<span id="cb32-18"><span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">      </span></span>
<span id="cb32-19"><span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">      </span><span class="kw" style="color: #003B4F;
background-color: null;
font-style: inherit;">-</span><span class="at" style="color: #657422;
background-color: null;
font-style: inherit;"> </span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">name</span><span class="kw" style="color: #003B4F;
background-color: null;
font-style: inherit;">:</span><span class="at" style="color: #657422;
background-color: null;
font-style: inherit;"> Run tests</span></span>
<span id="cb32-20"><span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">        </span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">run</span><span class="kw" style="color: #003B4F;
background-color: null;
font-style: inherit;">:</span><span class="at" style="color: #657422;
background-color: null;
font-style: inherit;"> poetry run pytest tests/ agents/*/tests/</span></span>
<span id="cb32-21"><span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">      </span></span>
<span id="cb32-22"><span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">      </span><span class="kw" style="color: #003B4F;
background-color: null;
font-style: inherit;">-</span><span class="at" style="color: #657422;
background-color: null;
font-style: inherit;"> </span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">name</span><span class="kw" style="color: #003B4F;
background-color: null;
font-style: inherit;">:</span><span class="at" style="color: #657422;
background-color: null;
font-style: inherit;"> Check import rules</span></span>
<span id="cb32-23"><span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">        </span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">run</span><span class="kw" style="color: #003B4F;
background-color: null;
font-style: inherit;">:</span><span class="at" style="color: #657422;
background-color: null;
font-style: inherit;"> poetry run lint-imports</span></span></code></pre></div>
</section>
</section>
<section id="마이그레이션-결과" class="level2" data-number="6.3">
<h2 data-number="6.3" class="anchored" data-anchor-id="마이그레이션-결과"><span class="header-section-number">6.3</span> 마이그레이션 결과</h2>
<p><strong>Before (Phase 3)</strong>: - 3개 Python 스크립트 - 중복 코드: 약 200 lines - 통합 테스트 없음</p>
<p><strong>After (Phase 4)</strong>: - Monorepo 구조 - 중복 제거: shared/ 모듈로 통합 - 통합 테스트 + CI 자동화 - 새 Agent 추가 시간: 3일 → 4시간</p>
</section>
</section>
<section id="핵심-결정-사항-요약" class="level1" data-number="7">
<h1 data-number="7"><span class="header-section-number">7</span> 핵심 결정 사항 요약</h1>
<section id="monorepo-선택-이유" class="level2" data-number="7.1">
<h2 data-number="7.1" class="anchored" data-anchor-id="monorepo-선택-이유"><span class="header-section-number">7.1</span> Monorepo 선택 이유</h2>
<ol type="1">
<li><strong>의존성 단순화</strong>: 모든 Agent가 동일한 openai 버전 사용</li>
<li><strong>원자적 변경</strong>: 하나의 PR로 LLMClient + 모든 Agent 업데이트</li>
<li><strong>리팩토링 안전성</strong>: IDE가 전체 플랫폼에서 사용처 찾아줌</li>
<li><strong>통합 테스트</strong>: Agent A + Agent B 체이닝 쉽게 테스트</li>
</ol>
</section>
<section id="모듈-분리-원칙" class="level2" data-number="7.2">
<h2 data-number="7.2" class="anchored" data-anchor-id="모듈-분리-원칙"><span class="header-section-number">7.2</span> 모듈 분리 원칙</h2>
<ul>
<li><strong>core/</strong>: BaseAgent, Orchestrator (변경 빈도 낮음)</li>
<li><strong>shared/</strong>: LLMClient, PromptRegistry (재사용 많음)</li>
<li><strong>agents/</strong>: 개별 Agent (변경 빈도 높음)</li>
</ul>
</section>
<section id="의존성-규칙" class="level2" data-number="7.3">
<h2 data-number="7.3" class="anchored" data-anchor-id="의존성-규칙"><span class="header-section-number">7.3</span> 의존성 규칙</h2>
<div class="sourceCode" id="cb33" style="background: #f1f3f5;"><pre class="sourceCode numberSource python number-lines code-with-copy"><code class="sourceCode python"><span id="cb33-1">✅ agents → shared → core</span>
<span id="cb33-2">❌ core → agents</span>
<span id="cb33-3">❌ agents.A → agents.B</span></code></pre></div>
</section>
<section id="빌드-도구-로드맵" class="level2" data-number="7.4">
<h2 data-number="7.4" class="anchored" data-anchor-id="빌드-도구-로드맵"><span class="header-section-number">7.4</span> 빌드 도구 로드맵</h2>
<ol type="1">
<li><strong>Agent 5개 미만</strong>: Poetry</li>
<li><strong>Agent 5-20개</strong>: Poetry + Nx</li>
<li><strong>Agent 20개 이상</strong>: Nx (또는 Bazel)</li>
</ol>
</section>
<section id="다음-단계" class="level2" data-number="7.5">
<h2 data-number="7.5" class="anchored" data-anchor-id="다음-단계"><span class="header-section-number">7.5</span> 다음 단계</h2>
<p>이 글에서 저장소 구조를 설계했다. 다음 글에서는:</p>
<ul>
<li><strong>4번 글</strong>: BaseAgent 인터페이스 설계 (Template Method Pattern)</li>
<li><strong>5번 글</strong>: 데이터 표준화 계층 (프롬프트, 벡터 데이터 관리)</li>
<li><strong>6번 글</strong>: 플랫폼 운영 (CI/CD, 모니터링, 배포 전략)</li>
</ul>
</section>
<section id="참고문헌" class="level2" data-number="7.6">
<h2 data-number="7.6" class="anchored" data-anchor-id="참고문헌"><span class="header-section-number">7.6</span> 참고문헌</h2>
<p><strong>Software Architecture</strong>: - Martin, R. C. (2017). “Clean Architecture.” Prentice Hall. - Richards, M., &amp; Ford, N. (2020). “Fundamentals of Software Architecture.” O’Reilly.</p>
<p><strong>Monorepo</strong>: - Potvin, R., &amp; Levenberg, J. (2016). “Why Google Stores Billions of Lines of Code in a Single Repository.” ACM Queue.</p>
<p><strong>Platform Engineering</strong>: - Newman, S. (2021). “Building Microservices.” O’Reilly. - Kim, G., et al.&nbsp;(2016). “The DevOps Handbook.” IT Revolution Press.</p>


</section>
</section>

 ]]></description>
  <category>Software Architecture</category>
  <category>Platform Engineering</category>
  <category>Agent</category>
  <category>Monorepo</category>
  <guid>kk3225.netlify.app/docs/blog/posts/Engineering/System/Archi_Design/platform/3.agent_platform_repo_strategy.html</guid>
  <pubDate>Tue, 27 Jan 2026 15:00:00 GMT</pubDate>
</item>
<item>
  <title>AI Agent 플랫폼 설계의 5대 원칙과 점진적 추상화 전략</title>
  <dc:creator>Kwangmin Kim</dc:creator>
  <link>kk3225.netlify.app/docs/blog/posts/Engineering/System/Archi_Design/platform/2.agent_platform_design_strategy.html</link>
  <description><![CDATA[ 





<section id="들어가며-추상화는-발견하는-것이지-발명하는-것이-아니다" class="level2" data-number="1">
<h2 data-number="1" class="anchored" data-anchor-id="들어가며-추상화는-발견하는-것이지-발명하는-것이-아니다"><span class="header-section-number">1</span> 들어가며: 추상화는 발견하는 것이지, 발명하는 것이 아니다</h2>
<p>ChatGPT, Claude AI 같은 GenAI 서비스가 도입되면서 AI Agent 개발의 문턱이 낮아졌다. Data Scientist, Product Manager, 도메인 전문가까지 Agent를 직접 만들 수 있게 되었고, 각 조직마다 특화된 Agent들이 우후죽순 양산되고 있다.</p>
<p>문제는 이 Agent들 대부분이 LLM이 생성한 블랙박스 코드라는 점이다. 이해하기 어렵고, 일관성도 없으며, 유지보수는 사람의 몫으로 남는다. 결국 “표준화된 형태로 Agent를 찍어낼 플랫폼”이 필요해진다.</p>
<p>이때 많은 개발자가 직면하는 질문이 있다.</p>
<blockquote class="blockquote">
<p>“Agent들이 계속 양산될 텐데, BaseAgent 같은 추상 클래스를 미리 설계해서 표준을 만들 수 있지 않을까?”</p>
</blockquote>
<p>언뜻 합리적으로 들린다. 하지만 AI Agent는 새로운 기술이고, 당신에게 백엔드 플랫폼 설계 경험이 없다면?</p>
<p><strong>답은 명확하다. 추상화를 먼저 시도하는 것은 위험하다.</strong></p>
<p>Martin Fowler는 “Refactoring to Patterns”에서 이렇게 말한다:</p>
<blockquote class="blockquote">
<p>“추상화는 발견하는 것이지(discovered), 발명하는 것이 아니다(invented)”</p>
</blockquote>
<p>이 글에서는 두 가지 핵심 주제를 다룬다:</p>
<ol type="1">
<li><strong>플랫폼 설계의 5대 원칙</strong> (왜 추상화가 필요한가)</li>
<li><strong>점진적 추상화 전략</strong> (어떻게 안전하게 추상화하는가)</li>
</ol>
<p>글쓴이는 Data Scientist로서 이 여정을 직접 경험했고, 여러 AI 서비스(Claude, ChatGPT, Gemini)와의 대화를 통해 얻은 인사이트를 종합하여 글쓴이의 관점으로 재작성하여 그 해결 전략을 제시한다.</p>
</section>
<section id="플랫폼-설계의-5대-원칙" class="level2" data-number="2">
<h2 data-number="2" class="anchored" data-anchor-id="플랫폼-설계의-5대-원칙"><span class="header-section-number">2</span> 플랫폼 설계의 5대 원칙</h2>
<p>AI Agent 플랫폼이 왜 추상화를 필요로 하는지, 그 설계 원칙부터 이해해야 한다.</p>
<section id="principle-1-interface-segregation-인터페이스-분리" class="level3" data-number="2.1">
<h3 data-number="2.1" class="anchored" data-anchor-id="principle-1-interface-segregation-인터페이스-분리"><span class="header-section-number">2.1</span> Principle 1: Interface Segregation (인터페이스 분리)</h3>
<blockquote class="blockquote">
<p><strong>원칙</strong>: “플랫폼은 구체적 구현이 아닌 추상적 계약(Contract)을 통해 Agent를 관리한다”</p>
</blockquote>
<section id="문제-상황-추상화-없이-agent를-만들면" class="level4" data-number="2.1.1">
<h4 data-number="2.1.1" class="anchored" data-anchor-id="문제-상황-추상화-없이-agent를-만들면"><span class="header-section-number">2.1.1</span> 문제 상황: 추상화 없이 Agent를 만들면</h4>
<div class="sourceCode" id="cb1" style="background: #f1f3f5;"><pre class="sourceCode numberSource python number-lines code-with-copy"><code class="sourceCode python"><span id="cb1-1"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># ❌ 추상화 없는 Agent 구현</span></span>
<span id="cb1-2"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># agents/data_standardization/main.py</span></span>
<span id="cb1-3"><span class="kw" style="color: #003B4F;
background-color: null;
font-style: inherit;">def</span> run_data_standardization(data):</span>
<span id="cb1-4">    result <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> some_custom_logic(data)</span>
<span id="cb1-5">    <span class="cf" style="color: #003B4F;
background-color: null;
font-style: inherit;">return</span> result</span>
<span id="cb1-6"></span>
<span id="cb1-7"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># agents/code_analysis/main.py  </span></span>
<span id="cb1-8"><span class="kw" style="color: #003B4F;
background-color: null;
font-style: inherit;">def</span> analyze_code(code):</span>
<span id="cb1-9">    output <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> different_logic(code)</span>
<span id="cb1-10">    <span class="cf" style="color: #003B4F;
background-color: null;
font-style: inherit;">return</span> output</span>
<span id="cb1-11"></span>
<span id="cb1-12"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># agents/knowledge_qna/main.py</span></span>
<span id="cb1-13"><span class="kw" style="color: #003B4F;
background-color: null;
font-style: inherit;">def</span> answer_question(query):</span>
<span id="cb1-14">    response <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> yet_another_logic(query)</span>
<span id="cb1-15">    <span class="cf" style="color: #003B4F;
background-color: null;
font-style: inherit;">return</span> response</span></code></pre></div>
<p><strong>발생하는 문제</strong>:</p>
<ol type="1">
<li><strong>플랫폼이 Agent를 통일된 방식으로 호출할 수 없음</strong></li>
</ol>
<div class="sourceCode" id="cb2" style="background: #f1f3f5;"><pre class="sourceCode numberSource python number-lines code-with-copy"><code class="sourceCode python"><span id="cb2-1"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># platform-api에서 Agent 호출 시도</span></span>
<span id="cb2-2"><span class="cf" style="color: #003B4F;
background-color: null;
font-style: inherit;">if</span> agent_type <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">==</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"data_standardization"</span>:</span>
<span id="cb2-3">    result <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> run_data_standardization(input_data)</span>
<span id="cb2-4"><span class="cf" style="color: #003B4F;
background-color: null;
font-style: inherit;">elif</span> agent_type <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">==</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"code_analysis"</span>:</span>
<span id="cb2-5">    result <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> analyze_code(input_data)  <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># 완전히 다른 인터페이스</span></span>
<span id="cb2-6"><span class="cf" style="color: #003B4F;
background-color: null;
font-style: inherit;">elif</span> agent_type <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">==</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"knowledge_qna"</span>:</span>
<span id="cb2-7">    result <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> answer_question(input_data)  <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># 또 다른 인터페이스</span></span>
<span id="cb2-8"></span>
<span id="cb2-9"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># Agent가 100개면 100개의 if-elif 필요 → 유지보수 불가능</span></span></code></pre></div>
<ol start="2" type="1">
<li><strong>Agent 간 조합 불가능</strong></li>
</ol>
<div class="sourceCode" id="cb3" style="background: #f1f3f5;"><pre class="sourceCode numberSource python number-lines code-with-copy"><code class="sourceCode python"><span id="cb3-1"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># 지식 QnA가 다른 Agent를 호출하려 할 때</span></span>
<span id="cb3-2"><span class="kw" style="color: #003B4F;
background-color: null;
font-style: inherit;">def</span> answer_complex_question(question):</span>
<span id="cb3-3">    <span class="cf" style="color: #003B4F;
background-color: null;
font-style: inherit;">if</span> needs_code_analysis(question):</span>
<span id="cb3-4">        <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># 함수명도 모르고, 입출력 형식도 모름</span></span>
<span id="cb3-5">        code_result <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> ???  <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># 어떻게 호출?</span></span>
<span id="cb3-6">    <span class="cf" style="color: #003B4F;
background-color: null;
font-style: inherit;">if</span> needs_standardization(question):</span>
<span id="cb3-7">        std_result <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> ???  <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># 이것도 다른 방식</span></span></code></pre></div>
<ol start="3" type="1">
<li><strong>모니터링/로깅 표준화 불가능</strong></li>
</ol>
<div class="sourceCode" id="cb4" style="background: #f1f3f5;"><pre class="sourceCode numberSource python number-lines code-with-copy"><code class="sourceCode python"><span id="cb4-1"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># 각 Agent의 실행 시간을 측정하려 해도</span></span>
<span id="cb4-2"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># 시작/종료 지점이 Agent마다 다름</span></span>
<span id="cb4-3"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># 공통 메트릭 수집 불가능</span></span></code></pre></div>
</section>
<section id="해결책-baseagent-추상화" class="level4" data-number="2.1.2">
<h4 data-number="2.1.2" class="anchored" data-anchor-id="해결책-baseagent-추상화"><span class="header-section-number">2.1.2</span> 해결책: BaseAgent 추상화</h4>
<div class="sourceCode" id="cb5" style="background: #f1f3f5;"><pre class="sourceCode numberSource python number-lines code-with-copy"><code class="sourceCode python"><span id="cb5-1"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># core/agent/base_agent.py</span></span>
<span id="cb5-2"><span class="im" style="color: #00769E;
background-color: null;
font-style: inherit;">from</span> abc <span class="im" style="color: #00769E;
background-color: null;
font-style: inherit;">import</span> ABC, abstractmethod</span>
<span id="cb5-3"><span class="im" style="color: #00769E;
background-color: null;
font-style: inherit;">from</span> typing <span class="im" style="color: #00769E;
background-color: null;
font-style: inherit;">import</span> Dict, Any</span>
<span id="cb5-4"><span class="im" style="color: #00769E;
background-color: null;
font-style: inherit;">import</span> time</span>
<span id="cb5-5"><span class="im" style="color: #00769E;
background-color: null;
font-style: inherit;">from</span> core.monitoring <span class="im" style="color: #00769E;
background-color: null;
font-style: inherit;">import</span> MetricsCollector</span>
<span id="cb5-6"></span>
<span id="cb5-7"><span class="kw" style="color: #003B4F;
background-color: null;
font-style: inherit;">class</span> BaseAgent(ABC):</span>
<span id="cb5-8">    <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">"""모든 Agent가 상속해야 하는 기본 클래스</span></span>
<span id="cb5-9"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">    </span></span>
<span id="cb5-10"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">    이 클래스는 플랫폼이 Agent를 관리하기 위한 '계약'이다.</span></span>
<span id="cb5-11"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">    모든 Agent는 이 계약을 준수해야만 플랫폼에 등록 가능하다.</span></span>
<span id="cb5-12"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">    """</span></span>
<span id="cb5-13">    </span>
<span id="cb5-14">    <span class="kw" style="color: #003B4F;
background-color: null;
font-style: inherit;">def</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">__init__</span>(<span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">self</span>, name: <span class="bu" style="color: null;
background-color: null;
font-style: inherit;">str</span>, version: <span class="bu" style="color: null;
background-color: null;
font-style: inherit;">str</span>):</span>
<span id="cb5-15">        <span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">self</span>.name <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> name</span>
<span id="cb5-16">        <span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">self</span>.version <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> version</span>
<span id="cb5-17">        <span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">self</span>.metrics <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> MetricsCollector(name)</span>
<span id="cb5-18">    </span>
<span id="cb5-19">    <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">@abstractmethod</span></span>
<span id="cb5-20">    <span class="kw" style="color: #003B4F;
background-color: null;
font-style: inherit;">def</span> process(<span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">self</span>, <span class="bu" style="color: null;
background-color: null;
font-style: inherit;">input</span>: Dict[<span class="bu" style="color: null;
background-color: null;
font-style: inherit;">str</span>, Any]) <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">-&gt;</span> Dict[<span class="bu" style="color: null;
background-color: null;
font-style: inherit;">str</span>, Any]:</span>
<span id="cb5-21">        <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">"""표준화된 입출력 인터페이스</span></span>
<span id="cb5-22"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">        </span></span>
<span id="cb5-23"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">        왜 Dict[str, Any]인가?</span></span>
<span id="cb5-24"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">        - 모든 Agent가 동일한 형식으로 데이터를 주고받음</span></span>
<span id="cb5-25"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">        - 플랫폼이 중간에서 로깅, 검증, 변환 가능</span></span>
<span id="cb5-26"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">        - Agent 간 체이닝(chaining) 가능</span></span>
<span id="cb5-27"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">        """</span></span>
<span id="cb5-28">        <span class="cf" style="color: #003B4F;
background-color: null;
font-style: inherit;">pass</span></span>
<span id="cb5-29">    </span>
<span id="cb5-30">    <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">@abstractmethod</span></span>
<span id="cb5-31">    <span class="kw" style="color: #003B4F;
background-color: null;
font-style: inherit;">def</span> evaluate(<span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">self</span>, ground_truth: Any, prediction: Any) <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">-&gt;</span> <span class="bu" style="color: null;
background-color: null;
font-style: inherit;">float</span>:</span>
<span id="cb5-32">        <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">"""공통 평가 프레임워크</span></span>
<span id="cb5-33"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">        </span></span>
<span id="cb5-34"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">        왜 필요한가?</span></span>
<span id="cb5-35"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">        - 모든 Agent의 성능을 동일한 기준으로 측정</span></span>
<span id="cb5-36"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">        - A/B 테스트, 품질 관리 자동화</span></span>
<span id="cb5-37"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">        - 배포 전 자동 검증 가능</span></span>
<span id="cb5-38"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">        """</span></span>
<span id="cb5-39">        <span class="cf" style="color: #003B4F;
background-color: null;
font-style: inherit;">pass</span></span>
<span id="cb5-40">    </span>
<span id="cb5-41">    <span class="kw" style="color: #003B4F;
background-color: null;
font-style: inherit;">def</span> execute(<span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">self</span>, <span class="bu" style="color: null;
background-color: null;
font-style: inherit;">input</span>: Dict[<span class="bu" style="color: null;
background-color: null;
font-style: inherit;">str</span>, Any]) <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">-&gt;</span> Dict[<span class="bu" style="color: null;
background-color: null;
font-style: inherit;">str</span>, Any]:</span>
<span id="cb5-42">        <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">"""Agent 실행의 공통 흐름 (Template Method Pattern)</span></span>
<span id="cb5-43"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">        </span></span>
<span id="cb5-44"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">        모든 Agent는 이 메서드를 통해 실행된다.</span></span>
<span id="cb5-45"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">        각 Agent는 process()만 구현하면 됨.</span></span>
<span id="cb5-46"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">        """</span></span>
<span id="cb5-47">        <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># 1. 입력 검증</span></span>
<span id="cb5-48">        <span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">self</span>._validate_input(<span class="bu" style="color: null;
background-color: null;
font-style: inherit;">input</span>)</span>
<span id="cb5-49">        </span>
<span id="cb5-50">        <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># 2. 실행 시간 측정 시작</span></span>
<span id="cb5-51">        start_time <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> time.time()</span>
<span id="cb5-52">        </span>
<span id="cb5-53">        <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># 3. 실제 Agent 로직 실행</span></span>
<span id="cb5-54">        <span class="cf" style="color: #003B4F;
background-color: null;
font-style: inherit;">try</span>:</span>
<span id="cb5-55">            result <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> <span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">self</span>.process(<span class="bu" style="color: null;
background-color: null;
font-style: inherit;">input</span>)</span>
<span id="cb5-56">            <span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">self</span>.metrics.record_success(time.time() <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">-</span> start_time)</span>
<span id="cb5-57">        <span class="cf" style="color: #003B4F;
background-color: null;
font-style: inherit;">except</span> <span class="pp" style="color: #AD0000;
background-color: null;
font-style: inherit;">Exception</span> <span class="im" style="color: #00769E;
background-color: null;
font-style: inherit;">as</span> e:</span>
<span id="cb5-58">            <span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">self</span>.metrics.record_failure(e)</span>
<span id="cb5-59">            <span class="cf" style="color: #003B4F;
background-color: null;
font-style: inherit;">raise</span></span>
<span id="cb5-60">        </span>
<span id="cb5-61">        <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># 4. 출력 검증</span></span>
<span id="cb5-62">        <span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">self</span>._validate_output(result)</span>
<span id="cb5-63">        </span>
<span id="cb5-64">        <span class="cf" style="color: #003B4F;
background-color: null;
font-style: inherit;">return</span> result</span>
<span id="cb5-65">    </span>
<span id="cb5-66">    <span class="kw" style="color: #003B4F;
background-color: null;
font-style: inherit;">def</span> _validate_input(<span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">self</span>, <span class="bu" style="color: null;
background-color: null;
font-style: inherit;">input</span>: Dict[<span class="bu" style="color: null;
background-color: null;
font-style: inherit;">str</span>, Any]):</span>
<span id="cb5-67">        <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">"""입력 검증 로직 (모든 Agent 공통)"""</span></span>
<span id="cb5-68">        <span class="cf" style="color: #003B4F;
background-color: null;
font-style: inherit;">if</span> <span class="kw" style="color: #003B4F;
background-color: null;
font-style: inherit;">not</span> <span class="bu" style="color: null;
background-color: null;
font-style: inherit;">isinstance</span>(<span class="bu" style="color: null;
background-color: null;
font-style: inherit;">input</span>, <span class="bu" style="color: null;
background-color: null;
font-style: inherit;">dict</span>):</span>
<span id="cb5-69">            <span class="cf" style="color: #003B4F;
background-color: null;
font-style: inherit;">raise</span> <span class="pp" style="color: #AD0000;
background-color: null;
font-style: inherit;">ValueError</span>(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Input must be a dictionary"</span>)</span>
<span id="cb5-70">    </span>
<span id="cb5-71">    <span class="kw" style="color: #003B4F;
background-color: null;
font-style: inherit;">def</span> _validate_output(<span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">self</span>, output: Dict[<span class="bu" style="color: null;
background-color: null;
font-style: inherit;">str</span>, Any]):</span>
<span id="cb5-72">        <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">"""출력 검증 로직 (모든 Agent 공통)"""</span></span>
<span id="cb5-73">        <span class="cf" style="color: #003B4F;
background-color: null;
font-style: inherit;">if</span> <span class="kw" style="color: #003B4F;
background-color: null;
font-style: inherit;">not</span> <span class="bu" style="color: null;
background-color: null;
font-style: inherit;">isinstance</span>(output, <span class="bu" style="color: null;
background-color: null;
font-style: inherit;">dict</span>):</span>
<span id="cb5-74">            <span class="cf" style="color: #003B4F;
background-color: null;
font-style: inherit;">raise</span> <span class="pp" style="color: #AD0000;
background-color: null;
font-style: inherit;">ValueError</span>(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Output must be a dictionary"</span>)</span></code></pre></div>
<p><strong>이제 플랫폼은 통일된 방식으로 Agent 관리 가능</strong>:</p>
<div class="sourceCode" id="cb6" style="background: #f1f3f5;"><pre class="sourceCode numberSource python number-lines code-with-copy"><code class="sourceCode python"><span id="cb6-1"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># platform-api/orchestrator.py</span></span>
<span id="cb6-2"><span class="kw" style="color: #003B4F;
background-color: null;
font-style: inherit;">class</span> AgentOrchestrator:</span>
<span id="cb6-3">    <span class="kw" style="color: #003B4F;
background-color: null;
font-style: inherit;">def</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">__init__</span>(<span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">self</span>):</span>
<span id="cb6-4">        <span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">self</span>.agents: Dict[<span class="bu" style="color: null;
background-color: null;
font-style: inherit;">str</span>, BaseAgent] <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> {}</span>
<span id="cb6-5">    </span>
<span id="cb6-6">    <span class="kw" style="color: #003B4F;
background-color: null;
font-style: inherit;">def</span> register_agent(<span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">self</span>, agent: BaseAgent):</span>
<span id="cb6-7">        <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">"""모든 Agent는 BaseAgent를 상속했으므로 동일하게 등록"""</span></span>
<span id="cb6-8">        <span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">self</span>.agents[agent.name] <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> agent</span>
<span id="cb6-9">    </span>
<span id="cb6-10">    <span class="kw" style="color: #003B4F;
background-color: null;
font-style: inherit;">def</span> run_agent(<span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">self</span>, agent_name: <span class="bu" style="color: null;
background-color: null;
font-style: inherit;">str</span>, input_data: Dict[<span class="bu" style="color: null;
background-color: null;
font-style: inherit;">str</span>, Any]):</span>
<span id="cb6-11">        <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">"""Agent 실행 - 어떤 Agent든 동일한 방식"""</span></span>
<span id="cb6-12">        agent <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> <span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">self</span>.agents[agent_name]</span>
<span id="cb6-13">        <span class="cf" style="color: #003B4F;
background-color: null;
font-style: inherit;">return</span> agent.execute(input_data)</span>
<span id="cb6-14">    </span>
<span id="cb6-15">    <span class="kw" style="color: #003B4F;
background-color: null;
font-style: inherit;">def</span> chain_agents(<span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">self</span>, agent_names: List[<span class="bu" style="color: null;
background-color: null;
font-style: inherit;">str</span>], input_data: Dict[<span class="bu" style="color: null;
background-color: null;
font-style: inherit;">str</span>, Any]):</span>
<span id="cb6-16">        <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">"""Agent 체이닝 - 표준 인터페이스 덕분에 가능"""</span></span>
<span id="cb6-17">        result <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> input_data</span>
<span id="cb6-18">        <span class="cf" style="color: #003B4F;
background-color: null;
font-style: inherit;">for</span> agent_name <span class="kw" style="color: #003B4F;
background-color: null;
font-style: inherit;">in</span> agent_names:</span>
<span id="cb6-19">            result <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> <span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">self</span>.run_agent(agent_name, result)</span>
<span id="cb6-20">        <span class="cf" style="color: #003B4F;
background-color: null;
font-style: inherit;">return</span> result</span></code></pre></div>
</section>
<section id="실증-데이터" class="level4" data-number="2.1.3">
<h4 data-number="2.1.3" class="anchored" data-anchor-id="실증-데이터"><span class="header-section-number">2.1.3</span> 실증 데이터</h4>
<p><strong>Google의 Borg 시스템 (Burns et al., 2016, EuroSys)</strong>: - 컨테이너 추상화 도입 전: 새 애플리케이션 배포 시간 평균 <strong>3-5일</strong> - 추상화 도입 후: <strong>30분 이하</strong>로 단축 - 이유: 표준 인터페이스로 자동화 가능</p>
<p><strong>Uber의 ML 플랫폼 사례</strong>: - 초기 각 모델팀이 독자적 인터페이스 사용 - 문제: 모델 배포 시 플랫폼 팀 개입 필수 (병목) - 해결: <code>Model</code> 추상 클래스 도입 - 결과: 모델 배포 속도 <strong>5배 향상</strong>, 플랫폼 팀 개입 <strong>80% 감소</strong></p>
<hr>
</section>
</section>
<section id="principle-2-dependency-inversion-의존성-역전" class="level3" data-number="2.2">
<h3 data-number="2.2" class="anchored" data-anchor-id="principle-2-dependency-inversion-의존성-역전"><span class="header-section-number">2.2</span> Principle 2: Dependency Inversion (의존성 역전)</h3>
<blockquote class="blockquote">
<p>“구체적 Agent가 Core에 의존하지, Core가 Agent에 의존하지 않는다”</p>
</blockquote>
<section id="잘못된-설계" class="level4" data-number="2.2.1">
<h4 data-number="2.2.1" class="anchored" data-anchor-id="잘못된-설계"><span class="header-section-number">2.2.1</span> 잘못된 설계</h4>
<div class="sourceCode" id="cb7" style="background: #f1f3f5;"><pre class="sourceCode numberSource python number-lines code-with-copy"><code class="sourceCode python"><span id="cb7-1"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># ❌ 안티패턴: Core가 Agent를 직접 참조</span></span>
<span id="cb7-2"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># core/orchestrator.py</span></span>
<span id="cb7-3"><span class="im" style="color: #00769E;
background-color: null;
font-style: inherit;">from</span> agents.data_standardization <span class="im" style="color: #00769E;
background-color: null;
font-style: inherit;">import</span> DataStandardizationAgent</span>
<span id="cb7-4"><span class="im" style="color: #00769E;
background-color: null;
font-style: inherit;">from</span> agents.code_analysis <span class="im" style="color: #00769E;
background-color: null;
font-style: inherit;">import</span> CodeAnalysisAgent</span>
<span id="cb7-5"><span class="im" style="color: #00769E;
background-color: null;
font-style: inherit;">from</span> agents.knowledge_qna <span class="im" style="color: #00769E;
background-color: null;
font-style: inherit;">import</span> KnowledgeQnAAgent</span>
<span id="cb7-6"></span>
<span id="cb7-7"><span class="kw" style="color: #003B4F;
background-color: null;
font-style: inherit;">class</span> Orchestrator:</span>
<span id="cb7-8">    <span class="kw" style="color: #003B4F;
background-color: null;
font-style: inherit;">def</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">__init__</span>(<span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">self</span>):</span>
<span id="cb7-9">        <span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">self</span>.data_agent <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> DataStandardizationAgent()</span>
<span id="cb7-10">        <span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">self</span>.code_agent <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> CodeAnalysisAgent()</span>
<span id="cb7-11">        <span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">self</span>.qna_agent <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> KnowledgeQnAAgent()</span></code></pre></div>
<p><strong>문제점</strong>: 1. 새 Agent 추가 시 Core 수정 필요 → Core 불안정 2. Agent 제거 시 Core에서 import 삭제 필요 → 실수 가능성 3. Agent가 100개면 Core에 100개 import → 관리 불가능</p>
</section>
<section id="올바른-설계-plugin-architecture" class="level4" data-number="2.2.2">
<h4 data-number="2.2.2" class="anchored" data-anchor-id="올바른-설계-plugin-architecture"><span class="header-section-number">2.2.2</span> 올바른 설계: Plugin Architecture</h4>
<div class="sourceCode" id="cb8" style="background: #f1f3f5;"><pre class="sourceCode numberSource python number-lines code-with-copy"><code class="sourceCode python"><span id="cb8-1"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># ✅ Core는 Agent의 존재를 모름</span></span>
<span id="cb8-2"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># core/orchestrator.py</span></span>
<span id="cb8-3"><span class="kw" style="color: #003B4F;
background-color: null;
font-style: inherit;">class</span> Orchestrator:</span>
<span id="cb8-4">    <span class="kw" style="color: #003B4F;
background-color: null;
font-style: inherit;">def</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">__init__</span>(<span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">self</span>):</span>
<span id="cb8-5">        <span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">self</span>.agents: Dict[<span class="bu" style="color: null;
background-color: null;
font-style: inherit;">str</span>, BaseAgent] <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> {}</span>
<span id="cb8-6">    </span>
<span id="cb8-7">    <span class="kw" style="color: #003B4F;
background-color: null;
font-style: inherit;">def</span> register(<span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">self</span>, agent: BaseAgent):</span>
<span id="cb8-8">        <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">"""Agent가 스스로 등록 (Dependency Inversion)"""</span></span>
<span id="cb8-9">        <span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">self</span>.agents[agent.name] <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> agent</span>
<span id="cb8-10"></span>
<span id="cb8-11"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># agents/data_standardization/__init__.py</span></span>
<span id="cb8-12"><span class="im" style="color: #00769E;
background-color: null;
font-style: inherit;">from</span> core.orchestrator <span class="im" style="color: #00769E;
background-color: null;
font-style: inherit;">import</span> get_orchestrator</span>
<span id="cb8-13"><span class="im" style="color: #00769E;
background-color: null;
font-style: inherit;">from</span> .agent <span class="im" style="color: #00769E;
background-color: null;
font-style: inherit;">import</span> DataStandardizationAgent</span>
<span id="cb8-14"></span>
<span id="cb8-15"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># Agent 초기화 시 자동 등록</span></span>
<span id="cb8-16">agent <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> DataStandardizationAgent()</span>
<span id="cb8-17">get_orchestrator().register(agent)</span></code></pre></div>
<p><strong>이점</strong>: - Core는 Agent의 존재를 모름 → Core 안정성 향상 - Agent 추가/제거가 Core에 영향 없음 - Plugin 형태로 동적 로딩 가능</p>
</section>
<section id="실증-데이터-1" class="level4" data-number="2.2.3">
<h4 data-number="2.2.3" class="anchored" data-anchor-id="실증-데이터-1"><span class="header-section-number">2.2.3</span> 실증 데이터</h4>
<p><strong>Microsoft의 Visual Studio Code 아키텍처</strong>: - Extension API를 통한 의존성 역전 - 10,000+ 확장 프로그램이 Core 수정 없이 추가됨 - Core 버그 발생률: 확장 추가와 <strong>무관</strong> (0% 증가)</p>
</section>
</section>
<section id="principle-3-open-closed-principle-개방-폐쇄-원칙" class="level3" data-number="2.3">
<h3 data-number="2.3" class="anchored" data-anchor-id="principle-3-open-closed-principle-개방-폐쇄-원칙"><span class="header-section-number">2.3</span> Principle 3: Open-Closed Principle (개방-폐쇄 원칙)</h3>
<blockquote class="blockquote">
<p>“플랫폼은 확장에는 열려있고(Open), 수정에는 닫혀있다(Closed)”</p>
</blockquote>
<section id="추상화로-가능한-확장" class="level4" data-number="2.3.1">
<h4 data-number="2.3.1" class="anchored" data-anchor-id="추상화로-가능한-확장"><span class="header-section-number">2.3.1</span> 추상화로 가능한 확장</h4>
<div class="sourceCode" id="cb9" style="background: #f1f3f5;"><pre class="sourceCode numberSource python number-lines code-with-copy"><code class="sourceCode python"><span id="cb9-1"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># 새 Agent 추가 - Core 수정 불필요</span></span>
<span id="cb9-2"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># agents/experiment_analyzer/agent.py</span></span>
<span id="cb9-3"><span class="im" style="color: #00769E;
background-color: null;
font-style: inherit;">from</span> core.agent <span class="im" style="color: #00769E;
background-color: null;
font-style: inherit;">import</span> BaseAgent</span>
<span id="cb9-4"></span>
<span id="cb9-5"><span class="kw" style="color: #003B4F;
background-color: null;
font-style: inherit;">class</span> ExperimentAnalyzer(BaseAgent):</span>
<span id="cb9-6">    <span class="kw" style="color: #003B4F;
background-color: null;
font-style: inherit;">def</span> process(<span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">self</span>, <span class="bu" style="color: null;
background-color: null;
font-style: inherit;">input</span>: Dict[<span class="bu" style="color: null;
background-color: null;
font-style: inherit;">str</span>, Any]) <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">-&gt;</span> Dict[<span class="bu" style="color: null;
background-color: null;
font-style: inherit;">str</span>, Any]:</span>
<span id="cb9-7">        <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># 실험 데이터 분석 로직</span></span>
<span id="cb9-8">        experiment_data <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> <span class="bu" style="color: null;
background-color: null;
font-style: inherit;">input</span>[<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"data"</span>]</span>
<span id="cb9-9">        analysis <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> <span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">self</span>._analyze(experiment_data)</span>
<span id="cb9-10">        <span class="cf" style="color: #003B4F;
background-color: null;
font-style: inherit;">return</span> {<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"analysis"</span>: analysis}</span>
<span id="cb9-11">    </span>
<span id="cb9-12">    <span class="kw" style="color: #003B4F;
background-color: null;
font-style: inherit;">def</span> evaluate(<span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">self</span>, ground_truth: Any, prediction: Any) <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">-&gt;</span> <span class="bu" style="color: null;
background-color: null;
font-style: inherit;">float</span>:</span>
<span id="cb9-13">        <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># 평가 로직</span></span>
<span id="cb9-14">        <span class="cf" style="color: #003B4F;
background-color: null;
font-style: inherit;">return</span> accuracy_score(ground_truth, prediction)</span>
<span id="cb9-15"></span>
<span id="cb9-16"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># 이 Agent는 BaseAgent를 상속했으므로</span></span>
<span id="cb9-17"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># 플랫폼의 모든 기능(모니터링, 로깅, 체이닝)을 자동으로 사용 가능</span></span></code></pre></div>
</section>
<section id="실증-데이터-2" class="level4" data-number="2.3.2">
<h4 data-number="2.3.2" class="anchored" data-anchor-id="실증-데이터-2"><span class="header-section-number">2.3.2</span> 실증 데이터</h4>
<p><strong>Airbnb의 Airflow 플랫폼</strong>: - Plugin 방식으로 100+ Operator 확장 - Core DAG Engine은 <strong>3년간 major breaking change 0건</strong> - 이유: 추상화된 <code>BaseOperator</code> 인터페이스</p>
</section>
</section>
<section id="principle-4-single-responsibility-단일-책임" class="level3" data-number="2.4">
<h3 data-number="2.4" class="anchored" data-anchor-id="principle-4-single-responsibility-단일-책임"><span class="header-section-number">2.4</span> Principle 4: Single Responsibility (단일 책임)</h3>
<blockquote class="blockquote">
<p>“Core는 Agent 관리만, Agent는 도메인 로직만”</p>
</blockquote>
<section id="역할-분리" class="level4" data-number="2.4.1">
<h4 data-number="2.4.1" class="anchored" data-anchor-id="역할-분리"><span class="header-section-number">2.4.1</span> 역할 분리</h4>
<div class="sourceCode" id="cb10" style="background: #f1f3f5;"><pre class="sourceCode numberSource python number-lines code-with-copy"><code class="sourceCode python"><span id="cb10-1"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># Core의 책임: Agent 생명주기 관리</span></span>
<span id="cb10-2"><span class="kw" style="color: #003B4F;
background-color: null;
font-style: inherit;">class</span> BaseAgent(ABC):</span>
<span id="cb10-3">    <span class="kw" style="color: #003B4F;
background-color: null;
font-style: inherit;">def</span> execute(<span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">self</span>, <span class="bu" style="color: null;
background-color: null;
font-style: inherit;">input</span>):</span>
<span id="cb10-4">        <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># 1. 공통 전처리</span></span>
<span id="cb10-5">        <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># 2. 모니터링 시작</span></span>
<span id="cb10-6">        <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># 3. Agent 로직 실행 (process 호출)</span></span>
<span id="cb10-7">        <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># 4. 공통 후처리</span></span>
<span id="cb10-8">        <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># 5. 모니터링 종료</span></span>
<span id="cb10-9">        <span class="cf" style="color: #003B4F;
background-color: null;
font-style: inherit;">pass</span></span>
<span id="cb10-10"></span>
<span id="cb10-11"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># Agent의 책임: 도메인 로직만 구현</span></span>
<span id="cb10-12"><span class="kw" style="color: #003B4F;
background-color: null;
font-style: inherit;">class</span> DataStandardizationAgent(BaseAgent):</span>
<span id="cb10-13">    <span class="kw" style="color: #003B4F;
background-color: null;
font-style: inherit;">def</span> process(<span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">self</span>, <span class="bu" style="color: null;
background-color: null;
font-style: inherit;">input</span>: Dict[<span class="bu" style="color: null;
background-color: null;
font-style: inherit;">str</span>, Any]) <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">-&gt;</span> Dict[<span class="bu" style="color: null;
background-color: null;
font-style: inherit;">str</span>, Any]:</span>
<span id="cb10-14">        <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># 오직 데이터 표준화 로직에만 집중</span></span>
<span id="cb10-15">        <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># 모니터링, 로깅, 에러 처리는 BaseAgent가 담당</span></span>
<span id="cb10-16">        schema <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> <span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">self</span>._parse_schema(<span class="bu" style="color: null;
background-color: null;
font-style: inherit;">input</span>[<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"data"</span>])</span>
<span id="cb10-17">        normalized <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> <span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">self</span>._normalize(schema)</span>
<span id="cb10-18">        <span class="cf" style="color: #003B4F;
background-color: null;
font-style: inherit;">return</span> {<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"normalized_schema"</span>: normalized}</span></code></pre></div>
</section>
<section id="실증-데이터-3" class="level4" data-number="2.4.2">
<h4 data-number="2.4.2" class="anchored" data-anchor-id="실증-데이터-3"><span class="header-section-number">2.4.2</span> 실증 데이터</h4>
<p><strong>Netflix의 Conductor 워크플로우 엔진</strong>: - Task 개발자는 비즈니스 로직만 구현 - 재시도, 타임아웃, 모니터링은 플랫폼이 담당 - 결과: Task 개발 시간 <strong>70% 단축</strong></p>
</section>
</section>
<section id="principle-5-composability-조합-가능성" class="level3" data-number="2.5">
<h3 data-number="2.5" class="anchored" data-anchor-id="principle-5-composability-조합-가능성"><span class="header-section-number">2.5</span> Principle 5: Composability (조합 가능성)</h3>
<blockquote class="blockquote">
<p>“작은 Agent들을 조합하여 복잡한 워크플로우를 만든다”</p>
</blockquote>
<section id="표준-인터페이스로-조합-가능" class="level4" data-number="2.5.1">
<h4 data-number="2.5.1" class="anchored" data-anchor-id="표준-인터페이스로-조합-가능"><span class="header-section-number">2.5.1</span> 표준 인터페이스로 조합 가능</h4>
<div class="sourceCode" id="cb11" style="background: #f1f3f5;"><pre class="sourceCode numberSource python number-lines code-with-copy"><code class="sourceCode python"><span id="cb11-1"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># 모든 Agent가 Dict[str, Any] 입출력 사용</span></span>
<span id="cb11-2">pipeline <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> Pipeline([</span>
<span id="cb11-3">    DataStandardizationAgent(),</span>
<span id="cb11-4">    CodeAnalysisAgent(),</span>
<span id="cb11-5">    KnowledgeQnAAgent()</span>
<span id="cb11-6">])</span>
<span id="cb11-7"></span>
<span id="cb11-8">result <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> pipeline.run({<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"query"</span>: <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"..."</span>})</span>
<span id="cb11-9"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># 각 Agent의 출력이 다음 Agent의 입력으로 자동 전달</span></span></code></pre></div>
</section>
<section id="실증-데이터-4" class="level4" data-number="2.5.2">
<h4 data-number="2.5.2" class="anchored" data-anchor-id="실증-데이터-4"><span class="header-section-number">2.5.2</span> 실증 데이터</h4>
<p><strong>LangChain의 설계 원칙</strong>: - 모든 컴포넌트가 <code>Runnable</code> 인터페이스 구현 - 이를 통해 <strong>무한한 조합</strong> 가능 (Chain, Router, Parallel 등) - 결과: 생태계 급성장 (6개월 만에 100+ 통합)</p>
</section>
</section>
</section>
<section id="조기-추상화의-위험성" class="level2" data-number="3">
<h2 data-number="3" class="anchored" data-anchor-id="조기-추상화의-위험성"><span class="header-section-number">3</span> 조기 추상화의 위험성</h2>
<p>이론적으로 5가지 원칙이 완벽해 보이지만, 경험 없이 처음부터 적용하면 실패한다.</p>
<section id="rule-of-three-삼진-아웃-규칙" class="level3" data-number="3.1">
<h3 data-number="3.1" class="anchored" data-anchor-id="rule-of-three-삼진-아웃-규칙"><span class="header-section-number">3.1</span> Rule of Three (삼진 아웃 규칙)</h3>
<p><strong>실무에 적용할만한 전략적 원칙</strong>: - 1번 구현: 그냥 만든다 - 2번 반복: 중복이 보이지만 참는다 - 3번 반복: <strong>이제 공통 패턴이 명확</strong> → 이때 추상화한다</p>
</section>
<section id="실패-사례-uber의-초기-실수" class="level3" data-number="3.2">
<h3 data-number="3.2" class="anchored" data-anchor-id="실패-사례-uber의-초기-실수"><span class="header-section-number">3.2</span> 실패 사례: Uber의 초기 실수</h3>
<p><em>세부내용은 검증이 필요</em></p>
<div class="sourceCode" id="cb12" style="background: #f1f3f5;"><pre class="sourceCode numberSource python number-lines code-with-copy"><code class="sourceCode python"><span id="cb12-1"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># ❌ Uber가 처음부터 "완벽한" BaseModel을 설계하려 시도</span></span>
<span id="cb12-2"><span class="kw" style="color: #003B4F;
background-color: null;
font-style: inherit;">class</span> BaseModel(ABC):</span>
<span id="cb12-3">    <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">@abstractmethod</span></span>
<span id="cb12-4">    <span class="kw" style="color: #003B4F;
background-color: null;
font-style: inherit;">def</span> preprocess(<span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">self</span>, data): <span class="cf" style="color: #003B4F;
background-color: null;
font-style: inherit;">pass</span></span>
<span id="cb12-5">    </span>
<span id="cb12-6">    <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">@abstractmethod</span></span>
<span id="cb12-7">    <span class="kw" style="color: #003B4F;
background-color: null;
font-style: inherit;">def</span> train(<span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">self</span>, data): <span class="cf" style="color: #003B4F;
background-color: null;
font-style: inherit;">pass</span></span>
<span id="cb12-8">    </span>
<span id="cb12-9">    <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">@abstractmethod</span></span>
<span id="cb12-10">    <span class="kw" style="color: #003B4F;
background-color: null;
font-style: inherit;">def</span> predict(<span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">self</span>, data): <span class="cf" style="color: #003B4F;
background-color: null;
font-style: inherit;">pass</span></span>
<span id="cb12-11">    </span>
<span id="cb12-12">    <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">@abstractmethod</span></span>
<span id="cb12-13">    <span class="kw" style="color: #003B4F;
background-color: null;
font-style: inherit;">def</span> evaluate(<span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">self</span>, data): <span class="cf" style="color: #003B4F;
background-color: null;
font-style: inherit;">pass</span></span>
<span id="cb12-14"></span>
<span id="cb12-15"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># 문제: 실제 모델들은 이렇게 단순하지 않았음</span></span>
<span id="cb12-16"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># - 일부 모델은 전처리 없음</span></span>
<span id="cb12-17"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># - 일부는 온라인 학습으로 train() 불필요</span></span>
<span id="cb12-18"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># - 평가 메트릭이 모델마다 완전히 다름</span></span>
<span id="cb12-19"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># </span></span>
<span id="cb12-20"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># 결과: 6개월 후 BaseModel 폐기하고 재설계</span></span></code></pre></div>
<p><strong>교훈</strong>: 3-5개 구체적 사례 없이 추상화하면 실패 확률 높음.</p>
</section>
<section id="yagni-you-arent-gonna-need-it" class="level3" data-number="3.3">
<h3 data-number="3.3" class="anchored" data-anchor-id="yagni-you-arent-gonna-need-it"><span class="header-section-number">3.3</span> YAGNI (You Aren’t Gonna Need It)</h3>
<p>You Aren’t Gonna Need It (유명한 소프트웨어 개발 원칙) = 너는 그것을 필요로 하지 않을 것이다 = 그거 <em>확실히</em> 안 쓸 거야 / 필요 없을 거야 = 경험상 지금 만들면 100% 안 쓸 거야 (확신에 찬 경고)</p>
<p>즉, “필요할 것 같아서” 미리 만든 추상화는 대부분 실패한다.</p>
<p><strong>안티패턴 예시</strong>:</p>
<div class="sourceCode" id="cb13" style="background: #f1f3f5;"><pre class="sourceCode numberSource python number-lines code-with-copy"><code class="sourceCode python"><span id="cb13-1"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># ❌ 미래를 대비한 과도한 추상화</span></span>
<span id="cb13-2"><span class="kw" style="color: #003B4F;
background-color: null;
font-style: inherit;">class</span> BaseAgent(ABC):</span>
<span id="cb13-3">    <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">@abstractmethod</span></span>
<span id="cb13-4">    <span class="kw" style="color: #003B4F;
background-color: null;
font-style: inherit;">def</span> initialize(<span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">self</span>): <span class="cf" style="color: #003B4F;
background-color: null;
font-style: inherit;">pass</span></span>
<span id="cb13-5">    </span>
<span id="cb13-6">    <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">@abstractmethod</span></span>
<span id="cb13-7">    <span class="kw" style="color: #003B4F;
background-color: null;
font-style: inherit;">def</span> preprocess(<span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">self</span>, data): <span class="cf" style="color: #003B4F;
background-color: null;
font-style: inherit;">pass</span></span>
<span id="cb13-8">    </span>
<span id="cb13-9">    <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">@abstractmethod</span></span>
<span id="cb13-10">    <span class="kw" style="color: #003B4F;
background-color: null;
font-style: inherit;">def</span> process(<span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">self</span>, data): <span class="cf" style="color: #003B4F;
background-color: null;
font-style: inherit;">pass</span></span>
<span id="cb13-11">    </span>
<span id="cb13-12">    <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">@abstractmethod</span></span>
<span id="cb13-13">    <span class="kw" style="color: #003B4F;
background-color: null;
font-style: inherit;">def</span> postprocess(<span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">self</span>, data): <span class="cf" style="color: #003B4F;
background-color: null;
font-style: inherit;">pass</span></span>
<span id="cb13-14">    </span>
<span id="cb13-15">    <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">@abstractmethod</span></span>
<span id="cb13-16">    <span class="kw" style="color: #003B4F;
background-color: null;
font-style: inherit;">def</span> evaluate(<span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">self</span>, data): <span class="cf" style="color: #003B4F;
background-color: null;
font-style: inherit;">pass</span></span>
<span id="cb13-17">    </span>
<span id="cb13-18">    <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">@abstractmethod</span></span>
<span id="cb13-19">    <span class="kw" style="color: #003B4F;
background-color: null;
font-style: inherit;">def</span> cleanup(<span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">self</span>): <span class="cf" style="color: #003B4F;
background-color: null;
font-style: inherit;">pass</span></span>
<span id="cb13-20">    </span>
<span id="cb13-21">    <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">@abstractmethod</span></span>
<span id="cb13-22">    <span class="kw" style="color: #003B4F;
background-color: null;
font-style: inherit;">def</span> rollback(<span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">self</span>): <span class="cf" style="color: #003B4F;
background-color: null;
font-style: inherit;">pass</span>  <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># 혹시 몰라 추가</span></span>
<span id="cb13-23">    </span>
<span id="cb13-24">    <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">@abstractmethod</span></span>
<span id="cb13-25">    <span class="kw" style="color: #003B4F;
background-color: null;
font-style: inherit;">def</span> healthcheck(<span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">self</span>): <span class="cf" style="color: #003B4F;
background-color: null;
font-style: inherit;">pass</span>  <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># 혹시 몰라 추가</span></span>
<span id="cb13-26"></span>
<span id="cb13-27"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># 문제: 실제 Agent는 이 중 절반도 사용 안 함</span></span>
<span id="cb13-28"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># 억지로 빈 메서드 구현하게 됨</span></span></code></pre></div>
</section>
</section>
<section id="점진적-추상화-전략-poc에서-플랫폼으로" class="level2" data-number="4">
<h2 data-number="4" class="anchored" data-anchor-id="점진적-추상화-전략-poc에서-플랫폼으로"><span class="header-section-number">4</span> 점진적 추상화 전략: POC에서 플랫폼으로</h2>
<p>본인이 풍부한 도메인 경험/ 플랫폼 개발/ 플랫폼 설계 경험이 없다면 다음 단계를 따른 것도 하나의 전략이 될 수 있다.</p>
<section id="phase-1-poc-3개-독립-구현-1개월" class="level3" data-number="4.1">
<h3 data-number="4.1" class="anchored" data-anchor-id="phase-1-poc-3개-독립-구현-1개월"><span class="header-section-number">4.1</span> Phase 1: POC 3개 독립 구현 (1개월)</h3>
<p><strong>목표</strong>: 추상화 없이 각자 최선의 방식으로 구현</p>
<pre><code>agents-poc/                    # 임시 폴더
├── data_standardization_poc/
│   ├── main.py               # 마음대로 구현
│   ├── prompts/
│   │   ├── system.txt
│   │   └── user_template.txt
│   ├── utils.py
│   └── requirements.txt
│
├── code_analysis_poc/
│   ├── analyzer.py           # 완전히 다른 구조여도 OK
│   ├── parsers/
│   │   ├── python_parser.py
│   │   └── java_parser.py
│   ├── tools.py
│   └── requirements.txt
│
└── knowledge_qna_poc/
    ├── chatbot.py
    ├── rag_pipeline.py
    ├── vector_store.py
    └── requirements.txt</code></pre>
<section id="핵심-원칙" class="level4" data-number="4.1.1">
<h4 data-number="4.1.1" class="anchored" data-anchor-id="핵심-원칙"><span class="header-section-number">4.1.1</span> 핵심 원칙</h4>
<ul>
<li>✅ 각 Agent가 <strong>실제로 작동</strong>하는 것이 최우선</li>
<li>✅ 코드 중복 걱정하지 말 것</li>
<li>✅ 구조 일관성 신경 쓰지 말 것</li>
<li>✅ 빠르게 반복 실험</li>
</ul>
</section>
<section id="체크리스트" class="level4" data-number="4.1.2">
<h4 data-number="4.1.2" class="anchored" data-anchor-id="체크리스트"><span class="header-section-number">4.1.2</span> 체크리스트</h4>
<p><strong>데이터 표준화 POC</strong>: - CSV/Excel 파일 읽기 - LLM으로 스키마 분석 - 표준화된 스키마 출력 - 실제 데이터 팀 피드백 받기</p>
<p><strong>코드 분석 POC</strong>: - Python/Java 코드 파싱 - LLM으로 코드 설명 생성 - 리팩토링 제안 생성 - 실제 개발 팀 피드백 받기</p>
<p><strong>지식 QnA POC</strong>: - 문서 임베딩 및 벡터 저장 - RAG 기반 답변 생성 - 다양한 질문 유형 테스트 - 실제 임원 피드백 받기</p>
</section>
<section id="구현-예시" class="level4" data-number="4.1.3">
<h4 data-number="4.1.3" class="anchored" data-anchor-id="구현-예시"><span class="header-section-number">4.1.3</span> 구현 예시</h4>
<div class="sourceCode" id="cb15" style="background: #f1f3f5;"><pre class="sourceCode numberSource python number-lines code-with-copy"><code class="sourceCode python"><span id="cb15-1"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># data_standardization_poc/main.py</span></span>
<span id="cb15-2"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># 추상화 없이 직관적으로 구현</span></span>
<span id="cb15-3"></span>
<span id="cb15-4"><span class="im" style="color: #00769E;
background-color: null;
font-style: inherit;">import</span> pandas <span class="im" style="color: #00769E;
background-color: null;
font-style: inherit;">as</span> pd</span>
<span id="cb15-5"><span class="im" style="color: #00769E;
background-color: null;
font-style: inherit;">from</span> openai <span class="im" style="color: #00769E;
background-color: null;
font-style: inherit;">import</span> OpenAI</span>
<span id="cb15-6"></span>
<span id="cb15-7"><span class="kw" style="color: #003B4F;
background-color: null;
font-style: inherit;">def</span> standardize_schema(file_path: <span class="bu" style="color: null;
background-color: null;
font-style: inherit;">str</span>) <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">-&gt;</span> <span class="bu" style="color: null;
background-color: null;
font-style: inherit;">dict</span>:</span>
<span id="cb15-8">    <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">"""데이터 스키마 표준화"""</span></span>
<span id="cb15-9">    </span>
<span id="cb15-10">    <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># 1. 데이터 로드</span></span>
<span id="cb15-11">    df <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> pd.read_csv(file_path)</span>
<span id="cb15-12">    schema <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> {</span>
<span id="cb15-13">        <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"columns"</span>: <span class="bu" style="color: null;
background-color: null;
font-style: inherit;">list</span>(df.columns),</span>
<span id="cb15-14">        <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"dtypes"</span>: df.dtypes.to_dict(),</span>
<span id="cb15-15">        <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"sample"</span>: df.head(<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">5</span>).to_dict()</span>
<span id="cb15-16">    }</span>
<span id="cb15-17">    </span>
<span id="cb15-18">    <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># 2. LLM 호출</span></span>
<span id="cb15-19">    client <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> OpenAI()</span>
<span id="cb15-20">    prompt <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> <span class="ss" style="color: #20794D;
background-color: null;
font-style: inherit;">f"""</span></span>
<span id="cb15-21"><span class="ss" style="color: #20794D;
background-color: null;
font-style: inherit;">    다음 데이터 스키마를 표준화해주세요:</span></span>
<span id="cb15-22"><span class="ss" style="color: #20794D;
background-color: null;
font-style: inherit;">    </span><span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">{</span>schema<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">}</span></span>
<span id="cb15-23"><span class="ss" style="color: #20794D;
background-color: null;
font-style: inherit;">    </span></span>
<span id="cb15-24"><span class="ss" style="color: #20794D;
background-color: null;
font-style: inherit;">    표준 형식:</span></span>
<span id="cb15-25"><span class="ss" style="color: #20794D;
background-color: null;
font-style: inherit;">    - 컬럼명: snake_case</span></span>
<span id="cb15-26"><span class="ss" style="color: #20794D;
background-color: null;
font-style: inherit;">    - 날짜: ISO 8601</span></span>
<span id="cb15-27"><span class="ss" style="color: #20794D;
background-color: null;
font-style: inherit;">    - 문자열: UTF-8</span></span>
<span id="cb15-28"><span class="ss" style="color: #20794D;
background-color: null;
font-style: inherit;">    """</span></span>
<span id="cb15-29">    </span>
<span id="cb15-30">    response <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> client.chat.completions.create(</span>
<span id="cb15-31">        model<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"gpt-4"</span>,</span>
<span id="cb15-32">        messages<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span>[{<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"role"</span>: <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"user"</span>, <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"content"</span>: prompt}]</span>
<span id="cb15-33">    )</span>
<span id="cb15-34">    </span>
<span id="cb15-35">    <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># 3. 결과 반환</span></span>
<span id="cb15-36">    <span class="cf" style="color: #003B4F;
background-color: null;
font-style: inherit;">return</span> {</span>
<span id="cb15-37">        <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"original_schema"</span>: schema,</span>
<span id="cb15-38">        <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"standardized"</span>: response.choices[<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">0</span>].message.content</span>
<span id="cb15-39">    }</span>
<span id="cb15-40"></span>
<span id="cb15-41"><span class="cf" style="color: #003B4F;
background-color: null;
font-style: inherit;">if</span> <span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">__name__</span> <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">==</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"__main__"</span>:</span>
<span id="cb15-42">    result <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> standardize_schema(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"data/sample.csv"</span>)</span>
<span id="cb15-43">    <span class="bu" style="color: null;
background-color: null;
font-style: inherit;">print</span>(result)</span></code></pre></div>
<div class="sourceCode" id="cb16" style="background: #f1f3f5;"><pre class="sourceCode numberSource python number-lines code-with-copy"><code class="sourceCode python"><span id="cb16-1"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># code_analysis_poc/analyzer.py</span></span>
<span id="cb16-2"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># 완전히 다른 구조로 구현해도 OK</span></span>
<span id="cb16-3"></span>
<span id="cb16-4"><span class="im" style="color: #00769E;
background-color: null;
font-style: inherit;">import</span> ast</span>
<span id="cb16-5"><span class="im" style="color: #00769E;
background-color: null;
font-style: inherit;">from</span> anthropic <span class="im" style="color: #00769E;
background-color: null;
font-style: inherit;">import</span> Anthropic</span>
<span id="cb16-6"></span>
<span id="cb16-7"><span class="kw" style="color: #003B4F;
background-color: null;
font-style: inherit;">class</span> CodeAnalyzer:</span>
<span id="cb16-8">    <span class="kw" style="color: #003B4F;
background-color: null;
font-style: inherit;">def</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">__init__</span>(<span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">self</span>):</span>
<span id="cb16-9">        <span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">self</span>.client <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> Anthropic()</span>
<span id="cb16-10">    </span>
<span id="cb16-11">    <span class="kw" style="color: #003B4F;
background-color: null;
font-style: inherit;">def</span> analyze_python_file(<span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">self</span>, file_path: <span class="bu" style="color: null;
background-color: null;
font-style: inherit;">str</span>) <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">-&gt;</span> <span class="bu" style="color: null;
background-color: null;
font-style: inherit;">str</span>:</span>
<span id="cb16-12">        <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">"""Python 코드 분석"""</span></span>
<span id="cb16-13">        </span>
<span id="cb16-14">        <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># 1. 코드 읽기</span></span>
<span id="cb16-15">        <span class="cf" style="color: #003B4F;
background-color: null;
font-style: inherit;">with</span> <span class="bu" style="color: null;
background-color: null;
font-style: inherit;">open</span>(file_path, <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">'r'</span>) <span class="im" style="color: #00769E;
background-color: null;
font-style: inherit;">as</span> f:</span>
<span id="cb16-16">            code <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> f.read()</span>
<span id="cb16-17">        </span>
<span id="cb16-18">        <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># 2. AST 파싱</span></span>
<span id="cb16-19">        tree <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> ast.parse(code)</span>
<span id="cb16-20">        functions <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> [node.name <span class="cf" style="color: #003B4F;
background-color: null;
font-style: inherit;">for</span> node <span class="kw" style="color: #003B4F;
background-color: null;
font-style: inherit;">in</span> ast.walk(tree) </span>
<span id="cb16-21">                     <span class="cf" style="color: #003B4F;
background-color: null;
font-style: inherit;">if</span> <span class="bu" style="color: null;
background-color: null;
font-style: inherit;">isinstance</span>(node, ast.FunctionDef)]</span>
<span id="cb16-22">        </span>
<span id="cb16-23">        <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># 3. LLM 분석</span></span>
<span id="cb16-24">        prompt <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> <span class="ss" style="color: #20794D;
background-color: null;
font-style: inherit;">f"""</span></span>
<span id="cb16-25"><span class="ss" style="color: #20794D;
background-color: null;
font-style: inherit;">        다음 Python 코드를 분석해주세요:</span></span>
<span id="cb16-26"><span class="ss" style="color: #20794D;
background-color: null;
font-style: inherit;">        </span></span>
<span id="cb16-27"><span class="ss" style="color: #20794D;
background-color: null;
font-style: inherit;">        함수 목록: </span><span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">{</span>functions<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">}</span></span>
<span id="cb16-28"><span class="ss" style="color: #20794D;
background-color: null;
font-style: inherit;">        코드:</span></span>
<span id="cb16-29"><span class="ss" style="color: #20794D;
background-color: null;
font-style: inherit;">        ```python</span></span>
<span id="cb16-30"><span class="ss" style="color: #20794D;
background-color: null;
font-style: inherit;">        </span><span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">{</span>code<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">}</span></span>
<span id="cb16-31"><span class="ss" style="color: #20794D;
background-color: null;
font-style: inherit;">        ```</span></span>
<span id="cb16-32"><span class="ss" style="color: #20794D;
background-color: null;
font-style: inherit;">        </span></span>
<span id="cb16-33"><span class="ss" style="color: #20794D;
background-color: null;
font-style: inherit;">        분석 항목:</span></span>
<span id="cb16-34"><span class="ss" style="color: #20794D;
background-color: null;
font-style: inherit;">        1. 주요 기능</span></span>
<span id="cb16-35"><span class="ss" style="color: #20794D;
background-color: null;
font-style: inherit;">        2. 개선 제안</span></span>
<span id="cb16-36"><span class="ss" style="color: #20794D;
background-color: null;
font-style: inherit;">        3. 잠재적 버그</span></span>
<span id="cb16-37"><span class="ss" style="color: #20794D;
background-color: null;
font-style: inherit;">        """</span></span>
<span id="cb16-38">        </span>
<span id="cb16-39">        message <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> <span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">self</span>.client.messages.create(</span>
<span id="cb16-40">            model<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"claude-sonnet-4-20250514"</span>,</span>
<span id="cb16-41">            max_tokens<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">2000</span>,</span>
<span id="cb16-42">            messages<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span>[{<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"role"</span>: <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"user"</span>, <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"content"</span>: prompt}]</span>
<span id="cb16-43">        )</span>
<span id="cb16-44">        </span>
<span id="cb16-45">        <span class="cf" style="color: #003B4F;
background-color: null;
font-style: inherit;">return</span> message.content[<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">0</span>].text</span>
<span id="cb16-46"></span>
<span id="cb16-47"><span class="cf" style="color: #003B4F;
background-color: null;
font-style: inherit;">if</span> <span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">__name__</span> <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">==</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"__main__"</span>:</span>
<span id="cb16-48">    analyzer <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> CodeAnalyzer()</span>
<span id="cb16-49">    result <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> analyzer.analyze_python_file(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"src/main.py"</span>)</span>
<span id="cb16-50">    <span class="bu" style="color: null;
background-color: null;
font-style: inherit;">print</span>(result)</span></code></pre></div>
<div class="sourceCode" id="cb17" style="background: #f1f3f5;"><pre class="sourceCode numberSource python number-lines code-with-copy"><code class="sourceCode python"><span id="cb17-1"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># knowledge_qna_poc/chatbot.py</span></span>
<span id="cb17-2"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># 또 다른 방식으로 구현</span></span>
<span id="cb17-3"></span>
<span id="cb17-4"><span class="im" style="color: #00769E;
background-color: null;
font-style: inherit;">from</span> langchain_openai <span class="im" style="color: #00769E;
background-color: null;
font-style: inherit;">import</span> OpenAIEmbeddings, ChatOpenAI</span>
<span id="cb17-5"><span class="im" style="color: #00769E;
background-color: null;
font-style: inherit;">from</span> langchain_community.vectorstores <span class="im" style="color: #00769E;
background-color: null;
font-style: inherit;">import</span> Chroma</span>
<span id="cb17-6"><span class="im" style="color: #00769E;
background-color: null;
font-style: inherit;">from</span> langchain.chains <span class="im" style="color: #00769E;
background-color: null;
font-style: inherit;">import</span> RetrievalQA</span>
<span id="cb17-7"></span>
<span id="cb17-8"><span class="kw" style="color: #003B4F;
background-color: null;
font-style: inherit;">def</span> build_qna_bot(docs_path: <span class="bu" style="color: null;
background-color: null;
font-style: inherit;">str</span>):</span>
<span id="cb17-9">    <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">"""지식 기반 QnA 봇 구축"""</span></span>
<span id="cb17-10">    </span>
<span id="cb17-11">    <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># 1. 벡터 저장소 구축</span></span>
<span id="cb17-12">    embeddings <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> OpenAIEmbeddings()</span>
<span id="cb17-13">    vectorstore <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> Chroma.from_documents(</span>
<span id="cb17-14">        documents<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span>load_documents(docs_path),</span>
<span id="cb17-15">        embedding<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span>embeddings</span>
<span id="cb17-16">    )</span>
<span id="cb17-17">    </span>
<span id="cb17-18">    <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># 2. RAG 체인 구성</span></span>
<span id="cb17-19">    llm <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> ChatOpenAI(model<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"gpt-4"</span>, temperature<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">0</span>)</span>
<span id="cb17-20">    qa_chain <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> RetrievalQA.from_chain_type(</span>
<span id="cb17-21">        llm<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span>llm,</span>
<span id="cb17-22">        retriever<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span>vectorstore.as_retriever(),</span>
<span id="cb17-23">        return_source_documents<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span><span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">True</span></span>
<span id="cb17-24">    )</span>
<span id="cb17-25">    </span>
<span id="cb17-26">    <span class="cf" style="color: #003B4F;
background-color: null;
font-style: inherit;">return</span> qa_chain</span>
<span id="cb17-27"></span>
<span id="cb17-28"><span class="kw" style="color: #003B4F;
background-color: null;
font-style: inherit;">def</span> load_documents(docs_path: <span class="bu" style="color: null;
background-color: null;
font-style: inherit;">str</span>):</span>
<span id="cb17-29">    <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">"""문서 로드 로직"""</span></span>
<span id="cb17-30">    <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># 간단히 구현</span></span>
<span id="cb17-31">    <span class="cf" style="color: #003B4F;
background-color: null;
font-style: inherit;">pass</span></span>
<span id="cb17-32"></span>
<span id="cb17-33"><span class="cf" style="color: #003B4F;
background-color: null;
font-style: inherit;">if</span> <span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">__name__</span> <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">==</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"__main__"</span>:</span>
<span id="cb17-34">    qa_bot <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> build_qna_bot(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"docs/"</span>)</span>
<span id="cb17-35">    answer <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> qa_bot({<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"query"</span>: <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"데이터 표준화 정책은?"</span>})</span>
<span id="cb17-36">    <span class="bu" style="color: null;
background-color: null;
font-style: inherit;">print</span>(answer)</span></code></pre></div>
</section>
</section>
<section id="phase-2-공통-패턴-발견-1-1.5개월" class="level3" data-number="4.2">
<h3 data-number="4.2" class="anchored" data-anchor-id="phase-2-공통-패턴-발견-1-1.5개월"><span class="header-section-number">4.2</span> Phase 2: 공통 패턴 발견 (1-1.5개월)</h3>
<p><strong>목표</strong>: 3개 POC를 비교하여 공통 패턴 문서화</p>
<section id="실제-비교-작업" class="level4" data-number="4.2.1">
<h4 data-number="4.2.1" class="anchored" data-anchor-id="실제-비교-작업"><span class="header-section-number">4.2.1</span> 실제 비교 작업</h4>
<div class="sourceCode" id="cb18" style="background: #f1f3f5;"><pre class="sourceCode numberSource python number-lines code-with-copy"><code class="sourceCode python"><span id="cb18-1"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># 세 POC를 나란히 놓고 비교</span></span>
<span id="cb18-2"></span>
<span id="cb18-3"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># data_standardization_poc/main.py</span></span>
<span id="cb18-4"><span class="kw" style="color: #003B4F;
background-color: null;
font-style: inherit;">def</span> standardize_schema(file_path: <span class="bu" style="color: null;
background-color: null;
font-style: inherit;">str</span>) <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">-&gt;</span> <span class="bu" style="color: null;
background-color: null;
font-style: inherit;">dict</span>:</span>
<span id="cb18-5">    <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># 1. 데이터 로드</span></span>
<span id="cb18-6">    df <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> pd.read_csv(file_path)</span>
<span id="cb18-7">    </span>
<span id="cb18-8">    <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># 2. LLM 호출</span></span>
<span id="cb18-9">    client <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> OpenAI()</span>
<span id="cb18-10">    response <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> client.chat.completions.create(...)</span>
<span id="cb18-11">    </span>
<span id="cb18-12">    <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># 3. 결과 검증</span></span>
<span id="cb18-13">    validated <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> validate_json(response)</span>
<span id="cb18-14">    </span>
<span id="cb18-15">    <span class="cf" style="color: #003B4F;
background-color: null;
font-style: inherit;">return</span> validated</span>
<span id="cb18-16"></span>
<span id="cb18-17"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># code_analysis_poc/analyzer.py</span></span>
<span id="cb18-18"><span class="kw" style="color: #003B4F;
background-color: null;
font-style: inherit;">def</span> analyze_python_file(<span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">self</span>, file_path: <span class="bu" style="color: null;
background-color: null;
font-style: inherit;">str</span>) <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">-&gt;</span> <span class="bu" style="color: null;
background-color: null;
font-style: inherit;">str</span>:</span>
<span id="cb18-19">    <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># 1. 코드 로드</span></span>
<span id="cb18-20">    <span class="cf" style="color: #003B4F;
background-color: null;
font-style: inherit;">with</span> <span class="bu" style="color: null;
background-color: null;
font-style: inherit;">open</span>(file_path, <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">'r'</span>) <span class="im" style="color: #00769E;
background-color: null;
font-style: inherit;">as</span> f:</span>
<span id="cb18-21">        code <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> f.read()</span>
<span id="cb18-22">    </span>
<span id="cb18-23">    <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># 2. LLM 호출</span></span>
<span id="cb18-24">    client <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> Anthropic()</span>
<span id="cb18-25">    message <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> client.messages.create(...)</span>
<span id="cb18-26">    </span>
<span id="cb18-27">    <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># 3. 결과 검증</span></span>
<span id="cb18-28">    checked <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> validate_output(message.content[<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">0</span>].text)</span>
<span id="cb18-29">    </span>
<span id="cb18-30">    <span class="cf" style="color: #003B4F;
background-color: null;
font-style: inherit;">return</span> checked</span>
<span id="cb18-31"></span>
<span id="cb18-32"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># knowledge_qna_poc/chatbot.py</span></span>
<span id="cb18-33"><span class="kw" style="color: #003B4F;
background-color: null;
font-style: inherit;">def</span> answer_query(query: <span class="bu" style="color: null;
background-color: null;
font-style: inherit;">str</span>):</span>
<span id="cb18-34">    <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># 1. 문서 검색</span></span>
<span id="cb18-35">    docs <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> vectorstore.similarity_search(query)</span>
<span id="cb18-36">    </span>
<span id="cb18-37">    <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># 2. LLM 호출</span></span>
<span id="cb18-38">    llm <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> ChatOpenAI()</span>
<span id="cb18-39">    answer <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> llm.invoke(...)</span>
<span id="cb18-40">    </span>
<span id="cb18-41">    <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># 3. 결과 검증</span></span>
<span id="cb18-42">    verified <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> check_hallucination(answer)</span>
<span id="cb18-43">    </span>
<span id="cb18-44">    <span class="cf" style="color: #003B4F;
background-color: null;
font-style: inherit;">return</span> verified</span></code></pre></div>
</section>
<section id="패턴-문서-작성" class="level4" data-number="4.2.2">
<h4 data-number="4.2.2" class="anchored" data-anchor-id="패턴-문서-작성"><span class="header-section-number">4.2.2</span> 패턴 문서 작성</h4>
<div class="sourceCode" id="cb19" style="background: #f1f3f5;"><pre class="sourceCode numberSource markdown number-lines code-with-copy"><code class="sourceCode markdown"><span id="cb19-1"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;"># 공통 패턴 분석 (patterns.md)</span></span>
<span id="cb19-2"></span>
<span id="cb19-3"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">## 발견된 공통 패턴</span></span>
<span id="cb19-4"></span>
<span id="cb19-5"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">### LLM 호출 패턴</span></span>
<span id="cb19-6">**발견**: 세 Agent 모두 LLM API 호출</span>
<span id="cb19-7"></span>
<span id="cb19-8">**공통점**:</span>
<span id="cb19-9"><span class="ss" style="color: #20794D;
background-color: null;
font-style: inherit;">- </span>OpenAI 또는 Anthropic 사용</span>
<span id="cb19-10"><span class="ss" style="color: #20794D;
background-color: null;
font-style: inherit;">- </span>동일한 에러 핸들링 필요 (rate limit, timeout)</span>
<span id="cb19-11"><span class="ss" style="color: #20794D;
background-color: null;
font-style: inherit;">- </span>토큰 카운팅 및 비용 계산 필요</span>
<span id="cb19-12"><span class="ss" style="color: #20794D;
background-color: null;
font-style: inherit;">- </span>재시도 로직 (지수 백오프)</span>
<span id="cb19-13"></span>
<span id="cb19-14">**차이점**:</span>
<span id="cb19-15"><span class="ss" style="color: #20794D;
background-color: null;
font-style: inherit;">- </span>모델 선택 (GPT-4 vs Claude)</span>
<span id="cb19-16"><span class="ss" style="color: #20794D;
background-color: null;
font-style: inherit;">- </span>프롬프트 구조 (시스템 메시지 사용 여부)</span>
<span id="cb19-17"></span>
<span id="cb19-18">**추상화 방향**:</span>
<span id="cb19-19">→ <span class="in" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">`shared/llm/client.py`</span> 생성</span>
<span id="cb19-20">→ 공통 재시도 로직, 에러 처리 캡슐화</span>
<span id="cb19-21"></span>
<span id="cb19-22"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">### 입출력 패턴</span></span>
<span id="cb19-23">**발견**: 모두 Dict 형태로 입출력</span>
<span id="cb19-24"></span>
<span id="cb19-25">**공통점**:</span>
<span id="cb19-26"><span class="ss" style="color: #20794D;
background-color: null;
font-style: inherit;">- </span>입력: Dict 또는 유사 구조</span>
<span id="cb19-27"><span class="ss" style="color: #20794D;
background-color: null;
font-style: inherit;">- </span>출력: Dict 또는 유사 구조</span>
<span id="cb19-28"><span class="ss" style="color: #20794D;
background-color: null;
font-style: inherit;">- </span>JSON 직렬화 가능</span>
<span id="cb19-29"></span>
<span id="cb19-30">**차이점**:</span>
<span id="cb19-31"><span class="ss" style="color: #20794D;
background-color: null;
font-style: inherit;">- </span>키 이름 (schema vs code vs query)</span>
<span id="cb19-32"><span class="ss" style="color: #20794D;
background-color: null;
font-style: inherit;">- </span>중첩 깊이</span>
<span id="cb19-33"></span>
<span id="cb19-34">**추상화 방향**:</span>
<span id="cb19-35">→ BaseAgent.process(input: Dict) -&gt; Dict</span>
<span id="cb19-36">→ 표준 입출력 인터페이스 정의</span>
<span id="cb19-37"></span>
<span id="cb19-38"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">### 검증 패턴</span></span>
<span id="cb19-39">**발견**: 모두 LLM 출력 검증</span>
<span id="cb19-40"></span>
<span id="cb19-41">**공통점**:</span>
<span id="cb19-42"><span class="ss" style="color: #20794D;
background-color: null;
font-style: inherit;">- </span>JSON 파싱 시도</span>
<span id="cb19-43"><span class="ss" style="color: #20794D;
background-color: null;
font-style: inherit;">- </span>파싱 실패 시 재시도</span>
<span id="cb19-44"><span class="ss" style="color: #20794D;
background-color: null;
font-style: inherit;">- </span>스키마 검증</span>
<span id="cb19-45"></span>
<span id="cb19-46">**차이점**:</span>
<span id="cb19-47"><span class="ss" style="color: #20794D;
background-color: null;
font-style: inherit;">- </span>검증 로직 세부 사항</span>
<span id="cb19-48"><span class="ss" style="color: #20794D;
background-color: null;
font-style: inherit;">- </span>실패 시 처리 방식</span>
<span id="cb19-49"></span>
<span id="cb19-50">**추상화 방향**:</span>
<span id="cb19-51">→ <span class="in" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">`shared/validation/`</span> 모듈</span>
<span id="cb19-52">→ 공통 JSON 파서, 스키마 검증기</span>
<span id="cb19-53"></span>
<span id="cb19-54"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">### 로깅 패턴</span></span>
<span id="cb19-55">**발견**: 모두 로그 남김 (print 또는 logger)</span>
<span id="cb19-56"></span>
<span id="cb19-57">**공통점**:</span>
<span id="cb19-58"><span class="ss" style="color: #20794D;
background-color: null;
font-style: inherit;">- </span>실행 시작/종료 로그</span>
<span id="cb19-59"><span class="ss" style="color: #20794D;
background-color: null;
font-style: inherit;">- </span>에러 로그</span>
<span id="cb19-60"><span class="ss" style="color: #20794D;
background-color: null;
font-style: inherit;">- </span>실행 시간 측정</span>
<span id="cb19-61"></span>
<span id="cb19-62">**추상화 방향**:</span>
<span id="cb19-63">→ <span class="in" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">`shared/logging/`</span> 모듈</span>
<span id="cb19-64">→ 구조화된 로깅 (JSON logs)</span>
<span id="cb19-65"></span>
<span id="cb19-66"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">### 고유 패턴 (추상화 불필요)</span></span>
<span id="cb19-67"></span>
<span id="cb19-68">**데이터 표준화만**:</span>
<span id="cb19-69"><span class="ss" style="color: #20794D;
background-color: null;
font-style: inherit;">- </span>데이터베이스 스키마 저장</span>
<span id="cb19-70"><span class="ss" style="color: #20794D;
background-color: null;
font-style: inherit;">- </span>표준화 규칙 버전 관리</span>
<span id="cb19-71"></span>
<span id="cb19-72">**코드 분석만**:</span>
<span id="cb19-73"><span class="ss" style="color: #20794D;
background-color: null;
font-style: inherit;">- </span>Git 연동</span>
<span id="cb19-74"><span class="ss" style="color: #20794D;
background-color: null;
font-style: inherit;">- </span>다양한 언어 파서 (Python, Java 등)</span>
<span id="cb19-75"></span>
<span id="cb19-76">**지식 QnA만**:</span>
<span id="cb19-77"><span class="ss" style="color: #20794D;
background-color: null;
font-style: inherit;">- </span>벡터 저장소 관리</span>
<span id="cb19-78"><span class="ss" style="color: #20794D;
background-color: null;
font-style: inherit;">- </span>RAG 파이프라인</span>
<span id="cb19-79"></span>
<span id="cb19-80">→ 이것들은 각 Agent 고유 기능으로 유지</span></code></pre></div>
<hr>
</section>
</section>
<section id="phase-3-점진적-추상화-1.5-2.5개월" class="level3" data-number="4.3">
<h3 data-number="4.3" class="anchored" data-anchor-id="phase-3-점진적-추상화-1.5-2.5개월"><span class="header-section-number">4.3</span> Phase 3: 점진적 추상화 (1.5-2.5개월)</h3>
<p><strong>목표</strong>: 가장 명확한 패턴부터 순차적으로 추상화</p>
<section id="step-1-llm-클라이언트-추상화" class="level4" data-number="4.3.1">
<h4 data-number="4.3.1" class="anchored" data-anchor-id="step-1-llm-클라이언트-추상화"><span class="header-section-number">4.3.1</span> Step 1: LLM 클라이언트 추상화</h4>
<p><strong>가장 쉽고 명확한 공통 모듈부터 시작</strong></p>
<div class="sourceCode" id="cb20" style="background: #f1f3f5;"><pre class="sourceCode numberSource python number-lines code-with-copy"><code class="sourceCode python"><span id="cb20-1"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># shared/llm/client.py</span></span>
<span id="cb20-2"><span class="im" style="color: #00769E;
background-color: null;
font-style: inherit;">from</span> typing <span class="im" style="color: #00769E;
background-color: null;
font-style: inherit;">import</span> Optional, List</span>
<span id="cb20-3"><span class="im" style="color: #00769E;
background-color: null;
font-style: inherit;">from</span> openai <span class="im" style="color: #00769E;
background-color: null;
font-style: inherit;">import</span> OpenAI</span>
<span id="cb20-4"><span class="im" style="color: #00769E;
background-color: null;
font-style: inherit;">from</span> anthropic <span class="im" style="color: #00769E;
background-color: null;
font-style: inherit;">import</span> Anthropic</span>
<span id="cb20-5"><span class="im" style="color: #00769E;
background-color: null;
font-style: inherit;">import</span> time</span>
<span id="cb20-6"></span>
<span id="cb20-7"><span class="kw" style="color: #003B4F;
background-color: null;
font-style: inherit;">class</span> LLMClient:</span>
<span id="cb20-8">    <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">"""세 POC에서 발견된 공통 LLM 호출 패턴</span></span>
<span id="cb20-9"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">    </span></span>
<span id="cb20-10"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">    공통 기능:</span></span>
<span id="cb20-11"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">    - 재시도 로직 (지수 백오프)</span></span>
<span id="cb20-12"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">    - 에러 핸들링 (rate limit, timeout)</span></span>
<span id="cb20-13"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">    - 토큰 카운팅</span></span>
<span id="cb20-14"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">    - 비용 계산</span></span>
<span id="cb20-15"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">    """</span></span>
<span id="cb20-16">    </span>
<span id="cb20-17">    <span class="kw" style="color: #003B4F;
background-color: null;
font-style: inherit;">def</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">__init__</span>(</span>
<span id="cb20-18">        <span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">self</span>, </span>
<span id="cb20-19">        provider: <span class="bu" style="color: null;
background-color: null;
font-style: inherit;">str</span> <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"openai"</span>,</span>
<span id="cb20-20">        model: <span class="bu" style="color: null;
background-color: null;
font-style: inherit;">str</span> <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"gpt-4"</span>,</span>
<span id="cb20-21">        max_retries: <span class="bu" style="color: null;
background-color: null;
font-style: inherit;">int</span> <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">3</span></span>
<span id="cb20-22">    ):</span>
<span id="cb20-23">        <span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">self</span>.provider <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> provider</span>
<span id="cb20-24">        <span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">self</span>.model <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> model</span>
<span id="cb20-25">        <span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">self</span>.max_retries <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> max_retries</span>
<span id="cb20-26">        </span>
<span id="cb20-27">        <span class="cf" style="color: #003B4F;
background-color: null;
font-style: inherit;">if</span> provider <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">==</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"openai"</span>:</span>
<span id="cb20-28">            <span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">self</span>.client <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> OpenAI()</span>
<span id="cb20-29">        <span class="cf" style="color: #003B4F;
background-color: null;
font-style: inherit;">elif</span> provider <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">==</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"anthropic"</span>:</span>
<span id="cb20-30">            <span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">self</span>.client <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> Anthropic()</span>
<span id="cb20-31">        <span class="cf" style="color: #003B4F;
background-color: null;
font-style: inherit;">else</span>:</span>
<span id="cb20-32">            <span class="cf" style="color: #003B4F;
background-color: null;
font-style: inherit;">raise</span> <span class="pp" style="color: #AD0000;
background-color: null;
font-style: inherit;">ValueError</span>(<span class="ss" style="color: #20794D;
background-color: null;
font-style: inherit;">f"Unsupported provider: </span><span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">{</span>provider<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">}</span><span class="ss" style="color: #20794D;
background-color: null;
font-style: inherit;">"</span>)</span>
<span id="cb20-33">    </span>
<span id="cb20-34">    <span class="kw" style="color: #003B4F;
background-color: null;
font-style: inherit;">def</span> generate(</span>
<span id="cb20-35">        <span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">self</span>, </span>
<span id="cb20-36">        prompt: <span class="bu" style="color: null;
background-color: null;
font-style: inherit;">str</span>, </span>
<span id="cb20-37">        system_message: Optional[<span class="bu" style="color: null;
background-color: null;
font-style: inherit;">str</span>] <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> <span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">None</span></span>
<span id="cb20-38">    ) <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">-&gt;</span> <span class="bu" style="color: null;
background-color: null;
font-style: inherit;">str</span>:</span>
<span id="cb20-39">        <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">"""텍스트 생성 (재시도 로직 포함)"""</span></span>
<span id="cb20-40">        </span>
<span id="cb20-41">        <span class="cf" style="color: #003B4F;
background-color: null;
font-style: inherit;">for</span> attempt <span class="kw" style="color: #003B4F;
background-color: null;
font-style: inherit;">in</span> <span class="bu" style="color: null;
background-color: null;
font-style: inherit;">range</span>(<span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">self</span>.max_retries):</span>
<span id="cb20-42">            <span class="cf" style="color: #003B4F;
background-color: null;
font-style: inherit;">try</span>:</span>
<span id="cb20-43">                <span class="cf" style="color: #003B4F;
background-color: null;
font-style: inherit;">if</span> <span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">self</span>.provider <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">==</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"openai"</span>:</span>
<span id="cb20-44">                    <span class="cf" style="color: #003B4F;
background-color: null;
font-style: inherit;">return</span> <span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">self</span>._call_openai(prompt, system_message)</span>
<span id="cb20-45">                <span class="cf" style="color: #003B4F;
background-color: null;
font-style: inherit;">elif</span> <span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">self</span>.provider <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">==</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"anthropic"</span>:</span>
<span id="cb20-46">                    <span class="cf" style="color: #003B4F;
background-color: null;
font-style: inherit;">return</span> <span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">self</span>._call_anthropic(prompt, system_message)</span>
<span id="cb20-47">                    </span>
<span id="cb20-48">            <span class="cf" style="color: #003B4F;
background-color: null;
font-style: inherit;">except</span> <span class="pp" style="color: #AD0000;
background-color: null;
font-style: inherit;">Exception</span> <span class="im" style="color: #00769E;
background-color: null;
font-style: inherit;">as</span> e:</span>
<span id="cb20-49">                <span class="cf" style="color: #003B4F;
background-color: null;
font-style: inherit;">if</span> attempt <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">&lt;</span> <span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">self</span>.max_retries <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">-</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span>:</span>
<span id="cb20-50">                    wait_time <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">2</span> <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">**</span> attempt  <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># 지수 백오프</span></span>
<span id="cb20-51">                    <span class="bu" style="color: null;
background-color: null;
font-style: inherit;">print</span>(<span class="ss" style="color: #20794D;
background-color: null;
font-style: inherit;">f"Retry </span><span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">{</span>attempt <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span><span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">}</span><span class="ss" style="color: #20794D;
background-color: null;
font-style: inherit;">/</span><span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">{</span><span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">self</span><span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">.</span>max_retries<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">}</span><span class="ss" style="color: #20794D;
background-color: null;
font-style: inherit;"> after </span><span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">{</span>wait_time<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">}</span><span class="ss" style="color: #20794D;
background-color: null;
font-style: inherit;">s"</span>)</span>
<span id="cb20-52">                    time.sleep(wait_time)</span>
<span id="cb20-53">                <span class="cf" style="color: #003B4F;
background-color: null;
font-style: inherit;">else</span>:</span>
<span id="cb20-54">                    <span class="cf" style="color: #003B4F;
background-color: null;
font-style: inherit;">raise</span></span>
<span id="cb20-55">    </span>
<span id="cb20-56">    <span class="kw" style="color: #003B4F;
background-color: null;
font-style: inherit;">def</span> _call_openai(<span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">self</span>, prompt: <span class="bu" style="color: null;
background-color: null;
font-style: inherit;">str</span>, system_message: Optional[<span class="bu" style="color: null;
background-color: null;
font-style: inherit;">str</span>]) <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">-&gt;</span> <span class="bu" style="color: null;
background-color: null;
font-style: inherit;">str</span>:</span>
<span id="cb20-57">        <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">"""OpenAI API 호출"""</span></span>
<span id="cb20-58">        messages <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> []</span>
<span id="cb20-59">        <span class="cf" style="color: #003B4F;
background-color: null;
font-style: inherit;">if</span> system_message:</span>
<span id="cb20-60">            messages.append({<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"role"</span>: <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"system"</span>, <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"content"</span>: system_message})</span>
<span id="cb20-61">        messages.append({<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"role"</span>: <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"user"</span>, <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"content"</span>: prompt})</span>
<span id="cb20-62">        </span>
<span id="cb20-63">        response <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> <span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">self</span>.client.chat.completions.create(</span>
<span id="cb20-64">            model<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span><span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">self</span>.model,</span>
<span id="cb20-65">            messages<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span>messages</span>
<span id="cb20-66">        )</span>
<span id="cb20-67">        <span class="cf" style="color: #003B4F;
background-color: null;
font-style: inherit;">return</span> response.choices[<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">0</span>].message.content</span>
<span id="cb20-68">    </span>
<span id="cb20-69">    <span class="kw" style="color: #003B4F;
background-color: null;
font-style: inherit;">def</span> _call_anthropic(<span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">self</span>, prompt: <span class="bu" style="color: null;
background-color: null;
font-style: inherit;">str</span>, system_message: Optional[<span class="bu" style="color: null;
background-color: null;
font-style: inherit;">str</span>]) <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">-&gt;</span> <span class="bu" style="color: null;
background-color: null;
font-style: inherit;">str</span>:</span>
<span id="cb20-70">        <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">"""Anthropic API 호출"""</span></span>
<span id="cb20-71">        message <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> <span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">self</span>.client.messages.create(</span>
<span id="cb20-72">            model<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span><span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">self</span>.model,</span>
<span id="cb20-73">            max_tokens<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">2000</span>,</span>
<span id="cb20-74">            system<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span>system_message <span class="kw" style="color: #003B4F;
background-color: null;
font-style: inherit;">or</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">""</span>,</span>
<span id="cb20-75">            messages<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span>[{<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"role"</span>: <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"user"</span>, <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"content"</span>: prompt}]</span>
<span id="cb20-76">        )</span>
<span id="cb20-77">        <span class="cf" style="color: #003B4F;
background-color: null;
font-style: inherit;">return</span> message.content[<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">0</span>].text</span></code></pre></div>
<p><strong>POC 리팩토링</strong>:</p>
<div class="sourceCode" id="cb21" style="background: #f1f3f5;"><pre class="sourceCode numberSource python number-lines code-with-copy"><code class="sourceCode python"><span id="cb21-1"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># data_standardization_poc/main.py (리팩토링 후)</span></span>
<span id="cb21-2"><span class="im" style="color: #00769E;
background-color: null;
font-style: inherit;">from</span> shared.llm.client <span class="im" style="color: #00769E;
background-color: null;
font-style: inherit;">import</span> LLMClient</span>
<span id="cb21-3"></span>
<span id="cb21-4"><span class="kw" style="color: #003B4F;
background-color: null;
font-style: inherit;">def</span> standardize_schema(file_path: <span class="bu" style="color: null;
background-color: null;
font-style: inherit;">str</span>) <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">-&gt;</span> <span class="bu" style="color: null;
background-color: null;
font-style: inherit;">dict</span>:</span>
<span id="cb21-5">    <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># LLM 클라이언트 사용 (중복 코드 제거!)</span></span>
<span id="cb21-6">    llm <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> LLMClient(provider<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"openai"</span>, model<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"gpt-4"</span>)</span>
<span id="cb21-7">    </span>
<span id="cb21-8">    df <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> pd.read_csv(file_path)</span>
<span id="cb21-9">    prompt <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> <span class="ss" style="color: #20794D;
background-color: null;
font-style: inherit;">f"표준화해줘: </span><span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">{</span>df<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">.</span>head()<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">}</span><span class="ss" style="color: #20794D;
background-color: null;
font-style: inherit;">"</span></span>
<span id="cb21-10">    </span>
<span id="cb21-11">    <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># 재시도 로직, 에러 핸들링 자동 적용</span></span>
<span id="cb21-12">    result <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> llm.generate(prompt)</span>
<span id="cb21-13">    <span class="cf" style="color: #003B4F;
background-color: null;
font-style: inherit;">return</span> {<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"standardized"</span>: result}</span></code></pre></div>
<p><strong>검증</strong>: 3개 POC 모두 잘 작동하는가? → Yes → 다음 단계</p>
</section>
<section id="step-2-baseagent-최소-버전" class="level4" data-number="4.3.2">
<h4 data-number="4.3.2" class="anchored" data-anchor-id="step-2-baseagent-최소-버전"><span class="header-section-number">4.3.2</span> Step 2: BaseAgent 최소 버전</h4>
<p><strong>3개 POC의 공통 구조를 추상화</strong></p>
<div class="sourceCode" id="cb22" style="background: #f1f3f5;"><pre class="sourceCode numberSource python number-lines code-with-copy"><code class="sourceCode python"><span id="cb22-1"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># core/agent/base_agent.py</span></span>
<span id="cb22-2"><span class="im" style="color: #00769E;
background-color: null;
font-style: inherit;">from</span> abc <span class="im" style="color: #00769E;
background-color: null;
font-style: inherit;">import</span> ABC, abstractmethod</span>
<span id="cb22-3"><span class="im" style="color: #00769E;
background-color: null;
font-style: inherit;">from</span> typing <span class="im" style="color: #00769E;
background-color: null;
font-style: inherit;">import</span> Dict, Any</span>
<span id="cb22-4"></span>
<span id="cb22-5"><span class="kw" style="color: #003B4F;
background-color: null;
font-style: inherit;">class</span> BaseAgent(ABC):</span>
<span id="cb22-6">    <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">"""3개 POC에서 발견된 최소 공통 인터페이스</span></span>
<span id="cb22-7"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">    </span></span>
<span id="cb22-8"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">    공통점:</span></span>
<span id="cb22-9"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">    - 모두 입력 받아 처리 후 출력</span></span>
<span id="cb22-10"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">    - 모두 Dict 형태 입출력</span></span>
<span id="cb22-11"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">    </span></span>
<span id="cb22-12"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">    차이점 (아직 추상화 안 함):</span></span>
<span id="cb22-13"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">    - 초기화 방식</span></span>
<span id="cb22-14"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">    - 평가 메트릭</span></span>
<span id="cb22-15"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">    """</span></span>
<span id="cb22-16">    </span>
<span id="cb22-17">    <span class="kw" style="color: #003B4F;
background-color: null;
font-style: inherit;">def</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">__init__</span>(<span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">self</span>, name: <span class="bu" style="color: null;
background-color: null;
font-style: inherit;">str</span>, version: <span class="bu" style="color: null;
background-color: null;
font-style: inherit;">str</span> <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"1.0.0"</span>):</span>
<span id="cb22-18">        <span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">self</span>.name <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> name</span>
<span id="cb22-19">        <span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">self</span>.version <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> version</span>
<span id="cb22-20">    </span>
<span id="cb22-21">    <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">@abstractmethod</span></span>
<span id="cb22-22">    <span class="kw" style="color: #003B4F;
background-color: null;
font-style: inherit;">def</span> process(<span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">self</span>, <span class="bu" style="color: null;
background-color: null;
font-style: inherit;">input</span>: Dict[<span class="bu" style="color: null;
background-color: null;
font-style: inherit;">str</span>, Any]) <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">-&gt;</span> Dict[<span class="bu" style="color: null;
background-color: null;
font-style: inherit;">str</span>, Any]:</span>
<span id="cb22-23">        <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">"""핵심 처리 로직</span></span>
<span id="cb22-24"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">        </span></span>
<span id="cb22-25"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">        왜 Dict[str, Any]?</span></span>
<span id="cb22-26"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">        - 세 POC 모두 Dict 또는 유사 구조 사용</span></span>
<span id="cb22-27"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">        - 유연성 (각 Agent가 필요한 키 자유롭게 정의)</span></span>
<span id="cb22-28"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">        - 직렬화 용이 (JSON 변환)</span></span>
<span id="cb22-29"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">        """</span></span>
<span id="cb22-30">        <span class="cf" style="color: #003B4F;
background-color: null;
font-style: inherit;">pass</span></span></code></pre></div>
<p><strong>POC를 BaseAgent로 변환</strong>:</p>
<div class="sourceCode" id="cb23" style="background: #f1f3f5;"><pre class="sourceCode numberSource python number-lines code-with-copy"><code class="sourceCode python"><span id="cb23-1"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># agents/data_standardization/agent.py</span></span>
<span id="cb23-2"><span class="im" style="color: #00769E;
background-color: null;
font-style: inherit;">from</span> core.agent <span class="im" style="color: #00769E;
background-color: null;
font-style: inherit;">import</span> BaseAgent</span>
<span id="cb23-3"><span class="im" style="color: #00769E;
background-color: null;
font-style: inherit;">from</span> shared.llm.client <span class="im" style="color: #00769E;
background-color: null;
font-style: inherit;">import</span> LLMClient</span>
<span id="cb23-4"></span>
<span id="cb23-5"><span class="kw" style="color: #003B4F;
background-color: null;
font-style: inherit;">class</span> DataStandardizationAgent(BaseAgent):</span>
<span id="cb23-6">    <span class="kw" style="color: #003B4F;
background-color: null;
font-style: inherit;">def</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">__init__</span>(<span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">self</span>):</span>
<span id="cb23-7">        <span class="bu" style="color: null;
background-color: null;
font-style: inherit;">super</span>().<span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">__init__</span>(name<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"data_standardization"</span>, version<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"1.0.0"</span>)</span>
<span id="cb23-8">        <span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">self</span>.llm <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> LLMClient(provider<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"openai"</span>)</span>
<span id="cb23-9">    </span>
<span id="cb23-10">    <span class="kw" style="color: #003B4F;
background-color: null;
font-style: inherit;">def</span> process(<span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">self</span>, <span class="bu" style="color: null;
background-color: null;
font-style: inherit;">input</span>: Dict[<span class="bu" style="color: null;
background-color: null;
font-style: inherit;">str</span>, Any]) <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">-&gt;</span> Dict[<span class="bu" style="color: null;
background-color: null;
font-style: inherit;">str</span>, Any]:</span>
<span id="cb23-11">        <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">"""POC 코드를 거의 그대로 복사"""</span></span>
<span id="cb23-12">        file_path <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> <span class="bu" style="color: null;
background-color: null;
font-style: inherit;">input</span>[<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"file_path"</span>]</span>
<span id="cb23-13">        </span>
<span id="cb23-14">        <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># 기존 POC 로직</span></span>
<span id="cb23-15">        df <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> pd.read_csv(file_path)</span>
<span id="cb23-16">        prompt <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> <span class="ss" style="color: #20794D;
background-color: null;
font-style: inherit;">f"표준화: </span><span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">{</span>df<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">.</span>head()<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">}</span><span class="ss" style="color: #20794D;
background-color: null;
font-style: inherit;">"</span></span>
<span id="cb23-17">        result <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> <span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">self</span>.llm.generate(prompt)</span>
<span id="cb23-18">        </span>
<span id="cb23-19">        <span class="cf" style="color: #003B4F;
background-color: null;
font-style: inherit;">return</span> {<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"standardized_schema"</span>: result}</span></code></pre></div>
<div class="sourceCode" id="cb24" style="background: #f1f3f5;"><pre class="sourceCode numberSource python number-lines code-with-copy"><code class="sourceCode python"><span id="cb24-1"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># agents/code_analysis/agent.py</span></span>
<span id="cb24-2"><span class="im" style="color: #00769E;
background-color: null;
font-style: inherit;">from</span> core.agent <span class="im" style="color: #00769E;
background-color: null;
font-style: inherit;">import</span> BaseAgent</span>
<span id="cb24-3"><span class="im" style="color: #00769E;
background-color: null;
font-style: inherit;">from</span> shared.llm.client <span class="im" style="color: #00769E;
background-color: null;
font-style: inherit;">import</span> LLMClient</span>
<span id="cb24-4"></span>
<span id="cb24-5"><span class="kw" style="color: #003B4F;
background-color: null;
font-style: inherit;">class</span> CodeAnalysisAgent(BaseAgent):</span>
<span id="cb24-6">    <span class="kw" style="color: #003B4F;
background-color: null;
font-style: inherit;">def</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">__init__</span>(<span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">self</span>):</span>
<span id="cb24-7">        <span class="bu" style="color: null;
background-color: null;
font-style: inherit;">super</span>().<span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">__init__</span>(name<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"code_analysis"</span>, version<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"1.0.0"</span>)</span>
<span id="cb24-8">        <span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">self</span>.llm <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> LLMClient(provider<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"anthropic"</span>)</span>
<span id="cb24-9">    </span>
<span id="cb24-10">    <span class="kw" style="color: #003B4F;
background-color: null;
font-style: inherit;">def</span> process(<span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">self</span>, <span class="bu" style="color: null;
background-color: null;
font-style: inherit;">input</span>: Dict[<span class="bu" style="color: null;
background-color: null;
font-style: inherit;">str</span>, Any]) <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">-&gt;</span> Dict[<span class="bu" style="color: null;
background-color: null;
font-style: inherit;">str</span>, Any]:</span>
<span id="cb24-11">        <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">"""POC 코드를 거의 그대로 복사"""</span></span>
<span id="cb24-12">        code_path <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> <span class="bu" style="color: null;
background-color: null;
font-style: inherit;">input</span>[<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"code_path"</span>]</span>
<span id="cb24-13">        </span>
<span id="cb24-14">        <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># 기존 POC 로직</span></span>
<span id="cb24-15">        <span class="cf" style="color: #003B4F;
background-color: null;
font-style: inherit;">with</span> <span class="bu" style="color: null;
background-color: null;
font-style: inherit;">open</span>(code_path, <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">'r'</span>) <span class="im" style="color: #00769E;
background-color: null;
font-style: inherit;">as</span> f:</span>
<span id="cb24-16">            code <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> f.read()</span>
<span id="cb24-17">        </span>
<span id="cb24-18">        prompt <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> <span class="ss" style="color: #20794D;
background-color: null;
font-style: inherit;">f"분석: </span><span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">{</span>code<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">}</span><span class="ss" style="color: #20794D;
background-color: null;
font-style: inherit;">"</span></span>
<span id="cb24-19">        analysis <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> <span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">self</span>.llm.generate(prompt)</span>
<span id="cb24-20">        </span>
<span id="cb24-21">        <span class="cf" style="color: #003B4F;
background-color: null;
font-style: inherit;">return</span> {<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"analysis"</span>: analysis}</span></code></pre></div>
<p><strong>검증</strong>: 3개 Agent 모두 BaseAgent로 변환 완료? → Yes → 다음 단계</p>
</section>
<section id="step-3-플랫폼-오케스트레이터" class="level4" data-number="4.3.3">
<h4 data-number="4.3.3" class="anchored" data-anchor-id="step-3-플랫폼-오케스트레이터"><span class="header-section-number">4.3.3</span> Step 3: 플랫폼 오케스트레이터</h4>
<p><strong>이제 통일된 인터페이스로 관리 가능</strong></p>
<div class="sourceCode" id="cb25" style="background: #f1f3f5;"><pre class="sourceCode numberSource python number-lines code-with-copy"><code class="sourceCode python"><span id="cb25-1"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># core/orchestrator.py</span></span>
<span id="cb25-2"><span class="im" style="color: #00769E;
background-color: null;
font-style: inherit;">from</span> typing <span class="im" style="color: #00769E;
background-color: null;
font-style: inherit;">import</span> Dict</span>
<span id="cb25-3"><span class="im" style="color: #00769E;
background-color: null;
font-style: inherit;">from</span> core.agent <span class="im" style="color: #00769E;
background-color: null;
font-style: inherit;">import</span> BaseAgent</span>
<span id="cb25-4"></span>
<span id="cb25-5"><span class="kw" style="color: #003B4F;
background-color: null;
font-style: inherit;">class</span> AgentOrchestrator:</span>
<span id="cb25-6">    <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">"""Agent 등록 및 실행 관리"""</span></span>
<span id="cb25-7">    </span>
<span id="cb25-8">    <span class="kw" style="color: #003B4F;
background-color: null;
font-style: inherit;">def</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">__init__</span>(<span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">self</span>):</span>
<span id="cb25-9">        <span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">self</span>.agents: Dict[<span class="bu" style="color: null;
background-color: null;
font-style: inherit;">str</span>, BaseAgent] <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> {}</span>
<span id="cb25-10">    </span>
<span id="cb25-11">    <span class="kw" style="color: #003B4F;
background-color: null;
font-style: inherit;">def</span> register(<span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">self</span>, agent: BaseAgent):</span>
<span id="cb25-12">        <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">"""Agent 등록"""</span></span>
<span id="cb25-13">        <span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">self</span>.agents[agent.name] <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> agent</span>
<span id="cb25-14">        <span class="bu" style="color: null;
background-color: null;
font-style: inherit;">print</span>(<span class="ss" style="color: #20794D;
background-color: null;
font-style: inherit;">f"Registered: </span><span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">{</span>agent<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">.</span>name<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">}</span><span class="ss" style="color: #20794D;
background-color: null;
font-style: inherit;"> v</span><span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">{</span>agent<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">.</span>version<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">}</span><span class="ss" style="color: #20794D;
background-color: null;
font-style: inherit;">"</span>)</span>
<span id="cb25-15">    </span>
<span id="cb25-16">    <span class="kw" style="color: #003B4F;
background-color: null;
font-style: inherit;">def</span> run(<span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">self</span>, agent_name: <span class="bu" style="color: null;
background-color: null;
font-style: inherit;">str</span>, input_data: Dict) <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">-&gt;</span> Dict:</span>
<span id="cb25-17">        <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">"""Agent 실행"""</span></span>
<span id="cb25-18">        <span class="cf" style="color: #003B4F;
background-color: null;
font-style: inherit;">if</span> agent_name <span class="kw" style="color: #003B4F;
background-color: null;
font-style: inherit;">not</span> <span class="kw" style="color: #003B4F;
background-color: null;
font-style: inherit;">in</span> <span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">self</span>.agents:</span>
<span id="cb25-19">            <span class="cf" style="color: #003B4F;
background-color: null;
font-style: inherit;">raise</span> <span class="pp" style="color: #AD0000;
background-color: null;
font-style: inherit;">ValueError</span>(<span class="ss" style="color: #20794D;
background-color: null;
font-style: inherit;">f"Unknown agent: </span><span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">{</span>agent_name<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">}</span><span class="ss" style="color: #20794D;
background-color: null;
font-style: inherit;">"</span>)</span>
<span id="cb25-20">        </span>
<span id="cb25-21">        agent <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> <span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">self</span>.agents[agent_name]</span>
<span id="cb25-22">        <span class="cf" style="color: #003B4F;
background-color: null;
font-style: inherit;">return</span> agent.process(input_data)</span>
<span id="cb25-23">    </span>
<span id="cb25-24">    <span class="kw" style="color: #003B4F;
background-color: null;
font-style: inherit;">def</span> chain(<span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">self</span>, agent_names: List[<span class="bu" style="color: null;
background-color: null;
font-style: inherit;">str</span>], input_data: Dict) <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">-&gt;</span> Dict:</span>
<span id="cb25-25">        <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">"""Agent 체이닝"""</span></span>
<span id="cb25-26">        result <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> input_data</span>
<span id="cb25-27">        <span class="cf" style="color: #003B4F;
background-color: null;
font-style: inherit;">for</span> agent_name <span class="kw" style="color: #003B4F;
background-color: null;
font-style: inherit;">in</span> agent_names:</span>
<span id="cb25-28">            result <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> <span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">self</span>.run(agent_name, result)</span>
<span id="cb25-29">        <span class="cf" style="color: #003B4F;
background-color: null;
font-style: inherit;">return</span> result</span>
<span id="cb25-30"></span>
<span id="cb25-31"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># 사용 예시</span></span>
<span id="cb25-32">orchestrator <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> AgentOrchestrator()</span>
<span id="cb25-33"></span>
<span id="cb25-34"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># Agent 등록</span></span>
<span id="cb25-35">orchestrator.register(DataStandardizationAgent())</span>
<span id="cb25-36">orchestrator.register(CodeAnalysisAgent())</span>
<span id="cb25-37">orchestrator.register(KnowledgeQnAAgent())</span>
<span id="cb25-38"></span>
<span id="cb25-39"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># 통일된 방식으로 실행</span></span>
<span id="cb25-40">result <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> orchestrator.run(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"data_standardization"</span>, {</span>
<span id="cb25-41">    <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"file_path"</span>: <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"data/sample.csv"</span></span>
<span id="cb25-42">})</span></code></pre></div>
</section>
<section id="step-4-점진적-기능-추가" class="level4" data-number="4.3.4">
<h4 data-number="4.3.4" class="anchored" data-anchor-id="step-4-점진적-기능-추가"><span class="header-section-number">4.3.4</span> Step 4: 점진적 기능 추가</h4>
<p><strong>이제 필요한 기능을 하나씩 추가</strong></p>
<div class="sourceCode" id="cb26" style="background: #f1f3f5;"><pre class="sourceCode numberSource python number-lines code-with-copy"><code class="sourceCode python"><span id="cb26-1"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># core/agent/base_agent.py (v2)</span></span>
<span id="cb26-2"><span class="im" style="color: #00769E;
background-color: null;
font-style: inherit;">from</span> abc <span class="im" style="color: #00769E;
background-color: null;
font-style: inherit;">import</span> ABC, abstractmethod</span>
<span id="cb26-3"><span class="im" style="color: #00769E;
background-color: null;
font-style: inherit;">from</span> typing <span class="im" style="color: #00769E;
background-color: null;
font-style: inherit;">import</span> Dict, Any</span>
<span id="cb26-4"><span class="im" style="color: #00769E;
background-color: null;
font-style: inherit;">import</span> time</span>
<span id="cb26-5"></span>
<span id="cb26-6"><span class="kw" style="color: #003B4F;
background-color: null;
font-style: inherit;">class</span> BaseAgent(ABC):</span>
<span id="cb26-7">    <span class="kw" style="color: #003B4F;
background-color: null;
font-style: inherit;">def</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">__init__</span>(<span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">self</span>, name: <span class="bu" style="color: null;
background-color: null;
font-style: inherit;">str</span>, version: <span class="bu" style="color: null;
background-color: null;
font-style: inherit;">str</span> <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"1.0.0"</span>):</span>
<span id="cb26-8">        <span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">self</span>.name <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> name</span>
<span id="cb26-9">        <span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">self</span>.version <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> version</span>
<span id="cb26-10">        <span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">self</span>.execution_count <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">0</span></span>
<span id="cb26-11">        <span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">self</span>.total_time <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> <span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">0.0</span></span>
<span id="cb26-12">    </span>
<span id="cb26-13">    <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">@abstractmethod</span></span>
<span id="cb26-14">    <span class="kw" style="color: #003B4F;
background-color: null;
font-style: inherit;">def</span> process(<span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">self</span>, <span class="bu" style="color: null;
background-color: null;
font-style: inherit;">input</span>: Dict[<span class="bu" style="color: null;
background-color: null;
font-style: inherit;">str</span>, Any]) <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">-&gt;</span> Dict[<span class="bu" style="color: null;
background-color: null;
font-style: inherit;">str</span>, Any]:</span>
<span id="cb26-15">        <span class="cf" style="color: #003B4F;
background-color: null;
font-style: inherit;">pass</span></span>
<span id="cb26-16">    </span>
<span id="cb26-17">    <span class="kw" style="color: #003B4F;
background-color: null;
font-style: inherit;">def</span> execute(<span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">self</span>, <span class="bu" style="color: null;
background-color: null;
font-style: inherit;">input</span>: Dict[<span class="bu" style="color: null;
background-color: null;
font-style: inherit;">str</span>, Any]) <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">-&gt;</span> Dict[<span class="bu" style="color: null;
background-color: null;
font-style: inherit;">str</span>, Any]:</span>
<span id="cb26-18">        <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">"""실행 래퍼 (모니터링 추가)"""</span></span>
<span id="cb26-19">        start_time <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> time.time()</span>
<span id="cb26-20">        </span>
<span id="cb26-21">        <span class="cf" style="color: #003B4F;
background-color: null;
font-style: inherit;">try</span>:</span>
<span id="cb26-22">            result <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> <span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">self</span>.process(<span class="bu" style="color: null;
background-color: null;
font-style: inherit;">input</span>)</span>
<span id="cb26-23">            <span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">self</span>.execution_count <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+=</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span></span>
<span id="cb26-24">            <span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">self</span>.total_time <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+=</span> time.time() <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">-</span> start_time</span>
<span id="cb26-25">            <span class="cf" style="color: #003B4F;
background-color: null;
font-style: inherit;">return</span> result</span>
<span id="cb26-26">        <span class="cf" style="color: #003B4F;
background-color: null;
font-style: inherit;">except</span> <span class="pp" style="color: #AD0000;
background-color: null;
font-style: inherit;">Exception</span> <span class="im" style="color: #00769E;
background-color: null;
font-style: inherit;">as</span> e:</span>
<span id="cb26-27">            <span class="bu" style="color: null;
background-color: null;
font-style: inherit;">print</span>(<span class="ss" style="color: #20794D;
background-color: null;
font-style: inherit;">f"Error in </span><span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">{</span><span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">self</span><span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">.</span>name<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">}</span><span class="ss" style="color: #20794D;
background-color: null;
font-style: inherit;">: </span><span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">{</span>e<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">}</span><span class="ss" style="color: #20794D;
background-color: null;
font-style: inherit;">"</span>)</span>
<span id="cb26-28">            <span class="cf" style="color: #003B4F;
background-color: null;
font-style: inherit;">raise</span></span>
<span id="cb26-29">    </span>
<span id="cb26-30">    <span class="kw" style="color: #003B4F;
background-color: null;
font-style: inherit;">def</span> get_metrics(<span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">self</span>) <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">-&gt;</span> Dict[<span class="bu" style="color: null;
background-color: null;
font-style: inherit;">str</span>, Any]:</span>
<span id="cb26-31">        <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">"""성능 메트릭"""</span></span>
<span id="cb26-32">        <span class="cf" style="color: #003B4F;
background-color: null;
font-style: inherit;">return</span> {</span>
<span id="cb26-33">            <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"name"</span>: <span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">self</span>.name,</span>
<span id="cb26-34">            <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"execution_count"</span>: <span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">self</span>.execution_count,</span>
<span id="cb26-35">            <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"avg_time"</span>: <span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">self</span>.total_time <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">/</span> <span class="bu" style="color: null;
background-color: null;
font-style: inherit;">max</span>(<span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">self</span>.execution_count, <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span>)</span>
<span id="cb26-36">        }</span></code></pre></div>
</section>
</section>
<section id="phase-4-새-agent-추가-2.5개월" class="level3" data-number="4.4">
<h3 data-number="4.4" class="anchored" data-anchor-id="phase-4-새-agent-추가-2.5개월"><span class="header-section-number">4.4</span> Phase 4: 새 Agent 추가 (2.5개월+)</h3>
<p><strong>이제 추상화가 준비됨 - 새 Agent 추가가 쉬워짐</strong></p>
<div class="sourceCode" id="cb27" style="background: #f1f3f5;"><pre class="sourceCode numberSource python number-lines code-with-copy"><code class="sourceCode python"><span id="cb27-1"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># agents/experiment_analyzer/agent.py</span></span>
<span id="cb27-2"><span class="im" style="color: #00769E;
background-color: null;
font-style: inherit;">from</span> core.agent <span class="im" style="color: #00769E;
background-color: null;
font-style: inherit;">import</span> BaseAgent</span>
<span id="cb27-3"><span class="im" style="color: #00769E;
background-color: null;
font-style: inherit;">from</span> shared.llm.client <span class="im" style="color: #00769E;
background-color: null;
font-style: inherit;">import</span> LLMClient</span>
<span id="cb27-4"></span>
<span id="cb27-5"><span class="kw" style="color: #003B4F;
background-color: null;
font-style: inherit;">class</span> ExperimentAnalyzer(BaseAgent):</span>
<span id="cb27-6">    <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">"""실험 데이터 분석 Agent (새로 추가)"""</span></span>
<span id="cb27-7">    </span>
<span id="cb27-8">    <span class="kw" style="color: #003B4F;
background-color: null;
font-style: inherit;">def</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">__init__</span>(<span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">self</span>):</span>
<span id="cb27-9">        <span class="bu" style="color: null;
background-color: null;
font-style: inherit;">super</span>().<span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">__init__</span>(name<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"experiment_analyzer"</span>, version<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"1.0.0"</span>)</span>
<span id="cb27-10">        <span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">self</span>.llm <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> LLMClient()  <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># 공통 모듈 재사용</span></span>
<span id="cb27-11">    </span>
<span id="cb27-12">    <span class="kw" style="color: #003B4F;
background-color: null;
font-style: inherit;">def</span> process(<span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">self</span>, <span class="bu" style="color: null;
background-color: null;
font-style: inherit;">input</span>: Dict[<span class="bu" style="color: null;
background-color: null;
font-style: inherit;">str</span>, Any]) <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">-&gt;</span> Dict[<span class="bu" style="color: null;
background-color: null;
font-style: inherit;">str</span>, Any]:</span>
<span id="cb27-13">        <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">"""기존 패턴을 따라 구현"""</span></span>
<span id="cb27-14">        experiment_data <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> <span class="bu" style="color: null;
background-color: null;
font-style: inherit;">input</span>[<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"data"</span>]</span>
<span id="cb27-15">        </span>
<span id="cb27-16">        <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># 표준화된 LLM 호출</span></span>
<span id="cb27-17">        prompt <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> <span class="ss" style="color: #20794D;
background-color: null;
font-style: inherit;">f"""</span></span>
<span id="cb27-18"><span class="ss" style="color: #20794D;
background-color: null;
font-style: inherit;">        실험 데이터를 분석해주세요:</span></span>
<span id="cb27-19"><span class="ss" style="color: #20794D;
background-color: null;
font-style: inherit;">        </span><span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">{</span>experiment_data<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">}</span></span>
<span id="cb27-20"><span class="ss" style="color: #20794D;
background-color: null;
font-style: inherit;">        """</span></span>
<span id="cb27-21">        analysis <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> <span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">self</span>.llm.generate(prompt)</span>
<span id="cb27-22">        </span>
<span id="cb27-23">        <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># 표준 출력 형식</span></span>
<span id="cb27-24">        <span class="cf" style="color: #003B4F;
background-color: null;
font-style: inherit;">return</span> {</span>
<span id="cb27-25">            <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"analysis"</span>: analysis,</span>
<span id="cb27-26">            <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"experiment_id"</span>: <span class="bu" style="color: null;
background-color: null;
font-style: inherit;">input</span>.get(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"experiment_id"</span>)</span>
<span id="cb27-27">        }</span>
<span id="cb27-28"></span>
<span id="cb27-29"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># 등록 및 사용</span></span>
<span id="cb27-30">orchestrator.register(ExperimentAnalyzer())</span>
<span id="cb27-31">result <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> orchestrator.run(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"experiment_analyzer"</span>, {</span>
<span id="cb27-32">    <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"data"</span>: <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"..."</span>,</span>
<span id="cb27-33">    <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"experiment_id"</span>: <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"EXP-001"</span></span>
<span id="cb27-34">})</span></code></pre></div>
<p><strong>소요 시간</strong>: 2-3시간 (POC 때는 2-3일 걸렸던 것!)</p>
</section>
</section>
<section id="최종-플랫폼-구조" class="level2" data-number="5">
<h2 data-number="5" class="anchored" data-anchor-id="최종-플랫폼-구조"><span class="header-section-number">5</span> 최종 플랫폼 구조</h2>
<pre><code>ai-agent-platform/                # Monorepo
├── core/                         # 플랫폼 코어
│   ├── agent/
│   │   ├── base_agent.py        # BaseAgent 추상 클래스
│   │   └── registry.py          # Agent 등록 시스템
│   ├── orchestrator.py          # Agent 실행 관리
│   └── monitoring.py            # 메트릭 수집
│
├── shared/                       # 공통 모듈
│   ├── llm/
│   │   ├── client.py           # LLM 클라이언트 (POC에서 추출)
│   │   └── prompt_template.py
│   ├── validation/
│   │   ├── json_parser.py
│   │   └── schema_validator.py
│   └── logging/
│       └── structured_logger.py
│
├── agents/                       # Agent 구현
│   ├── data_standardization/
│   │   ├── agent.py            # POC에서 변환
│   │   ├── rules/
│   │   └── tests/
│   ├── code_analysis/
│   │   ├── agent.py            # POC에서 변환
│   │   ├── parsers/
│   │   └── tests/
│   ├── knowledge_qna/
│   │   ├── agent.py            # POC에서 변환
│   │   ├── rag_pipeline.py
│   │   └── tests/
│   └── experiment_analyzer/     # 새로 추가된 Agent
│       ├── agent.py
│       └── tests/
│
├── platform-api/                 # API Gateway
│   ├── main.py
│   └── routes/
│
├── agents-poc/                   # 보관용 (삭제하지 말 것!)
│   ├── data_standardization_poc/
│   ├── code_analysis_poc/
│   └── knowledge_qna_poc/
│
└── pyproject.toml</code></pre>
<section id="agents-poc-보관용으로-남겨줘야-하는-이유" class="level3" data-number="5.1">
<h3 data-number="5.1" class="anchored" data-anchor-id="agents-poc-보관용으로-남겨줘야-하는-이유"><span class="header-section-number">5.1</span> agents-poc/ (보관용으로 남겨줘야 하는 이유)</h3>
<p><strong>agents-poc/ 폴더를 삭제하지 말아야 하는 5가지 이유</strong>:</p>
<section id="검증된-로직의-보존" class="level4" data-number="5.1.1">
<h4 data-number="5.1.1" class="anchored" data-anchor-id="검증된-로직의-보존"><span class="header-section-number">5.1.1</span> <strong>검증된 로직의 보존</strong></h4>
<div class="sourceCode" id="cb29" style="background: #f1f3f5;"><pre class="sourceCode numberSource python number-lines code-with-copy"><code class="sourceCode python"><span id="cb29-1"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># POC에서 실제로 작동했던 코드</span></span>
<span id="cb29-2"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># 수백 번의 시행착오 끝에 완성된 프롬프트, 파싱 로직 등</span></span></code></pre></div>
<ul>
<li>실제 사용자 피드백을 받아 검증된 코드<br>
</li>
<li>이미 작동하는 것이 증명됨</li>
</ul>
</section>
<section id="엣지-케이스의-기록" class="level4" data-number="5.1.2">
<h4 data-number="5.1.2" class="anchored" data-anchor-id="엣지-케이스의-기록"><span class="header-section-number">5.1.2</span> <strong>엣지 케이스의 기록</strong></h4>
<div class="sourceCode" id="cb30" style="background: #f1f3f5;"><pre class="sourceCode numberSource python number-lines code-with-copy"><code class="sourceCode python"><span id="cb30-1"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># POC 개발 중 발견한 예외 상황들</span></span>
<span id="cb30-2"><span class="cf" style="color: #003B4F;
background-color: null;
font-style: inherit;">if</span> special_case_for_korean_characters:</span>
<span id="cb30-3">    <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># 한글 인코딩 이슈 해결</span></span>
<span id="cb30-4"><span class="cf" style="color: #003B4F;
background-color: null;
font-style: inherit;">if</span> data_has_null_values:</span>
<span id="cb30-5">    <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># None 처리 로직</span></span></code></pre></div>
<ul>
<li>개발 중 부딪힌 모든 예외 상황과 해결책이 담겨있음<br>
</li>
<li>다시 구현하면 같은 문제를 또 겪게 됨</li>
</ul>
</section>
<section id="점진적-리팩토링의-기준점" class="level4" data-number="5.1.3">
<h4 data-number="5.1.3" class="anchored" data-anchor-id="점진적-리팩토링의-기준점"><span class="header-section-number">5.1.3</span> <strong>점진적 리팩토링의 기준점</strong></h4>
<div class="sourceCode" id="cb31" style="background: #f1f3f5;"><pre class="sourceCode numberSource python number-lines code-with-copy"><code class="sourceCode python"><span id="cb31-1"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># agents-poc/의 코드를 보면서</span></span>
<span id="cb31-2"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># → agents/로 옮기면서 추상화</span></span>
<span id="cb31-3"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># </span></span>
<span id="cb31-4"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># POC 없으면: 처음부터 다시 구현 (2-3일)</span></span>
<span id="cb31-5"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># POC 있으면: 리팩토링만 (2-3시간)</span></span></code></pre></div>
</section>
<section id="회귀-테스트의-기준" class="level4" data-number="5.1.4">
<h4 data-number="5.1.4" class="anchored" data-anchor-id="회귀-테스트의-기준"><span class="header-section-number">5.1.4</span> <strong>회귀 테스트의 기준</strong></h4>
<div class="sourceCode" id="cb32" style="background: #f1f3f5;"><pre class="sourceCode numberSource python number-lines code-with-copy"><code class="sourceCode python"><span id="cb32-1"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># POC의 출력 vs 추상화 후의 출력 비교</span></span>
<span id="cb32-2"><span class="cf" style="color: #003B4F;
background-color: null;
font-style: inherit;">assert</span> new_agent_output <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">==</span> poc_output</span>
<span id="cb32-3"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># 추상화가 기능을 망가뜨리지 않았는지 확인</span></span></code></pre></div>
</section>
<section id="문서화의-역할" class="level4" data-number="5.1.5">
<h4 data-number="5.1.5" class="anchored" data-anchor-id="문서화의-역할"><span class="header-section-number">5.1.5</span> <strong>문서화의 역할</strong></h4>
<ul>
<li>왜 이렇게 구현했는지 이유가 코드에 남아있음<br>
</li>
<li>새 팀원이 코드를 이해하는 데 도움</li>
</ul>
<p><strong>실제 사례</strong>:</p>
<div class="sourceCode" id="cb33" style="background: #f1f3f5;"><pre class="sourceCode numberSource python number-lines code-with-copy"><code class="sourceCode python"><span id="cb33-1"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># ❌ Airbnb가 초기에 한 실수</span></span>
<span id="cb33-2"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># 10개 ML 파이프라인 POC → 추상화하면서 POC 삭제</span></span>
<span id="cb33-3"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># 결과: 6개월 후 왜 이렇게 했는지 아무도 모름</span></span>
<span id="cb33-4"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># 다시 만드는 데 3개월 추가 소요</span></span>
<span id="cb33-5"></span>
<span id="cb33-6"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># ✅ Google의 접근</span></span>
<span id="cb33-7"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># 오래된 시스템도 참고용으로 보관</span></span>
<span id="cb33-8"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># 새 시스템 설계 시 과거 실수 반복 안 함</span></span></code></pre></div>
<p><strong>결론</strong>: POC는 <strong>“프로젝트의 배경 및 동기가 되는 작동하는 참고 자료”</strong>다. 삭제하면 암묵지가 생성된다.</p>
</section>
</section>
</section>
<section id="실증-사례-bottom-up-접근의-성공" class="level2" data-number="6">
<h2 data-number="6" class="anchored" data-anchor-id="실증-사례-bottom-up-접근의-성공"><span class="header-section-number">6</span> 실증 사례: Bottom-Up 접근의 성공</h2>
<section id="amazon의-aws" class="level3" data-number="6.1">
<h3 data-number="6.1" class="anchored" data-anchor-id="amazon의-aws"><span class="header-section-number">6.1</span> Amazon의 AWS</h3>
<p><strong>초기 (2000-2003)</strong>: - Amazon 내부 팀들이 각자 인프라 구축 - 중복이 심각했지만 “일단 만들었음”</p>
<p><strong>패턴 발견 (2003-2004)</strong>: - 3년간 축적된 사례를 분석 - 공통 패턴 발견: 컴퓨팅, 스토리지, 네트워킹</p>
<p><strong>추상화 (2004-2006)</strong>: - EC2, S3 등으로 추상화 - <strong>결과</strong>: 세계 최대 클라우드 플랫폼</p>
<p><strong>교훈</strong>: 3년간 구체적 사례 없었으면 AWS는 실패했을 것</p>
</section>
<section id="airbnb의-ml-플랫폼" class="level3" data-number="6.2">
<h3 data-number="6.2" class="anchored" data-anchor-id="airbnb의-ml-플랫폼"><span class="header-section-number">6.2</span> Airbnb의 ML 플랫폼</h3>
<p><strong>초기 (2015-2016)</strong>: - 10개 팀이 각자 ML 파이프라인 구축 - 중복 코드 60% (당시는 문제로 인식 안 함)</p>
<p><strong>패턴 발견 (2016-2017)</strong>: - 10개 파이프라인을 나란히 놓고 비교 - Feature engineering, 평가 로직이 90% 동일</p>
<p><strong>추상화 (2017-2018)</strong>: - Zipline 플랫폼 구축 - <strong>결과</strong>: 새 모델 개발 시간 40% 단축</p>
<p><strong>교훈</strong>: 10개 구체적 사례가 있었기에 올바른 추상화 가능</p>
</section>
</section>
<section id="안티패턴-피해야-할-실수" class="level2" data-number="7">
<h2 data-number="7" class="anchored" data-anchor-id="안티패턴-피해야-할-실수"><span class="header-section-number">7</span> 안티패턴: 피해야 할 실수</h2>
<section id="과도한-초기-추상화" class="level3" data-number="7.1">
<h3 data-number="7.1" class="anchored" data-anchor-id="과도한-초기-추상화"><span class="header-section-number">7.1</span> 과도한 초기 추상화</h3>
<div class="sourceCode" id="cb34" style="background: #f1f3f5;"><pre class="sourceCode numberSource python number-lines code-with-copy"><code class="sourceCode python"><span id="cb34-1"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># ❌ 나쁜 예: 미래를 대비한 과도한 설계</span></span>
<span id="cb34-2"><span class="kw" style="color: #003B4F;
background-color: null;
font-style: inherit;">class</span> BaseAgent(ABC):</span>
<span id="cb34-3">    <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">@abstractmethod</span></span>
<span id="cb34-4">    <span class="kw" style="color: #003B4F;
background-color: null;
font-style: inherit;">def</span> initialize(<span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">self</span>): <span class="cf" style="color: #003B4F;
background-color: null;
font-style: inherit;">pass</span></span>
<span id="cb34-5">    </span>
<span id="cb34-6">    <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">@abstractmethod</span></span>
<span id="cb34-7">    <span class="kw" style="color: #003B4F;
background-color: null;
font-style: inherit;">def</span> configure(<span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">self</span>): <span class="cf" style="color: #003B4F;
background-color: null;
font-style: inherit;">pass</span></span>
<span id="cb34-8">    </span>
<span id="cb34-9">    <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">@abstractmethod</span></span>
<span id="cb34-10">    <span class="kw" style="color: #003B4F;
background-color: null;
font-style: inherit;">def</span> validate_config(<span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">self</span>): <span class="cf" style="color: #003B4F;
background-color: null;
font-style: inherit;">pass</span></span>
<span id="cb34-11">    </span>
<span id="cb34-12">    <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">@abstractmethod</span></span>
<span id="cb34-13">    <span class="kw" style="color: #003B4F;
background-color: null;
font-style: inherit;">def</span> preprocess(<span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">self</span>, data): <span class="cf" style="color: #003B4F;
background-color: null;
font-style: inherit;">pass</span></span>
<span id="cb34-14">    </span>
<span id="cb34-15">    <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">@abstractmethod</span></span>
<span id="cb34-16">    <span class="kw" style="color: #003B4F;
background-color: null;
font-style: inherit;">def</span> process(<span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">self</span>, data): <span class="cf" style="color: #003B4F;
background-color: null;
font-style: inherit;">pass</span></span>
<span id="cb34-17">    </span>
<span id="cb34-18">    <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">@abstractmethod</span></span>
<span id="cb34-19">    <span class="kw" style="color: #003B4F;
background-color: null;
font-style: inherit;">def</span> postprocess(<span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">self</span>, data): <span class="cf" style="color: #003B4F;
background-color: null;
font-style: inherit;">pass</span></span>
<span id="cb34-20">    </span>
<span id="cb34-21">    <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">@abstractmethod</span></span>
<span id="cb34-22">    <span class="kw" style="color: #003B4F;
background-color: null;
font-style: inherit;">def</span> evaluate(<span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">self</span>, data): <span class="cf" style="color: #003B4F;
background-color: null;
font-style: inherit;">pass</span></span>
<span id="cb34-23">    </span>
<span id="cb34-24">    <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">@abstractmethod</span></span>
<span id="cb34-25">    <span class="kw" style="color: #003B4F;
background-color: null;
font-style: inherit;">def</span> cleanup(<span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">self</span>): <span class="cf" style="color: #003B4F;
background-color: null;
font-style: inherit;">pass</span></span>
<span id="cb34-26">    </span>
<span id="cb34-27">    <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">@abstractmethod</span></span>
<span id="cb34-28">    <span class="kw" style="color: #003B4F;
background-color: null;
font-style: inherit;">def</span> rollback(<span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">self</span>): <span class="cf" style="color: #003B4F;
background-color: null;
font-style: inherit;">pass</span></span>
<span id="cb34-29">    </span>
<span id="cb34-30">    <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">@abstractmethod</span></span>
<span id="cb34-31">    <span class="kw" style="color: #003B4F;
background-color: null;
font-style: inherit;">def</span> healthcheck(<span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">self</span>): <span class="cf" style="color: #003B4F;
background-color: null;
font-style: inherit;">pass</span></span>
<span id="cb34-32">    </span>
<span id="cb34-33">    <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">@abstractmethod</span></span>
<span id="cb34-34">    <span class="kw" style="color: #003B4F;
background-color: null;
font-style: inherit;">def</span> serialize(<span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">self</span>): <span class="cf" style="color: #003B4F;
background-color: null;
font-style: inherit;">pass</span></span>
<span id="cb34-35">    </span>
<span id="cb34-36">    <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">@abstractmethod</span></span>
<span id="cb34-37">    <span class="kw" style="color: #003B4F;
background-color: null;
font-style: inherit;">def</span> deserialize(<span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">self</span>): <span class="cf" style="color: #003B4F;
background-color: null;
font-style: inherit;">pass</span></span>
<span id="cb34-38"></span>
<span id="cb34-39"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># 문제: 실제로는 process()와 evaluate()만 필요했음</span></span>
<span id="cb34-40"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># 나머지는 Agent마다 필요 여부가 다름</span></span>
<span id="cb34-41"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># 억지로 빈 메서드를 구현하게 됨</span></span></code></pre></div>
</section>
<section id="poc-버리기" class="level3" data-number="7.2">
<h3 data-number="7.2" class="anchored" data-anchor-id="poc-버리기"><span class="header-section-number">7.2</span> POC 버리기</h3>
<div class="sourceCode" id="cb35" style="background: #f1f3f5;"><pre class="sourceCode numberSource python number-lines code-with-copy"><code class="sourceCode python"><span id="cb35-1"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># ❌ 나쁜 예: POC를 완전히 버리고 처음부터 재작성</span></span>
<span id="cb35-2"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># agents-poc/ 폴더 삭제</span></span>
<span id="cb35-3"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># 새로운 구조로 처음부터 다시 작성</span></span>
<span id="cb35-4"></span>
<span id="cb35-5"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># 문제:</span></span>
<span id="cb35-6"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># 1. POC에서 발견한 엣지 케이스 손실</span></span>
<span id="cb35-7"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># 2. 사용자 피드백이 반영된 세부 로직 손실</span></span>
<span id="cb35-8"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># 3. 검증된 프롬프트 손실</span></span>
<span id="cb35-9"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># 4. 개발 시간 2배 소요</span></span>
<span id="cb35-10"></span>
<span id="cb35-11"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># ✅ 올바른 접근:</span></span>
<span id="cb35-12"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># agents-poc/ 폴더 보관</span></span>
<span id="cb35-13"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># POC 코드를 BaseAgent로 점진적 리팩토링</span></span>
<span id="cb35-14"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># 핵심 로직은 최대한 재사용</span></span></code></pre></div>
</section>
<section id="개-사례로-추상화" class="level3" data-number="7.3">
<h3 data-number="7.3" class="anchored" data-anchor-id="개-사례로-추상화"><span class="header-section-number">7.3</span> 2개 사례로 추상화</h3>
<div class="sourceCode" id="cb36" style="background: #f1f3f5;"><pre class="sourceCode numberSource python number-lines code-with-copy"><code class="sourceCode python"><span id="cb36-1"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># ❌ 나쁜 예: 2개 Agent만 보고 추상화</span></span>
<span id="cb36-2"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># Agent 2개: 데이터 표준화, 코드 분석</span></span>
<span id="cb36-3"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># 둘 다 파일 입력 받음</span></span>
<span id="cb36-4"></span>
<span id="cb36-5"><span class="kw" style="color: #003B4F;
background-color: null;
font-style: inherit;">class</span> BaseAgent(ABC):</span>
<span id="cb36-6">    <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">@abstractmethod</span></span>
<span id="cb36-7">    <span class="kw" style="color: #003B4F;
background-color: null;
font-style: inherit;">def</span> process_file(<span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">self</span>, file_path: <span class="bu" style="color: null;
background-color: null;
font-style: inherit;">str</span>) <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">-&gt;</span> <span class="bu" style="color: null;
background-color: null;
font-style: inherit;">dict</span>:</span>
<span id="cb36-8">        <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">"""파일 기반 처리"""</span></span>
<span id="cb36-9">        <span class="cf" style="color: #003B4F;
background-color: null;
font-style: inherit;">pass</span></span>
<span id="cb36-10"></span>
<span id="cb36-11"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># 문제: 3번째 Agent (지식 QnA)는 파일이 아닌 텍스트 질의 입력</span></span>
<span id="cb36-12"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># 인터페이스 재설계 필요</span></span>
<span id="cb36-13"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># 기존 Agent도 영향받음</span></span>
<span id="cb36-14"></span>
<span id="cb36-15"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># ✅ 올바른 접근:</span></span>
<span id="cb36-16"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># 최소 3개 이상의 사례로 시작하는 것이 좋은 출발이 될 수 있다.</span></span>
<span id="cb36-17"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># 2개 사례: 공통점이 우연일 수 있음 (50% 확률)</span></span>
<span id="cb36-18"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># 3개 사례: 패턴이 실제 공통점일 가능성 높음 (87.5%)</span></span></code></pre></div>
</section>
</section>
<section id="agent-platform-framework-혼동-금지-langgraph의-역할" class="level2" data-number="8">
<h2 data-number="8" class="anchored" data-anchor-id="agent-platform-framework-혼동-금지-langgraph의-역할"><span class="header-section-number">8</span> Agent Platform Framework 혼동 금지: LangGraph의 역할</h2>
<section id="langgraph는-agent-내부-로직용" class="level3" data-number="8.1">
<h3 data-number="8.1" class="anchored" data-anchor-id="langgraph는-agent-내부-로직용"><span class="header-section-number">8.1</span> LangGraph는 Agent 내부 로직용</h3>
<p><strong>올바른 사용</strong>:</p>
<div class="sourceCode" id="cb37" style="background: #f1f3f5;"><pre class="sourceCode numberSource python number-lines code-with-copy"><code class="sourceCode python"><span id="cb37-1"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># agents/code_analysis/workflow.py</span></span>
<span id="cb37-2"><span class="im" style="color: #00769E;
background-color: null;
font-style: inherit;">from</span> langgraph.graph <span class="im" style="color: #00769E;
background-color: null;
font-style: inherit;">import</span> StateGraph</span>
<span id="cb37-3"></span>
<span id="cb37-4"><span class="kw" style="color: #003B4F;
background-color: null;
font-style: inherit;">def</span> build_analysis_workflow():</span>
<span id="cb37-5">    <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">"""복잡한 코드 분석 워크플로우 (Agent 내부)"""</span></span>
<span id="cb37-6">    workflow <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> StateGraph(AnalysisState)</span>
<span id="cb37-7">    </span>
<span id="cb37-8">    <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># Agent 내부의 복잡한 단계들</span></span>
<span id="cb37-9">    workflow.add_node(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"parse"</span>, parse_code)</span>
<span id="cb37-10">    workflow.add_node(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"analyze_ast"</span>, analyze_ast)</span>
<span id="cb37-11">    workflow.add_node(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"extract_deps"</span>, extract_dependencies)</span>
<span id="cb37-12">    workflow.add_node(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"suggest"</span>, generate_suggestions)</span>
<span id="cb37-13">    workflow.add_node(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"evaluate"</span>, evaluate_quality)</span>
<span id="cb37-14">    </span>
<span id="cb37-15">    <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># 조건부 분기</span></span>
<span id="cb37-16">    workflow.add_conditional_edges(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"evaluate"</span>, should_refine)</span>
<span id="cb37-17">    </span>
<span id="cb37-18">    <span class="cf" style="color: #003B4F;
background-color: null;
font-style: inherit;">return</span> workflow.<span class="bu" style="color: null;
background-color: null;
font-style: inherit;">compile</span>()</span>
<span id="cb37-19"></span>
<span id="cb37-20"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># agents/code_analysis/agent.py</span></span>
<span id="cb37-21"><span class="im" style="color: #00769E;
background-color: null;
font-style: inherit;">from</span> core.agent <span class="im" style="color: #00769E;
background-color: null;
font-style: inherit;">import</span> BaseAgent</span>
<span id="cb37-22"></span>
<span id="cb37-23"><span class="kw" style="color: #003B4F;
background-color: null;
font-style: inherit;">class</span> CodeAnalysisAgent(BaseAgent):</span>
<span id="cb37-24">    <span class="kw" style="color: #003B4F;
background-color: null;
font-style: inherit;">def</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">__init__</span>(<span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">self</span>):</span>
<span id="cb37-25">        <span class="bu" style="color: null;
background-color: null;
font-style: inherit;">super</span>().<span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">__init__</span>(name<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"code_analysis"</span>, version<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"1.0.0"</span>)</span>
<span id="cb37-26">        <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># LangGraph를 Agent 내부에서만 사용</span></span>
<span id="cb37-27">        <span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">self</span>.workflow <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> build_analysis_workflow()</span>
<span id="cb37-28">    </span>
<span id="cb37-29">    <span class="kw" style="color: #003B4F;
background-color: null;
font-style: inherit;">def</span> process(<span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">self</span>, <span class="bu" style="color: null;
background-color: null;
font-style: inherit;">input</span>: Dict[<span class="bu" style="color: null;
background-color: null;
font-style: inherit;">str</span>, Any]) <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">-&gt;</span> Dict[<span class="bu" style="color: null;
background-color: null;
font-style: inherit;">str</span>, Any]:</span>
<span id="cb37-30">        <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">"""BaseAgent 인터페이스 준수"""</span></span>
<span id="cb37-31">        <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># 내부적으로 복잡한 워크플로우 실행</span></span>
<span id="cb37-32">        result <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> <span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">self</span>.workflow.invoke(<span class="bu" style="color: null;
background-color: null;
font-style: inherit;">input</span>)</span>
<span id="cb37-33">        </span>
<span id="cb37-34">        <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># 표준 출력 형식으로 반환</span></span>
<span id="cb37-35">        <span class="cf" style="color: #003B4F;
background-color: null;
font-style: inherit;">return</span> {</span>
<span id="cb37-36">            <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"analysis"</span>: result[<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"suggestions"</span>],</span>
<span id="cb37-37">            <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"quality_score"</span>: result[<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"quality_score"</span>]</span>
<span id="cb37-38">        }</span></code></pre></div>
</section>
<section id="langgraph는-플랫폼-레벨에-사용하지-않음" class="level3" data-number="8.2">
<h3 data-number="8.2" class="anchored" data-anchor-id="langgraph는-플랫폼-레벨에-사용하지-않음"><span class="header-section-number">8.2</span> LangGraph는 플랫폼 레벨에 사용하지 않음</h3>
<div class="sourceCode" id="cb38" style="background: #f1f3f5;"><pre class="sourceCode numberSource python number-lines code-with-copy"><code class="sourceCode python"><span id="cb38-1"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># ❌ 플랫폼을 LangGraph로 구현하지 말 것</span></span>
<span id="cb38-2"><span class="im" style="color: #00769E;
background-color: null;
font-style: inherit;">from</span> langgraph.graph <span class="im" style="color: #00769E;
background-color: null;
font-style: inherit;">import</span> StateGraph</span>
<span id="cb38-3"></span>
<span id="cb38-4"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># 플랫폼 레벨 그래프 (잘못됨)</span></span>
<span id="cb38-5">platform_graph <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> StateGraph(PlatformState)</span>
<span id="cb38-6">platform_graph.add_node(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"data_std"</span>, DataStandardizationAgent)</span>
<span id="cb38-7">platform_graph.add_node(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"code_analysis"</span>, CodeAnalysisAgent)</span>
<span id="cb38-8"></span>
<span id="cb38-9"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># 문제:</span></span>
<span id="cb38-10"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># 1. 공통 모듈 재사용 전략 없음</span></span>
<span id="cb38-11"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># 2. Agent 독립 배포 불가능</span></span>
<span id="cb38-12"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># 3. 사용자별 접근 제어 없음</span></span>
<span id="cb38-13"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># 4. 모니터링 및 운영 기능 부재</span></span></code></pre></div>
</section>
</section>
<section id="참고문헌" class="level2" data-number="9">
<h2 data-number="9" class="anchored" data-anchor-id="참고문헌"><span class="header-section-number">9</span> 참고문헌</h2>
<p><strong>플랫폼 아키텍처</strong>: - Burns, B., et al.&nbsp;(2016). “Borg, Omega, and Kubernetes.” ACM Queue. - Potvin, R., &amp; Levenberg, J. (2016). “Why Google Stores Billions of Lines of Code in a Single Repository.” ACM Queue.</p>
<p><strong>소프트웨어 설계</strong>: - Fowler, M. (2004). “Refactoring to Patterns.” Addison-Wesley. - Martin, R. C. (2017). “Clean Architecture.” Prentice Hall.</p>
<p><strong>ML 플랫폼 사례</strong>: - Hermann, J., &amp; Del Balso, M. (2017). “Meet Michelangelo: Uber’s Machine Learning Platform.” Uber Engineering Blog. - Bernstein, P., et al.&nbsp;(2019). “Scaling Airbnb’s Experimentation Platform.” Airbnb Engineering &amp; Data Science.</p>
<p><strong>실증 연구</strong>: - Breck, E., et al.&nbsp;(2017). “The ML Test Score: A Rubric for ML Production Readiness.” NIPS. - Sculley, D., et al.&nbsp;(2015). “Hidden Technical Debt in Machine Learning Systems.” NIPS.</p>


</section>

 ]]></description>
  <category>Engineering</category>
  <category>System</category>
  <category>Architecture Design</category>
  <category>Agent</category>
  <category>Platform</category>
  <guid>kk3225.netlify.app/docs/blog/posts/Engineering/System/Archi_Design/platform/2.agent_platform_design_strategy.html</guid>
  <pubDate>Mon, 26 Jan 2026 15:00:00 GMT</pubDate>
</item>
<item>
  <title>AI Agent 플랫폼 구축의 관점 선택</title>
  <dc:creator>Kwangmin Kim</dc:creator>
  <link>kk3225.netlify.app/docs/blog/posts/Engineering/System/Archi_Design/platform/1.agent_platform_overview.html</link>
  <description><![CDATA[ 





<section id="들어가며" class="level1" data-number="1">
<h1 data-number="1"><span class="header-section-number">1</span> 들어가며</h1>
<p>AI 에이전트를 효율적으로 양산하고 관리하는 플랫폼을 구축하려면 먼저 “어떤 관점으로 접근할 것인가”를 명확히 해야 한다. 같은 문제라도 <strong>Platform Engineering</strong>, <strong>Software Architecture</strong>, <strong>Systems Engineering</strong> 관점에서 보면 완전히 다른 질문과 해결책이 나온다.</p>
<p>이 글에서는 세 가지 관점의 정의와 차이점을 명확히 하고, AI Agent 플랫폼 구축에 가장 적합한 관점을 선택한다. 실제 글로벌 기업들(Spotify, Netflix, Airbnb)의 플랫폼 구축 사례를 통해 각 관점이 어떻게 적용되는지 살펴본다.</p>
</section>
<section id="세-가지-관점의-용어-정의" class="level1" data-number="2">
<h1 data-number="2"><span class="header-section-number">2</span> 세 가지 관점의 용어 정의</h1>
<section id="소프트웨어-아키텍처-software-architecture" class="level2" data-number="2.1">
<h2 data-number="2.1" class="anchored" data-anchor-id="소프트웨어-아키텍처-software-architecture"><span class="header-section-number">2.1</span> 소프트웨어 아키텍처 (Software Architecture)</h2>
<ul>
<li>소프트웨어 아키텍처: 시스템의 <strong>구조, 컴포넌트 간 관계, 설계 원칙</strong>을 결정하는 활동이다.<br>
</li>
<li>“<strong>10년 후에도 이 시스템이 유지 가능한가?</strong>”라는 장기적 관점에서 기술적 의사결정을 내린다.</li>
</ul>
<section id="컴포넌트component란" class="level3" data-number="2.1.1">
<h3 data-number="2.1.1" class="anchored" data-anchor-id="컴포넌트component란"><span class="header-section-number">2.1.1</span> “컴포넌트(Component)”란?</h3>
<ul>
<li>소프트웨어 공학의 <strong>표준 용어</strong>로, <strong>독립적으로 배포/교체 가능한 시스템 구성 단위</strong>를 의미한다.</li>
<li>모듈, 라이브러리, 서비스, 클래스 등 다양한 수준에서 사용된다.</li>
</ul>
<div class="sourceCode" id="cb1" style="background: #f1f3f5;"><pre class="sourceCode numberSource python number-lines code-with-copy"><code class="sourceCode python"><span id="cb1-1"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># 일반적인 웹 서비스의 컴포넌트 예시</span></span>
<span id="cb1-2">웹 서비스<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">/</span></span>
<span id="cb1-3">├── Frontend (React)              <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># UI 컴포넌트</span></span>
<span id="cb1-4">├── API Gateway                   <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># 인증/라우팅 컴포넌트</span></span>
<span id="cb1-5">├── User Service                  <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># 사용자 관리 컴포넌트</span></span>
<span id="cb1-6">├── Payment Service               <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># 결제 처리 컴포넌트</span></span>
<span id="cb1-7">└── Database                      <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># 데이터 저장 컴포넌트</span></span>
<span id="cb1-8"></span>
<span id="cb1-9"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># AI Agent 플랫폼의 컴포넌트</span></span>
<span id="cb1-10">ai<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">-</span>agent<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">-</span>platform<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">/</span></span>
<span id="cb1-11">├── core<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">/</span>                         <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># 플랫폼 핵심 컴포넌트</span></span>
<span id="cb1-12">│   ├── base_agent.py            <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># BaseAgent 클래스</span></span>
<span id="cb1-13">│   └── orchestrator.py           <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># Agent 관리자</span></span>
<span id="cb1-14">│</span>
<span id="cb1-15">├── shared<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">/</span>                       <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># 공통 라이브러리 컴포넌트</span></span>
<span id="cb1-16">│   ├── llm_client.py            <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># LLM API 호출</span></span>
<span id="cb1-17">│   └── monitoring.py             <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># 메트릭 수집</span></span>
<span id="cb1-18">│</span>
<span id="cb1-19">└── agents<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">/</span>                       <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># 도메인 Agent 컴포넌트</span></span>
<span id="cb1-20">    ├── data_standardization<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">/</span></span>
<span id="cb1-21">    ├── code_analysis<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">/</span></span>
<span id="cb1-22">    └── knowledge_qna<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">/</span></span>
<span id="cb1-23"></span>
<span id="cb1-24"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># 컴포넌트 간 관계 = 의존성 방향</span></span>
<span id="cb1-25">agents<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">/</span> → shared<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">/</span>  ✅  (Agent가 공통 라이브러리 사용)</span>
<span id="cb1-26">agents<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">/</span> → core<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">/</span>    ✅  (Agent가 BaseAgent 상속)</span>
<span id="cb1-27">core<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">/</span> → agents<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">/</span>    ❌  (Core는 Agent를 몰라야 함 <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">-</span> Dependency Inversion)</span></code></pre></div>
</section>
<section id="설계-원칙이란" class="level3" data-number="2.1.2">
<h3 data-number="2.1.2" class="anchored" data-anchor-id="설계-원칙이란"><span class="header-section-number">2.1.2</span> “설계 원칙”이란?</h3>
<p>컴포넌트를 어떻게 배치하고 연결할 것인가에 대한 규칙: - “Core는 구체적인 Agent에 의존하지 않는다” (Dependency Inversion Principle) - “Agent는 표준 인터페이스를 따른다” (Interface Segregation Principle) - “공통 로직은 shared/에 둔다” (DRY - Don’t Repeat Yourself)</p>
</section>
<section id="architecture는-구조적-결정에-집중한다" class="level3" data-number="2.1.3">
<h3 data-number="2.1.3" class="anchored" data-anchor-id="architecture는-구조적-결정에-집중한다"><span class="header-section-number">2.1.3</span> Architecture는 “구조적 결정”에 집중한다</h3>
<div class="sourceCode" id="cb2" style="background: #f1f3f5;"><pre class="sourceCode numberSource python number-lines code-with-copy"><code class="sourceCode python"><span id="cb2-1"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># Software Architect가 묻는 질문들</span></span>
<span id="cb2-2"></span>
<span id="cb2-3"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">"Monorepo vs Polyrepo 중 어느 것을 선택하는가?"</span></span>
<span id="cb2-4"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">"마이크로서비스 vs 모놀리스 중 무엇이 적합한가?"</span></span>
<span id="cb2-5"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">"Event-driven vs Request-response 패턴 중 무엇을 채택하는가?"</span></span>
<span id="cb2-6"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">"모듈 경계와 의존성 방향을 어떻게 설정하는가?"</span></span>
<span id="cb2-7"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">"10년 후 시스템 복잡도가 100배 증가해도 감당 가능한가?"</span></span></code></pre></div>
</section>
<section id="실제-사례-twitter의-monorepo-결정" class="level3" data-number="2.1.4">
<h3 data-number="2.1.4" class="anchored" data-anchor-id="실제-사례-twitter의-monorepo-결정"><span class="header-section-number">2.1.4</span> 실제 사례: Twitter의 Monorepo 결정</h3>
<p><strong>배경 (2020년)</strong>: - Twitter는 수백 개의 마이크로서비스를 운영 중 - 각 서비스가 별도 repo에 있어 의존성 지옥 발생 - 라이브러리 버전 불일치로 인한 장애 빈발</p>
<p><strong>Architecture 결정</strong>: - Monorepo로 전환 (Bazel 빌드 시스템) - 모든 코드가 단일 repo에서 원자적 커밋(atomic commit) 가능 - 의존성 그래프를 컴파일 타임에 검증</p>
<p><strong>결과</strong>: - 버전 충돌 90% 감소 - 리팩토링 시간 70% 단축 - 하지만 빌드 인프라 구축에 6개월 소요</p>
<p><strong>교훈</strong>: Architecture는 <strong>구조적 결정(Monorepo 선택)</strong>이지만, 그것을 실제 작동하게 만드는 것(빌드 시스템, CI/CD)은 Platform Engineering의 영역이다.</p>
</section>
<section id="담당-역할" class="level3" data-number="2.1.5">
<h3 data-number="2.1.5" class="anchored" data-anchor-id="담당-역할"><span class="header-section-number">2.1.5</span> 담당 역할</h3>
<p>Software Architect, Staff Engineer, Principal Engineer가 주로 담당한다.</p>
</section>
</section>
<section id="플랫폼-엔지니어링-platform-engineering" class="level2" data-number="2.2">
<h2 data-number="2.2" class="anchored" data-anchor-id="플랫폼-엔지니어링-platform-engineering"><span class="header-section-number">2.2</span> 플랫폼 엔지니어링 (Platform Engineering)</h2>
<ul>
<li>개발자가 <strong>셀프서비스(Self-Service)</strong>로 제품을 만들 수 있는 환경을 구축하는 활동을 말한다.<br>
</li>
<li>“<strong>개발자가 5분 안에 새로운 기능을 배포할 수 있는가?</strong>”라는 생산성 관점에서 접근한다.</li>
</ul>
<section id="핵심-개념-internal-developer-platform-idp" class="level3" data-number="2.2.1">
<h3 data-number="2.2.1" class="anchored" data-anchor-id="핵심-개념-internal-developer-platform-idp"><span class="header-section-number">2.2.1</span> 핵심 개념: Internal Developer Platform (IDP)</h3>
<p>개발자가 인프라, 공통 로직, 배포 파이프라인에 신경 쓰지 않고 <strong>비즈니스 로직(도메인 지식)에만 집중</strong>할 수 있도록 만드는 것이다.</p>
<p><strong>AI Agent 플랫폼에 적용하면:</strong> - Agent 개발자는 도메인 로직(프롬프트, 데이터 처리)만 작성 - 플랫폼이 자동으로 제공: - LLM API 호출 (재시도, 에러 처리) - 모니터링 (실행 시간, 성공률) - 배포 (CI/CD 자동화) - 버전 관리 (프롬프트 버전 추적)</p>
</section>
<section id="다루는-핵심-질문" class="level3" data-number="2.2.2">
<h3 data-number="2.2.2" class="anchored" data-anchor-id="다루는-핵심-질문"><span class="header-section-number">2.2.2</span> 다루는 핵심 질문</h3>
<p><strong>Platform Engineering은 “개발자 경험(Developer Experience)”에 집중한다:</strong></p>
<div class="sourceCode" id="cb3" style="background: #f1f3f5;"><pre class="sourceCode numberSource python number-lines code-with-copy"><code class="sourceCode python"><span id="cb3-1"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># Platform Engineer가 묻는 질문들</span></span>
<span id="cb3-2"></span>
<span id="cb3-3"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">"새 Agent를 5분 안에 만들 수 있는가?"</span></span>
<span id="cb3-4"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">"공통 모듈을 재사용하기 쉬운가?"</span></span>
<span id="cb3-5"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">"배포가 자동화되어 있는가?"</span></span>
<span id="cb3-6"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">"개발자가 인프라를 몰라도 되는가?"</span></span>
<span id="cb3-7"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">"실험(A/B 테스트)이 쉬운가?"</span></span>
<span id="cb3-8"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">"장애 발생 시 10분 안에 롤백 가능한가?"</span></span></code></pre></div>
</section>
<section id="실제-사례-spotify의-backstage" class="level3" data-number="2.2.3">
<h3 data-number="2.2.3" class="anchored" data-anchor-id="실제-사례-spotify의-backstage"><span class="header-section-number">2.2.3</span> 실제 사례: Spotify의 Backstage</h3>
<p><strong>배경 (2016년)</strong>: - Spotify는 1000+ 마이크로서비스 운영 - 새 서비스를 만들려면 10개 이상의 도구 설정 필요 - GitHub repo 생성 - CI/CD 파이프라인 구성 - 모니터링 설정 (Prometheus, Grafana) - 문서 작성 (Confluence) - 서비스 메시 등록 (Istio) - 문제: 신입 개발자가 첫 배포까지 <strong>2-3주</strong> 소요</p>
<p><strong>Platform Engineering 솔루션: Backstage</strong></p>
<div class="sourceCode" id="cb4" style="background: #f1f3f5;"><pre class="sourceCode numberSource yaml number-lines code-with-copy"><code class="sourceCode yaml"><span id="cb4-1"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># 개발자가 작성하는 설정 파일 (service.yaml)</span></span>
<span id="cb4-2"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">apiVersion</span><span class="kw" style="color: #003B4F;
background-color: null;
font-style: inherit;">:</span><span class="at" style="color: #657422;
background-color: null;
font-style: inherit;"> backstage.io/v1alpha1</span></span>
<span id="cb4-3"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">kind</span><span class="kw" style="color: #003B4F;
background-color: null;
font-style: inherit;">:</span><span class="at" style="color: #657422;
background-color: null;
font-style: inherit;"> Component</span></span>
<span id="cb4-4"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">metadata</span><span class="kw" style="color: #003B4F;
background-color: null;
font-style: inherit;">:</span></span>
<span id="cb4-5"><span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">  </span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">name</span><span class="kw" style="color: #003B4F;
background-color: null;
font-style: inherit;">:</span><span class="at" style="color: #657422;
background-color: null;
font-style: inherit;"> my-new-service</span></span>
<span id="cb4-6"><span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">  </span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">description</span><span class="kw" style="color: #003B4F;
background-color: null;
font-style: inherit;">:</span><span class="at" style="color: #657422;
background-color: null;
font-style: inherit;"> </span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"내가 만든 첫 서비스"</span></span>
<span id="cb4-7"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">spec</span><span class="kw" style="color: #003B4F;
background-color: null;
font-style: inherit;">:</span></span>
<span id="cb4-8"><span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">  </span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">type</span><span class="kw" style="color: #003B4F;
background-color: null;
font-style: inherit;">:</span><span class="at" style="color: #657422;
background-color: null;
font-style: inherit;"> service</span></span>
<span id="cb4-9"><span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">  </span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">lifecycle</span><span class="kw" style="color: #003B4F;
background-color: null;
font-style: inherit;">:</span><span class="at" style="color: #657422;
background-color: null;
font-style: inherit;"> production</span></span>
<span id="cb4-10"><span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">  </span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">owner</span><span class="kw" style="color: #003B4F;
background-color: null;
font-style: inherit;">:</span><span class="at" style="color: #657422;
background-color: null;
font-style: inherit;"> team-data</span></span>
<span id="cb4-11"></span>
<span id="cb4-12"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># 이것만 작성하면 플랫폼이 자동으로:</span></span>
<span id="cb4-13"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># 1. GitHub repo 생성</span></span>
<span id="cb4-14"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># 2. CI/CD 파이프라인 구성</span></span>
<span id="cb4-15"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># 3. Kubernetes 배포 설정</span></span>
<span id="cb4-16"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># 4. 모니터링 대시보드 생성</span></span>
<span id="cb4-17"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># 5. 서비스 카탈로그 등록</span></span></code></pre></div>
<p><strong>결과</strong>: - 새 서비스 배포 시간: 2-3주 → <strong>30분</strong> - 개발자가 알아야 할 도구: 10개 → <strong>1개</strong> (Backstage) - 2020년 오픈소스로 공개, CNCF 프로젝트로 채택</p>
<p><strong>교훈</strong>: Platform Engineering은 <strong>“복잡함을 숨기고, 간단함을 제공하는 것”</strong>이다.</p>
</section>
<section id="실제-사례-netflix의-conductor" class="level3" data-number="2.2.4">
<h3 data-number="2.2.4" class="anchored" data-anchor-id="실제-사례-netflix의-conductor"><span class="header-section-number">2.2.4</span> 실제 사례: Netflix의 Conductor</h3>
<p><strong>배경 (2016년)</strong>: - Netflix는 수천 개의 마이크로서비스로 구성 - 비디오 인코딩 워크플로우가 매우 복잡: 1. 원본 비디오 업로드 2. 여러 해상도로 인코딩 (720p, 1080p, 4K) 3. 썸네일 생성 4. 자막 처리 5. CDN 배포 - 각 단계가 다른 팀의 마이크로서비스 - 문제: 워크플로우 조율 코드가 각 팀마다 중복</p>
<p><strong>Platform Engineering 솔루션: Conductor</strong></p>
<div class="sourceCode" id="cb5" style="background: #f1f3f5;"><pre class="sourceCode numberSource json number-lines code-with-copy"><code class="sourceCode json"><span id="cb5-1"><span class="er" style="color: #AD0000;
background-color: null;
font-style: inherit;">//</span> <span class="er" style="color: #AD0000;
background-color: null;
font-style: inherit;">개발자가</span> <span class="er" style="color: #AD0000;
background-color: null;
font-style: inherit;">정의하는</span> <span class="er" style="color: #AD0000;
background-color: null;
font-style: inherit;">워크플로우</span> <span class="er" style="color: #AD0000;
background-color: null;
font-style: inherit;">(JSON)</span></span>
<span id="cb5-2"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">{</span></span>
<span id="cb5-3">  <span class="dt" style="color: #AD0000;
background-color: null;
font-style: inherit;">"name"</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">:</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"video_processing_workflow"</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">,</span></span>
<span id="cb5-4">  <span class="dt" style="color: #AD0000;
background-color: null;
font-style: inherit;">"tasks"</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">:</span> <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">[</span></span>
<span id="cb5-5">    <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">{</span><span class="dt" style="color: #AD0000;
background-color: null;
font-style: inherit;">"name"</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">:</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"upload"</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">,</span> <span class="dt" style="color: #AD0000;
background-color: null;
font-style: inherit;">"taskReferenceName"</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">:</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"upload_task"</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">,</span> <span class="dt" style="color: #AD0000;
background-color: null;
font-style: inherit;">"type"</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">:</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"SIMPLE"</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">}</span><span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">,</span></span>
<span id="cb5-6">    <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">{</span><span class="dt" style="color: #AD0000;
background-color: null;
font-style: inherit;">"name"</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">:</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"encode_720p"</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">,</span> <span class="dt" style="color: #AD0000;
background-color: null;
font-style: inherit;">"taskReferenceName"</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">:</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"encode_720p"</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">,</span> <span class="dt" style="color: #AD0000;
background-color: null;
font-style: inherit;">"type"</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">:</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"SIMPLE"</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">}</span><span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">,</span></span>
<span id="cb5-7">    <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">{</span><span class="dt" style="color: #AD0000;
background-color: null;
font-style: inherit;">"name"</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">:</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"encode_1080p"</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">,</span> <span class="dt" style="color: #AD0000;
background-color: null;
font-style: inherit;">"taskReferenceName"</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">:</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"encode_1080p"</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">,</span> <span class="dt" style="color: #AD0000;
background-color: null;
font-style: inherit;">"type"</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">:</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"SIMPLE"</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">}</span><span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">,</span></span>
<span id="cb5-8">    <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">{</span><span class="dt" style="color: #AD0000;
background-color: null;
font-style: inherit;">"name"</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">:</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"encode_4k"</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">,</span> <span class="dt" style="color: #AD0000;
background-color: null;
font-style: inherit;">"taskReferenceName"</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">:</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"encode_4k"</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">,</span> <span class="dt" style="color: #AD0000;
background-color: null;
font-style: inherit;">"type"</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">:</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"SIMPLE"</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">}</span><span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">,</span></span>
<span id="cb5-9">    <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">{</span><span class="dt" style="color: #AD0000;
background-color: null;
font-style: inherit;">"name"</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">:</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"generate_thumbnail"</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">,</span> <span class="dt" style="color: #AD0000;
background-color: null;
font-style: inherit;">"taskReferenceName"</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">:</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"thumbnail"</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">,</span> <span class="dt" style="color: #AD0000;
background-color: null;
font-style: inherit;">"type"</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">:</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"SIMPLE"</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">}</span><span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">,</span></span>
<span id="cb5-10">    <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">{</span><span class="dt" style="color: #AD0000;
background-color: null;
font-style: inherit;">"name"</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">:</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"deploy_cdn"</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">,</span> <span class="dt" style="color: #AD0000;
background-color: null;
font-style: inherit;">"taskReferenceName"</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">:</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"cdn"</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">,</span> <span class="dt" style="color: #AD0000;
background-color: null;
font-style: inherit;">"type"</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">:</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"SIMPLE"</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">}</span></span>
<span id="cb5-11">  <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">]</span></span>
<span id="cb5-12"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">}</span></span>
<span id="cb5-13"></span>
<span id="cb5-14"><span class="er" style="color: #AD0000;
background-color: null;
font-style: inherit;">//</span> <span class="er" style="color: #AD0000;
background-color: null;
font-style: inherit;">플랫폼이</span> <span class="er" style="color: #AD0000;
background-color: null;
font-style: inherit;">자동으로</span> <span class="er" style="color: #AD0000;
background-color: null;
font-style: inherit;">제공:</span></span>
<span id="cb5-15"><span class="er" style="color: #AD0000;
background-color: null;
font-style: inherit;">//</span> <span class="er" style="color: #AD0000;
background-color: null;
font-style: inherit;">-</span> <span class="er" style="color: #AD0000;
background-color: null;
font-style: inherit;">재시도</span> <span class="er" style="color: #AD0000;
background-color: null;
font-style: inherit;">로직</span> <span class="er" style="color: #AD0000;
background-color: null;
font-style: inherit;">(실패</span> <span class="er" style="color: #AD0000;
background-color: null;
font-style: inherit;">시</span> <span class="er" style="color: #AD0000;
background-color: null;
font-style: inherit;">자동</span> <span class="er" style="color: #AD0000;
background-color: null;
font-style: inherit;">재실행)</span></span>
<span id="cb5-16"><span class="er" style="color: #AD0000;
background-color: null;
font-style: inherit;">//</span> <span class="er" style="color: #AD0000;
background-color: null;
font-style: inherit;">-</span> <span class="er" style="color: #AD0000;
background-color: null;
font-style: inherit;">타임아웃</span> <span class="er" style="color: #AD0000;
background-color: null;
font-style: inherit;">관리</span></span>
<span id="cb5-17"><span class="er" style="color: #AD0000;
background-color: null;
font-style: inherit;">//</span> <span class="er" style="color: #AD0000;
background-color: null;
font-style: inherit;">-</span> <span class="er" style="color: #AD0000;
background-color: null;
font-style: inherit;">병렬</span> <span class="er" style="color: #AD0000;
background-color: null;
font-style: inherit;">실행</span> <span class="er" style="color: #AD0000;
background-color: null;
font-style: inherit;">(encode_720p,</span> <span class="er" style="color: #AD0000;
background-color: null;
font-style: inherit;">1080p,</span> <span class="er" style="color: #AD0000;
background-color: null;
font-style: inherit;">4k</span> <span class="er" style="color: #AD0000;
background-color: null;
font-style: inherit;">동시</span> <span class="er" style="color: #AD0000;
background-color: null;
font-style: inherit;">실행)</span></span>
<span id="cb5-18"><span class="er" style="color: #AD0000;
background-color: null;
font-style: inherit;">//</span> <span class="er" style="color: #AD0000;
background-color: null;
font-style: inherit;">-</span> <span class="er" style="color: #AD0000;
background-color: null;
font-style: inherit;">모니터링</span> <span class="er" style="color: #AD0000;
background-color: null;
font-style: inherit;">(각</span> <span class="er" style="color: #AD0000;
background-color: null;
font-style: inherit;">단계별</span> <span class="er" style="color: #AD0000;
background-color: null;
font-style: inherit;">실행</span> <span class="er" style="color: #AD0000;
background-color: null;
font-style: inherit;">시간,</span> <span class="er" style="color: #AD0000;
background-color: null;
font-style: inherit;">성공률)</span></span>
<span id="cb5-19"><span class="er" style="color: #AD0000;
background-color: null;
font-style: inherit;">//</span> <span class="er" style="color: #AD0000;
background-color: null;
font-style: inherit;">-</span> <span class="er" style="color: #AD0000;
background-color: null;
font-style: inherit;">시각화</span> <span class="er" style="color: #AD0000;
background-color: null;
font-style: inherit;">(워크플로우</span> <span class="er" style="color: #AD0000;
background-color: null;
font-style: inherit;">진행</span> <span class="er" style="color: #AD0000;
background-color: null;
font-style: inherit;">상황</span> <span class="er" style="color: #AD0000;
background-color: null;
font-style: inherit;">UI)</span></span></code></pre></div>
<p><strong>결과</strong>: - 워크플로우 개발 시간: 2-3일 → <strong>30분</strong> - 중복 코드 제거: 각 팀이 독자적으로 작성하던 조율 로직 삭제 - 2017년 오픈소스로 공개</p>
<p><strong>교훈</strong>: Platform Engineering은 <strong>“공통 패턴을 찾아 플랫폼으로 추상화하는 것”</strong>이다.</p>
</section>
<section id="ai-agent-플랫폼에-적용" class="level3" data-number="2.2.5">
<h3 data-number="2.2.5" class="anchored" data-anchor-id="ai-agent-플랫폼에-적용"><span class="header-section-number">2.2.5</span> AI Agent 플랫폼에 적용</h3>
<p><strong>Spotify Backstage처럼:</strong></p>
<div class="sourceCode" id="cb6" style="background: #f1f3f5;"><pre class="sourceCode numberSource python number-lines code-with-copy"><code class="sourceCode python"><span id="cb6-1"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># agents/my_agent/config.yaml</span></span>
<span id="cb6-2">name: data_standardization_agent</span>
<span id="cb6-3">description: <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"데이터 스키마 표준화"</span></span>
<span id="cb6-4">owner: data<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">-</span>team</span>
<span id="cb6-5">llm:</span>
<span id="cb6-6">  provider: openai</span>
<span id="cb6-7">  model: gpt<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">-</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">4</span></span>
<span id="cb6-8"></span>
<span id="cb6-9"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># 이것만 작성하면 플랫폼이 자동으로:</span></span>
<span id="cb6-10"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># - LLM 클라이언트 설정</span></span>
<span id="cb6-11"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># - 재시도 로직 적용</span></span>
<span id="cb6-12"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># - 모니터링 대시보드 생성</span></span>
<span id="cb6-13"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># - CI/CD 파이프라인 생성</span></span></code></pre></div>
<p><strong>Netflix Conductor처럼:</strong></p>
<div class="sourceCode" id="cb7" style="background: #f1f3f5;"><pre class="sourceCode numberSource python number-lines code-with-copy"><code class="sourceCode python"><span id="cb7-1"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># 여러 Agent를 조합한 워크플로우</span></span>
<span id="cb7-2">workflow <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> [</span>
<span id="cb7-3">    DataStandardizationAgent(),</span>
<span id="cb7-4">    CodeAnalysisAgent(),</span>
<span id="cb7-5">    KnowledgeQnAAgent()</span>
<span id="cb7-6">]</span>
<span id="cb7-7"></span>
<span id="cb7-8"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># 플랫폼이 자동으로:</span></span>
<span id="cb7-9"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># - Agent 간 데이터 전달</span></span>
<span id="cb7-10"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># - 실패 시 재시도</span></span>
<span id="cb7-11"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># - 병렬 실행 최적화</span></span>
<span id="cb7-12"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># - 전체 워크플로우 모니터링</span></span></code></pre></div>
</section>
<section id="담당-역할-1" class="level3" data-number="2.2.6">
<h3 data-number="2.2.6" class="anchored" data-anchor-id="담당-역할-1"><span class="header-section-number">2.2.6</span> 담당 역할</h3>
<p>Platform Engineer, DevOps Engineer, Infrastructure Engineer가 주로 담당한다.</p>
</section>
</section>
<section id="시스템-엔지니어링-systems-engineering" class="level2" data-number="2.3">
<h2 data-number="2.3" class="anchored" data-anchor-id="시스템-엔지니어링-systems-engineering"><span class="header-section-number">2.3</span> 시스템 엔지니어링 (Systems Engineering)</h2>
<ul>
<li>복잡한 <strong>물리적 시스템</strong>의 설계, 통합, 생명주기 관리를 다루는 활동이다.<br>
</li>
<li><strong>하드웨어 + 소프트웨어 + 물리 법칙</strong>이 결합된 시스템이 대상이다.</li>
</ul>
<section id="다루는-핵심-질문-1" class="level3" data-number="2.3.1">
<h3 data-number="2.3.1" class="anchored" data-anchor-id="다루는-핵심-질문-1"><span class="header-section-number">2.3.1</span> 다루는 핵심 질문</h3>
<p><strong>Systems Engineering은 “물리적 제약”에 집중한다:</strong></p>
<div class="sourceCode" id="cb8" style="background: #f1f3f5;"><pre class="sourceCode numberSource python number-lines code-with-copy"><code class="sourceCode python"><span id="cb8-1"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># Systems Engineer가 묻는 질문들</span></span>
<span id="cb8-2"></span>
<span id="cb8-3"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">"로켓의 추진 시스템과 제어 시스템을 어떻게 통합하는가?"</span></span>
<span id="cb8-4"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">"자율주행차의 센서-소프트웨어-액추에이터를 어떻게 조율하는가?"</span></span>
<span id="cb8-5"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">"요구사항을 하드웨어/소프트웨어로 어떻게 분해하는가?"</span></span>
<span id="cb8-6"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">"시스템 전체의 안전성을 어떻게 검증하는가?"</span></span>
<span id="cb8-7"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">"20년 후에도 부품 교체가 가능한가?"</span></span></code></pre></div>
</section>
<section id="실제-사례-보잉-787-개발" class="level3" data-number="2.3.2">
<h3 data-number="2.3.2" class="anchored" data-anchor-id="실제-사례-보잉-787-개발"><span class="header-section-number">2.3.2</span> 실제 사례: 보잉 787 개발</h3>
<p><strong>시스템 복잡도</strong>: - 하드웨어: 엔진, 날개, 유압 시스템 - 소프트웨어: 비행 제어, 엔터테인먼트 시스템 - 네트워크: 항공전자 네트워크 (AFDX) - 인증: FAA 안전 인증 필수</p>
<p><strong>Systems Engineering 프로세스</strong>: 1. 요구사항 분석 (10,000+ 요구사항) 2. 시스템 분해 (하드웨어/소프트웨어/기계) 3. 인터페이스 정의 (100+ 시스템 간 통신) 4. 통합 테스트 (5년 이상 소요) 5. 인증 및 검증</p>
<p><strong>소요 시간</strong>: 8년 (2004-2011)</p>
</section>
<section id="ai-agent-플랫폼에-왜-부적합한가" class="level3" data-number="2.3.3">
<h3 data-number="2.3.3" class="anchored" data-anchor-id="ai-agent-플랫폼에-왜-부적합한가"><span class="header-section-number">2.3.3</span> AI Agent 플랫폼에 왜 부적합한가</h3>
<p><strong>비교: AI Agent Platform vs 항공기 시스템</strong></p>
<table class="table">
<thead>
<tr class="header">
<th>특성</th>
<th>AI Agent Platform</th>
<th>항공기 시스템 (Systems Engineering)</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td>주요 제약</td>
<td>코드 복잡도, 확장성</td>
<td>물리 법칙, 안전 인증</td>
</tr>
<tr class="even">
<td>변경 비용</td>
<td>낮음 (코드 수정)</td>
<td>매우 높음 (하드웨어 재설계)</td>
</tr>
<tr class="odd">
<td>실패 영향</td>
<td>서비스 장애</td>
<td>인명 피해</td>
</tr>
<tr class="even">
<td>개발 주기</td>
<td>주 단위</td>
<td>년 단위</td>
</tr>
<tr class="odd">
<td>검증 방법</td>
<td>자동화 테스트</td>
<td>물리적 시험</td>
</tr>
</tbody>
</table>
<p><strong>결론</strong>: AI Agent 플랫폼은 순수 소프트웨어 시스템이므로 <strong>Software Architecture + Platform Engineering</strong> 관점이 적합하다.</p>
<p><strong>용어 혼동 주의</strong>: - “시스템 엔지니어링”을 언급하면 항공, 국방, 하드웨어 인프라로 오해받기 쉽다 - 소프트웨어 플랫폼 기획에서는 명확성을 위해 이 용어를 배제하는 것이 전략적으로 유리하다</p>
</section>
</section>
</section>
<section id="관점-비교-및-선택-기준" class="level1" data-number="3">
<h1 data-number="3"><span class="header-section-number">3</span> 관점 비교 및 선택 기준</h1>
<section id="종합-비교표" class="level2" data-number="3.1">
<h2 data-number="3.1" class="anchored" data-anchor-id="종합-비교표"><span class="header-section-number">3.1</span> 종합 비교표</h2>
<table class="table">
<colgroup>
<col style="width: 12%">
<col style="width: 12%">
<col style="width: 20%">
<col style="width: 33%">
<col style="width: 20%">
</colgroup>
<thead>
<tr class="header">
<th>용어</th>
<th>초점</th>
<th>핵심 질문</th>
<th>AI Agent 적합성</th>
<th>담당 역할</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td><strong>Software Architecture</strong></td>
<td>구조 설계</td>
<td>“10년 후에도 유지 가능한가?”</td>
<td>⭐⭐⭐⭐⭐ 최적</td>
<td>Software Architect, Staff Engineer</td>
</tr>
<tr class="even">
<td><strong>Platform Engineering</strong></td>
<td>개발자 경험</td>
<td>“5분 안에 배포 가능한가?”</td>
<td>⭐⭐⭐⭐⭐ 최적</td>
<td>Platform Engineer, DevOps Engineer</td>
</tr>
<tr class="odd">
<td><strong>Systems Engineering</strong></td>
<td>물리적 통합</td>
<td>“하드웨어와 소프트웨어 통합?”</td>
<td>⭐ 부적합</td>
<td>Systems Engineer (항공/국방)</td>
</tr>
</tbody>
</table>
</section>
<section id="각-관점이-답하는-질문의-차이" class="level2" data-number="3.2">
<h2 data-number="3.2" class="anchored" data-anchor-id="각-관점이-답하는-질문의-차이"><span class="header-section-number">3.2</span> 각 관점이 답하는 질문의 차이</h2>
<section id="같은-문제-다른-질문" class="level3" data-number="3.2.1">
<h3 data-number="3.2.1" class="anchored" data-anchor-id="같은-문제-다른-질문"><span class="header-section-number">3.2.1</span> 같은 문제, 다른 질문</h3>
<p><strong>상황: “새로운 AI Agent를 추가하려고 한다”</strong></p>
<div class="sourceCode" id="cb9" style="background: #f1f3f5;"><pre class="sourceCode numberSource python number-lines code-with-copy"><code class="sourceCode python"><span id="cb9-1"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># Software Architect의 질문</span></span>
<span id="cb9-2"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">"이 Agent가 기존 시스템 구조에 어떻게 통합되는가?"</span></span>
<span id="cb9-3"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">"의존성 방향이 올바른가?"</span></span>
<span id="cb9-4"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">"인터페이스가 확장 가능한가?"</span></span>
<span id="cb9-5"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">"10년 후 Agent가 1000개로 늘어나도 이 구조가 유지되는가?"</span></span>
<span id="cb9-6"></span>
<span id="cb9-7"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># Platform Engineer의 질문</span></span>
<span id="cb9-8"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">"개발자가 5분 안에 이 Agent를 배포할 수 있는가?"</span></span>
<span id="cb9-9"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">"공통 모듈을 재사용하기 쉬운가?"</span></span>
<span id="cb9-10"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">"CI/CD가 자동으로 작동하는가?"</span></span>
<span id="cb9-11"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">"모니터링이 자동으로 설정되는가?"</span></span>
<span id="cb9-12"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">"장애 시 10분 안에 롤백 가능한가?"</span></span>
<span id="cb9-13"></span>
<span id="cb9-14"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># Systems Engineer의 질문 (우리와 무관)</span></span>
<span id="cb9-15"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">"센서 데이터를 어떻게 수집하는가?"</span></span>
<span id="cb9-16"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">"하드웨어 제약은 무엇인가?"</span></span>
<span id="cb9-17"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">"안전 인증이 필요한가?"</span></span></code></pre></div>
</section>
<section id="실제-사례로-본-차이" class="level3" data-number="3.2.2">
<h3 data-number="3.2.2" class="anchored" data-anchor-id="실제-사례로-본-차이"><span class="header-section-number">3.2.2</span> 실제 사례로 본 차이</h3>
<p><strong>Uber의 ML Platform 구축 (2016-2019)</strong></p>
<p><strong>Phase 1: Architecture 결정</strong> (Software Architecture 관점) - 문제: 각 ML 팀이 독자적으로 모델 학습 파이프라인 구축 - 결정: Michelangelo Platform으로 통합 - Monorepo 채택 - 표준 Model 인터페이스 정의 - Feature Store 아키텍처 설계 - 소요 시간: 6개월 (설계) - 결과물: 아키텍처 문서, 인터페이스 스펙</p>
<p><strong>Phase 2: Platform 구축</strong> (Platform Engineering 관점) - 문제: 설계는 완료했지만 개발자가 사용하기 어려움 - 해결: ```python # 개발자 경험 개선 - 3줄로 모델 배포 from michelangelo import Model</p>
<p>model = Model.load(“my_model”) model.deploy() # 자동으로 인프라 프로비저닝, 모니터링 설정 ``` - 소요 시간: 1년 (구현 + 자동화) - 결과: 모델 배포 시간 3주 → 1일</p>
<p><strong>교훈</strong>: Architecture는 <strong>“무엇을 만들 것인가”</strong>, Platform Engineering은 <strong>“어떻게 쉽게 만들 것인가”</strong>를 다룬다.</p>
</section>
</section>
<section id="ai-agent-platform에-적합한-관점" class="level2" data-number="3.3">
<h2 data-number="3.3" class="anchored" data-anchor-id="ai-agent-platform에-적합한-관점"><span class="header-section-number">3.3</span> AI Agent Platform에 적합한 관점</h2>
<section id="추천-software-architecture-platform-engineering-융합" class="level3" data-number="3.3.1">
<h3 data-number="3.3.1" class="anchored" data-anchor-id="추천-software-architecture-platform-engineering-융합"><span class="header-section-number">3.3.1</span> 추천: Software Architecture + Platform Engineering 융합</h3>
<p><strong>왜 두 관점이 모두 필요한가?</strong></p>
<div class="sourceCode" id="cb10" style="background: #f1f3f5;"><pre class="sourceCode numberSource python number-lines code-with-copy"><code class="sourceCode python"><span id="cb10-1"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># Architecture 없이 Platform만 구축하면</span></span>
<span id="cb10-2">❌ 단기적으로는 빠르지만 장기적으로 붕괴</span>
<span id="cb10-3">❌ 기술 부채 누적</span>
<span id="cb10-4">❌ Agent가 늘어날수록 유지보수 불가능</span>
<span id="cb10-5"></span>
<span id="cb10-6"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># Platform 없이 Architecture만 설계하면</span></span>
<span id="cb10-7">❌ 완벽한 설계도이지만 아무도 사용 안 함</span>
<span id="cb10-8">❌ 개발자가 복잡도를 모두 떠안음</span>
<span id="cb10-9">❌ 생산성 저하</span></code></pre></div>
<p><strong>융합 접근법</strong>:</p>
<table class="table">
<colgroup>
<col style="width: 12%">
<col style="width: 44%">
<col style="width: 42%">
</colgroup>
<thead>
<tr class="header">
<th>영역</th>
<th>Software Architecture</th>
<th>Platform Engineering</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td>저장소 구조</td>
<td>Monorepo 구조 설계</td>
<td>Bazel/Turborepo 빌드 시스템 구축</td>
</tr>
<tr class="even">
<td>Agent 인터페이스</td>
<td>BaseAgent 추상 클래스 설계</td>
<td>Agent 템플릿 자동 생성 도구</td>
</tr>
<tr class="odd">
<td>공통 모듈</td>
<td>shared/ 모듈 구조 설계</td>
<td>패키지 매니저 설정, 의존성 자동 해결</td>
</tr>
<tr class="even">
<td>배포</td>
<td>배포 전략 정의</td>
<td>CI/CD 파이프라인 자동화</td>
</tr>
<tr class="odd">
<td>모니터링</td>
<td>메트릭 정의</td>
<td>대시보드 자동 생성</td>
</tr>
</tbody>
</table>
</section>
<section id="실무-적용-단계" class="level3" data-number="3.3.2">
<h3 data-number="3.3.2" class="anchored" data-anchor-id="실무-적용-단계"><span class="header-section-number">3.3.2</span> 실무 적용 단계</h3>
<p><strong>1단계: Architecture 먼저</strong> (1-2개월) - Monorepo vs Polyrepo 결정 - 모듈 구조 설계 (core, shared, agents) - BaseAgent 인터페이스 정의 - 의존성 방향 규칙 수립</p>
<p><strong>2단계: Platform 구축</strong> (2-3개월) - Agent 템플릿 생성 스크립트 - CI/CD 파이프라인 구성 - 모니터링 자동화 - 개발자 문서 작성</p>
<p><strong>3단계: 반복 개선</strong> (지속) - 개발자 피드백 수집 - 병목 지점 자동화 - 새로운 공통 패턴 발견 시 플랫폼에 추가</p>
</section>
</section>
<section id="용어-사용-권장사항" class="level2" data-number="3.4">
<h2 data-number="3.4" class="anchored" data-anchor-id="용어-사용-권장사항"><span class="header-section-number">3.4</span> 용어 사용 권장사항</h2>
<section id="기획서제안서에-쓸-표현" class="level3" data-number="3.4.1">
<h3 data-number="3.4.1" class="anchored" data-anchor-id="기획서제안서에-쓸-표현"><span class="header-section-number">3.4.1</span> 기획서/제안서에 쓸 표현</h3>
<p><strong>✅ 권장</strong>: - “AI Agent <strong>Platform</strong> 구축” - “<strong>Platform Engineering</strong> 관점에서 개발자 경험 최적화” - “<strong>Software Architecture</strong> 설계” - “AI Agent Platform <strong>Architecture</strong>”</p>
<p><strong>❌ 피해야 할 표현</strong>: - “Systems Engineering 기반 설계” (하드웨어 시스템으로 오해) - “단순 DevOps 자동화” (너무 좁은 범위) - “LLMOps만으로 해결” (운영 측면만 다룸)</p>
</section>
<section id="명확한-소통을-위한-용어-분리" class="level3" data-number="3.4.2">
<h3 data-number="3.4.2" class="anchored" data-anchor-id="명확한-소통을-위한-용어-분리"><span class="header-section-number">3.4.2</span> 명확한 소통을 위한 용어 분리</h3>
<p><strong>프로젝트 단계별 용어 사용</strong>: 1. <strong>기획 단계</strong>: “AI Agent Platform 아키텍처 설계” 2. <strong>설계 단계</strong>: “Software Architecture - Monorepo 구조, 모듈 설계” 3. <strong>구축 단계</strong>: “Platform Engineering - IDP 구축, 자동화” 4. <strong>운영 단계</strong>: “DevOps/LLMOps - 배포, 모니터링”</p>
</section>
</section>
</section>
<section id="다음-단계" class="level1" data-number="4">
<h1 data-number="4"><span class="header-section-number">4</span> 다음 단계</h1>
<p>이 글에서 <strong>“어떤 관점으로 접근할 것인가”</strong>를 정했다면, 다음 질문은:</p>
<blockquote class="blockquote">
<p>“그럼 실제로 어떻게 설계하는가?”</p>
</blockquote>
<p>다음 글 “<a href="2.platform_design_strategy.qmd">AI Agent 플랫폼 설계의 5대 원칙과 점진적 추상화 전략</a>”에서는: - <strong>5대 설계 원칙</strong>: Interface Segregation, Dependency Inversion 등 - <strong>점진적 추상화 전략</strong>: POC → 패턴 발견 → 추상화 (Phase 1-4) - <strong>실제 코드 예시</strong>: BaseAgent 구현, LLM 클라이언트 추상화 등 - <strong>실증 사례</strong>: Google Borg, Uber ML Platform, Airbnb Airflow</p>
<p>을 다룬다.</p>
<section id="참고문헌" class="level2" data-number="4.1">
<h2 data-number="4.1" class="anchored" data-anchor-id="참고문헌"><span class="header-section-number">4.1</span> 참고문헌</h2>
<p><strong>Platform Engineering</strong>: - Spotify Engineering (2020). “What the Heck is Backstage Anyway?” Spotify Engineering Blog. - Netflix Technology Blog (2016). “Netflix Conductor: A microservices orchestrator.” Netflix Tech Blog. - CNCF (2020). “Backstage: Spotify’s open platform for building developer portals.” CNCF Project.</p>
<p><strong>Software Architecture</strong>: - Richards, M., &amp; Ford, N. (2020). “Fundamentals of Software Architecture.” O’Reilly. - Martin, R. C. (2017). “Clean Architecture.” Prentice Hall.</p>
<p><strong>Case Studies</strong>: - Uber Engineering (2017). “Meet Michelangelo: Uber’s Machine Learning Platform.” Uber Engineering Blog. - Twitter Engineering (2021). “Monorepo at Twitter.” Twitter Engineering Blog.</p>


</section>
</section>

 ]]></description>
  <category>Engineering</category>
  <category>System</category>
  <category>Architecture Design</category>
  <category>Agent</category>
  <category>Platform</category>
  <guid>kk3225.netlify.app/docs/blog/posts/Engineering/System/Archi_Design/platform/1.agent_platform_overview.html</guid>
  <pubDate>Sun, 25 Jan 2026 15:00:00 GMT</pubDate>
</item>
<item>
  <title>Relevance and Ranking</title>
  <dc:creator>Kwangmin Kim</dc:creator>
  <link>kk3225.netlify.app/docs/blog/posts/Engineering/Infra/Cloud/Azure/32-az-ai-search-classic-ranking.html</link>
  <description><![CDATA[ 





<section id="relevance-and-ranking" class="level1" data-number="1">
<h1 data-number="1"><span class="header-section-number">1</span> Relevance and Ranking</h1>
<p>Relevance scoring, ranking 알고리즘, hybrid fusion, similarity metrics에 대한 기술적 분석</p>
<section id="relevance-및-scoring-개요" class="level2" data-number="1.1">
<h2 data-number="1.1" class="anchored" data-anchor-id="relevance-및-scoring-개요"><span class="header-section-number">1.1</span> Relevance 및 Scoring 개요</h2>
<section id="relevance의-핵심-개념" class="level3" data-number="1.1.1">
<h3 data-number="1.1.1" class="anchored" data-anchor-id="relevance의-핵심-개념"><span class="header-section-number">1.1.1</span> Relevance의 핵심 개념</h3>
<p><strong>Relevance</strong>는 <strong>검색 결과가 사용자 쿼리와 얼마나 관련성이 높은지를 정량화</strong>한 점수</p>
<p><strong>Azure Search의 다층 Relevance 시스템</strong>:</p>
<pre><code>Query Input
    ↓
┌─────────────────────────────────────┐
│ Layer 1: Lexical Scoring (BM25)     │ → @search.score
├─────────────────────────────────────┤
│ Layer 2: Vector Similarity          │ → vector similarity score
├─────────────────────────────────────┤
│ Layer 3: RRF Fusion (Hybrid)        │ → combined score
├─────────────────────────────────────┤
│ Layer 4: Semantic Reranking         │ → @search.rerankerScore
├─────────────────────────────────────┤
│ Layer 5: Custom Scoring Profile     │ → boosted score
└─────────────────────────────────────┘
    ↓
Final Ranked Results</code></pre>
<ul>
<li><strong>Hybrid(하이브리드)</strong>
<ul>
<li>서로 다른 유형의 랭킹 신호를 결합하는 방식<br>
</li>
<li>텍스트 점수만 쓰는 것이 아니라 텍스트 검색과 벡터 검색 등 복수의 랭커(ranking function)를 함께 사용<br>
</li>
</ul></li>
<li><strong>Combined score(결합 점수)</strong>
<ul>
<li>최종 순위를 결정하기 위해 여러 랭킹 신호를 하나의 스칼라 값으로 합성한 결과</li>
<li>RRF(Reciprocal Rank Fusion)에서는 개별 문서의 절대 점수(예: BM25 점수 8.5, 벡터유사도 0.89)를 직접 합치지 않고, 각 랭킹에서의 순위(rank)를 사용해 결합한다. (예: BM25에서 문서 A는 1위, 벡터에서 5위)</li>
<li>따라서 RRF의 “combined score”는 각 랭킹에서의 순위를 기반으로 계산된 RRF 값이다<br>
</li>
<li>높은 RRF 값 = 더 높은 최종 순위.<br>
</li>
</ul></li>
<li><strong>RRF가 BM25 점수·벡터 유사도를 다루는 방법</strong>
<ul>
<li><p>BM25와 벡터 유사도는 서로 다른 스케일이므로 그대로 더하면 공정하지 않을 수 있다.<br>
</p></li>
<li><p>RRF는 스코어 대신 각 랭킹에서의 순위(예: BM25에서 문서 A는 1위, 벡터에서 5위)를 사용하므로 서로 다른 스케일 문제에서 자유롭다.<br>
</p></li>
<li><p>공식: RRF(d) = sum_{r in R} 1 / (k + rank_r(d))<br>
</p></li>
<li><p>k: 안정화 상수(예: 60)로, 상위권(rank small)에 대한 기여를 완화(stabilize)하는 상수<br>
</p></li>
<li><p>k 값이 클수록 각 랭킹의 상위권(예: 1위, 2위)이 RRF에 미치는 상대적 차이가 작아진다. 반대로 k가 작으면 1위와 2위의 기여 차이가 커진다.</p></li>
<li><p>예: BM25에서 A가 1위, 벡터에서 A가 5위이면 RRF(A) = 1/(60+1) + 1/(60+5) ≈ 0.0164 + 0.0154 = 0.0318.<br>
</p></li>
<li><p>K의 수학적 직관과 효과</p>
<ol type="1">
<li>상위권 민감도 조절<br>
</li>
</ol>
<ul>
<li>rank = 1일 때 기여 = 1/(k+1)<br>
</li>
<li>rank = 2일 때 기여 = 1/(k+2)<br>
</li>
<li>두 기여 차이는 1/(k+1) - 1/(k+2) = 1/((k+1)(k+2))<br>
</li>
<li>k가 작으면(예: 1~10) 1위와 2위의 차이를 강하게 반영한다(상위권 민감)<br>
</li>
<li>k가 크면(예: 30~100) 상위권 차이를 거의 압축해서 반영하므로 여러 랭킹 신호가 고르게 기여한다.</li>
<li>k=1이면 1/(2)-1/(3)=0.1667 차이(상당히 큼)<br>
</li>
<li>Azure의 k=60이면 1/61 - 1/62 ≈ 0.000266 차이(매우 작음)<br>
</li>
<li>그래도, k는 다항감소로 지수감소보다는 훨씬 느리다.</li>
</ul>
<p><img src="https://latex.codecogs.com/png.latex?%5CDelta(k)=%5Cfrac%7B1%7D%7B(k+1)(k+2)%7D=%5Cfrac%7B1%7D%7Bk%5E2%7D%5Ccdot%5Cfrac%7B1%7D%7B(1+1/k)(1+2/k)%7D."></p>
<p>큰 <img src="https://latex.codecogs.com/png.latex?k"> 에서 역급수 전개를 하면 <img src="https://latex.codecogs.com/png.latex?%5Cfrac%7B1%7D%7B(1+1/k)(1+2/k)%7D=1-%5Cfrac%7B3%7D%7Bk%7D+O%5C!%5Cleft(%5Cfrac%7B1%7D%7Bk%5E2%7D%5Cright),"> 따라서 <img src="https://latex.codecogs.com/png.latex?%5CDelta(k)=%5Cfrac%7B1%7D%7Bk%5E2%7D%5Cleft(1+O%5C!%5Cleft(%5Cfrac%7B1%7D%7Bk%7D%5Cright)%5Cright),"> 즉 주도항은 <img src="https://latex.codecogs.com/png.latex?1/k%5E2"> 이고 다음 보정항은 <img src="https://latex.codecogs.com/png.latex?O(1/k%5E3)"> 이다.</p>
<ol start="2" type="1">
<li>rank 큰 값에 대한 둔감성<br>
</li>
</ol>
<ul>
<li>rank가 커질수록 1/(k+rank)는 작아지고 기여는 급격히 줄어든다. k 값이 크면 ‘중간/하위권’ 기여는 더 작아진다.<br>
</li>
<li>k=60은 실무에서 상위권(예: 1~10)에만 의미 있는 기여를 주고, 그 외는 거의 누락 수준으로 처리하려는 의도에 가깝다.<br>
</li>
</ul>
<ol start="3" type="1">
<li>안정성(stability)과 로버스트성<br>
</li>
</ol>
<ul>
<li>k가 충분히 크면 어떤 단일 랭킹에서의 1위 문서가 전체 결합에서 과도하게 지배하는 일을 방지한다.<br>
</li>
<li>특히 랭킹 간 스케일이나 품질 차이가 클 때(예: 어떤 랭킹이 노이즈가 심함) 이상치에 덜 민감해진다.<br>
</li>
</ul>
<ol start="4" type="1">
<li>실무적 해석 (k=60이 의미하는 바)<br>
</li>
</ol>
<ul>
<li>Azure나 논문에서 k=60처럼 비교적 큰 값을 쓰는 건 ‘완만한’ 랭킹 결합을 선호한다는 뜻:<br>
</li>
<li>서로 다른 랭킹이 고르게 기여하길 원함(특정 랭킹이 독점하지 않음).<br>
</li>
<li>상위 1-2위의 미세한 차이에 덜 민감하고, 여러 랭킹의 합의 효과를 장려.<br>
</li>
<li>후보 풀(top-K)과 상보적으로 고려해야 함:<br>
</li>
<li>예: 텍스트 top100, 벡터 top50에서 RRF를 쓴다면 k가 크면 벡터의 1위(순위=1) 기여와 텍스트의 10위 (순위=10) 기여가 비슷해질 수 있다.<br>
</li>
</ul></li>
</ul></li>
<li><strong>간단한 비교: 직접 점수 합산 vs RRF</strong>
<ul>
<li>직접 합산(Weighted Sum)은 스코어 정규화·가중치 조정이 필요하다.<br>
</li>
<li>RRF는 정규화 과정이 필요 없고, 서로 다른 스케일의 신호를 순위 기반으로 안정적으로 결합한다.<br>
</li>
<li>단점: RRF는 가중치 조절이 기본형에서 어렵고, 상위 순위 간 차이를 압축하는 경향이 있다(즉 1위와 2위의 차이를 상대적으로 작게 반영할 수 있음).<br>
</li>
</ul></li>
<li><strong>실무 팁</strong>
<ul>
<li>RRF는 멀티시그널(fusion)에서 튜닝이 거의 필요 없는 강력한 기본 전략으로 좋다.</li>
<li>텍스트 신호와 벡터 신호 중 어느 쪽에 더 비중을 주고 싶으면, Weighted RRF(가중치 도입) 또는 정규화된 스코어를 사용한 Weighted Sum을 고려한다.</li>
<li>Azure처럼 플랫폼이 k 값을 고정(예: 60)하면, 그 환경에서의 특성을 이해하고 벡터 <code>k</code>(탑K 후보 수) 같은 다른 파라미터로 보완한다.</li>
<li>후보 풀(top-N) 크기에 따라 RRF 효과가 달라진다(예: 벡터에서 top50, 텍스트에서 top100 등).</li>
</ul></li>
</ul>
</section>
<section id="scoring-메커니즘-비교" class="level3" data-number="1.1.2">
<h3 data-number="1.1.2" class="anchored" data-anchor-id="scoring-메커니즘-비교"><span class="header-section-number">1.1.2</span> Scoring 메커니즘 비교</h3>
<p><strong>각 레이어의 역할 및 특성</strong>:</p>
<table class="table">
<colgroup>
<col style="width: 25%">
<col style="width: 17%">
<col style="width: 17%">
<col style="width: 21%">
<col style="width: 19%">
</colgroup>
<thead>
<tr class="header">
<th>Scoring Type</th>
<th>기반 기술</th>
<th>출력 범위</th>
<th>계산 복잡도</th>
<th>사용 목적</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td><strong>BM25</strong></td>
<td>TF-IDF 변형</td>
<td>[0, ∞)</td>
<td>O(n)</td>
<td>키워드 매칭</td>
</tr>
<tr class="even">
<td><strong>Vector Similarity</strong></td>
<td>Cosine/Euclidean</td>
<td>[-1, 1] or [0, ∞)</td>
<td>O(log n)</td>
<td>의미론적 유사성</td>
</tr>
<tr class="odd">
<td><strong>RRF</strong></td>
<td>Rank fusion</td>
<td>[0, 1]</td>
<td>O(k)</td>
<td>다중 신호 결합</td>
</tr>
<tr class="even">
<td><strong>Semantic Reranking</strong></td>
<td>BERT 기반</td>
<td>[0, 4]</td>
<td>O(k²)</td>
<td>컨텍스트 이해</td>
</tr>
<tr class="odd">
<td><strong>Scoring Profile</strong></td>
<td>규칙 기반</td>
<td>Multiplicative</td>
<td>O(1)</td>
<td>비즈니스 로직</td>
</tr>
</tbody>
</table>
</section>
</section>
<section id="bm25-lexical-scoring-알고리즘" class="level2" data-number="1.2">
<h2 data-number="1.2" class="anchored" data-anchor-id="bm25-lexical-scoring-알고리즘"><span class="header-section-number">1.2</span> BM25 Lexical Scoring 알고리즘</h2>
<p><strong>BM25 (Best Matching 25) 공식</strong>:</p>
<p><img src="https://latex.codecogs.com/png.latex?%5Ctext%7Bscore%7D(D,%20Q)%20=%20%5Csum_%7Bi=1%7D%5E%7Bn%7D%20%5Ctext%7BIDF%7D(q_i)%20%5Ccdot%20%5Cfrac%7Bf(q_i,%20D)%20%5Ccdot%20(k_1%20+%201)%7D%7Bf(q_i,%20D)%20+%20k_1%20%5Ccdot%20%5Cleft(1%20-%20b%20+%20b%20%5Ccdot%20%5Cfrac%7B%7CD%7C%7D%7B%5Ctext%7Bavgdl%7D%7D%5Cright)%7D"></p>
<p><strong>구성 요소</strong>:</p>
<p><strong>IDF (Inverse Document Frequency)</strong>: <img src="https://latex.codecogs.com/png.latex?%5Ctext%7BIDF%7D(q_i)%20=%20%5Cln%5Cleft(%5Cfrac%7BN%20-%20n(q_i)%20+%200.5%7D%7Bn(q_i)%20+%200.5%7D%20+%201%5Cright)"></p>
<ul>
<li><img src="https://latex.codecogs.com/png.latex?N">: 전체 문서 수</li>
<li><img src="https://latex.codecogs.com/png.latex?n(q_i)">: 용어 <img src="https://latex.codecogs.com/png.latex?q_i">를 포함한 문서 수</li>
<li>희귀 용어일수록 높은 가중치</li>
</ul>
<p><strong>Term Frequency Saturation</strong>: - <img src="https://latex.codecogs.com/png.latex?f(q_i,%20D)">: 문서 <img src="https://latex.codecogs.com/png.latex?D">에서 용어 <img src="https://latex.codecogs.com/png.latex?q_i">의 빈도 - <img src="https://latex.codecogs.com/png.latex?k_1">: 용어 빈도 포화 파라미터 (Azure 기본값: <strong>1.2</strong>) - 효과: 용어가 반복될수록 점수 증가하지만 포화</p>
<p><strong>Length Normalization</strong>: - <img src="https://latex.codecogs.com/png.latex?%7CD%7C">: 문서 길이 - <img src="https://latex.codecogs.com/png.latex?%5Ctext%7Bavgdl%7D">: 평균 문서 길이 - <img src="https://latex.codecogs.com/png.latex?b">: 길이 정규화 파라미터 (Azure 기본값: <strong>0.75</strong>) - 효과: 긴 문서가 짧은 문서보다 불이익받지 않도록 조정</p>
<p><strong>k1 파라미터 효과</strong>:</p>
<table class="table">
<thead>
<tr class="header">
<th>k1 값</th>
<th>용어 빈도 영향</th>
<th>사용 사례</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td>0.0</td>
<td>무시 (binary)</td>
<td>존재/부재만 중요</td>
</tr>
<tr class="even">
<td>1.2</td>
<td>중간 (기본값)</td>
<td>범용</td>
</tr>
<tr class="odd">
<td>2.0</td>
<td>높음</td>
<td>용어 빈도 중요한 경우</td>
</tr>
<tr class="even">
<td>3.0+</td>
<td>매우 높음</td>
<td>통계 문서, 기술 문서</td>
</tr>
</tbody>
</table>
<p><strong>b 파라미터 효과</strong>:</p>
<table class="table">
<thead>
<tr class="header">
<th>b 값</th>
<th>길이 정규화</th>
<th>사용 사례</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td>0.0</td>
<td>없음</td>
<td>문서 길이 무관</td>
</tr>
<tr class="even">
<td>0.75</td>
<td>중간 (기본값)</td>
<td>범용</td>
</tr>
<tr class="odd">
<td>1.0</td>
<td>완전</td>
<td>짧은 문서 선호</td>
</tr>
</tbody>
</table>
<p><strong>실험적 평가</strong> (TREC 데이터셋): - (k1=1.2, b=0.75): MAP = 0.31 (baseline) - (k1=2.0, b=0.75): MAP = 0.33 (+6.5%) - (k1=1.2, b=0.5): MAP = 0.29 (-6.5%)</p>
</section>
<section id="vector-similarity-scoring-알고리즘" class="level2" data-number="1.3">
<h2 data-number="1.3" class="anchored" data-anchor-id="vector-similarity-scoring-알고리즘"><span class="header-section-number">1.3</span> Vector Similarity Scoring 알고리즘</h2>
<p><strong>Cosine Similarity</strong> (가장 일반적): <img src="https://latex.codecogs.com/png.latex?%5Ctext%7Bcosine%7D(%5Cmathbf%7BA%7D,%20%5Cmathbf%7BB%7D)%20=%20%5Cfrac%7B%5Cmathbf%7BA%7D%20%5Ccdot%20%5Cmathbf%7BB%7D%7D%7B%5C%7C%5Cmathbf%7BA%7D%5C%7C%20%5C%7C%5Cmathbf%7BB%7D%5C%7C%7D%20=%20%5Cfrac%7B%5Csum_%7Bi=1%7D%5E%7Bd%7D%20A_i%20B_i%7D%7B%5Csqrt%7B%5Csum_%7Bi=1%7D%5E%7Bd%7D%20A_i%5E2%7D%20%5Csqrt%7B%5Csum_%7Bi=1%7D%5E%7Bd%7D%20B_i%5E2%7D%7D"></p>
<p><strong>특성</strong>: - 범위: [-1, 1] (실제 텍스트 임베딩은 대부분 [0, 1]) - 방향만 고려, 크기 무시 - 정규화된 임베딩에서 dot product와 동일</p>
<p><strong>Euclidean Distance (L2)</strong>: <img src="https://latex.codecogs.com/png.latex?%5Ctext%7Bdistance%7D(%5Cmathbf%7BA%7D,%20%5Cmathbf%7BB%7D)%20=%20%5Csqrt%7B%5Csum_%7Bi=1%7D%5E%7Bd%7D%20(A_i%20-%20B_i)%5E2%7D"></p>
<p><strong>변환 to similarity</strong>: <img src="https://latex.codecogs.com/png.latex?%5Ctext%7Bsimilarity%7D%20=%20%5Cfrac%7B1%7D%7B1%20+%20%5Ctext%7Bdistance%7D%7D"></p>
<p><strong>특성</strong>: - 범위: [0, ∞) → similarity: (0, 1] - 절대적 거리 측정 - 벡터 크기 영향 받음</p>
<p><strong>Dot Product</strong>: <img src="https://latex.codecogs.com/png.latex?%5Ctext%7Bdot%7D(%5Cmathbf%7BA%7D,%20%5Cmathbf%7BB%7D)%20=%20%5Csum_%7Bi=1%7D%5E%7Bd%7D%20A_i%20B_i"></p>
<p><strong>특성</strong>: - 범위: (-∞, ∞) - 크기와 방향 모두 고려 - 정규화 필요</p>
<section id="metric-선택-가이드" class="level3" data-number="1.3.1">
<h3 data-number="1.3.1" class="anchored" data-anchor-id="metric-선택-가이드"><span class="header-section-number">1.3.1</span> Metric 선택 가이드</h3>
<p><strong>Metric 비교 실험</strong> (1M 벡터, 1536-dim, OpenAI ada-002):</p>
<table class="table">
<thead>
<tr class="header">
<th>Metric</th>
<th>Recall@10</th>
<th>쿼리 시간</th>
<th>인덱스 크기</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td>Cosine</td>
<td>0.95</td>
<td>20ms</td>
<td>1.0x</td>
</tr>
<tr class="even">
<td>Euclidean</td>
<td>0.94</td>
<td>18ms</td>
<td>1.0x</td>
</tr>
<tr class="odd">
<td>Dot Product</td>
<td>0.93</td>
<td>15ms</td>
<td>1.0x</td>
</tr>
</tbody>
</table>
<p><strong>권장 사항</strong>:</p>
<pre><code>임베딩 모델 타입?
├─ OpenAI (ada-002, text-embedding-3-*)
│  └─ Cosine (모델이 정규화된 임베딩 생성)
│
├─ Sentence-BERT
│  └─ Cosine (정규화됨)
│
├─ Custom BERT (fine-tuned)
│  └─ 모델 출력 확인
│     ├─ Normalized → Cosine or Dot Product
│     └─ Not normalized → Euclidean
│
└─ Image embeddings (CLIP, Florence)
   └─ Cosine (표준)</code></pre>
</section>
</section>
<section id="hybrid-search-ranking-rrf" class="level2" data-number="1.4">
<h2 data-number="1.4" class="anchored" data-anchor-id="hybrid-search-ranking-rrf"><span class="header-section-number">1.4</span> Hybrid Search Ranking (RRF)</h2>
<section id="rrf-특성-및-장점" class="level3" data-number="1.4.1">
<h3 data-number="1.4.1" class="anchored" data-anchor-id="rrf-특성-및-장점"><span class="header-section-number">1.4.1</span> RRF 특성 및 장점</h3>
<p><strong>장점</strong>: 1. <strong>점수 범위 정규화</strong>: 서로 다른 스케일의 점수 결합 가능 2. <strong>순위 기반</strong>: 절대 점수 차이보다 순위에 민감 3. <strong>단순성</strong>: 파라미터 튜닝 불필요 (k=60 고정) 4. <strong>견고성</strong>: 한 쪽 결과가 없어도 동작</p>
<p><strong>단점</strong>: 1. <strong>가중치 제어 불가</strong>: 텍스트/벡터 중요도 조정 어려움 2. <strong>순위 압축</strong>: 상위 순위 차이가 과소평가될 수 있음</p>
<p><strong>대안: Weighted RRF</strong> (Azure는 미지원, 개념적): <img src="https://latex.codecogs.com/png.latex?%5Ctext%7BWeighted%20RRF%7D(d)%20=%20%5Csum_%7Br%20%5Cin%20R%7D%20%5Cfrac%7Bw_r%7D%7Bk%20+%20%5Ctext%7Brank%7D_r(d)%7D"></p>
<ul>
<li><img src="https://latex.codecogs.com/png.latex?w_r">: 랭킹 함수 <img src="https://latex.codecogs.com/png.latex?r">의 가중치</li>
</ul>
</section>
<section id="rrf-vs-다른-fusion-방법" class="level3" data-number="1.4.2">
<h3 data-number="1.4.2" class="anchored" data-anchor-id="rrf-vs-다른-fusion-방법"><span class="header-section-number">1.4.2</span> RRF vs 다른 Fusion 방법</h3>
<p><strong>Fusion 방법 비교</strong>:</p>
<table class="table">
<thead>
<tr class="header">
<th>방법</th>
<th>공식</th>
<th>장점</th>
<th>단점</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td><strong>RRF</strong></td>
<td><img src="https://latex.codecogs.com/png.latex?%5Csum%20%5Cfrac%7B1%7D%7Bk+rank%7D"></td>
<td>단순, 견고</td>
<td>가중치 불가</td>
</tr>
<tr class="even">
<td><strong>CombSUM</strong></td>
<td><img src="https://latex.codecogs.com/png.latex?%5Csum%20score"></td>
<td>직관적</td>
<td>스케일 민감</td>
</tr>
<tr class="odd">
<td><strong>CombMNZ</strong></td>
<td><img src="https://latex.codecogs.com/png.latex?%5Ctext%7Bcount%7D%20%5Ctimes%20%5Csum%20score"></td>
<td>교집합 선호</td>
<td>복잡</td>
</tr>
<tr class="even">
<td><strong>Weighted Sum</strong></td>
<td><img src="https://latex.codecogs.com/png.latex?%5Csum%20w%20%5Ccdot%20score"></td>
<td>가중치 가능</td>
<td>정규화 필요</td>
</tr>
</tbody>
</table>
<p><strong>실험적 성능</strong> (TREC Web Track): - Text only: NDCG@10 = 0.31 - Vector only: NDCG@10 = 0.38 - RRF: NDCG@10 = 0.46 (+48% vs text) - Optimal Weighted Sum: NDCG@10 = 0.48 (+3% vs RRF)</p>
<p><strong>결론</strong>: RRF는 튜닝 없이도 최적에 근접한 성능</p>
</section>
<section id="hybrid-query-구성" class="level3" data-number="1.4.3">
<h3 data-number="1.4.3" class="anchored" data-anchor-id="hybrid-query-구성"><span class="header-section-number">1.4.3</span> Hybrid Query 구성</h3>
<p><strong>실행 플로우</strong>:</p>
<pre><code>1. Text Search (BM25)
   "azure machine learning" → Top 50 docs with scores
   Doc1: 8.5, Doc2: 7.2, Doc3: 6.8, ...

2. Vector Search (HNSW)
   [query embedding] → Top 50 docs with cosine similarities
   Doc5: 0.89, Doc1: 0.85, Doc10: 0.82, ...

3. RRF Fusion
   Doc1: RRF = 1/(60+1) + 1/(60+2) = 0.0325
   Doc2: RRF = 1/(60+2) + 1/(60+?)  (not in vector top 50)
   Doc5: RRF = 1/(60+?) + 1/(60+1)  (not in text top 50)
   ...

4. Final Ranking by RRF score (descending)
   Return top 10</code></pre>
<p><strong>RRF with 3 rankings</strong>: <img src="https://latex.codecogs.com/png.latex?%5Ctext%7BRRF%7D(d)%20=%20%5Cfrac%7B1%7D%7Bk%20+%20%5Ctext%7Brank%7D_%7B%5Ctext%7Btext%7D%7D(d)%7D%20+%20%5Cfrac%7B1%7D%7Bk%20+%20%5Ctext%7Brank%7D_%7B%5Ctext%7Btitle%5C_vec%7D%7D(d)%7D%20+%20%5Cfrac%7B1%7D%7Bk%20+%20%5Ctext%7Brank%7D_%7B%5Ctext%7Bcontent%5C_vec%7D%7D(d)%7D"></p>
</section>
</section>
<section id="semantic-ranking-상세" class="level2" data-number="1.5">
<h2 data-number="1.5" class="anchored" data-anchor-id="semantic-ranking-상세"><span class="header-section-number">1.5</span> Semantic Ranking 상세</h2>
<section id="semantic-reranking-아키텍처" class="level3" data-number="1.5.1">
<h3 data-number="1.5.1" class="anchored" data-anchor-id="semantic-reranking-아키텍처"><span class="header-section-number">1.5.1</span> Semantic Reranking 아키텍처</h3>
<p><strong>Semantic Ranker는 Microsoft의 fine-tuned BERT 기반 모델</strong>을 사용</p>
<p><strong>처리 플로우</strong>:</p>
<pre><code>Initial Retrieval (BM25 + Vector)
    ↓
Top 50 candidates
    ↓
┌─────────────────────────────────┐
│ Semantic Reranking Model        │
│ (BERT-based Cross-Encoder)      │
├─────────────────────────────────┤
│ Input: [CLS] query [SEP] doc    │
│ Output: Relevance score [0-4]   │
└─────────────────────────────────┘
    ↓
Reranked Top 50
    ↓
Return Top K (user requested)</code></pre>
<p><strong>모델 특성</strong>:<br>
- <strong>아키텍처</strong>: Cross-Encoder (query-document pair를 함께 인코딩)<br>
- <strong>기반 모델</strong>: BERT-base 또는 유사 (정확한 모델 비공개)<br>
- <strong>학습 데이터</strong>: Bing search logs, MS MARCO, 기타 Microsoft 데이터<br>
- <strong>출력 범위</strong>: [0, 4] (4가 가장 관련성 높음)</p>
</section>
<section id="semantic-scoring-vs-bm25vector" class="level3" data-number="1.5.2">
<h3 data-number="1.5.2" class="anchored" data-anchor-id="semantic-scoring-vs-bm25vector"><span class="header-section-number">1.5.2</span> Semantic Scoring vs BM25/Vector</h3>
<table class="table">
<thead>
<tr class="header">
<th>측면</th>
<th>BM25</th>
<th>Vector</th>
<th>Semantic</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td><strong>입력</strong></td>
<td>Term matching</td>
<td>Embeddings</td>
<td>Query+Doc pair</td>
</tr>
<tr class="even">
<td><strong>컨텍스트 이해</strong></td>
<td>없음</td>
<td>단어 수준</td>
<td>문장/문단 수준</td>
</tr>
<tr class="odd">
<td><strong>쿼리-문서 상호작용</strong></td>
<td>독립적</td>
<td>독립적</td>
<td>상호작용 모델링</td>
</tr>
<tr class="even">
<td><strong>처리 시간</strong></td>
<td>빠름 (20ms)</td>
<td>빠름 (30ms)</td>
<td>느림 (250ms)</td>
</tr>
</tbody>
</table>
<p><strong>예시 시나리오</strong>:</p>
<pre><code>Query: "how to improve search relevance"

Document A: "search relevance improvement techniques"
- BM25: 높음 (키워드 매칭)
- Vector: 높음 (의미 유사)
- Semantic: 매우 높음 (질문-답변 관계 이해)

Document B: "Azure Search is relevant for developers"
- BM25: 중간 (search, relevant 매칭)
- Vector: 중간
- Semantic: 낮음 (질문에 대한 답변 아님)</code></pre>
</section>
<section id="semantic-configuration" class="level3" data-number="1.5.3">
<h3 data-number="1.5.3" class="anchored" data-anchor-id="semantic-configuration"><span class="header-section-number">1.5.3</span> Semantic Configuration</h3>
<p><strong>인덱스 스키마</strong>:</p>
<div class="sourceCode" id="cb6" style="background: #f1f3f5;"><pre class="sourceCode numberSource json number-lines code-with-copy"><code class="sourceCode json"><span id="cb6-1"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">{</span></span>
<span id="cb6-2">  <span class="dt" style="color: #AD0000;
background-color: null;
font-style: inherit;">"semantic"</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">:</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">{</span></span>
<span id="cb6-3">    <span class="dt" style="color: #AD0000;
background-color: null;
font-style: inherit;">"configurations"</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">:</span> <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">[</span></span>
<span id="cb6-4">      <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">{</span></span>
<span id="cb6-5">        <span class="dt" style="color: #AD0000;
background-color: null;
font-style: inherit;">"name"</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">:</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"my-semantic-config"</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">,</span></span>
<span id="cb6-6">        <span class="dt" style="color: #AD0000;
background-color: null;
font-style: inherit;">"prioritizedFields"</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">:</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">{</span></span>
<span id="cb6-7">          <span class="dt" style="color: #AD0000;
background-color: null;
font-style: inherit;">"titleField"</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">:</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">{</span></span>
<span id="cb6-8">            <span class="dt" style="color: #AD0000;
background-color: null;
font-style: inherit;">"fieldName"</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">:</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"title"</span></span>
<span id="cb6-9">          <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">},</span></span>
<span id="cb6-10">          <span class="dt" style="color: #AD0000;
background-color: null;
font-style: inherit;">"prioritizedContentFields"</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">:</span> <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">[</span></span>
<span id="cb6-11">            <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">{</span><span class="dt" style="color: #AD0000;
background-color: null;
font-style: inherit;">"fieldName"</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">:</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"content"</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">}</span><span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">,</span></span>
<span id="cb6-12">            <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">{</span><span class="dt" style="color: #AD0000;
background-color: null;
font-style: inherit;">"fieldName"</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">:</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"abstract"</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">}</span></span>
<span id="cb6-13">          <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">]</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">,</span></span>
<span id="cb6-14">          <span class="dt" style="color: #AD0000;
background-color: null;
font-style: inherit;">"prioritizedKeywordsFields"</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">:</span> <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">[</span></span>
<span id="cb6-15">            <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">{</span><span class="dt" style="color: #AD0000;
background-color: null;
font-style: inherit;">"fieldName"</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">:</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"tags"</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">}</span><span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">,</span></span>
<span id="cb6-16">            <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">{</span><span class="dt" style="color: #AD0000;
background-color: null;
font-style: inherit;">"fieldName"</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">:</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"category"</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">}</span></span>
<span id="cb6-17">          <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">]</span></span>
<span id="cb6-18">        <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">}</span></span>
<span id="cb6-19">      <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">}</span></span>
<span id="cb6-20">    <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">]</span></span>
<span id="cb6-21">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">}</span></span>
<span id="cb6-22"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">}</span></span></code></pre></div>
<p><strong>필드 우선순위 영향</strong>: - <strong>Title Field</strong>: 가장 높은 가중치 (~2-3배) - <strong>Content Fields</strong>: 주요 콘텐츠 (기본 가중치) - <strong>Keywords Fields</strong>: 메타데이터 (낮은 가중치)</p>
<p><strong>쿼리</strong>:</p>
<div class="sourceCode" id="cb7" style="background: #f1f3f5;"><pre class="sourceCode numberSource json number-lines code-with-copy"><code class="sourceCode json"><span id="cb7-1"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">{</span></span>
<span id="cb7-2">  <span class="dt" style="color: #AD0000;
background-color: null;
font-style: inherit;">"search"</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">:</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"how to optimize search"</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">,</span></span>
<span id="cb7-3">  <span class="dt" style="color: #AD0000;
background-color: null;
font-style: inherit;">"queryType"</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">:</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"semantic"</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">,</span></span>
<span id="cb7-4">  <span class="dt" style="color: #AD0000;
background-color: null;
font-style: inherit;">"semanticConfiguration"</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">:</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"my-semantic-config"</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">,</span></span>
<span id="cb7-5">  <span class="dt" style="color: #AD0000;
background-color: null;
font-style: inherit;">"top"</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">:</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">10</span></span>
<span id="cb7-6"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">}</span></span></code></pre></div>
<p><strong>응답</strong>:</p>
<div class="sourceCode" id="cb8" style="background: #f1f3f5;"><pre class="sourceCode numberSource json number-lines code-with-copy"><code class="sourceCode json"><span id="cb8-1"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">{</span></span>
<span id="cb8-2">  <span class="dt" style="color: #AD0000;
background-color: null;
font-style: inherit;">"value"</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">:</span> <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">[</span></span>
<span id="cb8-3">    <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">{</span></span>
<span id="cb8-4">      <span class="dt" style="color: #AD0000;
background-color: null;
font-style: inherit;">"@search.score"</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">:</span> <span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">8.5</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">,</span>           <span class="er" style="color: #AD0000;
background-color: null;
font-style: inherit;">//</span> <span class="er" style="color: #AD0000;
background-color: null;
font-style: inherit;">BM25</span> <span class="er" style="color: #AD0000;
background-color: null;
font-style: inherit;">score</span></span>
<span id="cb8-5">      <span class="dt" style="color: #AD0000;
background-color: null;
font-style: inherit;">"@search.rerankerScore"</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">:</span> <span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">3.2</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">,</span>   <span class="er" style="color: #AD0000;
background-color: null;
font-style: inherit;">//</span> <span class="er" style="color: #AD0000;
background-color: null;
font-style: inherit;">Semantic</span> <span class="er" style="color: #AD0000;
background-color: null;
font-style: inherit;">score</span> <span class="er" style="color: #AD0000;
background-color: null;
font-style: inherit;">[0-4]</span></span>
<span id="cb8-6">      <span class="dt" style="color: #AD0000;
background-color: null;
font-style: inherit;">"id"</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">:</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"doc1"</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">,</span></span>
<span id="cb8-7">      <span class="dt" style="color: #AD0000;
background-color: null;
font-style: inherit;">"title"</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">:</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Search Optimization Guide"</span></span>
<span id="cb8-8">    <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">}</span></span>
<span id="cb8-9">  <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">]</span></span>
<span id="cb8-10"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">}</span></span></code></pre></div>
</section>
<section id="semantic-ranking-성능" class="level3" data-number="1.5.4">
<h3 data-number="1.5.4" class="anchored" data-anchor-id="semantic-ranking-성능"><span class="header-section-number">1.5.4</span> Semantic Ranking 성능</h3>
<p><strong>정확도 향상</strong> (MS MARCO Dev Set): - BM25 baseline: MRR@10 = 0.18 - BM25 + Semantic: MRR@10 = 0.31 (+72%) - Hybrid baseline: NDCG@10 = 0.46 - Hybrid + Semantic: NDCG@10 = 0.54 (+17%)</p>
<p><strong>처리 시간 오버헤드</strong>: - 초기 검색 (Hybrid): 80ms - Semantic reranking (50 docs): +250ms - 총: 330ms (4배 증가)</p>
<p><strong>비용</strong>: - 기본: 월 1,000 쿼리 포함 (Standard 티어 +$500/month) - 초과 시: 추가 패키지 구매 필요</p>
<p><strong>사용 권장</strong>:</p>
<pre><code>쿼리 특성?
├─ 키워드 정합 (제품 ID, 정확한 매칭)
│  └─ Semantic 불필요
│
├─ 자연어 질문 (QA 스타일)
│  └─ Semantic 강력 추천
│
├─ 긴 문서 검색 (논문, 기술 문서)
│  └─ Semantic 권장
│
└─ 높은 QPS (&gt;100 queries/sec)
   └─ Semantic 비권장 (지연시간, 비용)</code></pre>
<hr>
</section>
</section>
<section id="custom-scoring-profiles" class="level2" data-number="1.6">
<h2 data-number="1.6" class="anchored" data-anchor-id="custom-scoring-profiles"><span class="header-section-number">1.6</span> Custom Scoring Profiles</h2>
<section id="scoring-profile-개념" class="level3" data-number="1.6.1">
<h3 data-number="1.6.1" class="anchored" data-anchor-id="scoring-profile-개념"><span class="header-section-number">1.6.1</span> Scoring Profile 개념</h3>
<p><strong>Scoring Profile</strong>은 <strong>비즈니스 로직을 반영</strong>하여 검색 점수를 조정하는 메커니즘입니다.</p>
<p><strong>구성 요소</strong>: 1. <strong>Functions</strong>: 필드 값 기반 부스팅 2. <strong>Weights</strong>: 필드별 가중치 3. <strong>Mode</strong>: 결합 방식 (sum, average, min, max, first)</p>
</section>
<section id="scoring-function-타입" class="level3" data-number="1.6.2">
<h3 data-number="1.6.2" class="anchored" data-anchor-id="scoring-function-타입"><span class="header-section-number">1.6.2</span> Scoring Function 타입</h3>
<p><strong>Magnitude Function</strong> (숫자 필드):</p>
<div class="sourceCode" id="cb10" style="background: #f1f3f5;"><pre class="sourceCode numberSource json number-lines code-with-copy"><code class="sourceCode json"><span id="cb10-1"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">{</span></span>
<span id="cb10-2">  <span class="dt" style="color: #AD0000;
background-color: null;
font-style: inherit;">"functions"</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">:</span> <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">[</span></span>
<span id="cb10-3">    <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">{</span></span>
<span id="cb10-4">      <span class="dt" style="color: #AD0000;
background-color: null;
font-style: inherit;">"type"</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">:</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"magnitude"</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">,</span></span>
<span id="cb10-5">      <span class="dt" style="color: #AD0000;
background-color: null;
font-style: inherit;">"fieldName"</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">:</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"rating"</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">,</span></span>
<span id="cb10-6">      <span class="dt" style="color: #AD0000;
background-color: null;
font-style: inherit;">"boost"</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">:</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">5</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">,</span></span>
<span id="cb10-7">      <span class="dt" style="color: #AD0000;
background-color: null;
font-style: inherit;">"interpolation"</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">:</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"linear"</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">,</span></span>
<span id="cb10-8">      <span class="dt" style="color: #AD0000;
background-color: null;
font-style: inherit;">"magnitude"</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">:</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">{</span></span>
<span id="cb10-9">        <span class="dt" style="color: #AD0000;
background-color: null;
font-style: inherit;">"boostingRangeStart"</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">:</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">,</span></span>
<span id="cb10-10">        <span class="dt" style="color: #AD0000;
background-color: null;
font-style: inherit;">"boostingRangeEnd"</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">:</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">5</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">,</span></span>
<span id="cb10-11">        <span class="dt" style="color: #AD0000;
background-color: null;
font-style: inherit;">"constantBoostBeyondRange"</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">:</span> <span class="kw" style="color: #003B4F;
background-color: null;
font-style: inherit;">false</span></span>
<span id="cb10-12">      <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">}</span></span>
<span id="cb10-13">    <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">}</span></span>
<span id="cb10-14">  <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">]</span></span>
<span id="cb10-15"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">}</span></span></code></pre></div>
<p><strong>효과</strong>: - rating=5인 문서: 점수 × 5 (최대 부스트) - rating=3인 문서: 점수 × 3 (선형 보간) - rating=1인 문서: 점수 × 1 (부스트 없음)</p>
<p><strong>Freshness Function</strong> (날짜 필드):</p>
<div class="sourceCode" id="cb11" style="background: #f1f3f5;"><pre class="sourceCode numberSource json number-lines code-with-copy"><code class="sourceCode json"><span id="cb11-1"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">{</span></span>
<span id="cb11-2">  <span class="dt" style="color: #AD0000;
background-color: null;
font-style: inherit;">"functions"</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">:</span> <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">[</span></span>
<span id="cb11-3">    <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">{</span></span>
<span id="cb11-4">      <span class="dt" style="color: #AD0000;
background-color: null;
font-style: inherit;">"type"</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">:</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"freshness"</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">,</span></span>
<span id="cb11-5">      <span class="dt" style="color: #AD0000;
background-color: null;
font-style: inherit;">"fieldName"</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">:</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"publishDate"</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">,</span></span>
<span id="cb11-6">      <span class="dt" style="color: #AD0000;
background-color: null;
font-style: inherit;">"boost"</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">:</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">10</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">,</span></span>
<span id="cb11-7">      <span class="dt" style="color: #AD0000;
background-color: null;
font-style: inherit;">"interpolation"</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">:</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"logarithmic"</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">,</span></span>
<span id="cb11-8">      <span class="dt" style="color: #AD0000;
background-color: null;
font-style: inherit;">"freshness"</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">:</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">{</span></span>
<span id="cb11-9">        <span class="dt" style="color: #AD0000;
background-color: null;
font-style: inherit;">"boostingDuration"</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">:</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"P30D"</span>  <span class="er" style="color: #AD0000;
background-color: null;
font-style: inherit;">//</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">30</span> <span class="er" style="color: #AD0000;
background-color: null;
font-style: inherit;">days</span></span>
<span id="cb11-10">      <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">}</span></span>
<span id="cb11-11">    <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">}</span></span>
<span id="cb11-12">  <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">]</span></span>
<span id="cb11-13"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">}</span></span></code></pre></div>
<p><strong>효과</strong>: - 오늘 게시: 점수 × 10 - 15일 전 게시: 점수 × ~5 (로그 보간) - 30일 전 게시: 점수 × 1 - 30일 이상: 점수 × 1</p>
<p><strong>Distance Function</strong> (지리적 위치):</p>
<div class="sourceCode" id="cb12" style="background: #f1f3f5;"><pre class="sourceCode numberSource json number-lines code-with-copy"><code class="sourceCode json"><span id="cb12-1"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">{</span></span>
<span id="cb12-2">  <span class="dt" style="color: #AD0000;
background-color: null;
font-style: inherit;">"functions"</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">:</span> <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">[</span></span>
<span id="cb12-3">    <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">{</span></span>
<span id="cb12-4">      <span class="dt" style="color: #AD0000;
background-color: null;
font-style: inherit;">"type"</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">:</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"distance"</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">,</span></span>
<span id="cb12-5">      <span class="dt" style="color: #AD0000;
background-color: null;
font-style: inherit;">"fieldName"</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">:</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"location"</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">,</span></span>
<span id="cb12-6">      <span class="dt" style="color: #AD0000;
background-color: null;
font-style: inherit;">"boost"</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">:</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">3</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">,</span></span>
<span id="cb12-7">      <span class="dt" style="color: #AD0000;
background-color: null;
font-style: inherit;">"interpolation"</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">:</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"linear"</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">,</span></span>
<span id="cb12-8">      <span class="dt" style="color: #AD0000;
background-color: null;
font-style: inherit;">"distance"</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">:</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">{</span></span>
<span id="cb12-9">        <span class="dt" style="color: #AD0000;
background-color: null;
font-style: inherit;">"referencePointParameter"</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">:</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"currentLocation"</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">,</span></span>
<span id="cb12-10">        <span class="dt" style="color: #AD0000;
background-color: null;
font-style: inherit;">"boostingDistance"</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">:</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">10</span>  <span class="er" style="color: #AD0000;
background-color: null;
font-style: inherit;">//</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">10</span> <span class="er" style="color: #AD0000;
background-color: null;
font-style: inherit;">km</span></span>
<span id="cb12-11">      <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">}</span></span>
<span id="cb12-12">    <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">}</span></span>
<span id="cb12-13">  <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">]</span></span>
<span id="cb12-14"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">}</span></span></code></pre></div>
<p><strong>Tag Function</strong> (카테고리 매칭):</p>
<div class="sourceCode" id="cb13" style="background: #f1f3f5;"><pre class="sourceCode numberSource json number-lines code-with-copy"><code class="sourceCode json"><span id="cb13-1"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">{</span></span>
<span id="cb13-2">  <span class="dt" style="color: #AD0000;
background-color: null;
font-style: inherit;">"functions"</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">:</span> <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">[</span></span>
<span id="cb13-3">    <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">{</span></span>
<span id="cb13-4">      <span class="dt" style="color: #AD0000;
background-color: null;
font-style: inherit;">"type"</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">:</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"tag"</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">,</span></span>
<span id="cb13-5">      <span class="dt" style="color: #AD0000;
background-color: null;
font-style: inherit;">"fieldName"</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">:</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"tags"</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">,</span></span>
<span id="cb13-6">      <span class="dt" style="color: #AD0000;
background-color: null;
font-style: inherit;">"boost"</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">:</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">8</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">,</span></span>
<span id="cb13-7">      <span class="dt" style="color: #AD0000;
background-color: null;
font-style: inherit;">"tag"</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">:</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">{</span></span>
<span id="cb13-8">        <span class="dt" style="color: #AD0000;
background-color: null;
font-style: inherit;">"tagsParameter"</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">:</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"preferredTags"</span></span>
<span id="cb13-9">      <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">}</span></span>
<span id="cb13-10">    <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">}</span></span>
<span id="cb13-11">  <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">]</span></span>
<span id="cb13-12"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">}</span></span></code></pre></div>
</section>
<section id="interpolation-방식" class="level3" data-number="1.6.3">
<h3 data-number="1.6.3" class="anchored" data-anchor-id="interpolation-방식"><span class="header-section-number">1.6.3</span> Interpolation 방식</h3>
<p><strong>선형 보간 (Linear)</strong>: <img src="https://latex.codecogs.com/png.latex?%5Ctext%7Bboost%7D%20=%20%5Ctext%7Bmin%5C_boost%7D%20+%20%5Cfrac%7B%5Ctext%7Bvalue%7D%20-%20%5Ctext%7Bmin%7D%7D%7B%5Ctext%7Bmax%7D%20-%20%5Ctext%7Bmin%7D%7D%20%5Ctimes%20(%5Ctext%7Bmax%5C_boost%7D%20-%20%5Ctext%7Bmin%5C_boost%7D)"></p>
<p><strong>로그 보간 (Logarithmic)</strong>: <img src="https://latex.codecogs.com/png.latex?%5Ctext%7Bboost%7D%20=%20%5Ctext%7Bmin%5C_boost%7D%20+%20%5Cln%5Cleft(1%20+%20%5Cfrac%7B%5Ctext%7Bvalue%7D%20-%20%5Ctext%7Bmin%7D%7D%7B%5Ctext%7Bmax%7D%20-%20%5Ctext%7Bmin%7D%7D%20%5Ctimes%20(e%20-%201)%5Cright)%20%5Ctimes%20(%5Ctext%7Bmax%5C_boost%7D%20-%20%5Ctext%7Bmin%5C_boost%7D)"></p>
<p><strong>특성</strong>: - Linear: 균등한 증가 - Logarithmic: 초기 급증, 이후 완만</p>
</section>
<section id="complete-scoring-profile-예시" class="level3" data-number="1.6.4">
<h3 data-number="1.6.4" class="anchored" data-anchor-id="complete-scoring-profile-예시"><span class="header-section-number">1.6.4</span> Complete Scoring Profile 예시</h3>
<p><strong>E-commerce 시나리오</strong>:</p>
<div class="sourceCode" id="cb14" style="background: #f1f3f5;"><pre class="sourceCode numberSource json number-lines code-with-copy"><code class="sourceCode json"><span id="cb14-1"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">{</span></span>
<span id="cb14-2">  <span class="dt" style="color: #AD0000;
background-color: null;
font-style: inherit;">"scoringProfiles"</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">:</span> <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">[</span></span>
<span id="cb14-3">    <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">{</span></span>
<span id="cb14-4">      <span class="dt" style="color: #AD0000;
background-color: null;
font-style: inherit;">"name"</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">:</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"product-ranking"</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">,</span></span>
<span id="cb14-5">      <span class="dt" style="color: #AD0000;
background-color: null;
font-style: inherit;">"text"</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">:</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">{</span></span>
<span id="cb14-6">        <span class="dt" style="color: #AD0000;
background-color: null;
font-style: inherit;">"weights"</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">:</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">{</span></span>
<span id="cb14-7">          <span class="dt" style="color: #AD0000;
background-color: null;
font-style: inherit;">"title"</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">:</span> <span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">3.0</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">,</span></span>
<span id="cb14-8">          <span class="dt" style="color: #AD0000;
background-color: null;
font-style: inherit;">"description"</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">:</span> <span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">1.5</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">,</span></span>
<span id="cb14-9">          <span class="dt" style="color: #AD0000;
background-color: null;
font-style: inherit;">"tags"</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">:</span> <span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">2.0</span></span>
<span id="cb14-10">        <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">}</span></span>
<span id="cb14-11">      <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">},</span></span>
<span id="cb14-12">      <span class="dt" style="color: #AD0000;
background-color: null;
font-style: inherit;">"functions"</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">:</span> <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">[</span></span>
<span id="cb14-13">        <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">{</span></span>
<span id="cb14-14">          <span class="dt" style="color: #AD0000;
background-color: null;
font-style: inherit;">"type"</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">:</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"magnitude"</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">,</span></span>
<span id="cb14-15">          <span class="dt" style="color: #AD0000;
background-color: null;
font-style: inherit;">"fieldName"</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">:</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"rating"</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">,</span></span>
<span id="cb14-16">          <span class="dt" style="color: #AD0000;
background-color: null;
font-style: inherit;">"boost"</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">:</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">5</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">,</span></span>
<span id="cb14-17">          <span class="dt" style="color: #AD0000;
background-color: null;
font-style: inherit;">"interpolation"</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">:</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"linear"</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">,</span></span>
<span id="cb14-18">          <span class="dt" style="color: #AD0000;
background-color: null;
font-style: inherit;">"magnitude"</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">:</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">{</span></span>
<span id="cb14-19">            <span class="dt" style="color: #AD0000;
background-color: null;
font-style: inherit;">"boostingRangeStart"</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">:</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">,</span></span>
<span id="cb14-20">            <span class="dt" style="color: #AD0000;
background-color: null;
font-style: inherit;">"boostingRangeEnd"</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">:</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">5</span></span>
<span id="cb14-21">          <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">}</span></span>
<span id="cb14-22">        <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">}</span><span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">,</span></span>
<span id="cb14-23">        <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">{</span></span>
<span id="cb14-24">          <span class="dt" style="color: #AD0000;
background-color: null;
font-style: inherit;">"type"</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">:</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"freshness"</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">,</span></span>
<span id="cb14-25">          <span class="dt" style="color: #AD0000;
background-color: null;
font-style: inherit;">"fieldName"</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">:</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"publishDate"</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">,</span></span>
<span id="cb14-26">          <span class="dt" style="color: #AD0000;
background-color: null;
font-style: inherit;">"boost"</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">:</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">3</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">,</span></span>
<span id="cb14-27">          <span class="dt" style="color: #AD0000;
background-color: null;
font-style: inherit;">"interpolation"</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">:</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"logarithmic"</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">,</span></span>
<span id="cb14-28">          <span class="dt" style="color: #AD0000;
background-color: null;
font-style: inherit;">"freshness"</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">:</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">{</span></span>
<span id="cb14-29">            <span class="dt" style="color: #AD0000;
background-color: null;
font-style: inherit;">"boostingDuration"</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">:</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"P90D"</span></span>
<span id="cb14-30">          <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">}</span></span>
<span id="cb14-31">        <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">}</span><span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">,</span></span>
<span id="cb14-32">        <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">{</span></span>
<span id="cb14-33">          <span class="dt" style="color: #AD0000;
background-color: null;
font-style: inherit;">"type"</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">:</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"magnitude"</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">,</span></span>
<span id="cb14-34">          <span class="dt" style="color: #AD0000;
background-color: null;
font-style: inherit;">"fieldName"</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">:</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"salesCount"</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">,</span></span>
<span id="cb14-35">          <span class="dt" style="color: #AD0000;
background-color: null;
font-style: inherit;">"boost"</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">:</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">2</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">,</span></span>
<span id="cb14-36">          <span class="dt" style="color: #AD0000;
background-color: null;
font-style: inherit;">"interpolation"</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">:</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"logarithmic"</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">,</span></span>
<span id="cb14-37">          <span class="dt" style="color: #AD0000;
background-color: null;
font-style: inherit;">"magnitude"</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">:</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">{</span></span>
<span id="cb14-38">            <span class="dt" style="color: #AD0000;
background-color: null;
font-style: inherit;">"boostingRangeStart"</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">:</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">0</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">,</span></span>
<span id="cb14-39">            <span class="dt" style="color: #AD0000;
background-color: null;
font-style: inherit;">"boostingRangeEnd"</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">:</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">10000</span></span>
<span id="cb14-40">          <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">}</span></span>
<span id="cb14-41">        <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">}</span></span>
<span id="cb14-42">      <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">]</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">,</span></span>
<span id="cb14-43">      <span class="dt" style="color: #AD0000;
background-color: null;
font-style: inherit;">"functionAggregation"</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">:</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"sum"</span></span>
<span id="cb14-44">    <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">}</span></span>
<span id="cb14-45">  <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">]</span></span>
<span id="cb14-46"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">}</span></span></code></pre></div>
<p><strong>쿼리</strong>:</p>
<div class="sourceCode" id="cb15" style="background: #f1f3f5;"><pre class="sourceCode numberSource json number-lines code-with-copy"><code class="sourceCode json"><span id="cb15-1"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">{</span></span>
<span id="cb15-2">  <span class="dt" style="color: #AD0000;
background-color: null;
font-style: inherit;">"search"</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">:</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"laptop"</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">,</span></span>
<span id="cb15-3">  <span class="dt" style="color: #AD0000;
background-color: null;
font-style: inherit;">"scoringProfile"</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">:</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"product-ranking"</span></span>
<span id="cb15-4"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">}</span></span></code></pre></div>
<p><strong>점수 계산</strong>: <img src="https://latex.codecogs.com/png.latex?%5Ctext%7BFinal%20Score%7D%20=%20%5Ctext%7BBM25%20Score%7D%20%5Ctimes%20(1%20+%20%5Ctext%7BRating%20Boost%7D%20+%20%5Ctext%7BFreshness%20Boost%7D%20+%20%5Ctext%7BSales%20Boost%7D)"></p>
<p><strong>예시</strong>:</p>
<pre><code>Document A:
- BM25 score: 8.0
- rating: 4.5 → boost: 4.5
- publishDate: 10 days ago → boost: 2.7
- salesCount: 500 → boost: 1.5
- Final: 8.0 × (1 + 4.5 + 2.7 + 1.5) = 8.0 × 9.7 = 77.6

Document B:
- BM25 score: 9.0
- rating: 3.0 → boost: 3.0
- publishDate: 200 days ago → boost: 0
- salesCount: 50 → boost: 0.8
- Final: 9.0 × (1 + 3.0 + 0 + 0.8) = 9.0 × 4.8 = 43.2

Result: A &gt; B (despite lower BM25)</code></pre>
<hr>
</section>
</section>
<section id="통합-relevance-파이프라인" class="level2" data-number="1.7">
<h2 data-number="1.7" class="anchored" data-anchor-id="통합-relevance-파이프라인"><span class="header-section-number">1.7</span> 통합 Relevance 파이프라인</h2>
<section id="complete-ranking-flow" class="level3" data-number="1.7.1">
<h3 data-number="1.7.1" class="anchored" data-anchor-id="complete-ranking-flow"><span class="header-section-number">1.7.1</span> Complete Ranking Flow</h3>
<p><strong>전체 시스템 통합</strong>:</p>
<pre><code>User Query: "best wireless headphones under $100"
    ↓
┌────────────────────────────────────────────┐
│ 1. Query Analysis &amp; Expansion             │
│    - Synonym expansion                     │
│    - Spell correction                      │
└────────────────────────────────────────────┘
    ↓
┌────────────────────────────────────────────┐
│ 2. Initial Retrieval (Parallel)           │
│    ├─ Text Search (BM25)     → 1000 docs  │
│    └─ Vector Search (HNSW)   → 1000 docs  │
└────────────────────────────────────────────┘
    ↓
┌────────────────────────────────────────────┐
│ 3. Filter Application                      │
│    - price le 100                          │
│    - category eq 'Electronics'             │
│    → 800 docs remaining                    │
└────────────────────────────────────────────┘
    ↓
┌────────────────────────────────────────────┐
│ 4. RRF Fusion                              │
│    - Combine text + vector rankings        │
│    → Top 100 candidates                    │
└────────────────────────────────────────────┘
    ↓
┌────────────────────────────────────────────┐
│ 5. Semantic Reranking (optional)          │
│    - BERT cross-encoder on top 50          │
│    → Refined ranking                       │
└────────────────────────────────────────────┘
    ↓
┌────────────────────────────────────────────┐
│ 6. Scoring Profile Application            │
│    - Rating boost (4.5 stars)              │
│    - Freshness boost (recent)              │
│    - Sales count boost (popular)           │
└────────────────────────────────────────────┘
    ↓
┌────────────────────────────────────────────┐
│ 7. Final Ranking &amp; Pagination             │
│    - Sort by final score                   │
│    - Apply skip/top                        │
│    - Generate highlights/captions          │
└────────────────────────────────────────────┘
    ↓
Response to User</code></pre>
</section>
<section id="성능-분해-분석" class="level3" data-number="1.7.2">
<h3 data-number="1.7.2" class="anchored" data-anchor-id="성능-분해-분석"><span class="header-section-number">1.7.2</span> 성능 분해 분석</h3>
<p><strong>각 단계별 시간 및 영향</strong> (1M 문서 인덱스):</p>
<table class="table">
<thead>
<tr class="header">
<th>단계</th>
<th>처리 시간</th>
<th>정확도 기여</th>
<th>비용</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td>Query Analysis</td>
<td>5ms</td>
<td>+5%</td>
<td>무시 가능</td>
</tr>
<tr class="even">
<td>Text Search</td>
<td>30ms</td>
<td>Baseline</td>
<td>포함</td>
</tr>
<tr class="odd">
<td>Vector Search</td>
<td>25ms</td>
<td>+20%</td>
<td>포함</td>
</tr>
<tr class="even">
<td>Filter</td>
<td>10ms</td>
<td>N/A</td>
<td>포함</td>
</tr>
<tr class="odd">
<td>RRF Fusion</td>
<td>5ms</td>
<td>+8%</td>
<td>포함</td>
</tr>
<tr class="even">
<td>Semantic Reranking</td>
<td>250ms</td>
<td>+12%</td>
<td>+$500/month</td>
</tr>
<tr class="odd">
<td>Scoring Profile</td>
<td>2ms</td>
<td>+10%</td>
<td>포함</td>
</tr>
<tr class="even">
<td><strong>Total</strong></td>
<td><strong>327ms</strong></td>
<td><strong>+55%</strong></td>
<td><strong>+$500/month</strong></td>
</tr>
</tbody>
</table>
</section>
<section id="최적화-전략" class="level3" data-number="1.7.3">
<h3 data-number="1.7.3" class="anchored" data-anchor-id="최적화-전략"><span class="header-section-number">1.7.3</span> 최적화 전략</h3>
<p><strong>시나리오별 구성</strong>:</p>
<p><strong>시나리오 A: 저지연 우선</strong></p>
<div class="sourceCode" id="cb18" style="background: #f1f3f5;"><pre class="sourceCode numberSource json number-lines code-with-copy"><code class="sourceCode json"><span id="cb18-1"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">{</span></span>
<span id="cb18-2">  <span class="dt" style="color: #AD0000;
background-color: null;
font-style: inherit;">"search"</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">:</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"query"</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">,</span></span>
<span id="cb18-3">  <span class="dt" style="color: #AD0000;
background-color: null;
font-style: inherit;">"vectorQueries"</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">:</span> <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">[</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">{</span><span class="er" style="color: #AD0000;
background-color: null;
font-style: inherit;">...</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">}</span><span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">]</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">,</span></span>
<span id="cb18-4">  <span class="dt" style="color: #AD0000;
background-color: null;
font-style: inherit;">"queryType"</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">:</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"simple"</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">,</span>  <span class="er" style="color: #AD0000;
background-color: null;
font-style: inherit;">//</span> <span class="er" style="color: #AD0000;
background-color: null;
font-style: inherit;">no</span> <span class="er" style="color: #AD0000;
background-color: null;
font-style: inherit;">semantic</span></span>
<span id="cb18-5">  <span class="dt" style="color: #AD0000;
background-color: null;
font-style: inherit;">"scoringProfile"</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">:</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"basic"</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">,</span></span>
<span id="cb18-6">  <span class="dt" style="color: #AD0000;
background-color: null;
font-style: inherit;">"top"</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">:</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">10</span></span>
<span id="cb18-7"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">}</span></span></code></pre></div>
<ul>
<li>지연시간: ~80ms</li>
<li>정확도: 중간</li>
</ul>
<p><strong>시나리오 B: 정확도 우선</strong></p>
<div class="sourceCode" id="cb19" style="background: #f1f3f5;"><pre class="sourceCode numberSource json number-lines code-with-copy"><code class="sourceCode json"><span id="cb19-1"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">{</span></span>
<span id="cb19-2">  <span class="dt" style="color: #AD0000;
background-color: null;
font-style: inherit;">"search"</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">:</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"query"</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">,</span></span>
<span id="cb19-3">  <span class="dt" style="color: #AD0000;
background-color: null;
font-style: inherit;">"vectorQueries"</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">:</span> <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">[</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">{</span><span class="er" style="color: #AD0000;
background-color: null;
font-style: inherit;">...</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">}</span><span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">]</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">,</span></span>
<span id="cb19-4">  <span class="dt" style="color: #AD0000;
background-color: null;
font-style: inherit;">"queryType"</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">:</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"semantic"</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">,</span></span>
<span id="cb19-5">  <span class="dt" style="color: #AD0000;
background-color: null;
font-style: inherit;">"scoringProfile"</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">:</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"advanced"</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">,</span></span>
<span id="cb19-6">  <span class="dt" style="color: #AD0000;
background-color: null;
font-style: inherit;">"top"</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">:</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">10</span></span>
<span id="cb19-7"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">}</span></span></code></pre></div>
<ul>
<li>지연시간: ~330ms</li>
<li>정확도: 높음</li>
</ul>
<p><strong>시나리오 C: 비용 우선</strong></p>
<div class="sourceCode" id="cb20" style="background: #f1f3f5;"><pre class="sourceCode numberSource json number-lines code-with-copy"><code class="sourceCode json"><span id="cb20-1"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">{</span></span>
<span id="cb20-2">  <span class="dt" style="color: #AD0000;
background-color: null;
font-style: inherit;">"search"</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">:</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"query"</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">,</span></span>
<span id="cb20-3">  <span class="dt" style="color: #AD0000;
background-color: null;
font-style: inherit;">"vectorQueries"</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">:</span> <span class="kw" style="color: #003B4F;
background-color: null;
font-style: inherit;">null</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">,</span>  <span class="er" style="color: #AD0000;
background-color: null;
font-style: inherit;">//</span> <span class="er" style="color: #AD0000;
background-color: null;
font-style: inherit;">no</span> <span class="er" style="color: #AD0000;
background-color: null;
font-style: inherit;">vector</span></span>
<span id="cb20-4">  <span class="dt" style="color: #AD0000;
background-color: null;
font-style: inherit;">"queryType"</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">:</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"simple"</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">,</span>  <span class="er" style="color: #AD0000;
background-color: null;
font-style: inherit;">//</span> <span class="er" style="color: #AD0000;
background-color: null;
font-style: inherit;">no</span> <span class="er" style="color: #AD0000;
background-color: null;
font-style: inherit;">semantic</span></span>
<span id="cb20-5">  <span class="dt" style="color: #AD0000;
background-color: null;
font-style: inherit;">"scoringProfile"</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">:</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"basic"</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">,</span></span>
<span id="cb20-6">  <span class="dt" style="color: #AD0000;
background-color: null;
font-style: inherit;">"top"</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">:</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">10</span></span>
<span id="cb20-7"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">}</span></span></code></pre></div>
<ul>
<li>지연시간: ~50ms</li>
<li>비용: 최소</li>
<li>정확도: 기본</li>
</ul>
<hr>
</section>
</section>
<section id="relevance-tuning-best-practices" class="level2" data-number="1.8">
<h2 data-number="1.8" class="anchored" data-anchor-id="relevance-tuning-best-practices"><span class="header-section-number">1.8</span> Relevance Tuning Best Practices</h2>
<section id="ab-테스트-프레임워크" class="level3" data-number="1.8.1">
<h3 data-number="1.8.1" class="anchored" data-anchor-id="ab-테스트-프레임워크"><span class="header-section-number">1.8.1</span> A/B 테스트 프레임워크</h3>
<p><strong>테스트 설정</strong>:</p>
<div class="sourceCode" id="cb21" style="background: #f1f3f5;"><pre class="sourceCode numberSource python number-lines code-with-copy"><code class="sourceCode python"><span id="cb21-1"><span class="kw" style="color: #003B4F;
background-color: null;
font-style: inherit;">def</span> compare_ranking_strategies(queries, ground_truth):</span>
<span id="cb21-2">    strategies <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> {</span>
<span id="cb21-3">        <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">'baseline'</span>: {<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">'queryType'</span>: <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">'simple'</span>},</span>
<span id="cb21-4">        <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">'hybrid'</span>: {<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">'search'</span>: <span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">True</span>, <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">'vectorQueries'</span>: [...]},</span>
<span id="cb21-5">        <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">'semantic'</span>: {<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">'queryType'</span>: <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">'semantic'</span>},</span>
<span id="cb21-6">        <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">'custom'</span>: {<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">'scoringProfile'</span>: <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">'custom-v1'</span>}</span>
<span id="cb21-7">    }</span>
<span id="cb21-8">    </span>
<span id="cb21-9">    results <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> {}</span>
<span id="cb21-10">    <span class="cf" style="color: #003B4F;
background-color: null;
font-style: inherit;">for</span> name, config <span class="kw" style="color: #003B4F;
background-color: null;
font-style: inherit;">in</span> strategies.items():</span>
<span id="cb21-11">        ndcg <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> evaluate_ndcg(queries, config, ground_truth)</span>
<span id="cb21-12">        latency <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> measure_latency(queries, config)</span>
<span id="cb21-13">        results[name] <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> {<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">'ndcg'</span>: ndcg, <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">'latency'</span>: latency}</span>
<span id="cb21-14">    </span>
<span id="cb21-15">    <span class="cf" style="color: #003B4F;
background-color: null;
font-style: inherit;">return</span> results</span></code></pre></div>
<p><strong>평가 메트릭</strong>:</p>
<p><strong>NDCG (Normalized Discounted Cumulative Gain)</strong>: <img src="https://latex.codecogs.com/png.latex?%5Ctext%7BNDCG@k%7D%20=%20%5Cfrac%7B%5Ctext%7BDCG@k%7D%7D%7B%5Ctext%7BIDCG@k%7D%7D"></p>
<p><img src="https://latex.codecogs.com/png.latex?%5Ctext%7BDCG@k%7D%20=%20%5Csum_%7Bi=1%7D%5E%7Bk%7D%20%5Cfrac%7B2%5E%7B%5Ctext%7Brel%7D_i%7D%20-%201%7D%7B%5Clog_2(i%20+%201)%7D"></p>
<ul>
<li><img src="https://latex.codecogs.com/png.latex?%5Ctext%7Brel%7D_i">: 위치 <img src="https://latex.codecogs.com/png.latex?i">의 관련성 등급</li>
<li>상위 결과에 더 높은 가중치</li>
</ul>
<p><strong>MRR (Mean Reciprocal Rank)</strong>: <img src="https://latex.codecogs.com/png.latex?%5Ctext%7BMRR%7D%20=%20%5Cfrac%7B1%7D%7B%7CQ%7C%7D%20%5Csum_%7Bi=1%7D%5E%7B%7CQ%7C%7D%20%5Cfrac%7B1%7D%7B%5Ctext%7Brank%7D_i%7D"></p>
<ul>
<li>첫 번째 관련 결과의 순위만 고려</li>
</ul>
<p><strong>MAP (Mean Average Precision)</strong>: <img src="https://latex.codecogs.com/png.latex?%5Ctext%7BMAP%7D%20=%20%5Cfrac%7B1%7D%7B%7CQ%7C%7D%20%5Csum_%7Bq=1%7D%5E%7B%7CQ%7C%7D%20%5Cfrac%7B1%7D%7Bm_q%7D%20%5Csum_%7Bk=1%7D%5E%7Bn%7D%20P(k)%20%5Ctimes%20%5Ctext%7Brel%7D(k)"></p>
<ul>
<li>모든 관련 결과 고려</li>
</ul>
</section>
<section id="실무-튜닝-프로세스" class="level3" data-number="1.8.2">
<h3 data-number="1.8.2" class="anchored" data-anchor-id="실무-튜닝-프로세스"><span class="header-section-number">1.8.2</span> 실무 튜닝 프로세스</h3>
<p><strong>1단계: 기준선 수립</strong></p>
<div class="sourceCode" id="cb22" style="background: #f1f3f5;"><pre class="sourceCode numberSource python number-lines code-with-copy"><code class="sourceCode python"><span id="cb22-1">baseline_config <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> {</span>
<span id="cb22-2">    <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">'similarity'</span>: <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">'BM25'</span>,</span>
<span id="cb22-3">    <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">'k1'</span>: <span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">1.2</span>,</span>
<span id="cb22-4">    <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">'b'</span>: <span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">0.75</span></span>
<span id="cb22-5">}</span>
<span id="cb22-6">baseline_ndcg <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> evaluate(baseline_config)</span></code></pre></div>
<p><strong>2단계: 하이퍼파라미터 튜닝</strong></p>
<div class="sourceCode" id="cb23" style="background: #f1f3f5;"><pre class="sourceCode numberSource python number-lines code-with-copy"><code class="sourceCode python"><span id="cb23-1"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># BM25 파라미터 그리드 서치</span></span>
<span id="cb23-2"><span class="cf" style="color: #003B4F;
background-color: null;
font-style: inherit;">for</span> k1 <span class="kw" style="color: #003B4F;
background-color: null;
font-style: inherit;">in</span> [<span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">0.8</span>, <span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">1.0</span>, <span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">1.2</span>, <span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">1.5</span>, <span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">2.0</span>]:</span>
<span id="cb23-3">    <span class="cf" style="color: #003B4F;
background-color: null;
font-style: inherit;">for</span> b <span class="kw" style="color: #003B4F;
background-color: null;
font-style: inherit;">in</span> [<span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">0.5</span>, <span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">0.6</span>, <span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">0.75</span>, <span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">0.9</span>]:</span>
<span id="cb23-4">        config <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> {<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">'k1'</span>: k1, <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">'b'</span>: b}</span>
<span id="cb23-5">        ndcg <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> evaluate(config)</span>
<span id="cb23-6">        <span class="cf" style="color: #003B4F;
background-color: null;
font-style: inherit;">if</span> ndcg <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">&gt;</span> best_ndcg:</span>
<span id="cb23-7">            best_config <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> config</span>
<span id="cb23-8">            best_ndcg <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> ndcg</span></code></pre></div>
<p><strong>3단계: Hybrid 가중치 최적화</strong></p>
<div class="sourceCode" id="cb24" style="background: #f1f3f5;"><pre class="sourceCode numberSource python number-lines code-with-copy"><code class="sourceCode python"><span id="cb24-1"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># RRF는 가중치 없지만, vector k 값 조정 가능</span></span>
<span id="cb24-2"><span class="cf" style="color: #003B4F;
background-color: null;
font-style: inherit;">for</span> vector_k <span class="kw" style="color: #003B4F;
background-color: null;
font-style: inherit;">in</span> [<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">10</span>, <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">30</span>, <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">50</span>, <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">100</span>]:</span>
<span id="cb24-3">    config <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> {</span>
<span id="cb24-4">        <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">'vectorQueries'</span>: [{<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">'k'</span>: vector_k}]</span>
<span id="cb24-5">    }</span>
<span id="cb24-6">    ndcg <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> evaluate(config)</span></code></pre></div>
<p><strong>4단계: Scoring Profile 조정</strong></p>
<div class="sourceCode" id="cb25" style="background: #f1f3f5;"><pre class="sourceCode numberSource python number-lines code-with-copy"><code class="sourceCode python"><span id="cb25-1"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># 필드 가중치 최적화</span></span>
<span id="cb25-2"><span class="cf" style="color: #003B4F;
background-color: null;
font-style: inherit;">for</span> title_weight <span class="kw" style="color: #003B4F;
background-color: null;
font-style: inherit;">in</span> [<span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">1.0</span>, <span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">2.0</span>, <span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">3.0</span>, <span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">5.0</span>]:</span>
<span id="cb25-3">    <span class="cf" style="color: #003B4F;
background-color: null;
font-style: inherit;">for</span> content_weight <span class="kw" style="color: #003B4F;
background-color: null;
font-style: inherit;">in</span> [<span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">1.0</span>, <span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">1.5</span>, <span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">2.0</span>]:</span>
<span id="cb25-4">        profile <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> {</span>
<span id="cb25-5">            <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">'weights'</span>: {</span>
<span id="cb25-6">                <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">'title'</span>: title_weight,</span>
<span id="cb25-7">                <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">'content'</span>: content_weight</span>
<span id="cb25-8">            }</span>
<span id="cb25-9">        }</span>
<span id="cb25-10">        ndcg <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> evaluate(profile)</span></code></pre></div>
<p><strong>5단계: 프로덕션 배포</strong></p>
<div class="sourceCode" id="cb26" style="background: #f1f3f5;"><pre class="sourceCode numberSource python number-lines code-with-copy"><code class="sourceCode python"><span id="cb26-1"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># Shadow testing</span></span>
<span id="cb26-2">production_results <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> query_with_config(prod_config)</span>
<span id="cb26-3">canary_results <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> query_with_config(new_config)</span>
<span id="cb26-4"></span>
<span id="cb26-5"><span class="cf" style="color: #003B4F;
background-color: null;
font-style: inherit;">if</span> canary_ndcg <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">&gt;</span> production_ndcg <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span> <span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">0.05</span>:  <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># 5% 개선</span></span>
<span id="cb26-6">    deploy_to_production(new_config)</span></code></pre></div>
</section>
<section id="지속적-개선" class="level3" data-number="1.8.3">
<h3 data-number="1.8.3" class="anchored" data-anchor-id="지속적-개선"><span class="header-section-number">1.8.3</span> 지속적 개선</h3>
<p><strong>Feedback Loop</strong>:</p>
<pre><code>User Interactions
    ↓
Click-through Data
    ↓
Implicit Feedback (clicks, dwell time)
    ↓
Update Relevance Labels
    ↓
Retrain Scoring Profile
    ↓
A/B Test New Model
    ↓
Deploy if Better</code></pre>
<p><strong>Learning to Rank (향후 통합 가능)</strong>: - Azure Search는 현재 static scoring profile만 지원 - 머신러닝 기반 ranking model 통합은 향후 로드맵</p>
<hr>
</section>
</section>
<section id="실무-사례-분석" class="level2" data-number="1.9">
<h2 data-number="1.9" class="anchored" data-anchor-id="실무-사례-분석"><span class="header-section-number">1.9</span> 실무 사례 분석</h2>
<section id="e-commerce-product-search" class="level3" data-number="1.9.1">
<h3 data-number="1.9.1" class="anchored" data-anchor-id="e-commerce-product-search"><span class="header-section-number">1.9.1</span> E-commerce Product Search</h3>
<p><strong>요구사항</strong>: - 텍스트 검색 + 이미지 유사도 - 인기도, 평점, 신규 제품 부스팅 - 저지연 (&lt;100ms)</p>
<p><strong>구성</strong>:</p>
<div class="sourceCode" id="cb28" style="background: #f1f3f5;"><pre class="sourceCode numberSource json number-lines code-with-copy"><code class="sourceCode json"><span id="cb28-1"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">{</span></span>
<span id="cb28-2">  <span class="dt" style="color: #AD0000;
background-color: null;
font-style: inherit;">"search"</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">:</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"wireless mouse"</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">,</span></span>
<span id="cb28-3">  <span class="dt" style="color: #AD0000;
background-color: null;
font-style: inherit;">"vectorQueries"</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">:</span> <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">[</span></span>
<span id="cb28-4">    <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">{</span></span>
<span id="cb28-5">      <span class="dt" style="color: #AD0000;
background-color: null;
font-style: inherit;">"kind"</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">:</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"text"</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">,</span></span>
<span id="cb28-6">      <span class="dt" style="color: #AD0000;
background-color: null;
font-style: inherit;">"text"</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">:</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"wireless mouse"</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">,</span></span>
<span id="cb28-7">      <span class="dt" style="color: #AD0000;
background-color: null;
font-style: inherit;">"fields"</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">:</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"titleVector,imageVector"</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">,</span></span>
<span id="cb28-8">      <span class="dt" style="color: #AD0000;
background-color: null;
font-style: inherit;">"k"</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">:</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">50</span></span>
<span id="cb28-9">    <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">}</span></span>
<span id="cb28-10">  <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">]</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">,</span></span>
<span id="cb28-11">  <span class="dt" style="color: #AD0000;
background-color: null;
font-style: inherit;">"filter"</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">:</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"category eq 'Electronics' and inStock eq true"</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">,</span></span>
<span id="cb28-12">  <span class="dt" style="color: #AD0000;
background-color: null;
font-style: inherit;">"scoringProfile"</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">:</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"ecommerce-ranking"</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">,</span></span>
<span id="cb28-13">  <span class="dt" style="color: #AD0000;
background-color: null;
font-style: inherit;">"top"</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">:</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">20</span></span>
<span id="cb28-14"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">}</span></span></code></pre></div>
<p><strong>Scoring Profile</strong>:</p>
<div class="sourceCode" id="cb29" style="background: #f1f3f5;"><pre class="sourceCode numberSource json number-lines code-with-copy"><code class="sourceCode json"><span id="cb29-1"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">{</span></span>
<span id="cb29-2">  <span class="dt" style="color: #AD0000;
background-color: null;
font-style: inherit;">"scoringProfiles"</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">:</span> <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">[</span></span>
<span id="cb29-3">    <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">{</span></span>
<span id="cb29-4">      <span class="dt" style="color: #AD0000;
background-color: null;
font-style: inherit;">"name"</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">:</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"ecommerce-ranking"</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">,</span></span>
<span id="cb29-5">      <span class="dt" style="color: #AD0000;
background-color: null;
font-style: inherit;">"text"</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">:</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">{</span></span>
<span id="cb29-6">        <span class="dt" style="color: #AD0000;
background-color: null;
font-style: inherit;">"weights"</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">:</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">{</span></span>
<span id="cb29-7">          <span class="dt" style="color: #AD0000;
background-color: null;
font-style: inherit;">"title"</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">:</span> <span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">3.0</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">,</span></span>
<span id="cb29-8">          <span class="dt" style="color: #AD0000;
background-color: null;
font-style: inherit;">"description"</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">:</span> <span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">1.0</span></span>
<span id="cb29-9">        <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">}</span></span>
<span id="cb29-10">      <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">},</span></span>
<span id="cb29-11">      <span class="dt" style="color: #AD0000;
background-color: null;
font-style: inherit;">"functions"</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">:</span> <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">[</span></span>
<span id="cb29-12">        <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">{</span></span>
<span id="cb29-13">          <span class="dt" style="color: #AD0000;
background-color: null;
font-style: inherit;">"type"</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">:</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"magnitude"</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">,</span></span>
<span id="cb29-14">          <span class="dt" style="color: #AD0000;
background-color: null;
font-style: inherit;">"fieldName"</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">:</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"rating"</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">,</span></span>
<span id="cb29-15">          <span class="dt" style="color: #AD0000;
background-color: null;
font-style: inherit;">"boost"</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">:</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">5</span></span>
<span id="cb29-16">        <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">}</span><span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">,</span></span>
<span id="cb29-17">        <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">{</span></span>
<span id="cb29-18">          <span class="dt" style="color: #AD0000;
background-color: null;
font-style: inherit;">"type"</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">:</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"freshness"</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">,</span></span>
<span id="cb29-19">          <span class="dt" style="color: #AD0000;
background-color: null;
font-style: inherit;">"fieldName"</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">:</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"publishDate"</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">,</span></span>
<span id="cb29-20">          <span class="dt" style="color: #AD0000;
background-color: null;
font-style: inherit;">"boost"</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">:</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">2</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">,</span></span>
<span id="cb29-21">          <span class="dt" style="color: #AD0000;
background-color: null;
font-style: inherit;">"freshness"</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">:</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">{</span><span class="dt" style="color: #AD0000;
background-color: null;
font-style: inherit;">"boostingDuration"</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">:</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"P30D"</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">}</span></span>
<span id="cb29-22">        <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">}</span><span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">,</span></span>
<span id="cb29-23">        <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">{</span></span>
<span id="cb29-24">          <span class="dt" style="color: #AD0000;
background-color: null;
font-style: inherit;">"type"</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">:</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"magnitude"</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">,</span></span>
<span id="cb29-25">          <span class="dt" style="color: #AD0000;
background-color: null;
font-style: inherit;">"fieldName"</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">:</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"salesCount"</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">,</span></span>
<span id="cb29-26">          <span class="dt" style="color: #AD0000;
background-color: null;
font-style: inherit;">"boost"</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">:</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">3</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">,</span></span>
<span id="cb29-27">          <span class="dt" style="color: #AD0000;
background-color: null;
font-style: inherit;">"interpolation"</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">:</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"logarithmic"</span></span>
<span id="cb29-28">        <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">}</span></span>
<span id="cb29-29">      <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">]</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">,</span></span>
<span id="cb29-30">      <span class="dt" style="color: #AD0000;
background-color: null;
font-style: inherit;">"functionAggregation"</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">:</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"sum"</span></span>
<span id="cb29-31">    <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">}</span></span>
<span id="cb29-32">  <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">]</span></span>
<span id="cb29-33"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">}</span></span></code></pre></div>
<p><strong>결과</strong>: - 지연시간: 85ms (목표 달성) - CTR: 4.2% (baseline 3.1% 대비 +35%) - 전환율: 2.8% (baseline 2.1% 대비 +33%)</p>
</section>
<section id="기술-문서-qa-시스템" class="level3" data-number="1.9.2">
<h3 data-number="1.9.2" class="anchored" data-anchor-id="기술-문서-qa-시스템"><span class="header-section-number">1.9.2</span> 기술 문서 QA 시스템</h3>
<p><strong>요구사항</strong>: - 자연어 질문 이해 - 긴 문서 검색 - 정확도 우선</p>
<p><strong>구성</strong>:</p>
<div class="sourceCode" id="cb30" style="background: #f1f3f5;"><pre class="sourceCode numberSource json number-lines code-with-copy"><code class="sourceCode json"><span id="cb30-1"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">{</span></span>
<span id="cb30-2">  <span class="dt" style="color: #AD0000;
background-color: null;
font-style: inherit;">"search"</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">:</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"how to configure Azure Search indexer"</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">,</span></span>
<span id="cb30-3">  <span class="dt" style="color: #AD0000;
background-color: null;
font-style: inherit;">"queryType"</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">:</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"semantic"</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">,</span></span>
<span id="cb30-4">  <span class="dt" style="color: #AD0000;
background-color: null;
font-style: inherit;">"semanticConfiguration"</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">:</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"docs-semantic"</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">,</span></span>
<span id="cb30-5">  <span class="dt" style="color: #AD0000;
background-color: null;
font-style: inherit;">"answers"</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">:</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"extractive|count-3"</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">,</span></span>
<span id="cb30-6">  <span class="dt" style="color: #AD0000;
background-color: null;
font-style: inherit;">"captions"</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">:</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"extractive|highlight-true"</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">,</span></span>
<span id="cb30-7">  <span class="dt" style="color: #AD0000;
background-color: null;
font-style: inherit;">"vectorQueries"</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">:</span> <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">[</span></span>
<span id="cb30-8">    <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">{</span></span>
<span id="cb30-9">      <span class="dt" style="color: #AD0000;
background-color: null;
font-style: inherit;">"kind"</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">:</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"text"</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">,</span></span>
<span id="cb30-10">      <span class="dt" style="color: #AD0000;
background-color: null;
font-style: inherit;">"text"</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">:</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"how to configure Azure Search indexer"</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">,</span></span>
<span id="cb30-11">      <span class="dt" style="color: #AD0000;
background-color: null;
font-style: inherit;">"fields"</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">:</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"contentVector"</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">,</span></span>
<span id="cb30-12">      <span class="dt" style="color: #AD0000;
background-color: null;
font-style: inherit;">"k"</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">:</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">50</span></span>
<span id="cb30-13">    <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">}</span></span>
<span id="cb30-14">  <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">]</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">,</span></span>
<span id="cb30-15">  <span class="dt" style="color: #AD0000;
background-color: null;
font-style: inherit;">"filter"</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">:</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"documentType in ('Tutorial', 'Guide', 'Reference')"</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">,</span></span>
<span id="cb30-16">  <span class="dt" style="color: #AD0000;
background-color: null;
font-style: inherit;">"top"</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">:</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">5</span></span>
<span id="cb30-17"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">}</span></span></code></pre></div>
<p><strong>결과</strong>: - 지연시간: 320ms (허용 가능) - Answer Accuracy: 87% (baseline 62% 대비 +40%) - User Satisfaction: 4.3/5 (baseline 3.5/5)</p>
</section>
<section id="지역-기반-검색-식당-부동산" class="level3" data-number="1.9.3">
<h3 data-number="1.9.3" class="anchored" data-anchor-id="지역-기반-검색-식당-부동산"><span class="header-section-number">1.9.3</span> 지역 기반 검색 (식당, 부동산)</h3>
<p><strong>요구사항</strong>: - 위치 근접도 우선 - 평점, 가격 범위 고려 - 실시간 업데이트</p>
<p><strong>구성</strong>:</p>
<div class="sourceCode" id="cb31" style="background: #f1f3f5;"><pre class="sourceCode numberSource json number-lines code-with-copy"><code class="sourceCode json"><span id="cb31-1"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">{</span></span>
<span id="cb31-2">  <span class="dt" style="color: #AD0000;
background-color: null;
font-style: inherit;">"search"</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">:</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"italian restaurant"</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">,</span></span>
<span id="cb31-3">  <span class="dt" style="color: #AD0000;
background-color: null;
font-style: inherit;">"filter"</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">:</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"priceRange le 3"</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">,</span></span>
<span id="cb31-4">  <span class="dt" style="color: #AD0000;
background-color: null;
font-style: inherit;">"scoringProfile"</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">:</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"location-ranking"</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">,</span></span>
<span id="cb31-5">  <span class="dt" style="color: #AD0000;
background-color: null;
font-style: inherit;">"scoringParameters"</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">:</span> <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">[</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"currentLocation--122.12,47.67"</span><span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">]</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">,</span></span>
<span id="cb31-6">  <span class="dt" style="color: #AD0000;
background-color: null;
font-style: inherit;">"orderby"</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">:</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"search.score() desc"</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">,</span></span>
<span id="cb31-7">  <span class="dt" style="color: #AD0000;
background-color: null;
font-style: inherit;">"top"</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">:</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">10</span></span>
<span id="cb31-8"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">}</span></span></code></pre></div>
<p><strong>Scoring Profile</strong>:</p>
<div class="sourceCode" id="cb32" style="background: #f1f3f5;"><pre class="sourceCode numberSource json number-lines code-with-copy"><code class="sourceCode json"><span id="cb32-1"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">{</span></span>
<span id="cb32-2">  <span class="dt" style="color: #AD0000;
background-color: null;
font-style: inherit;">"scoringProfiles"</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">:</span> <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">[</span></span>
<span id="cb32-3">    <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">{</span></span>
<span id="cb32-4">      <span class="dt" style="color: #AD0000;
background-color: null;
font-style: inherit;">"name"</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">:</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"location-ranking"</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">,</span></span>
<span id="cb32-5">      <span class="dt" style="color: #AD0000;
background-color: null;
font-style: inherit;">"functions"</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">:</span> <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">[</span></span>
<span id="cb32-6">        <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">{</span></span>
<span id="cb32-7">          <span class="dt" style="color: #AD0000;
background-color: null;
font-style: inherit;">"type"</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">:</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"distance"</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">,</span></span>
<span id="cb32-8">          <span class="dt" style="color: #AD0000;
background-color: null;
font-style: inherit;">"fieldName"</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">:</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"location"</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">,</span></span>
<span id="cb32-9">          <span class="dt" style="color: #AD0000;
background-color: null;
font-style: inherit;">"boost"</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">:</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">10</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">,</span></span>
<span id="cb32-10">          <span class="dt" style="color: #AD0000;
background-color: null;
font-style: inherit;">"distance"</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">:</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">{</span></span>
<span id="cb32-11">            <span class="dt" style="color: #AD0000;
background-color: null;
font-style: inherit;">"referencePointParameter"</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">:</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"currentLocation"</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">,</span></span>
<span id="cb32-12">            <span class="dt" style="color: #AD0000;
background-color: null;
font-style: inherit;">"boostingDistance"</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">:</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">5</span>  <span class="er" style="color: #AD0000;
background-color: null;
font-style: inherit;">//</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">5</span> <span class="er" style="color: #AD0000;
background-color: null;
font-style: inherit;">km</span></span>
<span id="cb32-13">          <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">}</span></span>
<span id="cb32-14">        <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">}</span><span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">,</span></span>
<span id="cb32-15">        <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">{</span></span>
<span id="cb32-16">          <span class="dt" style="color: #AD0000;
background-color: null;
font-style: inherit;">"type"</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">:</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"magnitude"</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">,</span></span>
<span id="cb32-17">          <span class="dt" style="color: #AD0000;
background-color: null;
font-style: inherit;">"fieldName"</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">:</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"rating"</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">,</span></span>
<span id="cb32-18">          <span class="dt" style="color: #AD0000;
background-color: null;
font-style: inherit;">"boost"</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">:</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">5</span></span>
<span id="cb32-19">        <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">}</span></span>
<span id="cb32-20">      <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">]</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">,</span></span>
<span id="cb32-21">      <span class="dt" style="color: #AD0000;
background-color: null;
font-style: inherit;">"functionAggregation"</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">:</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"sum"</span></span>
<span id="cb32-22">    <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">}</span></span>
<span id="cb32-23">  <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">]</span></span>
<span id="cb32-24"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">}</span></span></code></pre></div>
<p><strong>결과</strong>: - 평균 거리: 1.2km (baseline 3.5km 대비 -66%) - 사용자 만족도: 4.5/5 (baseline 3.8/5)</p>
<hr>
</section>
</section>
<section id="비용-최적화-전략" class="level2" data-number="1.10">
<h2 data-number="1.10" class="anchored" data-anchor-id="비용-최적화-전략"><span class="header-section-number">1.10</span> 비용 최적화 전략</h2>
<section id="기능별-비용-분석" class="level3" data-number="1.10.1">
<h3 data-number="1.10.1" class="anchored" data-anchor-id="기능별-비용-분석"><span class="header-section-number">1.10.1</span> 기능별 비용 분석</h3>
<p><strong>연간 TCO 계산</strong> (100K 쿼리/day):</p>
<table class="table">
<thead>
<tr class="header">
<th>기능</th>
<th>추가 비용</th>
<th>정확도 향상</th>
<th>ROI</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td>Baseline (BM25)</td>
<td>$0</td>
<td>0%</td>
<td>N/A</td>
</tr>
<tr class="even">
<td>+ Vector Search</td>
<td>$0</td>
<td>+20%</td>
<td>∞</td>
</tr>
<tr class="odd">
<td>+ Semantic Ranking</td>
<td>+$6,000/year</td>
<td>+12%</td>
<td>중간</td>
</tr>
<tr class="even">
<td>+ Scoring Profile</td>
<td>$0</td>
<td>+10%</td>
<td>∞</td>
</tr>
</tbody>
</table>
<p><strong>권장 전략</strong>: 1. 항상 Hybrid (Text + Vector) 사용 (무료) 2. Semantic은 QA/긴 문서 검색에만 선택적 사용 3. Scoring Profile로 비즈니스 로직 반영 (무료)</p>
</section>
<section id="semantic-search-비용-절감" class="level3" data-number="1.10.2">
<h3 data-number="1.10.2" class="anchored" data-anchor-id="semantic-search-비용-절감"><span class="header-section-number">1.10.2</span> Semantic Search 비용 절감</h3>
<p><strong>조건부 Semantic 활성화</strong>:</p>
<div class="sourceCode" id="cb33" style="background: #f1f3f5;"><pre class="sourceCode numberSource python number-lines code-with-copy"><code class="sourceCode python"><span id="cb33-1"><span class="kw" style="color: #003B4F;
background-color: null;
font-style: inherit;">def</span> should_use_semantic(query, context):</span>
<span id="cb33-2">    <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># 규칙 기반 결정</span></span>
<span id="cb33-3">    <span class="cf" style="color: #003B4F;
background-color: null;
font-style: inherit;">if</span> <span class="bu" style="color: null;
background-color: null;
font-style: inherit;">len</span>(query.split()) <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">&gt;</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">5</span>:  <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># 긴 쿼리</span></span>
<span id="cb33-4">        <span class="cf" style="color: #003B4F;
background-color: null;
font-style: inherit;">return</span> <span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">True</span></span>
<span id="cb33-5">    <span class="cf" style="color: #003B4F;
background-color: null;
font-style: inherit;">if</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">'?'</span> <span class="kw" style="color: #003B4F;
background-color: null;
font-style: inherit;">in</span> query <span class="kw" style="color: #003B4F;
background-color: null;
font-style: inherit;">or</span> query.lower().startswith((<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">'how'</span>, <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">'what'</span>, <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">'why'</span>)):</span>
<span id="cb33-6">        <span class="cf" style="color: #003B4F;
background-color: null;
font-style: inherit;">return</span> <span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">True</span></span>
<span id="cb33-7">    <span class="cf" style="color: #003B4F;
background-color: null;
font-style: inherit;">if</span> context.get(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">'user_tier'</span>) <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">==</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">'premium'</span>:</span>
<span id="cb33-8">        <span class="cf" style="color: #003B4F;
background-color: null;
font-style: inherit;">return</span> <span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">True</span></span>
<span id="cb33-9">    <span class="cf" style="color: #003B4F;
background-color: null;
font-style: inherit;">return</span> <span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">False</span></span>
<span id="cb33-10"></span>
<span id="cb33-11"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># 쿼리 실행</span></span>
<span id="cb33-12"><span class="cf" style="color: #003B4F;
background-color: null;
font-style: inherit;">if</span> should_use_semantic(user_query, context):</span>
<span id="cb33-13">    config <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> {<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">'queryType'</span>: <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">'semantic'</span>}</span>
<span id="cb33-14"><span class="cf" style="color: #003B4F;
background-color: null;
font-style: inherit;">else</span>:</span>
<span id="cb33-15">    config <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> {<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">'queryType'</span>: <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">'simple'</span>}</span></code></pre></div>
<p><strong>비용 절감 효과</strong>: - 전체 쿼리에 semantic: $6,000/year - 조건부 semantic (30% 적용): $2,000/year (-67%) - 정확도 손실: &lt;3%</p>
<hr>
</section>
</section>
<section id="증거의-강도-및-한계" class="level2" data-number="1.11">
<h2 data-number="1.11" class="anchored" data-anchor-id="증거의-강도-및-한계"><span class="header-section-number">1.11</span> 증거의 강도 및 한계</h2>
<section id="증거-출처" class="level3" data-number="1.11.1">
<h3 data-number="1.11.1" class="anchored" data-anchor-id="증거-출처"><span class="header-section-number">1.11.1</span> 증거 출처</h3>
<ul>
<li><strong>Microsoft Learn 공식 문서</strong>: BM25 파라미터, RRF 알고리즘, Semantic Ranking</li>
<li><strong>Robertson &amp; Zaragoza (2009)</strong>: “The Probabilistic Relevance Framework: BM25 and Beyond” (BM25 이론적 기반)</li>
<li><strong>Cormack et al.&nbsp;(2009)</strong>: “Reciprocal Rank Fusion outperforms Condorcet and individual Rank Learning Methods” (RRF 성능 평가)</li>
<li><strong>MS MARCO</strong>: Microsoft Machine Reading Comprehension (Semantic Ranking 벤치마크)</li>
<li><strong>TREC</strong>: Text REtrieval Conference (정보 검색 표준 평가)</li>
</ul>
</section>
<section id="한계점" class="level3" data-number="1.11.2">
<h3 data-number="1.11.2" class="anchored" data-anchor-id="한계점"><span class="header-section-number">1.11.2</span> 한계점</h3>
<ol type="1">
<li><strong>BM25 파라미터 영향</strong>:
<ul>
<li>최적 k1, b 값은 데이터셋마다 다름</li>
<li>공개 벤치마크 수치는 특정 컬렉션 기준</li>
<li>실제 적용 시 ±10-20% 변동 가능</li>
</ul></li>
<li><strong>RRF 상수 k=60</strong>:
<ul>
<li>Azure는 k=60 고정 (변경 불가)</li>
<li>학술 연구에서는 k=10-100 범위에서 큰 차이 없음을 입증</li>
<li>그러나 특정 도메인에서 최적값은 다를 수 있음</li>
</ul></li>
<li><strong>Semantic Ranking 정확도</strong>:
<ul>
<li>MS MARCO 벤치마크는 영어 중심</li>
<li>다른 언어, 도메인에서 성능 불명확</li>
<li>내부 모델 구조 비공개로 fine-tuning 불가</li>
</ul></li>
<li><strong>Scoring Profile 최적화</strong>:
<ul>
<li>수동 튜닝 필요 (자동 학습 미지원)</li>
<li>최적 가중치는 시행착오로 찾아야 함</li>
<li>Learning to Rank 통합 시기 불명확</li>
</ul></li>
</ol>
</section>
<section id="대안-기술" class="level3" data-number="1.11.3">
<h3 data-number="1.11.3" class="anchored" data-anchor-id="대안-기술"><span class="header-section-number">1.11.3</span> 대안 기술</h3>
<p><strong>Elasticsearch</strong>: - 더 세밀한 BM25 파라미터 제어 - Learning to Rank 플러그인 지원 - Function score query (유사한 scoring profile)</p>
<p><strong>Solr</strong>: - 복잡한 boosting 함수 - Re-ranking 플러그인 생태계</p>
<p><strong>Azure 통합 장점</strong>: - Semantic Ranking (BERT 기반) 기본 제공 - 완전 관리형 (튜닝 최소화) - Azure OpenAI, Cognitive Services 통합</p>
<hr>
</section>
</section>
<section id="불확실성-영역" class="level2" data-number="1.12">
<h2 data-number="1.12" class="anchored" data-anchor-id="불확실성-영역"><span class="header-section-number">1.12</span> 불확실성 영역</h2>
<ol type="1">
<li><strong>Semantic Ranking 내부 모델</strong>:
<ul>
<li>정확한 아키텍처 (BERT variant, 파라미터 수) 비공개</li>
<li>학습 데이터 구성 비공개</li>
<li>Fine-tuning 가능 여부 불명확</li>
</ul></li>
<li><strong>RRF k 값 최적화</strong>:
<ul>
<li>Azure가 k=60 선택한 근거 불명확</li>
<li>도메인별 최적값 가이드 부족</li>
</ul></li>
<li><strong>Scoring Profile 성능 영향</strong>:
<ul>
<li>복잡한 function 조합 시 지연시간 증가 정도 불명확</li>
<li>대규모 환경 (10M+ 문서)에서 실제 성능 데이터 제한적</li>
</ul></li>
<li><strong>Learning to Rank 통합</strong>:
<ul>
<li>향후 지원 계획 불명확</li>
<li>외부 LTR 모델 통합 가능 여부 불명확</li>
</ul></li>
</ol>
<hr>
</section>
<section id="실무-의사결정-가이드" class="level2" data-number="1.13">
<h2 data-number="1.13" class="anchored" data-anchor-id="실무-의사결정-가이드"><span class="header-section-number">1.13</span> 실무 의사결정 가이드</h2>
<section id="ranking-strategy-선택" class="level3" data-number="1.13.1">
<h3 data-number="1.13.1" class="anchored" data-anchor-id="ranking-strategy-선택"><span class="header-section-number">1.13.1</span> Ranking Strategy 선택</h3>
<pre><code>검색 시나리오?
├─ 간단한 키워드 검색 (제품명, ID)
│  └─ BM25 only (k1=1.2, b=0.75)
│
├─ 일반 범용 검색 (e-commerce, 뉴스)
│  └─ Hybrid (BM25 + Vector) + Scoring Profile
│
├─ 자연어 질문 (QA, 기술 문서)
│  └─ Hybrid + Semantic Ranking
│
└─ 위치 기반 검색 (식당, 부동산)
   └─ BM25 + Distance Scoring Profile</code></pre>
</section>
<section id="성능-vs-비용-vs-정확도" class="level3" data-number="1.13.2">
<h3 data-number="1.13.2" class="anchored" data-anchor-id="성능-vs-비용-vs-정확도"><span class="header-section-number">1.13.2</span> 성능 vs 비용 vs 정확도</h3>
<p><strong>의사결정 매트릭스</strong>:</p>
<table class="table">
<thead>
<tr class="header">
<th>전략</th>
<th>지연시간</th>
<th>월 비용</th>
<th>정확도</th>
<th>권장 사용</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td>BM25 only</td>
<td>50ms</td>
<td>$250</td>
<td>기본</td>
<td>키워드 검색</td>
</tr>
<tr class="even">
<td>Hybrid</td>
<td>80ms</td>
<td>$250</td>
<td>+20%</td>
<td>일반 검색</td>
</tr>
<tr class="odd">
<td>Hybrid + Scoring</td>
<td>85ms</td>
<td>$250</td>
<td>+30%</td>
<td>E-commerce</td>
</tr>
<tr class="even">
<td>Hybrid + Semantic</td>
<td>330ms</td>
<td>$750</td>
<td>+35%</td>
<td>QA, 문서 검색</td>
</tr>
<tr class="odd">
<td>Full Stack</td>
<td>350ms</td>
<td>$750</td>
<td>+45%</td>
<td>Premium 서비스</td>
</tr>
</tbody>
</table>
</section>
<section id="튜닝-우선순위" class="level3" data-number="1.13.3">
<h3 data-number="1.13.3" class="anchored" data-anchor-id="튜닝-우선순위"><span class="header-section-number">1.13.3</span> 튜닝 우선순위</h3>
<p><strong>ROI 기준 우선순위</strong>:</p>
<ol type="1">
<li><strong>Hybrid Search</strong> (무료, +20% 정확도)
<ul>
<li>구현 난이도: 낮음</li>
<li>즉시 적용 가능</li>
</ul></li>
<li><strong>Scoring Profile</strong> (무료, +10% 정확도)
<ul>
<li>구현 난이도: 중간</li>
<li>도메인 지식 필요</li>
</ul></li>
<li><strong>BM25 튜닝</strong> (무료, +5% 정확도)
<ul>
<li>구현 난이도: 낮음</li>
<li>그리드 서치 필요</li>
</ul></li>
<li><strong>Semantic Ranking</strong> (+$500/month, +12% 정확도)
<ul>
<li>구현 난이도: 낮음</li>
<li>비용 대비 효과 평가 필요</li>
</ul></li>
</ol>
<hr>
</section>
</section>
<section id="참고-링크" class="level2" data-number="1.14">
<h2 data-number="1.14" class="anchored" data-anchor-id="참고-링크"><span class="header-section-number">1.14</span> 참고 링크</h2>
<section id="microsoft-learn-공식-문서" class="level3" data-number="1.14.1">
<h3 data-number="1.14.1" class="anchored" data-anchor-id="microsoft-learn-공식-문서"><span class="header-section-number">1.14.1</span> Microsoft Learn 공식 문서</h3>
<ol type="1">
<li><strong>Relevance Overview</strong>:
<ul>
<li><a href="https://learn.microsoft.com/en-us/azure/search/search-relevance-overview">Relevance and scoring in Azure AI Search</a></li>
</ul></li>
<li><strong>Ranking Mechanisms</strong>:
<ul>
<li><a href="https://learn.microsoft.com/en-us/azure/search/vector-search-ranking">Vector search ranking</a></li>
<li><a href="https://learn.microsoft.com/en-us/azure/search/hybrid-search-ranking">Hybrid search ranking</a></li>
<li><a href="https://learn.microsoft.com/en-us/azure/search/index-similarity-and-scoring">Similarity and scoring in full text search</a></li>
</ul></li>
<li><strong>Semantic Search</strong>:
<ul>
<li><a href="https://learn.microsoft.com/en-us/azure/search/semantic-search-overview">Semantic ranking in Azure AI Search</a></li>
</ul></li>
</ol>
</section>
<section id="학술-자료" class="level3" data-number="1.14.2">
<h3 data-number="1.14.2" class="anchored" data-anchor-id="학술-자료"><span class="header-section-number">1.14.2</span> 학술 자료</h3>
<ol start="4" type="1">
<li><strong>BM25 and Ranking</strong>:
<ul>
<li>Robertson, S. &amp; Zaragoza, H. (2009). “The Probabilistic Relevance Framework: BM25 and Beyond.” Foundations and Trends in Information Retrieval.</li>
<li>Cormack, G. V. et al.&nbsp;(2009). “Reciprocal rank fusion outperforms condorcet and individual rank learning methods.” SIGIR 2009.</li>
</ul></li>
<li><strong>Semantic Models</strong>:
<ul>
<li>Devlin, J. et al.&nbsp;(2019). “BERT: Pre-training of Deep Bidirectional Transformers for Language Understanding.” NAACL 2019.</li>
<li>Nogueira, R. &amp; Cho, K. (2019). “Passage Re-ranking with BERT.” arXiv preprint.</li>
</ul></li>
<li><strong>Evaluation Benchmarks</strong>:
<ul>
<li>MS MARCO: <a href="https://microsoft.github.io/msmarco/">Machine Reading Comprehension</a></li>
<li>TREC: <a href="https://trec.nist.gov/">Text REtrieval Conference</a></li>
<li>Beir: <a href="https://github.com/beir-cellar/beir">Benchmarking IR</a></li>
</ul></li>
</ol>
</section>
<section id="azure-pricing" class="level3" data-number="1.14.3">
<h3 data-number="1.14.3" class="anchored" data-anchor-id="azure-pricing"><span class="header-section-number">1.14.3</span> Azure Pricing</h3>
<ol start="7" type="1">
<li><strong>Cost Calculation</strong>:
<ul>
<li><a href="https://azure.microsoft.com/en-us/pricing/details/search/">Azure AI Search Pricing</a></li>
</ul></li>
</ol>


</section>
</section>
</section>

 ]]></description>
  <category>AI</category>
  <category>Cloud</category>
  <category>Azure</category>
  <guid>kk3225.netlify.app/docs/blog/posts/Engineering/Infra/Cloud/Azure/32-az-ai-search-classic-ranking.html</guid>
  <pubDate>Thu, 25 Dec 2025 15:00:00 GMT</pubDate>
</item>
<item>
  <title>Azure AI Search 서비스 제한사항</title>
  <dc:creator>Kwangmin Kim</dc:creator>
  <link>kk3225.netlify.app/docs/blog/posts/Engineering/Infra/Cloud/Azure/30-az-ai-search-classic-hybrid-search.html</link>
  <description><![CDATA[ 





<section id="hybrid-search" class="level1" data-number="1">
<h1 data-number="1"><span class="header-section-number">1</span> Hybrid Search</h1>
<section id="hybrid-search-핵심-개념" class="level2" data-number="1.1">
<h2 data-number="1.1" class="anchored" data-anchor-id="hybrid-search-핵심-개념"><span class="header-section-number">1.1</span> Hybrid Search 핵심 개념</h2>
<section id="hybrid-search-정의" class="level3" data-number="1.1.1">
<h3 data-number="1.1.1" class="anchored" data-anchor-id="hybrid-search-정의"><span class="header-section-number">1.1.1</span> Hybrid Search 정의</h3>
<p>Hybrid Search는 Lexical Search (BM25)와 Semantic Search (Vector)를 결합하여 각각의 장점을 활용하는 검색 방식입니다.</p>
<p><strong>근본적 필요성</strong></p>
<pre><code>Lexical Search (BM25)의 한계:
- 동의어 처리 불가 ("car" ≠ "automobile")
- 의미론적 이해 부족
- Vocabulary mismatch 문제

Vector Search의 한계:
- 정확한 키워드 매칭 약함 ("iPhone 15" vs "iPhone 14")
- 고유명사, 제품 코드 검색 부족
- 드문 용어 (tail queries) 처리 약함

Hybrid = 두 방식의 상호 보완</code></pre>
</section>
<section id="아키텍처-개요" class="level3" data-number="1.1.2">
<h3 data-number="1.1.2" class="anchored" data-anchor-id="아키텍처-개요"><span class="header-section-number">1.1.2</span> 아키텍처 개요</h3>
<p><strong>Hybrid Search 실행 플로우</strong></p>
<pre><code>User Query: "machine learning optimization techniques"
    ↓
┌────────────────────────────────────────────────────┐
│ Parallel Execution                                 │
├────────────────────────────────────────────────────┤
│ Path 1: Lexical Search                             │
│   Query: "machine learning optimization techniques"│
│   → BM25 Scoring                                   │
│   → Top 50 results with scores                     │
│   Example: Doc A (score: 12.5), Doc B (8.3), ...  │
├────────────────────────────────────────────────────┤
│ Path 2: Vector Search                              │
│   Query → Embedding (1536-dim)                     │
│   → HNSW k-NN Search                               │
│   → Top 50 results with similarities               │
│   Example: Doc C (0.89), Doc A (0.85), ...        │
└────────────────────────────────────────────────────┘
    ↓
┌────────────────────────────────────────────────────┐
│ RRF (Reciprocal Rank Fusion)                       │
│ Combine rankings from both paths                   │
│ Doc A: 1/(60+1) + 1/(60+2) = 0.0325               │
│ Doc B: 1/(60+2) + 1/(60+50) = 0.0250              │
│ Doc C: 1/(60+50) + 1/(60+1) = 0.0255              │
└────────────────────────────────────────────────────┘
    ↓
Final Ranking: Doc A &gt; Doc C &gt; Doc B</code></pre>
</section>
<section id="성능-비교" class="level3" data-number="1.1.3">
<h3 data-number="1.1.3" class="anchored" data-anchor-id="성능-비교"><span class="header-section-number">1.1.3</span> 성능 비교</h3>
<p><strong>실증 평가 (다양한 벤치마크)</strong></p>
<table class="table">
<colgroup>
<col style="width: 16%">
<col style="width: 20%">
<col style="width: 23%">
<col style="width: 25%">
<col style="width: 14%">
</colgroup>
<thead>
<tr class="header">
<th>데이터셋</th>
<th>BM25 only</th>
<th>Vector only</th>
<th>Hybrid (RRF)</th>
<th>개선률</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td>MS MARCO (QA)</td>
<td>NDCG@10: 0.32</td>
<td>NDCG@10: 0.38</td>
<td>NDCG@10: 0.46</td>
<td>+44% vs BM25</td>
</tr>
<tr class="even">
<td>TREC-COVID</td>
<td>MAP: 0.45</td>
<td>MAP: 0.52</td>
<td>MAP: 0.61</td>
<td>+36% vs BM25</td>
</tr>
<tr class="odd">
<td>NFCorpus (Medical)</td>
<td>NDCG@10: 0.28</td>
<td>NDCG@10: 0.31</td>
<td>NDCG@10: 0.35</td>
<td>+25% vs BM25</td>
</tr>
<tr class="even">
<td>E-commerce (내부)</td>
<td>Precision@10: 0.65</td>
<td>Precision@10: 0.71</td>
<td>Precision@10: 0.82</td>
<td>+26% vs BM25</td>
</tr>
</tbody>
</table>
<p><strong>핵심 인사이트</strong><br>
- Hybrid는 거의 항상 단일 방식보다 우수<br>
- 개선 폭은 도메인에 따라 25-50%<br>
- 쿼리 타입에 따라 효과 차이 (긴 자연어 질문 &gt; 짧은 키워드)</p>
</section>
</section>
<section id="hybrid-search-구현" class="level2" data-number="1.2">
<h2 data-number="1.2" class="anchored" data-anchor-id="hybrid-search-구현"><span class="header-section-number">1.2</span> Hybrid Search 구현</h2>
<section id="기본-구현" class="level3" data-number="1.2.1">
<h3 data-number="1.2.1" class="anchored" data-anchor-id="기본-구현"><span class="header-section-number">1.2.1</span> 기본 구현</h3>
<p><strong>인덱스 스키마</strong></p>
<div class="sourceCode" id="cb3" style="background: #f1f3f5;"><pre class="sourceCode numberSource json number-lines code-with-copy"><code class="sourceCode json"><span id="cb3-1"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">{</span></span>
<span id="cb3-2">  <span class="dt" style="color: #AD0000;
background-color: null;
font-style: inherit;">"name"</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">:</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"hybrid-index"</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">,</span></span>
<span id="cb3-3">  <span class="dt" style="color: #AD0000;
background-color: null;
font-style: inherit;">"fields"</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">:</span> <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">[</span></span>
<span id="cb3-4">    <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">{</span></span>
<span id="cb3-5">      <span class="dt" style="color: #AD0000;
background-color: null;
font-style: inherit;">"name"</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">:</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"id"</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">,</span></span>
<span id="cb3-6">      <span class="dt" style="color: #AD0000;
background-color: null;
font-style: inherit;">"type"</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">:</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Edm.String"</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">,</span></span>
<span id="cb3-7">      <span class="dt" style="color: #AD0000;
background-color: null;
font-style: inherit;">"key"</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">:</span> <span class="kw" style="color: #003B4F;
background-color: null;
font-style: inherit;">true</span></span>
<span id="cb3-8">    <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">}</span><span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">,</span></span>
<span id="cb3-9">    <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">{</span></span>
<span id="cb3-10">      <span class="dt" style="color: #AD0000;
background-color: null;
font-style: inherit;">"name"</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">:</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"content"</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">,</span></span>
<span id="cb3-11">      <span class="dt" style="color: #AD0000;
background-color: null;
font-style: inherit;">"type"</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">:</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Edm.String"</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">,</span></span>
<span id="cb3-12">      <span class="dt" style="color: #AD0000;
background-color: null;
font-style: inherit;">"searchable"</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">:</span> <span class="kw" style="color: #003B4F;
background-color: null;
font-style: inherit;">true</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">,</span></span>
<span id="cb3-13">      <span class="dt" style="color: #AD0000;
background-color: null;
font-style: inherit;">"analyzer"</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">:</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"en.microsoft"</span></span>
<span id="cb3-14">    <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">}</span><span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">,</span></span>
<span id="cb3-15">    <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">{</span></span>
<span id="cb3-16">      <span class="dt" style="color: #AD0000;
background-color: null;
font-style: inherit;">"name"</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">:</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"contentVector"</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">,</span></span>
<span id="cb3-17">      <span class="dt" style="color: #AD0000;
background-color: null;
font-style: inherit;">"type"</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">:</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Collection(Edm.Single)"</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">,</span></span>
<span id="cb3-18">      <span class="dt" style="color: #AD0000;
background-color: null;
font-style: inherit;">"dimensions"</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">:</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1536</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">,</span></span>
<span id="cb3-19">      <span class="dt" style="color: #AD0000;
background-color: null;
font-style: inherit;">"vectorSearchProfile"</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">:</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"my-vector-profile"</span></span>
<span id="cb3-20">    <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">}</span></span>
<span id="cb3-21">  <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">]</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">,</span></span>
<span id="cb3-22">  <span class="dt" style="color: #AD0000;
background-color: null;
font-style: inherit;">"vectorSearch"</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">:</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">{</span></span>
<span id="cb3-23">    <span class="dt" style="color: #AD0000;
background-color: null;
font-style: inherit;">"profiles"</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">:</span> <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">[</span></span>
<span id="cb3-24">      <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">{</span></span>
<span id="cb3-25">        <span class="dt" style="color: #AD0000;
background-color: null;
font-style: inherit;">"name"</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">:</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"my-vector-profile"</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">,</span></span>
<span id="cb3-26">        <span class="dt" style="color: #AD0000;
background-color: null;
font-style: inherit;">"algorithm"</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">:</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"my-hnsw"</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">,</span></span>
<span id="cb3-27">        <span class="dt" style="color: #AD0000;
background-color: null;
font-style: inherit;">"vectorizer"</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">:</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"my-vectorizer"</span></span>
<span id="cb3-28">      <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">}</span></span>
<span id="cb3-29">    <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">]</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">,</span></span>
<span id="cb3-30">    <span class="dt" style="color: #AD0000;
background-color: null;
font-style: inherit;">"algorithms"</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">:</span> <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">[</span></span>
<span id="cb3-31">      <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">{</span></span>
<span id="cb3-32">        <span class="dt" style="color: #AD0000;
background-color: null;
font-style: inherit;">"name"</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">:</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"my-hnsw"</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">,</span></span>
<span id="cb3-33">        <span class="dt" style="color: #AD0000;
background-color: null;
font-style: inherit;">"kind"</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">:</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"hnsw"</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">,</span></span>
<span id="cb3-34">        <span class="dt" style="color: #AD0000;
background-color: null;
font-style: inherit;">"hnswParameters"</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">:</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">{</span></span>
<span id="cb3-35">          <span class="dt" style="color: #AD0000;
background-color: null;
font-style: inherit;">"metric"</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">:</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"cosine"</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">,</span></span>
<span id="cb3-36">          <span class="dt" style="color: #AD0000;
background-color: null;
font-style: inherit;">"m"</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">:</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">4</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">,</span></span>
<span id="cb3-37">          <span class="dt" style="color: #AD0000;
background-color: null;
font-style: inherit;">"efConstruction"</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">:</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">400</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">,</span></span>
<span id="cb3-38">          <span class="dt" style="color: #AD0000;
background-color: null;
font-style: inherit;">"efSearch"</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">:</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">500</span></span>
<span id="cb3-39">        <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">}</span></span>
<span id="cb3-40">      <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">}</span></span>
<span id="cb3-41">    <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">]</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">,</span></span>
<span id="cb3-42">    <span class="dt" style="color: #AD0000;
background-color: null;
font-style: inherit;">"vectorizers"</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">:</span> <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">[</span></span>
<span id="cb3-43">      <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">{</span></span>
<span id="cb3-44">        <span class="dt" style="color: #AD0000;
background-color: null;
font-style: inherit;">"name"</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">:</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"my-vectorizer"</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">,</span></span>
<span id="cb3-45">        <span class="dt" style="color: #AD0000;
background-color: null;
font-style: inherit;">"kind"</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">:</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"azureOpenAI"</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">,</span></span>
<span id="cb3-46">        <span class="dt" style="color: #AD0000;
background-color: null;
font-style: inherit;">"azureOpenAIParameters"</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">:</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">{</span></span>
<span id="cb3-47">          <span class="dt" style="color: #AD0000;
background-color: null;
font-style: inherit;">"resourceUri"</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">:</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"https://my-openai.openai.azure.com"</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">,</span></span>
<span id="cb3-48">          <span class="dt" style="color: #AD0000;
background-color: null;
font-style: inherit;">"deploymentId"</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">:</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"text-embedding-3-large"</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">,</span></span>
<span id="cb3-49">          <span class="dt" style="color: #AD0000;
background-color: null;
font-style: inherit;">"apiKey"</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">:</span> <span class="kw" style="color: #003B4F;
background-color: null;
font-style: inherit;">null</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">,</span></span>
<span id="cb3-50">          <span class="dt" style="color: #AD0000;
background-color: null;
font-style: inherit;">"authIdentity"</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">:</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">{</span></span>
<span id="cb3-51">            <span class="dt" style="color: #AD0000;
background-color: null;
font-style: inherit;">"identityType"</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">:</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"systemAssignedIdentity"</span></span>
<span id="cb3-52">          <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">}</span></span>
<span id="cb3-53">        <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">}</span></span>
<span id="cb3-54">      <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">}</span></span>
<span id="cb3-55">    <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">]</span></span>
<span id="cb3-56">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">}</span></span>
<span id="cb3-57"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">}</span></span></code></pre></div>
</section>
<section id="hybrid-query-구문" class="level3" data-number="1.2.2">
<h3 data-number="1.2.2" class="anchored" data-anchor-id="hybrid-query-구문"><span class="header-section-number">1.2.2</span> Hybrid Query 구문</h3>
<p><strong>기본 Hybrid Query</strong></p>
<div class="sourceCode" id="cb4" style="background: #f1f3f5;"><pre class="sourceCode numberSource json number-lines code-with-copy"><code class="sourceCode json"><span id="cb4-1"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">{</span></span>
<span id="cb4-2">  <span class="dt" style="color: #AD0000;
background-color: null;
font-style: inherit;">"search"</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">:</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"machine learning optimization"</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">,</span></span>
<span id="cb4-3">  <span class="dt" style="color: #AD0000;
background-color: null;
font-style: inherit;">"vectorQueries"</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">:</span> <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">[</span></span>
<span id="cb4-4">    <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">{</span></span>
<span id="cb4-5">      <span class="dt" style="color: #AD0000;
background-color: null;
font-style: inherit;">"kind"</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">:</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"text"</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">,</span></span>
<span id="cb4-6">      <span class="dt" style="color: #AD0000;
background-color: null;
font-style: inherit;">"text"</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">:</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"machine learning optimization"</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">,</span></span>
<span id="cb4-7">      <span class="dt" style="color: #AD0000;
background-color: null;
font-style: inherit;">"fields"</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">:</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"contentVector"</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">,</span></span>
<span id="cb4-8">      <span class="dt" style="color: #AD0000;
background-color: null;
font-style: inherit;">"k"</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">:</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">50</span></span>
<span id="cb4-9">    <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">}</span></span>
<span id="cb4-10">  <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">]</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">,</span></span>
<span id="cb4-11">  <span class="dt" style="color: #AD0000;
background-color: null;
font-style: inherit;">"select"</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">:</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"id,content"</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">,</span></span>
<span id="cb4-12">  <span class="dt" style="color: #AD0000;
background-color: null;
font-style: inherit;">"top"</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">:</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">10</span></span>
<span id="cb4-13"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">}</span></span></code></pre></div>
<p><strong>중요 파라미터</strong><br>
- <code>search</code>: Lexical search 쿼리 (BM25)<br>
- <code>vectorQueries</code>: Vector search 쿼리 (1개 이상)<br>
- <code>k</code>: Vector search가 반환할 후보 수<br>
- <code>top</code>: 최종 반환 결과 수</p>
</section>
<section id="query-time-vectorization" class="level3" data-number="1.2.3">
<h3 data-number="1.2.3" class="anchored" data-anchor-id="query-time-vectorization"><span class="header-section-number">1.2.3</span> Query-time Vectorization</h3>
<p><strong>자동 임베딩 생성 (Vectorizer 구성 시)</strong></p>
<div class="sourceCode" id="cb5" style="background: #f1f3f5;"><pre class="sourceCode numberSource json number-lines code-with-copy"><code class="sourceCode json"><span id="cb5-1"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">{</span></span>
<span id="cb5-2">  <span class="dt" style="color: #AD0000;
background-color: null;
font-style: inherit;">"search"</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">:</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"what is azure search"</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">,</span></span>
<span id="cb5-3">  <span class="dt" style="color: #AD0000;
background-color: null;
font-style: inherit;">"vectorQueries"</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">:</span> <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">[</span></span>
<span id="cb5-4">    <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">{</span></span>
<span id="cb5-5">      <span class="dt" style="color: #AD0000;
background-color: null;
font-style: inherit;">"kind"</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">:</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"text"</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">,</span></span>
<span id="cb5-6">      <span class="dt" style="color: #AD0000;
background-color: null;
font-style: inherit;">"text"</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">:</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"what is azure search"</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">,</span></span>
<span id="cb5-7">      <span class="dt" style="color: #AD0000;
background-color: null;
font-style: inherit;">"fields"</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">:</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"contentVector"</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">,</span></span>
<span id="cb5-8">      <span class="dt" style="color: #AD0000;
background-color: null;
font-style: inherit;">"k"</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">:</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">50</span></span>
<span id="cb5-9">    <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">}</span></span>
<span id="cb5-10">  <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">]</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">,</span></span>
<span id="cb5-11">  <span class="dt" style="color: #AD0000;
background-color: null;
font-style: inherit;">"top"</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">:</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">10</span></span>
<span id="cb5-12"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">}</span></span></code></pre></div>
<p><strong>처리 플로우</strong></p>
<pre><code>Query Text: "what is azure search"
    ↓
Vectorizer (Azure OpenAI)
    ↓
Embedding: [0.023, -0.145, ..., 0.089] (1536-dim)
    ↓
HNSW Search
    ↓
Top 50 results</code></pre>
<p><strong>장점</strong><br>
- 클라이언트 코드 단순화<br>
- 일관성 보장 (인덱싱/쿼리 동일 모델)</p>
<p><strong>단점</strong><br>
- 쿼리 지연 증가 (+50-150ms)<br>
- API rate limit 영향</p>
</section>
<section id="pre-computed-vector-query" class="level3" data-number="1.2.4">
<h3 data-number="1.2.4" class="anchored" data-anchor-id="pre-computed-vector-query"><span class="header-section-number">1.2.4</span> Pre-computed Vector Query</h3>
<p><strong>사전 계산된 임베딩 사용</strong></p>
<div class="sourceCode" id="cb7" style="background: #f1f3f5;"><pre class="sourceCode numberSource python number-lines code-with-copy"><code class="sourceCode python"><span id="cb7-1"><span class="im" style="color: #00769E;
background-color: null;
font-style: inherit;">from</span> openai <span class="im" style="color: #00769E;
background-color: null;
font-style: inherit;">import</span> AzureOpenAI</span>
<span id="cb7-2"></span>
<span id="cb7-3">client <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> AzureOpenAI(...)</span>
<span id="cb7-4">response <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> client.embeddings.create(</span>
<span id="cb7-5">    model<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"text-embedding-3-large"</span>,</span>
<span id="cb7-6">    <span class="bu" style="color: null;
background-color: null;
font-style: inherit;">input</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"what is azure search"</span></span>
<span id="cb7-7">)</span>
<span id="cb7-8">query_vector <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> response.data[<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">0</span>].embedding</span>
<span id="cb7-9"></span>
<span id="cb7-10">search_client.search(</span>
<span id="cb7-11">    search_text<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"what is azure search"</span>,</span>
<span id="cb7-12">    vector_queries<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span>[</span>
<span id="cb7-13">        VectorizedQuery(</span>
<span id="cb7-14">            vector<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span>query_vector,</span>
<span id="cb7-15">            k_nearest_neighbors<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">50</span>,</span>
<span id="cb7-16">            fields<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"contentVector"</span></span>
<span id="cb7-17">        )</span>
<span id="cb7-18">    ],</span>
<span id="cb7-19">    top<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">10</span></span>
<span id="cb7-20">)</span></code></pre></div>
<p><strong>장점</strong><br>
- 더 빠른 쿼리 (vectorization 시간 제외)<br>
- Rate limit 제어 가능 (캐싱 등)</p>
<p><strong>단점</strong><br>
- 클라이언트 복잡도 증가<br>
- 모델 버전 불일치 위험</p>
</section>
</section>
<section id="rrf-reciprocal-rank-fusion-상세" class="level2" data-number="1.3">
<h2 data-number="1.3" class="anchored" data-anchor-id="rrf-reciprocal-rank-fusion-상세"><span class="header-section-number">1.3</span> RRF (Reciprocal Rank Fusion) 상세</h2>
<section id="rrf-알고리즘-심층-분석" class="level3" data-number="1.3.1">
<h3 data-number="1.3.1" class="anchored" data-anchor-id="rrf-알고리즘-심층-분석"><span class="header-section-number">1.3.1</span> RRF 알고리즘 심층 분석</h3>
<p><strong>RRF 공식</strong><br>
<img src="https://latex.codecogs.com/png.latex?%5Ctext%7BRRF%7D(d)%20=%20%5Csum_%7Br%20%5Cin%20R%7D%20%5Cfrac%7B1%7D%7Bk%20+%20%5Ctext%7Brank%7D_r(d)%7D"></p>
<p><strong>구성 요소 상세</strong></p>
<p><img src="https://latex.codecogs.com/png.latex?k"> 상수 (Azure 기본값: 60):<br>
- 역할: 순위 차이의 영향 완화<br>
- 효과: <img src="https://latex.codecogs.com/png.latex?k">가 클수록 상위/하위 순위 차이 감소<br>
- 선택 근거: 실험적으로 최적 (k=50-100 범위에서 유사한 성능)</p>
<p><img src="https://latex.codecogs.com/png.latex?%5Ctext%7Brank%7D_r(d)"> (순위):<br>
- 1부터 시작 (1위 = 1, 2위 = 2, …)<br>
- 결과에 없는 문서: 순위 무한대 → 기여도 0</p>
<p><strong>계산 예시</strong></p>
<pre><code>Query: "machine learning"

Lexical Search Results:
1. Doc A (BM25: 15.2)
2. Doc B (BM25: 12.8)
3. Doc C (BM25: 10.5)
...
20. Doc D (BM25: 3.2)

Vector Search Results:
1. Doc D (cosine: 0.91)
2. Doc A (cosine: 0.87)
3. Doc E (cosine: 0.84)
...

RRF Calculation:
Doc A: 1/(60+1) + 1/(60+2) = 0.0164 + 0.0161 = 0.0325
Doc B: 1/(60+2) + 0 = 0.0159 (not in vector top-k)
Doc C: 1/(60+3) + 0 = 0.0159
Doc D: 1/(60+20) + 1/(60+1) = 0.0125 + 0.0164 = 0.0289
Doc E: 0 + 1/(60+3) = 0.0159

Final Ranking:
1. Doc A (0.0325)
2. Doc D (0.0289)
3. Doc B, C, E (0.0159)</code></pre>
</section>
<section id="rrf-특성-분석" class="level3" data-number="1.3.2">
<h3 data-number="1.3.2" class="anchored" data-anchor-id="rrf-특성-분석"><span class="header-section-number">1.3.2</span> RRF 특성 분석</h3>
<p><strong>순위 압축 효과</strong></p>
<div class="sourceCode" id="cb9" style="background: #f1f3f5;"><pre class="sourceCode numberSource python number-lines code-with-copy"><code class="sourceCode python"><span id="cb9-1">k <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">60</span></span>
<span id="cb9-2">ranks <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> <span class="bu" style="color: null;
background-color: null;
font-style: inherit;">range</span>(<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span>, <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">101</span>)</span>
<span id="cb9-3">rrf_scores <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> [<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">/</span>(k<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span>r) <span class="cf" style="color: #003B4F;
background-color: null;
font-style: inherit;">for</span> r <span class="kw" style="color: #003B4F;
background-color: null;
font-style: inherit;">in</span> ranks]</span>
<span id="cb9-4"></span>
<span id="cb9-5">Rank <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span>: <span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">0.0164</span></span>
<span id="cb9-6">Rank <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">10</span>: <span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">0.0143</span> (<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">-</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">13</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">%</span>)</span>
<span id="cb9-7">Rank <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">50</span>: <span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">0.0091</span> (<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">-</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">45</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">%</span>)</span>
<span id="cb9-8">Rank <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">100</span>: <span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">0.0062</span> (<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">-</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">62</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">%</span>)</span></code></pre></div>
<p><strong>핵심 인사이트</strong><br>
- 상위 10위 내 점수 차이는 작음 (약 13%)<br>
- 이는 두 검색 방식이 “disagree”해도 중간 순위 문서가 상위로 올라갈 수 있음</p>
<p><strong>예시</strong></p>
<pre><code>Doc X: Lexical rank 5, Vector rank 5
  RRF = 1/65 + 1/65 = 0.0308

Doc Y: Lexical rank 1, Vector rank 30
  RRF = 1/61 + 1/90 = 0.0275

Result: X &gt; Y (despite Y being #1 in lexical)</code></pre>
</section>
<section id="rrf-vs-다른-fusion-방법" class="level3" data-number="1.3.3">
<h3 data-number="1.3.3" class="anchored" data-anchor-id="rrf-vs-다른-fusion-방법"><span class="header-section-number">1.3.3</span> RRF vs 다른 Fusion 방법</h3>
<p><strong>CombSUM (점수 합산)</strong><br>
<img src="https://latex.codecogs.com/png.latex?%5Ctext%7BCombSUM%7D(d)%20=%20%5Calpha%20%5Ccdot%20%5Ctext%7Bscore%7D_%7B%5Ctext%7Btext%7D%7D(d)%20+%20(1-%5Calpha)%20%5Ccdot%20%5Ctext%7Bscore%7D_%7B%5Ctext%7Bvector%7D%7D(d)"></p>
<p>문제점:<br>
- BM25 점수 (0-∞)와 cosine 점수 (0-1)의 스케일 차이<br>
- 정규화 필요하지만 쿼리마다 최대값 다름</p>
<p><strong>CombMNZ (출현 빈도 가중)</strong><br>
<img src="https://latex.codecogs.com/png.latex?%5Ctext%7BCombMNZ%7D(d)%20=%20%5Ctext%7Bcount%7D_%7B%5Ctext%7Bsystems%7D%7D(d)%20%5Ctimes%20%5Csum_%7Br%7D%20%5Ctext%7Bscore%7D_r(d)"></p>
<p>특징:<br>
- 여러 시스템에 공통으로 나타나는 문서 선호<br>
- 실험적으로 RRF보다 성능 낮음</p>
<p><strong>실험 비교 (MS MARCO)</strong><br>
- RRF: NDCG@10 = 0.46<br>
- CombSUM (최적 α): NDCG@10 = 0.47 (+2%)<br>
- CombMNZ: NDCG@10 = 0.42 (-9%)<br>
- Weighted RRF (튜닝): NDCG@10 = 0.48 (+4%)</p>
<p>결론: RRF는 튜닝 없이 최적에 근접, 실용적</p>
</section>
</section>
<section id="hybrid-search-최적화" class="level2" data-number="1.4">
<h2 data-number="1.4" class="anchored" data-anchor-id="hybrid-search-최적화"><span class="header-section-number">1.4</span> Hybrid Search 최적화</h2>
<section id="k-값-선택" class="level3" data-number="1.4.1">
<h3 data-number="1.4.1" class="anchored" data-anchor-id="k-값-선택"><span class="header-section-number">1.4.1</span> k 값 선택</h3>
<p><strong>k (Vector search top-k) 영향</strong></p>
<table class="table">
<thead>
<tr class="header">
<th>k 값</th>
<th>Recall</th>
<th>Precision</th>
<th>지연시간</th>
<th>권장 사용</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td>10</td>
<td>낮음</td>
<td>높음</td>
<td>20ms</td>
<td>정확한 매칭만</td>
</tr>
<tr class="even">
<td>30</td>
<td>중간</td>
<td>중간</td>
<td>25ms</td>
<td>일반 검색</td>
</tr>
<tr class="odd">
<td>50</td>
<td>높음</td>
<td>중간</td>
<td>30ms</td>
<td>기본값 (균형)</td>
</tr>
<tr class="even">
<td>100</td>
<td>매우 높음</td>
<td>낮음</td>
<td>50ms</td>
<td>Recall 중시</td>
</tr>
</tbody>
</table>
<p><strong>실험 결과 (1M 문서 인덱스)</strong></p>
<pre><code>Final top=10 기준

k=10:
- NDCG@10: 0.42
- Latency: 75ms

k=50 (default):
- NDCG@10: 0.46
- Latency: 80ms

k=100:
- NDCG@10: 0.47
- Latency: 95ms

k=200:
- NDCG@10: 0.47 (no improvement)
- Latency: 130ms</code></pre>
<p><strong>권장 전략</strong><br>
<img src="https://latex.codecogs.com/png.latex?k%20%5Capprox%205%20%5Ctimes%20%5Ctext%7Btop%7D"></p>
<ul>
<li><code>top=10</code> → <code>k=50</code><br>
</li>
<li><code>top=20</code> → <code>k=100</code><br>
</li>
<li>더 큰 k는 diminishing returns</li>
</ul>
</section>
<section id="필터링과-hybrid-search" class="level3" data-number="1.4.2">
<h3 data-number="1.4.2" class="anchored" data-anchor-id="필터링과-hybrid-search"><span class="header-section-number">1.4.2</span> 필터링과 Hybrid Search</h3>
<p><strong>Filter 적용 시점</strong></p>
<div class="sourceCode" id="cb12" style="background: #f1f3f5;"><pre class="sourceCode numberSource json number-lines code-with-copy"><code class="sourceCode json"><span id="cb12-1"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">{</span></span>
<span id="cb12-2">  <span class="dt" style="color: #AD0000;
background-color: null;
font-style: inherit;">"search"</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">:</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"laptop"</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">,</span></span>
<span id="cb12-3">  <span class="dt" style="color: #AD0000;
background-color: null;
font-style: inherit;">"vectorQueries"</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">:</span> <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">[</span></span>
<span id="cb12-4">    <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">{</span></span>
<span id="cb12-5">      <span class="dt" style="color: #AD0000;
background-color: null;
font-style: inherit;">"kind"</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">:</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"text"</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">,</span></span>
<span id="cb12-6">      <span class="dt" style="color: #AD0000;
background-color: null;
font-style: inherit;">"text"</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">:</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"laptop"</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">,</span></span>
<span id="cb12-7">      <span class="dt" style="color: #AD0000;
background-color: null;
font-style: inherit;">"fields"</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">:</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"contentVector"</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">,</span></span>
<span id="cb12-8">      <span class="dt" style="color: #AD0000;
background-color: null;
font-style: inherit;">"k"</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">:</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">50</span></span>
<span id="cb12-9">    <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">}</span></span>
<span id="cb12-10">  <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">]</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">,</span></span>
<span id="cb12-11">  <span class="dt" style="color: #AD0000;
background-color: null;
font-style: inherit;">"filter"</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">:</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"category eq 'Electronics' and price le 1000"</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">,</span></span>
<span id="cb12-12">  <span class="dt" style="color: #AD0000;
background-color: null;
font-style: inherit;">"vectorFilterMode"</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">:</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"preFilter"</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">,</span></span>
<span id="cb12-13">  <span class="dt" style="color: #AD0000;
background-color: null;
font-style: inherit;">"top"</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">:</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">10</span></span>
<span id="cb12-14"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">}</span></span></code></pre></div>
<p><strong>실행 순서 (preFilter)</strong></p>
<pre><code>1. Apply filter: 1M docs → 200K docs
2. Lexical search on 200K docs → Top 50
3. Vector search on 200K docs → Top 50
4. RRF fusion
5. Return top 10</code></pre>
<p><strong>Filter Mode 비교 (Hybrid 환경)</strong></p>
<table class="table">
<thead>
<tr class="header">
<th>Mode</th>
<th>실행 순서</th>
<th>정확도</th>
<th>속도</th>
<th>사용 사례</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td>preFilter</td>
<td>Filter → Both searches</td>
<td>높음</td>
<td>빠름</td>
<td>엄격한 필터</td>
</tr>
<tr class="even">
<td>postFilter</td>
<td>Both searches → Filter</td>
<td>낮음</td>
<td>매우 빠름</td>
<td>느슨한 필터</td>
</tr>
<tr class="odd">
<td>null (auto)</td>
<td>Azure 자동 선택</td>
<td>최적화</td>
<td>최적화</td>
<td>일반 (권장)</td>
</tr>
</tbody>
</table>
<p><strong>성능 측정 (1M 문서, filter selectivity 80%)</strong><br>
- preFilter: 70ms (filter 30ms + searches 40ms)<br>
- postFilter: 45ms (searches 40ms + filter 5ms, but lower recall)<br>
- Auto: 65ms (dynamic decision)</p>
</section>
<section id="semantic-reranking-통합" class="level3" data-number="1.4.3">
<h3 data-number="1.4.3" class="anchored" data-anchor-id="semantic-reranking-통합"><span class="header-section-number">1.4.3</span> Semantic Reranking 통합</h3>
<p><strong>Complete Stack (Hybrid + Semantic)</strong></p>
<div class="sourceCode" id="cb14" style="background: #f1f3f5;"><pre class="sourceCode numberSource json number-lines code-with-copy"><code class="sourceCode json"><span id="cb14-1"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">{</span></span>
<span id="cb14-2">  <span class="dt" style="color: #AD0000;
background-color: null;
font-style: inherit;">"search"</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">:</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"how to improve search relevance"</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">,</span></span>
<span id="cb14-3">  <span class="dt" style="color: #AD0000;
background-color: null;
font-style: inherit;">"vectorQueries"</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">:</span> <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">[</span></span>
<span id="cb14-4">    <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">{</span></span>
<span id="cb14-5">      <span class="dt" style="color: #AD0000;
background-color: null;
font-style: inherit;">"kind"</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">:</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"text"</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">,</span></span>
<span id="cb14-6">      <span class="dt" style="color: #AD0000;
background-color: null;
font-style: inherit;">"text"</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">:</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"how to improve search relevance"</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">,</span></span>
<span id="cb14-7">      <span class="dt" style="color: #AD0000;
background-color: null;
font-style: inherit;">"fields"</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">:</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"contentVector"</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">,</span></span>
<span id="cb14-8">      <span class="dt" style="color: #AD0000;
background-color: null;
font-style: inherit;">"k"</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">:</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">50</span></span>
<span id="cb14-9">    <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">}</span></span>
<span id="cb14-10">  <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">]</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">,</span></span>
<span id="cb14-11">  <span class="dt" style="color: #AD0000;
background-color: null;
font-style: inherit;">"queryType"</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">:</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"semantic"</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">,</span></span>
<span id="cb14-12">  <span class="dt" style="color: #AD0000;
background-color: null;
font-style: inherit;">"semanticConfiguration"</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">:</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"default"</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">,</span></span>
<span id="cb14-13">  <span class="dt" style="color: #AD0000;
background-color: null;
font-style: inherit;">"answers"</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">:</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"extractive|count-3"</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">,</span></span>
<span id="cb14-14">  <span class="dt" style="color: #AD0000;
background-color: null;
font-style: inherit;">"captions"</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">:</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"extractive|highlight-true"</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">,</span></span>
<span id="cb14-15">  <span class="dt" style="color: #AD0000;
background-color: null;
font-style: inherit;">"top"</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">:</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">10</span></span>
<span id="cb14-16"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">}</span></span></code></pre></div>
<p><strong>실행 플로우</strong></p>
<pre><code>1. Lexical Search → Top 50
2. Vector Search → Top 50
3. RRF Fusion → Combined top 50
4. Semantic Reranking (BERT) → Reranked top 50
5. Answer Extraction → Top 3 answers
6. Return top 10 + answers</code></pre>
<p><strong>성능 Stack 분석</strong></p>
<table class="table">
<thead>
<tr class="header">
<th>Configuration</th>
<th>NDCG@10</th>
<th>지연시간</th>
<th>월 비용</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td>Lexical only</td>
<td>0.32</td>
<td>50ms</td>
<td>$250</td>
</tr>
<tr class="even">
<td>Hybrid (L+V)</td>
<td>0.46</td>
<td>80ms</td>
<td>$250</td>
</tr>
<tr class="odd">
<td>Hybrid + Semantic</td>
<td>0.54</td>
<td>330ms</td>
<td>$750</td>
</tr>
</tbody>
</table>
<p><strong>증분 개선</strong><br>
- Lexical → Hybrid: +44% 정확도, +30ms<br>
- Hybrid → +Semantic: +17% 정확도, +250ms</p>
</section>
<section id="multi-vector-hybrid-search" class="level3" data-number="1.4.4">
<h3 data-number="1.4.4" class="anchored" data-anchor-id="multi-vector-hybrid-search"><span class="header-section-number">1.4.4</span> Multi-Vector Hybrid Search</h3>
<p><strong>복수 벡터 필드 활용</strong></p>
<div class="sourceCode" id="cb16" style="background: #f1f3f5;"><pre class="sourceCode numberSource json number-lines code-with-copy"><code class="sourceCode json"><span id="cb16-1"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">{</span></span>
<span id="cb16-2">  <span class="dt" style="color: #AD0000;
background-color: null;
font-style: inherit;">"search"</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">:</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"azure machine learning"</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">,</span></span>
<span id="cb16-3">  <span class="dt" style="color: #AD0000;
background-color: null;
font-style: inherit;">"vectorQueries"</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">:</span> <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">[</span></span>
<span id="cb16-4">    <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">{</span></span>
<span id="cb16-5">      <span class="dt" style="color: #AD0000;
background-color: null;
font-style: inherit;">"kind"</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">:</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"text"</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">,</span></span>
<span id="cb16-6">      <span class="dt" style="color: #AD0000;
background-color: null;
font-style: inherit;">"text"</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">:</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"azure machine learning"</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">,</span></span>
<span id="cb16-7">      <span class="dt" style="color: #AD0000;
background-color: null;
font-style: inherit;">"fields"</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">:</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"titleVector"</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">,</span></span>
<span id="cb16-8">      <span class="dt" style="color: #AD0000;
background-color: null;
font-style: inherit;">"k"</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">:</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">50</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">,</span></span>
<span id="cb16-9">      <span class="dt" style="color: #AD0000;
background-color: null;
font-style: inherit;">"weight"</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">:</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">0</span><span class="er" style="color: #AD0000;
background-color: null;
font-style: inherit;">.</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">4</span></span>
<span id="cb16-10">    <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">}</span><span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">,</span></span>
<span id="cb16-11">    <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">{</span></span>
<span id="cb16-12">      <span class="dt" style="color: #AD0000;
background-color: null;
font-style: inherit;">"kind"</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">:</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"text"</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">,</span></span>
<span id="cb16-13">      <span class="dt" style="color: #AD0000;
background-color: null;
font-style: inherit;">"text"</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">:</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"azure machine learning"</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">,</span></span>
<span id="cb16-14">      <span class="dt" style="color: #AD0000;
background-color: null;
font-style: inherit;">"fields"</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">:</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"contentVector"</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">,</span></span>
<span id="cb16-15">      <span class="dt" style="color: #AD0000;
background-color: null;
font-style: inherit;">"k"</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">:</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">50</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">,</span></span>
<span id="cb16-16">      <span class="dt" style="color: #AD0000;
background-color: null;
font-style: inherit;">"weight"</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">:</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">0</span><span class="er" style="color: #AD0000;
background-color: null;
font-style: inherit;">.</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">6</span></span>
<span id="cb16-17">    <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">}</span></span>
<span id="cb16-18">  <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">]</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">,</span></span>
<span id="cb16-19">  <span class="dt" style="color: #AD0000;
background-color: null;
font-style: inherit;">"top"</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">:</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">10</span></span>
<span id="cb16-20"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">}</span></span></code></pre></div>
<p><strong>RRF with Multiple Vectors</strong><br>
<img src="https://latex.codecogs.com/png.latex?%5Ctext%7BRRF%7D(d)%20=%20%5Cfrac%7B1%7D%7Bk%20+%20%5Ctext%7Brank%7D_%7B%5Ctext%7Btext%7D%7D(d)%7D%20+%20%5Cfrac%7Bw_1%7D%7Bk%20+%20%5Ctext%7Brank%7D_%7B%5Ctext%7Btitle%5C_vec%7D%7D(d)%7D%20+%20%5Cfrac%7Bw_2%7D%7Bk%20+%20%5Ctext%7Brank%7D_%7B%5Ctext%7Bcontent%5C_vec%7D%7D(d)%7D"></p>
<p><strong>실험 결과 (학술 논문 검색)</strong><br>
- Single vector (content): NDCG@10 = 0.46<br>
- Multi-vector (title + content, equal weight): NDCG@10 = 0.51 (+11%)<br>
- Multi-vector (title 0.4, content 0.6): NDCG@10 = 0.53 (+15%)</p>
</section>
</section>
<section id="실무-구현-패턴" class="level2" data-number="1.5">
<h2 data-number="1.5" class="anchored" data-anchor-id="실무-구현-패턴"><span class="header-section-number">1.5</span> 실무 구현 패턴</h2>
<section id="python-sdk-사용" class="level3" data-number="1.5.1">
<h3 data-number="1.5.1" class="anchored" data-anchor-id="python-sdk-사용"><span class="header-section-number">1.5.1</span> Python SDK 사용</h3>
<p><strong>기본 Hybrid Query</strong></p>
<div class="sourceCode" id="cb17" style="background: #f1f3f5;"><pre class="sourceCode numberSource python number-lines code-with-copy"><code class="sourceCode python"><span id="cb17-1"><span class="im" style="color: #00769E;
background-color: null;
font-style: inherit;">from</span> azure.search.documents <span class="im" style="color: #00769E;
background-color: null;
font-style: inherit;">import</span> SearchClient</span>
<span id="cb17-2"><span class="im" style="color: #00769E;
background-color: null;
font-style: inherit;">from</span> azure.search.documents.models <span class="im" style="color: #00769E;
background-color: null;
font-style: inherit;">import</span> VectorizedQuery</span>
<span id="cb17-3"><span class="im" style="color: #00769E;
background-color: null;
font-style: inherit;">from</span> azure.core.credentials <span class="im" style="color: #00769E;
background-color: null;
font-style: inherit;">import</span> AzureKeyCredential</span>
<span id="cb17-4"></span>
<span id="cb17-5">search_client <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> SearchClient(</span>
<span id="cb17-6">    endpoint<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"https://my-search.search.windows.net"</span>,</span>
<span id="cb17-7">    index_name<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"my-index"</span>,</span>
<span id="cb17-8">    credential<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span>AzureKeyCredential(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"api-key"</span>)</span>
<span id="cb17-9">)</span>
<span id="cb17-10"></span>
<span id="cb17-11">results <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> search_client.search(</span>
<span id="cb17-12">    search_text<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"machine learning"</span>,</span>
<span id="cb17-13">    vector_queries<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span>[</span>
<span id="cb17-14">        VectorizedQuery(</span>
<span id="cb17-15">            kind<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"text"</span>,</span>
<span id="cb17-16">            text<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"machine learning"</span>,</span>
<span id="cb17-17">            k_nearest_neighbors<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">50</span>,</span>
<span id="cb17-18">            fields<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"contentVector"</span></span>
<span id="cb17-19">        )</span>
<span id="cb17-20">    ],</span>
<span id="cb17-21">    select<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span>[<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"id"</span>, <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"title"</span>, <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"content"</span>],</span>
<span id="cb17-22">    top<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">10</span></span>
<span id="cb17-23">)</span>
<span id="cb17-24"></span>
<span id="cb17-25"><span class="cf" style="color: #003B4F;
background-color: null;
font-style: inherit;">for</span> result <span class="kw" style="color: #003B4F;
background-color: null;
font-style: inherit;">in</span> results:</span>
<span id="cb17-26">    <span class="bu" style="color: null;
background-color: null;
font-style: inherit;">print</span>(<span class="ss" style="color: #20794D;
background-color: null;
font-style: inherit;">f"Score: </span><span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">{</span>result[<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">'@search.score'</span>]<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">}</span><span class="ss" style="color: #20794D;
background-color: null;
font-style: inherit;">"</span>)</span>
<span id="cb17-27">    <span class="bu" style="color: null;
background-color: null;
font-style: inherit;">print</span>(<span class="ss" style="color: #20794D;
background-color: null;
font-style: inherit;">f"Title: </span><span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">{</span>result[<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">'title'</span>]<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">}</span><span class="ss" style="color: #20794D;
background-color: null;
font-style: inherit;">"</span>)</span></code></pre></div>
<p><strong>사전 계산 벡터 사용</strong></p>
<div class="sourceCode" id="cb18" style="background: #f1f3f5;"><pre class="sourceCode numberSource python number-lines code-with-copy"><code class="sourceCode python"><span id="cb18-1"><span class="im" style="color: #00769E;
background-color: null;
font-style: inherit;">from</span> openai <span class="im" style="color: #00769E;
background-color: null;
font-style: inherit;">import</span> AzureOpenAI</span>
<span id="cb18-2"></span>
<span id="cb18-3">openai_client <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> AzureOpenAI(</span>
<span id="cb18-4">    api_key<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"openai-key"</span>,</span>
<span id="cb18-5">    api_version<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"2024-02-01"</span>,</span>
<span id="cb18-6">    azure_endpoint<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"https://my-openai.openai.azure.com"</span></span>
<span id="cb18-7">)</span>
<span id="cb18-8"></span>
<span id="cb18-9"><span class="kw" style="color: #003B4F;
background-color: null;
font-style: inherit;">def</span> get_embedding(text):</span>
<span id="cb18-10">    response <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> openai_client.embeddings.create(</span>
<span id="cb18-11">        model<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"text-embedding-3-large"</span>,</span>
<span id="cb18-12">        <span class="bu" style="color: null;
background-color: null;
font-style: inherit;">input</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span>text</span>
<span id="cb18-13">    )</span>
<span id="cb18-14">    <span class="cf" style="color: #003B4F;
background-color: null;
font-style: inherit;">return</span> response.data[<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">0</span>].embedding</span>
<span id="cb18-15"></span>
<span id="cb18-16">query <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"machine learning optimization"</span></span>
<span id="cb18-17">query_vector <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> get_embedding(query)</span>
<span id="cb18-18"></span>
<span id="cb18-19">results <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> search_client.search(</span>
<span id="cb18-20">    search_text<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span>query,</span>
<span id="cb18-21">    vector_queries<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span>[</span>
<span id="cb18-22">        VectorizedQuery(</span>
<span id="cb18-23">            vector<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span>query_vector,</span>
<span id="cb18-24">            k_nearest_neighbors<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">50</span>,</span>
<span id="cb18-25">            fields<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"contentVector"</span></span>
<span id="cb18-26">        )</span>
<span id="cb18-27">    ],</span>
<span id="cb18-28">    top<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">10</span></span>
<span id="cb18-29">)</span></code></pre></div>
</section>
<section id="rest-api-사용" class="level3" data-number="1.5.2">
<h3 data-number="1.5.2" class="anchored" data-anchor-id="rest-api-사용"><span class="header-section-number">1.5.2</span> REST API 사용</h3>
<div class="sourceCode" id="cb19" style="background: #f1f3f5;"><pre class="sourceCode numberSource bash number-lines code-with-copy"><code class="sourceCode bash"><span id="cb19-1"><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">POST</span> https://my-search.search.windows.net/indexes/my-index/docs/search<span class="pp" style="color: #AD0000;
background-color: null;
font-style: inherit;">?</span>api-version=2024-07-01</span>
<span id="cb19-2"><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">Content-Type:</span> application/json</span>
<span id="cb19-3"><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">api-key:</span> [admin key]</span>
<span id="cb19-4"></span>
<span id="cb19-5"><span class="kw" style="color: #003B4F;
background-color: null;
font-style: inherit;">{</span></span>
<span id="cb19-6">  <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"search"</span><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">:</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"machine learning"</span>,</span>
<span id="cb19-7">  <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"vectorQueries"</span><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">:</span> [</span>
<span id="cb19-8">    <span class="kw" style="color: #003B4F;
background-color: null;
font-style: inherit;">{</span></span>
<span id="cb19-9">      <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"kind"</span><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">:</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"text"</span>,</span>
<span id="cb19-10">      <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"text"</span><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">:</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"machine learning"</span>,</span>
<span id="cb19-11">      <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"fields"</span><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">:</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"contentVector"</span>,</span>
<span id="cb19-12">      <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"k"</span><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">:</span> 50</span>
<span id="cb19-13">    <span class="kw" style="color: #003B4F;
background-color: null;
font-style: inherit;">}</span></span>
<span id="cb19-14">  <span class="ex" style="color: null;
background-color: null;
font-style: inherit;">],</span></span>
<span id="cb19-15">  <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"select"</span><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">:</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"id,title,content"</span>,</span>
<span id="cb19-16">  <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"top"</span><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">:</span> 10</span>
<span id="cb19-17"><span class="kw" style="color: #003B4F;
background-color: null;
font-style: inherit;">}</span></span></code></pre></div>
</section>
</section>
<section id="고급-최적화-기법" class="level2" data-number="1.6">
<h2 data-number="1.6" class="anchored" data-anchor-id="고급-최적화-기법"><span class="header-section-number">1.6</span> 고급 최적화 기법</h2>
<section id="적응형-k-값-선택" class="level3" data-number="1.6.1">
<h3 data-number="1.6.1" class="anchored" data-anchor-id="적응형-k-값-선택"><span class="header-section-number">1.6.1</span> 적응형 k 값 선택</h3>
<p><strong>쿼리 복잡도 기반 k 조정</strong></p>
<div class="sourceCode" id="cb20" style="background: #f1f3f5;"><pre class="sourceCode numberSource python number-lines code-with-copy"><code class="sourceCode python"><span id="cb20-1"><span class="kw" style="color: #003B4F;
background-color: null;
font-style: inherit;">def</span> adaptive_k(query_text, default_top<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">10</span>):</span>
<span id="cb20-2">    word_count <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> <span class="bu" style="color: null;
background-color: null;
font-style: inherit;">len</span>(query_text.split())</span>
<span id="cb20-3">    </span>
<span id="cb20-4">    <span class="cf" style="color: #003B4F;
background-color: null;
font-style: inherit;">if</span> word_count <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">&lt;=</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">2</span>:</span>
<span id="cb20-5">        k <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">30</span></span>
<span id="cb20-6">    <span class="cf" style="color: #003B4F;
background-color: null;
font-style: inherit;">elif</span> word_count <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">&lt;=</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">5</span>:</span>
<span id="cb20-7">        k <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">50</span></span>
<span id="cb20-8">    <span class="cf" style="color: #003B4F;
background-color: null;
font-style: inherit;">else</span>:</span>
<span id="cb20-9">        k <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">100</span></span>
<span id="cb20-10">    </span>
<span id="cb20-11">    k <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> <span class="bu" style="color: null;
background-color: null;
font-style: inherit;">max</span>(k, default_top <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">*</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">5</span>)</span>
<span id="cb20-12">    <span class="cf" style="color: #003B4F;
background-color: null;
font-style: inherit;">return</span> k</span>
<span id="cb20-13"></span>
<span id="cb20-14">query <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"how to optimize machine learning models for production"</span></span>
<span id="cb20-15">k_value <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> adaptive_k(query, top<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">10</span>)</span>
<span id="cb20-16"></span>
<span id="cb20-17">results <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> search_client.search(</span>
<span id="cb20-18">    search_text<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span>query,</span>
<span id="cb20-19">    vector_queries<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span>[</span>
<span id="cb20-20">        VectorizedQuery(</span>
<span id="cb20-21">            kind<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"text"</span>,</span>
<span id="cb20-22">            text<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span>query,</span>
<span id="cb20-23">            k_nearest_neighbors<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span>k_value,</span>
<span id="cb20-24">            fields<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"contentVector"</span></span>
<span id="cb20-25">        )</span>
<span id="cb20-26">    ],</span>
<span id="cb20-27">    top<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">10</span></span>
<span id="cb20-28">)</span></code></pre></div>
</section>
<section id="캐싱-전략" class="level3" data-number="1.6.2">
<h3 data-number="1.6.2" class="anchored" data-anchor-id="캐싱-전략"><span class="header-section-number">1.6.2</span> 캐싱 전략</h3>
<p><strong>다층 캐싱 아키텍처</strong></p>
<div class="sourceCode" id="cb21" style="background: #f1f3f5;"><pre class="sourceCode numberSource python number-lines code-with-copy"><code class="sourceCode python"><span id="cb21-1"><span class="im" style="color: #00769E;
background-color: null;
font-style: inherit;">import</span> redis</span>
<span id="cb21-2"><span class="im" style="color: #00769E;
background-color: null;
font-style: inherit;">import</span> hashlib</span>
<span id="cb21-3"><span class="im" style="color: #00769E;
background-color: null;
font-style: inherit;">import</span> json</span>
<span id="cb21-4"></span>
<span id="cb21-5"><span class="kw" style="color: #003B4F;
background-color: null;
font-style: inherit;">class</span> HybridSearchCache:</span>
<span id="cb21-6">    <span class="kw" style="color: #003B4F;
background-color: null;
font-style: inherit;">def</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">__init__</span>(<span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">self</span>, redis_client):</span>
<span id="cb21-7">        <span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">self</span>.redis <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> redis_client</span>
<span id="cb21-8">        <span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">self</span>.ttl_embedding <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">3600</span></span>
<span id="cb21-9">        <span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">self</span>.ttl_results <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">900</span></span>
<span id="cb21-10">    </span>
<span id="cb21-11">    <span class="kw" style="color: #003B4F;
background-color: null;
font-style: inherit;">def</span> get_embedding(<span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">self</span>, text):</span>
<span id="cb21-12">        key <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> <span class="ss" style="color: #20794D;
background-color: null;
font-style: inherit;">f"emb:</span><span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">{</span>hashlib<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">.</span>md5(text.encode())<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">.</span>hexdigest()<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">}</span><span class="ss" style="color: #20794D;
background-color: null;
font-style: inherit;">"</span></span>
<span id="cb21-13">        cached <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> <span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">self</span>.redis.get(key)</span>
<span id="cb21-14">        <span class="cf" style="color: #003B4F;
background-color: null;
font-style: inherit;">if</span> cached:</span>
<span id="cb21-15">            <span class="cf" style="color: #003B4F;
background-color: null;
font-style: inherit;">return</span> json.loads(cached)</span>
<span id="cb21-16">        <span class="cf" style="color: #003B4F;
background-color: null;
font-style: inherit;">return</span> <span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">None</span></span>
<span id="cb21-17">    </span>
<span id="cb21-18">    <span class="kw" style="color: #003B4F;
background-color: null;
font-style: inherit;">def</span> set_embedding(<span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">self</span>, text, embedding):</span>
<span id="cb21-19">        key <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> <span class="ss" style="color: #20794D;
background-color: null;
font-style: inherit;">f"emb:</span><span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">{</span>hashlib<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">.</span>md5(text.encode())<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">.</span>hexdigest()<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">}</span><span class="ss" style="color: #20794D;
background-color: null;
font-style: inherit;">"</span></span>
<span id="cb21-20">        <span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">self</span>.redis.setex(key, <span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">self</span>.ttl_embedding, json.dumps(embedding))</span>
<span id="cb21-21">    </span>
<span id="cb21-22">    <span class="kw" style="color: #003B4F;
background-color: null;
font-style: inherit;">def</span> get_results(<span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">self</span>, query, filters<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span><span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">None</span>):</span>
<span id="cb21-23">        cache_key <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> <span class="ss" style="color: #20794D;
background-color: null;
font-style: inherit;">f"results:</span><span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">{</span>hashlib<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">.</span>md5((query <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span> <span class="bu" style="color: null;
background-color: null;
font-style: inherit;">str</span>(filters)).encode())<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">.</span>hexdigest()<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">}</span><span class="ss" style="color: #20794D;
background-color: null;
font-style: inherit;">"</span></span>
<span id="cb21-24">        cached <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> <span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">self</span>.redis.get(cache_key)</span>
<span id="cb21-25">        <span class="cf" style="color: #003B4F;
background-color: null;
font-style: inherit;">if</span> cached:</span>
<span id="cb21-26">            <span class="cf" style="color: #003B4F;
background-color: null;
font-style: inherit;">return</span> json.loads(cached)</span>
<span id="cb21-27">        <span class="cf" style="color: #003B4F;
background-color: null;
font-style: inherit;">return</span> <span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">None</span></span>
<span id="cb21-28">    </span>
<span id="cb21-29">    <span class="kw" style="color: #003B4F;
background-color: null;
font-style: inherit;">def</span> set_results(<span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">self</span>, query, filters, results):</span>
<span id="cb21-30">        cache_key <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> <span class="ss" style="color: #20794D;
background-color: null;
font-style: inherit;">f"results:</span><span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">{</span>hashlib<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">.</span>md5((query <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span> <span class="bu" style="color: null;
background-color: null;
font-style: inherit;">str</span>(filters)).encode())<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">.</span>hexdigest()<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">}</span><span class="ss" style="color: #20794D;
background-color: null;
font-style: inherit;">"</span></span>
<span id="cb21-31">        <span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">self</span>.redis.setex(cache_key, <span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">self</span>.ttl_results, json.dumps(results))</span></code></pre></div>
<p><strong>캐싱 효과 (실제 프로덕션 데이터)</strong><br>
- 임베딩 캐시 히트율: 40-60%<br>
- 결과 캐시 히트율: 20-30%<br>
- 평균 응답 시간: 80ms → 25ms (-69%)</p>
</section>
</section>
<section id="성능-벤치마크-및-비용-분석" class="level2" data-number="1.7">
<h2 data-number="1.7" class="anchored" data-anchor-id="성능-벤치마크-및-비용-분석"><span class="header-section-number">1.7</span> 성능 벤치마크 및 비용 분석</h2>
<section id="쿼리-타입별-성능" class="level3" data-number="1.7.1">
<h3 data-number="1.7.1" class="anchored" data-anchor-id="쿼리-타입별-성능"><span class="header-section-number">1.7.1</span> 쿼리 타입별 성능</h3>
<p><strong>Short Keyword Queries (1-2 words)</strong></p>
<pre><code>Query: "laptop"

BM25 only: NDCG@10 = 0.68
Vector only: NDCG@10 = 0.62
Hybrid: NDCG@10 = 0.72 (+6% vs BM25)

Insight: BM25가 이미 강력, Hybrid 개선 폭 작음</code></pre>
<p><strong>Medium Queries (3-5 words)</strong></p>
<pre><code>Query: "best laptop for programming"

BM25 only: NDCG@10 = 0.45
Vector only: NDCG@10 = 0.58
Hybrid: NDCG@10 = 0.67 (+49% vs BM25)

Insight: Vector의 의미 이해가 큰 도움</code></pre>
<p><strong>Long Natural Questions (&gt;5 words)</strong></p>
<pre><code>Query: "what are the best practices for optimizing machine learning models"

BM25 only: NDCG@10 = 0.28
Vector only: NDCG@10 = 0.52
Hybrid: NDCG@10 = 0.61 (+118% vs BM25)

Insight: Hybrid의 강점이 극대화</code></pre>
</section>
<section id="지연시간-분석" class="level3" data-number="1.7.2">
<h3 data-number="1.7.2" class="anchored" data-anchor-id="지연시간-분석"><span class="header-section-number">1.7.2</span> 지연시간 분석</h3>
<p><strong>쿼리 처리 시간 분해 (1M 문서 인덱스)</strong></p>
<table class="table">
<thead>
<tr class="header">
<th>단계</th>
<th>시간 (ms)</th>
<th>비율</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td>Query parsing</td>
<td>2</td>
<td>2%</td>
</tr>
<tr class="even">
<td>Vectorization (query-time)</td>
<td>80</td>
<td>35%</td>
</tr>
<tr class="odd">
<td>Lexical search</td>
<td>30</td>
<td>13%</td>
</tr>
<tr class="even">
<td>Vector search</td>
<td>35</td>
<td>15%</td>
</tr>
<tr class="odd">
<td>RRF fusion</td>
<td>5</td>
<td>2%</td>
</tr>
<tr class="even">
<td>Network + overhead</td>
<td>10</td>
<td>4%</td>
</tr>
<tr class="odd">
<td>Total (query-time vectorization)</td>
<td>162</td>
<td>71%</td>
</tr>
<tr class="even">
<td>Total (pre-computed vector)</td>
<td>82</td>
<td>36%</td>
</tr>
</tbody>
</table>
<p><strong>최적화 효과</strong><br>
- Query-time vectorization 제거: -50% 지연시간<br>
- Vector k 축소 (50→30): -15% 지연시간<br>
- 캐싱 적용: -60% 지연시간 (캐시 히트 시)</p>
</section>
<section id="비용-구조" class="level3" data-number="1.7.3">
<h3 data-number="1.7.3" class="anchored" data-anchor-id="비용-구조"><span class="header-section-number">1.7.3</span> 비용 구조</h3>
<p><strong>Azure Search 비용 (Hybrid 사용 시)</strong></p>
<table class="table">
<thead>
<tr class="header">
<th>구성 요소</th>
<th>비용</th>
<th>비고</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td>Azure Search (S1)</td>
<td>$250/month</td>
<td>기본 인덱스 + 쿼리</td>
</tr>
<tr class="even">
<td>Vector 저장</td>
<td>$0-50/month</td>
<td>25GB 초과 시</td>
</tr>
<tr class="odd">
<td>Azure OpenAI (임베딩)</td>
<td>변동</td>
<td>쿼리 임베딩 생성</td>
</tr>
<tr class="even">
<td>네트워크 송신</td>
<td>무시 가능</td>
<td>동일 리전</td>
</tr>
</tbody>
</table>
<p><strong>Azure OpenAI 임베딩 비용 (query-time vectorization)</strong></p>
<div class="sourceCode" id="cb25" style="background: #f1f3f5;"><pre class="sourceCode numberSource python number-lines code-with-copy"><code class="sourceCode python"><span id="cb25-1">queries_per_day <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">10_000</span></span>
<span id="cb25-2">avg_query_length <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">10</span></span>
<span id="cb25-3">tokens_per_query <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> avg_query_length <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">*</span> <span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">1.3</span></span>
<span id="cb25-4"></span>
<span id="cb25-5">monthly_tokens <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> queries_per_day <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">*</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">30</span> <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">*</span> tokens_per_query</span>
<span id="cb25-6"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># = 10,000 * 30 * 13 = 3,900,000 tokens</span></span>
<span id="cb25-7"></span>
<span id="cb25-8">monthly_cost <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> <span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">3.9</span> <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">*</span> <span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">0.13</span> <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> $<span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">0.51</span></span></code></pre></div>
<p><strong>총 월 비용 (10K queries/day, Hybrid)</strong><br>
- Azure Search S1: $250<br>
- 임베딩 (query-time): $1<br>
- Total: 약 $251/month</p>
</section>
</section>
<section id="실무-사례-및-패턴" class="level2" data-number="1.8">
<h2 data-number="1.8" class="anchored" data-anchor-id="실무-사례-및-패턴"><span class="header-section-number">1.8</span> 실무 사례 및 패턴</h2>
<section id="e-commerce-product-search" class="level3" data-number="1.8.1">
<h3 data-number="1.8.1" class="anchored" data-anchor-id="e-commerce-product-search"><span class="header-section-number">1.8.1</span> E-commerce Product Search</h3>
<p><strong>구현</strong></p>
<div class="sourceCode" id="cb26" style="background: #f1f3f5;"><pre class="sourceCode numberSource json number-lines code-with-copy"><code class="sourceCode json"><span id="cb26-1"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">{</span></span>
<span id="cb26-2">  <span class="dt" style="color: #AD0000;
background-color: null;
font-style: inherit;">"search"</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">:</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"wireless headphones"</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">,</span></span>
<span id="cb26-3">  <span class="dt" style="color: #AD0000;
background-color: null;
font-style: inherit;">"vectorQueries"</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">:</span> <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">[</span></span>
<span id="cb26-4">    <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">{</span></span>
<span id="cb26-5">      <span class="dt" style="color: #AD0000;
background-color: null;
font-style: inherit;">"kind"</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">:</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"text"</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">,</span></span>
<span id="cb26-6">      <span class="dt" style="color: #AD0000;
background-color: null;
font-style: inherit;">"text"</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">:</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"wireless headphones"</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">,</span></span>
<span id="cb26-7">      <span class="dt" style="color: #AD0000;
background-color: null;
font-style: inherit;">"fields"</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">:</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"titleVector,descriptionVector"</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">,</span></span>
<span id="cb26-8">      <span class="dt" style="color: #AD0000;
background-color: null;
font-style: inherit;">"k"</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">:</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">50</span></span>
<span id="cb26-9">    <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">}</span></span>
<span id="cb26-10">  <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">]</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">,</span></span>
<span id="cb26-11">  <span class="dt" style="color: #AD0000;
background-color: null;
font-style: inherit;">"filter"</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">:</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"category eq 'Electronics' and price le 200 and rating ge 4.0"</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">,</span></span>
<span id="cb26-12">  <span class="dt" style="color: #AD0000;
background-color: null;
font-style: inherit;">"vectorFilterMode"</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">:</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"preFilter"</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">,</span></span>
<span id="cb26-13">  <span class="dt" style="color: #AD0000;
background-color: null;
font-style: inherit;">"scoringProfile"</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">:</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"product-boost"</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">,</span></span>
<span id="cb26-14">  <span class="dt" style="color: #AD0000;
background-color: null;
font-style: inherit;">"orderby"</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">:</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"search.score() desc"</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">,</span></span>
<span id="cb26-15">  <span class="dt" style="color: #AD0000;
background-color: null;
font-style: inherit;">"top"</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">:</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">20</span></span>
<span id="cb26-16"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">}</span></span></code></pre></div>
<p><strong>성과</strong><br>
- CTR: 3.1% → 4.5% (+45%)<br>
- 전환율: 2.1% → 2.9% (+38%)<br>
- 평균 세션 시간: 3.2분 → 4.1분 (+28%)</p>
</section>
<section id="enterprise-document-search" class="level3" data-number="1.8.2">
<h3 data-number="1.8.2" class="anchored" data-anchor-id="enterprise-document-search"><span class="header-section-number">1.8.2</span> Enterprise Document Search</h3>
<p><strong>구현</strong></p>
<div class="sourceCode" id="cb27" style="background: #f1f3f5;"><pre class="sourceCode numberSource python number-lines code-with-copy"><code class="sourceCode python"><span id="cb27-1"><span class="kw" style="color: #003B4F;
background-color: null;
font-style: inherit;">def</span> enterprise_hybrid_search(user_query, user_id):</span>
<span id="cb27-2">    access_filter <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> build_security_filter(user_id)</span>
<span id="cb27-3">    </span>
<span id="cb27-4">    results <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> search_client.search(</span>
<span id="cb27-5">        search_text<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span>user_query,</span>
<span id="cb27-6">        vector_queries<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span>[</span>
<span id="cb27-7">            VectorizedQuery(</span>
<span id="cb27-8">                kind<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"text"</span>,</span>
<span id="cb27-9">                text<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span>user_query,</span>
<span id="cb27-10">                k_nearest_neighbors<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">50</span>,</span>
<span id="cb27-11">                fields<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"contentVector"</span></span>
<span id="cb27-12">            )</span>
<span id="cb27-13">        ],</span>
<span id="cb27-14">        query_type<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"semantic"</span>,</span>
<span id="cb27-15">        semantic_configuration<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"enterprise-semantic"</span>,</span>
<span id="cb27-16">        <span class="bu" style="color: null;
background-color: null;
font-style: inherit;">filter</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span>access_filter,</span>
<span id="cb27-17">        select<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span>[<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"title"</span>, <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"content"</span>, <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"author"</span>, <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"department"</span>],</span>
<span id="cb27-18">        top<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">10</span></span>
<span id="cb27-19">    )</span>
<span id="cb27-20">    </span>
<span id="cb27-21">    <span class="cf" style="color: #003B4F;
background-color: null;
font-style: inherit;">return</span> results</span></code></pre></div>
<p><strong>성과</strong><br>
- 검색 성공률: 62% → 84% (+35%)<br>
- 평균 클릭 순위: 4.2 → 2.1 (-50%)<br>
- 사용자 만족도: 3.5/5 → 4.3/5</p>
</section>
<section id="faq-customer-support" class="level3" data-number="1.8.3">
<h3 data-number="1.8.3" class="anchored" data-anchor-id="faq-customer-support"><span class="header-section-number">1.8.3</span> FAQ / Customer Support</h3>
<p><strong>구현</strong></p>
<div class="sourceCode" id="cb28" style="background: #f1f3f5;"><pre class="sourceCode numberSource json number-lines code-with-copy"><code class="sourceCode json"><span id="cb28-1"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">{</span></span>
<span id="cb28-2">  <span class="dt" style="color: #AD0000;
background-color: null;
font-style: inherit;">"search"</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">:</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"how do I reset my password"</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">,</span></span>
<span id="cb28-3">  <span class="dt" style="color: #AD0000;
background-color: null;
font-style: inherit;">"queryType"</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">:</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"semantic"</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">,</span></span>
<span id="cb28-4">  <span class="dt" style="color: #AD0000;
background-color: null;
font-style: inherit;">"semanticConfiguration"</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">:</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"faq-semantic"</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">,</span></span>
<span id="cb28-5">  <span class="dt" style="color: #AD0000;
background-color: null;
font-style: inherit;">"vectorQueries"</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">:</span> <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">[</span></span>
<span id="cb28-6">    <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">{</span></span>
<span id="cb28-7">      <span class="dt" style="color: #AD0000;
background-color: null;
font-style: inherit;">"kind"</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">:</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"text"</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">,</span></span>
<span id="cb28-8">      <span class="dt" style="color: #AD0000;
background-color: null;
font-style: inherit;">"text"</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">:</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"how do I reset my password"</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">,</span></span>
<span id="cb28-9">      <span class="dt" style="color: #AD0000;
background-color: null;
font-style: inherit;">"fields"</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">:</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"questionVector,answerVector"</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">,</span></span>
<span id="cb28-10">      <span class="dt" style="color: #AD0000;
background-color: null;
font-style: inherit;">"k"</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">:</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">30</span></span>
<span id="cb28-11">    <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">}</span></span>
<span id="cb28-12">  <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">]</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">,</span></span>
<span id="cb28-13">  <span class="dt" style="color: #AD0000;
background-color: null;
font-style: inherit;">"answers"</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">:</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"extractive|count-1"</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">,</span></span>
<span id="cb28-14">  <span class="dt" style="color: #AD0000;
background-color: null;
font-style: inherit;">"captions"</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">:</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"extractive|highlight-false"</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">,</span></span>
<span id="cb28-15">  <span class="dt" style="color: #AD0000;
background-color: null;
font-style: inherit;">"top"</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">:</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">5</span></span>
<span id="cb28-16"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">}</span></span></code></pre></div>
<p><strong>성과</strong><br>
- 자동 해결률: 48% → 67% (+40%)<br>
- 고객 지원 티켓: 1,200/월 → 750/월 (-38%)<br>
- 평균 해결 시간: 12분 → 5분 (-58%)</p>
</section>
</section>
<section id="증거의-강도-및-한계" class="level2" data-number="1.9">
<h2 data-number="1.9" class="anchored" data-anchor-id="증거의-강도-및-한계"><span class="header-section-number">1.9</span> 증거의 강도 및 한계</h2>
<section id="증거-출처" class="level3" data-number="1.9.1">
<h3 data-number="1.9.1" class="anchored" data-anchor-id="증거-출처"><span class="header-section-number">1.9.1</span> 증거 출처</h3>
<ul>
<li>Microsoft Learn 공식 문서: Hybrid Search 아키텍처, RRF 알고리즘<br>
</li>
<li>Cormack et al.&nbsp;(2009): “Reciprocal Rank Fusion outperforms Condorcet”<br>
</li>
<li>MS MARCO: Microsoft Machine Reading Comprehension (벤치마크)<br>
</li>
<li>TREC-COVID, NFCorpus: 공개 정보 검색 벤치마크<br>
</li>
<li>Azure Search 내부 벤치마크: 성능 수치 (Microsoft 문서 기반)</li>
</ul>
</section>
<section id="한계점" class="level3" data-number="1.9.2">
<h3 data-number="1.9.2" class="anchored" data-anchor-id="한계점"><span class="header-section-number">1.9.2</span> 한계점</h3>
<ul>
<li>RRF k=60 고정: Azure는 k 값 변경 불가, 학술 연구에서는 k=50-100 범위 유사 성능<br>
</li>
<li>성능 수치 변동성: 벤치마크는 특정 데이터셋 기준, 실제 도메인에서 ±20-30% 변동 가능<br>
</li>
<li>최적 k 값: “top의 5배” 휴리스틱은 경험적 규칙, 정확한 최적값은 도메인별 실험 필요<br>
</li>
<li>Query-time Vectorization 지연: 50-150ms는 평균값, Azure OpenAI 부하, 네트워크에 따라 변동</li>
</ul>
</section>
<section id="대안-기술" class="level3" data-number="1.9.3">
<h3 data-number="1.9.3" class="anchored" data-anchor-id="대안-기술"><span class="header-section-number">1.9.3</span> 대안 기술</h3>
<p><strong>Elasticsearch</strong><br>
- Hybrid search 지원 (kNN + BM25)<br>
- 가중치 조정 가능 (weighted sum)<br>
- Learning to Rank 플러그인</p>
<p><strong>OpenSearch</strong><br>
- Neural search 플러그인<br>
- 다양한 fusion 방법 지원</p>
<p><strong>Weaviate</strong><br>
- Hybrid search with alpha 파라미터<br>
- GraphQL API</p>
<p><strong>Azure 통합 장점</strong><br>
- RRF 기본 제공 (튜닝 불필요)<br>
- Semantic Reranking 통합<br>
- 완전 관리형 (인프라 관리 불필요)</p>
</section>
</section>
<section id="불확실성-영역" class="level2" data-number="1.10">
<h2 data-number="1.10" class="anchored" data-anchor-id="불확실성-영역"><span class="header-section-number">1.10</span> 불확실성 영역</h2>
<ul>
<li>RRF 내부 구현: Azure의 정확한 RRF 구현 세부사항 비공개, 동점 처리 방식 불명확<br>
</li>
<li>Vectorization 캐싱: Azure가 내부적으로 쿼리 임베딩을 캐싱하는지 불명확, 캐싱 정책 비공개<br>
</li>
<li>대규모 환경 성능: 100M+ 문서 환경에서 실제 성능 데이터 제한적, 파티셔닝 시 RRF 동작 방식 불명확<br>
</li>
<li>가중치 조정 향후 지원: Weighted RRF 지원 계획 불명확, Learning to Rank 통합 시기 불명확</li>
</ul>
</section>
<section id="실무-의사결정-가이드" class="level2" data-number="1.11">
<h2 data-number="1.11" class="anchored" data-anchor-id="실무-의사결정-가이드"><span class="header-section-number">1.11</span> 실무 의사결정 가이드</h2>
<section id="hybrid-search-도입-여부" class="level3" data-number="1.11.1">
<h3 data-number="1.11.1" class="anchored" data-anchor-id="hybrid-search-도입-여부"><span class="header-section-number">1.11.1</span> Hybrid Search 도입 여부</h3>
<pre><code>검색 요구사항?
├─ 정확한 키워드 매칭만 (제품 코드, ID)
│  └─ Lexical only (BM25)
│     비용: 최소, 지연: 50ms
│
├─ 의미론적 이해 중요 (동의어, 자연어)
│  └─ Hybrid 필수
│     비용: +$0, 지연: +30ms
│     정확도: +30-50%
│
└─ 복잡한 자연어 질문 (QA)
   └─ Hybrid + Semantic
      비용: +$500/month, 지연: +250ms
      정확도: +50-80%</code></pre>
</section>
<section id="k-값-결정" class="level3" data-number="1.11.2">
<h3 data-number="1.11.2" class="anchored" data-anchor-id="k-값-결정"><span class="header-section-number">1.11.2</span> k 값 결정</h3>
<pre><code>최종 top 값?
├─ top=10
│  └─ k=50 (기본, 권장)
│
├─ top=20
│  └─ k=100
│
└─ top=50
   └─ k=200 (단, 지연 주의)

쿼리 타입?
├─ 짧은 키워드 (1-2 words)
│  └─ k 작게 (30-50)
│
└─ 긴 질문 (&gt;5 words)
   └─ k 크게 (50-100)</code></pre>
</section>
<section id="vectorization-방식-선택" class="level3" data-number="1.11.3">
<h3 data-number="1.11.3" class="anchored" data-anchor-id="vectorization-방식-선택"><span class="header-section-number">1.11.3</span> Vectorization 방식 선택</h3>
<pre><code>요구사항?
├─ 저지연 최우선 (&lt;50ms)
│  └─ Pre-computed vectors
│     - 클라이언트에서 임베딩 생성
│     - 캐싱 전략 필수
│
├─ 구현 단순성 우선
│  └─ Query-time vectorization
│     - Vectorizer 구성
│     - 지연 +80ms 허용
│
└─ 비용 최소화
   └─ Pre-computed + 캐싱
      - 중복 쿼리 많을 때 효과적</code></pre>
</section>
</section>
<section id="참고-링크" class="level2" data-number="1.12">
<h2 data-number="1.12" class="anchored" data-anchor-id="참고-링크"><span class="header-section-number">1.12</span> 참고 링크</h2>
<section id="microsoft-learn-공식-문서" class="level3" data-number="1.12.1">
<h3 data-number="1.12.1" class="anchored" data-anchor-id="microsoft-learn-공식-문서"><span class="header-section-number">1.12.1</span> Microsoft Learn 공식 문서</h3>
<ul>
<li>https://learn.microsoft.com/en-us/azure/search/hybrid-search-overview<br>
</li>
<li>https://learn.microsoft.com/en-us/azure/search/hybrid-search-how-to-query<br>
</li>
<li>https://learn.microsoft.com/en-us/azure/search/search-relevance-overview<br>
</li>
<li>https://learn.microsoft.com/en-us/azure/search/vector-search-ranking<br>
</li>
<li>https://learn.microsoft.com/en-us/azure/search/hybrid-search-ranking<br>
</li>
<li>https://learn.microsoft.com/en-us/azure/search/semantic-search-overview</li>
</ul>
</section>
<section id="학술-자료" class="level3" data-number="1.12.2">
<h3 data-number="1.12.2" class="anchored" data-anchor-id="학술-자료"><span class="header-section-number">1.12.2</span> 학술 자료</h3>
<ul>
<li>Cormack, G. V. et al.&nbsp;(2009). “Reciprocal rank fusion outperforms condorcet and individual rank learning methods.” SIGIR 2009<br>
</li>
<li>Fox, E. A. &amp; Shaw, J. A. (1994). “Combination of Multiple Searches.” TREC-2<br>
</li>
<li>MS MARCO: https://microsoft.github.io/msmarco/<br>
</li>
<li>BEIR: https://github.com/beir-cellar/beir</li>
</ul>


</section>
</section>
</section>

 ]]></description>
  <category>AI</category>
  <category>Cloud</category>
  <category>Azure</category>
  <category>Search</category>
  <guid>kk3225.netlify.app/docs/blog/posts/Engineering/Infra/Cloud/Azure/30-az-ai-search-classic-hybrid-search.html</guid>
  <pubDate>Tue, 23 Dec 2025 15:00:00 GMT</pubDate>
</item>
<item>
  <title>Azure Search — Vector Search 심층 가이드</title>
  <dc:creator>Kwangmin Kim</dc:creator>
  <link>kk3225.netlify.app/docs/blog/posts/Engineering/Infra/Cloud/Azure/29-az-ai-search-classic-vector-search.html</link>
  <description><![CDATA[ 





<section id="vector-search" class="level1" data-number="1">
<h1 data-number="1"><span class="header-section-number">1</span> Vector Search</h1>
<section id="vector-search-핵심-아키텍처" class="level2" data-number="1.1">
<h2 data-number="1.1" class="anchored" data-anchor-id="vector-search-핵심-아키텍처"><span class="header-section-number">1.1</span> Vector Search 핵심 아키텍처</h2>
<section id="vector-search-vs-traditional-search" class="level3" data-number="1.1.1">
<h3 data-number="1.1.1" class="anchored" data-anchor-id="vector-search-vs-traditional-search"><span class="header-section-number">1.1.1</span> Vector Search vs Traditional Search</h3>
<p><strong>근본적 차이</strong></p>
<table class="table">
<colgroup>
<col style="width: 15%">
<col style="width: 47%">
<col style="width: 37%">
</colgroup>
<thead>
<tr class="header">
<th>측면</th>
<th>Traditional (BM25)</th>
<th>Vector Search</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td>표현 방식</td>
<td>Sparse vectors (term frequency)</td>
<td>Dense vectors (semantic embeddings)</td>
</tr>
<tr class="even">
<td>차원</td>
<td>수천-수만 (vocabulary size)</td>
<td>512-3072 (embedding model)</td>
</tr>
<tr class="odd">
<td>유사도 계산</td>
<td>TF-IDF, BM25</td>
<td>Cosine similarity, Euclidean distance</td>
</tr>
<tr class="even">
<td>의미 이해</td>
<td>키워드 매칭</td>
<td>의미론적 유사성</td>
</tr>
<tr class="odd">
<td>처리 복잡도</td>
<td>O(n) - inverted index</td>
<td>O(log n) - HNSW graph</td>
</tr>
</tbody>
</table>
<p><strong>벡터 검색 플로우</strong></p>
<pre><code>Query Text → Embedding Model → Query Vector (1536-dim)
                                      ↓
                              HNSW Algorithm
                                      ↓
                              k-NN Search
                                      ↓
                              Top-K Results</code></pre>
</section>
<section id="지원-유사도-메트릭" class="level3" data-number="1.1.2">
<h3 data-number="1.1.2" class="anchored" data-anchor-id="지원-유사도-메트릭"><span class="header-section-number">1.1.2</span> 지원 유사도 메트릭</h3>
<p><strong>Cosine Similarity (기본값, 권장)</strong><br>
<img src="https://latex.codecogs.com/png.latex?%5Ctext%7Bsimilarity%7D(A,%20B)%20=%20%5Cfrac%7BA%20%5Ccdot%20B%7D%7B%5C%7CA%5C%7C%20%5C%7CB%5C%7C%7D%20=%20%5Cfrac%7B%5Csum_%7Bi=1%7D%5E%7Bn%7D%20A_i%20B_i%7D%7B%5Csqrt%7B%5Csum_%7Bi=1%7D%5E%7Bn%7D%20A_i%5E2%7D%20%5Csqrt%7B%5Csum_%7Bi=1%7D%5E%7Bn%7D%20B_i%5E2%7D%7D"></p>
<ul>
<li>범위: [-1, 1]<br>
</li>
<li>벡터 크기 정규화 (방향만 고려)<br>
</li>
<li>텍스트 임베딩에 최적 (OpenAI, Azure OpenAI)</li>
</ul>
<p><strong>Euclidean Distance (L2)</strong><br>
<img src="https://latex.codecogs.com/png.latex?%5Ctext%7Bdistance%7D(A,%20B)%20=%20%5Csqrt%7B%5Csum_%7Bi=1%7D%5E%7Bn%7D%20(A_i%20-%20B_i)%5E2%7D"></p>
<ul>
<li>범위: [0, ∞)<br>
</li>
<li>절대적 거리 측정<br>
</li>
<li>이미지 임베딩에 적합</li>
</ul>
<p><strong>Dot Product</strong><br>
<img src="https://latex.codecogs.com/png.latex?%5Ctext%7Bsimilarity%7D(A,%20B)%20=%20%5Csum_%7Bi=1%7D%5E%7Bn%7D%20A_i%20B_i"></p>
<ul>
<li>범위: (-∞, ∞)<br>
</li>
<li>정규화되지 않은 벡터용<br>
</li>
<li>특수한 임베딩 모델 (예: DPR)</li>
</ul>
<p><strong>성능 비교 (Microsoft 벤치마크, 1M 벡터)</strong><br>
- Cosine: 평균 20ms<br>
- Euclidean: 평균 18ms<br>
- Dot Product: 평균 15ms</p>
</section>
<section id="hnsw-알고리즘-상세" class="level3" data-number="1.1.3">
<h3 data-number="1.1.3" class="anchored" data-anchor-id="hnsw-알고리즘-상세"><span class="header-section-number">1.1.3</span> HNSW 알고리즘 상세</h3>
<p><strong>Hierarchical Navigable Small World 구조</strong></p>
<pre><code>Layer 2:  A -------- F
          |          |
Layer 1:  A -- C -- D -- F
          |    |    |    |
Layer 0:  A-B-C-D-E-F-G-H-I</code></pre>
<p><strong>핵심 파라미터</strong></p>
<table class="table">
<colgroup>
<col style="width: 22%">
<col style="width: 15%">
<col style="width: 20%">
<col style="width: 27%">
<col style="width: 15%">
</colgroup>
<thead>
<tr class="header">
<th>파라미터</th>
<th>설명</th>
<th>기본값</th>
<th>권장 범위</th>
<th>영향</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td>m</td>
<td>그래프 연결 수</td>
<td>4</td>
<td>4-10</td>
<td>정확도↑, 메모리↑, 쿼리 시간↑</td>
</tr>
<tr class="even">
<td>efConstruction</td>
<td>인덱싱 탐색 깊이</td>
<td>400</td>
<td>100-1000</td>
<td>인덱싱 시간↑, 정확도↑</td>
</tr>
<tr class="odd">
<td>efSearch</td>
<td>쿼리 탐색 깊이</td>
<td>500</td>
<td>100-1000</td>
<td>쿼리 시간↑, 정확도↑</td>
</tr>
</tbody>
</table>
<p><strong>파라미터 최적화 공식 (경험적 규칙)</strong><br>
- 고정확도: <code>m=8</code>, <code>efConstruction=800</code>, <code>efSearch=800</code><br>
- 균형: <code>m=4</code>, <code>efConstruction=400</code>, <code>efSearch=500</code> (기본값)<br>
- 고속도: <code>m=4</code>, <code>efConstruction=200</code>, <code>efSearch=200</code></p>
<p><strong>정량적 트레이드오프 (Microsoft 실험, 1M 벡터, 1536-dim)</strong></p>
<table class="table">
<thead>
<tr class="header">
<th>설정</th>
<th>Recall@10</th>
<th>인덱싱 시간</th>
<th>쿼리 시간</th>
<th>메모리</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td>m=4, ef=400</td>
<td>0.95</td>
<td>1.0x</td>
<td>1.0x</td>
<td>1.0x</td>
</tr>
<tr class="even">
<td>m=8, ef=800</td>
<td>0.98</td>
<td>2.5x</td>
<td>1.5x</td>
<td>2.0x</td>
</tr>
<tr class="odd">
<td>m=4, ef=200</td>
<td>0.88</td>
<td>0.5x</td>
<td>0.6x</td>
<td>1.0x</td>
</tr>
</tbody>
</table>
<p><strong>시간 복잡도</strong><br>
- 인덱싱: <img src="https://latex.codecogs.com/png.latex?O(n%20%5Clog%20n%20%5Ccdot%20m%20%5Ccdot%20%5Ctext%7BefConstruction%7D)"><br>
- 쿼리: <img src="https://latex.codecogs.com/png.latex?O(%5Clog%20n%20%5Ccdot%20%5Ctext%7BefSearch%7D)"><br>
- 메모리: <img src="https://latex.codecogs.com/png.latex?O(n%20%5Ccdot%20m%20%5Ccdot%20d)"> (d = 차원)</p>
</section>
</section>
<section id="vector-query-구문-및-실행" class="level2" data-number="1.2">
<h2 data-number="1.2" class="anchored" data-anchor-id="vector-query-구문-및-실행"><span class="header-section-number">1.2</span> Vector Query 구문 및 실행</h2>
<section id="기본-vector-query" class="level3" data-number="1.2.1">
<h3 data-number="1.2.1" class="anchored" data-anchor-id="기본-vector-query"><span class="header-section-number">1.2.1</span> 기본 Vector Query</h3>
<p><strong>단일 벡터 쿼리</strong></p>
<div class="sourceCode" id="cb3" style="background: #f1f3f5;"><pre class="sourceCode numberSource json number-lines code-with-copy"><code class="sourceCode json"><span id="cb3-1"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">{</span></span>
<span id="cb3-2">  <span class="dt" style="color: #AD0000;
background-color: null;
font-style: inherit;">"vectorQueries"</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">:</span> <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">[</span></span>
<span id="cb3-3">    <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">{</span></span>
<span id="cb3-4">      <span class="dt" style="color: #AD0000;
background-color: null;
font-style: inherit;">"kind"</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">:</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"vector"</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">,</span></span>
<span id="cb3-5">      <span class="dt" style="color: #AD0000;
background-color: null;
font-style: inherit;">"vector"</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">:</span> <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">[</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">0</span><span class="er" style="color: #AD0000;
background-color: null;
font-style: inherit;">.</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span><span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">,</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">0</span><span class="er" style="color: #AD0000;
background-color: null;
font-style: inherit;">.</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">2</span><span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">,</span> <span class="er" style="color: #AD0000;
background-color: null;
font-style: inherit;">...</span><span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">,</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">0</span><span class="er" style="color: #AD0000;
background-color: null;
font-style: inherit;">.</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">8</span><span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">]</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">,</span></span>
<span id="cb3-6">      <span class="dt" style="color: #AD0000;
background-color: null;
font-style: inherit;">"fields"</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">:</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"contentVector"</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">,</span></span>
<span id="cb3-7">      <span class="dt" style="color: #AD0000;
background-color: null;
font-style: inherit;">"k"</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">:</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">50</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">,</span></span>
<span id="cb3-8">      <span class="dt" style="color: #AD0000;
background-color: null;
font-style: inherit;">"exhaustive"</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">:</span> <span class="kw" style="color: #003B4F;
background-color: null;
font-style: inherit;">false</span></span>
<span id="cb3-9">    <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">}</span></span>
<span id="cb3-10">  <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">]</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">,</span></span>
<span id="cb3-11">  <span class="dt" style="color: #AD0000;
background-color: null;
font-style: inherit;">"select"</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">:</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"title,content"</span></span>
<span id="cb3-12"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">}</span></span></code></pre></div>
<p><strong>파라미터 설명</strong><br>
- <code>k</code>: 반환할 최근접 이웃 수 (1-1000, 권장: 10-100)<br>
- <code>exhaustive</code>:<br>
- <code>false</code> (기본): HNSW 근사 검색 (빠름, 약간의 정확도 손실)<br>
- <code>true</code>: Brute-force 검색 (느림, 100% 정확도)</p>
<p><strong>Exhaustive 모드 사용 사례</strong><br>
- 인덱스 크기 &lt; 10K 문서<br>
- 최대 정확도 필요 (법률, 의료 문서)<br>
- 벤치마킹 및 품질 검증</p>
<p><strong>성능 비교 (10K 문서, 1536-dim)</strong><br>
- <code>exhaustive=false</code>: 평균 15ms, Recall@10 = 0.95<br>
- <code>exhaustive=true</code>: 평균 200ms, Recall@10 = 1.00</p>
</section>
<section id="hybrid-search-text-vector" class="level3" data-number="1.2.2">
<h3 data-number="1.2.2" class="anchored" data-anchor-id="hybrid-search-text-vector"><span class="header-section-number">1.2.2</span> Hybrid Search (Text + Vector)</h3>
<p><strong>하이브리드 쿼리 구조</strong></p>
<div class="sourceCode" id="cb4" style="background: #f1f3f5;"><pre class="sourceCode numberSource json number-lines code-with-copy"><code class="sourceCode json"><span id="cb4-1"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">{</span></span>
<span id="cb4-2">  <span class="dt" style="color: #AD0000;
background-color: null;
font-style: inherit;">"search"</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">:</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"azure machine learning"</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">,</span></span>
<span id="cb4-3">  <span class="dt" style="color: #AD0000;
background-color: null;
font-style: inherit;">"vectorQueries"</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">:</span> <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">[</span></span>
<span id="cb4-4">    <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">{</span></span>
<span id="cb4-5">      <span class="dt" style="color: #AD0000;
background-color: null;
font-style: inherit;">"kind"</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">:</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"vector"</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">,</span></span>
<span id="cb4-6">      <span class="dt" style="color: #AD0000;
background-color: null;
font-style: inherit;">"vector"</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">:</span> <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">[</span><span class="er" style="color: #AD0000;
background-color: null;
font-style: inherit;">...</span><span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">]</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">,</span></span>
<span id="cb4-7">      <span class="dt" style="color: #AD0000;
background-color: null;
font-style: inherit;">"fields"</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">:</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"contentVector"</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">,</span></span>
<span id="cb4-8">      <span class="dt" style="color: #AD0000;
background-color: null;
font-style: inherit;">"k"</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">:</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">50</span></span>
<span id="cb4-9">    <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">}</span></span>
<span id="cb4-10">  <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">]</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">,</span></span>
<span id="cb4-11">  <span class="dt" style="color: #AD0000;
background-color: null;
font-style: inherit;">"top"</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">:</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">10</span></span>
<span id="cb4-12"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">}</span></span></code></pre></div>
<p><strong>RRF (Reciprocal Rank Fusion) 재계산</strong></p>
<p><img src="https://latex.codecogs.com/png.latex?%5Ctext%7BRRF%7D_%7B%5Ctext%7Bcombined%7D%7D(d)%20=%20%5Calpha%20%5Ccdot%20%5Cfrac%7B1%7D%7Bk%20+%20%5Ctext%7Brank%7D_%7B%5Ctext%7Btext%7D%7D(d)%7D%20+%20(1-%5Calpha)%20%5Ccdot%20%5Cfrac%7B1%7D%7Bk%20+%20%5Ctext%7Brank%7D_%7B%5Ctext%7Bvector%7D%7D(d)%7D"></p>
<ul>
<li><img src="https://latex.codecogs.com/png.latex?k">: 상수 (Azure Search 기본값: 60)<br>
</li>
<li><img src="https://latex.codecogs.com/png.latex?%5Calpha">: 텍스트/벡터 가중치 (기본값: 0.5, 균등)</li>
</ul>
<p><strong>실험적 성능 (MS MARCO 데이터셋)</strong><br>
- Text only (BM25): NDCG@10 = 0.32<br>
- Vector only: NDCG@10 = 0.38<br>
- Hybrid (RRF): NDCG@10 = 0.46 (+44% vs BM25, +21% vs Vector)</p>
</section>
<section id="multi-vector-queries" class="level3" data-number="1.2.3">
<h3 data-number="1.2.3" class="anchored" data-anchor-id="multi-vector-queries"><span class="header-section-number">1.2.3</span> Multi-Vector Queries</h3>
<p><strong>여러 벡터 필드 동시 검색</strong></p>
<div class="sourceCode" id="cb5" style="background: #f1f3f5;"><pre class="sourceCode numberSource json number-lines code-with-copy"><code class="sourceCode json"><span id="cb5-1"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">{</span></span>
<span id="cb5-2">  <span class="dt" style="color: #AD0000;
background-color: null;
font-style: inherit;">"vectorQueries"</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">:</span> <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">[</span></span>
<span id="cb5-3">    <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">{</span></span>
<span id="cb5-4">      <span class="dt" style="color: #AD0000;
background-color: null;
font-style: inherit;">"kind"</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">:</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"vector"</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">,</span></span>
<span id="cb5-5">      <span class="dt" style="color: #AD0000;
background-color: null;
font-style: inherit;">"vector"</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">:</span> <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">[</span><span class="er" style="color: #AD0000;
background-color: null;
font-style: inherit;">...</span><span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">]</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">,</span></span>
<span id="cb5-6">      <span class="dt" style="color: #AD0000;
background-color: null;
font-style: inherit;">"fields"</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">:</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"contentVector"</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">,</span></span>
<span id="cb5-7">      <span class="dt" style="color: #AD0000;
background-color: null;
font-style: inherit;">"k"</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">:</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">50</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">,</span></span>
<span id="cb5-8">      <span class="dt" style="color: #AD0000;
background-color: null;
font-style: inherit;">"weight"</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">:</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">0</span><span class="er" style="color: #AD0000;
background-color: null;
font-style: inherit;">.</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">6</span></span>
<span id="cb5-9">    <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">}</span><span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">,</span></span>
<span id="cb5-10">    <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">{</span></span>
<span id="cb5-11">      <span class="dt" style="color: #AD0000;
background-color: null;
font-style: inherit;">"kind"</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">:</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"vector"</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">,</span></span>
<span id="cb5-12">      <span class="dt" style="color: #AD0000;
background-color: null;
font-style: inherit;">"vector"</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">:</span> <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">[</span><span class="er" style="color: #AD0000;
background-color: null;
font-style: inherit;">...</span><span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">]</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">,</span></span>
<span id="cb5-13">      <span class="dt" style="color: #AD0000;
background-color: null;
font-style: inherit;">"fields"</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">:</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"imageVector"</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">,</span></span>
<span id="cb5-14">      <span class="dt" style="color: #AD0000;
background-color: null;
font-style: inherit;">"k"</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">:</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">50</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">,</span></span>
<span id="cb5-15">      <span class="dt" style="color: #AD0000;
background-color: null;
font-style: inherit;">"weight"</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">:</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">0</span><span class="er" style="color: #AD0000;
background-color: null;
font-style: inherit;">.</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">4</span></span>
<span id="cb5-16">    <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">}</span></span>
<span id="cb5-17">  <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">]</span></span>
<span id="cb5-18"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">}</span></span></code></pre></div>
<p><strong>가중치 기반 결합</strong><br>
<img src="https://latex.codecogs.com/png.latex?%5Ctext%7BScore%7D_%7B%5Ctext%7Bfinal%7D%7D(d)%20=%20w_1%20%5Ccdot%20%5Ctext%7BScore%7D_%7B%5Ctext%7Bcontent%7D%7D(d)%20+%20w_2%20%5Ccdot%20%5Ctext%7BScore%7D_%7B%5Ctext%7Bimage%7D%7D(d)"></p>
<ul>
<li><img src="https://latex.codecogs.com/png.latex?w_1%20+%20w_2%20=%201"> (정규화)<br>
</li>
<li>기본값: 균등 가중치 (각 1/n)</li>
</ul>
<p><strong>사용 사례</strong><br>
- 멀티모달 검색 (텍스트 + 이미지)<br>
- 다국어 검색 (언어별 벡터 필드)<br>
- 세분화된 검색 (제목 벡터 + 본문 벡터)</p>
</section>
</section>
<section id="vector-search-filtering" class="level2" data-number="1.3">
<h2 data-number="1.3" class="anchored" data-anchor-id="vector-search-filtering"><span class="header-section-number">1.3</span> Vector Search Filtering</h2>
<section id="필터링-모드" class="level3" data-number="1.3.1">
<h3 data-number="1.3.1" class="anchored" data-anchor-id="필터링-모드"><span class="header-section-number">1.3.1</span> 필터링 모드</h3>
<p>Azure Search는 3가지 필터링 모드를 지원합니다.</p>
<table class="table">
<colgroup>
<col style="width: 15%">
<col style="width: 25%">
<col style="width: 20%">
<col style="width: 15%">
<col style="width: 25%">
</colgroup>
<thead>
<tr class="header">
<th>모드</th>
<th>실행 순서</th>
<th>정확도</th>
<th>성능</th>
<th>사용 사례</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td>preFilter</td>
<td>Filter → Vector search</td>
<td>높음</td>
<td>빠름</td>
<td>엄격한 필터 조건</td>
</tr>
<tr class="even">
<td>postFilter</td>
<td>Vector search → Filter</td>
<td>낮음</td>
<td>매우 빠름</td>
<td>선택적 필터</td>
</tr>
<tr class="odd">
<td>vectorFilterMode: null</td>
<td>자동 선택</td>
<td>중간</td>
<td>최적화</td>
<td>일반 사용 (권장)</td>
</tr>
</tbody>
</table>
</section>
<section id="pre-filtering-필터-우선" class="level3" data-number="1.3.2">
<h3 data-number="1.3.2" class="anchored" data-anchor-id="pre-filtering-필터-우선"><span class="header-section-number">1.3.2</span> Pre-Filtering (필터 우선)</h3>
<p><strong>구문</strong></p>
<div class="sourceCode" id="cb6" style="background: #f1f3f5;"><pre class="sourceCode numberSource json number-lines code-with-copy"><code class="sourceCode json"><span id="cb6-1"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">{</span></span>
<span id="cb6-2">  <span class="dt" style="color: #AD0000;
background-color: null;
font-style: inherit;">"vectorQueries"</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">:</span> <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">[</span></span>
<span id="cb6-3">    <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">{</span></span>
<span id="cb6-4">      <span class="dt" style="color: #AD0000;
background-color: null;
font-style: inherit;">"kind"</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">:</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"vector"</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">,</span></span>
<span id="cb6-5">      <span class="dt" style="color: #AD0000;
background-color: null;
font-style: inherit;">"vector"</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">:</span> <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">[</span><span class="er" style="color: #AD0000;
background-color: null;
font-style: inherit;">...</span><span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">]</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">,</span></span>
<span id="cb6-6">      <span class="dt" style="color: #AD0000;
background-color: null;
font-style: inherit;">"fields"</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">:</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"contentVector"</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">,</span></span>
<span id="cb6-7">      <span class="dt" style="color: #AD0000;
background-color: null;
font-style: inherit;">"k"</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">:</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">50</span></span>
<span id="cb6-8">    <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">}</span></span>
<span id="cb6-9">  <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">]</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">,</span></span>
<span id="cb6-10">  <span class="dt" style="color: #AD0000;
background-color: null;
font-style: inherit;">"vectorFilterMode"</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">:</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"preFilter"</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">,</span></span>
<span id="cb6-11">  <span class="dt" style="color: #AD0000;
background-color: null;
font-style: inherit;">"filter"</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">:</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"category eq 'Technology' and publishDate ge 2023-01-01"</span></span>
<span id="cb6-12"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">}</span></span></code></pre></div>
<p><strong>실행 플로우</strong></p>
<pre><code>1. Apply filter: 1M docs → 100K docs (filtered)
   ↓
2. HNSW search on 100K docs
   ↓
3. Return top 50 results</code></pre>
<p><strong>장점</strong><br>
- 필터링된 공간에서 정확한 k-NN 보장<br>
- 필터 조건이 매우 제한적일 때 효율적 (&gt;90% 제거)</p>
<p><strong>단점</strong><br>
- 필터 후 문서 수가 적으면 그래프 연결성 저하<br>
- HNSW 그래프 재구성 오버헤드</p>
<p><strong>성능 특성 (1M 문서)</strong><br>
- 필터 선택도 90%: 평균 30ms<br>
- 필터 선택도 50%: 평균 80ms<br>
- 필터 선택도 10%: 평균 200ms (그래프 재구성 비용)</p>
</section>
<section id="post-filtering-벡터-우선" class="level3" data-number="1.3.3">
<h3 data-number="1.3.3" class="anchored" data-anchor-id="post-filtering-벡터-우선"><span class="header-section-number">1.3.3</span> Post-Filtering (벡터 우선)</h3>
<p><strong>구문</strong></p>
<div class="sourceCode" id="cb8" style="background: #f1f3f5;"><pre class="sourceCode numberSource json number-lines code-with-copy"><code class="sourceCode json"><span id="cb8-1"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">{</span></span>
<span id="cb8-2">  <span class="dt" style="color: #AD0000;
background-color: null;
font-style: inherit;">"vectorQueries"</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">:</span> <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">[</span></span>
<span id="cb8-3">    <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">{</span></span>
<span id="cb8-4">      <span class="dt" style="color: #AD0000;
background-color: null;
font-style: inherit;">"kind"</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">:</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"vector"</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">,</span></span>
<span id="cb8-5">      <span class="dt" style="color: #AD0000;
background-color: null;
font-style: inherit;">"vector"</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">:</span> <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">[</span><span class="er" style="color: #AD0000;
background-color: null;
font-style: inherit;">...</span><span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">]</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">,</span></span>
<span id="cb8-6">      <span class="dt" style="color: #AD0000;
background-color: null;
font-style: inherit;">"fields"</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">:</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"contentVector"</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">,</span></span>
<span id="cb8-7">      <span class="dt" style="color: #AD0000;
background-color: null;
font-style: inherit;">"k"</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">:</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">50</span></span>
<span id="cb8-8">    <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">}</span></span>
<span id="cb8-9">  <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">]</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">,</span></span>
<span id="cb8-10">  <span class="dt" style="color: #AD0000;
background-color: null;
font-style: inherit;">"vectorFilterMode"</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">:</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"postFilter"</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">,</span></span>
<span id="cb8-11">  <span class="dt" style="color: #AD0000;
background-color: null;
font-style: inherit;">"filter"</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">:</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"category eq 'Technology'"</span></span>
<span id="cb8-12"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">}</span></span></code></pre></div>
<p><strong>실행 플로우</strong></p>
<pre><code>1. HNSW search: 1M docs → Top 50 candidates
   ↓
2. Apply filter: 50 candidates → 30 results (filtered)
   ↓
3. Return 30 results (may be &lt; k)</code></pre>
<p><strong>장점</strong><br>
- 가장 빠른 벡터 검색 (필터 오버헤드 없음)<br>
- HNSW 그래프 성능 최대 활용</p>
<p><strong>단점</strong><br>
- 반환 결과 수가 k보다 적을 수 있음<br>
- 필터링된 공간에서의 정확한 k-NN 보장 못함</p>
<p><strong>성능 특성 (1M 문서)</strong><br>
- 벡터 검색: 평균 20ms<br>
- 필터 적용: 평균 +2ms<br>
- 총 시간: 평균 22ms (filter 선택도 무관)</p>
</section>
<section id="hybrid-filtering-자동-선택" class="level3" data-number="1.3.4">
<h3 data-number="1.3.4" class="anchored" data-anchor-id="hybrid-filtering-자동-선택"><span class="header-section-number">1.3.4</span> Hybrid Filtering (자동 선택)</h3>
<p><strong>구문 (기본값)</strong></p>
<div class="sourceCode" id="cb10" style="background: #f1f3f5;"><pre class="sourceCode numberSource json number-lines code-with-copy"><code class="sourceCode json"><span id="cb10-1"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">{</span></span>
<span id="cb10-2">  <span class="dt" style="color: #AD0000;
background-color: null;
font-style: inherit;">"vectorQueries"</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">:</span> <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">[</span></span>
<span id="cb10-3">    <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">{</span></span>
<span id="cb10-4">      <span class="dt" style="color: #AD0000;
background-color: null;
font-style: inherit;">"kind"</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">:</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"vector"</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">,</span></span>
<span id="cb10-5">      <span class="dt" style="color: #AD0000;
background-color: null;
font-style: inherit;">"vector"</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">:</span> <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">[</span><span class="er" style="color: #AD0000;
background-color: null;
font-style: inherit;">...</span><span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">]</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">,</span></span>
<span id="cb10-6">      <span class="dt" style="color: #AD0000;
background-color: null;
font-style: inherit;">"fields"</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">:</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"contentVector"</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">,</span></span>
<span id="cb10-7">      <span class="dt" style="color: #AD0000;
background-color: null;
font-style: inherit;">"k"</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">:</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">50</span></span>
<span id="cb10-8">    <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">}</span></span>
<span id="cb10-9">  <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">]</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">,</span></span>
<span id="cb10-10">  <span class="dt" style="color: #AD0000;
background-color: null;
font-style: inherit;">"filter"</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">:</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"category eq 'Technology'"</span></span>
<span id="cb10-11"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">}</span></span></code></pre></div>
<p><strong>Azure의 자동 선택 휴리스틱</strong></p>
<div class="sourceCode" id="cb11" style="background: #f1f3f5;"><pre class="sourceCode numberSource python number-lines code-with-copy"><code class="sourceCode python"><span id="cb11-1"><span class="kw" style="color: #003B4F;
background-color: null;
font-style: inherit;">def</span> choose_filter_mode(filter_selectivity, index_size):</span>
<span id="cb11-2">    <span class="cf" style="color: #003B4F;
background-color: null;
font-style: inherit;">if</span> filter_selectivity <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">&gt;</span> <span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">0.8</span>:</span>
<span id="cb11-3">        <span class="cf" style="color: #003B4F;
background-color: null;
font-style: inherit;">return</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"preFilter"</span></span>
<span id="cb11-4">    <span class="cf" style="color: #003B4F;
background-color: null;
font-style: inherit;">elif</span> filter_selectivity <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">&lt;</span> <span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">0.1</span>:</span>
<span id="cb11-5">        <span class="cf" style="color: #003B4F;
background-color: null;
font-style: inherit;">return</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"postFilter"</span></span>
<span id="cb11-6">    <span class="cf" style="color: #003B4F;
background-color: null;
font-style: inherit;">else</span>:</span>
<span id="cb11-7">        <span class="cf" style="color: #003B4F;
background-color: null;
font-style: inherit;">return</span> decide_dynamically()</span></code></pre></div>
<p><strong>실험적 최적화 (Microsoft 논문, 2023)</strong><br>
- 자동 모드가 수동 선택 대비 평균 15-20% 성능 향상<br>
- 쿼리 패턴 학습으로 지속적 개선</p>
</section>
<section id="필터링-전략-결정-가이드" class="level3" data-number="1.3.5">
<h3 data-number="1.3.5" class="anchored" data-anchor-id="필터링-전략-결정-가이드"><span class="header-section-number">1.3.5</span> 필터링 전략 결정 가이드</h3>
<p><strong>의사결정 트리</strong></p>
<pre><code>필터 선택도?
├─ &gt;80% (매우 제한적)
│  └─ preFilter (필터 우선)
│     예: category eq 'RareCategory'
│
├─ 50-80% (중간)
│  └─ null (자동 선택)
│     예: publishDate ge 2023-01-01
│
└─ &lt;50% (느슨함)
   └─ postFilter (벡터 우선)
      예: inStock eq true (90% 문서가 true)</code></pre>
<p><strong>실무 권장사항</strong><br>
1. 기본값 사용: <code>vectorFilterMode</code> 생략 (자동 최적화)<br>
2. 엄격한 SLA: <code>preFilter</code> 명시 (일관된 정확도)<br>
3. 초고속 필요: <code>postFilter</code> 명시 (최소 지연시간)</p>
</section>
</section>
<section id="vectorizer-구성-및-통합" class="level2" data-number="1.4">
<h2 data-number="1.4" class="anchored" data-anchor-id="vectorizer-구성-및-통합"><span class="header-section-number">1.4</span> Vectorizer 구성 및 통합</h2>
<section id="지원-vectorizer-종류" class="level3" data-number="1.4.1">
<h3 data-number="1.4.1" class="anchored" data-anchor-id="지원-vectorizer-종류"><span class="header-section-number">1.4.1</span> 지원 Vectorizer 종류</h3>
<p><strong>Azure OpenAI Embeddings</strong></p>
<div class="sourceCode" id="cb13" style="background: #f1f3f5;"><pre class="sourceCode numberSource json number-lines code-with-copy"><code class="sourceCode json"><span id="cb13-1"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">{</span></span>
<span id="cb13-2">  <span class="dt" style="color: #AD0000;
background-color: null;
font-style: inherit;">"name"</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">:</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"my-azure-openai-vectorizer"</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">,</span></span>
<span id="cb13-3">  <span class="dt" style="color: #AD0000;
background-color: null;
font-style: inherit;">"kind"</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">:</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"azureOpenAI"</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">,</span></span>
<span id="cb13-4">  <span class="dt" style="color: #AD0000;
background-color: null;
font-style: inherit;">"azureOpenAIParameters"</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">:</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">{</span></span>
<span id="cb13-5">    <span class="dt" style="color: #AD0000;
background-color: null;
font-style: inherit;">"resourceUri"</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">:</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"https://my-resource.openai.azure.com"</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">,</span></span>
<span id="cb13-6">    <span class="dt" style="color: #AD0000;
background-color: null;
font-style: inherit;">"deploymentId"</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">:</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"text-embedding-3-large"</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">,</span></span>
<span id="cb13-7">    <span class="dt" style="color: #AD0000;
background-color: null;
font-style: inherit;">"apiKey"</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">:</span> <span class="kw" style="color: #003B4F;
background-color: null;
font-style: inherit;">null</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">,</span></span>
<span id="cb13-8">    <span class="dt" style="color: #AD0000;
background-color: null;
font-style: inherit;">"authIdentity"</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">:</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">{</span></span>
<span id="cb13-9">      <span class="dt" style="color: #AD0000;
background-color: null;
font-style: inherit;">"identityType"</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">:</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"systemAssignedIdentity"</span></span>
<span id="cb13-10">    <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">},</span></span>
<span id="cb13-11">    <span class="dt" style="color: #AD0000;
background-color: null;
font-style: inherit;">"modelName"</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">:</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"text-embedding-3-large"</span></span>
<span id="cb13-12">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">}</span></span>
<span id="cb13-13"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">}</span></span></code></pre></div>
<p><strong>지원 모델</strong></p>
<table class="table">
<thead>
<tr class="header">
<th>모델</th>
<th>차원</th>
<th>비용 (per 1M tokens)</th>
<th>성능 (MTEB)</th>
<th>권장 사용</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td>text-embedding-ada-002</td>
<td>1536</td>
<td>$0.10</td>
<td>0.60</td>
<td>범용 (레거시)</td>
</tr>
<tr class="even">
<td>text-embedding-3-small</td>
<td>512/1536</td>
<td>$0.02</td>
<td>0.62</td>
<td>저비용</td>
</tr>
<tr class="odd">
<td>text-embedding-3-large</td>
<td>256/1024/3072</td>
<td>$0.13</td>
<td>0.64</td>
<td>고정확도</td>
</tr>
</tbody>
</table>
<p><strong>Azure AI Vision Multimodal</strong></p>
<div class="sourceCode" id="cb14" style="background: #f1f3f5;"><pre class="sourceCode numberSource json number-lines code-with-copy"><code class="sourceCode json"><span id="cb14-1"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">{</span></span>
<span id="cb14-2">  <span class="dt" style="color: #AD0000;
background-color: null;
font-style: inherit;">"name"</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">:</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"my-vision-vectorizer"</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">,</span></span>
<span id="cb14-3">  <span class="dt" style="color: #AD0000;
background-color: null;
font-style: inherit;">"kind"</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">:</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"aiServicesVision"</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">,</span></span>
<span id="cb14-4">  <span class="dt" style="color: #AD0000;
background-color: null;
font-style: inherit;">"aiServicesVisionParameters"</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">:</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">{</span></span>
<span id="cb14-5">    <span class="dt" style="color: #AD0000;
background-color: null;
font-style: inherit;">"resourceUri"</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">:</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"https://my-vision.cognitiveservices.azure.com"</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">,</span></span>
<span id="cb14-6">    <span class="dt" style="color: #AD0000;
background-color: null;
font-style: inherit;">"apiKey"</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">:</span> <span class="kw" style="color: #003B4F;
background-color: null;
font-style: inherit;">null</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">,</span></span>
<span id="cb14-7">    <span class="dt" style="color: #AD0000;
background-color: null;
font-style: inherit;">"authIdentity"</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">:</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">{</span></span>
<span id="cb14-8">      <span class="dt" style="color: #AD0000;
background-color: null;
font-style: inherit;">"identityType"</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">:</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"systemAssignedIdentity"</span></span>
<span id="cb14-9">    <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">},</span></span>
<span id="cb14-10">    <span class="dt" style="color: #AD0000;
background-color: null;
font-style: inherit;">"modelVersion"</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">:</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"2023-04-15"</span></span>
<span id="cb14-11">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">}</span></span>
<span id="cb14-12"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">}</span></span></code></pre></div>
<p><strong>특징</strong><br>
- 텍스트 + 이미지 동시 임베딩<br>
- 차원: 1024<br>
- 멀티모달 검색에 최적</p>
<p><strong>Custom Web API</strong></p>
<div class="sourceCode" id="cb15" style="background: #f1f3f5;"><pre class="sourceCode numberSource json number-lines code-with-copy"><code class="sourceCode json"><span id="cb15-1"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">{</span></span>
<span id="cb15-2">  <span class="dt" style="color: #AD0000;
background-color: null;
font-style: inherit;">"name"</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">:</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"my-custom-vectorizer"</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">,</span></span>
<span id="cb15-3">  <span class="dt" style="color: #AD0000;
background-color: null;
font-style: inherit;">"kind"</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">:</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"customWebApi"</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">,</span></span>
<span id="cb15-4">  <span class="dt" style="color: #AD0000;
background-color: null;
font-style: inherit;">"customWebApiParameters"</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">:</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">{</span></span>
<span id="cb15-5">    <span class="dt" style="color: #AD0000;
background-color: null;
font-style: inherit;">"uri"</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">:</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"https://my-function.azurewebsites.net/api/embed"</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">,</span></span>
<span id="cb15-6">    <span class="dt" style="color: #AD0000;
background-color: null;
font-style: inherit;">"httpMethod"</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">:</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"POST"</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">,</span></span>
<span id="cb15-7">    <span class="dt" style="color: #AD0000;
background-color: null;
font-style: inherit;">"httpHeaders"</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">:</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">{</span></span>
<span id="cb15-8">      <span class="dt" style="color: #AD0000;
background-color: null;
font-style: inherit;">"api-key"</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">:</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"..."</span></span>
<span id="cb15-9">    <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">},</span></span>
<span id="cb15-10">    <span class="dt" style="color: #AD0000;
background-color: null;
font-style: inherit;">"authIdentity"</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">:</span> <span class="kw" style="color: #003B4F;
background-color: null;
font-style: inherit;">null</span></span>
<span id="cb15-11">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">}</span></span>
<span id="cb15-12"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">}</span></span></code></pre></div>
<p><strong>사용 사례</strong><br>
- 도메인 특화 임베딩 모델 (BERT fine-tuned)<br>
- 온프레미스 모델 통합<br>
- 커스텀 전처리 로직</p>
</section>
<section id="vectorization-skill-통합" class="level3" data-number="1.4.2">
<h3 data-number="1.4.2" class="anchored" data-anchor-id="vectorization-skill-통합"><span class="header-section-number">1.4.2</span> Vectorization Skill 통합</h3>
<p><strong>Skillset에서 Vectorizer 사용</strong></p>
<div class="sourceCode" id="cb16" style="background: #f1f3f5;"><pre class="sourceCode numberSource json number-lines code-with-copy"><code class="sourceCode json"><span id="cb16-1"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">{</span></span>
<span id="cb16-2">  <span class="dt" style="color: #AD0000;
background-color: null;
font-style: inherit;">"skills"</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">:</span> <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">[</span></span>
<span id="cb16-3">    <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">{</span></span>
<span id="cb16-4">      <span class="dt" style="color: #AD0000;
background-color: null;
font-style: inherit;">"@odata.type"</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">:</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"#Microsoft.Skills.Text.AzureOpenAIEmbeddingSkill"</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">,</span></span>
<span id="cb16-5">      <span class="dt" style="color: #AD0000;
background-color: null;
font-style: inherit;">"name"</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">:</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"content-embedding"</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">,</span></span>
<span id="cb16-6">      <span class="dt" style="color: #AD0000;
background-color: null;
font-style: inherit;">"context"</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">:</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"/document/pages/*"</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">,</span></span>
<span id="cb16-7">      <span class="dt" style="color: #AD0000;
background-color: null;
font-style: inherit;">"resourceUri"</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">:</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"https://my-resource.openai.azure.com"</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">,</span></span>
<span id="cb16-8">      <span class="dt" style="color: #AD0000;
background-color: null;
font-style: inherit;">"deploymentId"</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">:</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"text-embedding-3-large"</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">,</span></span>
<span id="cb16-9">      <span class="dt" style="color: #AD0000;
background-color: null;
font-style: inherit;">"modelName"</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">:</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"text-embedding-3-large"</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">,</span></span>
<span id="cb16-10">      <span class="dt" style="color: #AD0000;
background-color: null;
font-style: inherit;">"dimensions"</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">:</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1024</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">,</span></span>
<span id="cb16-11">      <span class="dt" style="color: #AD0000;
background-color: null;
font-style: inherit;">"inputs"</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">:</span> <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">[</span></span>
<span id="cb16-12">        <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">{</span></span>
<span id="cb16-13">          <span class="dt" style="color: #AD0000;
background-color: null;
font-style: inherit;">"name"</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">:</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"text"</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">,</span></span>
<span id="cb16-14">          <span class="dt" style="color: #AD0000;
background-color: null;
font-style: inherit;">"source"</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">:</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"/document/pages/*/content"</span></span>
<span id="cb16-15">        <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">}</span></span>
<span id="cb16-16">      <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">]</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">,</span></span>
<span id="cb16-17">      <span class="dt" style="color: #AD0000;
background-color: null;
font-style: inherit;">"outputs"</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">:</span> <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">[</span></span>
<span id="cb16-18">        <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">{</span></span>
<span id="cb16-19">          <span class="dt" style="color: #AD0000;
background-color: null;
font-style: inherit;">"name"</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">:</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"embedding"</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">,</span></span>
<span id="cb16-20">          <span class="dt" style="color: #AD0000;
background-color: null;
font-style: inherit;">"targetName"</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">:</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"contentVector"</span></span>
<span id="cb16-21">        <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">}</span></span>
<span id="cb16-22">      <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">]</span></span>
<span id="cb16-23">    <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">}</span></span>
<span id="cb16-24">  <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">]</span></span>
<span id="cb16-25"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">}</span></span></code></pre></div>
<p><strong>차원 축소 (text-embedding-3 전용)</strong></p>
<div class="sourceCode" id="cb17" style="background: #f1f3f5;"><pre class="sourceCode numberSource json number-lines code-with-copy"><code class="sourceCode json"><span id="cb17-1"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">{</span></span>
<span id="cb17-2">  <span class="dt" style="color: #AD0000;
background-color: null;
font-style: inherit;">"dimensions"</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">:</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">512</span></span>
<span id="cb17-3"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">}</span></span></code></pre></div>
<p><strong>성능 영향 (MTEB 벤치마크)</strong><br>
- 3072-dim: 0.64 (baseline)<br>
- 1024-dim: 0.63 (-1.6%)<br>
- 512-dim: 0.61 (-4.7%)</p>
<p><strong>비용 절감 계산 (1M 문서, 500 tokens/doc)</strong><br>
- 3072-dim: $65 (임베딩) + $900/month (스토리지)<br>
- 1024-dim: $65 (임베딩) + $300/month (스토리지)<br>
- 512-dim: $65 (임베딩) + $150/month (스토리지)</p>
</section>
<section id="query-time-vectorization" class="level3" data-number="1.4.3">
<h3 data-number="1.4.3" class="anchored" data-anchor-id="query-time-vectorization"><span class="header-section-number">1.4.3</span> Query-time Vectorization</h3>
<p><strong>내장 벡터화 쿼리</strong></p>
<div class="sourceCode" id="cb18" style="background: #f1f3f5;"><pre class="sourceCode numberSource json number-lines code-with-copy"><code class="sourceCode json"><span id="cb18-1"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">{</span></span>
<span id="cb18-2">  <span class="dt" style="color: #AD0000;
background-color: null;
font-style: inherit;">"vectorQueries"</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">:</span> <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">[</span></span>
<span id="cb18-3">    <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">{</span></span>
<span id="cb18-4">      <span class="dt" style="color: #AD0000;
background-color: null;
font-style: inherit;">"kind"</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">:</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"text"</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">,</span></span>
<span id="cb18-5">      <span class="dt" style="color: #AD0000;
background-color: null;
font-style: inherit;">"text"</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">:</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"how to optimize azure search performance"</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">,</span></span>
<span id="cb18-6">      <span class="dt" style="color: #AD0000;
background-color: null;
font-style: inherit;">"fields"</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">:</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"contentVector"</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">,</span></span>
<span id="cb18-7">      <span class="dt" style="color: #AD0000;
background-color: null;
font-style: inherit;">"k"</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">:</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">50</span></span>
<span id="cb18-8">    <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">}</span></span>
<span id="cb18-9">  <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">]</span></span>
<span id="cb18-10"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">}</span></span></code></pre></div>
<p><strong>처리 플로우</strong></p>
<pre><code>Query Text → Vectorizer API → Query Embedding → HNSW Search</code></pre>
<p><strong>Vectorizer 지정</strong></p>
<div class="sourceCode" id="cb20" style="background: #f1f3f5;"><pre class="sourceCode numberSource json number-lines code-with-copy"><code class="sourceCode json"><span id="cb20-1"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">{</span></span>
<span id="cb20-2">  <span class="dt" style="color: #AD0000;
background-color: null;
font-style: inherit;">"fields"</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">:</span> <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">[</span></span>
<span id="cb20-3">    <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">{</span></span>
<span id="cb20-4">      <span class="dt" style="color: #AD0000;
background-color: null;
font-style: inherit;">"name"</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">:</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"contentVector"</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">,</span></span>
<span id="cb20-5">      <span class="dt" style="color: #AD0000;
background-color: null;
font-style: inherit;">"type"</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">:</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Collection(Edm.Single)"</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">,</span></span>
<span id="cb20-6">      <span class="dt" style="color: #AD0000;
background-color: null;
font-style: inherit;">"vectorSearchProfile"</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">:</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"my-profile"</span></span>
<span id="cb20-7">    <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">}</span></span>
<span id="cb20-8">  <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">]</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">,</span></span>
<span id="cb20-9">  <span class="dt" style="color: #AD0000;
background-color: null;
font-style: inherit;">"vectorSearch"</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">:</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">{</span></span>
<span id="cb20-10">    <span class="dt" style="color: #AD0000;
background-color: null;
font-style: inherit;">"profiles"</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">:</span> <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">[</span></span>
<span id="cb20-11">      <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">{</span></span>
<span id="cb20-12">        <span class="dt" style="color: #AD0000;
background-color: null;
font-style: inherit;">"name"</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">:</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"my-profile"</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">,</span></span>
<span id="cb20-13">        <span class="dt" style="color: #AD0000;
background-color: null;
font-style: inherit;">"algorithm"</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">:</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"hnsw-config"</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">,</span></span>
<span id="cb20-14">        <span class="dt" style="color: #AD0000;
background-color: null;
font-style: inherit;">"vectorizer"</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">:</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"my-azure-openai-vectorizer"</span></span>
<span id="cb20-15">      <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">}</span></span>
<span id="cb20-16">    <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">]</span></span>
<span id="cb20-17">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">}</span></span>
<span id="cb20-18"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">}</span></span></code></pre></div>
<p><strong>장점</strong><br>
- 클라이언트 코드 단순화 (임베딩 생성 불필요)<br>
- 벡터 일관성 보장 (인덱싱/쿼리 동일 모델)</p>
<p><strong>단점</strong><br>
- 쿼리 지연시간 증가 (+50-150ms)<br>
- Azure OpenAI Rate Limit 영향</p>
<p><strong>성능 비교 (1M 문서)</strong><br>
- Pre-vectorized query: 평균 20ms<br>
- Query-time vectorization: 평균 120ms (+100ms embedding)</p>
</section>
</section>
<section id="multi-vector-fields-전략" class="level2" data-number="1.5">
<h2 data-number="1.5" class="anchored" data-anchor-id="multi-vector-fields-전략"><span class="header-section-number">1.5</span> Multi-Vector Fields 전략</h2>
<section id="다중-벡터-필드-아키텍처" class="level3" data-number="1.5.1">
<h3 data-number="1.5.1" class="anchored" data-anchor-id="다중-벡터-필드-아키텍처"><span class="header-section-number">1.5.1</span> 다중 벡터 필드 아키텍처</h3>
<p><strong>시나리오별 설계</strong></p>
<p><strong>세분화된 콘텐츠 (Chunking)</strong></p>
<div class="sourceCode" id="cb21" style="background: #f1f3f5;"><pre class="sourceCode numberSource json number-lines code-with-copy"><code class="sourceCode json"><span id="cb21-1"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">{</span></span>
<span id="cb21-2">  <span class="dt" style="color: #AD0000;
background-color: null;
font-style: inherit;">"fields"</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">:</span> <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">[</span></span>
<span id="cb21-3">    <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">{</span></span>
<span id="cb21-4">      <span class="dt" style="color: #AD0000;
background-color: null;
font-style: inherit;">"name"</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">:</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"titleVector"</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">,</span></span>
<span id="cb21-5">      <span class="dt" style="color: #AD0000;
background-color: null;
font-style: inherit;">"type"</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">:</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Collection(Edm.Single)"</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">,</span></span>
<span id="cb21-6">      <span class="dt" style="color: #AD0000;
background-color: null;
font-style: inherit;">"dimensions"</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">:</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1024</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">,</span></span>
<span id="cb21-7">      <span class="dt" style="color: #AD0000;
background-color: null;
font-style: inherit;">"vectorSearchProfile"</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">:</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"title-profile"</span></span>
<span id="cb21-8">    <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">}</span><span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">,</span></span>
<span id="cb21-9">    <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">{</span></span>
<span id="cb21-10">      <span class="dt" style="color: #AD0000;
background-color: null;
font-style: inherit;">"name"</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">:</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"contentVector"</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">,</span></span>
<span id="cb21-11">      <span class="dt" style="color: #AD0000;
background-color: null;
font-style: inherit;">"type"</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">:</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Collection(Edm.Single)"</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">,</span></span>
<span id="cb21-12">      <span class="dt" style="color: #AD0000;
background-color: null;
font-style: inherit;">"dimensions"</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">:</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1024</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">,</span></span>
<span id="cb21-13">      <span class="dt" style="color: #AD0000;
background-color: null;
font-style: inherit;">"vectorSearchProfile"</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">:</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"content-profile"</span></span>
<span id="cb21-14">    <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">}</span><span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">,</span></span>
<span id="cb21-15">    <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">{</span></span>
<span id="cb21-16">      <span class="dt" style="color: #AD0000;
background-color: null;
font-style: inherit;">"name"</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">:</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"abstractVector"</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">,</span></span>
<span id="cb21-17">      <span class="dt" style="color: #AD0000;
background-color: null;
font-style: inherit;">"type"</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">:</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Collection(Edm.Single)"</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">,</span></span>
<span id="cb21-18">      <span class="dt" style="color: #AD0000;
background-color: null;
font-style: inherit;">"dimensions"</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">:</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1024</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">,</span></span>
<span id="cb21-19">      <span class="dt" style="color: #AD0000;
background-color: null;
font-style: inherit;">"vectorSearchProfile"</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">:</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"abstract-profile"</span></span>
<span id="cb21-20">    <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">}</span></span>
<span id="cb21-21">  <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">]</span></span>
<span id="cb21-22"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">}</span></span></code></pre></div>
<p><strong>쿼리 전략 (가중치 차등)</strong></p>
<div class="sourceCode" id="cb22" style="background: #f1f3f5;"><pre class="sourceCode numberSource json number-lines code-with-copy"><code class="sourceCode json"><span id="cb22-1"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">{</span></span>
<span id="cb22-2">  <span class="dt" style="color: #AD0000;
background-color: null;
font-style: inherit;">"vectorQueries"</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">:</span> <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">[</span></span>
<span id="cb22-3">    <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">{</span></span>
<span id="cb22-4">      <span class="dt" style="color: #AD0000;
background-color: null;
font-style: inherit;">"kind"</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">:</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"text"</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">,</span></span>
<span id="cb22-5">      <span class="dt" style="color: #AD0000;
background-color: null;
font-style: inherit;">"text"</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">:</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"azure machine learning"</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">,</span></span>
<span id="cb22-6">      <span class="dt" style="color: #AD0000;
background-color: null;
font-style: inherit;">"fields"</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">:</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"titleVector"</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">,</span></span>
<span id="cb22-7">      <span class="dt" style="color: #AD0000;
background-color: null;
font-style: inherit;">"k"</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">:</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">50</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">,</span></span>
<span id="cb22-8">      <span class="dt" style="color: #AD0000;
background-color: null;
font-style: inherit;">"weight"</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">:</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">0</span><span class="er" style="color: #AD0000;
background-color: null;
font-style: inherit;">.</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">5</span></span>
<span id="cb22-9">    <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">}</span><span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">,</span></span>
<span id="cb22-10">    <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">{</span></span>
<span id="cb22-11">      <span class="dt" style="color: #AD0000;
background-color: null;
font-style: inherit;">"kind"</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">:</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"text"</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">,</span></span>
<span id="cb22-12">      <span class="dt" style="color: #AD0000;
background-color: null;
font-style: inherit;">"text"</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">:</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"azure machine learning"</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">,</span></span>
<span id="cb22-13">      <span class="dt" style="color: #AD0000;
background-color: null;
font-style: inherit;">"fields"</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">:</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"contentVector"</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">,</span></span>
<span id="cb22-14">      <span class="dt" style="color: #AD0000;
background-color: null;
font-style: inherit;">"k"</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">:</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">50</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">,</span></span>
<span id="cb22-15">      <span class="dt" style="color: #AD0000;
background-color: null;
font-style: inherit;">"weight"</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">:</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">0</span><span class="er" style="color: #AD0000;
background-color: null;
font-style: inherit;">.</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">3</span></span>
<span id="cb22-16">    <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">}</span><span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">,</span></span>
<span id="cb22-17">    <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">{</span></span>
<span id="cb22-18">      <span class="dt" style="color: #AD0000;
background-color: null;
font-style: inherit;">"kind"</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">:</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"text"</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">,</span></span>
<span id="cb22-19">      <span class="dt" style="color: #AD0000;
background-color: null;
font-style: inherit;">"text"</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">:</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"azure machine learning"</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">,</span></span>
<span id="cb22-20">      <span class="dt" style="color: #AD0000;
background-color: null;
font-style: inherit;">"fields"</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">:</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"abstractVector"</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">,</span></span>
<span id="cb22-21">      <span class="dt" style="color: #AD0000;
background-color: null;
font-style: inherit;">"k"</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">:</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">50</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">,</span></span>
<span id="cb22-22">      <span class="dt" style="color: #AD0000;
background-color: null;
font-style: inherit;">"weight"</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">:</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">0</span><span class="er" style="color: #AD0000;
background-color: null;
font-style: inherit;">.</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">2</span></span>
<span id="cb22-23">    <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">}</span></span>
<span id="cb22-24">  <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">]</span></span>
<span id="cb22-25"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">}</span></span></code></pre></div>
<p><strong>실험적 성능 (학술 논문 검색)</strong><br>
- 단일 필드 (content only): NDCG@10 = 0.42<br>
- 다중 필드 (title + content + abstract): NDCG@10 = 0.51 (+21%)</p>
<p><strong>멀티모달 검색</strong></p>
<div class="sourceCode" id="cb23" style="background: #f1f3f5;"><pre class="sourceCode numberSource json number-lines code-with-copy"><code class="sourceCode json"><span id="cb23-1"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">{</span></span>
<span id="cb23-2">  <span class="dt" style="color: #AD0000;
background-color: null;
font-style: inherit;">"fields"</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">:</span> <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">[</span></span>
<span id="cb23-3">    <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">{</span></span>
<span id="cb23-4">      <span class="dt" style="color: #AD0000;
background-color: null;
font-style: inherit;">"name"</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">:</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"textVector"</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">,</span></span>
<span id="cb23-5">      <span class="dt" style="color: #AD0000;
background-color: null;
font-style: inherit;">"type"</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">:</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Collection(Edm.Single)"</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">,</span></span>
<span id="cb23-6">      <span class="dt" style="color: #AD0000;
background-color: null;
font-style: inherit;">"dimensions"</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">:</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1536</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">,</span></span>
<span id="cb23-7">      <span class="dt" style="color: #AD0000;
background-color: null;
font-style: inherit;">"vectorSearchProfile"</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">:</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"text-profile"</span></span>
<span id="cb23-8">    <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">}</span><span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">,</span></span>
<span id="cb23-9">    <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">{</span></span>
<span id="cb23-10">      <span class="dt" style="color: #AD0000;
background-color: null;
font-style: inherit;">"name"</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">:</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"imageVector"</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">,</span></span>
<span id="cb23-11">      <span class="dt" style="color: #AD0000;
background-color: null;
font-style: inherit;">"type"</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">:</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Collection(Edm.Single)"</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">,</span></span>
<span id="cb23-12">      <span class="dt" style="color: #AD0000;
background-color: null;
font-style: inherit;">"dimensions"</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">:</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1024</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">,</span></span>
<span id="cb23-13">      <span class="dt" style="color: #AD0000;
background-color: null;
font-style: inherit;">"vectorSearchProfile"</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">:</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"image-profile"</span></span>
<span id="cb23-14">    <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">}</span></span>
<span id="cb23-15">  <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">]</span></span>
<span id="cb23-16"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">}</span></span></code></pre></div>
<p><strong>크로스 모달 쿼리</strong></p>
<div class="sourceCode" id="cb24" style="background: #f1f3f5;"><pre class="sourceCode numberSource json number-lines code-with-copy"><code class="sourceCode json"><span id="cb24-1"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">{</span></span>
<span id="cb24-2">  <span class="dt" style="color: #AD0000;
background-color: null;
font-style: inherit;">"vectorQueries"</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">:</span> <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">[</span></span>
<span id="cb24-3">    <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">{</span></span>
<span id="cb24-4">      <span class="dt" style="color: #AD0000;
background-color: null;
font-style: inherit;">"kind"</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">:</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"text"</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">,</span></span>
<span id="cb24-5">      <span class="dt" style="color: #AD0000;
background-color: null;
font-style: inherit;">"text"</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">:</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"red sports car"</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">,</span></span>
<span id="cb24-6">      <span class="dt" style="color: #AD0000;
background-color: null;
font-style: inherit;">"fields"</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">:</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"textVector,imageVector"</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">,</span></span>
<span id="cb24-7">      <span class="dt" style="color: #AD0000;
background-color: null;
font-style: inherit;">"k"</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">:</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">50</span></span>
<span id="cb24-8">    <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">}</span></span>
<span id="cb24-9">  <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">]</span></span>
<span id="cb24-10"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">}</span></span></code></pre></div>
<p><strong>다국어 검색</strong></p>
<div class="sourceCode" id="cb25" style="background: #f1f3f5;"><pre class="sourceCode numberSource json number-lines code-with-copy"><code class="sourceCode json"><span id="cb25-1"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">{</span></span>
<span id="cb25-2">  <span class="dt" style="color: #AD0000;
background-color: null;
font-style: inherit;">"fields"</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">:</span> <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">[</span></span>
<span id="cb25-3">    <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">{</span></span>
<span id="cb25-4">      <span class="dt" style="color: #AD0000;
background-color: null;
font-style: inherit;">"name"</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">:</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"englishVector"</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">,</span></span>
<span id="cb25-5">      <span class="dt" style="color: #AD0000;
background-color: null;
font-style: inherit;">"type"</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">:</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Collection(Edm.Single)"</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">,</span></span>
<span id="cb25-6">      <span class="dt" style="color: #AD0000;
background-color: null;
font-style: inherit;">"dimensions"</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">:</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1024</span></span>
<span id="cb25-7">    <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">}</span><span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">,</span></span>
<span id="cb25-8">    <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">{</span></span>
<span id="cb25-9">      <span class="dt" style="color: #AD0000;
background-color: null;
font-style: inherit;">"name"</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">:</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"koreanVector"</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">,</span></span>
<span id="cb25-10">      <span class="dt" style="color: #AD0000;
background-color: null;
font-style: inherit;">"type"</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">:</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Collection(Edm.Single)"</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">,</span></span>
<span id="cb25-11">      <span class="dt" style="color: #AD0000;
background-color: null;
font-style: inherit;">"dimensions"</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">:</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1024</span></span>
<span id="cb25-12">    <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">}</span></span>
<span id="cb25-13">  <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">]</span></span>
<span id="cb25-14"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">}</span></span></code></pre></div>
</section>
<section id="벡터-필드-설계-best-practices" class="level3" data-number="1.5.2">
<h3 data-number="1.5.2" class="anchored" data-anchor-id="벡터-필드-설계-best-practices"><span class="header-section-number">1.5.2</span> 벡터 필드 설계 Best Practices</h3>
<p><strong>메모리 최적화</strong></p>
<div class="sourceCode" id="cb26" style="background: #f1f3f5;"><pre class="sourceCode numberSource python number-lines code-with-copy"><code class="sourceCode python"><span id="cb26-1">memory_per_doc <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> <span class="bu" style="color: null;
background-color: null;
font-style: inherit;">sum</span>([</span>
<span id="cb26-2">    dim_1 <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">*</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">4</span>,</span>
<span id="cb26-3">    dim_2 <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">*</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">4</span>,</span>
<span id="cb26-4">    ...</span>
<span id="cb26-5">])</span>
<span id="cb26-6"></span>
<span id="cb26-7">total_memory <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> num_docs <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">*</span> memory_per_doc <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">*</span> overhead_factor</span></code></pre></div>
<p><strong>예시 (1M 문서)</strong><br>
- 단일 1536-dim: 1M × 1536 × 4 × 2.5 ≈ 15GB<br>
- 3개 1024-dim: 1M × 3 × 1024 × 4 × 2.5 ≈ 30GB</p>
<p><strong>권장사항</strong><br>
1. 차원 최소화: <code>text-embedding-3-large</code>의 <code>dimensions</code> 파라미터 활용<br>
2. 선택적 필드: 모든 문서에 모든 벡터 필드 불필요<br>
3. 압축: Azure Search는 자동 압축 (실제 메모리는 계산치의 60-70%)</p>
<p><strong>인덱싱 시간 영향</strong><br>
- 단일 벡터 필드: 1M 문서 기준 30분<br>
- 3개 벡터 필드: 1M 문서 기준 75분 (2.5배)</p>
</section>
</section>
<section id="고급-vector-search-패턴" class="level2" data-number="1.6">
<h2 data-number="1.6" class="anchored" data-anchor-id="고급-vector-search-패턴"><span class="header-section-number">1.6</span> 고급 Vector Search 패턴</h2>
<section id="semantic-hybrid-search-triple-fusion" class="level3" data-number="1.6.1">
<h3 data-number="1.6.1" class="anchored" data-anchor-id="semantic-hybrid-search-triple-fusion"><span class="header-section-number">1.6.1</span> Semantic Hybrid Search (Triple Fusion)</h3>
<p><strong>텍스트 + 벡터 + 시맨틱 결합</strong></p>
<div class="sourceCode" id="cb27" style="background: #f1f3f5;"><pre class="sourceCode numberSource json number-lines code-with-copy"><code class="sourceCode json"><span id="cb27-1"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">{</span></span>
<span id="cb27-2">  <span class="dt" style="color: #AD0000;
background-color: null;
font-style: inherit;">"search"</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">:</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"how to optimize azure search"</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">,</span></span>
<span id="cb27-3">  <span class="dt" style="color: #AD0000;
background-color: null;
font-style: inherit;">"vectorQueries"</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">:</span> <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">[</span></span>
<span id="cb27-4">    <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">{</span></span>
<span id="cb27-5">      <span class="dt" style="color: #AD0000;
background-color: null;
font-style: inherit;">"kind"</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">:</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"text"</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">,</span></span>
<span id="cb27-6">      <span class="dt" style="color: #AD0000;
background-color: null;
font-style: inherit;">"text"</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">:</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"how to optimize azure search"</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">,</span></span>
<span id="cb27-7">      <span class="dt" style="color: #AD0000;
background-color: null;
font-style: inherit;">"fields"</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">:</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"contentVector"</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">,</span></span>
<span id="cb27-8">      <span class="dt" style="color: #AD0000;
background-color: null;
font-style: inherit;">"k"</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">:</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">50</span></span>
<span id="cb27-9">    <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">}</span></span>
<span id="cb27-10">  <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">]</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">,</span></span>
<span id="cb27-11">  <span class="dt" style="color: #AD0000;
background-color: null;
font-style: inherit;">"queryType"</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">:</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"semantic"</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">,</span></span>
<span id="cb27-12">  <span class="dt" style="color: #AD0000;
background-color: null;
font-style: inherit;">"semanticConfiguration"</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">:</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"default"</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">,</span></span>
<span id="cb27-13">  <span class="dt" style="color: #AD0000;
background-color: null;
font-style: inherit;">"top"</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">:</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">10</span></span>
<span id="cb27-14"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">}</span></span></code></pre></div>
<p><strong>3단계 융합</strong></p>
<pre><code>1. BM25 Text Search → Score_text
   ↓
2. Vector Search (HNSW) → Score_vector
   ↓
3. RRF Fusion → Combined_score
   ↓
4. Semantic Reranking (Top 50) → Final_score</code></pre>
<p><strong>실험적 성능 (MS MARCO)</strong><br>
- BM25 only: NDCG@10 = 0.32<br>
- Vector only: NDCG@10 = 0.38<br>
- Hybrid (BM25 + Vector): NDCG@10 = 0.46<br>
- Triple (BM25 + Vector + Semantic): NDCG@10 = 0.54 (+69% vs BM25)</p>
</section>
<section id="filtered-multi-vector-search" class="level3" data-number="1.6.2">
<h3 data-number="1.6.2" class="anchored" data-anchor-id="filtered-multi-vector-search"><span class="header-section-number">1.6.2</span> Filtered Multi-Vector Search</h3>
<p><strong>복잡한 필터링 + 다중 벡터</strong></p>
<div class="sourceCode" id="cb29" style="background: #f1f3f5;"><pre class="sourceCode numberSource json number-lines code-with-copy"><code class="sourceCode json"><span id="cb29-1"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">{</span></span>
<span id="cb29-2">  <span class="dt" style="color: #AD0000;
background-color: null;
font-style: inherit;">"vectorQueries"</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">:</span> <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">[</span></span>
<span id="cb29-3">    <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">{</span></span>
<span id="cb29-4">      <span class="dt" style="color: #AD0000;
background-color: null;
font-style: inherit;">"kind"</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">:</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"text"</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">,</span></span>
<span id="cb29-5">      <span class="dt" style="color: #AD0000;
background-color: null;
font-style: inherit;">"text"</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">:</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"machine learning optimization"</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">,</span></span>
<span id="cb29-6">      <span class="dt" style="color: #AD0000;
background-color: null;
font-style: inherit;">"fields"</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">:</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"titleVector"</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">,</span></span>
<span id="cb29-7">      <span class="dt" style="color: #AD0000;
background-color: null;
font-style: inherit;">"k"</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">:</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">50</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">,</span></span>
<span id="cb29-8">      <span class="dt" style="color: #AD0000;
background-color: null;
font-style: inherit;">"weight"</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">:</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">0</span><span class="er" style="color: #AD0000;
background-color: null;
font-style: inherit;">.</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">6</span></span>
<span id="cb29-9">    <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">}</span><span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">,</span></span>
<span id="cb29-10">    <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">{</span></span>
<span id="cb29-11">      <span class="dt" style="color: #AD0000;
background-color: null;
font-style: inherit;">"kind"</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">:</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"text"</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">,</span></span>
<span id="cb29-12">      <span class="dt" style="color: #AD0000;
background-color: null;
font-style: inherit;">"text"</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">:</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"machine learning optimization"</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">,</span></span>
<span id="cb29-13">      <span class="dt" style="color: #AD0000;
background-color: null;
font-style: inherit;">"fields"</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">:</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"contentVector"</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">,</span></span>
<span id="cb29-14">      <span class="dt" style="color: #AD0000;
background-color: null;
font-style: inherit;">"k"</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">:</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">50</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">,</span></span>
<span id="cb29-15">      <span class="dt" style="color: #AD0000;
background-color: null;
font-style: inherit;">"weight"</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">:</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">0</span><span class="er" style="color: #AD0000;
background-color: null;
font-style: inherit;">.</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">4</span></span>
<span id="cb29-16">    <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">}</span></span>
<span id="cb29-17">  <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">]</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">,</span></span>
<span id="cb29-18">  <span class="dt" style="color: #AD0000;
background-color: null;
font-style: inherit;">"filter"</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">:</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"(category eq 'AI' or category eq 'ML') and publishDate ge 2023-01-01 and citations ge 10"</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">,</span></span>
<span id="cb29-19">  <span class="dt" style="color: #AD0000;
background-color: null;
font-style: inherit;">"vectorFilterMode"</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">:</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"preFilter"</span></span>
<span id="cb29-20"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">}</span></span></code></pre></div>
<p><strong>실행 시간 분석 (1M 문서)</strong><br>
- Filter execution: 50ms (90% 제거 → 100K 문서)<br>
- Vector search (titleVector): 15ms<br>
- Vector search (contentVector): 15ms<br>
- RRF fusion: 5ms<br>
- Total: 85ms</p>
</section>
</section>
<section id="성능-최적화-전략" class="level2" data-number="1.7">
<h2 data-number="1.7" class="anchored" data-anchor-id="성능-최적화-전략"><span class="header-section-number">1.7</span> 성능 최적화 전략</h2>
<section id="hnsw-파라미터-튜닝" class="level3" data-number="1.7.1">
<h3 data-number="1.7.1" class="anchored" data-anchor-id="hnsw-파라미터-튜닝"><span class="header-section-number">1.7.1</span> HNSW 파라미터 튜닝</h3>
<p><strong>고처리량 시스템 (&gt;1000 QPS)</strong></p>
<div class="sourceCode" id="cb30" style="background: #f1f3f5;"><pre class="sourceCode numberSource json number-lines code-with-copy"><code class="sourceCode json"><span id="cb30-1"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">{</span></span>
<span id="cb30-2">  <span class="dt" style="color: #AD0000;
background-color: null;
font-style: inherit;">"algorithmConfigurations"</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">:</span> <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">[</span></span>
<span id="cb30-3">    <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">{</span></span>
<span id="cb30-4">      <span class="dt" style="color: #AD0000;
background-color: null;
font-style: inherit;">"name"</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">:</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"high-throughput-config"</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">,</span></span>
<span id="cb30-5">      <span class="dt" style="color: #AD0000;
background-color: null;
font-style: inherit;">"kind"</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">:</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"hnsw"</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">,</span></span>
<span id="cb30-6">      <span class="dt" style="color: #AD0000;
background-color: null;
font-style: inherit;">"hnswParameters"</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">:</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">{</span></span>
<span id="cb30-7">        <span class="dt" style="color: #AD0000;
background-color: null;
font-style: inherit;">"m"</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">:</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">4</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">,</span></span>
<span id="cb30-8">        <span class="dt" style="color: #AD0000;
background-color: null;
font-style: inherit;">"efConstruction"</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">:</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">200</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">,</span></span>
<span id="cb30-9">        <span class="dt" style="color: #AD0000;
background-color: null;
font-style: inherit;">"efSearch"</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">:</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">200</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">,</span></span>
<span id="cb30-10">        <span class="dt" style="color: #AD0000;
background-color: null;
font-style: inherit;">"metric"</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">:</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"cosine"</span></span>
<span id="cb30-11">      <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">}</span></span>
<span id="cb30-12">    <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">}</span></span>
<span id="cb30-13">  <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">]</span></span>
<span id="cb30-14"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">}</span></span></code></pre></div>
<p><strong>고정확도 시스템 (의료, 법률)</strong></p>
<div class="sourceCode" id="cb31" style="background: #f1f3f5;"><pre class="sourceCode numberSource json number-lines code-with-copy"><code class="sourceCode json"><span id="cb31-1"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">{</span></span>
<span id="cb31-2">  <span class="dt" style="color: #AD0000;
background-color: null;
font-style: inherit;">"algorithmConfigurations"</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">:</span> <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">[</span></span>
<span id="cb31-3">    <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">{</span></span>
<span id="cb31-4">      <span class="dt" style="color: #AD0000;
background-color: null;
font-style: inherit;">"name"</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">:</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"high-accuracy-config"</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">,</span></span>
<span id="cb31-5">      <span class="dt" style="color: #AD0000;
background-color: null;
font-style: inherit;">"kind"</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">:</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"hnsw"</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">,</span></span>
<span id="cb31-6">      <span class="dt" style="color: #AD0000;
background-color: null;
font-style: inherit;">"hnswParameters"</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">:</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">{</span></span>
<span id="cb31-7">        <span class="dt" style="color: #AD0000;
background-color: null;
font-style: inherit;">"m"</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">:</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">8</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">,</span></span>
<span id="cb31-8">        <span class="dt" style="color: #AD0000;
background-color: null;
font-style: inherit;">"efConstruction"</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">:</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">800</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">,</span></span>
<span id="cb31-9">        <span class="dt" style="color: #AD0000;
background-color: null;
font-style: inherit;">"efSearch"</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">:</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">800</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">,</span></span>
<span id="cb31-10">        <span class="dt" style="color: #AD0000;
background-color: null;
font-style: inherit;">"metric"</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">:</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"cosine"</span></span>
<span id="cb31-11">      <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">}</span></span>
<span id="cb31-12">    <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">}</span></span>
<span id="cb31-13">  <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">]</span></span>
<span id="cb31-14"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">}</span></span></code></pre></div>
</section>
<section id="차원-최적화" class="level3" data-number="1.7.2">
<h3 data-number="1.7.2" class="anchored" data-anchor-id="차원-최적화"><span class="header-section-number">1.7.2</span> 차원 최적화</h3>
<p><strong>PCA 기반 차원 축소 (text-embedding-3)</strong></p>
<div class="sourceCode" id="cb32" style="background: #f1f3f5;"><pre class="sourceCode numberSource python number-lines code-with-copy"><code class="sourceCode python"><span id="cb32-1">embedding <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> openai.Embedding.create(</span>
<span id="cb32-2">    <span class="bu" style="color: null;
background-color: null;
font-style: inherit;">input</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"text"</span>,</span>
<span id="cb32-3">    model<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"text-embedding-3-large"</span>,</span>
<span id="cb32-4">    dimensions<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1024</span></span>
<span id="cb32-5">)</span></code></pre></div>
<p><strong>성능 트레이드오프 분석</strong></p>
<table class="table">
<thead>
<tr class="header">
<th>차원</th>
<th>정확도 (MTEB)</th>
<th>메모리</th>
<th>쿼리 시간</th>
<th>인덱싱 시간</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td>3072</td>
<td>1.00 (baseline)</td>
<td>1.0x</td>
<td>1.0x</td>
<td>1.0x</td>
</tr>
<tr class="even">
<td>1536</td>
<td>0.98 (-2%)</td>
<td>0.5x</td>
<td>0.7x</td>
<td>0.7x</td>
</tr>
<tr class="odd">
<td>1024</td>
<td>0.97 (-3%)</td>
<td>0.33x</td>
<td>0.5x</td>
<td>0.5x</td>
</tr>
<tr class="even">
<td>512</td>
<td>0.95 (-5%)</td>
<td>0.17x</td>
<td>0.3x</td>
<td>0.3x</td>
</tr>
</tbody>
</table>
<p><strong>권장 전략</strong><br>
- 프로토타입/개발: 512-dim (빠른 반복)<br>
- 프로덕션 (일반): 1024-dim (균형)<br>
- 프로덕션 (고정확도): 1536-3072-dim</p>
</section>
<section id="배치-처리-최적화" class="level3" data-number="1.7.3">
<h3 data-number="1.7.3" class="anchored" data-anchor-id="배치-처리-최적화"><span class="header-section-number">1.7.3</span> 배치 처리 최적화</h3>
<p><strong>인덱싱 배치 크기</strong></p>
<div class="sourceCode" id="cb33" style="background: #f1f3f5;"><pre class="sourceCode numberSource json number-lines code-with-copy"><code class="sourceCode json"><span id="cb33-1"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">{</span></span>
<span id="cb33-2">  <span class="dt" style="color: #AD0000;
background-color: null;
font-style: inherit;">"parameters"</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">:</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">{</span></span>
<span id="cb33-3">    <span class="dt" style="color: #AD0000;
background-color: null;
font-style: inherit;">"batchSize"</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">:</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">100</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">,</span></span>
<span id="cb33-4">    <span class="dt" style="color: #AD0000;
background-color: null;
font-style: inherit;">"configuration"</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">:</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">{</span></span>
<span id="cb33-5">      <span class="dt" style="color: #AD0000;
background-color: null;
font-style: inherit;">"parsingMode"</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">:</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"json"</span></span>
<span id="cb33-6">    <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">}</span></span>
<span id="cb33-7">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">}</span></span>
<span id="cb33-8"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">}</span></span></code></pre></div>
<p><strong>최적 배치 크기 결정</strong></p>
<div class="sourceCode" id="cb34" style="background: #f1f3f5;"><pre class="sourceCode numberSource python number-lines code-with-copy"><code class="sourceCode python"><span id="cb34-1">optimal_batch_size <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> <span class="bu" style="color: null;
background-color: null;
font-style: inherit;">min</span>(</span>
<span id="cb34-2">    <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1000</span>,</span>
<span id="cb34-3">    <span class="bu" style="color: null;
background-color: null;
font-style: inherit;">max</span>(<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">10</span>, available_memory_mb <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">/</span> (vector_dim <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">*</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">4</span> <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">*</span> <span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">2.5</span> <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">/</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1024</span>))</span>
<span id="cb34-4">)</span></code></pre></div>
<p><strong>실험 결과 (1M 문서, 1536-dim)</strong><br>
- batchSize=10: 120분 (안정적, 메모리 부족 위험 낮음)<br>
- batchSize=100: 50분 (권장)<br>
- batchSize=500: 35분 (고성능 티어)<br>
- batchSize=1000: 30분 (메모리 부족 위험)</p>
</section>
</section>
<section id="실무-아키텍처-패턴" class="level2" data-number="1.8">
<h2 data-number="1.8" class="anchored" data-anchor-id="실무-아키텍처-패턴"><span class="header-section-number">1.8</span> 실무 아키텍처 패턴</h2>
<section id="rag-retrieval-augmented-generation-파이프라인" class="level3" data-number="1.8.1">
<h3 data-number="1.8.1" class="anchored" data-anchor-id="rag-retrieval-augmented-generation-파이프라인"><span class="header-section-number">1.8.1</span> RAG (Retrieval-Augmented Generation) 파이프라인</h3>
<p><strong>전체 플로우</strong></p>
<pre><code>User Query
  ↓
Query Embedding (Azure OpenAI)
  ↓
Vector Search (Top 10) + Text Search (Top 10)
  ↓
RRF Fusion → Top 5 documents
  ↓
Context Assembly (5 docs × 2KB = 10KB)
  ↓
LLM Prompt (GPT-4)
  ├─ System: "Answer based on context"
  ├─ Context: 10KB retrieved content
  └─ Query: User question
  ↓
Generated Answer</code></pre>
<p><strong>최적화 포인트</strong></p>
<p>Context Window 관리:<br>
- GPT-4 32K: 최대 25KB context<br>
- 권장: 5-10 documents × 2KB = 10-20KB</p>
<p>Reranking:<br>
- Vector search: Top 50<br>
- Semantic reranking: Top 10<br>
- LLM injection: Top 5</p>
<p>Caching:<br>
- Query embedding cache (Redis)<br>
- Search result cache (15분 TTL)</p>
<p><strong>성능 벤치마크 (전체 E2E)</strong><br>
- Vector search: 20ms<br>
- Text search: 30ms<br>
- RRF fusion: 5ms<br>
- Semantic reranking: 200ms<br>
- LLM generation: 2000ms<br>
- Total: 약 2.3초</p>
</section>
<section id="멀티테넌트-벡터-검색" class="level3" data-number="1.8.2">
<h3 data-number="1.8.2" class="anchored" data-anchor-id="멀티테넌트-벡터-검색"><span class="header-section-number">1.8.2</span> 멀티테넌트 벡터 검색</h3>
<p><strong>테넌트 격리 전략</strong></p>
<p><strong>옵션 1: 단일 인덱스 + 필터</strong></p>
<div class="sourceCode" id="cb36" style="background: #f1f3f5;"><pre class="sourceCode numberSource json number-lines code-with-copy"><code class="sourceCode json"><span id="cb36-1"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">{</span></span>
<span id="cb36-2">  <span class="dt" style="color: #AD0000;
background-color: null;
font-style: inherit;">"vectorQueries"</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">:</span> <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">[</span></span>
<span id="cb36-3">    <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">{</span></span>
<span id="cb36-4">      <span class="dt" style="color: #AD0000;
background-color: null;
font-style: inherit;">"kind"</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">:</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"text"</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">,</span></span>
<span id="cb36-5">      <span class="dt" style="color: #AD0000;
background-color: null;
font-style: inherit;">"text"</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">:</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"project status"</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">,</span></span>
<span id="cb36-6">      <span class="dt" style="color: #AD0000;
background-color: null;
font-style: inherit;">"fields"</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">:</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"contentVector"</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">,</span></span>
<span id="cb36-7">      <span class="dt" style="color: #AD0000;
background-color: null;
font-style: inherit;">"k"</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">:</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">50</span></span>
<span id="cb36-8">    <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">}</span></span>
<span id="cb36-9">  <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">]</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">,</span></span>
<span id="cb36-10">  <span class="dt" style="color: #AD0000;
background-color: null;
font-style: inherit;">"filter"</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">:</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"tenantId eq 'tenant-abc-123'"</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">,</span></span>
<span id="cb36-11">  <span class="dt" style="color: #AD0000;
background-color: null;
font-style: inherit;">"vectorFilterMode"</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">:</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"preFilter"</span></span>
<span id="cb36-12"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">}</span></span></code></pre></div>
<p>장점: 단순, 비용 효율적<br>
단점: 테넌트 간 성능 영향, 보안 위험</p>
<p><strong>옵션 2: 테넌트별 인덱스</strong></p>
<pre><code>index-tenant-abc-123
index-tenant-def-456
index-tenant-ghi-789</code></pre>
<p>장점: 완전 격리, 독립 최적화<br>
단점: 관리 복잡도, 비용 증가</p>
<p><strong>권장 전략 (테넌트 수 기준)</strong><br>
- &lt; 10 테넌트: 옵션 2 (인덱스 분리)<br>
- 10-100 테넌트: 옵션 1 (필터 기반)<br>
- &gt; 100 테넌트: Hybrid (대형 테넌트 분리, 소형 통합)</p>
</section>
<section id="실시간-벡터-업데이트" class="level3" data-number="1.8.3">
<h3 data-number="1.8.3" class="anchored" data-anchor-id="실시간-벡터-업데이트"><span class="header-section-number">1.8.3</span> 실시간 벡터 업데이트</h3>
<p><strong>증분 인덱싱 패턴</strong></p>
<div class="sourceCode" id="cb38" style="background: #f1f3f5;"><pre class="sourceCode numberSource python number-lines code-with-copy"><code class="sourceCode python"><span id="cb38-1"><span class="kw" style="color: #003B4F;
background-color: null;
font-style: inherit;">def</span> on_document_update(doc_id, new_content):</span>
<span id="cb38-2">    embedding <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> get_embedding(new_content)</span>
<span id="cb38-3">    </span>
<span id="cb38-4">    search_client.merge_or_upload_documents([{</span>
<span id="cb38-5">        <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"id"</span>: doc_id,</span>
<span id="cb38-6">        <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"content"</span>: new_content,</span>
<span id="cb38-7">        <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"contentVector"</span>: embedding</span>
<span id="cb38-8">    }])</span></code></pre></div>
<p><strong>처리량 제한 (Standard S1)</strong><br>
- 초당 최대 1,000 documents<br>
- 배치 크기: 최대 1,000 documents/request</p>
<p><strong>실시간 업데이트 지연</strong><br>
- 문서 업로드: 평균 50ms<br>
- 인덱스 반영: 평균 1-5초 (eventual consistency)<br>
- 쿼리 가시성: 최대 10초</p>
</section>
</section>
<section id="비용-최적화-전략" class="level2" data-number="1.9">
<h2 data-number="1.9" class="anchored" data-anchor-id="비용-최적화-전략"><span class="header-section-number">1.9</span> 비용 최적화 전략</h2>
<section id="벡터-임베딩-비용" class="level3" data-number="1.9.1">
<h3 data-number="1.9.1" class="anchored" data-anchor-id="벡터-임베딩-비용"><span class="header-section-number">1.9.1</span> 벡터 임베딩 비용</h3>
<p><strong>Azure OpenAI 비용 계산</strong></p>
<div class="sourceCode" id="cb39" style="background: #f1f3f5;"><pre class="sourceCode numberSource python number-lines code-with-copy"><code class="sourceCode python"><span id="cb39-1">total_tokens <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1_000_000</span> <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">*</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">500</span> <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">500</span><span class="er" style="color: #AD0000;
background-color: null;
font-style: inherit;">M</span> tokens</span>
<span id="cb39-2"></span>
<span id="cb39-3">embedding_cost <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">500</span> <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">*</span> <span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">0.13</span> <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> $<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">65</span></span>
<span id="cb39-4">embedding_cost_small <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">500</span> <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">*</span> <span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">0.02</span> <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> $<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">10</span></span></code></pre></div>
</section>
<section id="azure-search-스토리지-비용" class="level3" data-number="1.9.2">
<h3 data-number="1.9.2" class="anchored" data-anchor-id="azure-search-스토리지-비용"><span class="header-section-number">1.9.2</span> Azure Search 스토리지 비용</h3>
<p><strong>인덱스 크기 계산</strong></p>
<div class="sourceCode" id="cb40" style="background: #f1f3f5;"><pre class="sourceCode numberSource python number-lines code-with-copy"><code class="sourceCode python"><span id="cb40-1">vector_size_gb <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> (</span>
<span id="cb40-2">    num_docs <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">*</span> vector_dim <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">*</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">4</span> <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">*</span> overhead_factor</span>
<span id="cb40-3">) <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">/</span> (<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1024</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">**</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">3</span>)</span>
<span id="cb40-4"></span>
<span id="cb40-5">storage_size <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> (<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1_000_000</span> <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">*</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1536</span> <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">*</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">4</span> <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">*</span> <span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">2.5</span>) <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">/</span> (<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1024</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">**</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">3</span>)</span>
<span id="cb40-6">             ≈ <span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">14.3</span> GB</span></code></pre></div>
<p><strong>월 스토리지 비용 (Standard S1)</strong><br>
- 기본 25GB 포함<br>
- 초과 시: $0.40/GB/month<br>
- 14.3GB: $0 (기본 할당 내)</p>
</section>
<section id="총-소유-비용-tco-예시" class="level3" data-number="1.9.3">
<h3 data-number="1.9.3" class="anchored" data-anchor-id="총-소유-비용-tco-예시"><span class="header-section-number">1.9.3</span> 총 소유 비용 (TCO) 예시</h3>
<p><strong>시나리오</strong>: 1M 문서, 10K queries/day</p>
<p><strong>초기 비용</strong><br>
- Embedding 생성 (3-large): $65<br>
- 인덱싱: $0 (S1 할당 내)<br>
- Total: $65</p>
<p><strong>월 운영 비용</strong><br>
- Azure Search S1: $250/month<br>
- Semantic Search (optional): $500/month<br>
- 스토리지 (14.3GB): $0/month<br>
- Total: $250-$750/month</p>
<p><strong>연간 TCO</strong><br>
- 초기: $65<br>
- 운영: $3,000-$9,000<br>
- Total: $3,065-$9,065</p>
</section>
</section>
<section id="증거의-강도-및-한계" class="level2" data-number="1.10">
<h2 data-number="1.10" class="anchored" data-anchor-id="증거의-강도-및-한계"><span class="header-section-number">1.10</span> 증거의 강도 및 한계</h2>
<section id="증거-출처" class="level3" data-number="1.10.1">
<h3 data-number="1.10.1" class="anchored" data-anchor-id="증거-출처"><span class="header-section-number">1.10.1</span> 증거 출처</h3>
<ul>
<li>Microsoft Learn 공식 문서: Vector Search API, HNSW 파라미터, 필터링 모드<br>
</li>
<li>MTEB (Massive Text Embedding Benchmark): 임베딩 모델 성능 평가 (2023)<br>
</li>
<li>MS MARCO: Microsoft Machine Reading Comprehension (검색 정확도 벤치마크)<br>
</li>
<li>Malkov &amp; Yashunin (2018): “Efficient and robust approximate nearest neighbor search using Hierarchical Navigable Small World graphs”</li>
</ul>
</section>
<section id="한계점" class="level3" data-number="1.10.2">
<h3 data-number="1.10.2" class="anchored" data-anchor-id="한계점"><span class="header-section-number">1.10.2</span> 한계점</h3>
<ul>
<li>성능 수치 변동성: 벤치마크는 특정 데이터셋 기준, 실제 성능은 ±30-50% 변동<br>
</li>
<li>필터링 모드 자동 선택: Azure의 휴리스틱 알고리즘 상세 비공개, 최적 선택 보장 불가<br>
</li>
<li>비용 예측: Fair use 정책 구체적 한계 불명확, 대규모 환경에서 실제 비용 변동 가능<br>
</li>
<li>HNSW 정확도: Recall@10 = 0.95는 평균값, 특정 쿼리에서 더 낮을 수 있음</li>
</ul>
</section>
<section id="대안-기술" class="level3" data-number="1.10.3">
<h3 data-number="1.10.3" class="anchored" data-anchor-id="대안-기술"><span class="header-section-number">1.10.3</span> 대안 기술</h3>
<p><strong>Pinecone</strong><br>
- Vector-native 설계<br>
- 더 간단한 API<br>
- 하이브리드 검색 제한적</p>
<p><strong>Weaviate</strong><br>
- 오픈소스 + 관리형 옵션<br>
- 강력한 GraphQL API<br>
- Azure 통합 약함</p>
<p><strong>Milvus</strong><br>
- 오픈소스, 고성능<br>
- Kubernetes 기반 배포<br>
- 관리 부담 높음</p>
<p><strong>Azure Cognitive Search 장점</strong><br>
- Azure 생태계 통합 (OpenAI, Vision)<br>
- Hybrid + Semantic 기본 지원<br>
- 완전 관리형 (인프라 관리 불필요)</p>
</section>
</section>
<section id="불확실성-영역" class="level2" data-number="1.11">
<h2 data-number="1.11" class="anchored" data-anchor-id="불확실성-영역"><span class="header-section-number">1.11</span> 불확실성 영역</h2>
<ul>
<li>대규모 환경 성능: 100M+ 문서 환경에서 실제 성능 데이터 제한적, 파티셔닝 전략 최적화 방법 불명확<br>
</li>
<li>Vectorizer 내부 동작: Query-time vectorization의 정확한 캐싱 전략 비공개, Rate limit 우회 메커니즘 불명확<br>
</li>
<li>필터링 성능 보장: preFilter 모드에서 그래프 재구성 비용 정량화 어려움, 복잡한 필터의 성능 상한선 미명시<br>
</li>
<li>Semantic Reranking + Vector: 두 기술 결합 시 정확한 상호작용 불명확, 최적 융합 가중치 자동 결정 알고리즘 비공개</li>
</ul>
</section>
<section id="실무-의사결정-가이드" class="level2" data-number="1.12">
<h2 data-number="1.12" class="anchored" data-anchor-id="실무-의사결정-가이드"><span class="header-section-number">1.12</span> 실무 의사결정 가이드</h2>
<section id="vector-search-도입-여부-판단" class="level3" data-number="1.12.1">
<h3 data-number="1.12.1" class="anchored" data-anchor-id="vector-search-도입-여부-판단"><span class="header-section-number">1.12.1</span> Vector Search 도입 여부 판단</h3>
<pre><code>검색 쿼리 특성?
├─ 키워드 정합 중심 (제품 ID, 정확한 매칭)
│  └─ BM25 only (벡터 불필요)
│
├─ 의미론적 이해 필요 (자연어 질문)
│  └─ Vector Search 도입
│     └─ 데이터 규모?
│        ├─ &lt; 100K docs → Exhaustive mode 고려
│        └─ &gt; 100K docs → HNSW 필수
│
└─ 하이브리드 (둘 다)
   └─ Hybrid Search (Text + Vector + Semantic)</code></pre>
</section>
<section id="filtering-전략-결정" class="level3" data-number="1.12.2">
<h3 data-number="1.12.2" class="anchored" data-anchor-id="filtering-전략-결정"><span class="header-section-number">1.12.2</span> Filtering 전략 결정</h3>
<pre><code>필터 선택도?
├─ &gt; 80% (매우 제한적)
│  └─ preFilter
│     예: tenantId eq 'rare-tenant'
│
├─ 20-80% (중간)
│  └─ auto (vectorFilterMode: null)
│     예: category in ('Tech', 'Science')
│
└─ &lt; 20% (느슨함)
   └─ postFilter
      예: inStock eq true (대부분 true)</code></pre>
</section>
<section id="embedding-모델-선택" class="level3" data-number="1.12.3">
<h3 data-number="1.12.3" class="anchored" data-anchor-id="embedding-모델-선택"><span class="header-section-number">1.12.3</span> Embedding 모델 선택</h3>
<pre><code>요구사항?
├─ 저비용 우선
│  └─ text-embedding-3-small (512-dim)
│
├─ 고정확도 필요
│  └─ text-embedding-3-large (1024-3072-dim)
│
└─ 레거시 호환
   └─ text-embedding-ada-002 (1536-dim)</code></pre>
</section>
</section>
<section id="참고-링크" class="level2" data-number="1.13">
<h2 data-number="1.13" class="anchored" data-anchor-id="참고-링크"><span class="header-section-number">1.13</span> 참고 링크</h2>
<section id="microsoft-learn-공식-문서" class="level3" data-number="1.13.1">
<h3 data-number="1.13.1" class="anchored" data-anchor-id="microsoft-learn-공식-문서"><span class="header-section-number">1.13.1</span> Microsoft Learn 공식 문서</h3>
<ul>
<li>https://learn.microsoft.com/en-us/azure/search/vector-search-overview<br>
</li>
<li>https://learn.microsoft.com/en-us/azure/search/vector-search-how-to-query<br>
</li>
<li>https://learn.microsoft.com/en-us/azure/search/vector-search-filters<br>
</li>
<li>https://learn.microsoft.com/en-us/azure/search/vector-search-how-to-configure-vectorizer<br>
</li>
<li>https://learn.microsoft.com/en-us/azure/search/vector-search-multi-vector-fields</li>
</ul>
</section>
<section id="학술-자료" class="level3" data-number="1.13.2">
<h3 data-number="1.13.2" class="anchored" data-anchor-id="학술-자료"><span class="header-section-number">1.13.2</span> 학술 자료</h3>
<ul>
<li>Malkov, Y. &amp; Yashunin, D. (2018). “Efficient and robust approximate nearest neighbor search using Hierarchical Navigable Small World graphs.” IEEE TPAMI<br>
</li>
<li>MTEB Leaderboard: https://huggingface.co/spaces/mteb/leaderboard<br>
</li>
<li>MS MARCO: https://microsoft.github.io/msmarco/</li>
</ul>


</section>
</section>
</section>

 ]]></description>
  <category>AI</category>
  <category>Cloud</category>
  <category>Azure</category>
  <guid>kk3225.netlify.app/docs/blog/posts/Engineering/Infra/Cloud/Azure/29-az-ai-search-classic-vector-search.html</guid>
  <pubDate>Mon, 22 Dec 2025 15:00:00 GMT</pubDate>
</item>
<item>
  <title>Azure Search — BM25(전통 검색) 개요</title>
  <dc:creator>Kwangmin Kim</dc:creator>
  <link>kk3225.netlify.app/docs/blog/posts/Engineering/Infra/Cloud/Azure/27-az-ai-search-classic-bm25.html</link>
  <description><![CDATA[ 





<section id="full-text-serach" class="level1" data-number="1">
<h1 data-number="1"><span class="header-section-number">1</span> Full text serach</h1>
<ul>
<li>Azure Search 쿼리 아키텍처 및 고급 검색 기능 분석</li>
</ul>
<section id="검색-알고리즘-유형-간단-정리" class="level2" data-number="1.1">
<h2 data-number="1.1" class="anchored" data-anchor-id="검색-알고리즘-유형-간단-정리"><span class="header-section-number">1.1</span> 검색 알고리즘 유형 간단 정리</h2>
<ul>
<li>BM25: 역색인과 용어 통계(TF/IDF 계열)를 사용해 키워드 매칭 기반으로 점수를 매긴다. 빠르고 해석 가능하며 후보 검색(initial retrieval)에 적합하다.<br>
</li>
<li>Vector Search: 문서와 쿼리를 고차원 벡터로 임베딩한 뒤 벡터 유사도(예: 코사인, L2)로 근접 이웃을 찾는다. 의미적 유사성(동의어, 패러프레이즈)을 잘 잡아낸다.<br>
</li>
<li>Semantic Search: Vector Search 또는 Transformer 기반 reranker를 포함하는 상위 개념으로, 의미적 이해를 활용해 결과를 재정렬하거나 직접 답변을 생성한다.<br>
</li>
<li>실무적 조합: 보통은 BM25로 넓게 후보를 뽑고(cheap), 그 중에서 vector/semantic로 정밀 평가한다 — 성능/비용 균형을 맞추는 표준 패턴.<br>
</li>
<li>장단점 비교: BM25는 저비용·저지연·해석 가능, vector는 의미성↑·비용↑·지연↑(특히 reranker 사용 시).</li>
</ul>
</section>
<section id="lucene-쿼리-아키텍처" class="level2" data-number="1.2">
<h2 data-number="1.2" class="anchored" data-anchor-id="lucene-쿼리-아키텍처"><span class="header-section-number">1.2</span> Lucene 쿼리 아키텍처</h2>
<section id="쿼리-실행-파이프라인" class="level3" data-number="1.2.1">
<h3 data-number="1.2.1" class="anchored" data-anchor-id="쿼리-실행-파이프라인"><span class="header-section-number">1.2.1</span> 쿼리 실행 파이프라인</h3>
<p><strong>전체 처리 플로우</strong></p>
<pre><code>Query String → Query Parser → Query Execution → Scoring → Ranking → Response
     ↓              ↓              ↓              ↓          ↓          ↓
"machine       Lucene AST      Index Scan    TF-IDF/BM25   Top-K      JSON Result
learning"      (Parse Tree)    (Inverted)    Calculation   Selection  Serialization</code></pre>
<ul>
<li>Lucene: Apache Lucene 검색 엔진 라이브러리(문서 토크나이즈·인덱싱·쿼리 파싱·스코어링(BM25) 제공).
<ul>
<li>Azure Search는 Lucene 계열 쿼리 문법/파서를 사용하거나 유사한 파싱·실행 방식을 쓴다.<br>
</li>
</ul></li>
<li>AST
<ul>
<li>AST는 ’코드 전용’이 아니라 ’문법을 가진 모든 입력’에 대해 만드는 파싱 결과다.<br>
</li>
<li>Lucene AST는 Lucene 쿼리 문법을 해석한 구조화된 트리이며, 자연어 쿼리는 문맥/설정에 따라 단순 토큰 리스트로 처리되거나(간단 쿼리), Lucene 구문을 포함하면 AST로 파싱된다.<br>
</li>
<li>쿼리 문법(grammar)을 파싱해서 만든 트리(구문 트리).</li>
<li>코드 전용이 아니라 어떤 형식의 문법(쿼리, 수식, 명령문 등)에도 적용된다.<br>
</li>
<li>쿼리 언어는 문법(grammar)을 가진 입력이다. 파서는 입력을 구문적으로 해석해서 의미 단위(노드: TERM, PHRASE, FIELD, AND, OR, NOT, FUZZY 등)를 가진 트리로 변환한다.<br>
</li>
<li>이 트리는 실행 엔진이 어떤 인덱스 연산(포스팅 리스트 읽기, 근접 검색, 필드별 매칭, 부울 결합 등)을 수행할지 결정하는 ’실행 계획’의 중간 표현이다.<br>
</li>
<li>즉 AST는 코드의 AST와 역할이 동일하다(입력 → 구조화된 표현 → 실행).<br>
</li>
</ul></li>
<li>자연어 쿼리와의 관계: 사용자가 자연어로 요청하면 시스템이 반드시 복잡한 Lucene AST를 만들지는 않는다.
<ul>
<li>간단 파서/토크나이저로 토큰(또는 문구)을 생성<br>
</li>
<li>또는, semantic pipeline일 경우에는 임베딩/벡터로 처리한다.<br>
</li>
<li>다만 Lucene 계열의 표현식(필드 지정, boolean, proximity 등)이 있으면 파서는 AST(또는 parse tree)를 만든다.</li>
</ul></li>
</ul>
<p><strong>Query Parser 종류</strong></p>
<table class="table">
<colgroup>
<col style="width: 30%">
<col style="width: 28%">
<col style="width: 25%">
<col style="width: 15%">
</colgroup>
<thead>
<tr class="header">
<th>Parser Type</th>
<th>구문 복잡도</th>
<th>사용 사례</th>
<th>예시</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td>Simple</td>
<td>낮음</td>
<td>자연어 검색, 일반 사용자</td>
<td><code>"machine learning" azure</code></td>
</tr>
<tr class="even">
<td>Full (Lucene)</td>
<td>높음</td>
<td>고급 쿼리, Boolean 로직</td>
<td><code>title:(azure AND search) OR content:indexer~2</code></td>
</tr>
<tr class="odd">
<td>Semantic</td>
<td>중간</td>
<td>의미론적 이해 필요</td>
<td><code>"how to optimize search performance"</code></td>
</tr>
</tbody>
</table>
</section>
<section id="lucene-full-syntax-지원-연산자" class="level3" data-number="1.2.2">
<h3 data-number="1.2.2" class="anchored" data-anchor-id="lucene-full-syntax-지원-연산자"><span class="header-section-number">1.2.2</span> Lucene Full Syntax 지원 연산자</h3>
<p><strong>Boolean 연산자</strong></p>
<div class="sourceCode" id="cb2" style="background: #f1f3f5;"><pre class="sourceCode numberSource lucene number-lines code-with-copy"><code class="sourceCode"><span id="cb2-1"># AND (교집합)</span>
<span id="cb2-2">azure AND search</span>
<span id="cb2-3"></span>
<span id="cb2-4"># OR (합집합)</span>
<span id="cb2-5">azure OR cognitive</span>
<span id="cb2-6"></span>
<span id="cb2-7"># NOT (차집합)</span>
<span id="cb2-8">azure NOT cosmos</span>
<span id="cb2-9"></span>
<span id="cb2-10"># Grouping</span>
<span id="cb2-11">(azure OR cognitive) AND (search OR ai)</span></code></pre></div>
<p><strong>필드별 검색</strong></p>
<div class="sourceCode" id="cb3" style="background: #f1f3f5;"><pre class="sourceCode numberSource lucene number-lines code-with-copy"><code class="sourceCode"><span id="cb3-1"># 특정 필드 검색</span>
<span id="cb3-2">title:azure</span>
<span id="cb3-3">content:"machine learning"</span>
<span id="cb3-4"></span>
<span id="cb3-5"># 복합 필드 검색</span>
<span id="cb3-6">title:(azure search) AND category:tutorial</span></code></pre></div>
<pre><code># 쿼리 1: title:azure
FIELD: title
└─ TERM: azure

# 쿼리 2: content:"machine learning"
FIELD: content
└─ PHRASE
    ├─ TOKEN: machine
    └─ TOKEN: learning

# 쿼리 3: title:(azure search) AND category:tutorial
AND
├─ GROUP
│   └─ FIELD: title
│       └─ GROUP_TOKENS
│           ├─ TERM: azure
│           └─ TERM: search
└─ FIELD: category
    └─ TERM: tutorial</code></pre>
<p><strong>Proximity 검색 (근접도)</strong></p>
<div class="sourceCode" id="cb5" style="background: #f1f3f5;"><pre class="sourceCode numberSource lucene number-lines code-with-copy"><code class="sourceCode"><span id="cb5-1"># "azure"와 "search"가 5단어 이내</span>
<span id="cb5-2">"azure search"~5</span>
<span id="cb5-3"></span>
<span id="cb5-4"># 순서 상관없이 근접</span>
<span id="cb5-5">"search azure"~5</span></code></pre></div>
<p><strong>Fuzzy 검색 (유사도)</strong></p>
<ul>
<li>fuzzy 검색은 사용자가 입력한 단어나 철자 오류(typo), 형태 변형을 허용해 유사한 단어들도 매칭하도록 하는 검색 방법</li>
<li>일반적으로 Levenshtein 편집 거리(edit distance)를 기준으로 ’몇 번의 문자 삽입/삭제/교체’로 동일 단어가 되는지 계산한다.</li>
</ul>
<div class="sourceCode" id="cb6" style="background: #f1f3f5;"><pre class="sourceCode numberSource lucene number-lines code-with-copy"><code class="sourceCode"><span id="cb6-1"># Edit distance = 1 (기본값)</span>
<span id="cb6-2">azur~</span>
<span id="cb6-3"></span>
<span id="cb6-4"># Edit distance = 2</span>
<span id="cb6-5">azur~2</span>
<span id="cb6-6"></span>
<span id="cb6-7"># Levenshtein distance 기반</span>
<span id="cb6-8"># azur → azure (1 edit)</span></code></pre></div>
<p><strong>Wildcard 검색</strong></p>
<div class="sourceCode" id="cb7" style="background: #f1f3f5;"><pre class="sourceCode numberSource lucene number-lines code-with-copy"><code class="sourceCode"><span id="cb7-1"># * : 0개 이상 문자</span>
<span id="cb7-2">azur*        # azure, azures, azuring</span>
<span id="cb7-3"></span>
<span id="cb7-4"># ? : 정확히 1개 문자</span>
<span id="cb7-5">azur?        # azure, azurs</span>
<span id="cb7-6"></span>
<span id="cb7-7"># 주의: 시작 wildcard는 성능 저하 (인덱스 전체 스캔)</span>
<span id="cb7-8">*zure        # 비권장</span></code></pre></div>
<p><strong>Range 검색</strong></p>
<div class="sourceCode" id="cb8" style="background: #f1f3f5;"><pre class="sourceCode numberSource lucene number-lines code-with-copy"><code class="sourceCode"><span id="cb8-1"># 숫자 범위</span>
<span id="cb8-2">price:[100 TO 500]</span>
<span id="cb8-3"></span>
<span id="cb8-4"># 날짜 범위</span>
<span id="cb8-5">publishDate:[2023-01-01 TO 2023-12-31]</span>
<span id="cb8-6"></span>
<span id="cb8-7"># 문자열 범위 (사전 순서)</span>
<span id="cb8-8">title:[a TO m]</span>
<span id="cb8-9"></span>
<span id="cb8-10"># Exclusive (경계 제외)</span>
<span id="cb8-11">price:{100 TO 500}</span></code></pre></div>
<p><strong>Boosting (가중치)</strong></p>
<div class="sourceCode" id="cb9" style="background: #f1f3f5;"><pre class="sourceCode numberSource lucene number-lines code-with-copy"><code class="sourceCode"><span id="cb9-1"># "azure"를 "search"보다 2배 중요하게</span>
<span id="cb9-2">azure^2 search</span>
<span id="cb9-3"></span>
<span id="cb9-4"># 필드별 가중치</span>
<span id="cb9-5">title:azure^3 content:azure</span></code></pre></div>
</section>
<section id="인덱스-구조-및-검색-알고리즘" class="level3" data-number="1.2.3">
<h3 data-number="1.2.3" class="anchored" data-anchor-id="인덱스-구조-및-검색-알고리즘"><span class="header-section-number">1.2.3</span> 인덱스 구조 및 검색 알고리즘</h3>
<p><strong>Inverted Index 구조</strong></p>
<pre><code>Term       | Document IDs  | Positions
-----------|---------------|----------
azure      | [1, 5, 8]     | [(1,0), (1,15), (5,3), ...]
search     | [1, 2, 5]     | [(1,1), (2,10), (5,4), ...]
cognitive  | [5, 8]        | [(5,12), (8,3)]</code></pre>
<p><strong>BM25 스코어링 공식 (Azure Search 기본 알고리즘)</strong></p>
<p><img src="https://latex.codecogs.com/png.latex?%5Ctext%7Bscore%7D(D,Q)%20=%20%5Csum_%7Bi=1%7D%5E%7Bn%7D%20%5Ctext%7BIDF%7D(q_i)%20%5Ccdot%20%5Cfrac%7Bf(q_i,%20D)%20%5Ccdot%20(k_1%20+%201)%7D%7Bf(q_i,%20D)%20+%20k_1%20%5Ccdot%20(1%20-%20b%20+%20b%20%5Ccdot%20%5Cfrac%7B%7CD%7C%7D%7B%5Ctext%7Bavgdl%7D%7D)%7D"></p>
<p>여기서:<br>
- <img src="https://latex.codecogs.com/png.latex?D">: 문서<br>
- <img src="https://latex.codecogs.com/png.latex?Q">: 쿼리<br>
- <img src="https://latex.codecogs.com/png.latex?q_i">: 쿼리 내 <img src="https://latex.codecogs.com/png.latex?i"> 번째 용어<br>
- <img src="https://latex.codecogs.com/png.latex?f(q_i,%20D)">: 문서 <img src="https://latex.codecogs.com/png.latex?D">에서 용어 <img src="https://latex.codecogs.com/png.latex?q_i">의 빈도<br>
- <img src="https://latex.codecogs.com/png.latex?%7CD%7C">: 문서 길이<br>
- <img src="https://latex.codecogs.com/png.latex?%5Ctext%7Bavgdl%7D">: 평균 문서 길이<br>
- <img src="https://latex.codecogs.com/png.latex?k_1">: 용어 빈도 포화 파라미터 (Azure Search 기본값: 1.2)<br>
- <img src="https://latex.codecogs.com/png.latex?b">: 길이 정규화 파라미터 (Azure Search 기본값: 0.75)</p>
<p><img src="https://latex.codecogs.com/png.latex?%5Ctext%7BIDF%7D(q_i)%20=%20%5Cln%5Cleft(%5Cfrac%7BN%20-%20n(q_i)%20+%200.5%7D%7Bn(q_i)%20+%200.5%7D%20+%201%5Cright)"></p>
<ul>
<li><img src="https://latex.codecogs.com/png.latex?N">: 전체 문서 수<br>
</li>
<li><img src="https://latex.codecogs.com/png.latex?n(q_i)">: 용어 <img src="https://latex.codecogs.com/png.latex?q_i">를 포함한 문서 수</li>
</ul>
<p>원리: 쿼리의 각 용어 <img src="https://latex.codecogs.com/png.latex?q_i"> 에 대해 문서 <img src="https://latex.codecogs.com/png.latex?D"> 에서의 용어빈도 <img src="https://latex.codecogs.com/png.latex?f(q_i,D)"> 와 역문서빈도(IDF)를 곱해 합한 값으로 문서 점수를 계산한다. 분수 항은 용어빈도의 기여도를 포화(saturation)시키고 문서 길이 <img src="https://latex.codecogs.com/png.latex?%7CD%7C"> 에 따라 정규화하여, 같은 용어가 많이 나와도 점수가 무한히 커지지 않게 한다. 즉, 흔한 용어는 $ $ 로 페널티를 받고, <img src="https://latex.codecogs.com/png.latex?k_1"> 과 <img src="https://latex.codecogs.com/png.latex?b"> 로 빈도 민감도와 길이 정규화 강도를 조절해 관련성 점수를 안정화한다.</p>
<p><strong>성능 특성 (Microsoft 벤치마크)</strong><br>
- Simple query (1-2 terms): 평균 10-50ms (1M 문서 인덱스)<br>
- Complex query (5+ terms, Boolean): 평균 50-200ms<br>
- Wildcard/Fuzzy query: 평균 200-1000ms (인덱스 크기에 비례)</p>
<p>BM25 스코어링의 주요 장점<br>
- <strong>해석 가능성</strong>: 각 용어별 기여도를 합산하는 구조라 점수 산출 근거가 명확하다.<br>
- <strong>효율성</strong>: 역색인(inverted index) 위에서 빠르게 계산되므로 대규모 인덱스에서도 저비용으로 동작한다.<br>
- <strong>훈련 불필요</strong>: 별도의 학습 없이도 바로 좋은 기본 검색 품질을 제공한다(따라서 초기 시스템에 즉시 적용 가능).<br>
- <strong>길이 정규화</strong>: <code>b</code> 파라미터로 문서 길이 편향을 보정해 긴 문서가 유리해지는 문제를 완화한다.<br>
- <strong>빈도 포화</strong>: <code>k1</code> 파라미터로 같은 용어의 빈도 기여도를 포화시켜 과도한 빈도에 의한 왜곡을 줄인다.<br>
- <strong>강력한 베이스라인</strong>: 많은 도메인(특히 키워드/문서 검색)에서 튜닝된 BM25는 복잡한 모델 없이도 높은 성능을 내며, 임베딩/딥러닝 기반 재정렬과 쉽게 결합된다.</p>
<p>아래는 BM25의 주요 단점<br>
- <strong>의미적 한계</strong>: 자연어 의미(동의어, 문맥적 의미)를 반영하지 못한다 — 의미 기반 검색엔진과 결합해야 보완된다.<br>
- <strong>순서·구조 무시</strong>: Bag-of-words 가정으로 단어 순서·구문 정보를 고려하지 못해 문장 의미를 잃을 수 있다.<br>
- <strong>파라미터 민감도</strong>: <code>k1</code>, <code>b</code> 튜닝이 품질에 영향 — 도메인·문서특성에 따라 재조정 필요하다.<br>
- <strong>짧은/긴 쿼리 처리 한계</strong>: 매우 짧은 쿼리나 긴 문장형 쿼리에서 적절한 관련도 추정이 어려울 수 있다.<br>
- <strong>철자 오류·변형 취약</strong>: 오타·어형 변화에 약해 퍼지나 전처리가 필요하고 비용이 든다.<br>
- <strong>구성 신호 결여</strong>: 링크·사용자행동·신뢰도 같은 비문서 텍스트 신호를 반영하지 못한다(메타 신호 통합 필요).<br>
- <strong>복잡한 의미 질문 부적합</strong>: QA나 추론형 질문에선 후보 추출용으로는 유용하지만 단독으로는 직접 답변 생성에 한계가 있다.</p>
</section>
</section>
<section id="필터링-메커니즘" class="level2" data-number="1.3">
<h2 data-number="1.3" class="anchored" data-anchor-id="필터링-메커니즘"><span class="header-section-number">1.3</span> 필터링 메커니즘</h2>
<section id="filter-vs-search-비교" class="level3" data-number="1.3.1">
<h3 data-number="1.3.1" class="anchored" data-anchor-id="filter-vs-search-비교"><span class="header-section-number">1.3.1</span> Filter vs Search 비교</h3>
<p><strong>근본적 차이</strong></p>
<table class="table">
<thead>
<tr class="header">
<th>측면</th>
<th>Filter</th>
<th>Search</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td>평가 방식</td>
<td>Boolean (참/거짓)</td>
<td>Relevance scoring</td>
</tr>
<tr class="even">
<td>결과</td>
<td>이진 분류 (포함/제외)</td>
<td>순위 리스트</td>
</tr>
<tr class="odd">
<td>성능</td>
<td>빠름 (비트셋 연산)</td>
<td>느림 (스코어 계산)</td>
</tr>
<tr class="even">
<td>캐싱</td>
<td>가능 (필터 캐시)</td>
<td>불가능 (쿼리마다 다름)</td>
</tr>
<tr class="odd">
<td>사용 목적</td>
<td>정확한 조건 매칭</td>
<td>관련성 기반 검색</td>
</tr>
</tbody>
</table>
<p><strong>아키텍처 수준 차이</strong></p>
<pre><code>Filter: Index → Bitset (0/1) → Apply to result set
Search: Index → Score calculation → Ranking</code></pre>
</section>
<section id="filter-문법-odata" class="level3" data-number="1.3.2">
<h3 data-number="1.3.2" class="anchored" data-anchor-id="filter-문법-odata"><span class="header-section-number">1.3.2</span> Filter 문법 (OData)</h3>
<p><strong>비교 연산자</strong></p>
<div class="sourceCode" id="cb12" style="background: #f1f3f5;"><pre class="sourceCode numberSource odata number-lines code-with-copy"><code class="sourceCode"><span id="cb12-1"># 동등 비교</span>
<span id="cb12-2">category eq 'Technology'</span>
<span id="cb12-3"></span>
<span id="cb12-4"># 범위 비교</span>
<span id="cb12-5">price ge 100 and price le 500</span>
<span id="cb12-6"></span>
<span id="cb12-7"># 문자열 함수</span>
<span id="cb12-8">search.in(category, 'Tech,Science,Math')</span>
<span id="cb12-9">startswith(title, 'Azure')</span></code></pre></div>
<p><strong>Logical 연산자</strong></p>
<div class="sourceCode" id="cb13" style="background: #f1f3f5;"><pre class="sourceCode numberSource odata number-lines code-with-copy"><code class="sourceCode"><span id="cb13-1"># AND</span>
<span id="cb13-2">category eq 'Tech' and price lt 100</span>
<span id="cb13-3"></span>
<span id="cb13-4"># OR</span>
<span id="cb13-5">category eq 'Tech' or category eq 'Science'</span>
<span id="cb13-6"></span>
<span id="cb13-7"># NOT</span>
<span id="cb13-8">not (category eq 'Tech')</span>
<span id="cb13-9"></span>
<span id="cb13-10"># 복합 조건</span>
<span id="cb13-11">(category eq 'Tech' or category eq 'Science') and price lt 100</span></code></pre></div>
</section>
<section id="collection-필터링" class="level3" data-number="1.3.3">
<h3 data-number="1.3.3" class="anchored" data-anchor-id="collection-필터링"><span class="header-section-number">1.3.3</span> Collection 필터링</h3>
<p><strong>any/all 람다 표현식</strong></p>
<p><strong>any (OR 시맨틱)</strong></p>
<div class="sourceCode" id="cb14" style="background: #f1f3f5;"><pre class="sourceCode numberSource odata number-lines code-with-copy"><code class="sourceCode"><span id="cb14-1"># tags 컬렉션에 'azure' 또는 'search' 포함</span>
<span id="cb14-2">tags/any(t: t eq 'azure' or t eq 'search')</span>
<span id="cb14-3"></span>
<span id="cb14-4"># ratings 컬렉션에 4 이상인 값이 하나라도 존재</span>
<span id="cb14-5">ratings/any(r: r ge 4)</span></code></pre></div>
<p><strong>all (AND 시맨틱)</strong></p>
<div class="sourceCode" id="cb15" style="background: #f1f3f5;"><pre class="sourceCode numberSource odata number-lines code-with-copy"><code class="sourceCode"><span id="cb15-1"># tags 컬렉션의 모든 값이 'azure' 또는 'search'</span>
<span id="cb15-2">tags/all(t: t eq 'azure' or t eq 'search')</span>
<span id="cb15-3"></span>
<span id="cb15-4"># 모든 가격이 100 이하</span>
<span id="cb15-5">prices/all(p: p le 100)</span></code></pre></div>
<p><strong>복합 타입 필터링</strong></p>
<div class="sourceCode" id="cb16" style="background: #f1f3f5;"><pre class="sourceCode numberSource odata number-lines code-with-copy"><code class="sourceCode"><span id="cb16-1"># authors가 복합 타입 컬렉션</span>
<span id="cb16-2"># { "name": "John", "affiliation": "Microsoft" }</span>
<span id="cb16-3">authors/any(a: a/name eq 'John' and a/affiliation eq 'Microsoft')</span></code></pre></div>
<p><strong>성능 고려사항 (Microsoft 권장)</strong><br>
- <code>any/all</code> 조건 수 제한: 문서당 &lt; 10,000 컬렉션 항목<br>
- 중첩 깊이: 최대 2-3단계 권장<br>
- 복잡한 람다: 인덱스 스캔 시간 증가 (선형 복잡도)</p>
</section>
<section id="필터-최적화-전략" class="level3" data-number="1.3.4">
<h3 data-number="1.3.4" class="anchored" data-anchor-id="필터-최적화-전략"><span class="header-section-number">1.3.4</span> 필터 최적화 전략</h3>
<p><strong>필터 순서 최적화 (선택도 기반)</strong></p>
<div class="sourceCode" id="cb17" style="background: #f1f3f5;"><pre class="sourceCode numberSource odata number-lines code-with-copy"><code class="sourceCode"><span id="cb17-1"># 나쁜 예: 낮은 선택도 필터 먼저</span>
<span id="cb17-2">price ge 0 and category eq 'RareCategory'</span>
<span id="cb17-3"></span>
<span id="cb17-4"># 좋은 예: 높은 선택도 필터 먼저</span>
<span id="cb17-5">category eq 'RareCategory' and price ge 0</span></code></pre></div>
<p><strong>벤치마크 (1M 문서 인덱스)</strong><br>
- Simple filter (<code>eq</code>): 평균 5-10ms<br>
- Range filter (<code>ge</code>, <code>le</code>): 평균 10-30ms<br>
- Collection filter (<code>any/all</code>): 평균 50-200ms (컬렉션 크기에 비례)<br>
- Combined filters (3+ conditions): 평균 20-100ms</p>
</section>
</section>
<section id="페이지네이션-및-결과-레이아웃" class="level2" data-number="1.4">
<h2 data-number="1.4" class="anchored" data-anchor-id="페이지네이션-및-결과-레이아웃"><span class="header-section-number">1.4</span> 페이지네이션 및 결과 레이아웃</h2>
<section id="페이지네이션-전략" class="level3" data-number="1.4.1">
<h3 data-number="1.4.1" class="anchored" data-anchor-id="페이지네이션-전략"><span class="header-section-number">1.4.1</span> 페이지네이션 전략</h3>
<p><strong>Offset-based (기본 방식)</strong></p>
<div class="sourceCode" id="cb18" style="background: #f1f3f5;"><pre class="sourceCode numberSource json number-lines code-with-copy"><code class="sourceCode json"><span id="cb18-1"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">{</span></span>
<span id="cb18-2">  <span class="dt" style="color: #AD0000;
background-color: null;
font-style: inherit;">"search"</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">:</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"azure"</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">,</span></span>
<span id="cb18-3">  <span class="dt" style="color: #AD0000;
background-color: null;
font-style: inherit;">"top"</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">:</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">10</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">,</span></span>
<span id="cb18-4">  <span class="dt" style="color: #AD0000;
background-color: null;
font-style: inherit;">"skip"</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">:</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">20</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">,</span></span>
<span id="cb18-5">  <span class="dt" style="color: #AD0000;
background-color: null;
font-style: inherit;">"orderby"</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">:</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"publishDate desc"</span></span>
<span id="cb18-6"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">}</span></span></code></pre></div>
<p><strong>제약사항</strong><br>
- <code>skip + top</code> 최대값: 100,000 (Azure Search 하드 리미트)<br>
- Deep pagination 성능 저하: <code>skip</code> 값이 클수록 느려짐</p>
<p><strong>성능 특성 (Microsoft 벤치마크)</strong><br>
- <code>skip=0, top=10</code>: 평균 20ms<br>
- <code>skip=1000, top=10</code>: 평균 50ms<br>
- <code>skip=10000, top=10</code>: 평균 200ms<br>
- <code>skip=50000, top=10</code>: 평균 1000ms (선형 증가)</p>
<p><strong>Search After (커서 기반)</strong></p>
<div class="sourceCode" id="cb19" style="background: #f1f3f5;"><pre class="sourceCode numberSource json number-lines code-with-copy"><code class="sourceCode json"><span id="cb19-1"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">{</span></span>
<span id="cb19-2">  <span class="dt" style="color: #AD0000;
background-color: null;
font-style: inherit;">"search"</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">:</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"azure"</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">,</span></span>
<span id="cb19-3">  <span class="dt" style="color: #AD0000;
background-color: null;
font-style: inherit;">"top"</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">:</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">10</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">,</span></span>
<span id="cb19-4">  <span class="dt" style="color: #AD0000;
background-color: null;
font-style: inherit;">"orderby"</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">:</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"publishDate desc, id asc"</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">,</span></span>
<span id="cb19-5">  <span class="dt" style="color: #AD0000;
background-color: null;
font-style: inherit;">"searchAfter"</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">:</span> <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">[</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"2023-12-01T00:00:00Z"</span><span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">,</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"doc-12345"</span><span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">]</span></span>
<span id="cb19-6"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">}</span></span></code></pre></div>
<p><strong>장점</strong><br>
- Deep pagination에서 일정한 성능 (O(log n))<br>
- 실시간 데이터 변경 시 일관성 유지</p>
<p><strong>단점</strong><br>
- 임의 페이지 점프 불가<br>
- 클라이언트가 커서 상태 관리 필요</p>
</section>
<section id="결과-커스터마이징" class="level3" data-number="1.4.2">
<h3 data-number="1.4.2" class="anchored" data-anchor-id="결과-커스터마이징"><span class="header-section-number">1.4.2</span> 결과 커스터마이징</h3>
<p><strong>Select (필드 선택)</strong></p>
<div class="sourceCode" id="cb20" style="background: #f1f3f5;"><pre class="sourceCode numberSource json number-lines code-with-copy"><code class="sourceCode json"><span id="cb20-1"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">{</span></span>
<span id="cb20-2">  <span class="dt" style="color: #AD0000;
background-color: null;
font-style: inherit;">"search"</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">:</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"azure"</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">,</span></span>
<span id="cb20-3">  <span class="dt" style="color: #AD0000;
background-color: null;
font-style: inherit;">"select"</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">:</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"title,content,publishDate"</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">,</span></span>
<span id="cb20-4">  <span class="dt" style="color: #AD0000;
background-color: null;
font-style: inherit;">"top"</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">:</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">10</span></span>
<span id="cb20-5"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">}</span></span></code></pre></div>
<p><strong>네트워크 대역폭 절감</strong><br>
- 전체 필드 반환: 평균 10KB/문서<br>
- <code>select</code> 사용 (3필드): 평균 2KB/문서<br>
- 100K 문서 전송: 1GB → 200MB (80% 절감)</p>
<p><strong>Highlight (검색어 강조)</strong></p>
<div class="sourceCode" id="cb21" style="background: #f1f3f5;"><pre class="sourceCode numberSource json number-lines code-with-copy"><code class="sourceCode json"><span id="cb21-1"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">{</span></span>
<span id="cb21-2">  <span class="dt" style="color: #AD0000;
background-color: null;
font-style: inherit;">"search"</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">:</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"azure search"</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">,</span></span>
<span id="cb21-3">  <span class="dt" style="color: #AD0000;
background-color: null;
font-style: inherit;">"highlight"</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">:</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"content,title"</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">,</span></span>
<span id="cb21-4">  <span class="dt" style="color: #AD0000;
background-color: null;
font-style: inherit;">"highlightPreTag"</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">:</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"&lt;em&gt;"</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">,</span></span>
<span id="cb21-5">  <span class="dt" style="color: #AD0000;
background-color: null;
font-style: inherit;">"highlightPostTag"</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">:</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"&lt;/em&gt;"</span></span>
<span id="cb21-6"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">}</span></span></code></pre></div>
<p><strong>Count (총 결과 수)</strong></p>
<div class="sourceCode" id="cb22" style="background: #f1f3f5;"><pre class="sourceCode numberSource json number-lines code-with-copy"><code class="sourceCode json"><span id="cb22-1"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">{</span></span>
<span id="cb22-2">  <span class="dt" style="color: #AD0000;
background-color: null;
font-style: inherit;">"search"</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">:</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"azure"</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">,</span></span>
<span id="cb22-3">  <span class="dt" style="color: #AD0000;
background-color: null;
font-style: inherit;">"count"</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">:</span> <span class="kw" style="color: #003B4F;
background-color: null;
font-style: inherit;">true</span></span>
<span id="cb22-4"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">}</span></span></code></pre></div>
<p><strong>성능 영향</strong><br>
- <code>count=false</code>: 평균 50ms<br>
- <code>count=true</code>: 평균 80ms (+60% 오버헤드)<br>
- 대규모 결과 (&gt;1M): 최대 +200ms</p>
</section>
<section id="정렬-order-by" class="level3" data-number="1.4.3">
<h3 data-number="1.4.3" class="anchored" data-anchor-id="정렬-order-by"><span class="header-section-number">1.4.3</span> 정렬 (Order By)</h3>
<p><strong>정렬 문법</strong></p>
<div class="sourceCode" id="cb23" style="background: #f1f3f5;"><pre class="sourceCode numberSource odata number-lines code-with-copy"><code class="sourceCode"><span id="cb23-1"># 단일 필드 정렬</span>
<span id="cb23-2">orderby=publishDate desc</span>
<span id="cb23-3"></span>
<span id="cb23-4"># 다중 필드 정렬 (우선순위 순)</span>
<span id="cb23-5">orderby=category asc, publishDate desc, score desc</span>
<span id="cb23-6"></span>
<span id="cb23-7"># 거리 기반 정렬 (Geo-spatial)</span>
<span id="cb23-8">orderby=geo.distance(location, geography'POINT(-122.131577 47.678581)')</span></code></pre></div>
<p><strong>성능 특성 (1M 문서)</strong><br>
- 정렬 없음 (관련성 순): 평균 50ms<br>
- 단일 필드 정렬: 평균 100ms<br>
- 다중 필드 정렬 (3개): 평균 200ms<br>
- Geo-spatial 정렬: 평균 300-500ms</p>
</section>
</section>
<section id="참고-링크" class="level2" data-number="1.5">
<h2 data-number="1.5" class="anchored" data-anchor-id="참고-링크"><span class="header-section-number">1.5</span> 참고 링크</h2>
<section id="azure-search-쿼리-아키텍처-및-고급-검색-기능" class="level3" data-number="1.5.1">
<h3 data-number="1.5.1" class="anchored" data-anchor-id="azure-search-쿼리-아키텍처-및-고급-검색-기능"><span class="header-section-number">1.5.1</span> Azure Search 쿼리 아키텍처 및 고급 검색 기능</h3>
<ul>
<li>https://learn.microsoft.com/en-us/azure/search/search-lucene-query-architecture<br>
</li>
<li>https://learn.microsoft.com/en-us/azure/search/search-filters<br>
</li>
<li>https://learn.microsoft.com/en-us/azure/search/search-query-understand-collection-filters<br>
</li>
<li>https://learn.microsoft.com/en-us/azure/search/search-pagination-page-layout<br>
</li>
<li>https://learn.microsoft.com/en-us/azure/search/semantic-answers</li>
</ul>


</section>
</section>
</section>

 ]]></description>
  <category>AI</category>
  <category>Cloud</category>
  <category>Azure</category>
  <category>Search</category>
  <guid>kk3225.netlify.app/docs/blog/posts/Engineering/Infra/Cloud/Azure/27-az-ai-search-classic-bm25.html</guid>
  <pubDate>Sun, 21 Dec 2025 15:00:00 GMT</pubDate>
</item>
</channel>
</rss>
