<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="ko" xml:lang="ko"><head>

<meta charset="utf-8">
<meta name="generator" content="quarto-1.4.543">

<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes">

<meta name="author" content="Kwangmin Kim">
<meta name="description" content="AI Agent 플랫폼의 핵심 인터페이스 설계를 다룬다. BaseAgent 추상 클래스 설계, Template Method Pattern 적용, AgentRegistry를 통한 Dependency Inversion 구현, Orchestrator로 Agent 실행 관리 방법을 구체적으로 설명한다. 실제 Agent 구현 예시와 함께 표준 인터페이스가 왜 중요한지, 어떻게 설계해야 유지보수성과 확장성을 모두 확보할 수 있는지 제시한다.">

<title>Kwangmin Kim - AI Agent 플랫폼 인터페이스 설계</title>
<style>
code{white-space: pre-wrap;}
span.smallcaps{font-variant: small-caps;}
div.columns{display: flex; gap: min(4vw, 1.5em);}
div.column{flex: auto; overflow-x: auto;}
div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
ul.task-list{list-style: none;}
ul.task-list li input[type="checkbox"] {
  width: 0.8em;
  margin: 0 0.8em 0.2em -1em; /* quarto-specific, see https://github.com/quarto-dev/quarto-cli/issues/4556 */ 
  vertical-align: middle;
}
/* CSS for syntax highlighting */
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
div.sourceCode { margin: 1em 0; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
  }
pre.numberSource { margin-left: 3em;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
</style>


<script src="../../../../../../../site_libs/quarto-nav/quarto-nav.js"></script>
<script src="../../../../../../../site_libs/quarto-nav/headroom.min.js"></script>
<script src="../../../../../../../site_libs/clipboard/clipboard.min.js"></script>
<script src="../../../../../../../site_libs/quarto-search/autocomplete.umd.js"></script>
<script src="../../../../../../../site_libs/quarto-search/fuse.min.js"></script>
<script src="../../../../../../../site_libs/quarto-search/quarto-search.js"></script>
<script src="../../../../../../../site_libs/quarto-search/autocomplete-preset-algolia.umd.js"></script>
<meta name="quarto:offset" content="../../../../../../../">
<script src="../../../../../../../site_libs/quarto-html/quarto.js"></script>
<script src="../../../../../../../site_libs/quarto-html/popper.min.js"></script>
<script src="../../../../../../../site_libs/quarto-html/tippy.umd.min.js"></script>
<script src="../../../../../../../site_libs/quarto-html/anchor.min.js"></script>
<link href="../../../../../../../site_libs/quarto-html/tippy.css" rel="stylesheet">
<link href="../../../../../../../site_libs/quarto-html/quarto-syntax-highlighting.css" rel="stylesheet" class="quarto-color-scheme" id="quarto-text-highlighting-styles">
<link href="../../../../../../../site_libs/quarto-html/quarto-syntax-highlighting-dark.css" rel="prefetch" class="quarto-color-scheme quarto-color-alternate" id="quarto-text-highlighting-styles">
<script src="../../../../../../../site_libs/bootstrap/bootstrap.min.js"></script>
<link href="../../../../../../../site_libs/bootstrap/bootstrap-icons.css" rel="stylesheet">
<link href="../../../../../../../site_libs/bootstrap/bootstrap.min.css" rel="stylesheet" class="quarto-color-scheme" id="quarto-bootstrap" data-mode="light">
<link href="../../../../../../../site_libs/bootstrap/bootstrap-dark.min.css" rel="prefetch" class="quarto-color-scheme quarto-color-alternate" id="quarto-bootstrap" data-mode="dark">
<script id="quarto-search-options" type="application/json">{
  "location": "navbar",
  "copy-button": false,
  "collapse-after": 3,
  "panel-placement": "end",
  "type": "overlay",
  "limit": 50,
  "algolia": {
    "application-id": "DUOR1DRC9D",
    "search-only-api-key": "f264da5dea684ffb9e9b4a574af3ed61",
    "index-name": "prod_QUARTO",
    "analytics-events": true,
    "show-logo": true,
    "libDir": "site_libs"
  },
  "keyboard-shortcut": [
    "f",
    "/",
    "s"
  ],
  "show-item-context": true,
  "language": {
    "search-no-results-text": "일치 없음",
    "search-matching-documents-text": "일치된 문서",
    "search-copy-link-title": "검색 링크 복사",
    "search-hide-matches-text": "추가 검색 결과 숨기기",
    "search-more-match-text": "추가 검색결과",
    "search-more-matches-text": "추가 검색결과",
    "search-clear-button-title": "제거",
    "search-text-placeholder": "",
    "search-detached-cancel-button-title": "취소",
    "search-submit-button-title": "검색",
    "search-label": "검색"
  }
}</script>
<script src="https://cdn.jsdelivr.net/npm/algoliasearch@4.5.1/dist/algoliasearch-lite.umd.js"></script>


<script type="text/javascript">
var ALGOLIA_INSIGHTS_SRC = "https://cdn.jsdelivr.net/npm/search-insights/dist/search-insights.iife.min.js";
!function(e,a,t,n,s,i,c){e.AlgoliaAnalyticsObject=s,e[s]=e[s]||function(){
(e[s].queue=e[s].queue||[]).push(arguments)},i=a.createElement(t),c=a.getElementsByTagName(t)[0],
i.async=1,i.src=n,c.parentNode.insertBefore(i,c)
}(window,document,"script",ALGOLIA_INSIGHTS_SRC,"aa");
</script>

<script type="text/javascript" src="https://cdn.jsdelivr.net/npm/@algolia/autocomplete-plugin-algolia-insights">

</script>
<script async="" src="https://www.googletagmanager.com/gtag/js?id=G-6W0EKFMWBN"></script>

<script type="text/javascript">

window.dataLayer = window.dataLayer || [];
function gtag(){dataLayer.push(arguments);}
gtag('js', new Date());
gtag('config', 'G-6W0EKFMWBN', { 'anonymize_ip': true});
</script>
<style>

      .quarto-title-block .quarto-title-banner h1,
      .quarto-title-block .quarto-title-banner h2,
      .quarto-title-block .quarto-title-banner h3,
      .quarto-title-block .quarto-title-banner h4,
      .quarto-title-block .quarto-title-banner h5,
      .quarto-title-block .quarto-title-banner h6
      {
        color: black;
      }

      .quarto-title-block .quarto-title-banner {
        color: black;
background: #EDF3F9;
      }
</style>
<style>
.custom-footer { 
  text-align: center; 
  font-size: 0.8em; 
  color: #666; 
  margin-top: 2rem; 
}
</style>


<link rel="stylesheet" href="../../../../../../../styles.css">
<meta property="og:title" content="Kwangmin Kim - AI Agent 플랫폼 인터페이스 설계">
<meta property="og:description" content="AI Agent 플랫폼의 핵심 인터페이스 설계를 다룬다. BaseAgent 추상 클래스 설계, Template Method Pattern 적용, AgentRegistry를 통한 Dependency Inversion 구현, Orchestrator로 Agent 실행 관리 방법을 구체적으로 설명한다. 실제 Agent 구현 예시와 함께 표준 인터페이스가 왜 중요한지, 어떻게 설계해야 유지보수성과 확장성을 모두 확보할 수 있는지 제시한다.">
<meta property="og:site_name" content="Kwangmin Kim">
<meta name="twitter:title" content="Kwangmin Kim - AI Agent 플랫폼 인터페이스 설계">
<meta name="twitter:description" content="AI Agent 플랫폼의 핵심 인터페이스 설계를 다룬다. BaseAgent 추상 클래스 설계, Template Method Pattern 적용, AgentRegistry를 통한 Dependency Inversion 구현, Orchestrator로 Agent 실행 관리 방법을 구체적으로 설명한다. 실제 Agent 구현 예시와 함께 표준 인터페이스가 왜 중요한지, 어떻게 설계해야 유지보수성과 확장성을 모두 확보할 수 있는지 제시한다.">
<meta name="twitter:card" content="summary">
</head>

<body class="nav-fixed">

<div id="quarto-search-results"></div>
  <header id="quarto-header" class="headroom fixed-top quarto-banner">
    <nav class="navbar navbar-expand-lg " data-bs-theme="dark">
      <div class="navbar-container container-fluid">
      <div class="navbar-brand-container mx-auto">
    <a href="../../../../../../../index.html" class="navbar-brand navbar-brand-logo">
    <img src="../../../../../../.././images/logo.png" alt="" class="navbar-logo">
    </a>
    <a class="navbar-brand" href="../../../../../../../index.html">
    <span class="navbar-title">Kwangmin Kim</span>
    </a>
  </div>
            <div id="quarto-search" class="" title="검색"></div>
          <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbarCollapse" aria-controls="navbarCollapse" aria-expanded="false" aria-label="탐색 전환" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">
  <span class="navbar-toggler-icon"></span>
</button>
          <div class="collapse navbar-collapse" id="navbarCollapse">
            <ul class="navbar-nav navbar-nav-scroll me-auto">
  <li class="nav-item">
    <a class="nav-link" href="../../../../../../../index.html"> 
<span class="menu-text">Home</span></a>
  </li>  
  <li class="nav-item">
    <a class="nav-link" href="../../../../../../../docs/blog/index.html"> 
<span class="menu-text">Blog</span></a>
  </li>  
</ul>
            <ul class="navbar-nav navbar-nav-scroll ms-auto">
  <li class="nav-item">
    <a class="nav-link" href="../../../../../../../about.html"> 
<span class="menu-text">Me</span></a>
  </li>  
  <li class="nav-item compact">
    <a class="nav-link" href="https://github.com/kmink3225"> <i class="bi bi-github" role="img" aria-label="Github">
</i> 
<span class="menu-text"></span></a>
  </li>  
  <li class="nav-item compact">
    <a class="nav-link" href="https://www.linkedin.com/in/kwangmin-kim-a5241b200/"> <i class="bi bi-linkedin" role="img" aria-label="Linkedin">
</i> 
<span class="menu-text"></span></a>
  </li>  
</ul>
          </div> <!-- /navcollapse -->
          <div class="quarto-navbar-tools">
  <a href="" class="quarto-color-scheme-toggle quarto-navigation-tool  px-1" onclick="window.quartoToggleColorScheme(); return false;" title="다크 모드 전환"><i class="bi"></i></a>
</div>
      </div> <!-- /container-fluid -->
    </nav>
</header>
<!-- content -->
<header id="title-block-header" class="quarto-title-block default page-columns page-full">
  <div class="quarto-title-banner page-columns page-full">
    <div class="quarto-title column-body">
      <h1 class="title">AI Agent 플랫폼 인터페이스 설계</h1>
            <p class="subtitle lead">BaseAgent와 Template Method Pattern</p>
                  <div>
        <div class="description">
          <p>AI Agent 플랫폼의 핵심 인터페이스 설계를 다룬다. BaseAgent 추상 클래스 설계, Template Method Pattern 적용, AgentRegistry를 통한 Dependency Inversion 구현, Orchestrator로 Agent 실행 관리 방법을 구체적으로 설명한다. 실제 Agent 구현 예시와 함께 표준 인터페이스가 왜 중요한지, 어떻게 설계해야 유지보수성과 확장성을 모두 확보할 수 있는지 제시한다.</p>
        </div>
      </div>
                          <div class="quarto-categories">
                <div class="quarto-category">Engineering</div>
                <div class="quarto-category">System</div>
                <div class="quarto-category">Architecture Design</div>
                <div class="quarto-category">Agent</div>
                <div class="quarto-category">Platform</div>
              </div>
                  </div>
  </div>
    
  
  <div class="quarto-title-meta">

      <div>
      <div class="quarto-title-meta-heading">저자</div>
      <div class="quarto-title-meta-contents">
               <p>Kwangmin Kim </p>
            </div>
    </div>
      
      <div>
      <div class="quarto-title-meta-heading">공개</div>
      <div class="quarto-title-meta-contents">
        <p class="date">2026년 01월 29일</p>
      </div>
    </div>
    
      
    </div>
    
  
  </header><div id="quarto-content" class="quarto-container page-columns page-rows-contents page-layout-article page-navbar">
<!-- sidebar -->
<!-- margin-sidebar -->
    <div id="quarto-margin-sidebar" class="sidebar margin-sidebar">
        <nav id="TOC" role="doc-toc" class="toc-active">
    <h2 id="toc-title">목차</h2>
   
  <ul>
  <li><a href="#들어가며" id="toc-들어가며" class="nav-link active" data-scroll-target="#들어가며"><span class="header-section-number">1</span> 들어가며</a>
  <ul class="collapse">
  <li><a href="#왜-인터페이스-설계가-중요한가" id="toc-왜-인터페이스-설계가-중요한가" class="nav-link" data-scroll-target="#왜-인터페이스-설계가-중요한가"><span class="header-section-number">1.1</span> 왜 인터페이스 설계가 중요한가?</a></li>
  <li><a href="#앞선-글-요약" id="toc-앞선-글-요약" class="nav-link" data-scroll-target="#앞선-글-요약"><span class="header-section-number">1.2</span> 앞선 글 요약</a></li>
  </ul></li>
  <li><a href="#baseagent-인터페이스-설계" id="toc-baseagent-인터페이스-설계" class="nav-link" data-scroll-target="#baseagent-인터페이스-설계"><span class="header-section-number">2</span> BaseAgent 인터페이스 설계</a>
  <ul class="collapse">
  <li><a href="#설계-원칙" id="toc-설계-원칙" class="nav-link" data-scroll-target="#설계-원칙"><span class="header-section-number">2.1</span> 설계 원칙</a>
  <ul class="collapse">
  <li><a href="#원칙-1-표준-입출력-형식" id="toc-원칙-1-표준-입출력-형식" class="nav-link" data-scroll-target="#원칙-1-표준-입출력-형식"><span class="header-section-number">2.1.1</span> 원칙 1: 표준 입출력 형식</a></li>
  <li><a href="#원칙-2-template-method-pattern" id="toc-원칙-2-template-method-pattern" class="nav-link" data-scroll-target="#원칙-2-template-method-pattern"><span class="header-section-number">2.1.2</span> 원칙 2: Template Method Pattern</a></li>
  <li><a href="#원칙-3-hook-methods" id="toc-원칙-3-hook-methods" class="nav-link" data-scroll-target="#원칙-3-hook-methods"><span class="header-section-number">2.1.3</span> 원칙 3: Hook Methods</a></li>
  </ul></li>
  <li><a href="#baseagent-전체-구현" id="toc-baseagent-전체-구현" class="nav-link" data-scroll-target="#baseagent-전체-구현"><span class="header-section-number">2.2</span> BaseAgent 전체 구현</a></li>
  <li><a href="#설계-의사결정-설명" id="toc-설계-의사결정-설명" class="nav-link" data-scroll-target="#설계-의사결정-설명"><span class="header-section-number">2.3</span> 설계 의사결정 설명</a>
  <ul class="collapse">
  <li><a href="#왜-dictstr-any인가" id="toc-왜-dictstr-any인가" class="nav-link" data-scroll-target="#왜-dictstr-any인가"><span class="header-section-number">2.3.1</span> 왜 Dict[str, Any]인가?</a></li>
  <li><a href="#왜-execute와-process를-분리하는가" id="toc-왜-execute와-process를-분리하는가" class="nav-link" data-scroll-target="#왜-execute와-process를-분리하는가"><span class="header-section-number">2.3.2</span> 왜 execute()와 process()를 분리하는가?</a></li>
  <li><a href="#왜-evaluate를-인터페이스에-포함하는가" id="toc-왜-evaluate를-인터페이스에-포함하는가" class="nav-link" data-scroll-target="#왜-evaluate를-인터페이스에-포함하는가"><span class="header-section-number">2.3.3</span> 왜 evaluate()를 인터페이스에 포함하는가?</a></li>
  </ul></li>
  </ul></li>
  <li><a href="#agentregistry-dependency-inversion-구현" id="toc-agentregistry-dependency-inversion-구현" class="nav-link" data-scroll-target="#agentregistry-dependency-inversion-구현"><span class="header-section-number">3</span> AgentRegistry: Dependency Inversion 구현</a>
  <ul class="collapse">
  <li><a href="#문제-core가-agent에-의존하면" id="toc-문제-core가-agent에-의존하면" class="nav-link" data-scroll-target="#문제-core가-agent에-의존하면"><span class="header-section-number">3.1</span> 문제: Core가 Agent에 의존하면?</a></li>
  <li><a href="#해결-registry-pattern" id="toc-해결-registry-pattern" class="nav-link" data-scroll-target="#해결-registry-pattern"><span class="header-section-number">3.2</span> 해결: Registry Pattern</a></li>
  <li><a href="#실전-예시-agent-추가" id="toc-실전-예시-agent-추가" class="nav-link" data-scroll-target="#실전-예시-agent-추가"><span class="header-section-number">3.3</span> 실전 예시: Agent 추가</a></li>
  </ul></li>
  <li><a href="#orchestrator-agent-실행-관리" id="toc-orchestrator-agent-실행-관리" class="nav-link" data-scroll-target="#orchestrator-agent-실행-관리"><span class="header-section-number">4</span> Orchestrator: Agent 실행 관리</a>
  <ul class="collapse">
  <li><a href="#단일-agent-실행" id="toc-단일-agent-실행" class="nav-link" data-scroll-target="#단일-agent-실행"><span class="header-section-number">4.1</span> 단일 Agent 실행</a></li>
  <li><a href="#agent-체이닝" id="toc-agent-체이닝" class="nav-link" data-scroll-target="#agent-체이닝"><span class="header-section-number">4.2</span> Agent 체이닝</a></li>
  <li><a href="#병렬-실행" id="toc-병렬-실행" class="nav-link" data-scroll-target="#병렬-실행"><span class="header-section-number">4.3</span> 병렬 실행</a></li>
  <li><a href="#조건부-실행" id="toc-조건부-실행" class="nav-link" data-scroll-target="#조건부-실행"><span class="header-section-number">4.4</span> 조건부 실행</a></li>
  </ul></li>
  <li><a href="#실제-agent-구현-예시" id="toc-실제-agent-구현-예시" class="nav-link" data-scroll-target="#실제-agent-구현-예시"><span class="header-section-number">5</span> 실제 Agent 구현 예시</a>
  <ul class="collapse">
  <li><a href="#datastandardizationagent" id="toc-datastandardizationagent" class="nav-link" data-scroll-target="#datastandardizationagent"><span class="header-section-number">5.1</span> DataStandardizationAgent</a></li>
  <li><a href="#agent-등록" id="toc-agent-등록" class="nav-link" data-scroll-target="#agent-등록"><span class="header-section-number">5.2</span> Agent 등록</a></li>
  <li><a href="#사용-예시" id="toc-사용-예시" class="nav-link" data-scroll-target="#사용-예시"><span class="header-section-number">5.3</span> 사용 예시</a></li>
  </ul></li>
  <li><a href="#핵심-설계-결정-요약" id="toc-핵심-설계-결정-요약" class="nav-link" data-scroll-target="#핵심-설계-결정-요약"><span class="header-section-number">6</span> 핵심 설계 결정 요약</a>
  <ul class="collapse">
  <li><a href="#baseagent-인터페이스" id="toc-baseagent-인터페이스" class="nav-link" data-scroll-target="#baseagent-인터페이스"><span class="header-section-number">6.1</span> BaseAgent 인터페이스</a></li>
  <li><a href="#agentregistry" id="toc-agentregistry" class="nav-link" data-scroll-target="#agentregistry"><span class="header-section-number">6.2</span> AgentRegistry</a></li>
  <li><a href="#orchestrator" id="toc-orchestrator" class="nav-link" data-scroll-target="#orchestrator"><span class="header-section-number">6.3</span> Orchestrator</a></li>
  <li><a href="#다음-단계" id="toc-다음-단계" class="nav-link" data-scroll-target="#다음-단계"><span class="header-section-number">6.4</span> 다음 단계</a></li>
  <li><a href="#참고문헌" id="toc-참고문헌" class="nav-link" data-scroll-target="#참고문헌"><span class="header-section-number">6.5</span> 참고문헌</a>
  <ul class="collapse">
  <li><a href="#baseagent-설계-2번-글-확장" id="toc-baseagent-설계-2번-글-확장" class="nav-link" data-scroll-target="#baseagent-설계-2번-글-확장"><span class="header-section-number">6.5.1</span> BaseAgent 설계 (2번 글 확장)</a></li>
  <li><a href="#agent-registry-dependency-inversion-구현" id="toc-agent-registry-dependency-inversion-구현" class="nav-link" data-scroll-target="#agent-registry-dependency-inversion-구현"><span class="header-section-number">6.5.2</span> Agent Registry (Dependency Inversion 구현)</a></li>
  <li><a href="#orchestrator-agent-실행-관리-1" id="toc-orchestrator-agent-실행-관리-1" class="nav-link" data-scroll-target="#orchestrator-agent-실행-관리-1"><span class="header-section-number">6.5.3</span> Orchestrator (Agent 실행 관리)</a></li>
  </ul></li>
  <li><a href="#shared-모듈-공통-라이브러리" id="toc-shared-모듈-공통-라이브러리" class="nav-link" data-scroll-target="#shared-모듈-공통-라이브러리"><span class="header-section-number">6.6</span> shared/ 모듈: 공통 라이브러리</a>
  <ul class="collapse">
  <li><a href="#llm-클라이언트-2번-글-확장" id="toc-llm-클라이언트-2번-글-확장" class="nav-link" data-scroll-target="#llm-클라이언트-2번-글-확장"><span class="header-section-number">6.6.1</span> LLM 클라이언트 (2번 글 확장)</a></li>
  </ul></li>
  <li><a href="#agents-모듈-도메인-agent" id="toc-agents-모듈-도메인-agent" class="nav-link" data-scroll-target="#agents-모듈-도메인-agent"><span class="header-section-number">6.7</span> agents/ 모듈: 도메인 Agent</a>
  <ul class="collapse">
  <li><a href="#agent-구현-예시" id="toc-agent-구현-예시" class="nav-link" data-scroll-target="#agent-구현-예시"><span class="header-section-number">6.7.1</span> Agent 구현 예시</a></li>
  <li><a href="#agent-manifest" id="toc-agent-manifest" class="nav-link" data-scroll-target="#agent-manifest"><span class="header-section-number">6.7.2</span> Agent Manifest</a></li>
  </ul></li>
  </ul></li>
  </ul>
</nav>
    </div>
<!-- main -->
<main class="content quarto-banner-title-block" id="quarto-document-content">





<section id="들어가며" class="level1" data-number="1">
<h1 data-number="1"><span class="header-section-number">1</span> 들어가며</h1>
<section id="왜-인터페이스-설계가-중요한가" class="level2" data-number="1.1">
<h2 data-number="1.1" class="anchored" data-anchor-id="왜-인터페이스-설계가-중요한가"><span class="header-section-number">1.1</span> 왜 인터페이스 설계가 중요한가?</h2>
<p>Phase 1-4를 거쳐 여러 Agent를 만들었다. 이제 문제는:</p>
<p><strong>질문들</strong>: - “모든 Agent가 따라야 할 표준 인터페이스는 무엇인가?” - “새 Agent 추가 시 기존 코드를 수정하지 않으려면?” - “Agent 실행, 평가, 모니터링을 어떻게 통일할 것인가?”</p>
<p><strong>이 글의 목표</strong>: - BaseAgent 추상 클래스 설계 - Template Method Pattern 적용 이유 - AgentRegistry로 Dependency Inversion 구현 - Orchestrator로 Agent 실행 관리 - 실제 Agent 구현 예시</p>
</section>
<section id="앞선-글-요약" class="level2" data-number="1.2">
<h2 data-number="1.2" class="anchored" data-anchor-id="앞선-글-요약"><span class="header-section-number">1.2</span> 앞선 글 요약</h2>
<p><strong>3번 글</strong> (<a href="../../../../../../../docs/blog/posts/Engineering/System/Archi_Design/platform/3.agent_platform_repo_strategy.html">저장소 전략</a>): - Monorepo 선택 근거 - core/shared/agents 모듈 분리 - 의존성 규칙: <code>agents → shared → core</code> - 빌드 도구: Poetry → Nx → Bazel 로드맵</p>
<p><strong>핵심 질문</strong>: “core/에 어떤 인터페이스를 정의할 것인가?”</p>
</section>
</section>
<section id="baseagent-인터페이스-설계" class="level1" data-number="2">
<h1 data-number="2"><span class="header-section-number">2</span> BaseAgent 인터페이스 설계</h1>
<section id="설계-원칙" class="level2" data-number="2.1">
<h2 data-number="2.1" class="anchored" data-anchor-id="설계-원칙"><span class="header-section-number">2.1</span> 설계 원칙</h2>
<section id="원칙-1-표준-입출력-형식" class="level3" data-number="2.1.1">
<h3 data-number="2.1.1" class="anchored" data-anchor-id="원칙-1-표준-입출력-형식"><span class="header-section-number">2.1.1</span> 원칙 1: 표준 입출력 형식</h3>
<p><strong>문제</strong>: 각 Agent가 다른 입출력 형식 사용</p>
<div class="sourceCode" id="cb1"><pre class="sourceCode numberSource python number-lines code-with-copy"><code class="sourceCode python"><span id="cb1-1"><a href="#cb1-1"></a><span class="co"># ❌ 나쁜 예: Agent마다 다른 시그니처</span></span>
<span id="cb1-2"><a href="#cb1-2"></a><span class="kw">class</span> DataAgent:</span>
<span id="cb1-3"><a href="#cb1-3"></a>    <span class="kw">def</span> run(<span class="va">self</span>, schema: <span class="bu">str</span>) <span class="op">-&gt;</span> <span class="bu">str</span>:  <span class="co"># 문자열 입출력</span></span>
<span id="cb1-4"><a href="#cb1-4"></a>        ...</span>
<span id="cb1-5"><a href="#cb1-5"></a></span>
<span id="cb1-6"><a href="#cb1-6"></a><span class="kw">class</span> CodeAgent:</span>
<span id="cb1-7"><a href="#cb1-7"></a>    <span class="kw">def</span> analyze(<span class="va">self</span>, code_obj: CodeObject) <span class="op">-&gt;</span> List[Issue]:  <span class="co"># 객체 입출력</span></span>
<span id="cb1-8"><a href="#cb1-8"></a>        ...</span>
<span id="cb1-9"><a href="#cb1-9"></a></span>
<span id="cb1-10"><a href="#cb1-10"></a><span class="kw">class</span> KnowledgeAgent:</span>
<span id="cb1-11"><a href="#cb1-11"></a>    <span class="kw">def</span> query(<span class="va">self</span>, question: <span class="bu">str</span>, context: Dict) <span class="op">-&gt;</span> Dict:  <span class="co"># 혼합</span></span>
<span id="cb1-12"><a href="#cb1-12"></a>        ...</span>
<span id="cb1-13"><a href="#cb1-13"></a></span>
<span id="cb1-14"><a href="#cb1-14"></a><span class="co"># 문제: Agent 체이닝 불가능</span></span>
<span id="cb1-15"><a href="#cb1-15"></a>result1 <span class="op">=</span> data_agent.run(schema)</span>
<span id="cb1-16"><a href="#cb1-16"></a>result2 <span class="op">=</span> code_agent.analyze(result1)  <span class="co"># 타입 에러!</span></span></code><button title="클립보드 복사" class="code-copy-button"><i class="bi"></i></button></pre></div>
<p><strong>해결</strong>: Dict[str, Any] 표준 형식</p>
<div class="sourceCode" id="cb2"><pre class="sourceCode numberSource python number-lines code-with-copy"><code class="sourceCode python"><span id="cb2-1"><a href="#cb2-1"></a><span class="co"># ✅ 좋은 예: 표준 입출력</span></span>
<span id="cb2-2"><a href="#cb2-2"></a><span class="kw">class</span> BaseAgent(ABC):</span>
<span id="cb2-3"><a href="#cb2-3"></a>    <span class="at">@abstractmethod</span></span>
<span id="cb2-4"><a href="#cb2-4"></a>    <span class="kw">def</span> process(<span class="va">self</span>, <span class="bu">input</span>: Dict[<span class="bu">str</span>, Any]) <span class="op">-&gt;</span> Dict[<span class="bu">str</span>, Any]:</span>
<span id="cb2-5"><a href="#cb2-5"></a>        <span class="cf">pass</span></span>
<span id="cb2-6"><a href="#cb2-6"></a></span>
<span id="cb2-7"><a href="#cb2-7"></a><span class="co"># 모든 Agent가 동일한 시그니처</span></span>
<span id="cb2-8"><a href="#cb2-8"></a>data_result <span class="op">=</span> data_agent.process({<span class="st">'data'</span>: schema})</span>
<span id="cb2-9"><a href="#cb2-9"></a>code_result <span class="op">=</span> code_agent.process(data_result)  <span class="co"># 체이닝 가능</span></span></code><button title="클립보드 복사" class="code-copy-button"><i class="bi"></i></button></pre></div>
<p><strong>표준 입력 구조</strong>:</p>
<div class="sourceCode" id="cb3"><pre class="sourceCode numberSource python number-lines code-with-copy"><code class="sourceCode python"><span id="cb3-1"><a href="#cb3-1"></a><span class="bu">input</span> <span class="op">=</span> {</span>
<span id="cb3-2"><a href="#cb3-2"></a>    <span class="st">'task'</span>: <span class="st">'standardization'</span>,  <span class="co"># 작업 유형</span></span>
<span id="cb3-3"><a href="#cb3-3"></a>    <span class="st">'data'</span>: {...},              <span class="co"># 실제 데이터</span></span>
<span id="cb3-4"><a href="#cb3-4"></a>    <span class="st">'config'</span>: {                 <span class="co"># 실행 옵션</span></span>
<span id="cb3-5"><a href="#cb3-5"></a>        <span class="st">'temperature'</span>: <span class="fl">0.0</span>,</span>
<span id="cb3-6"><a href="#cb3-6"></a>        <span class="st">'max_tokens'</span>: <span class="dv">1000</span></span>
<span id="cb3-7"><a href="#cb3-7"></a>    },</span>
<span id="cb3-8"><a href="#cb3-8"></a>    <span class="st">'metadata'</span>: {               <span class="co"># 컨텍스트</span></span>
<span id="cb3-9"><a href="#cb3-9"></a>        <span class="st">'source'</span>: <span class="st">'previous_agent'</span>,</span>
<span id="cb3-10"><a href="#cb3-10"></a>        <span class="st">'timestamp'</span>: <span class="dv">1234567890</span></span>
<span id="cb3-11"><a href="#cb3-11"></a>    }</span>
<span id="cb3-12"><a href="#cb3-12"></a>}</span></code><button title="클립보드 복사" class="code-copy-button"><i class="bi"></i></button></pre></div>
<p><strong>표준 출력 구조</strong>:</p>
<div class="sourceCode" id="cb4"><pre class="sourceCode numberSource python number-lines code-with-copy"><code class="sourceCode python"><span id="cb4-1"><a href="#cb4-1"></a>output <span class="op">=</span> {</span>
<span id="cb4-2"><a href="#cb4-2"></a>    <span class="st">'result'</span>: {...},            <span class="co"># 실행 결과</span></span>
<span id="cb4-3"><a href="#cb4-3"></a>    <span class="st">'confidence'</span>: <span class="fl">0.95</span>,         <span class="co"># 신뢰도 (0-1)</span></span>
<span id="cb4-4"><a href="#cb4-4"></a>    <span class="st">'metadata'</span>: {               <span class="co"># 실행 정보</span></span>
<span id="cb4-5"><a href="#cb4-5"></a>        <span class="st">'agent'</span>: <span class="st">'data_standardization'</span>,</span>
<span id="cb4-6"><a href="#cb4-6"></a>        <span class="st">'version'</span>: <span class="st">'1.0.0'</span>,</span>
<span id="cb4-7"><a href="#cb4-7"></a>        <span class="st">'execution_time'</span>: <span class="fl">2.5</span></span>
<span id="cb4-8"><a href="#cb4-8"></a>    },</span>
<span id="cb4-9"><a href="#cb4-9"></a>    <span class="st">'errors'</span>: []                <span class="co"># 에러 목록 (있다면)</span></span>
<span id="cb4-10"><a href="#cb4-10"></a>}</span></code><button title="클립보드 복사" class="code-copy-button"><i class="bi"></i></button></pre></div>
</section>
<section id="원칙-2-template-method-pattern" class="level3" data-number="2.1.2">
<h3 data-number="2.1.2" class="anchored" data-anchor-id="원칙-2-template-method-pattern"><span class="header-section-number">2.1.2</span> 원칙 2: Template Method Pattern</h3>
<p><strong>문제</strong>: 공통 로직(검증, 로깅, 메트릭)을 매번 구현</p>
<div class="sourceCode" id="cb5"><pre class="sourceCode numberSource python number-lines code-with-copy"><code class="sourceCode python"><span id="cb5-1"><a href="#cb5-1"></a><span class="co"># ❌ 나쁜 예: 각 Agent가 중복 코드</span></span>
<span id="cb5-2"><a href="#cb5-2"></a><span class="kw">class</span> DataAgent:</span>
<span id="cb5-3"><a href="#cb5-3"></a>    <span class="kw">def</span> process(<span class="va">self</span>, <span class="bu">input</span>):</span>
<span id="cb5-4"><a href="#cb5-4"></a>        <span class="co"># 입력 검증 (중복)</span></span>
<span id="cb5-5"><a href="#cb5-5"></a>        <span class="cf">if</span> <span class="kw">not</span> <span class="bu">isinstance</span>(<span class="bu">input</span>, <span class="bu">dict</span>):</span>
<span id="cb5-6"><a href="#cb5-6"></a>            <span class="cf">raise</span> <span class="pp">ValueError</span>(<span class="st">"..."</span>)</span>
<span id="cb5-7"><a href="#cb5-7"></a>        </span>
<span id="cb5-8"><a href="#cb5-8"></a>        <span class="co"># 시간 측정 (중복)</span></span>
<span id="cb5-9"><a href="#cb5-9"></a>        start <span class="op">=</span> time.time()</span>
<span id="cb5-10"><a href="#cb5-10"></a>        </span>
<span id="cb5-11"><a href="#cb5-11"></a>        <span class="co"># 실제 로직</span></span>
<span id="cb5-12"><a href="#cb5-12"></a>        result <span class="op">=</span> <span class="va">self</span>._do_work(<span class="bu">input</span>)</span>
<span id="cb5-13"><a href="#cb5-13"></a>        </span>
<span id="cb5-14"><a href="#cb5-14"></a>        <span class="co"># 로깅 (중복)</span></span>
<span id="cb5-15"><a href="#cb5-15"></a>        elapsed <span class="op">=</span> time.time() <span class="op">-</span> start</span>
<span id="cb5-16"><a href="#cb5-16"></a>        logger.info(<span class="ss">f"Elapsed: </span><span class="sc">{</span>elapsed<span class="sc">}</span><span class="ss">"</span>)</span>
<span id="cb5-17"><a href="#cb5-17"></a>        </span>
<span id="cb5-18"><a href="#cb5-18"></a>        <span class="cf">return</span> result</span>
<span id="cb5-19"><a href="#cb5-19"></a></span>
<span id="cb5-20"><a href="#cb5-20"></a><span class="kw">class</span> CodeAgent:</span>
<span id="cb5-21"><a href="#cb5-21"></a>    <span class="kw">def</span> process(<span class="va">self</span>, <span class="bu">input</span>):</span>
<span id="cb5-22"><a href="#cb5-22"></a>        <span class="co"># 동일한 검증, 측정, 로깅 코드 반복</span></span>
<span id="cb5-23"><a href="#cb5-23"></a>        ...</span></code><button title="클립보드 복사" class="code-copy-button"><i class="bi"></i></button></pre></div>
<p><strong>해결</strong>: Template Method로 공통 로직 추출</p>
<div class="sourceCode" id="cb6"><pre class="sourceCode numberSource python number-lines code-with-copy"><code class="sourceCode python"><span id="cb6-1"><a href="#cb6-1"></a><span class="co"># ✅ 좋은 예: BaseAgent가 공통 로직 처리</span></span>
<span id="cb6-2"><a href="#cb6-2"></a><span class="kw">class</span> BaseAgent(ABC):</span>
<span id="cb6-3"><a href="#cb6-3"></a>    <span class="kw">def</span> execute(<span class="va">self</span>, <span class="bu">input</span>: Dict[<span class="bu">str</span>, Any]) <span class="op">-&gt;</span> Dict[<span class="bu">str</span>, Any]:</span>
<span id="cb6-4"><a href="#cb6-4"></a>        <span class="co">"""Template Method (final - 수정 불가)"""</span></span>
<span id="cb6-5"><a href="#cb6-5"></a>        <span class="co"># 1. 공통 검증</span></span>
<span id="cb6-6"><a href="#cb6-6"></a>        <span class="va">self</span>._validate_input(<span class="bu">input</span>)</span>
<span id="cb6-7"><a href="#cb6-7"></a>        </span>
<span id="cb6-8"><a href="#cb6-8"></a>        <span class="co"># 2. 전처리 hook</span></span>
<span id="cb6-9"><a href="#cb6-9"></a>        <span class="bu">input</span> <span class="op">=</span> <span class="va">self</span>._pre_process(<span class="bu">input</span>)</span>
<span id="cb6-10"><a href="#cb6-10"></a>        </span>
<span id="cb6-11"><a href="#cb6-11"></a>        <span class="co"># 3. 시간 측정</span></span>
<span id="cb6-12"><a href="#cb6-12"></a>        start_time <span class="op">=</span> time.time()</span>
<span id="cb6-13"><a href="#cb6-13"></a>        </span>
<span id="cb6-14"><a href="#cb6-14"></a>        <span class="co"># 4. 실제 로직 (하위 클래스 구현)</span></span>
<span id="cb6-15"><a href="#cb6-15"></a>        result <span class="op">=</span> <span class="va">self</span>.process(<span class="bu">input</span>)</span>
<span id="cb6-16"><a href="#cb6-16"></a>        </span>
<span id="cb6-17"><a href="#cb6-17"></a>        <span class="co"># 5. 후처리 hook</span></span>
<span id="cb6-18"><a href="#cb6-18"></a>        result <span class="op">=</span> <span class="va">self</span>._post_process(result)</span>
<span id="cb6-19"><a href="#cb6-19"></a>        </span>
<span id="cb6-20"><a href="#cb6-20"></a>        <span class="co"># 6. 메트릭 수집</span></span>
<span id="cb6-21"><a href="#cb6-21"></a>        <span class="va">self</span>._collect_metrics(time.time() <span class="op">-</span> start_time)</span>
<span id="cb6-22"><a href="#cb6-22"></a>        </span>
<span id="cb6-23"><a href="#cb6-23"></a>        <span class="cf">return</span> result</span>
<span id="cb6-24"><a href="#cb6-24"></a>    </span>
<span id="cb6-25"><a href="#cb6-25"></a>    <span class="at">@abstractmethod</span></span>
<span id="cb6-26"><a href="#cb6-26"></a>    <span class="kw">def</span> process(<span class="va">self</span>, <span class="bu">input</span>: Dict[<span class="bu">str</span>, Any]) <span class="op">-&gt;</span> Dict[<span class="bu">str</span>, Any]:</span>
<span id="cb6-27"><a href="#cb6-27"></a>        <span class="co">"""하위 클래스가 구현해야 할 핵심 로직"""</span></span>
<span id="cb6-28"><a href="#cb6-28"></a>        <span class="cf">pass</span></span>
<span id="cb6-29"><a href="#cb6-29"></a></span>
<span id="cb6-30"><a href="#cb6-30"></a><span class="co"># Agent는 process()만 구현</span></span>
<span id="cb6-31"><a href="#cb6-31"></a><span class="kw">class</span> DataAgent(BaseAgent):</span>
<span id="cb6-32"><a href="#cb6-32"></a>    <span class="kw">def</span> process(<span class="va">self</span>, <span class="bu">input</span>):</span>
<span id="cb6-33"><a href="#cb6-33"></a>        <span class="co"># 비즈니스 로직만 집중</span></span>
<span id="cb6-34"><a href="#cb6-34"></a>        <span class="cf">return</span> {<span class="st">'result'</span>: standardized_data}</span></code><button title="클립보드 복사" class="code-copy-button"><i class="bi"></i></button></pre></div>
</section>
<section id="원칙-3-hook-methods" class="level3" data-number="2.1.3">
<h3 data-number="2.1.3" class="anchored" data-anchor-id="원칙-3-hook-methods"><span class="header-section-number">2.1.3</span> 원칙 3: Hook Methods</h3>
<p><strong>선택적 커스터마이징</strong>:</p>
<div class="sourceCode" id="cb7"><pre class="sourceCode numberSource python number-lines code-with-copy"><code class="sourceCode python"><span id="cb7-1"><a href="#cb7-1"></a><span class="kw">class</span> BaseAgent(ABC):</span>
<span id="cb7-2"><a href="#cb7-2"></a>    <span class="kw">def</span> _pre_process(<span class="va">self</span>, <span class="bu">input</span>: Dict[<span class="bu">str</span>, Any]) <span class="op">-&gt;</span> Dict[<span class="bu">str</span>, Any]:</span>
<span id="cb7-3"><a href="#cb7-3"></a>        <span class="co">"""전처리 hook (선택적 override)"""</span></span>
<span id="cb7-4"><a href="#cb7-4"></a>        <span class="cf">return</span> <span class="bu">input</span></span>
<span id="cb7-5"><a href="#cb7-5"></a>    </span>
<span id="cb7-6"><a href="#cb7-6"></a>    <span class="kw">def</span> _post_process(<span class="va">self</span>, output: Dict[<span class="bu">str</span>, Any]) <span class="op">-&gt;</span> Dict[<span class="bu">str</span>, Any]:</span>
<span id="cb7-7"><a href="#cb7-7"></a>        <span class="co">"""후처리 hook (선택적 override)"""</span></span>
<span id="cb7-8"><a href="#cb7-8"></a>        <span class="cf">return</span> output</span>
<span id="cb7-9"><a href="#cb7-9"></a></span>
<span id="cb7-10"><a href="#cb7-10"></a><span class="co"># Agent가 필요하면 override</span></span>
<span id="cb7-11"><a href="#cb7-11"></a><span class="kw">class</span> DataAgent(BaseAgent):</span>
<span id="cb7-12"><a href="#cb7-12"></a>    <span class="kw">def</span> _pre_process(<span class="va">self</span>, <span class="bu">input</span>):</span>
<span id="cb7-13"><a href="#cb7-13"></a>        <span class="co"># 입력 정규화</span></span>
<span id="cb7-14"><a href="#cb7-14"></a>        <span class="bu">input</span>[<span class="st">'data'</span>] <span class="op">=</span> <span class="bu">input</span>[<span class="st">'data'</span>].lower()</span>
<span id="cb7-15"><a href="#cb7-15"></a>        <span class="cf">return</span> <span class="bu">input</span></span>
<span id="cb7-16"><a href="#cb7-16"></a>    </span>
<span id="cb7-17"><a href="#cb7-17"></a>    <span class="kw">def</span> process(<span class="va">self</span>, <span class="bu">input</span>):</span>
<span id="cb7-18"><a href="#cb7-18"></a>        <span class="co"># 핵심 로직</span></span>
<span id="cb7-19"><a href="#cb7-19"></a>        <span class="cf">return</span> {<span class="st">'result'</span>: ...}</span></code><button title="클립보드 복사" class="code-copy-button"><i class="bi"></i></button></pre></div>
</section>
</section>
<section id="baseagent-전체-구현" class="level2" data-number="2.2">
<h2 data-number="2.2" class="anchored" data-anchor-id="baseagent-전체-구현"><span class="header-section-number">2.2</span> BaseAgent 전체 구현</h2>
<div class="sourceCode" id="cb8"><pre class="sourceCode numberSource python number-lines code-with-copy"><code class="sourceCode python"><span id="cb8-1"><a href="#cb8-1"></a><span class="co"># core/base_agent.py</span></span>
<span id="cb8-2"><a href="#cb8-2"></a><span class="im">from</span> abc <span class="im">import</span> ABC, abstractmethod</span>
<span id="cb8-3"><a href="#cb8-3"></a><span class="im">from</span> typing <span class="im">import</span> Dict, Any, Optional, List</span>
<span id="cb8-4"><a href="#cb8-4"></a><span class="im">from</span> dataclasses <span class="im">import</span> dataclass</span>
<span id="cb8-5"><a href="#cb8-5"></a><span class="im">import</span> time</span>
<span id="cb8-6"><a href="#cb8-6"></a><span class="im">import</span> logging</span>
<span id="cb8-7"><a href="#cb8-7"></a></span>
<span id="cb8-8"><a href="#cb8-8"></a>logger <span class="op">=</span> logging.getLogger(<span class="va">__name__</span>)</span>
<span id="cb8-9"><a href="#cb8-9"></a></span>
<span id="cb8-10"><a href="#cb8-10"></a><span class="at">@dataclass</span></span>
<span id="cb8-11"><a href="#cb8-11"></a><span class="kw">class</span> AgentMetadata:</span>
<span id="cb8-12"><a href="#cb8-12"></a>    <span class="co">"""Agent 메타데이터"""</span></span>
<span id="cb8-13"><a href="#cb8-13"></a>    name: <span class="bu">str</span></span>
<span id="cb8-14"><a href="#cb8-14"></a>    version: <span class="bu">str</span></span>
<span id="cb8-15"><a href="#cb8-15"></a>    domain: <span class="bu">str</span></span>
<span id="cb8-16"><a href="#cb8-16"></a>    description: <span class="bu">str</span></span>
<span id="cb8-17"><a href="#cb8-17"></a>    author: <span class="bu">str</span></span>
<span id="cb8-18"><a href="#cb8-18"></a>    created_at: <span class="bu">str</span></span>
<span id="cb8-19"><a href="#cb8-19"></a>    tags: List[<span class="bu">str</span>] <span class="op">=</span> <span class="va">None</span></span>
<span id="cb8-20"><a href="#cb8-20"></a></span>
<span id="cb8-21"><a href="#cb8-21"></a><span class="kw">class</span> AgentMetrics:</span>
<span id="cb8-22"><a href="#cb8-22"></a>    <span class="co">"""Agent 성능 메트릭"""</span></span>
<span id="cb8-23"><a href="#cb8-23"></a>    <span class="kw">def</span> <span class="fu">__init__</span>(<span class="va">self</span>):</span>
<span id="cb8-24"><a href="#cb8-24"></a>        <span class="va">self</span>.execution_count <span class="op">=</span> <span class="dv">0</span></span>
<span id="cb8-25"><a href="#cb8-25"></a>        <span class="va">self</span>.total_time <span class="op">=</span> <span class="fl">0.0</span></span>
<span id="cb8-26"><a href="#cb8-26"></a>        <span class="va">self</span>.errors: List[<span class="bu">str</span>] <span class="op">=</span> []</span>
<span id="cb8-27"><a href="#cb8-27"></a>        <span class="va">self</span>.success_count <span class="op">=</span> <span class="dv">0</span></span>
<span id="cb8-28"><a href="#cb8-28"></a>    </span>
<span id="cb8-29"><a href="#cb8-29"></a>    <span class="kw">def</span> record_success(<span class="va">self</span>, elapsed_time: <span class="bu">float</span>):</span>
<span id="cb8-30"><a href="#cb8-30"></a>        <span class="va">self</span>.execution_count <span class="op">+=</span> <span class="dv">1</span></span>
<span id="cb8-31"><a href="#cb8-31"></a>        <span class="va">self</span>.success_count <span class="op">+=</span> <span class="dv">1</span></span>
<span id="cb8-32"><a href="#cb8-32"></a>        <span class="va">self</span>.total_time <span class="op">+=</span> elapsed_time</span>
<span id="cb8-33"><a href="#cb8-33"></a>    </span>
<span id="cb8-34"><a href="#cb8-34"></a>    <span class="kw">def</span> record_error(<span class="va">self</span>, error: <span class="bu">str</span>):</span>
<span id="cb8-35"><a href="#cb8-35"></a>        <span class="va">self</span>.execution_count <span class="op">+=</span> <span class="dv">1</span></span>
<span id="cb8-36"><a href="#cb8-36"></a>        <span class="va">self</span>.errors.append(error)</span>
<span id="cb8-37"><a href="#cb8-37"></a>    </span>
<span id="cb8-38"><a href="#cb8-38"></a>    <span class="kw">def</span> get_stats(<span class="va">self</span>) <span class="op">-&gt;</span> Dict[<span class="bu">str</span>, Any]:</span>
<span id="cb8-39"><a href="#cb8-39"></a>        <span class="cf">return</span> {</span>
<span id="cb8-40"><a href="#cb8-40"></a>            <span class="st">'executions'</span>: <span class="va">self</span>.execution_count,</span>
<span id="cb8-41"><a href="#cb8-41"></a>            <span class="st">'success_rate'</span>: <span class="va">self</span>.success_count <span class="op">/</span> <span class="bu">max</span>(<span class="va">self</span>.execution_count, <span class="dv">1</span>),</span>
<span id="cb8-42"><a href="#cb8-42"></a>            <span class="st">'avg_time'</span>: <span class="va">self</span>.total_time <span class="op">/</span> <span class="bu">max</span>(<span class="va">self</span>.success_count, <span class="dv">1</span>),</span>
<span id="cb8-43"><a href="#cb8-43"></a>            <span class="st">'error_count'</span>: <span class="bu">len</span>(<span class="va">self</span>.errors)</span>
<span id="cb8-44"><a href="#cb8-44"></a>        }</span>
<span id="cb8-45"><a href="#cb8-45"></a></span>
<span id="cb8-46"><a href="#cb8-46"></a><span class="kw">class</span> BaseAgent(ABC):</span>
<span id="cb8-47"><a href="#cb8-47"></a>    <span class="co">"""모든 Agent의 기본 클래스</span></span>
<span id="cb8-48"><a href="#cb8-48"></a><span class="co">    </span></span>
<span id="cb8-49"><a href="#cb8-49"></a><span class="co">    설계 원칙:</span></span>
<span id="cb8-50"><a href="#cb8-50"></a><span class="co">    1. 표준 입출력: Dict[str, Any] (확장성)</span></span>
<span id="cb8-51"><a href="#cb8-51"></a><span class="co">    2. Template Method: execute()는 final</span></span>
<span id="cb8-52"><a href="#cb8-52"></a><span class="co">    3. Hook Methods: 선택적 커스터마이징</span></span>
<span id="cb8-53"><a href="#cb8-53"></a><span class="co">    4. 자동 메트릭: 성능 추적</span></span>
<span id="cb8-54"><a href="#cb8-54"></a><span class="co">    5. 평가 인터페이스: 도메인별 구현</span></span>
<span id="cb8-55"><a href="#cb8-55"></a><span class="co">    """</span></span>
<span id="cb8-56"><a href="#cb8-56"></a>    </span>
<span id="cb8-57"><a href="#cb8-57"></a>    <span class="kw">def</span> <span class="fu">__init__</span>(<span class="va">self</span>, metadata: AgentMetadata):</span>
<span id="cb8-58"><a href="#cb8-58"></a>        <span class="va">self</span>.metadata <span class="op">=</span> metadata</span>
<span id="cb8-59"><a href="#cb8-59"></a>        <span class="va">self</span>.metrics <span class="op">=</span> AgentMetrics()</span>
<span id="cb8-60"><a href="#cb8-60"></a>        logger.info(<span class="ss">f"Initialized Agent: </span><span class="sc">{</span>metadata<span class="sc">.</span>name<span class="sc">}</span><span class="ss"> v</span><span class="sc">{</span>metadata<span class="sc">.</span>version<span class="sc">}</span><span class="ss">"</span>)</span>
<span id="cb8-61"><a href="#cb8-61"></a>    </span>
<span id="cb8-62"><a href="#cb8-62"></a>    <span class="at">@abstractmethod</span></span>
<span id="cb8-63"><a href="#cb8-63"></a>    <span class="kw">def</span> process(<span class="va">self</span>, <span class="bu">input</span>: Dict[<span class="bu">str</span>, Any]) <span class="op">-&gt;</span> Dict[<span class="bu">str</span>, Any]:</span>
<span id="cb8-64"><a href="#cb8-64"></a>        <span class="co">"""핵심 비즈니스 로직 (하위 클래스 구현 필수)</span></span>
<span id="cb8-65"><a href="#cb8-65"></a><span class="co">        </span></span>
<span id="cb8-66"><a href="#cb8-66"></a><span class="co">        Args:</span></span>
<span id="cb8-67"><a href="#cb8-67"></a><span class="co">            input: 표준 입력 딕셔너리</span></span>
<span id="cb8-68"><a href="#cb8-68"></a><span class="co">                - task: 작업 유형</span></span>
<span id="cb8-69"><a href="#cb8-69"></a><span class="co">                - data: 실제 데이터</span></span>
<span id="cb8-70"><a href="#cb8-70"></a><span class="co">                - config: 실행 옵션 (선택)</span></span>
<span id="cb8-71"><a href="#cb8-71"></a><span class="co">                - metadata: 컨텍스트 (선택)</span></span>
<span id="cb8-72"><a href="#cb8-72"></a><span class="co">        </span></span>
<span id="cb8-73"><a href="#cb8-73"></a><span class="co">        Returns:</span></span>
<span id="cb8-74"><a href="#cb8-74"></a><span class="co">            표준 출력 딕셔너리</span></span>
<span id="cb8-75"><a href="#cb8-75"></a><span class="co">                - result: 실행 결과</span></span>
<span id="cb8-76"><a href="#cb8-76"></a><span class="co">                - confidence: 신뢰도 (0-1)</span></span>
<span id="cb8-77"><a href="#cb8-77"></a><span class="co">                - errors: 에러 목록 (선택)</span></span>
<span id="cb8-78"><a href="#cb8-78"></a><span class="co">        """</span></span>
<span id="cb8-79"><a href="#cb8-79"></a>        <span class="cf">pass</span></span>
<span id="cb8-80"><a href="#cb8-80"></a>    </span>
<span id="cb8-81"><a href="#cb8-81"></a>    <span class="at">@abstractmethod</span></span>
<span id="cb8-82"><a href="#cb8-82"></a>    <span class="kw">def</span> evaluate(<span class="va">self</span>, ground_truth: Any, prediction: Any) <span class="op">-&gt;</span> <span class="bu">float</span>:</span>
<span id="cb8-83"><a href="#cb8-83"></a>        <span class="co">"""성능 평가 (하위 클래스 구현 필수)</span></span>
<span id="cb8-84"><a href="#cb8-84"></a><span class="co">        </span></span>
<span id="cb8-85"><a href="#cb8-85"></a><span class="co">        각 Agent는 도메인에 맞는 평가 메트릭 구현</span></span>
<span id="cb8-86"><a href="#cb8-86"></a><span class="co">        </span></span>
<span id="cb8-87"><a href="#cb8-87"></a><span class="co">        Examples:</span></span>
<span id="cb8-88"><a href="#cb8-88"></a><span class="co">            - 데이터 표준화: 스키마 매칭 정확도</span></span>
<span id="cb8-89"><a href="#cb8-89"></a><span class="co">            - 코드 분석: AST 파싱 성공률</span></span>
<span id="cb8-90"><a href="#cb8-90"></a><span class="co">            - 지식 QnA: ROUGE 스코어</span></span>
<span id="cb8-91"><a href="#cb8-91"></a><span class="co">        </span></span>
<span id="cb8-92"><a href="#cb8-92"></a><span class="co">        Returns:</span></span>
<span id="cb8-93"><a href="#cb8-93"></a><span class="co">            평가 점수 (0-1)</span></span>
<span id="cb8-94"><a href="#cb8-94"></a><span class="co">        """</span></span>
<span id="cb8-95"><a href="#cb8-95"></a>        <span class="cf">pass</span></span>
<span id="cb8-96"><a href="#cb8-96"></a>    </span>
<span id="cb8-97"><a href="#cb8-97"></a>    <span class="kw">def</span> execute(<span class="va">self</span>, <span class="bu">input</span>: Dict[<span class="bu">str</span>, Any]) <span class="op">-&gt;</span> Dict[<span class="bu">str</span>, Any]:</span>
<span id="cb8-98"><a href="#cb8-98"></a>        <span class="co">"""Agent 실행 (Template Method - 수정 불가)</span></span>
<span id="cb8-99"><a href="#cb8-99"></a><span class="co">        </span></span>
<span id="cb8-100"><a href="#cb8-100"></a><span class="co">        실행 흐름:</span></span>
<span id="cb8-101"><a href="#cb8-101"></a><span class="co">        1. 입력 검증</span></span>
<span id="cb8-102"><a href="#cb8-102"></a><span class="co">        2. 전처리 hook</span></span>
<span id="cb8-103"><a href="#cb8-103"></a><span class="co">        3. 실제 process() 호출</span></span>
<span id="cb8-104"><a href="#cb8-104"></a><span class="co">        4. 후처리 hook</span></span>
<span id="cb8-105"><a href="#cb8-105"></a><span class="co">        5. 메트릭 수집</span></span>
<span id="cb8-106"><a href="#cb8-106"></a><span class="co">        6. 메타데이터 추가</span></span>
<span id="cb8-107"><a href="#cb8-107"></a><span class="co">        </span></span>
<span id="cb8-108"><a href="#cb8-108"></a><span class="co">        Returns:</span></span>
<span id="cb8-109"><a href="#cb8-109"></a><span class="co">            표준 출력 + 메타데이터</span></span>
<span id="cb8-110"><a href="#cb8-110"></a><span class="co">        """</span></span>
<span id="cb8-111"><a href="#cb8-111"></a>        <span class="cf">try</span>:</span>
<span id="cb8-112"><a href="#cb8-112"></a>            <span class="co"># 1. 입력 검증</span></span>
<span id="cb8-113"><a href="#cb8-113"></a>            <span class="va">self</span>._validate_input(<span class="bu">input</span>)</span>
<span id="cb8-114"><a href="#cb8-114"></a>            </span>
<span id="cb8-115"><a href="#cb8-115"></a>            <span class="co"># 2. 전처리</span></span>
<span id="cb8-116"><a href="#cb8-116"></a>            processed_input <span class="op">=</span> <span class="va">self</span>._pre_process(<span class="bu">input</span>)</span>
<span id="cb8-117"><a href="#cb8-117"></a>            </span>
<span id="cb8-118"><a href="#cb8-118"></a>            <span class="co"># 3. 시간 측정 시작</span></span>
<span id="cb8-119"><a href="#cb8-119"></a>            start_time <span class="op">=</span> time.time()</span>
<span id="cb8-120"><a href="#cb8-120"></a>            </span>
<span id="cb8-121"><a href="#cb8-121"></a>            <span class="co"># 4. 핵심 로직 실행</span></span>
<span id="cb8-122"><a href="#cb8-122"></a>            result <span class="op">=</span> <span class="va">self</span>.process(processed_input)</span>
<span id="cb8-123"><a href="#cb8-123"></a>            </span>
<span id="cb8-124"><a href="#cb8-124"></a>            <span class="co"># 5. 후처리</span></span>
<span id="cb8-125"><a href="#cb8-125"></a>            processed_result <span class="op">=</span> <span class="va">self</span>._post_process(result)</span>
<span id="cb8-126"><a href="#cb8-126"></a>            </span>
<span id="cb8-127"><a href="#cb8-127"></a>            <span class="co"># 6. 실행 시간 계산</span></span>
<span id="cb8-128"><a href="#cb8-128"></a>            elapsed <span class="op">=</span> time.time() <span class="op">-</span> start_time</span>
<span id="cb8-129"><a href="#cb8-129"></a>            </span>
<span id="cb8-130"><a href="#cb8-130"></a>            <span class="co"># 7. 메트릭 기록</span></span>
<span id="cb8-131"><a href="#cb8-131"></a>            <span class="va">self</span>.metrics.record_success(elapsed)</span>
<span id="cb8-132"><a href="#cb8-132"></a>            </span>
<span id="cb8-133"><a href="#cb8-133"></a>            <span class="co"># 8. 메타데이터 추가</span></span>
<span id="cb8-134"><a href="#cb8-134"></a>            processed_result[<span class="st">'metadata'</span>] <span class="op">=</span> {</span>
<span id="cb8-135"><a href="#cb8-135"></a>                <span class="st">'agent'</span>: <span class="va">self</span>.metadata.name,</span>
<span id="cb8-136"><a href="#cb8-136"></a>                <span class="st">'version'</span>: <span class="va">self</span>.metadata.version,</span>
<span id="cb8-137"><a href="#cb8-137"></a>                <span class="st">'execution_time'</span>: elapsed,</span>
<span id="cb8-138"><a href="#cb8-138"></a>                <span class="st">'timestamp'</span>: time.time()</span>
<span id="cb8-139"><a href="#cb8-139"></a>            }</span>
<span id="cb8-140"><a href="#cb8-140"></a>            </span>
<span id="cb8-141"><a href="#cb8-141"></a>            logger.info(<span class="ss">f"Agent </span><span class="sc">{</span><span class="va">self</span><span class="sc">.</span>metadata<span class="sc">.</span>name<span class="sc">}</span><span class="ss"> succeeded in </span><span class="sc">{</span>elapsed<span class="sc">:.2f}</span><span class="ss">s"</span>)</span>
<span id="cb8-142"><a href="#cb8-142"></a>            </span>
<span id="cb8-143"><a href="#cb8-143"></a>            <span class="cf">return</span> processed_result</span>
<span id="cb8-144"><a href="#cb8-144"></a>            </span>
<span id="cb8-145"><a href="#cb8-145"></a>        <span class="cf">except</span> <span class="pp">Exception</span> <span class="im">as</span> e:</span>
<span id="cb8-146"><a href="#cb8-146"></a>            error_msg <span class="op">=</span> <span class="ss">f"</span><span class="sc">{</span><span class="va">self</span><span class="sc">.</span>metadata<span class="sc">.</span>name<span class="sc">}</span><span class="ss"> failed: </span><span class="sc">{</span><span class="bu">str</span>(e)<span class="sc">}</span><span class="ss">"</span></span>
<span id="cb8-147"><a href="#cb8-147"></a>            logger.error(error_msg)</span>
<span id="cb8-148"><a href="#cb8-148"></a>            <span class="va">self</span>.metrics.record_error(error_msg)</span>
<span id="cb8-149"><a href="#cb8-149"></a>            <span class="cf">raise</span></span>
<span id="cb8-150"><a href="#cb8-150"></a>    </span>
<span id="cb8-151"><a href="#cb8-151"></a>    <span class="kw">def</span> _validate_input(<span class="va">self</span>, <span class="bu">input</span>: Dict[<span class="bu">str</span>, Any]):</span>
<span id="cb8-152"><a href="#cb8-152"></a>        <span class="co">"""입력 검증 (공통 규칙)"""</span></span>
<span id="cb8-153"><a href="#cb8-153"></a>        <span class="cf">if</span> <span class="kw">not</span> <span class="bu">isinstance</span>(<span class="bu">input</span>, <span class="bu">dict</span>):</span>
<span id="cb8-154"><a href="#cb8-154"></a>            <span class="cf">raise</span> <span class="pp">ValueError</span>(<span class="st">"Input must be a dictionary"</span>)</span>
<span id="cb8-155"><a href="#cb8-155"></a>        </span>
<span id="cb8-156"><a href="#cb8-156"></a>        <span class="cf">if</span> <span class="st">'task'</span> <span class="kw">not</span> <span class="kw">in</span> <span class="bu">input</span>:</span>
<span id="cb8-157"><a href="#cb8-157"></a>            <span class="cf">raise</span> <span class="pp">ValueError</span>(<span class="st">"Input must contain 'task' field"</span>)</span>
<span id="cb8-158"><a href="#cb8-158"></a>        </span>
<span id="cb8-159"><a href="#cb8-159"></a>        <span class="cf">if</span> <span class="st">'data'</span> <span class="kw">not</span> <span class="kw">in</span> <span class="bu">input</span>:</span>
<span id="cb8-160"><a href="#cb8-160"></a>            <span class="cf">raise</span> <span class="pp">ValueError</span>(<span class="st">"Input must contain 'data' field"</span>)</span>
<span id="cb8-161"><a href="#cb8-161"></a>    </span>
<span id="cb8-162"><a href="#cb8-162"></a>    <span class="kw">def</span> _pre_process(<span class="va">self</span>, <span class="bu">input</span>: Dict[<span class="bu">str</span>, Any]) <span class="op">-&gt;</span> Dict[<span class="bu">str</span>, Any]:</span>
<span id="cb8-163"><a href="#cb8-163"></a>        <span class="co">"""전처리 hook (선택적 override)</span></span>
<span id="cb8-164"><a href="#cb8-164"></a><span class="co">        </span></span>
<span id="cb8-165"><a href="#cb8-165"></a><span class="co">        예: 입력 정규화, 기본값 설정</span></span>
<span id="cb8-166"><a href="#cb8-166"></a><span class="co">        """</span></span>
<span id="cb8-167"><a href="#cb8-167"></a>        <span class="cf">return</span> <span class="bu">input</span></span>
<span id="cb8-168"><a href="#cb8-168"></a>    </span>
<span id="cb8-169"><a href="#cb8-169"></a>    <span class="kw">def</span> _post_process(<span class="va">self</span>, output: Dict[<span class="bu">str</span>, Any]) <span class="op">-&gt;</span> Dict[<span class="bu">str</span>, Any]:</span>
<span id="cb8-170"><a href="#cb8-170"></a>        <span class="co">"""후처리 hook (선택적 override)</span></span>
<span id="cb8-171"><a href="#cb8-171"></a><span class="co">        </span></span>
<span id="cb8-172"><a href="#cb8-172"></a><span class="co">        예: 출력 형식 변환, 에러 핸들링</span></span>
<span id="cb8-173"><a href="#cb8-173"></a><span class="co">        """</span></span>
<span id="cb8-174"><a href="#cb8-174"></a>        <span class="cf">return</span> output</span>
<span id="cb8-175"><a href="#cb8-175"></a>    </span>
<span id="cb8-176"><a href="#cb8-176"></a>    <span class="kw">def</span> get_metrics(<span class="va">self</span>) <span class="op">-&gt;</span> Dict[<span class="bu">str</span>, Any]:</span>
<span id="cb8-177"><a href="#cb8-177"></a>        <span class="co">"""Agent 성능 메트릭 조회"""</span></span>
<span id="cb8-178"><a href="#cb8-178"></a>        <span class="cf">return</span> {</span>
<span id="cb8-179"><a href="#cb8-179"></a>            <span class="st">'name'</span>: <span class="va">self</span>.metadata.name,</span>
<span id="cb8-180"><a href="#cb8-180"></a>            <span class="op">**</span><span class="va">self</span>.metrics.get_stats()</span>
<span id="cb8-181"><a href="#cb8-181"></a>        }</span>
<span id="cb8-182"><a href="#cb8-182"></a>    </span>
<span id="cb8-183"><a href="#cb8-183"></a>    <span class="kw">def</span> reset_metrics(<span class="va">self</span>):</span>
<span id="cb8-184"><a href="#cb8-184"></a>        <span class="co">"""메트릭 초기화"""</span></span>
<span id="cb8-185"><a href="#cb8-185"></a>        <span class="va">self</span>.metrics <span class="op">=</span> AgentMetrics()</span>
<span id="cb8-186"><a href="#cb8-186"></a>        logger.info(<span class="ss">f"Reset metrics for </span><span class="sc">{</span><span class="va">self</span><span class="sc">.</span>metadata<span class="sc">.</span>name<span class="sc">}</span><span class="ss">"</span>)</span></code><button title="클립보드 복사" class="code-copy-button"><i class="bi"></i></button></pre></div>
</section>
<section id="설계-의사결정-설명" class="level2" data-number="2.3">
<h2 data-number="2.3" class="anchored" data-anchor-id="설계-의사결정-설명"><span class="header-section-number">2.3</span> 설계 의사결정 설명</h2>
<section id="왜-dictstr-any인가" class="level3" data-number="2.3.1">
<h3 data-number="2.3.1" class="anchored" data-anchor-id="왜-dictstr-any인가"><span class="header-section-number">2.3.1</span> 왜 Dict[str, Any]인가?</h3>
<p><strong>대안 1: Pydantic 모델</strong></p>
<div class="sourceCode" id="cb9"><pre class="sourceCode numberSource python number-lines code-with-copy"><code class="sourceCode python"><span id="cb9-1"><a href="#cb9-1"></a><span class="kw">class</span> AgentInput(BaseModel):</span>
<span id="cb9-2"><a href="#cb9-2"></a>    task: <span class="bu">str</span></span>
<span id="cb9-3"><a href="#cb9-3"></a>    data: Dict[<span class="bu">str</span>, Any]</span>
<span id="cb9-4"><a href="#cb9-4"></a>    config: Optional[Dict[<span class="bu">str</span>, Any]]</span>
<span id="cb9-5"><a href="#cb9-5"></a></span>
<span id="cb9-6"><a href="#cb9-6"></a><span class="kw">class</span> BaseAgent(ABC):</span>
<span id="cb9-7"><a href="#cb9-7"></a>    <span class="kw">def</span> process(<span class="va">self</span>, <span class="bu">input</span>: AgentInput) <span class="op">-&gt;</span> AgentOutput:</span>
<span id="cb9-8"><a href="#cb9-8"></a>        <span class="cf">pass</span></span></code><button title="클립보드 복사" class="code-copy-button"><i class="bi"></i></button></pre></div>
<p><strong>문제</strong>: - 타입이 고정됨 → 새 필드 추가 시 BaseAgent 수정 필요 - Agent마다 다른 입력 필요 시 상속 계층 복잡</p>
<p><strong>Dict[str, Any]의 장점</strong>: - 확장성: 새 필드 자유롭게 추가 - Agent별 커스터마이징 가능 - JSON 직렬화 간단</p>
<p><strong>트레이드오프</strong>: - 타입 안전성 낮음 - IDE 자동완성 없음</p>
<p><strong>해결책</strong>: 문서화 + 런타임 검증</p>
<div class="sourceCode" id="cb10"><pre class="sourceCode numberSource python number-lines code-with-copy"><code class="sourceCode python"><span id="cb10-1"><a href="#cb10-1"></a><span class="kw">def</span> _validate_input(<span class="va">self</span>, <span class="bu">input</span>: Dict[<span class="bu">str</span>, Any]):</span>
<span id="cb10-2"><a href="#cb10-2"></a>    <span class="co">"""입력 검증으로 타입 안전성 보완"""</span></span>
<span id="cb10-3"><a href="#cb10-3"></a>    required_fields <span class="op">=</span> [<span class="st">'task'</span>, <span class="st">'data'</span>]</span>
<span id="cb10-4"><a href="#cb10-4"></a>    <span class="cf">for</span> field <span class="kw">in</span> required_fields:</span>
<span id="cb10-5"><a href="#cb10-5"></a>        <span class="cf">if</span> field <span class="kw">not</span> <span class="kw">in</span> <span class="bu">input</span>:</span>
<span id="cb10-6"><a href="#cb10-6"></a>            <span class="cf">raise</span> <span class="pp">ValueError</span>(<span class="ss">f"Missing required field: </span><span class="sc">{</span>field<span class="sc">}</span><span class="ss">"</span>)</span></code><button title="클립보드 복사" class="code-copy-button"><i class="bi"></i></button></pre></div>
</section>
<section id="왜-execute와-process를-분리하는가" class="level3" data-number="2.3.2">
<h3 data-number="2.3.2" class="anchored" data-anchor-id="왜-execute와-process를-분리하는가"><span class="header-section-number">2.3.2</span> 왜 execute()와 process()를 분리하는가?</h3>
<p><strong>Template Method Pattern의 핵심</strong>:</p>
<div class="sourceCode" id="cb11"><pre class="sourceCode numberSource python number-lines code-with-copy"><code class="sourceCode python"><span id="cb11-1"><a href="#cb11-1"></a><span class="co"># execute(): BaseAgent가 제어 (final)</span></span>
<span id="cb11-2"><a href="#cb11-2"></a><span class="kw">def</span> execute(<span class="va">self</span>, <span class="bu">input</span>):</span>
<span id="cb11-3"><a href="#cb11-3"></a>    <span class="va">self</span>._validate_input(<span class="bu">input</span>)  <span class="co"># 공통 로직</span></span>
<span id="cb11-4"><a href="#cb11-4"></a>    result <span class="op">=</span> <span class="va">self</span>.process(<span class="bu">input</span>)  <span class="co"># 하위 클래스 로직</span></span>
<span id="cb11-5"><a href="#cb11-5"></a>    <span class="va">self</span>._collect_metrics()       <span class="co"># 공통 로직</span></span>
<span id="cb11-6"><a href="#cb11-6"></a>    <span class="cf">return</span> result</span>
<span id="cb11-7"><a href="#cb11-7"></a></span>
<span id="cb11-8"><a href="#cb11-8"></a><span class="co"># process(): 하위 클래스가 구현</span></span>
<span id="cb11-9"><a href="#cb11-9"></a><span class="at">@abstractmethod</span></span>
<span id="cb11-10"><a href="#cb11-10"></a><span class="kw">def</span> process(<span class="va">self</span>, <span class="bu">input</span>):</span>
<span id="cb11-11"><a href="#cb11-11"></a>    <span class="cf">pass</span></span></code><button title="클립보드 복사" class="code-copy-button"><i class="bi"></i></button></pre></div>
<p><strong>이점</strong>: 1. <strong>일관성</strong>: 모든 Agent가 검증, 메트릭 수집 자동 수행 2. <strong>단순성</strong>: Agent 개발자는 process()만 구현 3. <strong>안전성</strong>: 공통 로직 수정 시 모든 Agent에 자동 반영</p>
</section>
<section id="왜-evaluate를-인터페이스에-포함하는가" class="level3" data-number="2.3.3">
<h3 data-number="2.3.3" class="anchored" data-anchor-id="왜-evaluate를-인터페이스에-포함하는가"><span class="header-section-number">2.3.3</span> 왜 evaluate()를 인터페이스에 포함하는가?</h3>
<p><strong>문제</strong>: 각 Agent의 성능을 어떻게 측정?</p>
<div class="sourceCode" id="cb12"><pre class="sourceCode numberSource python number-lines code-with-copy"><code class="sourceCode python"><span id="cb12-1"><a href="#cb12-1"></a><span class="co"># ❌ 나쁜 예: 평가 로직이 Agent 밖에 있음</span></span>
<span id="cb12-2"><a href="#cb12-2"></a><span class="kw">def</span> evaluate_data_agent(agent, test_data):</span>
<span id="cb12-3"><a href="#cb12-3"></a>    <span class="co"># 평가 로직이 외부에 있어 유지보수 어려움</span></span>
<span id="cb12-4"><a href="#cb12-4"></a>    ...</span>
<span id="cb12-5"><a href="#cb12-5"></a></span>
<span id="cb12-6"><a href="#cb12-6"></a><span class="kw">def</span> evaluate_code_agent(agent, test_data):</span>
<span id="cb12-7"><a href="#cb12-7"></a>    <span class="co"># 다른 평가 로직 (중복)</span></span>
<span id="cb12-8"><a href="#cb12-8"></a>    ...</span></code><button title="클립보드 복사" class="code-copy-button"><i class="bi"></i></button></pre></div>
<p><strong>해결</strong>: Agent가 자신의 평가 방법 정의</p>
<div class="sourceCode" id="cb13"><pre class="sourceCode numberSource python number-lines code-with-copy"><code class="sourceCode python"><span id="cb13-1"><a href="#cb13-1"></a><span class="co"># ✅ 좋은 예: Agent가 evaluate() 구현</span></span>
<span id="cb13-2"><a href="#cb13-2"></a><span class="kw">class</span> DataAgent(BaseAgent):</span>
<span id="cb13-3"><a href="#cb13-3"></a>    <span class="kw">def</span> evaluate(<span class="va">self</span>, ground_truth, prediction):</span>
<span id="cb13-4"><a href="#cb13-4"></a>        <span class="co"># 스키마 매칭 정확도</span></span>
<span id="cb13-5"><a href="#cb13-5"></a>        <span class="cf">return</span> schema_matching_score(ground_truth, prediction)</span>
<span id="cb13-6"><a href="#cb13-6"></a></span>
<span id="cb13-7"><a href="#cb13-7"></a><span class="kw">class</span> CodeAgent(BaseAgent):</span>
<span id="cb13-8"><a href="#cb13-8"></a>    <span class="kw">def</span> evaluate(<span class="va">self</span>, ground_truth, prediction):</span>
<span id="cb13-9"><a href="#cb13-9"></a>        <span class="co"># AST 파싱 성공률</span></span>
<span id="cb13-10"><a href="#cb13-10"></a>        <span class="cf">return</span> ast_parsing_success_rate(ground_truth, prediction)</span>
<span id="cb13-11"><a href="#cb13-11"></a></span>
<span id="cb13-12"><a href="#cb13-12"></a><span class="co"># 플랫폼이 일관되게 평가</span></span>
<span id="cb13-13"><a href="#cb13-13"></a><span class="cf">for</span> agent <span class="kw">in</span> agents:</span>
<span id="cb13-14"><a href="#cb13-14"></a>    score <span class="op">=</span> agent.evaluate(test_data.truth, test_data.pred)</span>
<span id="cb13-15"><a href="#cb13-15"></a>    <span class="bu">print</span>(<span class="ss">f"</span><span class="sc">{</span>agent<span class="sc">.</span>metadata<span class="sc">.</span>name<span class="sc">}</span><span class="ss">: </span><span class="sc">{</span>score<span class="sc">:.2f}</span><span class="ss">"</span>)</span></code><button title="클립보드 복사" class="code-copy-button"><i class="bi"></i></button></pre></div>
</section>
</section>
</section>
<section id="agentregistry-dependency-inversion-구현" class="level1" data-number="3">
<h1 data-number="3"><span class="header-section-number">3</span> AgentRegistry: Dependency Inversion 구현</h1>
<section id="문제-core가-agent에-의존하면" class="level2" data-number="3.1">
<h2 data-number="3.1" class="anchored" data-anchor-id="문제-core가-agent에-의존하면"><span class="header-section-number">3.1</span> 문제: Core가 Agent에 의존하면?</h2>
<div class="sourceCode" id="cb14"><pre class="sourceCode numberSource python number-lines code-with-copy"><code class="sourceCode python"><span id="cb14-1"><a href="#cb14-1"></a><span class="co"># ❌ 나쁜 예: Orchestrator가 Agent를 직접 import</span></span>
<span id="cb14-2"><a href="#cb14-2"></a><span class="co"># core/orchestrator.py</span></span>
<span id="cb14-3"><a href="#cb14-3"></a><span class="im">from</span> agents.data_standardization <span class="im">import</span> DataAgent</span>
<span id="cb14-4"><a href="#cb14-4"></a><span class="im">from</span> agents.code_analysis <span class="im">import</span> CodeAgent</span>
<span id="cb14-5"><a href="#cb14-5"></a><span class="im">from</span> agents.knowledge_qna <span class="im">import</span> KnowledgeAgent</span>
<span id="cb14-6"><a href="#cb14-6"></a></span>
<span id="cb14-7"><a href="#cb14-7"></a><span class="kw">class</span> Orchestrator:</span>
<span id="cb14-8"><a href="#cb14-8"></a>    <span class="kw">def</span> <span class="fu">__init__</span>(<span class="va">self</span>):</span>
<span id="cb14-9"><a href="#cb14-9"></a>        <span class="va">self</span>.agents <span class="op">=</span> [</span>
<span id="cb14-10"><a href="#cb14-10"></a>            DataAgent(),</span>
<span id="cb14-11"><a href="#cb14-11"></a>            CodeAgent(),</span>
<span id="cb14-12"><a href="#cb14-12"></a>            KnowledgeAgent()</span>
<span id="cb14-13"><a href="#cb14-13"></a>        ]</span>
<span id="cb14-14"><a href="#cb14-14"></a>    </span>
<span id="cb14-15"><a href="#cb14-15"></a>    <span class="kw">def</span> add_agent(<span class="va">self</span>, agent):</span>
<span id="cb14-16"><a href="#cb14-16"></a>        <span class="co"># 새 Agent 추가 시 이 파일 수정 필요</span></span>
<span id="cb14-17"><a href="#cb14-17"></a>        <span class="co"># → Core 모듈이 불안정해짐</span></span>
<span id="cb14-18"><a href="#cb14-18"></a>        <span class="cf">pass</span></span></code><button title="클립보드 복사" class="code-copy-button"><i class="bi"></i></button></pre></div>
<p><strong>문제점</strong>: 1. Core → Agents 의존 (의존성 방향 위반) 2. 새 Agent 추가 시 Core 코드 수정 3. 순환 의존 가능성</p>
</section>
<section id="해결-registry-pattern" class="level2" data-number="3.2">
<h2 data-number="3.2" class="anchored" data-anchor-id="해결-registry-pattern"><span class="header-section-number">3.2</span> 해결: Registry Pattern</h2>
<div class="sourceCode" id="cb15"><pre class="sourceCode numberSource python number-lines code-with-copy"><code class="sourceCode python"><span id="cb15-1"><a href="#cb15-1"></a><span class="co"># ✅ 좋은 예: Agent가 스스로 등록</span></span>
<span id="cb15-2"><a href="#cb15-2"></a><span class="co"># core/registry.py</span></span>
<span id="cb15-3"><a href="#cb15-3"></a><span class="kw">class</span> AgentRegistry:</span>
<span id="cb15-4"><a href="#cb15-4"></a>    <span class="co">"""Agent 등록 및 조회 (Singleton)"""</span></span>
<span id="cb15-5"><a href="#cb15-5"></a>    </span>
<span id="cb15-6"><a href="#cb15-6"></a>    _instance <span class="op">=</span> <span class="va">None</span></span>
<span id="cb15-7"><a href="#cb15-7"></a>    _agents: Dict[<span class="bu">str</span>, BaseAgent] <span class="op">=</span> {}</span>
<span id="cb15-8"><a href="#cb15-8"></a>    </span>
<span id="cb15-9"><a href="#cb15-9"></a>    <span class="at">@classmethod</span></span>
<span id="cb15-10"><a href="#cb15-10"></a>    <span class="kw">def</span> get_instance(cls):</span>
<span id="cb15-11"><a href="#cb15-11"></a>        <span class="cf">if</span> cls._instance <span class="kw">is</span> <span class="va">None</span>:</span>
<span id="cb15-12"><a href="#cb15-12"></a>            cls._instance <span class="op">=</span> cls()</span>
<span id="cb15-13"><a href="#cb15-13"></a>        <span class="cf">return</span> cls._instance</span>
<span id="cb15-14"><a href="#cb15-14"></a>    </span>
<span id="cb15-15"><a href="#cb15-15"></a>    <span class="kw">def</span> register(<span class="va">self</span>, agent: BaseAgent):</span>
<span id="cb15-16"><a href="#cb15-16"></a>        <span class="co">"""Agent 등록"""</span></span>
<span id="cb15-17"><a href="#cb15-17"></a>        name <span class="op">=</span> agent.metadata.name</span>
<span id="cb15-18"><a href="#cb15-18"></a>        </span>
<span id="cb15-19"><a href="#cb15-19"></a>        <span class="cf">if</span> name <span class="kw">in</span> <span class="va">self</span>._agents:</span>
<span id="cb15-20"><a href="#cb15-20"></a>            <span class="cf">raise</span> <span class="pp">ValueError</span>(<span class="ss">f"Agent </span><span class="sc">{</span>name<span class="sc">}</span><span class="ss"> already registered"</span>)</span>
<span id="cb15-21"><a href="#cb15-21"></a>        </span>
<span id="cb15-22"><a href="#cb15-22"></a>        <span class="va">self</span>._agents[name] <span class="op">=</span> agent</span>
<span id="cb15-23"><a href="#cb15-23"></a>        logger.info(<span class="ss">f"✓ Registered: </span><span class="sc">{</span>name<span class="sc">}</span><span class="ss"> v</span><span class="sc">{</span>agent<span class="sc">.</span>metadata<span class="sc">.</span>version<span class="sc">}</span><span class="ss">"</span>)</span>
<span id="cb15-24"><a href="#cb15-24"></a>    </span>
<span id="cb15-25"><a href="#cb15-25"></a>    <span class="kw">def</span> get(<span class="va">self</span>, name: <span class="bu">str</span>) <span class="op">-&gt;</span> BaseAgent:</span>
<span id="cb15-26"><a href="#cb15-26"></a>        <span class="co">"""Agent 조회"""</span></span>
<span id="cb15-27"><a href="#cb15-27"></a>        <span class="cf">if</span> name <span class="kw">not</span> <span class="kw">in</span> <span class="va">self</span>._agents:</span>
<span id="cb15-28"><a href="#cb15-28"></a>            available <span class="op">=</span> <span class="st">', '</span>.join(<span class="va">self</span>._agents.keys())</span>
<span id="cb15-29"><a href="#cb15-29"></a>            <span class="cf">raise</span> <span class="pp">ValueError</span>(<span class="ss">f"Agent </span><span class="sc">{</span>name<span class="sc">}</span><span class="ss"> not found. Available: </span><span class="sc">{</span>available<span class="sc">}</span><span class="ss">"</span>)</span>
<span id="cb15-30"><a href="#cb15-30"></a>        </span>
<span id="cb15-31"><a href="#cb15-31"></a>        <span class="cf">return</span> <span class="va">self</span>._agents[name]</span>
<span id="cb15-32"><a href="#cb15-32"></a>    </span>
<span id="cb15-33"><a href="#cb15-33"></a>    <span class="kw">def</span> list_all(<span class="va">self</span>) <span class="op">-&gt;</span> Dict[<span class="bu">str</span>, BaseAgent]:</span>
<span id="cb15-34"><a href="#cb15-34"></a>        <span class="co">"""모든 Agent 목록"""</span></span>
<span id="cb15-35"><a href="#cb15-35"></a>        <span class="cf">return</span> <span class="va">self</span>._agents.copy()</span>
<span id="cb15-36"><a href="#cb15-36"></a>    </span>
<span id="cb15-37"><a href="#cb15-37"></a>    <span class="kw">def</span> unregister(<span class="va">self</span>, name: <span class="bu">str</span>):</span>
<span id="cb15-38"><a href="#cb15-38"></a>        <span class="co">"""Agent 제거 (테스트용)"""</span></span>
<span id="cb15-39"><a href="#cb15-39"></a>        <span class="cf">if</span> name <span class="kw">in</span> <span class="va">self</span>._agents:</span>
<span id="cb15-40"><a href="#cb15-40"></a>            <span class="kw">del</span> <span class="va">self</span>._agents[name]</span>
<span id="cb15-41"><a href="#cb15-41"></a>            logger.info(<span class="ss">f"✗ Unregistered: </span><span class="sc">{</span>name<span class="sc">}</span><span class="ss">"</span>)</span>
<span id="cb15-42"><a href="#cb15-42"></a></span>
<span id="cb15-43"><a href="#cb15-43"></a><span class="co"># agents/data_standardization/__init__.py</span></span>
<span id="cb15-44"><a href="#cb15-44"></a><span class="im">from</span> core.registry <span class="im">import</span> AgentRegistry</span>
<span id="cb15-45"><a href="#cb15-45"></a><span class="im">from</span> core.base_agent <span class="im">import</span> AgentMetadata</span>
<span id="cb15-46"><a href="#cb15-46"></a><span class="im">from</span> .agent <span class="im">import</span> DataAgent</span>
<span id="cb15-47"><a href="#cb15-47"></a></span>
<span id="cb15-48"><a href="#cb15-48"></a><span class="co"># 모듈 import 시 자동 등록</span></span>
<span id="cb15-49"><a href="#cb15-49"></a>metadata <span class="op">=</span> AgentMetadata(</span>
<span id="cb15-50"><a href="#cb15-50"></a>    name<span class="op">=</span><span class="st">"data_standardization"</span>,</span>
<span id="cb15-51"><a href="#cb15-51"></a>    version<span class="op">=</span><span class="st">"1.0.0"</span>,</span>
<span id="cb15-52"><a href="#cb15-52"></a>    domain<span class="op">=</span><span class="st">"data"</span>,</span>
<span id="cb15-53"><a href="#cb15-53"></a>    description<span class="op">=</span><span class="st">"데이터 스키마 표준화"</span>,</span>
<span id="cb15-54"><a href="#cb15-54"></a>    author<span class="op">=</span><span class="st">"Platform Team"</span>,</span>
<span id="cb15-55"><a href="#cb15-55"></a>    created_at<span class="op">=</span><span class="st">"2026-02-02"</span></span>
<span id="cb15-56"><a href="#cb15-56"></a>)</span>
<span id="cb15-57"><a href="#cb15-57"></a>agent <span class="op">=</span> DataAgent(metadata)</span>
<span id="cb15-58"><a href="#cb15-58"></a>AgentRegistry.get_instance().register(agent)</span>
<span id="cb15-59"><a href="#cb15-59"></a></span>
<span id="cb15-60"><a href="#cb15-60"></a><span class="co"># core/orchestrator.py</span></span>
<span id="cb15-61"><a href="#cb15-61"></a><span class="kw">class</span> Orchestrator:</span>
<span id="cb15-62"><a href="#cb15-62"></a>    <span class="kw">def</span> <span class="fu">__init__</span>(<span class="va">self</span>):</span>
<span id="cb15-63"><a href="#cb15-63"></a>        <span class="va">self</span>.registry <span class="op">=</span> AgentRegistry.get_instance()</span>
<span id="cb15-64"><a href="#cb15-64"></a>    </span>
<span id="cb15-65"><a href="#cb15-65"></a>    <span class="kw">def</span> run(<span class="va">self</span>, agent_name: <span class="bu">str</span>, <span class="bu">input</span>: Dict) <span class="op">-&gt;</span> Dict:</span>
<span id="cb15-66"><a href="#cb15-66"></a>        <span class="co"># Agent를 직접 import하지 않음</span></span>
<span id="cb15-67"><a href="#cb15-67"></a>        agent <span class="op">=</span> <span class="va">self</span>.registry.get(agent_name)</span>
<span id="cb15-68"><a href="#cb15-68"></a>        <span class="cf">return</span> agent.execute(<span class="bu">input</span>)</span></code><button title="클립보드 복사" class="code-copy-button"><i class="bi"></i></button></pre></div>
<p><strong>의존성 방향</strong>:</p>
<pre><code>agents/data_standardization/ → core/registry.py ✅
core/orchestrator.py → agents/ ❌ (불가능, import 없음)</code></pre>
</section>
<section id="실전-예시-agent-추가" class="level2" data-number="3.3">
<h2 data-number="3.3" class="anchored" data-anchor-id="실전-예시-agent-추가"><span class="header-section-number">3.3</span> 실전 예시: Agent 추가</h2>
<p><strong>새 Agent 추가 시 Core 수정 불필요</strong>:</p>
<div class="sourceCode" id="cb17"><pre class="sourceCode numberSource bash number-lines code-with-copy"><code class="sourceCode bash"><span id="cb17-1"><a href="#cb17-1"></a><span class="co"># 1. 새 Agent 디렉토리 생성</span></span>
<span id="cb17-2"><a href="#cb17-2"></a><span class="fu">mkdir</span> agents/recommendation</span>
<span id="cb17-3"><a href="#cb17-3"></a></span>
<span id="cb17-4"><a href="#cb17-4"></a><span class="co"># 2. Agent 구현</span></span>
<span id="cb17-5"><a href="#cb17-5"></a><span class="co"># agents/recommendation/agent.py</span></span>
<span id="cb17-6"><a href="#cb17-6"></a><span class="ex">class</span> RecommendationAgent<span class="er">(</span><span class="ex">BaseAgent</span><span class="kw">)</span><span class="bu">:</span></span>
<span id="cb17-7"><a href="#cb17-7"></a>    <span class="ex">def</span> process<span class="er">(</span><span class="ex">self,</span> input<span class="kw">)</span><span class="bu">:</span></span>
<span id="cb17-8"><a href="#cb17-8"></a>        <span class="cf">return</span> <span class="ex">{</span><span class="st">'result'</span><span class="ex">:</span> recommendations}</span>
<span id="cb17-9"><a href="#cb17-9"></a>    </span>
<span id="cb17-10"><a href="#cb17-10"></a>    <span class="ex">def</span> evaluate<span class="er">(</span><span class="ex">self,</span> truth, pred<span class="kw">)</span><span class="bu">:</span></span>
<span id="cb17-11"><a href="#cb17-11"></a>        <span class="cf">return</span> <span class="ex">accuracy_score</span><span class="er">(</span><span class="ex">truth,</span> pred<span class="kw">)</span></span>
<span id="cb17-12"><a href="#cb17-12"></a></span>
<span id="cb17-13"><a href="#cb17-13"></a><span class="co"># 3. 자동 등록</span></span>
<span id="cb17-14"><a href="#cb17-14"></a><span class="co"># agents/recommendation/__init__.py</span></span>
<span id="cb17-15"><a href="#cb17-15"></a><span class="ex">metadata</span> = AgentMetadata<span class="er">(</span><span class="va">name</span><span class="op">=</span><span class="st">"recommendation"</span>, <span class="ex">...</span><span class="kw">)</span></span>
<span id="cb17-16"><a href="#cb17-16"></a><span class="ex">agent</span> = RecommendationAgent<span class="er">(</span><span class="ex">metadata</span><span class="kw">)</span></span>
<span id="cb17-17"><a href="#cb17-17"></a><span class="fu">AgentRegistry.get_instance()</span><span class="ex">.register</span><span class="er">(</span><span class="ex">agent</span><span class="kw">)</span></span>
<span id="cb17-18"><a href="#cb17-18"></a></span>
<span id="cb17-19"><a href="#cb17-19"></a><span class="co"># 4. 즉시 사용 가능 (Core 수정 없음)</span></span>
<span id="cb17-20"><a href="#cb17-20"></a><span class="ex">orchestrator</span> = Orchestrator<span class="er">(</span><span class="kw">)</span></span>
<span id="cb17-21"><a href="#cb17-21"></a><span class="ex">result</span> = orchestrator.run<span class="er">(</span><span class="st">"recommendation"</span><span class="ex">,</span> input_data<span class="kw">)</span></span></code><button title="클립보드 복사" class="code-copy-button"><i class="bi"></i></button></pre></div>
</section>
</section>
<section id="orchestrator-agent-실행-관리" class="level1" data-number="4">
<h1 data-number="4"><span class="header-section-number">4</span> Orchestrator: Agent 실행 관리</h1>
<section id="단일-agent-실행" class="level2" data-number="4.1">
<h2 data-number="4.1" class="anchored" data-anchor-id="단일-agent-실행"><span class="header-section-number">4.1</span> 단일 Agent 실행</h2>
<div class="sourceCode" id="cb18"><pre class="sourceCode numberSource python number-lines code-with-copy"><code class="sourceCode python"><span id="cb18-1"><a href="#cb18-1"></a><span class="co"># core/orchestrator.py</span></span>
<span id="cb18-2"><a href="#cb18-2"></a><span class="im">from</span> typing <span class="im">import</span> Dict, List, Any</span>
<span id="cb18-3"><a href="#cb18-3"></a><span class="im">from</span> .registry <span class="im">import</span> AgentRegistry</span>
<span id="cb18-4"><a href="#cb18-4"></a><span class="im">import</span> logging</span>
<span id="cb18-5"><a href="#cb18-5"></a></span>
<span id="cb18-6"><a href="#cb18-6"></a>logger <span class="op">=</span> logging.getLogger(<span class="va">__name__</span>)</span>
<span id="cb18-7"><a href="#cb18-7"></a></span>
<span id="cb18-8"><a href="#cb18-8"></a><span class="kw">class</span> AgentOrchestrator:</span>
<span id="cb18-9"><a href="#cb18-9"></a>    <span class="co">"""Agent 실행 및 조율</span></span>
<span id="cb18-10"><a href="#cb18-10"></a><span class="co">    </span></span>
<span id="cb18-11"><a href="#cb18-11"></a><span class="co">    기능:</span></span>
<span id="cb18-12"><a href="#cb18-12"></a><span class="co">    1. 단일 Agent 실행</span></span>
<span id="cb18-13"><a href="#cb18-13"></a><span class="co">    2. Agent 체이닝 (순차 실행)</span></span>
<span id="cb18-14"><a href="#cb18-14"></a><span class="co">    3. 병렬 실행</span></span>
<span id="cb18-15"><a href="#cb18-15"></a><span class="co">    4. 조건부 실행</span></span>
<span id="cb18-16"><a href="#cb18-16"></a><span class="co">    """</span></span>
<span id="cb18-17"><a href="#cb18-17"></a>    </span>
<span id="cb18-18"><a href="#cb18-18"></a>    <span class="kw">def</span> <span class="fu">__init__</span>(<span class="va">self</span>):</span>
<span id="cb18-19"><a href="#cb18-19"></a>        <span class="va">self</span>.registry <span class="op">=</span> AgentRegistry.get_instance()</span>
<span id="cb18-20"><a href="#cb18-20"></a>    </span>
<span id="cb18-21"><a href="#cb18-21"></a>    <span class="kw">def</span> run(</span>
<span id="cb18-22"><a href="#cb18-22"></a>        <span class="va">self</span>,</span>
<span id="cb18-23"><a href="#cb18-23"></a>        agent_name: <span class="bu">str</span>,</span>
<span id="cb18-24"><a href="#cb18-24"></a>        input_data: Dict[<span class="bu">str</span>, Any],</span>
<span id="cb18-25"><a href="#cb18-25"></a>        timeout: Optional[<span class="bu">float</span>] <span class="op">=</span> <span class="va">None</span></span>
<span id="cb18-26"><a href="#cb18-26"></a>    ) <span class="op">-&gt;</span> Dict[<span class="bu">str</span>, Any]:</span>
<span id="cb18-27"><a href="#cb18-27"></a>        <span class="co">"""단일 Agent 실행</span></span>
<span id="cb18-28"><a href="#cb18-28"></a><span class="co">        </span></span>
<span id="cb18-29"><a href="#cb18-29"></a><span class="co">        Args:</span></span>
<span id="cb18-30"><a href="#cb18-30"></a><span class="co">            agent_name: Agent 이름</span></span>
<span id="cb18-31"><a href="#cb18-31"></a><span class="co">            input_data: 입력 데이터</span></span>
<span id="cb18-32"><a href="#cb18-32"></a><span class="co">            timeout: 타임아웃 (초)</span></span>
<span id="cb18-33"><a href="#cb18-33"></a><span class="co">        </span></span>
<span id="cb18-34"><a href="#cb18-34"></a><span class="co">        Returns:</span></span>
<span id="cb18-35"><a href="#cb18-35"></a><span class="co">            Agent 실행 결과</span></span>
<span id="cb18-36"><a href="#cb18-36"></a><span class="co">        """</span></span>
<span id="cb18-37"><a href="#cb18-37"></a>        logger.info(<span class="ss">f"Running agent: </span><span class="sc">{</span>agent_name<span class="sc">}</span><span class="ss">"</span>)</span>
<span id="cb18-38"><a href="#cb18-38"></a>        </span>
<span id="cb18-39"><a href="#cb18-39"></a>        agent <span class="op">=</span> <span class="va">self</span>.registry.get(agent_name)</span>
<span id="cb18-40"><a href="#cb18-40"></a>        result <span class="op">=</span> agent.execute(input_data)</span>
<span id="cb18-41"><a href="#cb18-41"></a>        </span>
<span id="cb18-42"><a href="#cb18-42"></a>        logger.info(<span class="ss">f"Agent </span><span class="sc">{</span>agent_name<span class="sc">}</span><span class="ss"> completed"</span>)</span>
<span id="cb18-43"><a href="#cb18-43"></a>        <span class="cf">return</span> result</span></code><button title="클립보드 복사" class="code-copy-button"><i class="bi"></i></button></pre></div>
</section>
<section id="agent-체이닝" class="level2" data-number="4.2">
<h2 data-number="4.2" class="anchored" data-anchor-id="agent-체이닝"><span class="header-section-number">4.2</span> Agent 체이닝</h2>
<div class="sourceCode" id="cb19"><pre class="sourceCode numberSource python number-lines code-with-copy"><code class="sourceCode python"><span id="cb19-1"><a href="#cb19-1"></a><span class="kw">def</span> chain(</span>
<span id="cb19-2"><a href="#cb19-2"></a>    <span class="va">self</span>,</span>
<span id="cb19-3"><a href="#cb19-3"></a>    agent_names: List[<span class="bu">str</span>],</span>
<span id="cb19-4"><a href="#cb19-4"></a>    input_data: Dict[<span class="bu">str</span>, Any],</span>
<span id="cb19-5"><a href="#cb19-5"></a>    pass_intermediate: <span class="bu">bool</span> <span class="op">=</span> <span class="va">True</span></span>
<span id="cb19-6"><a href="#cb19-6"></a>) <span class="op">-&gt;</span> Dict[<span class="bu">str</span>, Any]:</span>
<span id="cb19-7"><a href="#cb19-7"></a>    <span class="co">"""Agent 체이닝 (순차 실행)</span></span>
<span id="cb19-8"><a href="#cb19-8"></a><span class="co">    </span></span>
<span id="cb19-9"><a href="#cb19-9"></a><span class="co">    Args:</span></span>
<span id="cb19-10"><a href="#cb19-10"></a><span class="co">        agent_names: Agent 이름 목록</span></span>
<span id="cb19-11"><a href="#cb19-11"></a><span class="co">        input_data: 초기 입력</span></span>
<span id="cb19-12"><a href="#cb19-12"></a><span class="co">        pass_intermediate: 중간 결과를 다음 Agent에 전달 여부</span></span>
<span id="cb19-13"><a href="#cb19-13"></a><span class="co">    </span></span>
<span id="cb19-14"><a href="#cb19-14"></a><span class="co">    Returns:</span></span>
<span id="cb19-15"><a href="#cb19-15"></a><span class="co">        최종 결과</span></span>
<span id="cb19-16"><a href="#cb19-16"></a><span class="co">    </span></span>
<span id="cb19-17"><a href="#cb19-17"></a><span class="co">    Example:</span></span>
<span id="cb19-18"><a href="#cb19-18"></a><span class="co">        orchestrator.chain(</span></span>
<span id="cb19-19"><a href="#cb19-19"></a><span class="co">            ['data_standardization', 'code_analysis', 'recommendation'],</span></span>
<span id="cb19-20"><a href="#cb19-20"></a><span class="co">            {'task': 'analyze', 'data': schema}</span></span>
<span id="cb19-21"><a href="#cb19-21"></a><span class="co">        )</span></span>
<span id="cb19-22"><a href="#cb19-22"></a><span class="co">    """</span></span>
<span id="cb19-23"><a href="#cb19-23"></a>    result <span class="op">=</span> input_data</span>
<span id="cb19-24"><a href="#cb19-24"></a>    </span>
<span id="cb19-25"><a href="#cb19-25"></a>    <span class="cf">for</span> agent_name <span class="kw">in</span> agent_names:</span>
<span id="cb19-26"><a href="#cb19-26"></a>        logger.info(<span class="ss">f"Chain step: </span><span class="sc">{</span>agent_name<span class="sc">}</span><span class="ss">"</span>)</span>
<span id="cb19-27"><a href="#cb19-27"></a>        </span>
<span id="cb19-28"><a href="#cb19-28"></a>        agent <span class="op">=</span> <span class="va">self</span>.registry.get(agent_name)</span>
<span id="cb19-29"><a href="#cb19-29"></a>        result <span class="op">=</span> agent.execute(result)</span>
<span id="cb19-30"><a href="#cb19-30"></a>        </span>
<span id="cb19-31"><a href="#cb19-31"></a>        <span class="cf">if</span> <span class="kw">not</span> pass_intermediate:</span>
<span id="cb19-32"><a href="#cb19-32"></a>            <span class="co"># 원본 입력 유지, 결과만 누적</span></span>
<span id="cb19-33"><a href="#cb19-33"></a>            result <span class="op">=</span> {</span>
<span id="cb19-34"><a href="#cb19-34"></a>                <span class="op">**</span>input_data,</span>
<span id="cb19-35"><a href="#cb19-35"></a>                <span class="ss">f'</span><span class="sc">{</span>agent_name<span class="sc">}</span><span class="ss">_result'</span>: result</span>
<span id="cb19-36"><a href="#cb19-36"></a>            }</span>
<span id="cb19-37"><a href="#cb19-37"></a>    </span>
<span id="cb19-38"><a href="#cb19-38"></a>    <span class="cf">return</span> result</span></code><button title="클립보드 복사" class="code-copy-button"><i class="bi"></i></button></pre></div>
<p><strong>실행 예시</strong>:</p>
<div class="sourceCode" id="cb20"><pre class="sourceCode numberSource python number-lines code-with-copy"><code class="sourceCode python"><span id="cb20-1"><a href="#cb20-1"></a><span class="co"># 데이터 표준화 → 코드 분석 → 추천</span></span>
<span id="cb20-2"><a href="#cb20-2"></a>orchestrator <span class="op">=</span> AgentOrchestrator()</span>
<span id="cb20-3"><a href="#cb20-3"></a></span>
<span id="cb20-4"><a href="#cb20-4"></a>result <span class="op">=</span> orchestrator.chain(</span>
<span id="cb20-5"><a href="#cb20-5"></a>    agent_names<span class="op">=</span>[<span class="st">'data_standardization'</span>, <span class="st">'code_analysis'</span>, <span class="st">'recommendation'</span>],</span>
<span id="cb20-6"><a href="#cb20-6"></a>    input_data<span class="op">=</span>{</span>
<span id="cb20-7"><a href="#cb20-7"></a>        <span class="st">'task'</span>: <span class="st">'analyze_and_recommend'</span>,</span>
<span id="cb20-8"><a href="#cb20-8"></a>        <span class="st">'data'</span>: {<span class="st">'schema'</span>: raw_schema}</span>
<span id="cb20-9"><a href="#cb20-9"></a>    }</span>
<span id="cb20-10"><a href="#cb20-10"></a>)</span>
<span id="cb20-11"><a href="#cb20-11"></a></span>
<span id="cb20-12"><a href="#cb20-12"></a><span class="co"># 결과</span></span>
<span id="cb20-13"><a href="#cb20-13"></a>{</span>
<span id="cb20-14"><a href="#cb20-14"></a>    <span class="st">'result'</span>: [...],  <span class="co"># 최종 추천 결과</span></span>
<span id="cb20-15"><a href="#cb20-15"></a>    <span class="st">'metadata'</span>: {</span>
<span id="cb20-16"><a href="#cb20-16"></a>        <span class="st">'agent'</span>: <span class="st">'recommendation'</span>,  <span class="co"># 마지막 Agent</span></span>
<span id="cb20-17"><a href="#cb20-17"></a>        <span class="st">'execution_time'</span>: <span class="fl">5.2</span></span>
<span id="cb20-18"><a href="#cb20-18"></a>    }</span>
<span id="cb20-19"><a href="#cb20-19"></a>}</span></code><button title="클립보드 복사" class="code-copy-button"><i class="bi"></i></button></pre></div>
</section>
<section id="병렬-실행" class="level2" data-number="4.3">
<h2 data-number="4.3" class="anchored" data-anchor-id="병렬-실행"><span class="header-section-number">4.3</span> 병렬 실행</h2>
<div class="sourceCode" id="cb21"><pre class="sourceCode numberSource python number-lines code-with-copy"><code class="sourceCode python"><span id="cb21-1"><a href="#cb21-1"></a><span class="im">import</span> concurrent.futures</span>
<span id="cb21-2"><a href="#cb21-2"></a></span>
<span id="cb21-3"><a href="#cb21-3"></a><span class="kw">def</span> parallel(</span>
<span id="cb21-4"><a href="#cb21-4"></a>    <span class="va">self</span>,</span>
<span id="cb21-5"><a href="#cb21-5"></a>    agent_names: List[<span class="bu">str</span>],</span>
<span id="cb21-6"><a href="#cb21-6"></a>    input_data: Dict[<span class="bu">str</span>, Any],</span>
<span id="cb21-7"><a href="#cb21-7"></a>    max_workers: <span class="bu">int</span> <span class="op">=</span> <span class="dv">4</span></span>
<span id="cb21-8"><a href="#cb21-8"></a>) <span class="op">-&gt;</span> List[Dict[<span class="bu">str</span>, Any]]:</span>
<span id="cb21-9"><a href="#cb21-9"></a>    <span class="co">"""병렬 실행 (동일 입력, 여러 Agent)</span></span>
<span id="cb21-10"><a href="#cb21-10"></a><span class="co">    </span></span>
<span id="cb21-11"><a href="#cb21-11"></a><span class="co">    Args:</span></span>
<span id="cb21-12"><a href="#cb21-12"></a><span class="co">        agent_names: Agent 이름 목록</span></span>
<span id="cb21-13"><a href="#cb21-13"></a><span class="co">        input_data: 입력 데이터 (모든 Agent 공통)</span></span>
<span id="cb21-14"><a href="#cb21-14"></a><span class="co">        max_workers: 최대 병렬 워커 수</span></span>
<span id="cb21-15"><a href="#cb21-15"></a><span class="co">    </span></span>
<span id="cb21-16"><a href="#cb21-16"></a><span class="co">    Returns:</span></span>
<span id="cb21-17"><a href="#cb21-17"></a><span class="co">        Agent별 실행 결과 리스트</span></span>
<span id="cb21-18"><a href="#cb21-18"></a><span class="co">    </span></span>
<span id="cb21-19"><a href="#cb21-19"></a><span class="co">    Use Case:</span></span>
<span id="cb21-20"><a href="#cb21-20"></a><span class="co">        - 여러 Agent의 결과 비교 (앙상블)</span></span>
<span id="cb21-21"><a href="#cb21-21"></a><span class="co">        - A/B 테스트</span></span>
<span id="cb21-22"><a href="#cb21-22"></a><span class="co">    """</span></span>
<span id="cb21-23"><a href="#cb21-23"></a>    <span class="kw">def</span> run_agent(agent_name: <span class="bu">str</span>) <span class="op">-&gt;</span> Dict[<span class="bu">str</span>, Any]:</span>
<span id="cb21-24"><a href="#cb21-24"></a>        agent <span class="op">=</span> <span class="va">self</span>.registry.get(agent_name)</span>
<span id="cb21-25"><a href="#cb21-25"></a>        <span class="cf">return</span> agent.execute(input_data)</span>
<span id="cb21-26"><a href="#cb21-26"></a>    </span>
<span id="cb21-27"><a href="#cb21-27"></a>    <span class="cf">with</span> concurrent.futures.ThreadPoolExecutor(max_workers<span class="op">=</span>max_workers) <span class="im">as</span> executor:</span>
<span id="cb21-28"><a href="#cb21-28"></a>        futures <span class="op">=</span> {</span>
<span id="cb21-29"><a href="#cb21-29"></a>            executor.submit(run_agent, name): name</span>
<span id="cb21-30"><a href="#cb21-30"></a>            <span class="cf">for</span> name <span class="kw">in</span> agent_names</span>
<span id="cb21-31"><a href="#cb21-31"></a>        }</span>
<span id="cb21-32"><a href="#cb21-32"></a>        </span>
<span id="cb21-33"><a href="#cb21-33"></a>        results <span class="op">=</span> []</span>
<span id="cb21-34"><a href="#cb21-34"></a>        <span class="cf">for</span> future <span class="kw">in</span> concurrent.futures.as_completed(futures):</span>
<span id="cb21-35"><a href="#cb21-35"></a>            agent_name <span class="op">=</span> futures[future]</span>
<span id="cb21-36"><a href="#cb21-36"></a>            <span class="cf">try</span>:</span>
<span id="cb21-37"><a href="#cb21-37"></a>                result <span class="op">=</span> future.result()</span>
<span id="cb21-38"><a href="#cb21-38"></a>                results.append(result)</span>
<span id="cb21-39"><a href="#cb21-39"></a>                logger.info(<span class="ss">f"Agent </span><span class="sc">{</span>agent_name<span class="sc">}</span><span class="ss"> completed"</span>)</span>
<span id="cb21-40"><a href="#cb21-40"></a>            <span class="cf">except</span> <span class="pp">Exception</span> <span class="im">as</span> e:</span>
<span id="cb21-41"><a href="#cb21-41"></a>                logger.error(<span class="ss">f"Agent </span><span class="sc">{</span>agent_name<span class="sc">}</span><span class="ss"> failed: </span><span class="sc">{</span>e<span class="sc">}</span><span class="ss">"</span>)</span>
<span id="cb21-42"><a href="#cb21-42"></a>        </span>
<span id="cb21-43"><a href="#cb21-43"></a>        <span class="cf">return</span> results</span></code><button title="클립보드 복사" class="code-copy-button"><i class="bi"></i></button></pre></div>
<p><strong>실행 예시</strong>:</p>
<div class="sourceCode" id="cb22"><pre class="sourceCode numberSource python number-lines code-with-copy"><code class="sourceCode python"><span id="cb22-1"><a href="#cb22-1"></a><span class="co"># 3개 Agent를 병렬로 실행하여 결과 비교</span></span>
<span id="cb22-2"><a href="#cb22-2"></a>results <span class="op">=</span> orchestrator.parallel(</span>
<span id="cb22-3"><a href="#cb22-3"></a>    agent_names<span class="op">=</span>[<span class="st">'agent_v1'</span>, <span class="st">'agent_v2'</span>, <span class="st">'agent_v3'</span>],</span>
<span id="cb22-4"><a href="#cb22-4"></a>    input_data<span class="op">=</span>{<span class="st">'task'</span>: <span class="st">'analyze'</span>, <span class="st">'data'</span>: test_data}</span>
<span id="cb22-5"><a href="#cb22-5"></a>)</span>
<span id="cb22-6"><a href="#cb22-6"></a></span>
<span id="cb22-7"><a href="#cb22-7"></a><span class="co"># 결과 비교</span></span>
<span id="cb22-8"><a href="#cb22-8"></a><span class="cf">for</span> result <span class="kw">in</span> results:</span>
<span id="cb22-9"><a href="#cb22-9"></a>    agent_name <span class="op">=</span> result[<span class="st">'metadata'</span>][<span class="st">'agent'</span>]</span>
<span id="cb22-10"><a href="#cb22-10"></a>    confidence <span class="op">=</span> result[<span class="st">'confidence'</span>]</span>
<span id="cb22-11"><a href="#cb22-11"></a>    <span class="bu">print</span>(<span class="ss">f"</span><span class="sc">{</span>agent_name<span class="sc">}</span><span class="ss">: </span><span class="sc">{</span>confidence<span class="sc">:.2f}</span><span class="ss">"</span>)</span></code><button title="클립보드 복사" class="code-copy-button"><i class="bi"></i></button></pre></div>
</section>
<section id="조건부-실행" class="level2" data-number="4.4">
<h2 data-number="4.4" class="anchored" data-anchor-id="조건부-실행"><span class="header-section-number">4.4</span> 조건부 실행</h2>
<div class="sourceCode" id="cb23"><pre class="sourceCode numberSource python number-lines code-with-copy"><code class="sourceCode python"><span id="cb23-1"><a href="#cb23-1"></a><span class="kw">def</span> conditional_chain(</span>
<span id="cb23-2"><a href="#cb23-2"></a>    <span class="va">self</span>,</span>
<span id="cb23-3"><a href="#cb23-3"></a>    agent_configs: List[Dict[<span class="bu">str</span>, Any]],</span>
<span id="cb23-4"><a href="#cb23-4"></a>    input_data: Dict[<span class="bu">str</span>, Any]</span>
<span id="cb23-5"><a href="#cb23-5"></a>) <span class="op">-&gt;</span> Dict[<span class="bu">str</span>, Any]:</span>
<span id="cb23-6"><a href="#cb23-6"></a>    <span class="co">"""조건부 Agent 체이닝</span></span>
<span id="cb23-7"><a href="#cb23-7"></a><span class="co">    </span></span>
<span id="cb23-8"><a href="#cb23-8"></a><span class="co">    Args:</span></span>
<span id="cb23-9"><a href="#cb23-9"></a><span class="co">        agent_configs: Agent 설정 목록</span></span>
<span id="cb23-10"><a href="#cb23-10"></a><span class="co">            [</span></span>
<span id="cb23-11"><a href="#cb23-11"></a><span class="co">                {'name': 'agent1', 'condition': lambda r: r['confidence'] &gt; 0.8},</span></span>
<span id="cb23-12"><a href="#cb23-12"></a><span class="co">                {'name': 'agent2', 'condition': lambda r: 'error' not in r}</span></span>
<span id="cb23-13"><a href="#cb23-13"></a><span class="co">            ]</span></span>
<span id="cb23-14"><a href="#cb23-14"></a><span class="co">        input_data: 초기 입력</span></span>
<span id="cb23-15"><a href="#cb23-15"></a><span class="co">    </span></span>
<span id="cb23-16"><a href="#cb23-16"></a><span class="co">    Returns:</span></span>
<span id="cb23-17"><a href="#cb23-17"></a><span class="co">        최종 결과</span></span>
<span id="cb23-18"><a href="#cb23-18"></a><span class="co">    """</span></span>
<span id="cb23-19"><a href="#cb23-19"></a>    result <span class="op">=</span> input_data</span>
<span id="cb23-20"><a href="#cb23-20"></a>    </span>
<span id="cb23-21"><a href="#cb23-21"></a>    <span class="cf">for</span> config <span class="kw">in</span> agent_configs:</span>
<span id="cb23-22"><a href="#cb23-22"></a>        agent_name <span class="op">=</span> config[<span class="st">'name'</span>]</span>
<span id="cb23-23"><a href="#cb23-23"></a>        condition <span class="op">=</span> config.get(<span class="st">'condition'</span>, <span class="kw">lambda</span> r: <span class="va">True</span>)</span>
<span id="cb23-24"><a href="#cb23-24"></a>        </span>
<span id="cb23-25"><a href="#cb23-25"></a>        <span class="co"># 조건 확인</span></span>
<span id="cb23-26"><a href="#cb23-26"></a>        <span class="cf">if</span> <span class="kw">not</span> condition(result):</span>
<span id="cb23-27"><a href="#cb23-27"></a>            logger.info(<span class="ss">f"Skipping </span><span class="sc">{</span>agent_name<span class="sc">}</span><span class="ss"> (condition not met)"</span>)</span>
<span id="cb23-28"><a href="#cb23-28"></a>            <span class="cf">continue</span></span>
<span id="cb23-29"><a href="#cb23-29"></a>        </span>
<span id="cb23-30"><a href="#cb23-30"></a>        <span class="co"># Agent 실행</span></span>
<span id="cb23-31"><a href="#cb23-31"></a>        agent <span class="op">=</span> <span class="va">self</span>.registry.get(agent_name)</span>
<span id="cb23-32"><a href="#cb23-32"></a>        result <span class="op">=</span> agent.execute(result)</span>
<span id="cb23-33"><a href="#cb23-33"></a>    </span>
<span id="cb23-34"><a href="#cb23-34"></a>    <span class="cf">return</span> result</span></code><button title="클립보드 복사" class="code-copy-button"><i class="bi"></i></button></pre></div>
<p><strong>실행 예시</strong>:</p>
<div class="sourceCode" id="cb24"><pre class="sourceCode numberSource python number-lines code-with-copy"><code class="sourceCode python"><span id="cb24-1"><a href="#cb24-1"></a><span class="co"># 신뢰도 높을 때만 다음 Agent 실행</span></span>
<span id="cb24-2"><a href="#cb24-2"></a>result <span class="op">=</span> orchestrator.conditional_chain(</span>
<span id="cb24-3"><a href="#cb24-3"></a>    agent_configs<span class="op">=</span>[</span>
<span id="cb24-4"><a href="#cb24-4"></a>        {<span class="st">'name'</span>: <span class="st">'data_standardization'</span>},</span>
<span id="cb24-5"><a href="#cb24-5"></a>        {</span>
<span id="cb24-6"><a href="#cb24-6"></a>            <span class="st">'name'</span>: <span class="st">'code_analysis'</span>,</span>
<span id="cb24-7"><a href="#cb24-7"></a>            <span class="st">'condition'</span>: <span class="kw">lambda</span> r: r.get(<span class="st">'confidence'</span>, <span class="dv">0</span>) <span class="op">&gt;</span> <span class="fl">0.8</span></span>
<span id="cb24-8"><a href="#cb24-8"></a>        },</span>
<span id="cb24-9"><a href="#cb24-9"></a>        {</span>
<span id="cb24-10"><a href="#cb24-10"></a>            <span class="st">'name'</span>: <span class="st">'recommendation'</span>,</span>
<span id="cb24-11"><a href="#cb24-11"></a>            <span class="st">'condition'</span>: <span class="kw">lambda</span> r: <span class="st">'errors'</span> <span class="kw">not</span> <span class="kw">in</span> r</span>
<span id="cb24-12"><a href="#cb24-12"></a>        }</span>
<span id="cb24-13"><a href="#cb24-13"></a>    ],</span>
<span id="cb24-14"><a href="#cb24-14"></a>    input_data<span class="op">=</span>{<span class="st">'task'</span>: <span class="st">'analyze'</span>, <span class="st">'data'</span>: schema}</span>
<span id="cb24-15"><a href="#cb24-15"></a>)</span></code><button title="클립보드 복사" class="code-copy-button"><i class="bi"></i></button></pre></div>
</section>
</section>
<section id="실제-agent-구현-예시" class="level1" data-number="5">
<h1 data-number="5"><span class="header-section-number">5</span> 실제 Agent 구현 예시</h1>
<section id="datastandardizationagent" class="level2" data-number="5.1">
<h2 data-number="5.1" class="anchored" data-anchor-id="datastandardizationagent"><span class="header-section-number">5.1</span> DataStandardizationAgent</h2>
<div class="sourceCode" id="cb25"><pre class="sourceCode numberSource python number-lines code-with-copy"><code class="sourceCode python"><span id="cb25-1"><a href="#cb25-1"></a><span class="co"># agents/data_standardization/agent.py</span></span>
<span id="cb25-2"><a href="#cb25-2"></a><span class="im">from</span> core.base_agent <span class="im">import</span> BaseAgent, AgentMetadata</span>
<span id="cb25-3"><a href="#cb25-3"></a><span class="im">from</span> shared.llm.client <span class="im">import</span> LLMClient</span>
<span id="cb25-4"><a href="#cb25-4"></a><span class="im">from</span> typing <span class="im">import</span> Dict, Any</span>
<span id="cb25-5"><a href="#cb25-5"></a></span>
<span id="cb25-6"><a href="#cb25-6"></a><span class="kw">class</span> DataStandardizationAgent(BaseAgent):</span>
<span id="cb25-7"><a href="#cb25-7"></a>    <span class="co">"""데이터 스키마 표준화 Agent</span></span>
<span id="cb25-8"><a href="#cb25-8"></a><span class="co">    </span></span>
<span id="cb25-9"><a href="#cb25-9"></a><span class="co">    기능:</span></span>
<span id="cb25-10"><a href="#cb25-10"></a><span class="co">    - 비표준 스키마를 표준 형식으로 변환</span></span>
<span id="cb25-11"><a href="#cb25-11"></a><span class="co">    - 필드명 정규화 (예: "환자번호" → "patient_id")</span></span>
<span id="cb25-12"><a href="#cb25-12"></a><span class="co">    - 데이터 타입 추론</span></span>
<span id="cb25-13"><a href="#cb25-13"></a><span class="co">    """</span></span>
<span id="cb25-14"><a href="#cb25-14"></a>    </span>
<span id="cb25-15"><a href="#cb25-15"></a>    <span class="kw">def</span> <span class="fu">__init__</span>(<span class="va">self</span>, metadata: AgentMetadata):</span>
<span id="cb25-16"><a href="#cb25-16"></a>        <span class="bu">super</span>().<span class="fu">__init__</span>(metadata)</span>
<span id="cb25-17"><a href="#cb25-17"></a>        </span>
<span id="cb25-18"><a href="#cb25-18"></a>        <span class="co"># Agent 전용 LLM 클라이언트</span></span>
<span id="cb25-19"><a href="#cb25-19"></a>        <span class="va">self</span>.llm <span class="op">=</span> LLMClient(</span>
<span id="cb25-20"><a href="#cb25-20"></a>            provider<span class="op">=</span><span class="st">"openai"</span>,</span>
<span id="cb25-21"><a href="#cb25-21"></a>            model<span class="op">=</span><span class="st">"gpt-4"</span>,</span>
<span id="cb25-22"><a href="#cb25-22"></a>            cache_enabled<span class="op">=</span><span class="va">True</span></span>
<span id="cb25-23"><a href="#cb25-23"></a>        )</span>
<span id="cb25-24"><a href="#cb25-24"></a>    </span>
<span id="cb25-25"><a href="#cb25-25"></a>    <span class="kw">def</span> process(<span class="va">self</span>, <span class="bu">input</span>: Dict[<span class="bu">str</span>, Any]) <span class="op">-&gt;</span> Dict[<span class="bu">str</span>, Any]:</span>
<span id="cb25-26"><a href="#cb25-26"></a>        <span class="co">"""스키마 표준화"""</span></span>
<span id="cb25-27"><a href="#cb25-27"></a>        schema <span class="op">=</span> <span class="bu">input</span>[<span class="st">'data'</span>]</span>
<span id="cb25-28"><a href="#cb25-28"></a>        </span>
<span id="cb25-29"><a href="#cb25-29"></a>        <span class="co"># LLM 프롬프트 생성</span></span>
<span id="cb25-30"><a href="#cb25-30"></a>        prompt <span class="op">=</span> <span class="va">self</span>._build_prompt(schema)</span>
<span id="cb25-31"><a href="#cb25-31"></a>        </span>
<span id="cb25-32"><a href="#cb25-32"></a>        <span class="co"># LLM 호출</span></span>
<span id="cb25-33"><a href="#cb25-33"></a>        standardized <span class="op">=</span> <span class="va">self</span>.llm.generate(</span>
<span id="cb25-34"><a href="#cb25-34"></a>            prompt<span class="op">=</span>prompt,</span>
<span id="cb25-35"><a href="#cb25-35"></a>            temperature<span class="op">=</span><span class="fl">0.0</span>  <span class="co"># 결정론적 출력</span></span>
<span id="cb25-36"><a href="#cb25-36"></a>        )</span>
<span id="cb25-37"><a href="#cb25-37"></a>        </span>
<span id="cb25-38"><a href="#cb25-38"></a>        <span class="co"># 결과 파싱</span></span>
<span id="cb25-39"><a href="#cb25-39"></a>        result <span class="op">=</span> <span class="va">self</span>._parse_result(standardized)</span>
<span id="cb25-40"><a href="#cb25-40"></a>        </span>
<span id="cb25-41"><a href="#cb25-41"></a>        <span class="cf">return</span> {</span>
<span id="cb25-42"><a href="#cb25-42"></a>            <span class="st">'result'</span>: result,</span>
<span id="cb25-43"><a href="#cb25-43"></a>            <span class="st">'confidence'</span>: <span class="va">self</span>._calculate_confidence(result)</span>
<span id="cb25-44"><a href="#cb25-44"></a>        }</span>
<span id="cb25-45"><a href="#cb25-45"></a>    </span>
<span id="cb25-46"><a href="#cb25-46"></a>    <span class="kw">def</span> _build_prompt(<span class="va">self</span>, schema: Dict) <span class="op">-&gt;</span> <span class="bu">str</span>:</span>
<span id="cb25-47"><a href="#cb25-47"></a>        <span class="co">"""프롬프트 생성"""</span></span>
<span id="cb25-48"><a href="#cb25-48"></a>        <span class="cf">return</span> <span class="ss">f"""다음 스키마를 표준화하세요:</span></span>
<span id="cb25-49"><a href="#cb25-49"></a></span>
<span id="cb25-50"><a href="#cb25-50"></a><span class="ss">입력 스키마:</span></span>
<span id="cb25-51"><a href="#cb25-51"></a><span class="sc">{</span>schema<span class="sc">}</span></span>
<span id="cb25-52"><a href="#cb25-52"></a></span>
<span id="cb25-53"><a href="#cb25-53"></a><span class="ss">규칙:</span></span>
<span id="cb25-54"><a href="#cb25-54"></a><span class="ss">1. 필드명을 영문 snake_case로 변환</span></span>
<span id="cb25-55"><a href="#cb25-55"></a><span class="ss">2. 데이터 타입을 명시 (string, int, float, date 등)</span></span>
<span id="cb25-56"><a href="#cb25-56"></a><span class="ss">3. 설명 추가</span></span>
<span id="cb25-57"><a href="#cb25-57"></a></span>
<span id="cb25-58"><a href="#cb25-58"></a><span class="ss">출력 형식 (JSON):</span></span>
<span id="cb25-59"><a href="#cb25-59"></a><span class="ch">{{</span></span>
<span id="cb25-60"><a href="#cb25-60"></a><span class="ss">    "fields": [</span></span>
<span id="cb25-61"><a href="#cb25-61"></a><span class="ss">        </span><span class="ch">{{</span><span class="ss">"name": "field_name", "type": "string", "description": "..."</span><span class="ch">}}</span></span>
<span id="cb25-62"><a href="#cb25-62"></a><span class="ss">    ]</span></span>
<span id="cb25-63"><a href="#cb25-63"></a><span class="ch">}}</span><span class="ss">"""</span></span>
<span id="cb25-64"><a href="#cb25-64"></a>    </span>
<span id="cb25-65"><a href="#cb25-65"></a>    <span class="kw">def</span> _parse_result(<span class="va">self</span>, llm_output: <span class="bu">str</span>) <span class="op">-&gt;</span> Dict:</span>
<span id="cb25-66"><a href="#cb25-66"></a>        <span class="co">"""LLM 출력 파싱"""</span></span>
<span id="cb25-67"><a href="#cb25-67"></a>        <span class="im">import</span> json</span>
<span id="cb25-68"><a href="#cb25-68"></a>        <span class="cf">return</span> json.loads(llm_output)</span>
<span id="cb25-69"><a href="#cb25-69"></a>    </span>
<span id="cb25-70"><a href="#cb25-70"></a>    <span class="kw">def</span> _calculate_confidence(<span class="va">self</span>, result: Dict) <span class="op">-&gt;</span> <span class="bu">float</span>:</span>
<span id="cb25-71"><a href="#cb25-71"></a>        <span class="co">"""신뢰도 계산"""</span></span>
<span id="cb25-72"><a href="#cb25-72"></a>        <span class="co"># 필드 개수, 타입 명시 여부 등으로 계산</span></span>
<span id="cb25-73"><a href="#cb25-73"></a>        <span class="cf">if</span> <span class="st">'fields'</span> <span class="kw">not</span> <span class="kw">in</span> result:</span>
<span id="cb25-74"><a href="#cb25-74"></a>            <span class="cf">return</span> <span class="fl">0.0</span></span>
<span id="cb25-75"><a href="#cb25-75"></a>        </span>
<span id="cb25-76"><a href="#cb25-76"></a>        fields <span class="op">=</span> result[<span class="st">'fields'</span>]</span>
<span id="cb25-77"><a href="#cb25-77"></a>        <span class="cf">if</span> <span class="bu">len</span>(fields) <span class="op">==</span> <span class="dv">0</span>:</span>
<span id="cb25-78"><a href="#cb25-78"></a>            <span class="cf">return</span> <span class="fl">0.0</span></span>
<span id="cb25-79"><a href="#cb25-79"></a>        </span>
<span id="cb25-80"><a href="#cb25-80"></a>        <span class="co"># 모든 필드가 type과 description을 가지면 신뢰도 1.0</span></span>
<span id="cb25-81"><a href="#cb25-81"></a>        complete_fields <span class="op">=</span> <span class="bu">sum</span>(</span>
<span id="cb25-82"><a href="#cb25-82"></a>            <span class="dv">1</span> <span class="cf">for</span> f <span class="kw">in</span> fields</span>
<span id="cb25-83"><a href="#cb25-83"></a>            <span class="cf">if</span> <span class="st">'type'</span> <span class="kw">in</span> f <span class="kw">and</span> <span class="st">'description'</span> <span class="kw">in</span> f</span>
<span id="cb25-84"><a href="#cb25-84"></a>        )</span>
<span id="cb25-85"><a href="#cb25-85"></a>        </span>
<span id="cb25-86"><a href="#cb25-86"></a>        <span class="cf">return</span> complete_fields <span class="op">/</span> <span class="bu">len</span>(fields)</span>
<span id="cb25-87"><a href="#cb25-87"></a>    </span>
<span id="cb25-88"><a href="#cb25-88"></a>    <span class="kw">def</span> evaluate(<span class="va">self</span>, ground_truth: Dict, prediction: Dict) <span class="op">-&gt;</span> <span class="bu">float</span>:</span>
<span id="cb25-89"><a href="#cb25-89"></a>        <span class="co">"""스키마 매칭 정확도"""</span></span>
<span id="cb25-90"><a href="#cb25-90"></a>        truth_fields <span class="op">=</span> {f[<span class="st">'name'</span>] <span class="cf">for</span> f <span class="kw">in</span> ground_truth[<span class="st">'fields'</span>]}</span>
<span id="cb25-91"><a href="#cb25-91"></a>        pred_fields <span class="op">=</span> {f[<span class="st">'name'</span>] <span class="cf">for</span> f <span class="kw">in</span> prediction[<span class="st">'fields'</span>]}</span>
<span id="cb25-92"><a href="#cb25-92"></a>        </span>
<span id="cb25-93"><a href="#cb25-93"></a>        <span class="co"># Jaccard similarity</span></span>
<span id="cb25-94"><a href="#cb25-94"></a>        intersection <span class="op">=</span> <span class="bu">len</span>(truth_fields <span class="op">&amp;</span> pred_fields)</span>
<span id="cb25-95"><a href="#cb25-95"></a>        union <span class="op">=</span> <span class="bu">len</span>(truth_fields <span class="op">|</span> pred_fields)</span>
<span id="cb25-96"><a href="#cb25-96"></a>        </span>
<span id="cb25-97"><a href="#cb25-97"></a>        <span class="cf">return</span> intersection <span class="op">/</span> union <span class="cf">if</span> union <span class="op">&gt;</span> <span class="dv">0</span> <span class="cf">else</span> <span class="fl">0.0</span></span>
<span id="cb25-98"><a href="#cb25-98"></a>    </span>
<span id="cb25-99"><a href="#cb25-99"></a>    <span class="kw">def</span> _pre_process(<span class="va">self</span>, <span class="bu">input</span>: Dict[<span class="bu">str</span>, Any]) <span class="op">-&gt;</span> Dict[<span class="bu">str</span>, Any]:</span>
<span id="cb25-100"><a href="#cb25-100"></a>        <span class="co">"""전처리: 입력 정규화"""</span></span>
<span id="cb25-101"><a href="#cb25-101"></a>        <span class="co"># 스키마를 소문자로 변환</span></span>
<span id="cb25-102"><a href="#cb25-102"></a>        <span class="cf">if</span> <span class="st">'data'</span> <span class="kw">in</span> <span class="bu">input</span> <span class="kw">and</span> <span class="bu">isinstance</span>(<span class="bu">input</span>[<span class="st">'data'</span>], <span class="bu">dict</span>):</span>
<span id="cb25-103"><a href="#cb25-103"></a>            normalized <span class="op">=</span> {</span>
<span id="cb25-104"><a href="#cb25-104"></a>                k.lower(): v</span>
<span id="cb25-105"><a href="#cb25-105"></a>                <span class="cf">for</span> k, v <span class="kw">in</span> <span class="bu">input</span>[<span class="st">'data'</span>].items()</span>
<span id="cb25-106"><a href="#cb25-106"></a>            }</span>
<span id="cb25-107"><a href="#cb25-107"></a>            <span class="bu">input</span>[<span class="st">'data'</span>] <span class="op">=</span> normalized</span>
<span id="cb25-108"><a href="#cb25-108"></a>        </span>
<span id="cb25-109"><a href="#cb25-109"></a>        <span class="cf">return</span> <span class="bu">input</span></span></code><button title="클립보드 복사" class="code-copy-button"><i class="bi"></i></button></pre></div>
</section>
<section id="agent-등록" class="level2" data-number="5.2">
<h2 data-number="5.2" class="anchored" data-anchor-id="agent-등록"><span class="header-section-number">5.2</span> Agent 등록</h2>
<div class="sourceCode" id="cb26"><pre class="sourceCode numberSource python number-lines code-with-copy"><code class="sourceCode python"><span id="cb26-1"><a href="#cb26-1"></a><span class="co"># agents/data_standardization/__init__.py</span></span>
<span id="cb26-2"><a href="#cb26-2"></a><span class="im">from</span> core.registry <span class="im">import</span> AgentRegistry</span>
<span id="cb26-3"><a href="#cb26-3"></a><span class="im">from</span> core.base_agent <span class="im">import</span> AgentMetadata</span>
<span id="cb26-4"><a href="#cb26-4"></a><span class="im">from</span> .agent <span class="im">import</span> DataStandardizationAgent</span>
<span id="cb26-5"><a href="#cb26-5"></a></span>
<span id="cb26-6"><a href="#cb26-6"></a><span class="co"># 메타데이터 정의</span></span>
<span id="cb26-7"><a href="#cb26-7"></a>metadata <span class="op">=</span> AgentMetadata(</span>
<span id="cb26-8"><a href="#cb26-8"></a>    name<span class="op">=</span><span class="st">"data_standardization"</span>,</span>
<span id="cb26-9"><a href="#cb26-9"></a>    version<span class="op">=</span><span class="st">"1.0.0"</span>,</span>
<span id="cb26-10"><a href="#cb26-10"></a>    domain<span class="op">=</span><span class="st">"data"</span>,</span>
<span id="cb26-11"><a href="#cb26-11"></a>    description<span class="op">=</span><span class="st">"데이터 스키마 표준화 Agent"</span>,</span>
<span id="cb26-12"><a href="#cb26-12"></a>    author<span class="op">=</span><span class="st">"Platform Team"</span>,</span>
<span id="cb26-13"><a href="#cb26-13"></a>    created_at<span class="op">=</span><span class="st">"2026-02-02"</span>,</span>
<span id="cb26-14"><a href="#cb26-14"></a>    tags<span class="op">=</span>[<span class="st">"data"</span>, <span class="st">"standardization"</span>, <span class="st">"schema"</span>]</span>
<span id="cb26-15"><a href="#cb26-15"></a>)</span>
<span id="cb26-16"><a href="#cb26-16"></a></span>
<span id="cb26-17"><a href="#cb26-17"></a><span class="co"># Agent 생성 및 등록</span></span>
<span id="cb26-18"><a href="#cb26-18"></a>agent <span class="op">=</span> DataStandardizationAgent(metadata)</span>
<span id="cb26-19"><a href="#cb26-19"></a>AgentRegistry.get_instance().register(agent)</span></code><button title="클립보드 복사" class="code-copy-button"><i class="bi"></i></button></pre></div>
</section>
<section id="사용-예시" class="level2" data-number="5.3">
<h2 data-number="5.3" class="anchored" data-anchor-id="사용-예시"><span class="header-section-number">5.3</span> 사용 예시</h2>
<div class="sourceCode" id="cb27"><pre class="sourceCode numberSource python number-lines code-with-copy"><code class="sourceCode python"><span id="cb27-1"><a href="#cb27-1"></a><span class="co"># 플랫폼 초기화</span></span>
<span id="cb27-2"><a href="#cb27-2"></a><span class="im">from</span> core.orchestrator <span class="im">import</span> AgentOrchestrator</span>
<span id="cb27-3"><a href="#cb27-3"></a><span class="im">import</span> agents.data_standardization  <span class="co"># Agent 자동 등록</span></span>
<span id="cb27-4"><a href="#cb27-4"></a></span>
<span id="cb27-5"><a href="#cb27-5"></a><span class="co"># Orchestrator 생성</span></span>
<span id="cb27-6"><a href="#cb27-6"></a>orchestrator <span class="op">=</span> AgentOrchestrator()</span>
<span id="cb27-7"><a href="#cb27-7"></a></span>
<span id="cb27-8"><a href="#cb27-8"></a><span class="co"># Agent 실행</span></span>
<span id="cb27-9"><a href="#cb27-9"></a>result <span class="op">=</span> orchestrator.run(</span>
<span id="cb27-10"><a href="#cb27-10"></a>    agent_name<span class="op">=</span><span class="st">"data_standardization"</span>,</span>
<span id="cb27-11"><a href="#cb27-11"></a>    input_data<span class="op">=</span>{</span>
<span id="cb27-12"><a href="#cb27-12"></a>        <span class="st">'task'</span>: <span class="st">'standardization'</span>,</span>
<span id="cb27-13"><a href="#cb27-13"></a>        <span class="st">'data'</span>: {</span>
<span id="cb27-14"><a href="#cb27-14"></a>            <span class="st">'환자번호'</span>: <span class="st">'12345'</span>,</span>
<span id="cb27-15"><a href="#cb27-15"></a>            <span class="st">'진료일자'</span>: <span class="st">'2026-01-15'</span>,</span>
<span id="cb27-16"><a href="#cb27-16"></a>            <span class="st">'Age'</span>: <span class="st">'45'</span></span>
<span id="cb27-17"><a href="#cb27-17"></a>        }</span>
<span id="cb27-18"><a href="#cb27-18"></a>    }</span>
<span id="cb27-19"><a href="#cb27-19"></a>)</span>
<span id="cb27-20"><a href="#cb27-20"></a></span>
<span id="cb27-21"><a href="#cb27-21"></a><span class="co"># 결과</span></span>
<span id="cb27-22"><a href="#cb27-22"></a>{</span>
<span id="cb27-23"><a href="#cb27-23"></a>    <span class="st">'result'</span>: {</span>
<span id="cb27-24"><a href="#cb27-24"></a>        <span class="st">'fields'</span>: [</span>
<span id="cb27-25"><a href="#cb27-25"></a>            {<span class="st">'name'</span>: <span class="st">'patient_id'</span>, <span class="st">'type'</span>: <span class="st">'string'</span>, <span class="st">'description'</span>: <span class="st">'환자 고유 번호'</span>},</span>
<span id="cb27-26"><a href="#cb27-26"></a>            {<span class="st">'name'</span>: <span class="st">'visit_date'</span>, <span class="st">'type'</span>: <span class="st">'date'</span>, <span class="st">'description'</span>: <span class="st">'진료 방문 일자'</span>},</span>
<span id="cb27-27"><a href="#cb27-27"></a>            {<span class="st">'name'</span>: <span class="st">'age'</span>, <span class="st">'type'</span>: <span class="st">'int'</span>, <span class="st">'description'</span>: <span class="st">'환자 나이'</span>}</span>
<span id="cb27-28"><a href="#cb27-28"></a>        ]</span>
<span id="cb27-29"><a href="#cb27-29"></a>    },</span>
<span id="cb27-30"><a href="#cb27-30"></a>    <span class="st">'confidence'</span>: <span class="fl">1.0</span>,</span>
<span id="cb27-31"><a href="#cb27-31"></a>    <span class="st">'metadata'</span>: {</span>
<span id="cb27-32"><a href="#cb27-32"></a>        <span class="st">'agent'</span>: <span class="st">'data_standardization'</span>,</span>
<span id="cb27-33"><a href="#cb27-33"></a>        <span class="st">'version'</span>: <span class="st">'1.0.0'</span>,</span>
<span id="cb27-34"><a href="#cb27-34"></a>        <span class="st">'execution_time'</span>: <span class="fl">2.3</span>,</span>
<span id="cb27-35"><a href="#cb27-35"></a>        <span class="st">'timestamp'</span>: <span class="fl">1738485600.0</span></span>
<span id="cb27-36"><a href="#cb27-36"></a>    }</span>
<span id="cb27-37"><a href="#cb27-37"></a>}</span>
<span id="cb27-38"><a href="#cb27-38"></a></span>
<span id="cb27-39"><a href="#cb27-39"></a><span class="co"># 메트릭 확인</span></span>
<span id="cb27-40"><a href="#cb27-40"></a>agent <span class="op">=</span> orchestrator.registry.get(<span class="st">"data_standardization"</span>)</span>
<span id="cb27-41"><a href="#cb27-41"></a>metrics <span class="op">=</span> agent.get_metrics()</span>
<span id="cb27-42"><a href="#cb27-42"></a><span class="bu">print</span>(metrics)</span>
<span id="cb27-43"><a href="#cb27-43"></a><span class="co"># {'name': 'data_standardization', 'executions': 1, 'success_rate': 1.0, 'avg_time': 2.3, 'error_count': 0}</span></span></code><button title="클립보드 복사" class="code-copy-button"><i class="bi"></i></button></pre></div>
</section>
</section>
<section id="핵심-설계-결정-요약" class="level1" data-number="6">
<h1 data-number="6"><span class="header-section-number">6</span> 핵심 설계 결정 요약</h1>
<section id="baseagent-인터페이스" class="level2" data-number="6.1">
<h2 data-number="6.1" class="anchored" data-anchor-id="baseagent-인터페이스"><span class="header-section-number">6.1</span> BaseAgent 인터페이스</h2>
<ol type="1">
<li><strong>표준 입출력</strong>: Dict[str, Any] (확장성)</li>
<li><strong>Template Method</strong>: execute()는 final, process()만 구현</li>
<li><strong>Hook Methods</strong>: _pre_process(), _post_process() 선택적 커스터마이징</li>
<li><strong>자동 메트릭</strong>: 실행 시간, 성공률, 에러 추적</li>
<li><strong>평가 인터페이스</strong>: evaluate() 구현 필수</li>
</ol>
</section>
<section id="agentregistry" class="level2" data-number="6.2">
<h2 data-number="6.2" class="anchored" data-anchor-id="agentregistry"><span class="header-section-number">6.2</span> AgentRegistry</h2>
<ol type="1">
<li><strong>Singleton 패턴</strong>: 전역 Registry</li>
<li><strong>Dependency Inversion</strong>: Agent가 스스로 등록</li>
<li><strong>Core 독립성</strong>: Core → Agents 의존 없음</li>
</ol>
</section>
<section id="orchestrator" class="level2" data-number="6.3">
<h2 data-number="6.3" class="anchored" data-anchor-id="orchestrator"><span class="header-section-number">6.3</span> Orchestrator</h2>
<ol type="1">
<li><strong>단일 실행</strong>: run()</li>
<li><strong>체이닝</strong>: chain() (순차)</li>
<li><strong>병렬 실행</strong>: parallel()</li>
<li><strong>조건부 실행</strong>: conditional_chain()</li>
</ol>
</section>
<section id="다음-단계" class="level2" data-number="6.4">
<h2 data-number="6.4" class="anchored" data-anchor-id="다음-단계"><span class="header-section-number">6.4</span> 다음 단계</h2>
<p>이 글에서 인터페이스 설계를 완료했다. 다음 글에서는:</p>
<ul>
<li><strong>5번 글</strong>: 데이터 표준화 계층 (프롬프트, 벡터 데이터, 메타데이터 관리)</li>
<li><strong>6번 글</strong>: 플랫폼 운영 (CI/CD, 모니터링, 배포 전략)</li>
</ul>
</section>
<section id="참고문헌" class="level2" data-number="6.5">
<h2 data-number="6.5" class="anchored" data-anchor-id="참고문헌"><span class="header-section-number">6.5</span> 참고문헌</h2>
<p><strong>Design Patterns</strong>: - Gamma, E., et al.&nbsp;(1994). “Design Patterns: Elements of Reusable Object-Oriented Software.” Addison-Wesley. - Freeman, E., &amp; Freeman, E. (2004). “Head First Design Patterns.” O’Reilly.</p>
<p><strong>Software Architecture</strong>: - Martin, R. C. (2017). “Clean Architecture.” Prentice Hall. - Evans, E. (2003). “Domain-Driven Design.” Addison-Wesley.</p>
<p><strong>Python Best Practices</strong>: - Ramalho, L. (2021). “Fluent Python.” O’Reilly. - Martin, R. C. (2008). “Clean Code.” Prentice Hall.</p>
<p><strong>역할</strong>: Agent 생명주기 관리, 표준 인터페이스 정의</p>
<div class="sourceCode" id="cb28"><pre class="sourceCode numberSource python number-lines code-with-copy"><code class="sourceCode python"><span id="cb28-1"><a href="#cb28-1"></a>core<span class="op">/</span></span>
<span id="cb28-2"><a href="#cb28-2"></a>├── agent<span class="op">/</span></span>
<span id="cb28-3"><a href="#cb28-3"></a>│   ├── base_agent.py          <span class="co"># BaseAgent 추상 클래스</span></span>
<span id="cb28-4"><a href="#cb28-4"></a>│   ├── lifecycle.py           <span class="co"># Agent 초기화, 종료</span></span>
<span id="cb28-5"><a href="#cb28-5"></a>│   └── registry.py            <span class="co"># Agent 등록 및 조회</span></span>
<span id="cb28-6"><a href="#cb28-6"></a>├── orchestrator.py            <span class="co"># Agent 실행 관리</span></span>
<span id="cb28-7"><a href="#cb28-7"></a>├── monitoring.py              <span class="co"># 메트릭 수집</span></span>
<span id="cb28-8"><a href="#cb28-8"></a>└── evaluation.py              <span class="co"># 공통 평가 프레임워크</span></span></code><button title="클립보드 복사" class="code-copy-button"><i class="bi"></i></button></pre></div>
<section id="baseagent-설계-2번-글-확장" class="level3" data-number="6.5.1">
<h3 data-number="6.5.1" class="anchored" data-anchor-id="baseagent-설계-2번-글-확장"><span class="header-section-number">6.5.1</span> BaseAgent 설계 (2번 글 확장)</h3>
<p>2번 글에서 제시한 BaseAgent를 더 구체화한다:</p>
<div class="sourceCode" id="cb29"><pre class="sourceCode numberSource python number-lines code-with-copy"><code class="sourceCode python"><span id="cb29-1"><a href="#cb29-1"></a><span class="co"># core/agent/base_agent.py</span></span>
<span id="cb29-2"><a href="#cb29-2"></a><span class="im">from</span> abc <span class="im">import</span> ABC, abstractmethod</span>
<span id="cb29-3"><a href="#cb29-3"></a><span class="im">from</span> typing <span class="im">import</span> Dict, Any, Optional</span>
<span id="cb29-4"><a href="#cb29-4"></a><span class="im">import</span> time</span>
<span id="cb29-5"><a href="#cb29-5"></a><span class="im">from</span> dataclasses <span class="im">import</span> dataclass</span>
<span id="cb29-6"><a href="#cb29-6"></a></span>
<span id="cb29-7"><a href="#cb29-7"></a><span class="at">@dataclass</span></span>
<span id="cb29-8"><a href="#cb29-8"></a><span class="kw">class</span> AgentMetadata:</span>
<span id="cb29-9"><a href="#cb29-9"></a>    <span class="co">"""Agent 메타데이터"""</span></span>
<span id="cb29-10"><a href="#cb29-10"></a>    name: <span class="bu">str</span></span>
<span id="cb29-11"><a href="#cb29-11"></a>    version: <span class="bu">str</span></span>
<span id="cb29-12"><a href="#cb29-12"></a>    domain: <span class="bu">str</span></span>
<span id="cb29-13"><a href="#cb29-13"></a>    description: <span class="bu">str</span></span>
<span id="cb29-14"><a href="#cb29-14"></a>    author: <span class="bu">str</span></span>
<span id="cb29-15"><a href="#cb29-15"></a>    created_at: <span class="bu">str</span></span>
<span id="cb29-16"><a href="#cb29-16"></a></span>
<span id="cb29-17"><a href="#cb29-17"></a><span class="kw">class</span> BaseAgent(ABC):</span>
<span id="cb29-18"><a href="#cb29-18"></a>    <span class="co">"""모든 Agent가 상속해야 하는 기본 클래스</span></span>
<span id="cb29-19"><a href="#cb29-19"></a><span class="co">    </span></span>
<span id="cb29-20"><a href="#cb29-20"></a><span class="co">    설계 원칙:</span></span>
<span id="cb29-21"><a href="#cb29-21"></a><span class="co">    1. 표준 입출력: Dict[str, Any] (확장성)</span></span>
<span id="cb29-22"><a href="#cb29-22"></a><span class="co">    2. Template Method Pattern: execute()는 final</span></span>
<span id="cb29-23"><a href="#cb29-23"></a><span class="co">    3. Hook Methods: _pre_process, _post_process</span></span>
<span id="cb29-24"><a href="#cb29-24"></a><span class="co">    """</span></span>
<span id="cb29-25"><a href="#cb29-25"></a>    </span>
<span id="cb29-26"><a href="#cb29-26"></a>    <span class="kw">def</span> <span class="fu">__init__</span>(<span class="va">self</span>, metadata: AgentMetadata):</span>
<span id="cb29-27"><a href="#cb29-27"></a>        <span class="va">self</span>.metadata <span class="op">=</span> metadata</span>
<span id="cb29-28"><a href="#cb29-28"></a>        <span class="va">self</span>.execution_count <span class="op">=</span> <span class="dv">0</span></span>
<span id="cb29-29"><a href="#cb29-29"></a>        <span class="va">self</span>.total_time <span class="op">=</span> <span class="fl">0.0</span></span>
<span id="cb29-30"><a href="#cb29-30"></a>        <span class="va">self</span>.errors <span class="op">=</span> []</span>
<span id="cb29-31"><a href="#cb29-31"></a>    </span>
<span id="cb29-32"><a href="#cb29-32"></a>    <span class="at">@abstractmethod</span></span>
<span id="cb29-33"><a href="#cb29-33"></a>    <span class="kw">def</span> process(<span class="va">self</span>, <span class="bu">input</span>: Dict[<span class="bu">str</span>, Any]) <span class="op">-&gt;</span> Dict[<span class="bu">str</span>, Any]:</span>
<span id="cb29-34"><a href="#cb29-34"></a>        <span class="co">"""핵심 비즈니스 로직</span></span>
<span id="cb29-35"><a href="#cb29-35"></a><span class="co">        </span></span>
<span id="cb29-36"><a href="#cb29-36"></a><span class="co">        Args:</span></span>
<span id="cb29-37"><a href="#cb29-37"></a><span class="co">            input: 표준화된 입력 딕셔너리</span></span>
<span id="cb29-38"><a href="#cb29-38"></a><span class="co">                - 'task': 작업 유형</span></span>
<span id="cb29-39"><a href="#cb29-39"></a><span class="co">                - 'data': 실제 데이터</span></span>
<span id="cb29-40"><a href="#cb29-40"></a><span class="co">                - 'config': 실행 옵션</span></span>
<span id="cb29-41"><a href="#cb29-41"></a><span class="co">        </span></span>
<span id="cb29-42"><a href="#cb29-42"></a><span class="co">        Returns:</span></span>
<span id="cb29-43"><a href="#cb29-43"></a><span class="co">            출력 딕셔너리</span></span>
<span id="cb29-44"><a href="#cb29-44"></a><span class="co">                - 'result': 실행 결과</span></span>
<span id="cb29-45"><a href="#cb29-45"></a><span class="co">                - 'metadata': 실행 정보</span></span>
<span id="cb29-46"><a href="#cb29-46"></a><span class="co">                - 'confidence': 신뢰도 (0-1)</span></span>
<span id="cb29-47"><a href="#cb29-47"></a><span class="co">        """</span></span>
<span id="cb29-48"><a href="#cb29-48"></a>        <span class="cf">pass</span></span>
<span id="cb29-49"><a href="#cb29-49"></a>    </span>
<span id="cb29-50"><a href="#cb29-50"></a>    <span class="at">@abstractmethod</span></span>
<span id="cb29-51"><a href="#cb29-51"></a>    <span class="kw">def</span> evaluate(<span class="va">self</span>, ground_truth: Any, prediction: Any) <span class="op">-&gt;</span> <span class="bu">float</span>:</span>
<span id="cb29-52"><a href="#cb29-52"></a>        <span class="co">"""성능 평가</span></span>
<span id="cb29-53"><a href="#cb29-53"></a><span class="co">        </span></span>
<span id="cb29-54"><a href="#cb29-54"></a><span class="co">        각 Agent는 도메인에 맞는 평가 메트릭 구현</span></span>
<span id="cb29-55"><a href="#cb29-55"></a><span class="co">        예: 데이터 표준화 - 스키마 매칭 정확도</span></span>
<span id="cb29-56"><a href="#cb29-56"></a><span class="co">            코드 분석 - AST 파싱 성공률</span></span>
<span id="cb29-57"><a href="#cb29-57"></a><span class="co">        """</span></span>
<span id="cb29-58"><a href="#cb29-58"></a>        <span class="cf">pass</span></span>
<span id="cb29-59"><a href="#cb29-59"></a>    </span>
<span id="cb29-60"><a href="#cb29-60"></a>    <span class="kw">def</span> execute(<span class="va">self</span>, <span class="bu">input</span>: Dict[<span class="bu">str</span>, Any]) <span class="op">-&gt;</span> Dict[<span class="bu">str</span>, Any]:</span>
<span id="cb29-61"><a href="#cb29-61"></a>        <span class="co">"""Agent 실행 (Template Method - 수정 불가)</span></span>
<span id="cb29-62"><a href="#cb29-62"></a><span class="co">        </span></span>
<span id="cb29-63"><a href="#cb29-63"></a><span class="co">        실행 흐름:</span></span>
<span id="cb29-64"><a href="#cb29-64"></a><span class="co">        1. 입력 검증</span></span>
<span id="cb29-65"><a href="#cb29-65"></a><span class="co">        2. 전처리 (hook)</span></span>
<span id="cb29-66"><a href="#cb29-66"></a><span class="co">        3. 실제 process() 호출</span></span>
<span id="cb29-67"><a href="#cb29-67"></a><span class="co">        4. 후처리 (hook)</span></span>
<span id="cb29-68"><a href="#cb29-68"></a><span class="co">        5. 메트릭 수집</span></span>
<span id="cb29-69"><a href="#cb29-69"></a><span class="co">        """</span></span>
<span id="cb29-70"><a href="#cb29-70"></a>        <span class="co"># 1. 입력 검증</span></span>
<span id="cb29-71"><a href="#cb29-71"></a>        <span class="va">self</span>._validate_input(<span class="bu">input</span>)</span>
<span id="cb29-72"><a href="#cb29-72"></a>        </span>
<span id="cb29-73"><a href="#cb29-73"></a>        <span class="co"># 2. 전처리 (선택적 override)</span></span>
<span id="cb29-74"><a href="#cb29-74"></a>        <span class="bu">input</span> <span class="op">=</span> <span class="va">self</span>._pre_process(<span class="bu">input</span>)</span>
<span id="cb29-75"><a href="#cb29-75"></a>        </span>
<span id="cb29-76"><a href="#cb29-76"></a>        <span class="co"># 3. 실행 시간 측정</span></span>
<span id="cb29-77"><a href="#cb29-77"></a>        start_time <span class="op">=</span> time.time()</span>
<span id="cb29-78"><a href="#cb29-78"></a>        </span>
<span id="cb29-79"><a href="#cb29-79"></a>        <span class="cf">try</span>:</span>
<span id="cb29-80"><a href="#cb29-80"></a>            <span class="co"># 4. 핵심 로직 실행</span></span>
<span id="cb29-81"><a href="#cb29-81"></a>            result <span class="op">=</span> <span class="va">self</span>.process(<span class="bu">input</span>)</span>
<span id="cb29-82"><a href="#cb29-82"></a>            </span>
<span id="cb29-83"><a href="#cb29-83"></a>            <span class="co"># 5. 후처리</span></span>
<span id="cb29-84"><a href="#cb29-84"></a>            result <span class="op">=</span> <span class="va">self</span>._post_process(result)</span>
<span id="cb29-85"><a href="#cb29-85"></a>            </span>
<span id="cb29-86"><a href="#cb29-86"></a>            <span class="co"># 6. 성공 메트릭</span></span>
<span id="cb29-87"><a href="#cb29-87"></a>            elapsed <span class="op">=</span> time.time() <span class="op">-</span> start_time</span>
<span id="cb29-88"><a href="#cb29-88"></a>            <span class="va">self</span>.execution_count <span class="op">+=</span> <span class="dv">1</span></span>
<span id="cb29-89"><a href="#cb29-89"></a>            <span class="va">self</span>.total_time <span class="op">+=</span> elapsed</span>
<span id="cb29-90"><a href="#cb29-90"></a>            </span>
<span id="cb29-91"><a href="#cb29-91"></a>            <span class="co"># 7. 메타데이터 추가</span></span>
<span id="cb29-92"><a href="#cb29-92"></a>            result[<span class="st">'metadata'</span>] <span class="op">=</span> {</span>
<span id="cb29-93"><a href="#cb29-93"></a>                <span class="st">'agent'</span>: <span class="va">self</span>.metadata.name,</span>
<span id="cb29-94"><a href="#cb29-94"></a>                <span class="st">'version'</span>: <span class="va">self</span>.metadata.version,</span>
<span id="cb29-95"><a href="#cb29-95"></a>                <span class="st">'execution_time'</span>: elapsed,</span>
<span id="cb29-96"><a href="#cb29-96"></a>                <span class="st">'timestamp'</span>: time.time()</span>
<span id="cb29-97"><a href="#cb29-97"></a>            }</span>
<span id="cb29-98"><a href="#cb29-98"></a>            </span>
<span id="cb29-99"><a href="#cb29-99"></a>            <span class="cf">return</span> result</span>
<span id="cb29-100"><a href="#cb29-100"></a>            </span>
<span id="cb29-101"><a href="#cb29-101"></a>        <span class="cf">except</span> <span class="pp">Exception</span> <span class="im">as</span> e:</span>
<span id="cb29-102"><a href="#cb29-102"></a>            <span class="va">self</span>.errors.append(<span class="bu">str</span>(e))</span>
<span id="cb29-103"><a href="#cb29-103"></a>            <span class="cf">raise</span></span>
<span id="cb29-104"><a href="#cb29-104"></a>    </span>
<span id="cb29-105"><a href="#cb29-105"></a>    <span class="kw">def</span> _validate_input(<span class="va">self</span>, <span class="bu">input</span>: Dict[<span class="bu">str</span>, Any]):</span>
<span id="cb29-106"><a href="#cb29-106"></a>        <span class="co">"""입력 검증 (공통 규칙)"""</span></span>
<span id="cb29-107"><a href="#cb29-107"></a>        <span class="cf">if</span> <span class="kw">not</span> <span class="bu">isinstance</span>(<span class="bu">input</span>, <span class="bu">dict</span>):</span>
<span id="cb29-108"><a href="#cb29-108"></a>            <span class="cf">raise</span> <span class="pp">ValueError</span>(<span class="st">"Input must be a dictionary"</span>)</span>
<span id="cb29-109"><a href="#cb29-109"></a>        <span class="cf">if</span> <span class="st">'task'</span> <span class="kw">not</span> <span class="kw">in</span> <span class="bu">input</span>:</span>
<span id="cb29-110"><a href="#cb29-110"></a>            <span class="cf">raise</span> <span class="pp">ValueError</span>(<span class="st">"Input must contain 'task' field"</span>)</span>
<span id="cb29-111"><a href="#cb29-111"></a>    </span>
<span id="cb29-112"><a href="#cb29-112"></a>    <span class="kw">def</span> _pre_process(<span class="va">self</span>, <span class="bu">input</span>: Dict[<span class="bu">str</span>, Any]) <span class="op">-&gt;</span> Dict[<span class="bu">str</span>, Any]:</span>
<span id="cb29-113"><a href="#cb29-113"></a>        <span class="co">"""전처리 hook (선택적 override)"""</span></span>
<span id="cb29-114"><a href="#cb29-114"></a>        <span class="cf">return</span> <span class="bu">input</span></span>
<span id="cb29-115"><a href="#cb29-115"></a>    </span>
<span id="cb29-116"><a href="#cb29-116"></a>    <span class="kw">def</span> _post_process(<span class="va">self</span>, output: Dict[<span class="bu">str</span>, Any]) <span class="op">-&gt;</span> Dict[<span class="bu">str</span>, Any]:</span>
<span id="cb29-117"><a href="#cb29-117"></a>        <span class="co">"""후처리 hook (선택적 override)"""</span></span>
<span id="cb29-118"><a href="#cb29-118"></a>        <span class="cf">return</span> output</span>
<span id="cb29-119"><a href="#cb29-119"></a>    </span>
<span id="cb29-120"><a href="#cb29-120"></a>    <span class="kw">def</span> get_metrics(<span class="va">self</span>) <span class="op">-&gt;</span> Dict[<span class="bu">str</span>, Any]:</span>
<span id="cb29-121"><a href="#cb29-121"></a>        <span class="co">"""Agent 성능 메트릭"""</span></span>
<span id="cb29-122"><a href="#cb29-122"></a>        <span class="cf">return</span> {</span>
<span id="cb29-123"><a href="#cb29-123"></a>            <span class="st">'name'</span>: <span class="va">self</span>.metadata.name,</span>
<span id="cb29-124"><a href="#cb29-124"></a>            <span class="st">'executions'</span>: <span class="va">self</span>.execution_count,</span>
<span id="cb29-125"><a href="#cb29-125"></a>            <span class="st">'avg_time'</span>: <span class="va">self</span>.total_time <span class="op">/</span> <span class="bu">max</span>(<span class="va">self</span>.execution_count, <span class="dv">1</span>),</span>
<span id="cb29-126"><a href="#cb29-126"></a>            <span class="st">'error_rate'</span>: <span class="bu">len</span>(<span class="va">self</span>.errors) <span class="op">/</span> <span class="bu">max</span>(<span class="va">self</span>.execution_count, <span class="dv">1</span>)</span>
<span id="cb29-127"><a href="#cb29-127"></a>        }</span></code><button title="클립보드 복사" class="code-copy-button"><i class="bi"></i></button></pre></div>
</section>
<section id="agent-registry-dependency-inversion-구현" class="level3" data-number="6.5.2">
<h3 data-number="6.5.2" class="anchored" data-anchor-id="agent-registry-dependency-inversion-구현"><span class="header-section-number">6.5.2</span> Agent Registry (Dependency Inversion 구현)</h3>
<div class="sourceCode" id="cb30"><pre class="sourceCode numberSource python number-lines code-with-copy"><code class="sourceCode python"><span id="cb30-1"><a href="#cb30-1"></a><span class="co"># core/agent/registry.py</span></span>
<span id="cb30-2"><a href="#cb30-2"></a><span class="im">from</span> typing <span class="im">import</span> Dict, Type</span>
<span id="cb30-3"><a href="#cb30-3"></a><span class="im">from</span> .base_agent <span class="im">import</span> BaseAgent</span>
<span id="cb30-4"><a href="#cb30-4"></a></span>
<span id="cb30-5"><a href="#cb30-5"></a><span class="kw">class</span> AgentRegistry:</span>
<span id="cb30-6"><a href="#cb30-6"></a>    <span class="co">"""Agent 등록 및 조회</span></span>
<span id="cb30-7"><a href="#cb30-7"></a><span class="co">    </span></span>
<span id="cb30-8"><a href="#cb30-8"></a><span class="co">    Dependency Inversion 구현:</span></span>
<span id="cb30-9"><a href="#cb30-9"></a><span class="co">    - Core는 구체적인 Agent를 모름</span></span>
<span id="cb30-10"><a href="#cb30-10"></a><span class="co">    - Agent가 스스로 Registry에 등록</span></span>
<span id="cb30-11"><a href="#cb30-11"></a><span class="co">    """</span></span>
<span id="cb30-12"><a href="#cb30-12"></a>    </span>
<span id="cb30-13"><a href="#cb30-13"></a>    _instance <span class="op">=</span> <span class="va">None</span></span>
<span id="cb30-14"><a href="#cb30-14"></a>    _agents: Dict[<span class="bu">str</span>, BaseAgent] <span class="op">=</span> {}</span>
<span id="cb30-15"><a href="#cb30-15"></a>    </span>
<span id="cb30-16"><a href="#cb30-16"></a>    <span class="at">@classmethod</span></span>
<span id="cb30-17"><a href="#cb30-17"></a>    <span class="kw">def</span> get_instance(cls):</span>
<span id="cb30-18"><a href="#cb30-18"></a>        <span class="cf">if</span> cls._instance <span class="kw">is</span> <span class="va">None</span>:</span>
<span id="cb30-19"><a href="#cb30-19"></a>            cls._instance <span class="op">=</span> cls()</span>
<span id="cb30-20"><a href="#cb30-20"></a>        <span class="cf">return</span> cls._instance</span>
<span id="cb30-21"><a href="#cb30-21"></a>    </span>
<span id="cb30-22"><a href="#cb30-22"></a>    <span class="kw">def</span> register(<span class="va">self</span>, agent: BaseAgent):</span>
<span id="cb30-23"><a href="#cb30-23"></a>        <span class="co">"""Agent 등록"""</span></span>
<span id="cb30-24"><a href="#cb30-24"></a>        <span class="cf">if</span> agent.metadata.name <span class="kw">in</span> <span class="va">self</span>._agents:</span>
<span id="cb30-25"><a href="#cb30-25"></a>            <span class="cf">raise</span> <span class="pp">ValueError</span>(<span class="ss">f"Agent </span><span class="sc">{</span>agent<span class="sc">.</span>metadata<span class="sc">.</span>name<span class="sc">}</span><span class="ss"> already registered"</span>)</span>
<span id="cb30-26"><a href="#cb30-26"></a>        </span>
<span id="cb30-27"><a href="#cb30-27"></a>        <span class="va">self</span>._agents[agent.metadata.name] <span class="op">=</span> agent</span>
<span id="cb30-28"><a href="#cb30-28"></a>        <span class="bu">print</span>(<span class="ss">f"✓ Registered: </span><span class="sc">{</span>agent<span class="sc">.</span>metadata<span class="sc">.</span>name<span class="sc">}</span><span class="ss"> v</span><span class="sc">{</span>agent<span class="sc">.</span>metadata<span class="sc">.</span>version<span class="sc">}</span><span class="ss">"</span>)</span>
<span id="cb30-29"><a href="#cb30-29"></a>    </span>
<span id="cb30-30"><a href="#cb30-30"></a>    <span class="kw">def</span> get(<span class="va">self</span>, name: <span class="bu">str</span>) <span class="op">-&gt;</span> BaseAgent:</span>
<span id="cb30-31"><a href="#cb30-31"></a>        <span class="co">"""Agent 조회"""</span></span>
<span id="cb30-32"><a href="#cb30-32"></a>        <span class="cf">if</span> name <span class="kw">not</span> <span class="kw">in</span> <span class="va">self</span>._agents:</span>
<span id="cb30-33"><a href="#cb30-33"></a>            <span class="cf">raise</span> <span class="pp">ValueError</span>(<span class="ss">f"Agent </span><span class="sc">{</span>name<span class="sc">}</span><span class="ss"> not found"</span>)</span>
<span id="cb30-34"><a href="#cb30-34"></a>        <span class="cf">return</span> <span class="va">self</span>._agents[name]</span>
<span id="cb30-35"><a href="#cb30-35"></a>    </span>
<span id="cb30-36"><a href="#cb30-36"></a>    <span class="kw">def</span> list_all(<span class="va">self</span>) <span class="op">-&gt;</span> Dict[<span class="bu">str</span>, BaseAgent]:</span>
<span id="cb30-37"><a href="#cb30-37"></a>        <span class="co">"""모든 Agent 목록"""</span></span>
<span id="cb30-38"><a href="#cb30-38"></a>        <span class="cf">return</span> <span class="va">self</span>._agents.copy()</span></code><button title="클립보드 복사" class="code-copy-button"><i class="bi"></i></button></pre></div>
</section>
<section id="orchestrator-agent-실행-관리-1" class="level3" data-number="6.5.3">
<h3 data-number="6.5.3" class="anchored" data-anchor-id="orchestrator-agent-실행-관리-1"><span class="header-section-number">6.5.3</span> Orchestrator (Agent 실행 관리)</h3>
<div class="sourceCode" id="cb31"><pre class="sourceCode numberSource python number-lines code-with-copy"><code class="sourceCode python"><span id="cb31-1"><a href="#cb31-1"></a><span class="co"># core/orchestrator.py</span></span>
<span id="cb31-2"><a href="#cb31-2"></a><span class="im">from</span> typing <span class="im">import</span> Dict, List, Any</span>
<span id="cb31-3"><a href="#cb31-3"></a><span class="im">from</span> .agent.registry <span class="im">import</span> AgentRegistry</span>
<span id="cb31-4"><a href="#cb31-4"></a></span>
<span id="cb31-5"><a href="#cb31-5"></a><span class="kw">class</span> AgentOrchestrator:</span>
<span id="cb31-6"><a href="#cb31-6"></a>    <span class="co">"""Agent 실행 및 조율</span></span>
<span id="cb31-7"><a href="#cb31-7"></a><span class="co">    </span></span>
<span id="cb31-8"><a href="#cb31-8"></a><span class="co">    기능:</span></span>
<span id="cb31-9"><a href="#cb31-9"></a><span class="co">    - Agent 실행</span></span>
<span id="cb31-10"><a href="#cb31-10"></a><span class="co">    - Agent 체이닝 (순차 실행)</span></span>
<span id="cb31-11"><a href="#cb31-11"></a><span class="co">    - 병렬 실행 (선택)</span></span>
<span id="cb31-12"><a href="#cb31-12"></a><span class="co">    """</span></span>
<span id="cb31-13"><a href="#cb31-13"></a>    </span>
<span id="cb31-14"><a href="#cb31-14"></a>    <span class="kw">def</span> <span class="fu">__init__</span>(<span class="va">self</span>):</span>
<span id="cb31-15"><a href="#cb31-15"></a>        <span class="va">self</span>.registry <span class="op">=</span> AgentRegistry.get_instance()</span>
<span id="cb31-16"><a href="#cb31-16"></a>    </span>
<span id="cb31-17"><a href="#cb31-17"></a>    <span class="kw">def</span> run(<span class="va">self</span>, agent_name: <span class="bu">str</span>, input_data: Dict[<span class="bu">str</span>, Any]) <span class="op">-&gt;</span> Dict[<span class="bu">str</span>, Any]:</span>
<span id="cb31-18"><a href="#cb31-18"></a>        <span class="co">"""단일 Agent 실행"""</span></span>
<span id="cb31-19"><a href="#cb31-19"></a>        agent <span class="op">=</span> <span class="va">self</span>.registry.get(agent_name)</span>
<span id="cb31-20"><a href="#cb31-20"></a>        <span class="cf">return</span> agent.execute(input_data)</span>
<span id="cb31-21"><a href="#cb31-21"></a>    </span>
<span id="cb31-22"><a href="#cb31-22"></a>    <span class="kw">def</span> chain(<span class="va">self</span>, agent_names: List[<span class="bu">str</span>], input_data: Dict[<span class="bu">str</span>, Any]) <span class="op">-&gt;</span> Dict[<span class="bu">str</span>, Any]:</span>
<span id="cb31-23"><a href="#cb31-23"></a>        <span class="co">"""Agent 체이닝 (순차 실행)</span></span>
<span id="cb31-24"><a href="#cb31-24"></a><span class="co">        </span></span>
<span id="cb31-25"><a href="#cb31-25"></a><span class="co">        Example:</span></span>
<span id="cb31-26"><a href="#cb31-26"></a><span class="co">            orchestrator.chain(</span></span>
<span id="cb31-27"><a href="#cb31-27"></a><span class="co">                ['data_standardization', 'code_analysis', 'knowledge_qna'],</span></span>
<span id="cb31-28"><a href="#cb31-28"></a><span class="co">                {'task': 'analyze', 'data': schema}</span></span>
<span id="cb31-29"><a href="#cb31-29"></a><span class="co">            )</span></span>
<span id="cb31-30"><a href="#cb31-30"></a><span class="co">        """</span></span>
<span id="cb31-31"><a href="#cb31-31"></a>        result <span class="op">=</span> input_data</span>
<span id="cb31-32"><a href="#cb31-32"></a>        </span>
<span id="cb31-33"><a href="#cb31-33"></a>        <span class="cf">for</span> agent_name <span class="kw">in</span> agent_names:</span>
<span id="cb31-34"><a href="#cb31-34"></a>            agent <span class="op">=</span> <span class="va">self</span>.registry.get(agent_name)</span>
<span id="cb31-35"><a href="#cb31-35"></a>            result <span class="op">=</span> agent.execute(result)</span>
<span id="cb31-36"><a href="#cb31-36"></a>        </span>
<span id="cb31-37"><a href="#cb31-37"></a>        <span class="cf">return</span> result</span>
<span id="cb31-38"><a href="#cb31-38"></a>    </span>
<span id="cb31-39"><a href="#cb31-39"></a>    <span class="kw">def</span> parallel(<span class="va">self</span>, agent_names: List[<span class="bu">str</span>], input_data: Dict[<span class="bu">str</span>, Any]) <span class="op">-&gt;</span> List[Dict[<span class="bu">str</span>, Any]]:</span>
<span id="cb31-40"><a href="#cb31-40"></a>        <span class="co">"""병렬 실행 (동일 입력, 여러 Agent)"""</span></span>
<span id="cb31-41"><a href="#cb31-41"></a>        results <span class="op">=</span> []</span>
<span id="cb31-42"><a href="#cb31-42"></a>        </span>
<span id="cb31-43"><a href="#cb31-43"></a>        <span class="cf">for</span> agent_name <span class="kw">in</span> agent_names:</span>
<span id="cb31-44"><a href="#cb31-44"></a>            agent <span class="op">=</span> <span class="va">self</span>.registry.get(agent_name)</span>
<span id="cb31-45"><a href="#cb31-45"></a>            result <span class="op">=</span> agent.execute(input_data)</span>
<span id="cb31-46"><a href="#cb31-46"></a>            results.append(result)</span>
<span id="cb31-47"><a href="#cb31-47"></a>        </span>
<span id="cb31-48"><a href="#cb31-48"></a>        <span class="cf">return</span> results</span></code><button title="클립보드 복사" class="code-copy-button"><i class="bi"></i></button></pre></div>
</section>
</section>
<section id="shared-모듈-공통-라이브러리" class="level2" data-number="6.6">
<h2 data-number="6.6" class="anchored" data-anchor-id="shared-모듈-공통-라이브러리"><span class="header-section-number">6.6</span> shared/ 모듈: 공통 라이브러리</h2>
<p><strong>역할</strong>: Agent들이 재사용하는 공통 기능</p>
<div class="sourceCode" id="cb32"><pre class="sourceCode numberSource python number-lines code-with-copy"><code class="sourceCode python"><span id="cb32-1"><a href="#cb32-1"></a>shared<span class="op">/</span></span>
<span id="cb32-2"><a href="#cb32-2"></a>├── llm<span class="op">/</span></span>
<span id="cb32-3"><a href="#cb32-3"></a>│   ├── client.py              <span class="co"># LLM 클라이언트 (2번 글의 LLMClient)</span></span>
<span id="cb32-4"><a href="#cb32-4"></a>│   ├── prompt_engine.py       <span class="co"># 프롬프트 템플릿 관리</span></span>
<span id="cb32-5"><a href="#cb32-5"></a>│   └── context_manager.py     <span class="co"># 컨텍스트 윈도우 관리</span></span>
<span id="cb32-6"><a href="#cb32-6"></a>├── validation<span class="op">/</span></span>
<span id="cb32-7"><a href="#cb32-7"></a>│   ├── json_parser.py         <span class="co"># JSON 파싱 및 검증</span></span>
<span id="cb32-8"><a href="#cb32-8"></a>│   └── schema_validator.py    <span class="co"># 스키마 검증</span></span>
<span id="cb32-9"><a href="#cb32-9"></a>├── logging<span class="op">/</span></span>
<span id="cb32-10"><a href="#cb32-10"></a>│   └── structured_logger.py   <span class="co"># 구조화된 로깅</span></span>
<span id="cb32-11"><a href="#cb32-11"></a>├── monitoring<span class="op">/</span></span>
<span id="cb32-12"><a href="#cb32-12"></a>│   ├── metrics.py             <span class="co"># 메트릭 수집</span></span>
<span id="cb32-13"><a href="#cb32-13"></a>│   └── dashboard.py           <span class="co"># 대시보드 연동</span></span>
<span id="cb32-14"><a href="#cb32-14"></a>└── document_processing<span class="op">/</span></span>
<span id="cb32-15"><a href="#cb32-15"></a>    ├── pdf_parser.py</span>
<span id="cb32-16"><a href="#cb32-16"></a>    ├── code_parser.py</span>
<span id="cb32-17"><a href="#cb32-17"></a>    └── text_extractor.py</span></code><button title="클립보드 복사" class="code-copy-button"><i class="bi"></i></button></pre></div>
<section id="llm-클라이언트-2번-글-확장" class="level3" data-number="6.6.1">
<h3 data-number="6.6.1" class="anchored" data-anchor-id="llm-클라이언트-2번-글-확장"><span class="header-section-number">6.6.1</span> LLM 클라이언트 (2번 글 확장)</h3>
<div class="sourceCode" id="cb33"><pre class="sourceCode numberSource python number-lines code-with-copy"><code class="sourceCode python"><span id="cb33-1"><a href="#cb33-1"></a><span class="co"># shared/llm/client.py</span></span>
<span id="cb33-2"><a href="#cb33-2"></a><span class="im">from</span> typing <span class="im">import</span> Optional, Dict, Any</span>
<span id="cb33-3"><a href="#cb33-3"></a><span class="im">from</span> openai <span class="im">import</span> OpenAI</span>
<span id="cb33-4"><a href="#cb33-4"></a><span class="im">from</span> anthropic <span class="im">import</span> Anthropic</span>
<span id="cb33-5"><a href="#cb33-5"></a><span class="im">import</span> time</span>
<span id="cb33-6"><a href="#cb33-6"></a></span>
<span id="cb33-7"><a href="#cb33-7"></a><span class="kw">class</span> LLMClient:</span>
<span id="cb33-8"><a href="#cb33-8"></a>    <span class="co">"""통합 LLM 클라이언트</span></span>
<span id="cb33-9"><a href="#cb33-9"></a><span class="co">    </span></span>
<span id="cb33-10"><a href="#cb33-10"></a><span class="co">    2번 글의 LLMClient를 확장:</span></span>
<span id="cb33-11"><a href="#cb33-11"></a><span class="co">    - 토큰 카운팅</span></span>
<span id="cb33-12"><a href="#cb33-12"></a><span class="co">    - 비용 추적</span></span>
<span id="cb33-13"><a href="#cb33-13"></a><span class="co">    - 캐싱</span></span>
<span id="cb33-14"><a href="#cb33-14"></a><span class="co">    """</span></span>
<span id="cb33-15"><a href="#cb33-15"></a>    </span>
<span id="cb33-16"><a href="#cb33-16"></a>    <span class="kw">def</span> <span class="fu">__init__</span>(</span>
<span id="cb33-17"><a href="#cb33-17"></a>        <span class="va">self</span>,</span>
<span id="cb33-18"><a href="#cb33-18"></a>        provider: <span class="bu">str</span> <span class="op">=</span> <span class="st">"openai"</span>,</span>
<span id="cb33-19"><a href="#cb33-19"></a>        model: <span class="bu">str</span> <span class="op">=</span> <span class="st">"gpt-4"</span>,</span>
<span id="cb33-20"><a href="#cb33-20"></a>        max_retries: <span class="bu">int</span> <span class="op">=</span> <span class="dv">3</span>,</span>
<span id="cb33-21"><a href="#cb33-21"></a>        cache_enabled: <span class="bu">bool</span> <span class="op">=</span> <span class="va">True</span></span>
<span id="cb33-22"><a href="#cb33-22"></a>    ):</span>
<span id="cb33-23"><a href="#cb33-23"></a>        <span class="va">self</span>.provider <span class="op">=</span> provider</span>
<span id="cb33-24"><a href="#cb33-24"></a>        <span class="va">self</span>.model <span class="op">=</span> model</span>
<span id="cb33-25"><a href="#cb33-25"></a>        <span class="va">self</span>.max_retries <span class="op">=</span> max_retries</span>
<span id="cb33-26"><a href="#cb33-26"></a>        <span class="va">self</span>.cache_enabled <span class="op">=</span> cache_enabled</span>
<span id="cb33-27"><a href="#cb33-27"></a>        </span>
<span id="cb33-28"><a href="#cb33-28"></a>        <span class="co"># 캐시</span></span>
<span id="cb33-29"><a href="#cb33-29"></a>        <span class="va">self</span>._cache: Dict[<span class="bu">str</span>, <span class="bu">str</span>] <span class="op">=</span> {}</span>
<span id="cb33-30"><a href="#cb33-30"></a>        </span>
<span id="cb33-31"><a href="#cb33-31"></a>        <span class="co"># 비용 추적</span></span>
<span id="cb33-32"><a href="#cb33-32"></a>        <span class="va">self</span>.total_tokens <span class="op">=</span> <span class="dv">0</span></span>
<span id="cb33-33"><a href="#cb33-33"></a>        <span class="va">self</span>.total_cost <span class="op">=</span> <span class="fl">0.0</span></span>
<span id="cb33-34"><a href="#cb33-34"></a>        </span>
<span id="cb33-35"><a href="#cb33-35"></a>        <span class="co"># 클라이언트 초기화</span></span>
<span id="cb33-36"><a href="#cb33-36"></a>        <span class="cf">if</span> provider <span class="op">==</span> <span class="st">"openai"</span>:</span>
<span id="cb33-37"><a href="#cb33-37"></a>            <span class="va">self</span>.client <span class="op">=</span> OpenAI()</span>
<span id="cb33-38"><a href="#cb33-38"></a>            <span class="va">self</span>.cost_per_token <span class="op">=</span> <span class="fl">0.00003</span>  <span class="co"># GPT-4 가격</span></span>
<span id="cb33-39"><a href="#cb33-39"></a>        <span class="cf">elif</span> provider <span class="op">==</span> <span class="st">"anthropic"</span>:</span>
<span id="cb33-40"><a href="#cb33-40"></a>            <span class="va">self</span>.client <span class="op">=</span> Anthropic()</span>
<span id="cb33-41"><a href="#cb33-41"></a>            <span class="va">self</span>.cost_per_token <span class="op">=</span> <span class="fl">0.00008</span>  <span class="co"># Claude 가격</span></span>
<span id="cb33-42"><a href="#cb33-42"></a>    </span>
<span id="cb33-43"><a href="#cb33-43"></a>    <span class="kw">def</span> generate(</span>
<span id="cb33-44"><a href="#cb33-44"></a>        <span class="va">self</span>,</span>
<span id="cb33-45"><a href="#cb33-45"></a>        prompt: <span class="bu">str</span>,</span>
<span id="cb33-46"><a href="#cb33-46"></a>        system_message: Optional[<span class="bu">str</span>] <span class="op">=</span> <span class="va">None</span>,</span>
<span id="cb33-47"><a href="#cb33-47"></a>        temperature: <span class="bu">float</span> <span class="op">=</span> <span class="fl">0.0</span></span>
<span id="cb33-48"><a href="#cb33-48"></a>    ) <span class="op">-&gt;</span> <span class="bu">str</span>:</span>
<span id="cb33-49"><a href="#cb33-49"></a>        <span class="co">"""텍스트 생성 (캐싱 + 재시도)"""</span></span>
<span id="cb33-50"><a href="#cb33-50"></a>        </span>
<span id="cb33-51"><a href="#cb33-51"></a>        <span class="co"># 캐시 확인</span></span>
<span id="cb33-52"><a href="#cb33-52"></a>        cache_key <span class="op">=</span> <span class="ss">f"</span><span class="sc">{</span>prompt<span class="sc">}</span><span class="ss">:</span><span class="sc">{</span>system_message<span class="sc">}</span><span class="ss">:</span><span class="sc">{</span>temperature<span class="sc">}</span><span class="ss">"</span></span>
<span id="cb33-53"><a href="#cb33-53"></a>        <span class="cf">if</span> <span class="va">self</span>.cache_enabled <span class="kw">and</span> cache_key <span class="kw">in</span> <span class="va">self</span>._cache:</span>
<span id="cb33-54"><a href="#cb33-54"></a>            <span class="cf">return</span> <span class="va">self</span>._cache[cache_key]</span>
<span id="cb33-55"><a href="#cb33-55"></a>        </span>
<span id="cb33-56"><a href="#cb33-56"></a>        <span class="co"># 재시도 로직</span></span>
<span id="cb33-57"><a href="#cb33-57"></a>        <span class="cf">for</span> attempt <span class="kw">in</span> <span class="bu">range</span>(<span class="va">self</span>.max_retries):</span>
<span id="cb33-58"><a href="#cb33-58"></a>            <span class="cf">try</span>:</span>
<span id="cb33-59"><a href="#cb33-59"></a>                <span class="cf">if</span> <span class="va">self</span>.provider <span class="op">==</span> <span class="st">"openai"</span>:</span>
<span id="cb33-60"><a href="#cb33-60"></a>                    response <span class="op">=</span> <span class="va">self</span>._call_openai(prompt, system_message, temperature)</span>
<span id="cb33-61"><a href="#cb33-61"></a>                <span class="cf">elif</span> <span class="va">self</span>.provider <span class="op">==</span> <span class="st">"anthropic"</span>:</span>
<span id="cb33-62"><a href="#cb33-62"></a>                    response <span class="op">=</span> <span class="va">self</span>._call_anthropic(prompt, system_message, temperature)</span>
<span id="cb33-63"><a href="#cb33-63"></a>                </span>
<span id="cb33-64"><a href="#cb33-64"></a>                <span class="co"># 캐시 저장</span></span>
<span id="cb33-65"><a href="#cb33-65"></a>                <span class="cf">if</span> <span class="va">self</span>.cache_enabled:</span>
<span id="cb33-66"><a href="#cb33-66"></a>                    <span class="va">self</span>._cache[cache_key] <span class="op">=</span> response</span>
<span id="cb33-67"><a href="#cb33-67"></a>                </span>
<span id="cb33-68"><a href="#cb33-68"></a>                <span class="cf">return</span> response</span>
<span id="cb33-69"><a href="#cb33-69"></a>                </span>
<span id="cb33-70"><a href="#cb33-70"></a>            <span class="cf">except</span> <span class="pp">Exception</span> <span class="im">as</span> e:</span>
<span id="cb33-71"><a href="#cb33-71"></a>                <span class="cf">if</span> attempt <span class="op">&lt;</span> <span class="va">self</span>.max_retries <span class="op">-</span> <span class="dv">1</span>:</span>
<span id="cb33-72"><a href="#cb33-72"></a>                    wait_time <span class="op">=</span> <span class="dv">2</span> <span class="op">**</span> attempt</span>
<span id="cb33-73"><a href="#cb33-73"></a>                    time.sleep(wait_time)</span>
<span id="cb33-74"><a href="#cb33-74"></a>                <span class="cf">else</span>:</span>
<span id="cb33-75"><a href="#cb33-75"></a>                    <span class="cf">raise</span></span>
<span id="cb33-76"><a href="#cb33-76"></a>    </span>
<span id="cb33-77"><a href="#cb33-77"></a>    <span class="kw">def</span> _call_openai(<span class="va">self</span>, prompt: <span class="bu">str</span>, system_message: Optional[<span class="bu">str</span>], temperature: <span class="bu">float</span>) <span class="op">-&gt;</span> <span class="bu">str</span>:</span>
<span id="cb33-78"><a href="#cb33-78"></a>        <span class="co">"""OpenAI API 호출"""</span></span>
<span id="cb33-79"><a href="#cb33-79"></a>        messages <span class="op">=</span> []</span>
<span id="cb33-80"><a href="#cb33-80"></a>        <span class="cf">if</span> system_message:</span>
<span id="cb33-81"><a href="#cb33-81"></a>            messages.append({<span class="st">"role"</span>: <span class="st">"system"</span>, <span class="st">"content"</span>: system_message})</span>
<span id="cb33-82"><a href="#cb33-82"></a>        messages.append({<span class="st">"role"</span>: <span class="st">"user"</span>, <span class="st">"content"</span>: prompt})</span>
<span id="cb33-83"><a href="#cb33-83"></a>        </span>
<span id="cb33-84"><a href="#cb33-84"></a>        response <span class="op">=</span> <span class="va">self</span>.client.chat.completions.create(</span>
<span id="cb33-85"><a href="#cb33-85"></a>            model<span class="op">=</span><span class="va">self</span>.model,</span>
<span id="cb33-86"><a href="#cb33-86"></a>            messages<span class="op">=</span>messages,</span>
<span id="cb33-87"><a href="#cb33-87"></a>            temperature<span class="op">=</span>temperature</span>
<span id="cb33-88"><a href="#cb33-88"></a>        )</span>
<span id="cb33-89"><a href="#cb33-89"></a>        </span>
<span id="cb33-90"><a href="#cb33-90"></a>        <span class="co"># 토큰 및 비용 추적</span></span>
<span id="cb33-91"><a href="#cb33-91"></a>        tokens <span class="op">=</span> response.usage.total_tokens</span>
<span id="cb33-92"><a href="#cb33-92"></a>        <span class="va">self</span>.total_tokens <span class="op">+=</span> tokens</span>
<span id="cb33-93"><a href="#cb33-93"></a>        <span class="va">self</span>.total_cost <span class="op">+=</span> tokens <span class="op">*</span> <span class="va">self</span>.cost_per_token</span>
<span id="cb33-94"><a href="#cb33-94"></a>        </span>
<span id="cb33-95"><a href="#cb33-95"></a>        <span class="cf">return</span> response.choices[<span class="dv">0</span>].message.content</span>
<span id="cb33-96"><a href="#cb33-96"></a>    </span>
<span id="cb33-97"><a href="#cb33-97"></a>    <span class="kw">def</span> get_stats(<span class="va">self</span>) <span class="op">-&gt;</span> Dict[<span class="bu">str</span>, Any]:</span>
<span id="cb33-98"><a href="#cb33-98"></a>        <span class="co">"""사용 통계"""</span></span>
<span id="cb33-99"><a href="#cb33-99"></a>        <span class="cf">return</span> {</span>
<span id="cb33-100"><a href="#cb33-100"></a>            <span class="st">'total_tokens'</span>: <span class="va">self</span>.total_tokens,</span>
<span id="cb33-101"><a href="#cb33-101"></a>            <span class="st">'total_cost'</span>: <span class="va">self</span>.total_cost,</span>
<span id="cb33-102"><a href="#cb33-102"></a>            <span class="st">'cache_size'</span>: <span class="bu">len</span>(<span class="va">self</span>._cache)</span>
<span id="cb33-103"><a href="#cb33-103"></a>        }</span></code><button title="클립보드 복사" class="code-copy-button"><i class="bi"></i></button></pre></div>
</section>
</section>
<section id="agents-모듈-도메인-agent" class="level2" data-number="6.7">
<h2 data-number="6.7" class="anchored" data-anchor-id="agents-모듈-도메인-agent"><span class="header-section-number">6.7</span> agents/ 모듈: 도메인 Agent</h2>
<p><strong>역할</strong>: 실제 비즈니스 로직 구현</p>
<div class="sourceCode" id="cb34"><pre class="sourceCode numberSource python number-lines code-with-copy"><code class="sourceCode python"><span id="cb34-1"><a href="#cb34-1"></a>agents<span class="op">/</span></span>
<span id="cb34-2"><a href="#cb34-2"></a>├── data_standardization<span class="op">/</span></span>
<span id="cb34-3"><a href="#cb34-3"></a>│   ├── <span class="fu">__init__</span>.py            <span class="co"># Agent 자동 등록</span></span>
<span id="cb34-4"><a href="#cb34-4"></a>│   ├── agent.py               <span class="co"># DataStandardizationAgent</span></span>
<span id="cb34-5"><a href="#cb34-5"></a>│   ├── manifest.yaml          <span class="co"># Agent 메타데이터</span></span>
<span id="cb34-6"><a href="#cb34-6"></a>│   ├── prompts<span class="op">/</span></span>
<span id="cb34-7"><a href="#cb34-7"></a>│   │   ├── system.txt</span>
<span id="cb34-8"><a href="#cb34-8"></a>│   │   └── user_template.txt</span>
<span id="cb34-9"><a href="#cb34-9"></a>│   └── tests<span class="op">/</span></span>
<span id="cb34-10"><a href="#cb34-10"></a>│       └── test_agent.py</span>
<span id="cb34-11"><a href="#cb34-11"></a>├── code_analysis<span class="op">/</span></span>
<span id="cb34-12"><a href="#cb34-12"></a>│   ├── <span class="fu">__init__</span>.py</span>
<span id="cb34-13"><a href="#cb34-13"></a>│   ├── agent.py</span>
<span id="cb34-14"><a href="#cb34-14"></a>│   ├── manifest.yaml</span>
<span id="cb34-15"><a href="#cb34-15"></a>│   ├── parsers<span class="op">/</span>               <span class="co"># Agent 전용 모듈</span></span>
<span id="cb34-16"><a href="#cb34-16"></a>│   │   ├── python_parser.py</span>
<span id="cb34-17"><a href="#cb34-17"></a>│   │   └── java_parser.py</span>
<span id="cb34-18"><a href="#cb34-18"></a>│   └── tests<span class="op">/</span></span>
<span id="cb34-19"><a href="#cb34-19"></a>└── knowledge_qna<span class="op">/</span></span>
<span id="cb34-20"><a href="#cb34-20"></a>    ├── <span class="fu">__init__</span>.py</span>
<span id="cb34-21"><a href="#cb34-21"></a>    ├── agent.py</span>
<span id="cb34-22"><a href="#cb34-22"></a>    ├── manifest.yaml</span>
<span id="cb34-23"><a href="#cb34-23"></a>    ├── rag_pipeline.py        <span class="co"># Agent 전용 RAG</span></span>
<span id="cb34-24"><a href="#cb34-24"></a>    └── tests<span class="op">/</span></span></code><button title="클립보드 복사" class="code-copy-button"><i class="bi"></i></button></pre></div>
<section id="agent-구현-예시" class="level3" data-number="6.7.1">
<h3 data-number="6.7.1" class="anchored" data-anchor-id="agent-구현-예시"><span class="header-section-number">6.7.1</span> Agent 구현 예시</h3>
<div class="sourceCode" id="cb35"><pre class="sourceCode numberSource python number-lines code-with-copy"><code class="sourceCode python"><span id="cb35-1"><a href="#cb35-1"></a><span class="co"># agents/data_standardization/agent.py</span></span>
<span id="cb35-2"><a href="#cb35-2"></a><span class="im">from</span> core.agent <span class="im">import</span> BaseAgent, AgentMetadata</span>
<span id="cb35-3"><a href="#cb35-3"></a><span class="im">from</span> shared.llm <span class="im">import</span> LLMClient</span>
<span id="cb35-4"><a href="#cb35-4"></a><span class="im">from</span> typing <span class="im">import</span> Dict, Any</span>
<span id="cb35-5"><a href="#cb35-5"></a></span>
<span id="cb35-6"><a href="#cb35-6"></a><span class="kw">class</span> DataStandardizationAgent(BaseAgent):</span>
<span id="cb35-7"><a href="#cb35-7"></a>    <span class="co">"""데이터 스키마 표준화 Agent"""</span></span>
<span id="cb35-8"><a href="#cb35-8"></a>    </span>
<span id="cb35-9"><a href="#cb35-9"></a>    <span class="kw">def</span> <span class="fu">__init__</span>(<span class="va">self</span>):</span>
<span id="cb35-10"><a href="#cb35-10"></a>        metadata <span class="op">=</span> AgentMetadata(</span>
<span id="cb35-11"><a href="#cb35-11"></a>            name<span class="op">=</span><span class="st">"data_standardization"</span>,</span>
<span id="cb35-12"><a href="#cb35-12"></a>            version<span class="op">=</span><span class="st">"1.0.0"</span>,</span>
<span id="cb35-13"><a href="#cb35-13"></a>            domain<span class="op">=</span><span class="st">"data"</span>,</span>
<span id="cb35-14"><a href="#cb35-14"></a>            description<span class="op">=</span><span class="st">"데이터 스키마 표준화"</span>,</span>
<span id="cb35-15"><a href="#cb35-15"></a>            author<span class="op">=</span><span class="st">"Platform Team"</span>,</span>
<span id="cb35-16"><a href="#cb35-16"></a>            created_at<span class="op">=</span><span class="st">"2026-01-28"</span></span>
<span id="cb35-17"><a href="#cb35-17"></a>        )</span>
<span id="cb35-18"><a href="#cb35-18"></a>        <span class="bu">super</span>().<span class="fu">__init__</span>(metadata)</span>
<span id="cb35-19"><a href="#cb35-19"></a>        </span>
<span id="cb35-20"><a href="#cb35-20"></a>        <span class="co"># Agent 전용 LLM 클라이언트</span></span>
<span id="cb35-21"><a href="#cb35-21"></a>        <span class="va">self</span>.llm <span class="op">=</span> LLMClient(provider<span class="op">=</span><span class="st">"openai"</span>, model<span class="op">=</span><span class="st">"gpt-4"</span>)</span>
<span id="cb35-22"><a href="#cb35-22"></a>    </span>
<span id="cb35-23"><a href="#cb35-23"></a>    <span class="kw">def</span> process(<span class="va">self</span>, <span class="bu">input</span>: Dict[<span class="bu">str</span>, Any]) <span class="op">-&gt;</span> Dict[<span class="bu">str</span>, Any]:</span>
<span id="cb35-24"><a href="#cb35-24"></a>        <span class="co">"""표준화 로직"""</span></span>
<span id="cb35-25"><a href="#cb35-25"></a>        schema <span class="op">=</span> <span class="bu">input</span>[<span class="st">'data'</span>]</span>
<span id="cb35-26"><a href="#cb35-26"></a>        </span>
<span id="cb35-27"><a href="#cb35-27"></a>        <span class="co"># LLM 호출</span></span>
<span id="cb35-28"><a href="#cb35-28"></a>        prompt <span class="op">=</span> <span class="ss">f"다음 스키마를 표준화하세요: </span><span class="sc">{</span>schema<span class="sc">}</span><span class="ss">"</span></span>
<span id="cb35-29"><a href="#cb35-29"></a>        standardized <span class="op">=</span> <span class="va">self</span>.llm.generate(prompt)</span>
<span id="cb35-30"><a href="#cb35-30"></a>        </span>
<span id="cb35-31"><a href="#cb35-31"></a>        <span class="cf">return</span> {</span>
<span id="cb35-32"><a href="#cb35-32"></a>            <span class="st">'result'</span>: standardized,</span>
<span id="cb35-33"><a href="#cb35-33"></a>            <span class="st">'confidence'</span>: <span class="fl">0.95</span></span>
<span id="cb35-34"><a href="#cb35-34"></a>        }</span>
<span id="cb35-35"><a href="#cb35-35"></a>    </span>
<span id="cb35-36"><a href="#cb35-36"></a>    <span class="kw">def</span> evaluate(<span class="va">self</span>, ground_truth: Any, prediction: Any) <span class="op">-&gt;</span> <span class="bu">float</span>:</span>
<span id="cb35-37"><a href="#cb35-37"></a>        <span class="co">"""정확도 평가"""</span></span>
<span id="cb35-38"><a href="#cb35-38"></a>        <span class="co"># 스키마 매칭 로직</span></span>
<span id="cb35-39"><a href="#cb35-39"></a>        <span class="cf">return</span> <span class="fl">0.9</span></span>
<span id="cb35-40"><a href="#cb35-40"></a></span>
<span id="cb35-41"><a href="#cb35-41"></a><span class="co"># agents/data_standardization/__init__.py</span></span>
<span id="cb35-42"><a href="#cb35-42"></a><span class="im">from</span> core.agent.registry <span class="im">import</span> AgentRegistry</span>
<span id="cb35-43"><a href="#cb35-43"></a><span class="im">from</span> .agent <span class="im">import</span> DataStandardizationAgent</span>
<span id="cb35-44"><a href="#cb35-44"></a></span>
<span id="cb35-45"><a href="#cb35-45"></a><span class="co"># Agent 자동 등록 (Dependency Inversion)</span></span>
<span id="cb35-46"><a href="#cb35-46"></a>agent <span class="op">=</span> DataStandardizationAgent()</span>
<span id="cb35-47"><a href="#cb35-47"></a>AgentRegistry.get_instance().register(agent)</span></code><button title="클립보드 복사" class="code-copy-button"><i class="bi"></i></button></pre></div>
</section>
<section id="agent-manifest" class="level3" data-number="6.7.2">
<h3 data-number="6.7.2" class="anchored" data-anchor-id="agent-manifest"><span class="header-section-number">6.7.2</span> Agent Manifest</h3>
<div class="sourceCode" id="cb36"><pre class="sourceCode numberSource yaml number-lines code-with-copy"><code class="sourceCode yaml"><span id="cb36-1"><a href="#cb36-1"></a><span class="co"># agents/data_standardization/manifest.yaml</span></span>
<span id="cb36-2"><a href="#cb36-2"></a><span class="fu">name</span><span class="kw">:</span><span class="at"> data_standardization_agent</span></span>
<span id="cb36-3"><a href="#cb36-3"></a><span class="fu">version</span><span class="kw">:</span><span class="at"> </span><span class="st">"1.0.0"</span></span>
<span id="cb36-4"><a href="#cb36-4"></a><span class="fu">domain</span><span class="kw">:</span><span class="at"> data_standardization</span></span>
<span id="cb36-5"><a href="#cb36-5"></a></span>
<span id="cb36-6"><a href="#cb36-6"></a><span class="fu">description</span><span class="kw">: </span><span class="ch">|</span></span>
<span id="cb36-7"><a href="#cb36-7"></a>  데이터 스키마를 표준화하여 일관된 형식으로 변환</span>
<span id="cb36-8"><a href="#cb36-8"></a></span>
<span id="cb36-9"><a href="#cb36-9"></a><span class="fu">inputs</span><span class="kw">:</span></span>
<span id="cb36-10"><a href="#cb36-10"></a><span class="at">  </span><span class="kw">-</span><span class="at"> </span><span class="fu">name</span><span class="kw">:</span><span class="at"> raw_schema</span></span>
<span id="cb36-11"><a href="#cb36-11"></a><span class="at">    </span><span class="fu">type</span><span class="kw">:</span><span class="at"> dict</span></span>
<span id="cb36-12"><a href="#cb36-12"></a><span class="at">    </span><span class="fu">required</span><span class="kw">:</span><span class="at"> </span><span class="ch">true</span></span>
<span id="cb36-13"><a href="#cb36-13"></a></span>
<span id="cb36-14"><a href="#cb36-14"></a><span class="fu">outputs</span><span class="kw">:</span></span>
<span id="cb36-15"><a href="#cb36-15"></a><span class="at">  </span><span class="kw">-</span><span class="at"> </span><span class="fu">name</span><span class="kw">:</span><span class="at"> standardized_schema</span></span>
<span id="cb36-16"><a href="#cb36-16"></a><span class="at">    </span><span class="fu">type</span><span class="kw">:</span><span class="at"> dict</span></span>
<span id="cb36-17"><a href="#cb36-17"></a></span>
<span id="cb36-18"><a href="#cb36-18"></a><span class="fu">dependencies</span><span class="kw">:</span></span>
<span id="cb36-19"><a href="#cb36-19"></a><span class="at">  </span><span class="kw">-</span><span class="at"> core.agent&gt;=1.0.0</span></span>
<span id="cb36-20"><a href="#cb36-20"></a><span class="at">  </span><span class="kw">-</span><span class="at"> shared.llm&gt;=1.0.0</span></span>
<span id="cb36-21"><a href="#cb36-21"></a><span class="at">  </span><span class="kw">-</span><span class="at"> shared.validation&gt;=1.0.0</span></span>
<span id="cb36-22"><a href="#cb36-22"></a></span>
<span id="cb36-23"><a href="#cb36-23"></a><span class="fu">resources</span><span class="kw">:</span></span>
<span id="cb36-24"><a href="#cb36-24"></a><span class="at">  </span><span class="fu">memory</span><span class="kw">:</span><span class="at"> 512MB</span></span>
<span id="cb36-25"><a href="#cb36-25"></a><span class="at">  </span><span class="fu">cpu</span><span class="kw">:</span><span class="at"> </span><span class="fl">0.5</span></span>
<span id="cb36-26"><a href="#cb36-26"></a></span>
<span id="cb36-27"><a href="#cb36-27"></a><span class="fu">monitoring</span><span class="kw">:</span></span>
<span id="cb36-28"><a href="#cb36-28"></a><span class="at">  </span><span class="fu">metrics</span><span class="kw">:</span></span>
<span id="cb36-29"><a href="#cb36-29"></a><span class="at">    </span><span class="kw">-</span><span class="at"> </span><span class="fu">name</span><span class="kw">:</span><span class="at"> accuracy</span></span>
<span id="cb36-30"><a href="#cb36-30"></a><span class="at">      </span><span class="fu">type</span><span class="kw">:</span><span class="at"> gauge</span></span>
<span id="cb36-31"><a href="#cb36-31"></a><span class="at">    </span><span class="kw">-</span><span class="at"> </span><span class="fu">name</span><span class="kw">:</span><span class="at"> processing_time</span></span>
<span id="cb36-32"><a href="#cb36-32"></a><span class="at">      </span><span class="fu">type</span><span class="kw">:</span><span class="at"> histogram</span></span></code><button title="클립보드 복사" class="code-copy-button"><i class="bi"></i></button></pre></div>


</section>
</section>
</section>

</main> <!-- /main -->
<script type="text/javascript">

// replace cmd keyboard shortcut w/ control on non-Mac platforms
const kPlatformMac = typeof navigator !== 'undefined' ? /Mac/.test(navigator.platform) : false;
if (!kPlatformMac) {
   var kbds = document.querySelectorAll("kbd")
   kbds.forEach(function(kbd) {
      kbd.innerHTML = kbd.innerHTML.replace(/⌘/g, '⌃');
   });
}

// tweak headings in pymd
document.querySelectorAll(".pymd span.co").forEach(el => {
   if (!el.innerText.startsWith("#|")) {
      el.style.fontWeight = 1000;
   }
});

</script>
<!-- Begin Mailchimp Signup Form -->
<div id="mc_embed_signup" style="padding-bottom: 1em; max-width: 400px;" class="ms-auto me-auto">
  <p style="font-weight: 600; margin-bottom: 0;">Subscribe</p>
  <span style="font-size: 0.9em;">Enjoy this blog? Get notified of new posts by email:</span>
<form action="https://quarto.us14.list-manage.com/subscribe/post?u=c79fb56a311ae347fbe916740&amp;id=ec05dfca03" method="post" id="mc-embedded-subscribe-form" name="mc-embedded-subscribe-form" class="validate" target="_blank" novalidate="">
    <div id="mc_embed_signup_scroll">
	
        <div class="input-group mt-1 mb-2">
        <input type="email" class="form-control" placeholder="Email Address" aria-label="Email Address" name="EMAIL" style="font-size: 0.8em; padding: .2em;">
        </div>              

	<div id="mce-responses" class="clear foot">
		<div class="response" id="mce-error-response" style="display:none"></div>
		<div class="response" id="mce-success-response" style="display:none"></div>
	</div>    <!-- real people should not fill this in and expect good things - do not remove this or risk form bot signups-->
    <div style="position: absolute; left: -5000px;" aria-hidden="true"><input type="text" name="b_c79fb56a311ae347fbe916740_ec05dfca03" tabindex="-1" value=""></div>
        <div class="optionalParent">
            <div class="clear foot" style="display: flex; align-items: center; justify-content: center;">
              
              
                <input type="submit" value="Subscribe" name="subscribe" style="min-width: 150px; font-size: 0.8em;" id="mc-embedded-subscribe" class="button btn btn-light btn-sm ms-auto me-auto">
            </div>
        </div>
    </div>
</form>
</div>

<!--End mc_embed_signup-->
<script id="quarto-html-after-body" type="application/javascript">
window.document.addEventListener("DOMContentLoaded", function (event) {
  const toggleBodyColorMode = (bsSheetEl) => {
    const mode = bsSheetEl.getAttribute("data-mode");
    const bodyEl = window.document.querySelector("body");
    if (mode === "dark") {
      bodyEl.classList.add("quarto-dark");
      bodyEl.classList.remove("quarto-light");
    } else {
      bodyEl.classList.add("quarto-light");
      bodyEl.classList.remove("quarto-dark");
    }
  }
  const toggleBodyColorPrimary = () => {
    const bsSheetEl = window.document.querySelector("link#quarto-bootstrap");
    if (bsSheetEl) {
      toggleBodyColorMode(bsSheetEl);
    }
  }
  toggleBodyColorPrimary();  
  const disableStylesheet = (stylesheets) => {
    for (let i=0; i < stylesheets.length; i++) {
      const stylesheet = stylesheets[i];
      stylesheet.rel = 'prefetch';
    }
  }
  const enableStylesheet = (stylesheets) => {
    for (let i=0; i < stylesheets.length; i++) {
      const stylesheet = stylesheets[i];
      stylesheet.rel = 'stylesheet';
    }
  }
  const manageTransitions = (selector, allowTransitions) => {
    const els = window.document.querySelectorAll(selector);
    for (let i=0; i < els.length; i++) {
      const el = els[i];
      if (allowTransitions) {
        el.classList.remove('notransition');
      } else {
        el.classList.add('notransition');
      }
    }
  }
  const toggleGiscusIfUsed = (isAlternate, darkModeDefault) => {
    const baseTheme = document.querySelector('#giscus-base-theme')?.value ?? 'light';
    const alternateTheme = document.querySelector('#giscus-alt-theme')?.value ?? 'dark';
    let newTheme = '';
    if(darkModeDefault) {
      newTheme = isAlternate ? baseTheme : alternateTheme;
    } else {
      newTheme = isAlternate ? alternateTheme : baseTheme;
    }
    const changeGiscusTheme = () => {
      // From: https://github.com/giscus/giscus/issues/336
      const sendMessage = (message) => {
        const iframe = document.querySelector('iframe.giscus-frame');
        if (!iframe) return;
        iframe.contentWindow.postMessage({ giscus: message }, 'https://giscus.app');
      }
      sendMessage({
        setConfig: {
          theme: newTheme
        }
      });
    }
    const isGiscussLoaded = window.document.querySelector('iframe.giscus-frame') !== null;
    if (isGiscussLoaded) {
      changeGiscusTheme();
    }
  }
  const toggleColorMode = (alternate) => {
    // Switch the stylesheets
    const alternateStylesheets = window.document.querySelectorAll('link.quarto-color-scheme.quarto-color-alternate');
    manageTransitions('#quarto-margin-sidebar .nav-link', false);
    if (alternate) {
      enableStylesheet(alternateStylesheets);
      for (const sheetNode of alternateStylesheets) {
        if (sheetNode.id === "quarto-bootstrap") {
          toggleBodyColorMode(sheetNode);
        }
      }
    } else {
      disableStylesheet(alternateStylesheets);
      toggleBodyColorPrimary();
    }
    manageTransitions('#quarto-margin-sidebar .nav-link', true);
    // Switch the toggles
    const toggles = window.document.querySelectorAll('.quarto-color-scheme-toggle');
    for (let i=0; i < toggles.length; i++) {
      const toggle = toggles[i];
      if (toggle) {
        if (alternate) {
          toggle.classList.add("alternate");     
        } else {
          toggle.classList.remove("alternate");
        }
      }
    }
    // Hack to workaround the fact that safari doesn't
    // properly recolor the scrollbar when toggling (#1455)
    if (navigator.userAgent.indexOf('Safari') > 0 && navigator.userAgent.indexOf('Chrome') == -1) {
      manageTransitions("body", false);
      window.scrollTo(0, 1);
      setTimeout(() => {
        window.scrollTo(0, 0);
        manageTransitions("body", true);
      }, 40);  
    }
  }
  const isFileUrl = () => { 
    return window.location.protocol === 'file:';
  }
  const hasAlternateSentinel = () => {  
    let styleSentinel = getColorSchemeSentinel();
    if (styleSentinel !== null) {
      return styleSentinel === "alternate";
    } else {
      return false;
    }
  }
  const setStyleSentinel = (alternate) => {
    const value = alternate ? "alternate" : "default";
    if (!isFileUrl()) {
      window.localStorage.setItem("quarto-color-scheme", value);
    } else {
      localAlternateSentinel = value;
    }
  }
  const getColorSchemeSentinel = () => {
    if (!isFileUrl()) {
      const storageValue = window.localStorage.getItem("quarto-color-scheme");
      return storageValue != null ? storageValue : localAlternateSentinel;
    } else {
      return localAlternateSentinel;
    }
  }
  const darkModeDefault = false;
  let localAlternateSentinel = darkModeDefault ? 'alternate' : 'default';
  // Dark / light mode switch
  window.quartoToggleColorScheme = () => {
    // Read the current dark / light value 
    let toAlternate = !hasAlternateSentinel();
    toggleColorMode(toAlternate);
    setStyleSentinel(toAlternate);
    toggleGiscusIfUsed(toAlternate, darkModeDefault);
  };
  // Ensure there is a toggle, if there isn't float one in the top right
  if (window.document.querySelector('.quarto-color-scheme-toggle') === null) {
    const a = window.document.createElement('a');
    a.classList.add('top-right');
    a.classList.add('quarto-color-scheme-toggle');
    a.href = "";
    a.onclick = function() { try { window.quartoToggleColorScheme(); } catch {} return false; };
    const i = window.document.createElement("i");
    i.classList.add('bi');
    a.appendChild(i);
    window.document.body.appendChild(a);
  }
  // Switch to dark mode if need be
  if (hasAlternateSentinel()) {
    toggleColorMode(true);
  } else {
    toggleColorMode(false);
  }
  const icon = "";
  const anchorJS = new window.AnchorJS();
  anchorJS.options = {
    placement: 'right',
    icon: icon
  };
  anchorJS.add('.anchored');
  const isCodeAnnotation = (el) => {
    for (const clz of el.classList) {
      if (clz.startsWith('code-annotation-')) {                     
        return true;
      }
    }
    return false;
  }
  const clipboard = new window.ClipboardJS('.code-copy-button', {
    text: function(trigger) {
      const codeEl = trigger.previousElementSibling.cloneNode(true);
      for (const childEl of codeEl.children) {
        if (isCodeAnnotation(childEl)) {
          childEl.remove();
        }
      }
      return codeEl.innerText;
    }
  });
  clipboard.on('success', function(e) {
    // button target
    const button = e.trigger;
    // don't keep focus
    button.blur();
    // flash "checked"
    button.classList.add('code-copy-button-checked');
    var currentTitle = button.getAttribute("title");
    button.setAttribute("title", "복사완료!");
    let tooltip;
    if (window.bootstrap) {
      button.setAttribute("data-bs-toggle", "tooltip");
      button.setAttribute("data-bs-placement", "left");
      button.setAttribute("data-bs-title", "복사완료!");
      tooltip = new bootstrap.Tooltip(button, 
        { trigger: "manual", 
          customClass: "code-copy-button-tooltip",
          offset: [0, -8]});
      tooltip.show();    
    }
    setTimeout(function() {
      if (tooltip) {
        tooltip.hide();
        button.removeAttribute("data-bs-title");
        button.removeAttribute("data-bs-toggle");
        button.removeAttribute("data-bs-placement");
      }
      button.setAttribute("title", currentTitle);
      button.classList.remove('code-copy-button-checked');
    }, 1000);
    // clear code selection
    e.clearSelection();
  });
  function tippyHover(el, contentFn, onTriggerFn, onUntriggerFn) {
    const config = {
      allowHTML: true,
      maxWidth: 500,
      delay: 100,
      arrow: false,
      appendTo: function(el) {
          return el.parentElement;
      },
      interactive: true,
      interactiveBorder: 10,
      theme: 'quarto',
      placement: 'bottom-start',
    };
    if (contentFn) {
      config.content = contentFn;
    }
    if (onTriggerFn) {
      config.onTrigger = onTriggerFn;
    }
    if (onUntriggerFn) {
      config.onUntrigger = onUntriggerFn;
    }
    window.tippy(el, config); 
  }
  const noterefs = window.document.querySelectorAll('a[role="doc-noteref"]');
  for (var i=0; i<noterefs.length; i++) {
    const ref = noterefs[i];
    tippyHover(ref, function() {
      // use id or data attribute instead here
      let href = ref.getAttribute('data-footnote-href') || ref.getAttribute('href');
      try { href = new URL(href).hash; } catch {}
      const id = href.replace(/^#\/?/, "");
      const note = window.document.getElementById(id);
      return note.innerHTML;
    });
  }
  const xrefs = window.document.querySelectorAll('a.quarto-xref');
  const processXRef = (id, note) => {
    // Strip column container classes
    const stripColumnClz = (el) => {
      el.classList.remove("page-full", "page-columns");
      if (el.children) {
        for (const child of el.children) {
          stripColumnClz(child);
        }
      }
    }
    stripColumnClz(note)
    if (id === null || id.startsWith('sec-')) {
      // Special case sections, only their first couple elements
      const container = document.createElement("div");
      if (note.children && note.children.length > 2) {
        container.appendChild(note.children[0].cloneNode(true));
        for (let i = 1; i < note.children.length; i++) {
          const child = note.children[i];
          if (child.tagName === "P" && child.innerText === "") {
            continue;
          } else {
            container.appendChild(child.cloneNode(true));
            break;
          }
        }
        if (window.Quarto?.typesetMath) {
          window.Quarto.typesetMath(container);
        }
        return container.innerHTML
      } else {
        if (window.Quarto?.typesetMath) {
          window.Quarto.typesetMath(note);
        }
        return note.innerHTML;
      }
    } else {
      // Remove any anchor links if they are present
      const anchorLink = note.querySelector('a.anchorjs-link');
      if (anchorLink) {
        anchorLink.remove();
      }
      if (window.Quarto?.typesetMath) {
        window.Quarto.typesetMath(note);
      }
      // TODO in 1.5, we should make sure this works without a callout special case
      if (note.classList.contains("callout")) {
        return note.outerHTML;
      } else {
        return note.innerHTML;
      }
    }
  }
  for (var i=0; i<xrefs.length; i++) {
    const xref = xrefs[i];
    tippyHover(xref, undefined, function(instance) {
      instance.disable();
      let url = xref.getAttribute('href');
      let hash = undefined; 
      if (url.startsWith('#')) {
        hash = url;
      } else {
        try { hash = new URL(url).hash; } catch {}
      }
      if (hash) {
        const id = hash.replace(/^#\/?/, "");
        const note = window.document.getElementById(id);
        if (note !== null) {
          try {
            const html = processXRef(id, note.cloneNode(true));
            instance.setContent(html);
          } finally {
            instance.enable();
            instance.show();
          }
        } else {
          // See if we can fetch this
          fetch(url.split('#')[0])
          .then(res => res.text())
          .then(html => {
            const parser = new DOMParser();
            const htmlDoc = parser.parseFromString(html, "text/html");
            const note = htmlDoc.getElementById(id);
            if (note !== null) {
              const html = processXRef(id, note);
              instance.setContent(html);
            } 
          }).finally(() => {
            instance.enable();
            instance.show();
          });
        }
      } else {
        // See if we can fetch a full url (with no hash to target)
        // This is a special case and we should probably do some content thinning / targeting
        fetch(url)
        .then(res => res.text())
        .then(html => {
          const parser = new DOMParser();
          const htmlDoc = parser.parseFromString(html, "text/html");
          const note = htmlDoc.querySelector('main.content');
          if (note !== null) {
            // This should only happen for chapter cross references
            // (since there is no id in the URL)
            // remove the first header
            if (note.children.length > 0 && note.children[0].tagName === "HEADER") {
              note.children[0].remove();
            }
            const html = processXRef(null, note);
            instance.setContent(html);
          } 
        }).finally(() => {
          instance.enable();
          instance.show();
        });
      }
    }, function(instance) {
    });
  }
      let selectedAnnoteEl;
      const selectorForAnnotation = ( cell, annotation) => {
        let cellAttr = 'data-code-cell="' + cell + '"';
        let lineAttr = 'data-code-annotation="' +  annotation + '"';
        const selector = 'span[' + cellAttr + '][' + lineAttr + ']';
        return selector;
      }
      const selectCodeLines = (annoteEl) => {
        const doc = window.document;
        const targetCell = annoteEl.getAttribute("data-target-cell");
        const targetAnnotation = annoteEl.getAttribute("data-target-annotation");
        const annoteSpan = window.document.querySelector(selectorForAnnotation(targetCell, targetAnnotation));
        const lines = annoteSpan.getAttribute("data-code-lines").split(",");
        const lineIds = lines.map((line) => {
          return targetCell + "-" + line;
        })
        let top = null;
        let height = null;
        let parent = null;
        if (lineIds.length > 0) {
            //compute the position of the single el (top and bottom and make a div)
            const el = window.document.getElementById(lineIds[0]);
            top = el.offsetTop;
            height = el.offsetHeight;
            parent = el.parentElement.parentElement;
          if (lineIds.length > 1) {
            const lastEl = window.document.getElementById(lineIds[lineIds.length - 1]);
            const bottom = lastEl.offsetTop + lastEl.offsetHeight;
            height = bottom - top;
          }
          if (top !== null && height !== null && parent !== null) {
            // cook up a div (if necessary) and position it 
            let div = window.document.getElementById("code-annotation-line-highlight");
            if (div === null) {
              div = window.document.createElement("div");
              div.setAttribute("id", "code-annotation-line-highlight");
              div.style.position = 'absolute';
              parent.appendChild(div);
            }
            div.style.top = top - 2 + "px";
            div.style.height = height + 4 + "px";
            div.style.left = 0;
            let gutterDiv = window.document.getElementById("code-annotation-line-highlight-gutter");
            if (gutterDiv === null) {
              gutterDiv = window.document.createElement("div");
              gutterDiv.setAttribute("id", "code-annotation-line-highlight-gutter");
              gutterDiv.style.position = 'absolute';
              const codeCell = window.document.getElementById(targetCell);
              const gutter = codeCell.querySelector('.code-annotation-gutter');
              gutter.appendChild(gutterDiv);
            }
            gutterDiv.style.top = top - 2 + "px";
            gutterDiv.style.height = height + 4 + "px";
          }
          selectedAnnoteEl = annoteEl;
        }
      };
      const unselectCodeLines = () => {
        const elementsIds = ["code-annotation-line-highlight", "code-annotation-line-highlight-gutter"];
        elementsIds.forEach((elId) => {
          const div = window.document.getElementById(elId);
          if (div) {
            div.remove();
          }
        });
        selectedAnnoteEl = undefined;
      };
        // Handle positioning of the toggle
    window.addEventListener(
      "resize",
      throttle(() => {
        elRect = undefined;
        if (selectedAnnoteEl) {
          selectCodeLines(selectedAnnoteEl);
        }
      }, 10)
    );
    function throttle(fn, ms) {
    let throttle = false;
    let timer;
      return (...args) => {
        if(!throttle) { // first call gets through
            fn.apply(this, args);
            throttle = true;
        } else { // all the others get throttled
            if(timer) clearTimeout(timer); // cancel #2
            timer = setTimeout(() => {
              fn.apply(this, args);
              timer = throttle = false;
            }, ms);
        }
      };
    }
      // Attach click handler to the DT
      const annoteDls = window.document.querySelectorAll('dt[data-target-cell]');
      for (const annoteDlNode of annoteDls) {
        annoteDlNode.addEventListener('click', (event) => {
          const clickedEl = event.target;
          if (clickedEl !== selectedAnnoteEl) {
            unselectCodeLines();
            const activeEl = window.document.querySelector('dt[data-target-cell].code-annotation-active');
            if (activeEl) {
              activeEl.classList.remove('code-annotation-active');
            }
            selectCodeLines(clickedEl);
            clickedEl.classList.add('code-annotation-active');
          } else {
            // Unselect the line
            unselectCodeLines();
            clickedEl.classList.remove('code-annotation-active');
          }
        });
      }
  const findCites = (el) => {
    const parentEl = el.parentElement;
    if (parentEl) {
      const cites = parentEl.dataset.cites;
      if (cites) {
        return {
          el,
          cites: cites.split(' ')
        };
      } else {
        return findCites(el.parentElement)
      }
    } else {
      return undefined;
    }
  };
  var bibliorefs = window.document.querySelectorAll('a[role="doc-biblioref"]');
  for (var i=0; i<bibliorefs.length; i++) {
    const ref = bibliorefs[i];
    const citeInfo = findCites(ref);
    if (citeInfo) {
      tippyHover(citeInfo.el, function() {
        var popup = window.document.createElement('div');
        citeInfo.cites.forEach(function(cite) {
          var citeDiv = window.document.createElement('div');
          citeDiv.classList.add('hanging-indent');
          citeDiv.classList.add('csl-entry');
          var biblioDiv = window.document.getElementById('ref-' + cite);
          if (biblioDiv) {
            citeDiv.innerHTML = biblioDiv.innerHTML;
          }
          popup.appendChild(citeDiv);
        });
        return popup.innerHTML;
      });
    }
  }
});
</script>
<script src="https://giscus.app/client.js" data-repo="kmink3225/blog" data-repo-id="R_kgDOLCZyDg" data-category="Blog" data-category-id="" data-mapping="title" data-reactions-enabled="1" data-emit-metadata="0" data-input-position="top" data-theme="light" data-lang="en" crossorigin="anonymous" async="">
</script>
<input type="hidden" id="giscus-base-theme" value="light">
<input type="hidden" id="giscus-alt-theme" value="dark">
</div> <!-- /content -->
<footer class="footer">
  <div class="nav-footer">
    <div class="nav-footer-left">
<p>© Kwangmin Kim</p>
</div>   
    <div class="nav-footer-center">
      <ul class="footer-items list-unstyled">
    <li class="nav-item">
    <a class="nav-link" href="../../../../../../../about.html">
<p>About</p>
</a>
  </li>  
</ul>
    </div>
    <div class="nav-footer-right">
      <ul class="footer-items list-unstyled">
    <li class="nav-item compact">
    <a class="nav-link" href="https://github.com/kmink3225/blog">
      <i class="bi bi-github" role="img">
</i> 
    </a>
  </li>  
</ul>
    </div>
  </div>
</footer>




</body></html>