{"title":"EDA","markdown":{"yaml":{"title":"EDA","subtitle":"Explorative Data Analysis","description":"EDA was conducted to explore and figure out the characteristics of data using some statistical methods","author":"Kwangmin Kim","date":"2023-02-18","execute":{"warning":false,"message":false,"freeze":true},"format":{"html":{"toc":true,"number-sections":true,"page-layout":"full","code-fold":true}}},"headingText":"the number of samples","containsRefs":false,"markdown":"\n\n\n```{r}\n#| echo: false\n\nrm(list=ls())\n\nif(grepl('kkm',getwd())){\n    datapath=\"C:/Users/kkm/Desktop/projects/website/docs/data/llfs_simulated_data.rds\"\n}else{\n    datapath=\"C:/Users/kmkim/Desktop/projects/website/docs/data/llfs_simulated_data.rds\"\n}\n\n```\n\n\n<ul class=\"nav nav-pills\" id=\"language-tab\" role=\"tablist\">\n\n<li class=\"nav-item\" role=\"presentation\">\n\n<button class=\"nav-link active\" id=\"Korean-tab\" data-bs-toggle=\"tab\" data-bs-target=\"#Korean\" type=\"button\" role=\"tab\" aria-controls=\"Korean\" aria-selected=\"true\">\n\nKorean\n\n</button>\n\n</li>\n\n<li class=\"nav-item\" role=\"presentation\">\n\n<button class=\"nav-link\" id=\"English-tab\" data-bs-toggle=\"tab\" data-bs-target=\"#English\" type=\"button\" role=\"tab\" aria-controls=\"knitr\" aria-selected=\"false\">\n\nEnglish\n\n</button>\n\n</li>\n\n<div class=\"tab-content\" id=\"language-tabcontent\">\n\n::: {#Korean .tab-pane .fade .show .active role=\"tabpanel\" aria-labelledby=\"Korean-tab\"}\n\n**(한글 준비중)**\n\nplease, read the English section first. \n\n\n```{r}\n#| echo: false\n\nif(!require(janitor)) install.packages(\"janitor\") \nif(!require(tidyverse)) install.packages(\"tidyverse\") \nif(!require(tidymodels)) install.packages(\"tidymodels\") \nif(!require(glmnet)) install.packages(\"glmnet\") \nif(!require(MASS)) install.packages(\"MASS\") \nif(!require(ggpubr)) install.packages(\"ggpubr\") \nif(!require(car)) install.packages(\"car\") \nif(!require(mixOmics)) install.packages(\"mixOmics\") \n\nlibrary(janitor)\nlibrary(tidyverse)\nlibrary(tidymodels)\nlibrary(glmnet)\nlibrary(MASS)\nlibrary(ggpubr) \nlibrary(car) \nlibrary(mixOmics)\nset.seed(20230103) \nknitr::opts_chunk$set(message=FALSE,warning=FALSE)\n```\n\n\n```{r}\n#| echo: false\nsample_size <- 500 #1000\n# the number of predictors\npredictor_size <- 1000 #5000\n# the number of groups\ngroup_size <- sample(6:10,1) # at least more than 6, the number of the genotypes\n# the number of predictors truly associated with a response variable\nsignificant_predictors <- floor(predictor_size*sample((50:100)/1000,1)) \n\n## set the predictors associated with an outcome\n### the number of predictors positively associated with an outcome\n### the number of predictors negatively associated with an outcome\npositively_associated_predictors<-floor(significant_predictors*0.4) \nnegatively_associated_predictors<-significant_predictors-positively_associated_predictors \n\n## set the proportion of the groups in which the predictors are correlated with one another\n### randomly sampling proportions to become their sum equal to 1\ngroup_proportion_list<-sample(seq(1,1+2*(100-group_size)/group_size,\n                            by=2*(100-group_size)/(group_size*(group_size-1)))/100,\n                        group_size,replace=FALSE)%>%round(3) \nnames(group_proportion_list)<-paste0(\"group\",1:length(group_proportion_list))\n### initialize a matrix with a size as sample_size by predictor_size\npredictor_matrix <- matrix(0, ncol = predictor_size, nrow = sample_size)\n### initialize a data frame and assign meta information used to generate simulated data\ngroup_meta_data<-\n    data.frame(\n        group_name=c(names(group_proportion_list)),\n        proportion=group_proportion_list)%>%\n        mutate(\n            group_n=(predictor_size*group_proportion_list)%>%round(0), # the number of predictors within each group \n            first_index=c(1,cumsum(group_n[-length(group_proportion_list)])+1), # the 1st index of predictors in each group\n            last_index=cumsum(group_n), # the last index of predictors in each group\n            group_correlation=sample((0:700)/1000,length(group_proportion_list),replace=TRUE), # within-group correlations among the within-group predictors\n            group_effect=sample((-40:30)/100,length(group_proportion_list),replace=TRUE)) # effect of each group on an outcome variable\n### set a group effect as 0.7 into a group with the smallest group number \ngroup_meta_data[which.min(group_meta_data[,\"group_n\"]),\"group_effect\"]<-0.7\n\n### set a group effect as -0.5 into a group with the second smallest group number \ngroup_meta_data[group_meta_data[,\"group_n\"]==(sort(group_meta_data[,\"group_n\"])[2]),\"group_effect\"]<-(-0.5)\n\n# initialize a data matrix to assign simulated values\n## add some noise to data\ndata<-matrix(rnorm(sample_size*predictor_size,mean=0,sd=0.05), \n             nrow = sample_size, ncol = predictor_size)\n\n# initialize a covariance matrix to assign simulated values\ncovariance_matrix<-matrix(rnorm(predictor_size*predictor_size,mean=0,sd=0.05),\n                          nrow=predictor_size, ncol=predictor_size)\nbeta_coefficients <- rnorm(predictor_size,0,0.05)\n\nanswer_list<-list(\n    'sample size'=sample_size,\n    'predictor size'=predictor_size,\n    'group size'=group_size,\n    'significant predictors'=significant_predictors,\n    'positively associated predictors'=positively_associated_predictors,\n    'negatively associated predictors'=negatively_associated_predictors,\n    'group proportion list'=group_proportion_list,\n    'group meta data'=group_meta_data,\n    'data noise intensity'=c('distribution'='rnorm','mean'=0,'sd'=0.05),\n    'covariance noise intensity'=c('distribution'='rnorm','mean'=0,'sd'=0.05),\n    'effect noise intensity on response'=c('distribution'='rnorm','mean'=0,'sd'=0.05),\n    'link function between the response and predictors' = 'canonical logit link function',\n    'link function noise intensity' = c('distribution'='rnorm','mean'=0,'sd'=0.05),\n    'age_distirbution'='used data of a variable with the highest effect on outcome',\n    'sex_distribution'='rbinom(n=sample size,p=0.5)',\n    'genotype_distirbution'=c('e2' = '8.4%','e3' = '77.9%','e4' = '13.7%'))\n```\n\n\n\n```{r}\n\n## Function List\n\ncolor_function<-function(category_number){\nreturn(\n    if(category_number==2){\n        c(\"darkblue\",\"darkred\")\n    }else if(category_number==3){\n        c(\"darkblue\",\"darkred\",\"yellow4\")\n    }else if(category_number==4){\n        c(\"darkblue\",\"darkred\",\"yellow4\",\"blueviolet\")\n    }else if(category_number==5){\n        c(\"darkblue\",\"darkred\",\"yellow4\",\"blueviolet\",\"darkorange\")\n    }else{\n        c(\"darkblue\",\"darkred\",\"yellow4\",\"blueviolet\",\"darkorange\",\"darkgreen\")\n    }\n    )\n}\n\nscale_function=function(vector=x,min=NULL,max=NULL,method){\n    scaling_methods<-c('min_max normalization','customized normalization','standardization')\n\n    if(method==\"min-max\"){\n        output=(vector-min(vector))/(max(vector)-min(vector))\n    }else if(method==\"customized\"){\n        output=(max-min)*(vector-min(vector))/(max(vector)-min(vector))+min\n    }else if(method==\"standarized\"){\n        output=(vector-mean(vector))/sd(vector)\n    }else{\n        output=paste0(\"Error!, no such a scaling method in this module. \\n Please, put the first word of each method you want to use in the 'method' argument among the following tests: \", paste(scaling_methods,collapse=\", \"))\n    }\n  return(output)\n}\n\nmultiple_shapiro_test<-function(in_data){\n        normality_test<-apply(in_data[,unlist(lapply(in_data, is.numeric))],2,\n                            function(x)shapiro.test(x))\n        temp<-data.frame(matrix(nrow=length(normality_test),ncol=4))\n        for (i in 1:length(normality_test)){\n            temp[i,]<-c(\n                coloumn_name=names(normality_test)[i],\n                statistic=normality_test[[i]]$statistic,\n                p_value=normality_test[[i]]$p.value,\n                method=normality_test[[i]]$method)\n        }\n        names(temp)<-c('column_name','statistic','p_value','method')\n        output<-temp%>%\n            mutate(p_adjusted=p.adjust(p_value,method=\"bonferroni\"),\n            type=ifelse(p_adjusted<0.05,'not_normal','normal'))%>%\n            dplyr::select('column_name','statistic','p_value','p_adjusted','type','method')\n        return(output)\n}    \n\nmultiple_levene_test<-function(in_data,categorical_variable){\n        homoscedasticity_test<-apply(in_data[,unlist(lapply(in_data, is.numeric))],2,\n                                    function(x)leveneTest(x~in_data[,categorical_variable]))\n        temp<-data.frame(matrix(nrow=length(homoscedasticity_test),ncol=6))\n            for (i in 1:length(homoscedasticity_test)){\n                temp[i,]<-c(\n                    coloumn_name=names(homoscedasticity_test)[i],\n                    group_df=homoscedasticity_test[[i]]$Df[1],\n                    residual_df=homoscedasticity_test[[i]]$Df[2],\n                    statistic=homoscedasticity_test[[i]]$`F value`[1],\n                    p_value=homoscedasticity_test[[i]]$`Pr(>F)`[1],\n                    method=\"levene's test\")\n            }\n            names(temp)<-c('column_name','group_df','residual_df','statistic','p_value','method')\n            output<-temp%>%\n                mutate(p_adjusted=p.adjust(p_value,method=\"bonferroni\"),\n                type=ifelse(p_adjusted<0.05,'heteroscedasticity','homoscedasticity'))%>%\n                dplyr::select('column_name','group_df','residual_df','statistic','p_value','p_adjusted','type','method')\n        return(output)} \n\nmultiple_unpaired_t_test<-function(in_data,categorical_variable,homo_variables,hetero_variables){\n    homo_unpaired_t_test<-apply(in_data[,unlist(lapply(in_data, is.numeric))][,homo_variables],2,\n                                    function(x)t.test(x~in_data[,categorical_variable],var.equal=TRUE))\n    hetero_unpaired_t_test<-apply(in_data[,unlist(lapply(in_data, is.numeric))][,hetero_variables],2,\n                                    function(x)t.test(x~in_data[,categorical_variable],var.equal=FALSE)) \n    unpaired_t_test<-c(homo_unpaired_t_test,hetero_unpaired_t_test)\n\n    temp<-data.frame(matrix(nrow=length(unpaired_t_test),ncol=7))\n        for (i in 1:length(unpaired_t_test)){\n            temp[i,]<-c(names(unpaired_t_test)[i], \n                        unpaired_t_test[[i]]$estimate,\n                        unpaired_t_test[[i]]$parameter,\n                        unpaired_t_test[[i]]$statistic,\n                        unpaired_t_test[[i]]$p.value,\n                        unpaired_t_test[[i]]$method)\n        }\n        names(temp)<-c('column_name',names(unpaired_t_test[[1]]$estimate),'df','statistic','p_value','method')\n        output<-temp%>%\n            mutate(p_adjusted=p.adjust(p_value,method=\"bonferroni\"),\n            type=ifelse(p_adjusted<0.05,'significant','insignificant'))%>%\n            dplyr::select('column_name',names(unpaired_t_test[[1]]$estimate),'df','statistic','p_value','p_adjusted','type','method')\n    return(output)} \n\n\nmultiple_correlation_test<-function(in_data,in_numeric_variable){\n    correlation_test<-apply(in_data[,unlist(lapply(in_data, is.numeric))],2,\n                                    function(x)cor.test(x,in_data[,in_numeric_variable],method='pearson'))\n    temp<-data.frame(matrix(nrow=length(correlation_test),ncol=6))\n        for (i in 1:length(correlation_test)){\n            temp[i,]<-c(names(correlation_test)[i], \n                        correlation_test[[i]]$estimate,\n                        correlation_test[[i]]$parameter,\n                        correlation_test[[i]]$statistic,\n                        correlation_test[[i]]$p.value,\n                        correlation_test[[i]]$method)\n        }\n        names(temp)<-c('column_name',names(correlation_test[[1]]$estimate),'df','statistic','p_value','method')\n        output<-temp%>%\n            mutate(p_adjusted=p.adjust(p_value,method=\"bonferroni\"),\n            type=ifelse(p_adjusted<0.05,'significant','insignificant'))%>%\n            dplyr::select('column_name',names(correlation_test[[1]]$estimate),'df','statistic','p_value','p_adjusted','type','method')\n    return(output)} \n\nmultiple_anova_test<-function(in_data, in_categorical_variable){\n    aov_test<-apply(in_data[,unlist(lapply(in_data, is.numeric))],2,\n                function(x)aov(x~get(in_categorical_variable),data=in_data)%>%summary)\n\n    temp<-data.frame(matrix(nrow=length(aov_test),ncol=10))\n    for (i in 1:length(aov_test)){\n        temp[i,]<-c(names(aov_test)[i], \n                    aov_test[[i]][[1]]$`Df`[1],\n                    aov_test[[i]][[1]]$`Df`[2],\n                    aov_test[[i]][[1]]$`Sum Sq`[1],\n                    aov_test[[i]][[1]]$`Sum Sq`[2],\n                    aov_test[[i]][[1]]$`Mean Sq`[1],\n                    aov_test[[i]][[1]]$`Mean Sq`[2],\n                    aov_test[[i]][[1]]$`F value`[1],\n                    aov_test[[i]][[1]]$`Pr(>F)`[1],\n                    'one_way_anova')\n    }\n    names(temp)<-c('column_name','group_df','residual_df','group_ssq','residual_ssq',\n                    'group_msq','residual_msq','F_value','p_value','method')\n    output<-temp%>%\n            mutate(p_adjusted=p.adjust(p_value,method=\"bonferroni\"),\n            type=ifelse(p_adjusted<0.05,'significant','insignificant'))%>%\n            dplyr::select('column_name','group_df','residual_df','group_ssq','residual_ssq',\n                    'group_msq','residual_msq','F_value','p_value','method',\n                    'p_adjusted','type','method')\n    return(output)} \n\nmain_statistical_test<-function(\n    in_data,method,categorical_variable,in_numeric_variable,\n    homo_variables=NULL,hetero_variables=NULL,\n    fun1=multiple_shapiro_test,\n    fun2=multiple_levene_test,\n    fun3=multiple_unpaired_t_test){\n    test_list<-c(\"shapiro wilks test\",\"levene's test\",\"student t test\",\"anova\",\"correlation test\")#,\"ANCOVA\",\"MANOVA\",\"wilcoxon manwhitney\",\"kruskal wallis test\",\"fisher exact test\",\"anderson darling\")\n    error_massage<-paste0(\"Error!, no such a test in this module. \\n Please, put the first word of each method you want to use in the 'method' argument among the following tests: \", paste(test_list,collapse=\", \"))\n    if(grepl('shapiro',method)){\n        output=multiple_shapiro_test(in_data)\n    }else if(grepl('levene',method)){\n        output=multiple_levene_test(in_data,categorical_variable)\n        # var.test()\n    }else if(grepl('student',method)){\n        # code unpaired vs paired t test in the future\n        output=multiple_unpaired_t_test(in_data,categorical_variable,homo_variables,hetero_variables)\n    }else if(grepl('kruskal',method)){\n        return(error_massage)\n    }else if(grepl('wilcoxon|manwhitney',method)){\n        return(error_massage)\n    }else if(grepl('anova|aov',method)){\n        output=multiple_anova_test(in_data,categorical_variable)\n    }else if(grepl('cor',method)){\n        output=multiple_correlation_test(in_data,in_numeric_variable)\n    }else{\n        return(error_massage)\n    }\n    return(output)\n}\n\n\ngetNumericSummaryTable=function(in_data,group_variable,summary_variable,set_color=color_function,...){\n    # table\n    temp<-in_data %>% \n    #group_by_at(vars(...)) %>% \n    group_by_at(vars(group_variable)) %>% \n    mutate(count=n())%>%\n    summarise_at(vars(summary_variable,count),\n                 list(mean=mean,\n                 sd=sd,\n                 min=min,\n                 Q1=~quantile(., probs = 0.25),\n                 median=median, \n                 Q3=~quantile(., probs = 0.75),\n                 max=max))%>%\n                 as.data.frame()%>%\n                 rename(\n                 n=count_mean)%>%\n                 dplyr::select(-contains('count'))%>%\n                 as.data.frame()\n    names(temp)<-c(\"group\",\n    sapply(names(temp)[-1],function(x)str_replace(x,paste0(summary_variable,\"_\"),\"\")))\n    output<-temp%>%\n    mutate(\n        variable=group_variable,\n        summary=summary_variable,\n        mean=mean%>%round(2),\n        sd=sd%>%round(2),\n        min=min%>%round(2),\n        Q1=Q1%>%round(2),\n        Q4=Q3%>%round(2),\n        max=max%>%round(2),\n        IQR_min=Q1-(Q3-Q1)*1.5%>%round(2),\n    IQR_max=Q3+(Q3-Q1)*1.5%>%round(2),\n    proportion=paste0(round(n/nrow(all_data)*100,2),\"%\"))%>%\n    dplyr::select(variable,group,summary,n,proportion,mean,sd,min,IQR_min,Q1,median,Q3,IQR_max,max)\n    return(output)\n}\n\ngetNumericSummaryPlot=function(\n    in_data=all_data,group_variable,summary_variable,\n    set_color=color_function,\n    summary_function=getNumericSummaryTable,...){\n    # plot\n    temp=getNumericSummaryTable(in_data,group_variable,summary_variable)\n    temp2=temp\n    names(temp2)[2]=group_variable\n    plot<-\n    in_data%>%\n    dplyr::select(group_variable,summary_variable)%>%\n    inner_join(.,temp2,by=group_variable)%>%\n    ggplot(aes(x=age,fill=get(group_variable),color=get(group_variable)))+\n    geom_histogram(aes(y=..density..),binwidth=1,alpha=0.5, position=\"identity\")+\n    geom_vline(aes(xintercept=mean,color=get(group_variable)), linetype=\"dashed\", size=1.5) + \n    geom_density(aes(y=..density..),alpha=0.3) +\n    scale_color_manual(values=set_color(nrow(temp2)))+\n    scale_fill_manual(values=set_color(nrow(temp2)))+\n    theme_bw()+\n    theme(legend.position = c(.95, .95),\n    legend.justification = c(\"right\", \"top\"),\n    legend.margin = margin(6, 6, 6, 6),\n    legend.text = element_text(size = 10))+\n    guides(fill=guide_legend(title=group_variable),\n    color=FALSE)+\n    geom_text(aes(label=round(mean,1),y=0,x=mean),\n                vjust=-1,col='yellow',size=5)+\n    ggtitle(paste0(\"Histogram & Density, \", summary_variable, \" Grouped by \", group_variable))+\n        labs(x=summary_variable, y = \"Density\")\n\n    result<-plot\n    return(result)\n}\n```\n\n\n```{r}\n# load simulation data\nsimulated_data<-read_rds(datapath)\n\n# simple data pre-processing\nall_data<-\n    simulated_data%>%\n    mutate(\n      outcome=factor(outcome,levels=c(\"negative\",\"positive\")),\n      sex=ifelse(sex==0,\"man\",\"woman\"),\n      sex=factor(sex,levels=c(\"man\",\"woman\")),\n      genotype=factor(genotype,levels=c(\"e3\",\"e2\",\"e4\"))\n      )\n\n# rename metabolite variables\nnames(all_data)[6:ncol(all_data)]<-paste0(\"meta\",1:predictor_size)\n \n\n```\n# Summary \n\n## Summary of Exploratory Data Analysis (EDA) \n\n# Supplements\n\n## EDA\n\n### Univariable Analysis\n\n#### Normality Test\n\n```{r}\n# raw data\nnormality_test_result<-multiple_shapiro_test(all_data)%>%\n    filter(column_name!='id')%>%\n    group_by(type)%>%\n    summarise(count=n())%>%\n    mutate(proportion=round(count/sum(count),3),\n    total=sum(count))%>%\n    dplyr::select(type,total,everything())\n    \nnormality_test_result%>%\n    knitr::kable(caption=\"Summary of the Result of Shapiro Wilk Tests on Numeric Variables\")\n\n```\n\nOut of `r normality_test_result[1,'total']` numeric variables, the variables following a normal distribution are `r normality_test_result[1,'count']` (`r normality_test_result[1,'proportion']*100`%) and the ones that do not are `r normality_test_result[2,'count']` (`r normality_test_result[2,'proportion']*100`%).\n\n#### 16 Variables That Follow Normal Distributions\n\n\n```{r}\n#| fig-width: 9\n#| fig-height: 10\n\n# 16 numeric variables randomly selected\nnormal_variables<-\n    multiple_shapiro_test(all_data)%>%\n        filter(p_value>0.05,column_name!='id')%>%\n            dplyr::select(column_name)%>%\n            pull%>%sample(16)\n\nnormal_data<-\n    all_data%>%\n        dplyr::select(outcome,normal_variables)%>%\n        gather(key=metabolite,value=value,normal_variables)\n\nnormal_data%>%\n    ggplot(aes(x=value))+\n    geom_histogram(aes(y=..density..))+\n    geom_density(color='red',linewidth=1.5)+\n    facet_wrap(.~metabolite)+\n    labs(title=\"Histogram, Numeric Variables Following Normal Distribution\")\n\nnormal_data%>%\n    ggplot(aes(x=metabolite,y=value))+\n    geom_boxplot()+\n    theme(axis.text.x = element_text(angle=90, vjust=.5, hjust=1))+\n    labs(title=\"Boxplot, Numeric Variables Following Normal Distribution\")\n\nnormal_data%>%\n    ggplot(aes(x=value,fill=outcome))+\n    geom_histogram(aes(y=..density..),alpha=0.5)+\n    geom_density(linewidth=1.5,alpha=0.5)+\n    scale_fill_manual(values=color_function(length(unique(normal_data$outcome))))+\n    facet_wrap(.~metabolite)+\n    labs(title=\"Histogram, Numeric Variables Following Normal Distribution Grouped by Disease Status\")    \nnormal_data%>%\n    ggplot(aes(x=metabolite,y=value,fill=outcome))+\n    geom_boxplot()+\n    scale_fill_manual(values=color_function(length(unique(normal_data$outcome))))+\n    theme(axis.text.x = element_text(angle=90, vjust=.5, hjust=1))+\n    labs(title=\"Boxplot, Numeric Variables Following Normal Distribution Grouped by Disease Status\")\n\n```\n\n#### Variables That Do Not Follow Normal Distributions\n\nThere is no variable that do not follow a normal distribution.\n\n### Bivariable Analysis\n\n#### AD vs Metabolites\n\nThrough the exploratory data analysis above, it was confirmed that all variables follow a normal distribution, and t tests were conducted to select metabolites that have significant relationships with the disease status, AD. To minimize type 1 error due to multiple testings, bonferroni correction was used in the EDA\n\n* Homoscedasticity Test\n\nLeven's test is performed to confirm that each variable has equality of variance, one of the assumptions of the t test and ANOVA.\n\n```{r}\n\nleven_test_result<-\n    main_statistical_test(in_data=all_data,method=\"levene\",categorical_variable=\"outcome\")%>%\n    filter(column_name!='id')\n\nhomo_variable<-leven_test_result%>%\nfilter(p_adjusted>0.05)%>%\ndplyr::select(column_name)%>%\npull()%>%\nunique()\n\nhetero_variable<-leven_test_result%>%\nfilter(p_adjusted<0.05)%>%\ndplyr::select(column_name)%>%\npull()%>%\nunique()\n\n```\n\n*  10 variables randomly selected out of `r length(homo_variable)` variables with equal variance: `r homo_variable%>%sample(10)`\n* `r length(hetero_variable)` variables randomly selected with equal variance: `r hetero_variable`\n\n```{r}\n\nhomo_variable_sample<-homo_variable%>%sample(10)\nhetero_variable_sample<-hetero_variable\n\nstratified_levene_data<-all_data%>%\n    dplyr::select(outcome,homo_variable_sample,hetero_variable_sample)%>%\n    gather(key=metabolite,value=value,c(homo_variable_sample,hetero_variable_sample))%>%\n    mutate(levene_test=ifelse(metabolite%in%(homo_variable_sample),\"homoscedasticity\",\"heteroscedasticity\"))\n\nstratified_levene_data%>%\n    ggplot(aes(x=metabolite,y=value,fill=outcome))+\n    geom_boxplot()+\n    scale_fill_manual(values=color_function(length(unique(stratified_levene_data$outcome))))+\n    theme(axis.text.x = element_text(angle=90, vjust=.5, hjust=1))+\n    facet_wrap(.~levene_test)+\n    labs(title=\"Boxplot, Metabolites with Heteroscedasticity vs Homoscedasticity\")\n\n```\n\n* Unpaired Two Sample Mean t Test\n\n```{r}\nt_test_result<-\n    main_statistical_test(in_data=all_data,method=\"student\",\n                        categorical_variable=\"outcome\",\n                        homo_variables=homo_variable,\n                        hetero_variables=hetero_variable)\n\nmetabolites_associated_AD<-\n    t_test_result%>%\n    filter(type==\"significant\"&column_name!='age')%>%\n    arrange(p_adjusted)%>%\n    dplyr::select(column_name)%>%pull\n\nmetabolites_associated_AD_data<-\n    all_data%>%\n    dplyr::select(outcome,sex,genotype,metabolites_associated_AD)%>%\n    gather(key=metabolite,value=value,metabolites_associated_AD)        \n\nmetabolites_associated_AD_data%>%\n    group_by(outcome)%>%\n    summarise(mean=mean(value),sd=sd(value))%>%\n    knitr::kable()\n\ntop_metabolites_associated_AD<-t_test_result%>%\n    filter(type==\"significant\"&column_name!='age')%>%\n    arrange(p_adjusted)%>%head(10)%>%\n    dplyr::select(column_name)%>%pull\n\ntop_metabolites_associated_AD_data<-\n    all_data%>%\n    dplyr::select(outcome,top_metabolites_associated_AD)%>%\n    gather(key=metabolite,value=value,top_metabolites_associated_AD)        \n\nbottom_metabolites_associated_AD<-t_test_result%>%\n    filter(type==\"significant\"&column_name!='age')%>%\n    arrange(p_adjusted)%>%tail(10)%>%\n    dplyr::select(column_name)%>%pull\n\nbottom_metabolites_associated_AD_data<-\n    all_data%>%\n    dplyr::select(outcome,bottom_metabolites_associated_AD)%>%\n    gather(key=metabolite,value=value,bottom_metabolites_associated_AD)        \n\na1<-top_metabolites_associated_AD_data%>%\n    ggplot(aes(x=metabolite,y=value,fill=outcome))+\n    geom_boxplot()+\n    scale_fill_manual(values=color_function(length(unique(top_metabolites_associated_AD_data$outcome))))+\n    theme(axis.text.x = element_text(angle=90, vjust=.5, hjust=1), legend.position=\"top\")+\n    labs(title=\"Boxplot, Metabolites Strongly Associated with AD\")\n\na2<-bottom_metabolites_associated_AD_data%>%\n    ggplot(aes(x=metabolite,y=value,fill=outcome))+\n    geom_boxplot()+\n    scale_fill_manual(values=color_function(length(unique(bottom_metabolites_associated_AD_data$outcome))))+\n    theme(axis.text.x = element_text(angle=90, vjust=.5, hjust=1), legend.position=\"top\")+\n    labs(title=\"Boxplot, Metabolites Weakly Associated with AD\")\n\nggarrange(a1, a2, ncol=2, nrow=1)\n\nsignificant_metabolites<-\n    t_test_result%>%\n    filter(type==\"significant\"&column_name!='age')%>%\n    dplyr::select(column_name)%>%pull\n```\n\nAs a result of the t tests, there are `r length(significant_metabolites)` metabolites that are significantly associated with AD status at the 5% significance level. Metabolites with the highest significance were designated as *strong metabolites* and metabolites with the lowest significance among metabolites significantly related to AD status were designated as *weak metabolites*, and the expression level of metabolites between the disease status was confirmed through visualization. As a result, a greater difference was observed in strong metabolites than in weak metabolites, but both groups were not clearly separated in terms of AD status. \n\n#### AD vs Sex\n\n```{r}\nad_sex_summary<-all_data%>%\n    group_by(outcome,sex)%>%\n    summarise(count=n(),\n            mean_age=mean(age),\n            sd_age=sd(age))%>%\n            ungroup%>%\n    mutate(sum=sum(count),\n    proportion=paste0(count/sum*100,\"%\"))%>%\n    dplyr::select(outcome, sex,count,proportion,mean_age,sd_age)%>%\n    mutate(p_value=chisq.test(all_data$outcome,all_data$sex)$p.value,\n    method=\"chisquare_test\")\n\nad_sex_summary%>%knitr::kable()\n```\n\n#### AD vs Genotype\n\n```{r}\nad_genotype_summary<-all_data%>%\n    group_by(outcome,genotype)%>%\n    summarise(count=n(),\n            mean_age=mean(age),\n            sd_age=sd(age))%>%\n            ungroup%>%\n    mutate(sum=sum(count),\n    proportion=paste0(count/sum*100,\"%\"))%>%\n    dplyr::select(outcome, genotype,count,proportion,mean_age,sd_age)%>%\n    mutate(p_value=chisq.test(all_data$outcome,all_data$genotype)$p.value,\n    method=\"chisquare_test\")\n\ngenotype_ad_summary<-all_data%>%\n    group_by(genotype,outcome)%>%\n    summarise(count=n(),\n            mean_age=mean(age),\n            sd_age=sd(age))%>%\n            ungroup%>%\n    mutate(sum=sum(count),\n    proportion=paste0(count/sum*100,\"%\"))%>%\n    dplyr::select(genotype,outcome,count,proportion,mean_age,sd_age)%>%\n    mutate(p_value=chisq.test(all_data$outcome,all_data$genotype)$p.value,\n    method=\"chisquare_test\") \n\nad_genotype_summary%>%knitr::kable()\ngenotype_ad_summary%>%knitr::kable()\n```\n\nAs you see the tables above, the count of AD status and that of genotype status are proportionately the same. Thus, there is no relation between AD and genotype in this data at the significant level 5%.\n\n#### Age vs AD, Sex, Genotype\n\nAge is known as a strong risk factor of AD or dementia. Human nerve system gets damaged as people are aged and the nerve fibrosis symptoms progress gradually. For this reason, we need to look into how the sample data are distributed in terms of age.\n\n```{r}\nad_age_summary=getNumericSummaryTable(in_data=all_data,group_variable=\"outcome\",summary_variable=\"age\")\nsex_age_summary=getNumericSummaryTable(in_data=all_data,group_variable=\"sex\",summary_variable=\"age\")\ngenotype_age_summary=getNumericSummaryTable(in_data=all_data,group_variable=\"genotype\",summary_variable=\"age\")\nage_summary=rbind(\n    ad_age_summary,\n    sex_age_summary,\n    genotype_age_summary)\n```\n\n```{r}\nage_summary%>%knitr::kable()\n```\n\n```{r}\n#| fig-width: 8\n#| fig-height: 10\n\nplot<- ggarrange(\n    getNumericSummaryPlot(in_data=all_data,group_variable=\"outcome\",summary_variable=\"age\"),\n    getNumericSummaryPlot(in_data=all_data,group_variable=\"sex\",summary_variable=\"age\"),\n    getNumericSummaryPlot(in_data=all_data,group_variable=\"genotype\",summary_variable=\"age\"),\n    ncol=2, nrow=2,legend=\"bottom\")\nplot\n```\n\nThe table above shows the summary statistics of age grouped by the affected status, AD and non AD. The difference of age between the two groups are about `r round(age_summary%>%filter(group==\"positive\")%>%dplyr::select(mean)- age_summary%>%filter(group==\"negative\")%>%dplyr::select(mean),2)`, but their standard deviations are `r round(age_summary%>%filter(group==\"positive\")%>%dplyr::select(sd),2)` and `r round(age_summary%>%filter(group==\"negative\")%>%dplyr::select(sd),2)`. Thus, it is hard to say their age in average differ in the affected status because the age variations of the two groups are overlapped. This research has two conflicting characteristics at the population level. \n\nThe glaring difference of age is also shown below. As you can see, the people with a negative status `r (ad_age_summary[1,'mean'] - ad_age_summary[2,'mean'])%>%round(3)` years younger than those with a positive one.\n\n\n```{r}\na1<-all_data%>%\n    dplyr::select(outcome,age)%>%\n    ggplot(aes(x=age,fill=outcome))+\n    geom_histogram(aes(y=..density..),alpha=0.5)+\n    geom_density(linewidth=1.5,alpha=0.5)+\n    scale_fill_manual(values=color_function(length(unique(all_data$outcome))))+\n    theme(legend.position=\"top\")+\n    labs(title=\"Histogram, Age Distribution Grouped by Disease Status\")   \na2<-all_data%>%\n    dplyr::select(outcome,age)%>%\n    ggplot(aes(x=outcome,y=age,fill=outcome))+\n    geom_boxplot()+\n    scale_fill_manual(values=color_function(length(unique(all_data$outcome))))+\n    theme(axis.text.x = element_text(angle=90, vjust=.5, hjust=1), legend.position=\"top\")+\n    labs(title=\"Boxplot, Age Distribution Grouped by Disease Status\")\n\nggarrange(a1, a2, ncol=2, nrow=1)\n```\n\n#### Age vs Metabolites\n\n```{r}\nage_correlation_data<-\n    main_statistical_test(in_data=all_data,in_numeric_variable = 'age',method = \"cor\")%>%\n    filter(p_adjusted<0.05,column_name!='id')\n```\n\n`r nrow(age_correlation_data)` metabolites are significantly associated with age.\n\n\n#### Genotype vs Metabolites\n\n```{r}\ngenotype_aov<-main_statistical_test(in_data=all_data,categorical_variable=\"genotype\",method='aov')\ngenotype_aov%>%\nfilter(column_name!='id',p_adjusted<0.05)%>%knitr::kable()\n\n```\n\n`r genotype_aov%>%filter(column_name!='id',p_adjusted<0.05)%>%nrow()` metabolites are significantly associated with the genotype variable.\n\n### Multivariable Analysis\n\n#### AD vs Sex vs Genotype vs Age\n\n```{r}\nall_data%>%\n    group_by(outcome,sex,genotype)%>%\n    summarise(count=n(),\n    mean_age=mean(age),\n    sd_age=sd(age))%>%ungroup%>%\n    mutate(sum_count=sum(count),\n    proportion=paste0(round(count/sum_count*100,3),'%'))%>%\n    dplyr::select(outcome,sex,genotype,count,proportion, mean_age,sd_age)%>%\n    knitr::kable()\n\n```\n\nExcept for the disease status variable, it looks like there is no difference of age in average and count in the other categorical variables. Taking into account age varialble is significantly associated with the metabolites that are significantly associated with the disease status, outcome (or AD). There is no need to conduct futher exploratory data analysis in the multivariable analysis senction.\n\n\n:::\n\n::: {#English .tab-pane .fade role=\"tabpanel\" aria-labelledby=\"English-tab\"}\nplease, read the English section first. \n\n\n```{r}\n#| echo: false\n\nif(!require(janitor)) install.packages(\"janitor\") \nif(!require(tidyverse)) install.packages(\"tidyverse\") \nif(!require(tidymodels)) install.packages(\"tidymodels\") \nif(!require(glmnet)) install.packages(\"glmnet\") \nif(!require(MASS)) install.packages(\"MASS\") \nif(!require(ggpubr)) install.packages(\"ggpubr\") \nif(!require(car)) install.packages(\"car\") \nif(!require(mixOmics)) install.packages(\"mixOmics\") \n\nlibrary(janitor)\nlibrary(tidyverse)\nlibrary(tidymodels)\nlibrary(glmnet)\nlibrary(MASS)\nlibrary(ggpubr) \nlibrary(car) \nlibrary(mixOmics)\nset.seed(20230103) \nknitr::opts_chunk$set(message=FALSE,warning=FALSE)\n```\n\n\n```{r}\n#| echo: false\n# the number of samples\nsample_size <- 500 #1000\n# the number of predictors\npredictor_size <- 1000 #5000\n# the number of groups\ngroup_size <- sample(6:10,1) # at least more than 6, the number of the genotypes\n# the number of predictors truly associated with a response variable\nsignificant_predictors <- floor(predictor_size*sample((50:100)/1000,1)) \n\n## set the predictors associated with an outcome\n### the number of predictors positively associated with an outcome\n### the number of predictors negatively associated with an outcome\npositively_associated_predictors<-floor(significant_predictors*0.4) \nnegatively_associated_predictors<-significant_predictors-positively_associated_predictors \n\n## set the proportion of the groups in which the predictors are correlated with one another\n### randomly sampling proportions to become their sum equal to 1\ngroup_proportion_list<-sample(seq(1,1+2*(100-group_size)/group_size,\n                            by=2*(100-group_size)/(group_size*(group_size-1)))/100,\n                        group_size,replace=FALSE)%>%round(3) \nnames(group_proportion_list)<-paste0(\"group\",1:length(group_proportion_list))\n### initialize a matrix with a size as sample_size by predictor_size\npredictor_matrix <- matrix(0, ncol = predictor_size, nrow = sample_size)\n### initialize a data frame and assign meta information used to generate simulated data\ngroup_meta_data<-\n    data.frame(\n        group_name=c(names(group_proportion_list)),\n        proportion=group_proportion_list)%>%\n        mutate(\n            group_n=(predictor_size*group_proportion_list)%>%round(0), # the number of predictors within each group \n            first_index=c(1,cumsum(group_n[-length(group_proportion_list)])+1), # the 1st index of predictors in each group\n            last_index=cumsum(group_n), # the last index of predictors in each group\n            group_correlation=sample((0:700)/1000,length(group_proportion_list),replace=TRUE), # within-group correlations among the within-group predictors\n            group_effect=sample((-40:30)/100,length(group_proportion_list),replace=TRUE)) # effect of each group on an outcome variable\n### set a group effect as 0.7 into a group with the smallest group number \ngroup_meta_data[which.min(group_meta_data[,\"group_n\"]),\"group_effect\"]<-0.7\n\n### set a group effect as -0.5 into a group with the second smallest group number \ngroup_meta_data[group_meta_data[,\"group_n\"]==(sort(group_meta_data[,\"group_n\"])[2]),\"group_effect\"]<-(-0.5)\n\n# initialize a data matrix to assign simulated values\n## add some noise to data\ndata<-matrix(rnorm(sample_size*predictor_size,mean=0,sd=0.05), \n             nrow = sample_size, ncol = predictor_size)\n\n# initialize a covariance matrix to assign simulated values\ncovariance_matrix<-matrix(rnorm(predictor_size*predictor_size,mean=0,sd=0.05),\n                          nrow=predictor_size, ncol=predictor_size)\nbeta_coefficients <- rnorm(predictor_size,0,0.05)\n\nanswer_list<-list(\n    'sample size'=sample_size,\n    'predictor size'=predictor_size,\n    'group size'=group_size,\n    'significant predictors'=significant_predictors,\n    'positively associated predictors'=positively_associated_predictors,\n    'negatively associated predictors'=negatively_associated_predictors,\n    'group proportion list'=group_proportion_list,\n    'group meta data'=group_meta_data,\n    'data noise intensity'=c('distribution'='rnorm','mean'=0,'sd'=0.05),\n    'covariance noise intensity'=c('distribution'='rnorm','mean'=0,'sd'=0.05),\n    'effect noise intensity on response'=c('distribution'='rnorm','mean'=0,'sd'=0.05),\n    'link function between the response and predictors' = 'canonical logit link function',\n    'link function noise intensity' = c('distribution'='rnorm','mean'=0,'sd'=0.05),\n    'age_distirbution'='used data of a variable with the highest effect on outcome',\n    'sex_distribution'='rbinom(n=sample size,p=0.5)',\n    'genotype_distirbution'=c('e2' = '8.4%','e3' = '77.9%','e4' = '13.7%'))\n```\n\n\n\n```{r}\n\n## Function List\n\ncolor_function<-function(category_number){\nreturn(\n    if(category_number==2){\n        c(\"darkblue\",\"darkred\")\n    }else if(category_number==3){\n        c(\"darkblue\",\"darkred\",\"yellow4\")\n    }else if(category_number==4){\n        c(\"darkblue\",\"darkred\",\"yellow4\",\"blueviolet\")\n    }else if(category_number==5){\n        c(\"darkblue\",\"darkred\",\"yellow4\",\"blueviolet\",\"darkorange\")\n    }else{\n        c(\"darkblue\",\"darkred\",\"yellow4\",\"blueviolet\",\"darkorange\",\"darkgreen\")\n    }\n    )\n}\n\nscale_function=function(vector=x,min=NULL,max=NULL,method){\n    scaling_methods<-c('min_max normalization','customized normalization','standardization')\n\n    if(method==\"min-max\"){\n        output=(vector-min(vector))(max(vector)-min(vector))\n    }else if(method==\"customized\"){\n        output=(max-min)*(vector-min(vector))/(max(vector)-min(vector))+min\n    }else if(method==\"standarized\"){\n        output=(vector-mean(vector))/sd(vector)\n    }else{\n        output=paste0(\"Error!, no such a scaling method in this module. \\n Please, put the first word of each method you want to use in the 'method' argument among the following tests: \", paste(scaling_methods,collapse=\", \"))\n    }\n  return(output)\n}\n\nmultiple_shapiro_test<-function(in_data){\n        normality_test<-apply(in_data[,unlist(lapply(in_data, is.numeric))],2,\n                            function(x)shapiro.test(x))\n        temp<-data.frame(matrix(nrow=length(normality_test),ncol=4))\n        for (i in 1:length(normality_test)){\n            temp[i,]<-c(\n                coloumn_name=names(normality_test)[i],\n                statistic=normality_test[[i]]$statistic,\n                p_value=normality_test[[i]]$p.value,\n                method=normality_test[[i]]$method)\n        }\n        names(temp)<-c('column_name','statistic','p_value','method')\n        output<-temp%>%\n            mutate(p_adjusted=p.adjust(p_value,method=\"bonferroni\"),\n            type=ifelse(p_adjusted<0.05,'not_normal','normal'))%>%\n            dplyr::select('column_name','statistic','p_value','p_adjusted','type','method')\n        return(output)\n}    \n\nmultiple_levene_test<-function(in_data,categorical_variable){\n        homoscedasticity_test<-apply(in_data[,unlist(lapply(in_data, is.numeric))],2,\n                                    function(x)leveneTest(x~in_data[,categorical_variable]))\n        temp<-data.frame(matrix(nrow=length(homoscedasticity_test),ncol=6))\n            for (i in 1:length(homoscedasticity_test)){\n                temp[i,]<-c(\n                    coloumn_name=names(homoscedasticity_test)[i],\n                    group_df=homoscedasticity_test[[i]]$Df[1],\n                    residual_df=homoscedasticity_test[[i]]$Df[2],\n                    statistic=homoscedasticity_test[[i]]$`F value`[1],\n                    p_value=homoscedasticity_test[[i]]$`Pr(>F)`[1],\n                    method=\"levene's test\")\n            }\n            names(temp)<-c('column_name','group_df','residual_df','statistic','p_value','method')\n            output<-temp%>%\n                mutate(p_adjusted=p.adjust(p_value,method=\"bonferroni\"),\n                type=ifelse(p_adjusted<0.05,'heteroscedasticity','homoscedasticity'))%>%\n                dplyr::select('column_name','group_df','residual_df','statistic','p_value','p_adjusted','type','method')\n        return(output)} \n\nmultiple_unpaired_t_test<-function(in_data,categorical_variable,homo_variables,hetero_variables){\n    homo_unpaired_t_test<-apply(in_data[,unlist(lapply(in_data, is.numeric))][,homo_variables],2,\n                                    function(x)t.test(x~in_data[,categorical_variable],var.equal=TRUE))\n    hetero_unpaired_t_test<-apply(in_data[,unlist(lapply(in_data, is.numeric))][,hetero_variables],2,\n                                    function(x)t.test(x~in_data[,categorical_variable],var.equal=FALSE)) \n    unpaired_t_test<-c(homo_unpaired_t_test,hetero_unpaired_t_test)\n\n    temp<-data.frame(matrix(nrow=length(unpaired_t_test),ncol=7))\n        for (i in 1:length(unpaired_t_test)){\n            temp[i,]<-c(names(unpaired_t_test)[i], \n                        unpaired_t_test[[i]]$estimate,\n                        unpaired_t_test[[i]]$parameter,\n                        unpaired_t_test[[i]]$statistic,\n                        unpaired_t_test[[i]]$p.value,\n                        unpaired_t_test[[i]]$method)\n        }\n        names(temp)<-c('column_name',names(unpaired_t_test[[1]]$estimate),'df','statistic','p_value','method')\n        output<-temp%>%\n            mutate(p_adjusted=p.adjust(p_value,method=\"bonferroni\"),\n            type=ifelse(p_adjusted<0.05,'significant','insignificant'))%>%\n            dplyr::select('column_name',names(unpaired_t_test[[1]]$estimate),'df','statistic','p_value','p_adjusted','type','method')\n    return(output)} \n\n\nmultiple_correlation_test<-function(in_data,in_numeric_variable){\n    correlation_test<-apply(in_data[,unlist(lapply(in_data, is.numeric))],2,\n                                    function(x)cor.test(x,in_data[,in_numeric_variable],method='pearson'))\n    temp<-data.frame(matrix(nrow=length(correlation_test),ncol=6))\n        for (i in 1:length(correlation_test)){\n            temp[i,]<-c(names(correlation_test)[i], \n                        correlation_test[[i]]$estimate,\n                        correlation_test[[i]]$parameter,\n                        correlation_test[[i]]$statistic,\n                        correlation_test[[i]]$p.value,\n                        correlation_test[[i]]$method)\n        }\n        names(temp)<-c('column_name',names(correlation_test[[1]]$estimate),'df','statistic','p_value','method')\n        output<-temp%>%\n            mutate(p_adjusted=p.adjust(p_value,method=\"bonferroni\"),\n            type=ifelse(p_adjusted<0.05,'significant','insignificant'))%>%\n            dplyr::select('column_name',names(correlation_test[[1]]$estimate),'df','statistic','p_value','p_adjusted','type','method')\n    return(output)} \n\nmultiple_anova_test<-function(in_data, in_categorical_variable){\n    aov_test<-apply(in_data[,unlist(lapply(in_data, is.numeric))],2,\n                function(x)aov(x~get(in_categorical_variable),data=in_data)%>%summary)\n\n    temp<-data.frame(matrix(nrow=length(aov_test),ncol=10))\n    for (i in 1:length(aov_test)){\n        temp[i,]<-c(names(aov_test)[i], \n                    aov_test[[i]][[1]]$`Df`[1],\n                    aov_test[[i]][[1]]$`Df`[2],\n                    aov_test[[i]][[1]]$`Sum Sq`[1],\n                    aov_test[[i]][[1]]$`Sum Sq`[2],\n                    aov_test[[i]][[1]]$`Mean Sq`[1],\n                    aov_test[[i]][[1]]$`Mean Sq`[2],\n                    aov_test[[i]][[1]]$`F value`[1],\n                    aov_test[[i]][[1]]$`Pr(>F)`[1],\n                    'one_way_anova')\n    }\n    names(temp)<-c('column_name','group_df','residual_df','group_ssq','residual_ssq',\n                    'group_msq','residual_msq','F_value','p_value','method')\n    output<-temp%>%\n            mutate(p_adjusted=p.adjust(p_value,method=\"bonferroni\"),\n            type=ifelse(p_adjusted<0.05,'significant','insignificant'))%>%\n            dplyr::select('column_name','group_df','residual_df','group_ssq','residual_ssq',\n                    'group_msq','residual_msq','F_value','p_value','method',\n                    'p_adjusted','type','method')\n    return(output)} \n\nmain_statistical_test<-function(\n    in_data,method,categorical_variable,in_numeric_variable,\n    homo_variables=NULL,hetero_variables=NULL,\n    fun1=multiple_shapiro_test,\n    fun2=multiple_levene_test,\n    fun3=multiple_unpaired_t_test){\n    test_list<-c(\"shapiro wilks test\",\"levene's test\",\"student t test\",\"anova\",\"correlation test\")#,\"ANCOVA\",\"MANOVA\",\"wilcoxon manwhitney\",\"kruskal wallis test\",\"fisher exact test\",\"anderson darling\")\n    error_massage<-paste0(\"Error!, no such a test in this module. \\n Please, put the first word of each method you want to use in the 'method' argument among the following tests: \", paste(test_list,collapse=\", \"))\n    if(grepl('shapiro',method)){\n        output=multiple_shapiro_test(in_data)\n    }else if(grepl('levene',method)){\n        output=multiple_levene_test(in_data,categorical_variable)\n        # var.test()\n    }else if(grepl('student',method)){\n        # code unpaired vs paired t test in the future\n        output=multiple_unpaired_t_test(in_data,categorical_variable,homo_variables,hetero_variables)\n    }else if(grepl('kruskal',method)){\n        return(error_massage)\n    }else if(grepl('wilcoxon|manwhitney',method)){\n        return(error_massage)\n    }else if(grepl('anova|aov',method)){\n        output=multiple_anova_test(in_data,categorical_variable)\n    }else if(grepl('cor',method)){\n        output=multiple_correlation_test(in_data,in_numeric_variable)\n    }else{\n        return(error_massage)\n    }\n    return(output)\n}\n\n\ngetNumericSummaryTable=function(in_data,group_variable,summary_variable,set_color=color_function,...){\n    # table\n    temp<-in_data %>% \n    #group_by_at(vars(...)) %>% \n    group_by_at(vars(group_variable)) %>% \n    mutate(count=n())%>%\n    summarise_at(vars(summary_variable,count),\n                 list(mean=mean,\n                 sd=sd,\n                 min=min,\n                 Q1=~quantile(., probs = 0.25),\n                 median=median, \n                 Q3=~quantile(., probs = 0.75),\n                 max=max))%>%\n                 as.data.frame()%>%\n                 rename(\n                 n=count_mean)%>%\n                 dplyr::select(-contains('count'))%>%\n                 as.data.frame()\n    names(temp)<-c(\"group\",\n    sapply(names(temp)[-1],function(x)str_replace(x,paste0(summary_variable,\"_\"),\"\")))\n    output<-temp%>%\n    mutate(\n        variable=group_variable,\n        summary=summary_variable,\n        mean=mean%>%round(2),\n        sd=sd%>%round(2),\n        min=min%>%round(2),\n        Q1=Q1%>%round(2),\n        Q4=Q3%>%round(2),\n        max=max%>%round(2),\n        IQR_min=Q1-(Q3-Q1)*1.5%>%round(2),\n    IQR_max=Q3+(Q3-Q1)*1.5%>%round(2),\n    proportion=paste0(round(n/nrow(all_data)*100,2),\"%\"))%>%\n    dplyr::select(variable,group,summary,n,proportion,mean,sd,min,IQR_min,Q1,median,Q3,IQR_max,max)\n    return(output)\n}\n\ngetNumericSummaryPlot=function(\n    in_data=all_data,group_variable,summary_variable,\n    set_color=color_function,\n    summary_function=getNumericSummaryTable,...){\n    # plot\n    temp=getNumericSummaryTable(in_data,group_variable,summary_variable)\n    temp2=temp\n    names(temp2)[2]=group_variable\n    plot<-\n    in_data%>%\n    dplyr::select(group_variable,summary_variable)%>%\n    inner_join(.,temp2,by=group_variable)%>%\n    ggplot(aes(x=age,fill=get(group_variable),color=get(group_variable)))+\n    geom_histogram(aes(y=..density..),binwidth=1,alpha=0.5, position=\"identity\")+\n    geom_vline(aes(xintercept=mean,color=get(group_variable)), linetype=\"dashed\", size=1.5) + \n    geom_density(aes(y=..density..),alpha=0.3) +\n    scale_color_manual(values=set_color(nrow(temp2)))+\n    scale_fill_manual(values=set_color(nrow(temp2)))+\n    theme_bw()+\n    theme(legend.position = c(.95, .95),\n    legend.justification = c(\"right\", \"top\"),\n    legend.margin = margin(6, 6, 6, 6),\n    legend.text = element_text(size = 10))+\n    guides(fill=guide_legend(title=group_variable),\n    color=FALSE)+\n    geom_text(aes(label=round(mean,1),y=0,x=mean),\n                vjust=-1,col='yellow',size=5)+\n    ggtitle(paste0(\"Histogram & Density, \", summary_variable, \" Grouped by \", group_variable))+\n        labs(x=summary_variable, y = \"Density\")\n\n    result<-plot\n    return(result)\n}\n```\n\n\n```{r}\n# load simulation data\nsimulated_data<-read_rds(datapath)\n\n# simple data pre-processing\nall_data<-\n    simulated_data%>%\n    mutate(\n      outcome=factor(outcome,levels=c(\"negative\",\"positive\")),\n      sex=ifelse(sex==0,\"man\",\"woman\"),\n      sex=factor(sex,levels=c(\"man\",\"woman\")),\n      genotype=factor(genotype,levels=c(\"e3\",\"e2\",\"e4\"))\n      )\n\n# rename metabolite variables\nnames(all_data)[6:ncol(all_data)]<-paste0(\"meta\",1:predictor_size)\n \n\n```\n# Summary \n\n## Summary of Exploratory Data Analysis (EDA) \n## Summary of Data Mining\n\n# Supplements\n\n## EDA\n\n### Univariable Analysis\n\n### Normality Test\n\n```{r}\n# raw data\nnormality_test_result<-multiple_shapiro_test(all_data)%>%\n    filter(column_name!='id')%>%\n    group_by(type)%>%\n    summarise(count=n())%>%\n    mutate(proportion=round(count/sum(count),3),\n    total=sum(count))%>%\n    dplyr::select(type,total,everything())\n    \nnormality_test_result%>%\n    knitr::kable(caption=\"Summary of the Result of Shapiro Wilk Tests on Numeric Variables\")\n\n```\n\nOut of `r normality_test_result[1,'total']` numeric variables, the variables following a normal distribution are `r normality_test_result[1,'count']` (`r normality_test_result[1,'proportion']*100`%) and the ones that do not are `r normality_test_result[2,'count']` (`r normality_test_result[2,'proportion']*100`%).\n\n### Visualization\n\n#### 16 Variables That Follow Normal Distributions\n\n\n```{r}\n#| fig-width: 9\n#| fig-height: 10\n\n# 16 numeric variables randomly selected\nnormal_variables<-\n    multiple_shapiro_test(all_data)%>%\n        filter(p_value>0.05,column_name!='id')%>%\n            dplyr::select(column_name)%>%\n            pull%>%sample(16)\n\nnormal_data<-\n    all_data%>%\n        dplyr::select(outcome,normal_variables)%>%\n        gather(key=metabolite,value=value,normal_variables)\n\nnormal_data%>%\n    ggplot(aes(x=value))+\n    geom_histogram(aes(y=..density..))+\n    geom_density(color='red',linewidth=1.5)+\n    facet_wrap(.~metabolite)+\n    labs(title=\"Histogram, Numeric Variables Following Normal Distribution\")\n\nnormal_data%>%\n    ggplot(aes(x=metabolite,y=value))+\n    geom_boxplot()+\n    theme(axis.text.x = element_text(angle=90, vjust=.5, hjust=1))+\n    labs(title=\"Boxplot, Numeric Variables Following Normal Distribution\")\n\nnormal_data%>%\n    ggplot(aes(x=value,fill=outcome))+\n    geom_histogram(aes(y=..density..),alpha=0.5)+\n    geom_density(linewidth=1.5,alpha=0.5)+\n    scale_fill_manual(values=color_function(length(unique(normal_data$outcome))))+\n    facet_wrap(.~metabolite)+\n    labs(title=\"Histogram, Numeric Variables Following Normal Distribution Grouped by Disease Status\")    \nnormal_data%>%\n    ggplot(aes(x=metabolite,y=value,fill=outcome))+\n    geom_boxplot()+\n    scale_fill_manual(values=color_function(length(unique(normal_data$outcome))))+\n    theme(axis.text.x = element_text(angle=90, vjust=.5, hjust=1))+\n    labs(title=\"Boxplot, Numeric Variables Following Normal Distribution Grouped by Disease Status\")\n\n```\n\n#### Variables That Do Not Follow Normal Distributions\n\nThere is no variable that do not follow a normal distribution.\n\n### Bivariable Analysis\n\n#### AD vs Metabolites\n\nThrough the exploratory data analysis above, it was confirmed that all variables follow a normal distribution, and t tests were conducted to select metabolites that have significant relationships with the disease status, AD. To minimize type 1 error due to multiple testings, bonferroni correction was used in the EDA\n\n* Homoscedasticity Test\n\nLeven's test is performed to confirm that each variable has equality of variance, one of the assumptions of the t test and ANOVA.\n\n```{r}\n\nleven_test_result<-\n    main_statistical_test(in_data=all_data,method=\"levene\",categorical_variable=\"outcome\")%>%\n    filter(column_name!='id')\n\nhomo_variable<-leven_test_result%>%\nfilter(p_adjusted>0.05)%>%\ndplyr::select(column_name)%>%\npull()%>%\nunique()\n\nhetero_variable<-leven_test_result%>%\nfilter(p_adjusted<0.05)%>%\ndplyr::select(column_name)%>%\npull()%>%\nunique()\n\n```\n\n*  10 variables randomly selected out of `r length(homo_variable)` variables with equal variance: `r homo_variable%>%sample(10)`\n* `r length(hetero_variable)` variables randomly selected with equal variance: `r hetero_variable`\n\n```{r}\n\nhomo_variable_sample<-homo_variable%>%sample(10)\nhetero_variable_sample<-hetero_variable\n\nstratified_levene_data<-all_data%>%\n    dplyr::select(outcome,homo_variable_sample,hetero_variable_sample)%>%\n    gather(key=metabolite,value=value,c(homo_variable_sample,hetero_variable_sample))%>%\n    mutate(levene_test=ifelse(metabolite%in%(homo_variable_sample),\"homoscedasticity\",\"heteroscedasticity\"))\n\nstratified_levene_data%>%\n    ggplot(aes(x=metabolite,y=value,fill=outcome))+\n    geom_boxplot()+\n    scale_fill_manual(values=color_function(length(unique(stratified_levene_data$outcome))))+\n    theme(axis.text.x = element_text(angle=90, vjust=.5, hjust=1))+\n    facet_wrap(.~levene_test)+\n    labs(title=\"Boxplot, Metabolites with Heteroscedasticity vs Homoscedasticity\")\n\n```\n\n* Unpaired Two Sample Mean t Test\n\n```{r}\nt_test_result<-\n    main_statistical_test(in_data=all_data,method=\"student\",\n                        categorical_variable=\"outcome\",\n                        homo_variables=homo_variable,\n                        hetero_variables=hetero_variable)\n\nmetabolites_associated_AD<-\n    t_test_result%>%\n    filter(type==\"significant\"&column_name!='age')%>%\n    arrange(p_adjusted)%>%\n    dplyr::select(column_name)%>%pull\n\nmetabolites_associated_AD_data<-\n    all_data%>%\n    dplyr::select(outcome,sex,genotype,metabolites_associated_AD)%>%\n    gather(key=metabolite,value=value,metabolites_associated_AD)        \n\nmetabolites_associated_AD_data%>%\n    group_by(outcome)%>%\n    summarise(mean=mean(value),sd=sd(value))%>%\n    knitr::kable()\n\ntop_metabolites_associated_AD<-t_test_result%>%\n    filter(type==\"significant\"&column_name!='age')%>%\n    arrange(p_adjusted)%>%head(10)%>%\n    dplyr::select(column_name)%>%pull\n\ntop_metabolites_associated_AD_data<-\n    all_data%>%\n    dplyr::select(outcome,top_metabolites_associated_AD)%>%\n    gather(key=metabolite,value=value,top_metabolites_associated_AD)        \n\nbottom_metabolites_associated_AD<-t_test_result%>%\n    filter(type==\"significant\"&column_name!='age')%>%\n    arrange(p_adjusted)%>%tail(10)%>%\n    dplyr::select(column_name)%>%pull\n\nbottom_metabolites_associated_AD_data<-\n    all_data%>%\n    dplyr::select(outcome,bottom_metabolites_associated_AD)%>%\n    gather(key=metabolite,value=value,bottom_metabolites_associated_AD)        \n\na1<-top_metabolites_associated_AD_data%>%\n    ggplot(aes(x=metabolite,y=value,fill=outcome))+\n    geom_boxplot()+\n    scale_fill_manual(values=color_function(length(unique(top_metabolites_associated_AD_data$outcome))))+\n    theme(axis.text.x = element_text(angle=90, vjust=.5, hjust=1), legend.position=\"top\")+\n    labs(title=\"Boxplot, Metabolites Strongly Associated with AD\")\n\na2<-bottom_metabolites_associated_AD_data%>%\n    ggplot(aes(x=metabolite,y=value,fill=outcome))+\n    geom_boxplot()+\n    scale_fill_manual(values=color_function(length(unique(bottom_metabolites_associated_AD_data$outcome))))+\n    theme(axis.text.x = element_text(angle=90, vjust=.5, hjust=1), legend.position=\"top\")+\n    labs(title=\"Boxplot, Metabolites Weakly Associated with AD\")\n\nggarrange(a1, a2, ncol=2, nrow=1)\n\nsignificant_metabolites<-\n    t_test_result%>%\n    filter(type==\"significant\"&column_name!='age')%>%\n    dplyr::select(column_name)%>%pull\n# significant_metabolites%>%write_rds(.,file='./docs/data/llfs_fake_significant_metabolites.rds')\n```\n\nAs a result of the t tests, there are `r length(significant_metabolites)` metabolites that are significantly associated with AD status. Metabolites with the highest significance were designated as *strong metabolites* and metabolites with the lowest significance among metabolites significantly related to AD status were designated as *weak metabolites*, and the expression level of metabolites between the disease status was confirmed through visualization. As a result, a greater difference was observed in strong metabolites than in weak metabolites, but both groups were not clearly separated in terms of AD status. \n\n#### AD vs Sex\n\n```{r}\nad_sex_summary<-all_data%>%\n    group_by(outcome,sex)%>%\n    summarise(count=n(),\n            mean_age=mean(age),\n            sd_age=sd(age))%>%\n            ungroup%>%\n    mutate(sum=sum(count),\n    proportion=paste0(count/sum*100,\"%\"))%>%\n    dplyr::select(outcome, sex,count,proportion,mean_age,sd_age)%>%\n    mutate(p_value=chisq.test(all_data$outcome,all_data$sex)$p.value,\n    method=\"chisquare_test\")\n\nad_sex_summary%>%knitr::kable()\n```\n\n#### AD vs Genotype\n\n```{r}\nad_genotype_summary<-all_data%>%\n    group_by(outcome,genotype)%>%\n    summarise(count=n(),\n            mean_age=mean(age),\n            sd_age=sd(age))%>%\n            ungroup%>%\n    mutate(sum=sum(count),\n    proportion=paste0(count/sum*100,\"%\"))%>%\n    dplyr::select(outcome, genotype,count,proportion,mean_age,sd_age)%>%\n    mutate(p_value=chisq.test(all_data$outcome,all_data$genotype)$p.value,\n    method=\"chisquare_test\")\n\ngenotype_ad_summary<-all_data%>%\n    group_by(genotype,outcome)%>%\n    summarise(count=n(),\n            mean_age=mean(age),\n            sd_age=sd(age))%>%\n            ungroup%>%\n    mutate(sum=sum(count),\n    proportion=paste0(count/sum*100,\"%\"))%>%\n    dplyr::select(genotype,outcome,count,proportion,mean_age,sd_age)%>%\n    mutate(p_value=chisq.test(all_data$outcome,all_data$genotype)$p.value,\n    method=\"chisquare_test\") \n\nad_genotype_summary%>%knitr::kable()\ngenotype_ad_summary%>%knitr::kable()\n```\n\nAs you see the tables above, the count of AD status and that of genotype status are proportionately the same. Thus, there is no relation between AD and genotype in this data at the significant level 5%.\n\n#### Age vs AD, Sex, Genotype\n\nAge is known as a strong risk factor of AD or dementia. Human nerve system gets damaged as people are aged and the nerve fibrosis symptoms progress gradually. For this reason, we need to look into how the sample data are distributed in terms of age.\n\n```{r}\nad_age_summary=getNumericSummaryTable(in_data=all_data,group_variable=\"outcome\",summary_variable=\"age\")\nsex_age_summary=getNumericSummaryTable(in_data=all_data,group_variable=\"sex\",summary_variable=\"age\")\ngenotype_age_summary=getNumericSummaryTable(in_data=all_data,group_variable=\"genotype\",summary_variable=\"age\")\nage_summary=rbind(\n    ad_age_summary,\n    sex_age_summary,\n    genotype_age_summary)\n```\n\n```{r}\nage_summary%>%knitr::kable()\n```\n\n```{r}\nplot<- ggarrange(\n    getNumericSummaryPlot(in_data=all_data,group_variable=\"outcome\",summary_variable=\"age\"),\n    getNumericSummaryPlot(in_data=all_data,group_variable=\"sex\",summary_variable=\"age\"),\n    getNumericSummaryPlot(in_data=all_data,group_variable=\"genotype\",summary_variable=\"age\"),\n    ncol=2, nrow=2,legend=\"bottom\")\nplot\n```\n\nThe table above shows the summary statistics of age grouped by the affected status, AD and non AD. The difference of age between the two groups are about `r round(age_summary%>%filter(group==\"positive\")%>%dplyr::select(mean)- age_summary%>%filter(group==\"negative\")%>%dplyr::select(mean),2)`, but their standard deviations are `r round(age_summary%>%filter(group==\"positive\")%>%dplyr::select(sd),2)` and `r round(age_summary%>%filter(group==\"negative\")%>%dplyr::select(sd),2)`. Thus, it is hard to say their age in average differ in the affected status because the age variations of the two groups are overlapped. This research has two conflicting characteristics at the population level. \n\nThe glaring difference of age is also shown below. As you can see, the people with a negative status `r (ad_age_summary[1,'mean'] - ad_age_summary[2,'mean'])%>%round(3)` years younger than those with a positive one.\n\n\n```{r}\na1<-all_data%>%\n    dplyr::select(outcome,age)%>%\n    ggplot(aes(x=age,fill=outcome))+\n    geom_histogram(aes(y=..density..),alpha=0.5)+\n    geom_density(linewidth=1.5,alpha=0.5)+\n    scale_fill_manual(values=color_function(length(unique(all_data$outcome))))+\n    theme(legend.position=\"top\")+\n    labs(title=\"Histogram, Age Distribution Grouped by Disease Status\")   \na2<-all_data%>%\n    dplyr::select(outcome,age)%>%\n    ggplot(aes(x=outcome,y=age,fill=outcome))+\n    geom_boxplot()+\n    scale_fill_manual(values=color_function(length(unique(all_data$outcome))))+\n    theme(axis.text.x = element_text(angle=90, vjust=.5, hjust=1), legend.position=\"top\")+\n    labs(title=\"Boxplot, Age Distribution Grouped by Disease Status\")\n\nggarrange(a1, a2, ncol=2, nrow=1)\n```\n\n#### Age vs Metabolites\n\n```{r}\nage_correlation_data<-\n    main_statistical_test(in_data=all_data,in_numeric_variable = 'age',method = \"cor\")%>%\n    filter(p_adjusted<0.05,column_name!='id')\n```\n\n`r nrow(age_correlation_data)` metabolites are significantly associated with age.\n\n\n#### Genotype vs Metabolites\n\n```{r}\ngenotype_aov<-main_statistical_test(in_data=all_data,categorical_variable=\"genotype\",method='aov')\ngenotype_aov%>%\nfilter(column_name!='id',p_adjusted<0.05)%>%knitr::kable()\n\n```\n\n`r genotype_aov%>%filter(column_name!='id',p_adjusted<0.05)%>%nrow()` metabolites are significantly associated with the genotype variable.\n\n### Multivariable Analysis\n\n#### AD vs Sex vs Genotype vs Age\n\n```{r}\nall_data%>%\n    group_by(outcome,sex,genotype)%>%\n    summarise(count=n(),\n    mean_age=mean(age),\n    sd_age=sd(age))%>%ungroup%>%\n    mutate(sum_count=sum(count),\n    proportion=paste0(round(count/sum_count*100,3),'%'))%>%\n    dplyr::select(outcome,sex,genotype,count,proportion, mean_age,sd_age)%>%\n    knitr::kable()\n\n```\n\nExcept for the disease status variable, it looks like there is no difference of age in average and count in the other categorical variables. Taking into account age varialble is significantly associated with the metabolites that are significantly associated with the disease status, outcome (or AD). There is no need to conduct futher exploratory data analysis in the multivariable analysis senction.\n:::\n","srcMarkdownNoYaml":"\n\n\n```{r}\n#| echo: false\n\nrm(list=ls())\n\nif(grepl('kkm',getwd())){\n    datapath=\"C:/Users/kkm/Desktop/projects/website/docs/data/llfs_simulated_data.rds\"\n}else{\n    datapath=\"C:/Users/kmkim/Desktop/projects/website/docs/data/llfs_simulated_data.rds\"\n}\n\n```\n\n\n<ul class=\"nav nav-pills\" id=\"language-tab\" role=\"tablist\">\n\n<li class=\"nav-item\" role=\"presentation\">\n\n<button class=\"nav-link active\" id=\"Korean-tab\" data-bs-toggle=\"tab\" data-bs-target=\"#Korean\" type=\"button\" role=\"tab\" aria-controls=\"Korean\" aria-selected=\"true\">\n\nKorean\n\n</button>\n\n</li>\n\n<li class=\"nav-item\" role=\"presentation\">\n\n<button class=\"nav-link\" id=\"English-tab\" data-bs-toggle=\"tab\" data-bs-target=\"#English\" type=\"button\" role=\"tab\" aria-controls=\"knitr\" aria-selected=\"false\">\n\nEnglish\n\n</button>\n\n</li>\n\n<div class=\"tab-content\" id=\"language-tabcontent\">\n\n::: {#Korean .tab-pane .fade .show .active role=\"tabpanel\" aria-labelledby=\"Korean-tab\"}\n\n**(한글 준비중)**\n\nplease, read the English section first. \n\n\n```{r}\n#| echo: false\n\nif(!require(janitor)) install.packages(\"janitor\") \nif(!require(tidyverse)) install.packages(\"tidyverse\") \nif(!require(tidymodels)) install.packages(\"tidymodels\") \nif(!require(glmnet)) install.packages(\"glmnet\") \nif(!require(MASS)) install.packages(\"MASS\") \nif(!require(ggpubr)) install.packages(\"ggpubr\") \nif(!require(car)) install.packages(\"car\") \nif(!require(mixOmics)) install.packages(\"mixOmics\") \n\nlibrary(janitor)\nlibrary(tidyverse)\nlibrary(tidymodels)\nlibrary(glmnet)\nlibrary(MASS)\nlibrary(ggpubr) \nlibrary(car) \nlibrary(mixOmics)\nset.seed(20230103) \nknitr::opts_chunk$set(message=FALSE,warning=FALSE)\n```\n\n\n```{r}\n#| echo: false\n# the number of samples\nsample_size <- 500 #1000\n# the number of predictors\npredictor_size <- 1000 #5000\n# the number of groups\ngroup_size <- sample(6:10,1) # at least more than 6, the number of the genotypes\n# the number of predictors truly associated with a response variable\nsignificant_predictors <- floor(predictor_size*sample((50:100)/1000,1)) \n\n## set the predictors associated with an outcome\n### the number of predictors positively associated with an outcome\n### the number of predictors negatively associated with an outcome\npositively_associated_predictors<-floor(significant_predictors*0.4) \nnegatively_associated_predictors<-significant_predictors-positively_associated_predictors \n\n## set the proportion of the groups in which the predictors are correlated with one another\n### randomly sampling proportions to become their sum equal to 1\ngroup_proportion_list<-sample(seq(1,1+2*(100-group_size)/group_size,\n                            by=2*(100-group_size)/(group_size*(group_size-1)))/100,\n                        group_size,replace=FALSE)%>%round(3) \nnames(group_proportion_list)<-paste0(\"group\",1:length(group_proportion_list))\n### initialize a matrix with a size as sample_size by predictor_size\npredictor_matrix <- matrix(0, ncol = predictor_size, nrow = sample_size)\n### initialize a data frame and assign meta information used to generate simulated data\ngroup_meta_data<-\n    data.frame(\n        group_name=c(names(group_proportion_list)),\n        proportion=group_proportion_list)%>%\n        mutate(\n            group_n=(predictor_size*group_proportion_list)%>%round(0), # the number of predictors within each group \n            first_index=c(1,cumsum(group_n[-length(group_proportion_list)])+1), # the 1st index of predictors in each group\n            last_index=cumsum(group_n), # the last index of predictors in each group\n            group_correlation=sample((0:700)/1000,length(group_proportion_list),replace=TRUE), # within-group correlations among the within-group predictors\n            group_effect=sample((-40:30)/100,length(group_proportion_list),replace=TRUE)) # effect of each group on an outcome variable\n### set a group effect as 0.7 into a group with the smallest group number \ngroup_meta_data[which.min(group_meta_data[,\"group_n\"]),\"group_effect\"]<-0.7\n\n### set a group effect as -0.5 into a group with the second smallest group number \ngroup_meta_data[group_meta_data[,\"group_n\"]==(sort(group_meta_data[,\"group_n\"])[2]),\"group_effect\"]<-(-0.5)\n\n# initialize a data matrix to assign simulated values\n## add some noise to data\ndata<-matrix(rnorm(sample_size*predictor_size,mean=0,sd=0.05), \n             nrow = sample_size, ncol = predictor_size)\n\n# initialize a covariance matrix to assign simulated values\ncovariance_matrix<-matrix(rnorm(predictor_size*predictor_size,mean=0,sd=0.05),\n                          nrow=predictor_size, ncol=predictor_size)\nbeta_coefficients <- rnorm(predictor_size,0,0.05)\n\nanswer_list<-list(\n    'sample size'=sample_size,\n    'predictor size'=predictor_size,\n    'group size'=group_size,\n    'significant predictors'=significant_predictors,\n    'positively associated predictors'=positively_associated_predictors,\n    'negatively associated predictors'=negatively_associated_predictors,\n    'group proportion list'=group_proportion_list,\n    'group meta data'=group_meta_data,\n    'data noise intensity'=c('distribution'='rnorm','mean'=0,'sd'=0.05),\n    'covariance noise intensity'=c('distribution'='rnorm','mean'=0,'sd'=0.05),\n    'effect noise intensity on response'=c('distribution'='rnorm','mean'=0,'sd'=0.05),\n    'link function between the response and predictors' = 'canonical logit link function',\n    'link function noise intensity' = c('distribution'='rnorm','mean'=0,'sd'=0.05),\n    'age_distirbution'='used data of a variable with the highest effect on outcome',\n    'sex_distribution'='rbinom(n=sample size,p=0.5)',\n    'genotype_distirbution'=c('e2' = '8.4%','e3' = '77.9%','e4' = '13.7%'))\n```\n\n\n\n```{r}\n\n## Function List\n\ncolor_function<-function(category_number){\nreturn(\n    if(category_number==2){\n        c(\"darkblue\",\"darkred\")\n    }else if(category_number==3){\n        c(\"darkblue\",\"darkred\",\"yellow4\")\n    }else if(category_number==4){\n        c(\"darkblue\",\"darkred\",\"yellow4\",\"blueviolet\")\n    }else if(category_number==5){\n        c(\"darkblue\",\"darkred\",\"yellow4\",\"blueviolet\",\"darkorange\")\n    }else{\n        c(\"darkblue\",\"darkred\",\"yellow4\",\"blueviolet\",\"darkorange\",\"darkgreen\")\n    }\n    )\n}\n\nscale_function=function(vector=x,min=NULL,max=NULL,method){\n    scaling_methods<-c('min_max normalization','customized normalization','standardization')\n\n    if(method==\"min-max\"){\n        output=(vector-min(vector))/(max(vector)-min(vector))\n    }else if(method==\"customized\"){\n        output=(max-min)*(vector-min(vector))/(max(vector)-min(vector))+min\n    }else if(method==\"standarized\"){\n        output=(vector-mean(vector))/sd(vector)\n    }else{\n        output=paste0(\"Error!, no such a scaling method in this module. \\n Please, put the first word of each method you want to use in the 'method' argument among the following tests: \", paste(scaling_methods,collapse=\", \"))\n    }\n  return(output)\n}\n\nmultiple_shapiro_test<-function(in_data){\n        normality_test<-apply(in_data[,unlist(lapply(in_data, is.numeric))],2,\n                            function(x)shapiro.test(x))\n        temp<-data.frame(matrix(nrow=length(normality_test),ncol=4))\n        for (i in 1:length(normality_test)){\n            temp[i,]<-c(\n                coloumn_name=names(normality_test)[i],\n                statistic=normality_test[[i]]$statistic,\n                p_value=normality_test[[i]]$p.value,\n                method=normality_test[[i]]$method)\n        }\n        names(temp)<-c('column_name','statistic','p_value','method')\n        output<-temp%>%\n            mutate(p_adjusted=p.adjust(p_value,method=\"bonferroni\"),\n            type=ifelse(p_adjusted<0.05,'not_normal','normal'))%>%\n            dplyr::select('column_name','statistic','p_value','p_adjusted','type','method')\n        return(output)\n}    \n\nmultiple_levene_test<-function(in_data,categorical_variable){\n        homoscedasticity_test<-apply(in_data[,unlist(lapply(in_data, is.numeric))],2,\n                                    function(x)leveneTest(x~in_data[,categorical_variable]))\n        temp<-data.frame(matrix(nrow=length(homoscedasticity_test),ncol=6))\n            for (i in 1:length(homoscedasticity_test)){\n                temp[i,]<-c(\n                    coloumn_name=names(homoscedasticity_test)[i],\n                    group_df=homoscedasticity_test[[i]]$Df[1],\n                    residual_df=homoscedasticity_test[[i]]$Df[2],\n                    statistic=homoscedasticity_test[[i]]$`F value`[1],\n                    p_value=homoscedasticity_test[[i]]$`Pr(>F)`[1],\n                    method=\"levene's test\")\n            }\n            names(temp)<-c('column_name','group_df','residual_df','statistic','p_value','method')\n            output<-temp%>%\n                mutate(p_adjusted=p.adjust(p_value,method=\"bonferroni\"),\n                type=ifelse(p_adjusted<0.05,'heteroscedasticity','homoscedasticity'))%>%\n                dplyr::select('column_name','group_df','residual_df','statistic','p_value','p_adjusted','type','method')\n        return(output)} \n\nmultiple_unpaired_t_test<-function(in_data,categorical_variable,homo_variables,hetero_variables){\n    homo_unpaired_t_test<-apply(in_data[,unlist(lapply(in_data, is.numeric))][,homo_variables],2,\n                                    function(x)t.test(x~in_data[,categorical_variable],var.equal=TRUE))\n    hetero_unpaired_t_test<-apply(in_data[,unlist(lapply(in_data, is.numeric))][,hetero_variables],2,\n                                    function(x)t.test(x~in_data[,categorical_variable],var.equal=FALSE)) \n    unpaired_t_test<-c(homo_unpaired_t_test,hetero_unpaired_t_test)\n\n    temp<-data.frame(matrix(nrow=length(unpaired_t_test),ncol=7))\n        for (i in 1:length(unpaired_t_test)){\n            temp[i,]<-c(names(unpaired_t_test)[i], \n                        unpaired_t_test[[i]]$estimate,\n                        unpaired_t_test[[i]]$parameter,\n                        unpaired_t_test[[i]]$statistic,\n                        unpaired_t_test[[i]]$p.value,\n                        unpaired_t_test[[i]]$method)\n        }\n        names(temp)<-c('column_name',names(unpaired_t_test[[1]]$estimate),'df','statistic','p_value','method')\n        output<-temp%>%\n            mutate(p_adjusted=p.adjust(p_value,method=\"bonferroni\"),\n            type=ifelse(p_adjusted<0.05,'significant','insignificant'))%>%\n            dplyr::select('column_name',names(unpaired_t_test[[1]]$estimate),'df','statistic','p_value','p_adjusted','type','method')\n    return(output)} \n\n\nmultiple_correlation_test<-function(in_data,in_numeric_variable){\n    correlation_test<-apply(in_data[,unlist(lapply(in_data, is.numeric))],2,\n                                    function(x)cor.test(x,in_data[,in_numeric_variable],method='pearson'))\n    temp<-data.frame(matrix(nrow=length(correlation_test),ncol=6))\n        for (i in 1:length(correlation_test)){\n            temp[i,]<-c(names(correlation_test)[i], \n                        correlation_test[[i]]$estimate,\n                        correlation_test[[i]]$parameter,\n                        correlation_test[[i]]$statistic,\n                        correlation_test[[i]]$p.value,\n                        correlation_test[[i]]$method)\n        }\n        names(temp)<-c('column_name',names(correlation_test[[1]]$estimate),'df','statistic','p_value','method')\n        output<-temp%>%\n            mutate(p_adjusted=p.adjust(p_value,method=\"bonferroni\"),\n            type=ifelse(p_adjusted<0.05,'significant','insignificant'))%>%\n            dplyr::select('column_name',names(correlation_test[[1]]$estimate),'df','statistic','p_value','p_adjusted','type','method')\n    return(output)} \n\nmultiple_anova_test<-function(in_data, in_categorical_variable){\n    aov_test<-apply(in_data[,unlist(lapply(in_data, is.numeric))],2,\n                function(x)aov(x~get(in_categorical_variable),data=in_data)%>%summary)\n\n    temp<-data.frame(matrix(nrow=length(aov_test),ncol=10))\n    for (i in 1:length(aov_test)){\n        temp[i,]<-c(names(aov_test)[i], \n                    aov_test[[i]][[1]]$`Df`[1],\n                    aov_test[[i]][[1]]$`Df`[2],\n                    aov_test[[i]][[1]]$`Sum Sq`[1],\n                    aov_test[[i]][[1]]$`Sum Sq`[2],\n                    aov_test[[i]][[1]]$`Mean Sq`[1],\n                    aov_test[[i]][[1]]$`Mean Sq`[2],\n                    aov_test[[i]][[1]]$`F value`[1],\n                    aov_test[[i]][[1]]$`Pr(>F)`[1],\n                    'one_way_anova')\n    }\n    names(temp)<-c('column_name','group_df','residual_df','group_ssq','residual_ssq',\n                    'group_msq','residual_msq','F_value','p_value','method')\n    output<-temp%>%\n            mutate(p_adjusted=p.adjust(p_value,method=\"bonferroni\"),\n            type=ifelse(p_adjusted<0.05,'significant','insignificant'))%>%\n            dplyr::select('column_name','group_df','residual_df','group_ssq','residual_ssq',\n                    'group_msq','residual_msq','F_value','p_value','method',\n                    'p_adjusted','type','method')\n    return(output)} \n\nmain_statistical_test<-function(\n    in_data,method,categorical_variable,in_numeric_variable,\n    homo_variables=NULL,hetero_variables=NULL,\n    fun1=multiple_shapiro_test,\n    fun2=multiple_levene_test,\n    fun3=multiple_unpaired_t_test){\n    test_list<-c(\"shapiro wilks test\",\"levene's test\",\"student t test\",\"anova\",\"correlation test\")#,\"ANCOVA\",\"MANOVA\",\"wilcoxon manwhitney\",\"kruskal wallis test\",\"fisher exact test\",\"anderson darling\")\n    error_massage<-paste0(\"Error!, no such a test in this module. \\n Please, put the first word of each method you want to use in the 'method' argument among the following tests: \", paste(test_list,collapse=\", \"))\n    if(grepl('shapiro',method)){\n        output=multiple_shapiro_test(in_data)\n    }else if(grepl('levene',method)){\n        output=multiple_levene_test(in_data,categorical_variable)\n        # var.test()\n    }else if(grepl('student',method)){\n        # code unpaired vs paired t test in the future\n        output=multiple_unpaired_t_test(in_data,categorical_variable,homo_variables,hetero_variables)\n    }else if(grepl('kruskal',method)){\n        return(error_massage)\n    }else if(grepl('wilcoxon|manwhitney',method)){\n        return(error_massage)\n    }else if(grepl('anova|aov',method)){\n        output=multiple_anova_test(in_data,categorical_variable)\n    }else if(grepl('cor',method)){\n        output=multiple_correlation_test(in_data,in_numeric_variable)\n    }else{\n        return(error_massage)\n    }\n    return(output)\n}\n\n\ngetNumericSummaryTable=function(in_data,group_variable,summary_variable,set_color=color_function,...){\n    # table\n    temp<-in_data %>% \n    #group_by_at(vars(...)) %>% \n    group_by_at(vars(group_variable)) %>% \n    mutate(count=n())%>%\n    summarise_at(vars(summary_variable,count),\n                 list(mean=mean,\n                 sd=sd,\n                 min=min,\n                 Q1=~quantile(., probs = 0.25),\n                 median=median, \n                 Q3=~quantile(., probs = 0.75),\n                 max=max))%>%\n                 as.data.frame()%>%\n                 rename(\n                 n=count_mean)%>%\n                 dplyr::select(-contains('count'))%>%\n                 as.data.frame()\n    names(temp)<-c(\"group\",\n    sapply(names(temp)[-1],function(x)str_replace(x,paste0(summary_variable,\"_\"),\"\")))\n    output<-temp%>%\n    mutate(\n        variable=group_variable,\n        summary=summary_variable,\n        mean=mean%>%round(2),\n        sd=sd%>%round(2),\n        min=min%>%round(2),\n        Q1=Q1%>%round(2),\n        Q4=Q3%>%round(2),\n        max=max%>%round(2),\n        IQR_min=Q1-(Q3-Q1)*1.5%>%round(2),\n    IQR_max=Q3+(Q3-Q1)*1.5%>%round(2),\n    proportion=paste0(round(n/nrow(all_data)*100,2),\"%\"))%>%\n    dplyr::select(variable,group,summary,n,proportion,mean,sd,min,IQR_min,Q1,median,Q3,IQR_max,max)\n    return(output)\n}\n\ngetNumericSummaryPlot=function(\n    in_data=all_data,group_variable,summary_variable,\n    set_color=color_function,\n    summary_function=getNumericSummaryTable,...){\n    # plot\n    temp=getNumericSummaryTable(in_data,group_variable,summary_variable)\n    temp2=temp\n    names(temp2)[2]=group_variable\n    plot<-\n    in_data%>%\n    dplyr::select(group_variable,summary_variable)%>%\n    inner_join(.,temp2,by=group_variable)%>%\n    ggplot(aes(x=age,fill=get(group_variable),color=get(group_variable)))+\n    geom_histogram(aes(y=..density..),binwidth=1,alpha=0.5, position=\"identity\")+\n    geom_vline(aes(xintercept=mean,color=get(group_variable)), linetype=\"dashed\", size=1.5) + \n    geom_density(aes(y=..density..),alpha=0.3) +\n    scale_color_manual(values=set_color(nrow(temp2)))+\n    scale_fill_manual(values=set_color(nrow(temp2)))+\n    theme_bw()+\n    theme(legend.position = c(.95, .95),\n    legend.justification = c(\"right\", \"top\"),\n    legend.margin = margin(6, 6, 6, 6),\n    legend.text = element_text(size = 10))+\n    guides(fill=guide_legend(title=group_variable),\n    color=FALSE)+\n    geom_text(aes(label=round(mean,1),y=0,x=mean),\n                vjust=-1,col='yellow',size=5)+\n    ggtitle(paste0(\"Histogram & Density, \", summary_variable, \" Grouped by \", group_variable))+\n        labs(x=summary_variable, y = \"Density\")\n\n    result<-plot\n    return(result)\n}\n```\n\n\n```{r}\n# load simulation data\nsimulated_data<-read_rds(datapath)\n\n# simple data pre-processing\nall_data<-\n    simulated_data%>%\n    mutate(\n      outcome=factor(outcome,levels=c(\"negative\",\"positive\")),\n      sex=ifelse(sex==0,\"man\",\"woman\"),\n      sex=factor(sex,levels=c(\"man\",\"woman\")),\n      genotype=factor(genotype,levels=c(\"e3\",\"e2\",\"e4\"))\n      )\n\n# rename metabolite variables\nnames(all_data)[6:ncol(all_data)]<-paste0(\"meta\",1:predictor_size)\n \n\n```\n# Summary \n\n## Summary of Exploratory Data Analysis (EDA) \n\n# Supplements\n\n## EDA\n\n### Univariable Analysis\n\n#### Normality Test\n\n```{r}\n# raw data\nnormality_test_result<-multiple_shapiro_test(all_data)%>%\n    filter(column_name!='id')%>%\n    group_by(type)%>%\n    summarise(count=n())%>%\n    mutate(proportion=round(count/sum(count),3),\n    total=sum(count))%>%\n    dplyr::select(type,total,everything())\n    \nnormality_test_result%>%\n    knitr::kable(caption=\"Summary of the Result of Shapiro Wilk Tests on Numeric Variables\")\n\n```\n\nOut of `r normality_test_result[1,'total']` numeric variables, the variables following a normal distribution are `r normality_test_result[1,'count']` (`r normality_test_result[1,'proportion']*100`%) and the ones that do not are `r normality_test_result[2,'count']` (`r normality_test_result[2,'proportion']*100`%).\n\n#### 16 Variables That Follow Normal Distributions\n\n\n```{r}\n#| fig-width: 9\n#| fig-height: 10\n\n# 16 numeric variables randomly selected\nnormal_variables<-\n    multiple_shapiro_test(all_data)%>%\n        filter(p_value>0.05,column_name!='id')%>%\n            dplyr::select(column_name)%>%\n            pull%>%sample(16)\n\nnormal_data<-\n    all_data%>%\n        dplyr::select(outcome,normal_variables)%>%\n        gather(key=metabolite,value=value,normal_variables)\n\nnormal_data%>%\n    ggplot(aes(x=value))+\n    geom_histogram(aes(y=..density..))+\n    geom_density(color='red',linewidth=1.5)+\n    facet_wrap(.~metabolite)+\n    labs(title=\"Histogram, Numeric Variables Following Normal Distribution\")\n\nnormal_data%>%\n    ggplot(aes(x=metabolite,y=value))+\n    geom_boxplot()+\n    theme(axis.text.x = element_text(angle=90, vjust=.5, hjust=1))+\n    labs(title=\"Boxplot, Numeric Variables Following Normal Distribution\")\n\nnormal_data%>%\n    ggplot(aes(x=value,fill=outcome))+\n    geom_histogram(aes(y=..density..),alpha=0.5)+\n    geom_density(linewidth=1.5,alpha=0.5)+\n    scale_fill_manual(values=color_function(length(unique(normal_data$outcome))))+\n    facet_wrap(.~metabolite)+\n    labs(title=\"Histogram, Numeric Variables Following Normal Distribution Grouped by Disease Status\")    \nnormal_data%>%\n    ggplot(aes(x=metabolite,y=value,fill=outcome))+\n    geom_boxplot()+\n    scale_fill_manual(values=color_function(length(unique(normal_data$outcome))))+\n    theme(axis.text.x = element_text(angle=90, vjust=.5, hjust=1))+\n    labs(title=\"Boxplot, Numeric Variables Following Normal Distribution Grouped by Disease Status\")\n\n```\n\n#### Variables That Do Not Follow Normal Distributions\n\nThere is no variable that do not follow a normal distribution.\n\n### Bivariable Analysis\n\n#### AD vs Metabolites\n\nThrough the exploratory data analysis above, it was confirmed that all variables follow a normal distribution, and t tests were conducted to select metabolites that have significant relationships with the disease status, AD. To minimize type 1 error due to multiple testings, bonferroni correction was used in the EDA\n\n* Homoscedasticity Test\n\nLeven's test is performed to confirm that each variable has equality of variance, one of the assumptions of the t test and ANOVA.\n\n```{r}\n\nleven_test_result<-\n    main_statistical_test(in_data=all_data,method=\"levene\",categorical_variable=\"outcome\")%>%\n    filter(column_name!='id')\n\nhomo_variable<-leven_test_result%>%\nfilter(p_adjusted>0.05)%>%\ndplyr::select(column_name)%>%\npull()%>%\nunique()\n\nhetero_variable<-leven_test_result%>%\nfilter(p_adjusted<0.05)%>%\ndplyr::select(column_name)%>%\npull()%>%\nunique()\n\n```\n\n*  10 variables randomly selected out of `r length(homo_variable)` variables with equal variance: `r homo_variable%>%sample(10)`\n* `r length(hetero_variable)` variables randomly selected with equal variance: `r hetero_variable`\n\n```{r}\n\nhomo_variable_sample<-homo_variable%>%sample(10)\nhetero_variable_sample<-hetero_variable\n\nstratified_levene_data<-all_data%>%\n    dplyr::select(outcome,homo_variable_sample,hetero_variable_sample)%>%\n    gather(key=metabolite,value=value,c(homo_variable_sample,hetero_variable_sample))%>%\n    mutate(levene_test=ifelse(metabolite%in%(homo_variable_sample),\"homoscedasticity\",\"heteroscedasticity\"))\n\nstratified_levene_data%>%\n    ggplot(aes(x=metabolite,y=value,fill=outcome))+\n    geom_boxplot()+\n    scale_fill_manual(values=color_function(length(unique(stratified_levene_data$outcome))))+\n    theme(axis.text.x = element_text(angle=90, vjust=.5, hjust=1))+\n    facet_wrap(.~levene_test)+\n    labs(title=\"Boxplot, Metabolites with Heteroscedasticity vs Homoscedasticity\")\n\n```\n\n* Unpaired Two Sample Mean t Test\n\n```{r}\nt_test_result<-\n    main_statistical_test(in_data=all_data,method=\"student\",\n                        categorical_variable=\"outcome\",\n                        homo_variables=homo_variable,\n                        hetero_variables=hetero_variable)\n\nmetabolites_associated_AD<-\n    t_test_result%>%\n    filter(type==\"significant\"&column_name!='age')%>%\n    arrange(p_adjusted)%>%\n    dplyr::select(column_name)%>%pull\n\nmetabolites_associated_AD_data<-\n    all_data%>%\n    dplyr::select(outcome,sex,genotype,metabolites_associated_AD)%>%\n    gather(key=metabolite,value=value,metabolites_associated_AD)        \n\nmetabolites_associated_AD_data%>%\n    group_by(outcome)%>%\n    summarise(mean=mean(value),sd=sd(value))%>%\n    knitr::kable()\n\ntop_metabolites_associated_AD<-t_test_result%>%\n    filter(type==\"significant\"&column_name!='age')%>%\n    arrange(p_adjusted)%>%head(10)%>%\n    dplyr::select(column_name)%>%pull\n\ntop_metabolites_associated_AD_data<-\n    all_data%>%\n    dplyr::select(outcome,top_metabolites_associated_AD)%>%\n    gather(key=metabolite,value=value,top_metabolites_associated_AD)        \n\nbottom_metabolites_associated_AD<-t_test_result%>%\n    filter(type==\"significant\"&column_name!='age')%>%\n    arrange(p_adjusted)%>%tail(10)%>%\n    dplyr::select(column_name)%>%pull\n\nbottom_metabolites_associated_AD_data<-\n    all_data%>%\n    dplyr::select(outcome,bottom_metabolites_associated_AD)%>%\n    gather(key=metabolite,value=value,bottom_metabolites_associated_AD)        \n\na1<-top_metabolites_associated_AD_data%>%\n    ggplot(aes(x=metabolite,y=value,fill=outcome))+\n    geom_boxplot()+\n    scale_fill_manual(values=color_function(length(unique(top_metabolites_associated_AD_data$outcome))))+\n    theme(axis.text.x = element_text(angle=90, vjust=.5, hjust=1), legend.position=\"top\")+\n    labs(title=\"Boxplot, Metabolites Strongly Associated with AD\")\n\na2<-bottom_metabolites_associated_AD_data%>%\n    ggplot(aes(x=metabolite,y=value,fill=outcome))+\n    geom_boxplot()+\n    scale_fill_manual(values=color_function(length(unique(bottom_metabolites_associated_AD_data$outcome))))+\n    theme(axis.text.x = element_text(angle=90, vjust=.5, hjust=1), legend.position=\"top\")+\n    labs(title=\"Boxplot, Metabolites Weakly Associated with AD\")\n\nggarrange(a1, a2, ncol=2, nrow=1)\n\nsignificant_metabolites<-\n    t_test_result%>%\n    filter(type==\"significant\"&column_name!='age')%>%\n    dplyr::select(column_name)%>%pull\n```\n\nAs a result of the t tests, there are `r length(significant_metabolites)` metabolites that are significantly associated with AD status at the 5% significance level. Metabolites with the highest significance were designated as *strong metabolites* and metabolites with the lowest significance among metabolites significantly related to AD status were designated as *weak metabolites*, and the expression level of metabolites between the disease status was confirmed through visualization. As a result, a greater difference was observed in strong metabolites than in weak metabolites, but both groups were not clearly separated in terms of AD status. \n\n#### AD vs Sex\n\n```{r}\nad_sex_summary<-all_data%>%\n    group_by(outcome,sex)%>%\n    summarise(count=n(),\n            mean_age=mean(age),\n            sd_age=sd(age))%>%\n            ungroup%>%\n    mutate(sum=sum(count),\n    proportion=paste0(count/sum*100,\"%\"))%>%\n    dplyr::select(outcome, sex,count,proportion,mean_age,sd_age)%>%\n    mutate(p_value=chisq.test(all_data$outcome,all_data$sex)$p.value,\n    method=\"chisquare_test\")\n\nad_sex_summary%>%knitr::kable()\n```\n\n#### AD vs Genotype\n\n```{r}\nad_genotype_summary<-all_data%>%\n    group_by(outcome,genotype)%>%\n    summarise(count=n(),\n            mean_age=mean(age),\n            sd_age=sd(age))%>%\n            ungroup%>%\n    mutate(sum=sum(count),\n    proportion=paste0(count/sum*100,\"%\"))%>%\n    dplyr::select(outcome, genotype,count,proportion,mean_age,sd_age)%>%\n    mutate(p_value=chisq.test(all_data$outcome,all_data$genotype)$p.value,\n    method=\"chisquare_test\")\n\ngenotype_ad_summary<-all_data%>%\n    group_by(genotype,outcome)%>%\n    summarise(count=n(),\n            mean_age=mean(age),\n            sd_age=sd(age))%>%\n            ungroup%>%\n    mutate(sum=sum(count),\n    proportion=paste0(count/sum*100,\"%\"))%>%\n    dplyr::select(genotype,outcome,count,proportion,mean_age,sd_age)%>%\n    mutate(p_value=chisq.test(all_data$outcome,all_data$genotype)$p.value,\n    method=\"chisquare_test\") \n\nad_genotype_summary%>%knitr::kable()\ngenotype_ad_summary%>%knitr::kable()\n```\n\nAs you see the tables above, the count of AD status and that of genotype status are proportionately the same. Thus, there is no relation between AD and genotype in this data at the significant level 5%.\n\n#### Age vs AD, Sex, Genotype\n\nAge is known as a strong risk factor of AD or dementia. Human nerve system gets damaged as people are aged and the nerve fibrosis symptoms progress gradually. For this reason, we need to look into how the sample data are distributed in terms of age.\n\n```{r}\nad_age_summary=getNumericSummaryTable(in_data=all_data,group_variable=\"outcome\",summary_variable=\"age\")\nsex_age_summary=getNumericSummaryTable(in_data=all_data,group_variable=\"sex\",summary_variable=\"age\")\ngenotype_age_summary=getNumericSummaryTable(in_data=all_data,group_variable=\"genotype\",summary_variable=\"age\")\nage_summary=rbind(\n    ad_age_summary,\n    sex_age_summary,\n    genotype_age_summary)\n```\n\n```{r}\nage_summary%>%knitr::kable()\n```\n\n```{r}\n#| fig-width: 8\n#| fig-height: 10\n\nplot<- ggarrange(\n    getNumericSummaryPlot(in_data=all_data,group_variable=\"outcome\",summary_variable=\"age\"),\n    getNumericSummaryPlot(in_data=all_data,group_variable=\"sex\",summary_variable=\"age\"),\n    getNumericSummaryPlot(in_data=all_data,group_variable=\"genotype\",summary_variable=\"age\"),\n    ncol=2, nrow=2,legend=\"bottom\")\nplot\n```\n\nThe table above shows the summary statistics of age grouped by the affected status, AD and non AD. The difference of age between the two groups are about `r round(age_summary%>%filter(group==\"positive\")%>%dplyr::select(mean)- age_summary%>%filter(group==\"negative\")%>%dplyr::select(mean),2)`, but their standard deviations are `r round(age_summary%>%filter(group==\"positive\")%>%dplyr::select(sd),2)` and `r round(age_summary%>%filter(group==\"negative\")%>%dplyr::select(sd),2)`. Thus, it is hard to say their age in average differ in the affected status because the age variations of the two groups are overlapped. This research has two conflicting characteristics at the population level. \n\nThe glaring difference of age is also shown below. As you can see, the people with a negative status `r (ad_age_summary[1,'mean'] - ad_age_summary[2,'mean'])%>%round(3)` years younger than those with a positive one.\n\n\n```{r}\na1<-all_data%>%\n    dplyr::select(outcome,age)%>%\n    ggplot(aes(x=age,fill=outcome))+\n    geom_histogram(aes(y=..density..),alpha=0.5)+\n    geom_density(linewidth=1.5,alpha=0.5)+\n    scale_fill_manual(values=color_function(length(unique(all_data$outcome))))+\n    theme(legend.position=\"top\")+\n    labs(title=\"Histogram, Age Distribution Grouped by Disease Status\")   \na2<-all_data%>%\n    dplyr::select(outcome,age)%>%\n    ggplot(aes(x=outcome,y=age,fill=outcome))+\n    geom_boxplot()+\n    scale_fill_manual(values=color_function(length(unique(all_data$outcome))))+\n    theme(axis.text.x = element_text(angle=90, vjust=.5, hjust=1), legend.position=\"top\")+\n    labs(title=\"Boxplot, Age Distribution Grouped by Disease Status\")\n\nggarrange(a1, a2, ncol=2, nrow=1)\n```\n\n#### Age vs Metabolites\n\n```{r}\nage_correlation_data<-\n    main_statistical_test(in_data=all_data,in_numeric_variable = 'age',method = \"cor\")%>%\n    filter(p_adjusted<0.05,column_name!='id')\n```\n\n`r nrow(age_correlation_data)` metabolites are significantly associated with age.\n\n\n#### Genotype vs Metabolites\n\n```{r}\ngenotype_aov<-main_statistical_test(in_data=all_data,categorical_variable=\"genotype\",method='aov')\ngenotype_aov%>%\nfilter(column_name!='id',p_adjusted<0.05)%>%knitr::kable()\n\n```\n\n`r genotype_aov%>%filter(column_name!='id',p_adjusted<0.05)%>%nrow()` metabolites are significantly associated with the genotype variable.\n\n### Multivariable Analysis\n\n#### AD vs Sex vs Genotype vs Age\n\n```{r}\nall_data%>%\n    group_by(outcome,sex,genotype)%>%\n    summarise(count=n(),\n    mean_age=mean(age),\n    sd_age=sd(age))%>%ungroup%>%\n    mutate(sum_count=sum(count),\n    proportion=paste0(round(count/sum_count*100,3),'%'))%>%\n    dplyr::select(outcome,sex,genotype,count,proportion, mean_age,sd_age)%>%\n    knitr::kable()\n\n```\n\nExcept for the disease status variable, it looks like there is no difference of age in average and count in the other categorical variables. Taking into account age varialble is significantly associated with the metabolites that are significantly associated with the disease status, outcome (or AD). There is no need to conduct futher exploratory data analysis in the multivariable analysis senction.\n\n\n:::\n\n::: {#English .tab-pane .fade role=\"tabpanel\" aria-labelledby=\"English-tab\"}\nplease, read the English section first. \n\n\n```{r}\n#| echo: false\n\nif(!require(janitor)) install.packages(\"janitor\") \nif(!require(tidyverse)) install.packages(\"tidyverse\") \nif(!require(tidymodels)) install.packages(\"tidymodels\") \nif(!require(glmnet)) install.packages(\"glmnet\") \nif(!require(MASS)) install.packages(\"MASS\") \nif(!require(ggpubr)) install.packages(\"ggpubr\") \nif(!require(car)) install.packages(\"car\") \nif(!require(mixOmics)) install.packages(\"mixOmics\") \n\nlibrary(janitor)\nlibrary(tidyverse)\nlibrary(tidymodels)\nlibrary(glmnet)\nlibrary(MASS)\nlibrary(ggpubr) \nlibrary(car) \nlibrary(mixOmics)\nset.seed(20230103) \nknitr::opts_chunk$set(message=FALSE,warning=FALSE)\n```\n\n\n```{r}\n#| echo: false\n# the number of samples\nsample_size <- 500 #1000\n# the number of predictors\npredictor_size <- 1000 #5000\n# the number of groups\ngroup_size <- sample(6:10,1) # at least more than 6, the number of the genotypes\n# the number of predictors truly associated with a response variable\nsignificant_predictors <- floor(predictor_size*sample((50:100)/1000,1)) \n\n## set the predictors associated with an outcome\n### the number of predictors positively associated with an outcome\n### the number of predictors negatively associated with an outcome\npositively_associated_predictors<-floor(significant_predictors*0.4) \nnegatively_associated_predictors<-significant_predictors-positively_associated_predictors \n\n## set the proportion of the groups in which the predictors are correlated with one another\n### randomly sampling proportions to become their sum equal to 1\ngroup_proportion_list<-sample(seq(1,1+2*(100-group_size)/group_size,\n                            by=2*(100-group_size)/(group_size*(group_size-1)))/100,\n                        group_size,replace=FALSE)%>%round(3) \nnames(group_proportion_list)<-paste0(\"group\",1:length(group_proportion_list))\n### initialize a matrix with a size as sample_size by predictor_size\npredictor_matrix <- matrix(0, ncol = predictor_size, nrow = sample_size)\n### initialize a data frame and assign meta information used to generate simulated data\ngroup_meta_data<-\n    data.frame(\n        group_name=c(names(group_proportion_list)),\n        proportion=group_proportion_list)%>%\n        mutate(\n            group_n=(predictor_size*group_proportion_list)%>%round(0), # the number of predictors within each group \n            first_index=c(1,cumsum(group_n[-length(group_proportion_list)])+1), # the 1st index of predictors in each group\n            last_index=cumsum(group_n), # the last index of predictors in each group\n            group_correlation=sample((0:700)/1000,length(group_proportion_list),replace=TRUE), # within-group correlations among the within-group predictors\n            group_effect=sample((-40:30)/100,length(group_proportion_list),replace=TRUE)) # effect of each group on an outcome variable\n### set a group effect as 0.7 into a group with the smallest group number \ngroup_meta_data[which.min(group_meta_data[,\"group_n\"]),\"group_effect\"]<-0.7\n\n### set a group effect as -0.5 into a group with the second smallest group number \ngroup_meta_data[group_meta_data[,\"group_n\"]==(sort(group_meta_data[,\"group_n\"])[2]),\"group_effect\"]<-(-0.5)\n\n# initialize a data matrix to assign simulated values\n## add some noise to data\ndata<-matrix(rnorm(sample_size*predictor_size,mean=0,sd=0.05), \n             nrow = sample_size, ncol = predictor_size)\n\n# initialize a covariance matrix to assign simulated values\ncovariance_matrix<-matrix(rnorm(predictor_size*predictor_size,mean=0,sd=0.05),\n                          nrow=predictor_size, ncol=predictor_size)\nbeta_coefficients <- rnorm(predictor_size,0,0.05)\n\nanswer_list<-list(\n    'sample size'=sample_size,\n    'predictor size'=predictor_size,\n    'group size'=group_size,\n    'significant predictors'=significant_predictors,\n    'positively associated predictors'=positively_associated_predictors,\n    'negatively associated predictors'=negatively_associated_predictors,\n    'group proportion list'=group_proportion_list,\n    'group meta data'=group_meta_data,\n    'data noise intensity'=c('distribution'='rnorm','mean'=0,'sd'=0.05),\n    'covariance noise intensity'=c('distribution'='rnorm','mean'=0,'sd'=0.05),\n    'effect noise intensity on response'=c('distribution'='rnorm','mean'=0,'sd'=0.05),\n    'link function between the response and predictors' = 'canonical logit link function',\n    'link function noise intensity' = c('distribution'='rnorm','mean'=0,'sd'=0.05),\n    'age_distirbution'='used data of a variable with the highest effect on outcome',\n    'sex_distribution'='rbinom(n=sample size,p=0.5)',\n    'genotype_distirbution'=c('e2' = '8.4%','e3' = '77.9%','e4' = '13.7%'))\n```\n\n\n\n```{r}\n\n## Function List\n\ncolor_function<-function(category_number){\nreturn(\n    if(category_number==2){\n        c(\"darkblue\",\"darkred\")\n    }else if(category_number==3){\n        c(\"darkblue\",\"darkred\",\"yellow4\")\n    }else if(category_number==4){\n        c(\"darkblue\",\"darkred\",\"yellow4\",\"blueviolet\")\n    }else if(category_number==5){\n        c(\"darkblue\",\"darkred\",\"yellow4\",\"blueviolet\",\"darkorange\")\n    }else{\n        c(\"darkblue\",\"darkred\",\"yellow4\",\"blueviolet\",\"darkorange\",\"darkgreen\")\n    }\n    )\n}\n\nscale_function=function(vector=x,min=NULL,max=NULL,method){\n    scaling_methods<-c('min_max normalization','customized normalization','standardization')\n\n    if(method==\"min-max\"){\n        output=(vector-min(vector))(max(vector)-min(vector))\n    }else if(method==\"customized\"){\n        output=(max-min)*(vector-min(vector))/(max(vector)-min(vector))+min\n    }else if(method==\"standarized\"){\n        output=(vector-mean(vector))/sd(vector)\n    }else{\n        output=paste0(\"Error!, no such a scaling method in this module. \\n Please, put the first word of each method you want to use in the 'method' argument among the following tests: \", paste(scaling_methods,collapse=\", \"))\n    }\n  return(output)\n}\n\nmultiple_shapiro_test<-function(in_data){\n        normality_test<-apply(in_data[,unlist(lapply(in_data, is.numeric))],2,\n                            function(x)shapiro.test(x))\n        temp<-data.frame(matrix(nrow=length(normality_test),ncol=4))\n        for (i in 1:length(normality_test)){\n            temp[i,]<-c(\n                coloumn_name=names(normality_test)[i],\n                statistic=normality_test[[i]]$statistic,\n                p_value=normality_test[[i]]$p.value,\n                method=normality_test[[i]]$method)\n        }\n        names(temp)<-c('column_name','statistic','p_value','method')\n        output<-temp%>%\n            mutate(p_adjusted=p.adjust(p_value,method=\"bonferroni\"),\n            type=ifelse(p_adjusted<0.05,'not_normal','normal'))%>%\n            dplyr::select('column_name','statistic','p_value','p_adjusted','type','method')\n        return(output)\n}    \n\nmultiple_levene_test<-function(in_data,categorical_variable){\n        homoscedasticity_test<-apply(in_data[,unlist(lapply(in_data, is.numeric))],2,\n                                    function(x)leveneTest(x~in_data[,categorical_variable]))\n        temp<-data.frame(matrix(nrow=length(homoscedasticity_test),ncol=6))\n            for (i in 1:length(homoscedasticity_test)){\n                temp[i,]<-c(\n                    coloumn_name=names(homoscedasticity_test)[i],\n                    group_df=homoscedasticity_test[[i]]$Df[1],\n                    residual_df=homoscedasticity_test[[i]]$Df[2],\n                    statistic=homoscedasticity_test[[i]]$`F value`[1],\n                    p_value=homoscedasticity_test[[i]]$`Pr(>F)`[1],\n                    method=\"levene's test\")\n            }\n            names(temp)<-c('column_name','group_df','residual_df','statistic','p_value','method')\n            output<-temp%>%\n                mutate(p_adjusted=p.adjust(p_value,method=\"bonferroni\"),\n                type=ifelse(p_adjusted<0.05,'heteroscedasticity','homoscedasticity'))%>%\n                dplyr::select('column_name','group_df','residual_df','statistic','p_value','p_adjusted','type','method')\n        return(output)} \n\nmultiple_unpaired_t_test<-function(in_data,categorical_variable,homo_variables,hetero_variables){\n    homo_unpaired_t_test<-apply(in_data[,unlist(lapply(in_data, is.numeric))][,homo_variables],2,\n                                    function(x)t.test(x~in_data[,categorical_variable],var.equal=TRUE))\n    hetero_unpaired_t_test<-apply(in_data[,unlist(lapply(in_data, is.numeric))][,hetero_variables],2,\n                                    function(x)t.test(x~in_data[,categorical_variable],var.equal=FALSE)) \n    unpaired_t_test<-c(homo_unpaired_t_test,hetero_unpaired_t_test)\n\n    temp<-data.frame(matrix(nrow=length(unpaired_t_test),ncol=7))\n        for (i in 1:length(unpaired_t_test)){\n            temp[i,]<-c(names(unpaired_t_test)[i], \n                        unpaired_t_test[[i]]$estimate,\n                        unpaired_t_test[[i]]$parameter,\n                        unpaired_t_test[[i]]$statistic,\n                        unpaired_t_test[[i]]$p.value,\n                        unpaired_t_test[[i]]$method)\n        }\n        names(temp)<-c('column_name',names(unpaired_t_test[[1]]$estimate),'df','statistic','p_value','method')\n        output<-temp%>%\n            mutate(p_adjusted=p.adjust(p_value,method=\"bonferroni\"),\n            type=ifelse(p_adjusted<0.05,'significant','insignificant'))%>%\n            dplyr::select('column_name',names(unpaired_t_test[[1]]$estimate),'df','statistic','p_value','p_adjusted','type','method')\n    return(output)} \n\n\nmultiple_correlation_test<-function(in_data,in_numeric_variable){\n    correlation_test<-apply(in_data[,unlist(lapply(in_data, is.numeric))],2,\n                                    function(x)cor.test(x,in_data[,in_numeric_variable],method='pearson'))\n    temp<-data.frame(matrix(nrow=length(correlation_test),ncol=6))\n        for (i in 1:length(correlation_test)){\n            temp[i,]<-c(names(correlation_test)[i], \n                        correlation_test[[i]]$estimate,\n                        correlation_test[[i]]$parameter,\n                        correlation_test[[i]]$statistic,\n                        correlation_test[[i]]$p.value,\n                        correlation_test[[i]]$method)\n        }\n        names(temp)<-c('column_name',names(correlation_test[[1]]$estimate),'df','statistic','p_value','method')\n        output<-temp%>%\n            mutate(p_adjusted=p.adjust(p_value,method=\"bonferroni\"),\n            type=ifelse(p_adjusted<0.05,'significant','insignificant'))%>%\n            dplyr::select('column_name',names(correlation_test[[1]]$estimate),'df','statistic','p_value','p_adjusted','type','method')\n    return(output)} \n\nmultiple_anova_test<-function(in_data, in_categorical_variable){\n    aov_test<-apply(in_data[,unlist(lapply(in_data, is.numeric))],2,\n                function(x)aov(x~get(in_categorical_variable),data=in_data)%>%summary)\n\n    temp<-data.frame(matrix(nrow=length(aov_test),ncol=10))\n    for (i in 1:length(aov_test)){\n        temp[i,]<-c(names(aov_test)[i], \n                    aov_test[[i]][[1]]$`Df`[1],\n                    aov_test[[i]][[1]]$`Df`[2],\n                    aov_test[[i]][[1]]$`Sum Sq`[1],\n                    aov_test[[i]][[1]]$`Sum Sq`[2],\n                    aov_test[[i]][[1]]$`Mean Sq`[1],\n                    aov_test[[i]][[1]]$`Mean Sq`[2],\n                    aov_test[[i]][[1]]$`F value`[1],\n                    aov_test[[i]][[1]]$`Pr(>F)`[1],\n                    'one_way_anova')\n    }\n    names(temp)<-c('column_name','group_df','residual_df','group_ssq','residual_ssq',\n                    'group_msq','residual_msq','F_value','p_value','method')\n    output<-temp%>%\n            mutate(p_adjusted=p.adjust(p_value,method=\"bonferroni\"),\n            type=ifelse(p_adjusted<0.05,'significant','insignificant'))%>%\n            dplyr::select('column_name','group_df','residual_df','group_ssq','residual_ssq',\n                    'group_msq','residual_msq','F_value','p_value','method',\n                    'p_adjusted','type','method')\n    return(output)} \n\nmain_statistical_test<-function(\n    in_data,method,categorical_variable,in_numeric_variable,\n    homo_variables=NULL,hetero_variables=NULL,\n    fun1=multiple_shapiro_test,\n    fun2=multiple_levene_test,\n    fun3=multiple_unpaired_t_test){\n    test_list<-c(\"shapiro wilks test\",\"levene's test\",\"student t test\",\"anova\",\"correlation test\")#,\"ANCOVA\",\"MANOVA\",\"wilcoxon manwhitney\",\"kruskal wallis test\",\"fisher exact test\",\"anderson darling\")\n    error_massage<-paste0(\"Error!, no such a test in this module. \\n Please, put the first word of each method you want to use in the 'method' argument among the following tests: \", paste(test_list,collapse=\", \"))\n    if(grepl('shapiro',method)){\n        output=multiple_shapiro_test(in_data)\n    }else if(grepl('levene',method)){\n        output=multiple_levene_test(in_data,categorical_variable)\n        # var.test()\n    }else if(grepl('student',method)){\n        # code unpaired vs paired t test in the future\n        output=multiple_unpaired_t_test(in_data,categorical_variable,homo_variables,hetero_variables)\n    }else if(grepl('kruskal',method)){\n        return(error_massage)\n    }else if(grepl('wilcoxon|manwhitney',method)){\n        return(error_massage)\n    }else if(grepl('anova|aov',method)){\n        output=multiple_anova_test(in_data,categorical_variable)\n    }else if(grepl('cor',method)){\n        output=multiple_correlation_test(in_data,in_numeric_variable)\n    }else{\n        return(error_massage)\n    }\n    return(output)\n}\n\n\ngetNumericSummaryTable=function(in_data,group_variable,summary_variable,set_color=color_function,...){\n    # table\n    temp<-in_data %>% \n    #group_by_at(vars(...)) %>% \n    group_by_at(vars(group_variable)) %>% \n    mutate(count=n())%>%\n    summarise_at(vars(summary_variable,count),\n                 list(mean=mean,\n                 sd=sd,\n                 min=min,\n                 Q1=~quantile(., probs = 0.25),\n                 median=median, \n                 Q3=~quantile(., probs = 0.75),\n                 max=max))%>%\n                 as.data.frame()%>%\n                 rename(\n                 n=count_mean)%>%\n                 dplyr::select(-contains('count'))%>%\n                 as.data.frame()\n    names(temp)<-c(\"group\",\n    sapply(names(temp)[-1],function(x)str_replace(x,paste0(summary_variable,\"_\"),\"\")))\n    output<-temp%>%\n    mutate(\n        variable=group_variable,\n        summary=summary_variable,\n        mean=mean%>%round(2),\n        sd=sd%>%round(2),\n        min=min%>%round(2),\n        Q1=Q1%>%round(2),\n        Q4=Q3%>%round(2),\n        max=max%>%round(2),\n        IQR_min=Q1-(Q3-Q1)*1.5%>%round(2),\n    IQR_max=Q3+(Q3-Q1)*1.5%>%round(2),\n    proportion=paste0(round(n/nrow(all_data)*100,2),\"%\"))%>%\n    dplyr::select(variable,group,summary,n,proportion,mean,sd,min,IQR_min,Q1,median,Q3,IQR_max,max)\n    return(output)\n}\n\ngetNumericSummaryPlot=function(\n    in_data=all_data,group_variable,summary_variable,\n    set_color=color_function,\n    summary_function=getNumericSummaryTable,...){\n    # plot\n    temp=getNumericSummaryTable(in_data,group_variable,summary_variable)\n    temp2=temp\n    names(temp2)[2]=group_variable\n    plot<-\n    in_data%>%\n    dplyr::select(group_variable,summary_variable)%>%\n    inner_join(.,temp2,by=group_variable)%>%\n    ggplot(aes(x=age,fill=get(group_variable),color=get(group_variable)))+\n    geom_histogram(aes(y=..density..),binwidth=1,alpha=0.5, position=\"identity\")+\n    geom_vline(aes(xintercept=mean,color=get(group_variable)), linetype=\"dashed\", size=1.5) + \n    geom_density(aes(y=..density..),alpha=0.3) +\n    scale_color_manual(values=set_color(nrow(temp2)))+\n    scale_fill_manual(values=set_color(nrow(temp2)))+\n    theme_bw()+\n    theme(legend.position = c(.95, .95),\n    legend.justification = c(\"right\", \"top\"),\n    legend.margin = margin(6, 6, 6, 6),\n    legend.text = element_text(size = 10))+\n    guides(fill=guide_legend(title=group_variable),\n    color=FALSE)+\n    geom_text(aes(label=round(mean,1),y=0,x=mean),\n                vjust=-1,col='yellow',size=5)+\n    ggtitle(paste0(\"Histogram & Density, \", summary_variable, \" Grouped by \", group_variable))+\n        labs(x=summary_variable, y = \"Density\")\n\n    result<-plot\n    return(result)\n}\n```\n\n\n```{r}\n# load simulation data\nsimulated_data<-read_rds(datapath)\n\n# simple data pre-processing\nall_data<-\n    simulated_data%>%\n    mutate(\n      outcome=factor(outcome,levels=c(\"negative\",\"positive\")),\n      sex=ifelse(sex==0,\"man\",\"woman\"),\n      sex=factor(sex,levels=c(\"man\",\"woman\")),\n      genotype=factor(genotype,levels=c(\"e3\",\"e2\",\"e4\"))\n      )\n\n# rename metabolite variables\nnames(all_data)[6:ncol(all_data)]<-paste0(\"meta\",1:predictor_size)\n \n\n```\n# Summary \n\n## Summary of Exploratory Data Analysis (EDA) \n## Summary of Data Mining\n\n# Supplements\n\n## EDA\n\n### Univariable Analysis\n\n### Normality Test\n\n```{r}\n# raw data\nnormality_test_result<-multiple_shapiro_test(all_data)%>%\n    filter(column_name!='id')%>%\n    group_by(type)%>%\n    summarise(count=n())%>%\n    mutate(proportion=round(count/sum(count),3),\n    total=sum(count))%>%\n    dplyr::select(type,total,everything())\n    \nnormality_test_result%>%\n    knitr::kable(caption=\"Summary of the Result of Shapiro Wilk Tests on Numeric Variables\")\n\n```\n\nOut of `r normality_test_result[1,'total']` numeric variables, the variables following a normal distribution are `r normality_test_result[1,'count']` (`r normality_test_result[1,'proportion']*100`%) and the ones that do not are `r normality_test_result[2,'count']` (`r normality_test_result[2,'proportion']*100`%).\n\n### Visualization\n\n#### 16 Variables That Follow Normal Distributions\n\n\n```{r}\n#| fig-width: 9\n#| fig-height: 10\n\n# 16 numeric variables randomly selected\nnormal_variables<-\n    multiple_shapiro_test(all_data)%>%\n        filter(p_value>0.05,column_name!='id')%>%\n            dplyr::select(column_name)%>%\n            pull%>%sample(16)\n\nnormal_data<-\n    all_data%>%\n        dplyr::select(outcome,normal_variables)%>%\n        gather(key=metabolite,value=value,normal_variables)\n\nnormal_data%>%\n    ggplot(aes(x=value))+\n    geom_histogram(aes(y=..density..))+\n    geom_density(color='red',linewidth=1.5)+\n    facet_wrap(.~metabolite)+\n    labs(title=\"Histogram, Numeric Variables Following Normal Distribution\")\n\nnormal_data%>%\n    ggplot(aes(x=metabolite,y=value))+\n    geom_boxplot()+\n    theme(axis.text.x = element_text(angle=90, vjust=.5, hjust=1))+\n    labs(title=\"Boxplot, Numeric Variables Following Normal Distribution\")\n\nnormal_data%>%\n    ggplot(aes(x=value,fill=outcome))+\n    geom_histogram(aes(y=..density..),alpha=0.5)+\n    geom_density(linewidth=1.5,alpha=0.5)+\n    scale_fill_manual(values=color_function(length(unique(normal_data$outcome))))+\n    facet_wrap(.~metabolite)+\n    labs(title=\"Histogram, Numeric Variables Following Normal Distribution Grouped by Disease Status\")    \nnormal_data%>%\n    ggplot(aes(x=metabolite,y=value,fill=outcome))+\n    geom_boxplot()+\n    scale_fill_manual(values=color_function(length(unique(normal_data$outcome))))+\n    theme(axis.text.x = element_text(angle=90, vjust=.5, hjust=1))+\n    labs(title=\"Boxplot, Numeric Variables Following Normal Distribution Grouped by Disease Status\")\n\n```\n\n#### Variables That Do Not Follow Normal Distributions\n\nThere is no variable that do not follow a normal distribution.\n\n### Bivariable Analysis\n\n#### AD vs Metabolites\n\nThrough the exploratory data analysis above, it was confirmed that all variables follow a normal distribution, and t tests were conducted to select metabolites that have significant relationships with the disease status, AD. To minimize type 1 error due to multiple testings, bonferroni correction was used in the EDA\n\n* Homoscedasticity Test\n\nLeven's test is performed to confirm that each variable has equality of variance, one of the assumptions of the t test and ANOVA.\n\n```{r}\n\nleven_test_result<-\n    main_statistical_test(in_data=all_data,method=\"levene\",categorical_variable=\"outcome\")%>%\n    filter(column_name!='id')\n\nhomo_variable<-leven_test_result%>%\nfilter(p_adjusted>0.05)%>%\ndplyr::select(column_name)%>%\npull()%>%\nunique()\n\nhetero_variable<-leven_test_result%>%\nfilter(p_adjusted<0.05)%>%\ndplyr::select(column_name)%>%\npull()%>%\nunique()\n\n```\n\n*  10 variables randomly selected out of `r length(homo_variable)` variables with equal variance: `r homo_variable%>%sample(10)`\n* `r length(hetero_variable)` variables randomly selected with equal variance: `r hetero_variable`\n\n```{r}\n\nhomo_variable_sample<-homo_variable%>%sample(10)\nhetero_variable_sample<-hetero_variable\n\nstratified_levene_data<-all_data%>%\n    dplyr::select(outcome,homo_variable_sample,hetero_variable_sample)%>%\n    gather(key=metabolite,value=value,c(homo_variable_sample,hetero_variable_sample))%>%\n    mutate(levene_test=ifelse(metabolite%in%(homo_variable_sample),\"homoscedasticity\",\"heteroscedasticity\"))\n\nstratified_levene_data%>%\n    ggplot(aes(x=metabolite,y=value,fill=outcome))+\n    geom_boxplot()+\n    scale_fill_manual(values=color_function(length(unique(stratified_levene_data$outcome))))+\n    theme(axis.text.x = element_text(angle=90, vjust=.5, hjust=1))+\n    facet_wrap(.~levene_test)+\n    labs(title=\"Boxplot, Metabolites with Heteroscedasticity vs Homoscedasticity\")\n\n```\n\n* Unpaired Two Sample Mean t Test\n\n```{r}\nt_test_result<-\n    main_statistical_test(in_data=all_data,method=\"student\",\n                        categorical_variable=\"outcome\",\n                        homo_variables=homo_variable,\n                        hetero_variables=hetero_variable)\n\nmetabolites_associated_AD<-\n    t_test_result%>%\n    filter(type==\"significant\"&column_name!='age')%>%\n    arrange(p_adjusted)%>%\n    dplyr::select(column_name)%>%pull\n\nmetabolites_associated_AD_data<-\n    all_data%>%\n    dplyr::select(outcome,sex,genotype,metabolites_associated_AD)%>%\n    gather(key=metabolite,value=value,metabolites_associated_AD)        \n\nmetabolites_associated_AD_data%>%\n    group_by(outcome)%>%\n    summarise(mean=mean(value),sd=sd(value))%>%\n    knitr::kable()\n\ntop_metabolites_associated_AD<-t_test_result%>%\n    filter(type==\"significant\"&column_name!='age')%>%\n    arrange(p_adjusted)%>%head(10)%>%\n    dplyr::select(column_name)%>%pull\n\ntop_metabolites_associated_AD_data<-\n    all_data%>%\n    dplyr::select(outcome,top_metabolites_associated_AD)%>%\n    gather(key=metabolite,value=value,top_metabolites_associated_AD)        \n\nbottom_metabolites_associated_AD<-t_test_result%>%\n    filter(type==\"significant\"&column_name!='age')%>%\n    arrange(p_adjusted)%>%tail(10)%>%\n    dplyr::select(column_name)%>%pull\n\nbottom_metabolites_associated_AD_data<-\n    all_data%>%\n    dplyr::select(outcome,bottom_metabolites_associated_AD)%>%\n    gather(key=metabolite,value=value,bottom_metabolites_associated_AD)        \n\na1<-top_metabolites_associated_AD_data%>%\n    ggplot(aes(x=metabolite,y=value,fill=outcome))+\n    geom_boxplot()+\n    scale_fill_manual(values=color_function(length(unique(top_metabolites_associated_AD_data$outcome))))+\n    theme(axis.text.x = element_text(angle=90, vjust=.5, hjust=1), legend.position=\"top\")+\n    labs(title=\"Boxplot, Metabolites Strongly Associated with AD\")\n\na2<-bottom_metabolites_associated_AD_data%>%\n    ggplot(aes(x=metabolite,y=value,fill=outcome))+\n    geom_boxplot()+\n    scale_fill_manual(values=color_function(length(unique(bottom_metabolites_associated_AD_data$outcome))))+\n    theme(axis.text.x = element_text(angle=90, vjust=.5, hjust=1), legend.position=\"top\")+\n    labs(title=\"Boxplot, Metabolites Weakly Associated with AD\")\n\nggarrange(a1, a2, ncol=2, nrow=1)\n\nsignificant_metabolites<-\n    t_test_result%>%\n    filter(type==\"significant\"&column_name!='age')%>%\n    dplyr::select(column_name)%>%pull\n# significant_metabolites%>%write_rds(.,file='./docs/data/llfs_fake_significant_metabolites.rds')\n```\n\nAs a result of the t tests, there are `r length(significant_metabolites)` metabolites that are significantly associated with AD status. Metabolites with the highest significance were designated as *strong metabolites* and metabolites with the lowest significance among metabolites significantly related to AD status were designated as *weak metabolites*, and the expression level of metabolites between the disease status was confirmed through visualization. As a result, a greater difference was observed in strong metabolites than in weak metabolites, but both groups were not clearly separated in terms of AD status. \n\n#### AD vs Sex\n\n```{r}\nad_sex_summary<-all_data%>%\n    group_by(outcome,sex)%>%\n    summarise(count=n(),\n            mean_age=mean(age),\n            sd_age=sd(age))%>%\n            ungroup%>%\n    mutate(sum=sum(count),\n    proportion=paste0(count/sum*100,\"%\"))%>%\n    dplyr::select(outcome, sex,count,proportion,mean_age,sd_age)%>%\n    mutate(p_value=chisq.test(all_data$outcome,all_data$sex)$p.value,\n    method=\"chisquare_test\")\n\nad_sex_summary%>%knitr::kable()\n```\n\n#### AD vs Genotype\n\n```{r}\nad_genotype_summary<-all_data%>%\n    group_by(outcome,genotype)%>%\n    summarise(count=n(),\n            mean_age=mean(age),\n            sd_age=sd(age))%>%\n            ungroup%>%\n    mutate(sum=sum(count),\n    proportion=paste0(count/sum*100,\"%\"))%>%\n    dplyr::select(outcome, genotype,count,proportion,mean_age,sd_age)%>%\n    mutate(p_value=chisq.test(all_data$outcome,all_data$genotype)$p.value,\n    method=\"chisquare_test\")\n\ngenotype_ad_summary<-all_data%>%\n    group_by(genotype,outcome)%>%\n    summarise(count=n(),\n            mean_age=mean(age),\n            sd_age=sd(age))%>%\n            ungroup%>%\n    mutate(sum=sum(count),\n    proportion=paste0(count/sum*100,\"%\"))%>%\n    dplyr::select(genotype,outcome,count,proportion,mean_age,sd_age)%>%\n    mutate(p_value=chisq.test(all_data$outcome,all_data$genotype)$p.value,\n    method=\"chisquare_test\") \n\nad_genotype_summary%>%knitr::kable()\ngenotype_ad_summary%>%knitr::kable()\n```\n\nAs you see the tables above, the count of AD status and that of genotype status are proportionately the same. Thus, there is no relation between AD and genotype in this data at the significant level 5%.\n\n#### Age vs AD, Sex, Genotype\n\nAge is known as a strong risk factor of AD or dementia. Human nerve system gets damaged as people are aged and the nerve fibrosis symptoms progress gradually. For this reason, we need to look into how the sample data are distributed in terms of age.\n\n```{r}\nad_age_summary=getNumericSummaryTable(in_data=all_data,group_variable=\"outcome\",summary_variable=\"age\")\nsex_age_summary=getNumericSummaryTable(in_data=all_data,group_variable=\"sex\",summary_variable=\"age\")\ngenotype_age_summary=getNumericSummaryTable(in_data=all_data,group_variable=\"genotype\",summary_variable=\"age\")\nage_summary=rbind(\n    ad_age_summary,\n    sex_age_summary,\n    genotype_age_summary)\n```\n\n```{r}\nage_summary%>%knitr::kable()\n```\n\n```{r}\nplot<- ggarrange(\n    getNumericSummaryPlot(in_data=all_data,group_variable=\"outcome\",summary_variable=\"age\"),\n    getNumericSummaryPlot(in_data=all_data,group_variable=\"sex\",summary_variable=\"age\"),\n    getNumericSummaryPlot(in_data=all_data,group_variable=\"genotype\",summary_variable=\"age\"),\n    ncol=2, nrow=2,legend=\"bottom\")\nplot\n```\n\nThe table above shows the summary statistics of age grouped by the affected status, AD and non AD. The difference of age between the two groups are about `r round(age_summary%>%filter(group==\"positive\")%>%dplyr::select(mean)- age_summary%>%filter(group==\"negative\")%>%dplyr::select(mean),2)`, but their standard deviations are `r round(age_summary%>%filter(group==\"positive\")%>%dplyr::select(sd),2)` and `r round(age_summary%>%filter(group==\"negative\")%>%dplyr::select(sd),2)`. Thus, it is hard to say their age in average differ in the affected status because the age variations of the two groups are overlapped. This research has two conflicting characteristics at the population level. \n\nThe glaring difference of age is also shown below. As you can see, the people with a negative status `r (ad_age_summary[1,'mean'] - ad_age_summary[2,'mean'])%>%round(3)` years younger than those with a positive one.\n\n\n```{r}\na1<-all_data%>%\n    dplyr::select(outcome,age)%>%\n    ggplot(aes(x=age,fill=outcome))+\n    geom_histogram(aes(y=..density..),alpha=0.5)+\n    geom_density(linewidth=1.5,alpha=0.5)+\n    scale_fill_manual(values=color_function(length(unique(all_data$outcome))))+\n    theme(legend.position=\"top\")+\n    labs(title=\"Histogram, Age Distribution Grouped by Disease Status\")   \na2<-all_data%>%\n    dplyr::select(outcome,age)%>%\n    ggplot(aes(x=outcome,y=age,fill=outcome))+\n    geom_boxplot()+\n    scale_fill_manual(values=color_function(length(unique(all_data$outcome))))+\n    theme(axis.text.x = element_text(angle=90, vjust=.5, hjust=1), legend.position=\"top\")+\n    labs(title=\"Boxplot, Age Distribution Grouped by Disease Status\")\n\nggarrange(a1, a2, ncol=2, nrow=1)\n```\n\n#### Age vs Metabolites\n\n```{r}\nage_correlation_data<-\n    main_statistical_test(in_data=all_data,in_numeric_variable = 'age',method = \"cor\")%>%\n    filter(p_adjusted<0.05,column_name!='id')\n```\n\n`r nrow(age_correlation_data)` metabolites are significantly associated with age.\n\n\n#### Genotype vs Metabolites\n\n```{r}\ngenotype_aov<-main_statistical_test(in_data=all_data,categorical_variable=\"genotype\",method='aov')\ngenotype_aov%>%\nfilter(column_name!='id',p_adjusted<0.05)%>%knitr::kable()\n\n```\n\n`r genotype_aov%>%filter(column_name!='id',p_adjusted<0.05)%>%nrow()` metabolites are significantly associated with the genotype variable.\n\n### Multivariable Analysis\n\n#### AD vs Sex vs Genotype vs Age\n\n```{r}\nall_data%>%\n    group_by(outcome,sex,genotype)%>%\n    summarise(count=n(),\n    mean_age=mean(age),\n    sd_age=sd(age))%>%ungroup%>%\n    mutate(sum_count=sum(count),\n    proportion=paste0(round(count/sum_count*100,3),'%'))%>%\n    dplyr::select(outcome,sex,genotype,count,proportion, mean_age,sd_age)%>%\n    knitr::kable()\n\n```\n\nExcept for the disease status variable, it looks like there is no difference of age in average and count in the other categorical variables. Taking into account age varialble is significantly associated with the metabolites that are significantly associated with the disease status, outcome (or AD). There is no need to conduct futher exploratory data analysis in the multivariable analysis senction.\n:::\n"},"formats":{"html":{"identifier":{"display-name":"HTML","target-format":"html","base-format":"html"},"execute":{"fig-width":7,"fig-height":5,"fig-format":"retina","fig-dpi":96,"df-print":"default","error":false,"eval":false,"cache":true,"freeze":true,"echo":true,"output":true,"warning":false,"include":true,"keep-md":false,"keep-ipynb":false,"ipynb":null,"enabled":null,"daemon":true,"daemon-restart":false,"debug":false,"ipynb-filters":[],"ipynb-shell-interactivity":null,"plotly-connected":true,"message":false,"engine":"knitr"},"render":{"keep-tex":false,"keep-typ":false,"keep-source":false,"keep-hidden":false,"prefer-html":false,"output-divs":true,"output-ext":"html","fig-align":"default","fig-pos":null,"fig-env":null,"code-fold":true,"code-overflow":"wrap","code-link":false,"code-line-numbers":true,"code-tools":false,"tbl-colwidths":"auto","merge-includes":true,"inline-includes":false,"preserve-yaml":false,"latex-auto-mk":true,"latex-auto-install":true,"latex-clean":true,"latex-min-runs":1,"latex-max-runs":10,"latex-makeindex":"makeindex","latex-makeindex-opts":[],"latex-tlmgr-opts":[],"latex-input-paths":[],"latex-output-dir":null,"link-external-icon":false,"link-external-newwindow":false,"self-contained-math":false,"format-resources":[],"notebook-links":true},"pandoc":{"standalone":true,"wrap":"none","default-image-extension":"png","to":"html","highlight-style":"github","css":["../../../styles.css"],"toc":true,"toc-depth":4,"number-sections":true,"include-in-header":[{"text":"<style>\n.custom-footer { \n  text-align: center; \n  font-size: 0.8em; \n  color: #666; \n  margin-top: 2rem; \n}\n</style>\n"}],"include-after-body":["../../../js.html"],"output-file":"eda.html"},"language":{"toc-title-document":"Table of contents","toc-title-website":"On this page","related-formats-title":"Other Formats","related-notebooks-title":"Notebooks","source-notebooks-prefix":"Source","other-links-title":"Other Links","code-links-title":"Code Links","launch-dev-container-title":"Launch Dev Container","launch-binder-title":"Launch Binder","article-notebook-label":"Article Notebook","notebook-preview-download":"Download Notebook","notebook-preview-download-src":"Download Source","notebook-preview-back":"Back to Article","manuscript-meca-bundle":"MECA Bundle","section-title-abstract":"Abstract","section-title-appendices":"Appendices","section-title-footnotes":"Footnotes","section-title-references":"References","section-title-reuse":"Reuse","section-title-copyright":"Copyright","section-title-citation":"Citation","appendix-attribution-cite-as":"For attribution, please cite this work as:","appendix-attribution-bibtex":"BibTeX citation:","title-block-author-single":"Author","title-block-author-plural":"Authors","title-block-affiliation-single":"Affiliation","title-block-affiliation-plural":"Affiliations","title-block-published":"Published","title-block-modified":"Modified","title-block-keywords":"Keywords","callout-tip-title":"Tip","callout-note-title":"Note","callout-warning-title":"Warning","callout-important-title":"Important","callout-caution-title":"Caution","code-summary":"Code","code-tools-menu-caption":"Code","code-tools-show-all-code":"Show All Code","code-tools-hide-all-code":"Hide All Code","code-tools-view-source":"View Source","code-tools-source-code":"Source Code","tools-share":"Share","tools-download":"Download","code-line":"Line","code-lines":"Lines","copy-button-tooltip":"Copy to Clipboard","copy-button-tooltip-success":"Copied!","repo-action-links-edit":"Edit this page","repo-action-links-source":"View source","repo-action-links-issue":"Report an issue","back-to-top":"Back to top","search-no-results-text":"No results","search-matching-documents-text":"matching documents","search-copy-link-title":"Copy link to search","search-hide-matches-text":"Hide additional matches","search-more-match-text":"more match in this document","search-more-matches-text":"more matches in this document","search-clear-button-title":"Clear","search-text-placeholder":"","search-detached-cancel-button-title":"Cancel","search-submit-button-title":"Submit","search-label":"Search","toggle-section":"Toggle section","toggle-sidebar":"Toggle sidebar navigation","toggle-dark-mode":"Toggle dark mode","toggle-reader-mode":"Toggle reader mode","toggle-navigation":"Toggle navigation","crossref-fig-title":"Figure","crossref-tbl-title":"Table","crossref-lst-title":"Listing","crossref-thm-title":"Theorem","crossref-lem-title":"Lemma","crossref-cor-title":"Corollary","crossref-prp-title":"Proposition","crossref-cnj-title":"Conjecture","crossref-def-title":"Definition","crossref-exm-title":"Example","crossref-exr-title":"Exercise","crossref-ch-prefix":"Chapter","crossref-apx-prefix":"Appendix","crossref-sec-prefix":"Section","crossref-eq-prefix":"Equation","crossref-lof-title":"List of Figures","crossref-lot-title":"List of Tables","crossref-lol-title":"List of Listings","environment-proof-title":"Proof","environment-remark-title":"Remark","environment-solution-title":"Solution","listing-page-order-by":"Order By","listing-page-order-by-default":"Default","listing-page-order-by-date-asc":"Oldest","listing-page-order-by-date-desc":"Newest","listing-page-order-by-number-desc":"High to Low","listing-page-order-by-number-asc":"Low to High","listing-page-field-date":"Date","listing-page-field-title":"Title","listing-page-field-description":"Description","listing-page-field-author":"Author","listing-page-field-filename":"File Name","listing-page-field-filemodified":"Modified","listing-page-field-subtitle":"Subtitle","listing-page-field-readingtime":"Reading Time","listing-page-field-wordcount":"Word Count","listing-page-field-categories":"Categories","listing-page-minutes-compact":"{0} min","listing-page-category-all":"All","listing-page-no-matches":"No matching items","listing-page-words":"{0} words"},"metadata":{"lang":"en","fig-responsive":true,"quarto-version":"1.4.543","theme":{"light":["cosmo","../../../theme.scss"],"dark":["cosmo","../../../theme-dark.scss"]},"code-copy":true,"grid":{"sidebar-width":"200px","body-width":"1200px","margin-width":"200px"},"title":"EDA","subtitle":"Explorative Data Analysis","description":"EDA was conducted to explore and figure out the characteristics of data using some statistical methods","author":"Kwangmin Kim","date":"2023-02-18","page-layout":"full"},"extensions":{"book":{"multiFile":true}}}},"projectFormats":["html"]}