{"title":"ANOVA","markdown":{"yaml":{"title":"ANOVA","subtitle":"ANOVA, one-way ANOVA, Two-way ANOVA, ANCOVA, repeated measures ANOVA, MANOVA","description":"The analysis of variance (ANOVA) is one of the most widely used statistical techniques. When we conduct a comparison testing of multiple groups such as A, B, and C on each with numeric data, the statistical test for a significant difference among the groups is called analysis of variance, or ANOVA.\n","categories":["Statistics"],"author":"Kwangmin Kim","date":"01/07/2023","draft":true,"format":{"html":{"toc":true,"number-sections":true,"code-fold":true,"page-layout":"full"}},"execute":{"warning":false,"message":false}},"headingText":"Statistical Methods Similar to ANOVA","containsRefs":false,"markdown":"\n\n(**draft**)\n\n\n-   2023-01-27, [repeated measures ANOVA](../2023-01-27_rmANOVA/index.qmd)\n-   2023-01-27, [ANCOVA](../2023-01-27_ANCOVA/index.qmd)\n-   2023-01-28, [MANOVA](../2023-01-28_MANOVA/index.qmd)\n\n<ul class=\"nav nav-pills\" id=\"language-tab\" role=\"tablist\">\n\n<li class=\"nav-item\" role=\"presentation\">\n\n<button class=\"nav-link active\" id=\"Korean-tab\" data-bs-toggle=\"tab\" data-bs-target=\"#Korean\" type=\"button\" role=\"tab\" aria-controls=\"Korean\" aria-selected=\"true\">\n\nKorean\n\n</button>\n\n</li>\n\n<li class=\"nav-item\" role=\"presentation\">\n\n<button class=\"nav-link\" id=\"English-tab\" data-bs-toggle=\"tab\" data-bs-target=\"#English\" type=\"button\" role=\"tab\" aria-controls=\"knitr\" aria-selected=\"false\">\n\nEnglish\n\n</button>\n\n</li>\n\n<div class=\"tab-content\" id=\"language-tabcontent\">\n\n::: {#Korean .tab-pane .fade .show .active role=\"tabpanel\" aria-labelledby=\"Korean-tab\"}\n\n```{r}\n#| echo: false\n\nif(grepl('kkm',getwd())){\n    datapath=\"C:/Users/kkm/Desktop/projects/website/docs/data/anova_data.csv\"\n}else{\n    datapath=\"C:/Users/kmkim/Desktop/projects/website/docs/data/anova_data.csv\"\n}\n\n\n```\n\n\n### Description\n\nANOVA는 **3개 이상의 모집단** 사이의 **평균**의 동일성을 검정하는 통계 분석 방법이다.\n\n-   일원 분산 분석 (One-way ANOVA)\n    -   그룹을 구분하는 변수가 1개\n    -   Between-Groups one-way ANOVA(집단간 일원분산분석): 관측치를 grouping하는 범주형 변수가 **1개**이며 각 관측치는 범주형 변수에 의해 구분되는 그룹들 가운데 반드시 하나에만 할당되어야한다. 즉, 어떠한 경우에도 하나의 관측치 또는 샘플이 여러 groups에 동시에 들어가면 안된다. 이 때 이렇게 그룹을 나누는 범주형 변수를 집단간 요인이라고 한다.\n    -   Within-groups one-way ANOVA (집단 내 일원분산분석) or repeated measures ANOVA: 시간과 같은 하나의 범주형 변수로 샘플들을 측정한다. 시간의 경과에 따라 측정된 샘플들을 범주형 변수의 여러 기간에 걸쳐 모두 할당시킨다. 즉, 하나의 샘플이 여러 그룹에 다른 측정치로 관찰될 수 있다. 예를들어, sample A가 4주, 8주, 12주, 16주 그룹에 모두 측정 된다. 이때 기간변수는 집단 내 요인이라고 부른다.\n-   이원 분산 분석 (Two-way ANOVA)\n    -   집단을 구분하는 변수가 2개이며 각 집단 간 요인과 집단 내 요인을 나타낸다.\n    -   이원 분석 부터는 main effect와 interaction effect가 존재한다.\n    -   범주형 변수 A와 범주형 변수 B의 Main effect 계산\n    -   범주형 변수 A와 범주형 변수 B의 상호 작용 효과 or 교호 작용 효과 (Interaction effect) 계산\n    -   group을 구분하는 독립변수가 2개 일때 모집단 간 평균의 동일성 검정\\\n    -   2개의 주효과(main effect) 검정: 각 독립 변수에 의해 만들어지는 집단 간 평균의 차이에 대한 검정\n        -   먼저, 두 독립변수가 종속변수에 개별적으로 영향을 미치는지 검정\\\n    -   1개의 상호작용효과(interaction effect) 검정: 두 독립 변수의 조합에 의해 만들어지는 집단 간 평균의 차이에 대한 검정\n        -   두 독립변수의 조합이 종속변수와 유의한 영향관계를 갖는지 검정\\\n        -   만약에 유의하다면 2개의 독립변수가 합쳐져서 나온 파생효과이기 때문에 1개만 골라서 분석해서 해석 할 수 없음\n\n### How to conduct ANOVA?\n\n-   분산 분석은 F검정(F test)을 통해 수행한다.\n-   F 검정은 **집단 간 분산** (between-groups variability)과 **집단 내 분산** (within-groups variability)의 **ratio**로 계산된 F값 (F value or F statistic)을 토대로 가설검정을 수행한다. 이때 F value or F statistic을 통계 검정을 위한 검정통계량 (test statistic) 라고 부른다.\n-   F 검정 결과가 통계적으로 유의하면 집단 간 평균의 차이가 존재한다. (즉, 독립 변수가 종속변수에 영향을 미침)\n-   F 분포 2개의 자유도에 의해 분포의 모양이 결정되며 대체로 오른쪽으로 긴 꼬리를 갖는다\n    -   첫 번째 자유도: 집단 간(between-group)의 자유도\n    -   두 번째 자유도: 집단 내(within-group)의 자유도\n\n```{r}\nlibrary(tidyverse)\nlibrary(ggpubr)\nlibrary(gplots)\nlibrary(rmarkdown)\nknitr::opts_chunk$set(echo = FALSE, message = FALSE, warning = FALSE)\noptions(digits = 5)\nset.seed(20230109)\n```\n\n```{r}\n  # 나중에 제대로 그려야함 귀찮...\n  hist(rf(1000,df1=5,df=50),breaks=30, main=\"Histogram, Example of F Distribution\", xlab= \"F-values\", ylab=\"Frequency\")\n  #pf(9.59,df1=1,df2=8, lower.tail = FALSE)#특정 F값에 대응되는 확률값 산출,df1=집단간분산의 자유도, df2= 집단내 분산의 자유도도, 9.59 이상일 확률을 계산해야함\n  #qf(0.05, df=1,df2=8, lower.tail = FALSE) # 특정 확률에 대응되는 F값을 산출, 5.317<9.59 \n```\n\n종속 변수의 변동성은 다음과 같이 설명되기 때문에 아래의 식을 만족한다.\n\n$$SS_{total}=SS_A+SS_B+SS_{AB}+SS_{error}$$\n\n$SS_{total}$은 쉽게 구할 수 있고 $SS_A$, $SS_B$, $SS_{error}$를 계산하여 빼준다.\n\n[Two Way Anova SS 계산 공식 링크](http://atomic.phys.uni-sofia.bg/local/nist-e-handbook/e-handbook/prc/section4/prc437.htm)\n\n$SS_{AB}$ 즉,\n\n$$ SS_{AB}=SS_{total}-SS_A-SS_B-SS_{error} $$\n\n### Meaning\n\nANOVA는 집단 간 분산과 집단 내 분산의 비교하는 방식으로, 좀 더 구체적으로는 집단 간 분산과 집단 내 분산의 비를 계산하여, 집단 간 분산이 클수록 그리고 집단 분산이 작을 수록 집단 평균이 다를 가능성이 증가한다는 알고리즘에 기초한다.\n\n## Application to Example\n\n### Data Description\n\n#### Raw Data\n\n(...민감 정보 제거 및 데이터 변환 후 컨설팅 내용 일부 발췌...)\n\n```{r}\n#| echo: false\n\nraw_data=read.csv(datapath)%>%\n    mutate(response=((100-1)*(Ct-min(Ct,na.rm=TRUE))/(max(Ct,na.rm=TRUE)-min(Ct,na.rm=T))+1))%>%\n    dplyr::select(-sample,-Ct)\n```\n\nexample data는 `r names(raw_data)`의 변수들을 포함하고 있습니다. 공유해주신 정보에 따르면 아마도 Run은 오전과 오후를 나누는 변수인 것으로 생각 됩니다. 이 data만 보면 아마도 같은 샘플에 대해서 시약 제품이 시간에 따라 얼마나 안정적인 performance를 보여주는지 검사하는 실험으로 추측됩니다. 좀 더 분석하기 용이한 형태로 data structure를 바꾸겠습니다.\n\n#### Processed Data\n\n```{r data_load}\ndata=raw_data%>%\n    mutate(id=1:n())%>%\n    rename(noon=Run)%>%\n    group_by(Day,noon)%>%\n    mutate(Run=1:n(),\n           Day=factor(Day,levels=c(1:20)),\n           noon=ifelse(noon==1,\"AM\",\"PM\"),\n           noon=factor(noon,levels = c(\"AM\",\"PM\")))%>%\n    dplyr::select(id,Day,noon,Run,response)%>%\n    ungroup\npaged_table(data)\n```\n\n재가공된 data는 `r dim(data)[1]`개의 샘플과 `r dim(data)[2]`개의 변수를 갖고있습니다. 변수 목록은 다음과 같습니다.\n\n-   `r names(data)[1]`: 열번호, 총 20일간 하루 2회 구동(AM, PM) 구동, 오전 오후 각 각 3번씩 구동 총 120 $(=20 \\times 3 \\times 2)$ 샘플\\\n-   `r names(data)[2]`: Day1\\~20\\\n-   `r names(data)[3]`: `r pull(unique(data[3]))[1]`= before noon, `r pull(unique(data[3]))[2]`= after noon\n-   `r names(data)[4]`: 1회 구동당 3번 반복씩`r pull(unique(data[4]))`\\\n-   `r names(data)[5]`: response variable, 낮을 수록 좋음\n\nANOVA의 Assumption\n\n-   response variable should follow normal distribution.\\\n-   homoscedasticity, equality of variance: 각 집단의 분포는 모두 동일한 분산을 가짐\\\n    ANOVA의 가정들을 반드시 충족하지 않아도 되지만 충족하면 Power 가 올라감\n\n### EDA (Explorator Data Analysis)\n\n이 data는 아래 처럼 `r sum(is.na(data))`의 결측치를 갖고 있습니다.\n\n```{r}\ndata%>%filter(is.na(response))%>%knitr::kable()\n```\n\nCt에 대한 Global Statistics는 다음과 같습니다.\n\n```{r}\nglobal_data=data%>%na.omit()%>%\n    summarise(count=n(),\n              global_response_mean=mean(response,na.rm=T),\n              global_response_sd=sd(response,na.rm=T),\n              global_response_CV=paste(round(global_response_sd/global_response_mean*100,3),\"%\"))\nglobal_data%>%knitr::kable()\n\n```\n\nDay groups의 Statistics은 다음과 같습니다.\n\n```{r}\n# Day groups\nday_data=data%>%na.omit()%>%\n    group_by(Day)%>%\n    summarise(count=n(),\n              Day_group_response_mean=mean(response,na.rm=T),\n              Day_group_response_sd=sd(response,na.rm=T),\n              Day_group_response_CV=paste(round(Day_group_response_sd/Day_group_response_mean*100,3),\"%\"))\n#day_data%>%knitr::kable()\nday_data%>%paged_table\n```\n\nAM/PM groups의 Statistics은 다음과 같습니다.\n\n```{r}\n# noon groups\nnoon_data=data%>%na.omit()%>%\n    group_by(noon)%>%\n    summarise(count=n(),\n              noon_group_response_mean=mean(response,na.rm=T),\n              noon_group_response_sd=sd(response,na.rm=T),\n              noon_group_response_CV=paste(round(noon_group_response_sd/noon_group_response_mean*100,3),\"%\"))\nnoon_data%>%paged_table\n```\n\nDays와 AM/PM 조합 groups의 Statistics은 다음과 같습니다.\n\n```{r}\n# Days & noon groups\nday_noon_data=data%>%na.omit()%>%\n    group_by(Day,noon)%>%\n    summarise(count=n(),\n              combi_group_response_mean=mean(response,na.rm=T),\n            combi_group_response_sd=sd(response,na.rm=T),\n        combi_group_response_CV=paste(round(combi_group_response_sd/combi_group_response_mean*100,3),\"%\"))%>%\n    ungroup\n\nday_noon_data%>%paged_table\n```\n\n이제 ANOVA를 수행하기 위한 basic statistics는 모두 구했습니다. ANOVA를 수행하기 위해 집단 간 분산과 집단 내 분산을 계산하도록 하겠습니다.\n\n### 집단 간 분산\n\n앞에서 설명 드린바로 유추해보면 예시 data의 집단 간 분산의 범주형 변수는 Day로 설정하는 것이 합리적인 것으로 보입니다.\n\n-   $g=g$ Day의 sample size = 20, 자유도 = 20-1 = 19 입니다.\n-   $n_g=g$ group의 sample size, $\\overline{X}_g=g$ 의 sample mean은 다음과 같습니다.\n-   $\\overline{X}$ = global sample mean = `r global_data$global_response_mean`\n-   집단 간 분산: $\\frac{집단 간 제곱합}{자유도}=\\frac{\\sum_g[(\\overline{X}_g-\\overline{X})^2n_g]}{g-1}$\n\n#### SS_Day (집단간 분산 Day)\n\nDay sq = $[(\\overline{X}_g-\\overline{X})^2n_g]$ 집단(Day)간 분산 계산, 집단(Day)간 분산 = $\\frac{\\sum_g[(\\overline{X}_g-\\overline{X})^2n_g]}{g-1}$\n\n```{r}\ntemp1=day_data%>%\n    ungroup%>%\n    mutate(day_sq=(Day_group_response_mean-global_data$global_response_mean)^2*count)%>%\n    mutate(sum_day_ssq=sum(day_sq),\n              df=(dim(day_data)[1]-1),\n              day_mean_ssq=sum_day_ssq/df,\n              day_sd=sqrt(day_mean_ssq))\ntemp1%>%paged_table\n\n\n```\n\nAnalysis-In program의 ANOVA결과값과 일치하는 것을 볼 수 있습니다. \\$SS\\_{day} \\$= `r unique(temp1$sum_day_ssq)` with $df=19$.\n\n#### SS_noon (집단간 분산 noon)\n\nnoon sq = $[(\\overline{X}_g-\\overline{X})^2n_g]$ 집단(noon)간 분산 계산, 집단(noon)간 분산 = $\\frac{\\sum_g[(\\overline{X}_g-\\overline{X})^2n_g]}{g-1}$\n\n```{r}\ntemp2=noon_data%>%\n    mutate(noon_sq=(noon_group_response_mean-global_data$global_response_mean)^2*count)%>%\n    mutate(sum_noon_ssq=sum(noon_sq),\n              df=(dim(noon_data)[1]-1),\n              noon_mean_ssq=sum_noon_ssq/df,\n              noon_sd=sqrt(noon_mean_ssq))\ntemp2%>%paged_table\n\n```\n\nAnalysis-In program의 결과에서 찾아 볼 수 없죠? 이 결과는 숨어 있습니다. 상호 작용에 대한 분산값을 구하고 나면 정체를 알 수 있습니다.\n\n$SS_{noon}$ = `r unique(temp2$sum_noon_ssq)` with $df=1$.\n\n#### SS_error (집단내 분산)\n\n-   집단 내 분산 (within-groups variability)\n\n```{r}\n##group_by noon\n\ntemp3=data%>%\n    na.omit%>%\n    inner_join(.,day_noon_data,by=c(\"Day\",\"noon\"))%>%\n    dplyr::select(-id,-combi_group_response_sd ,-combi_group_response_CV)%>%\n    mutate(residual_sq=(response-combi_group_response_mean)^2,\n           df=nrow(data)-nrow(day_data)*nrow(noon_data)-1,\n           residual_ssq=sum(residual_sq),\n           mean_residual_ssq=residual_ssq/df)\n\ntemp3%>%paged_table\n\n```\n\n$SS_{error}$ = `r unique(temp3$residual_ssq)`\n\nAnalysis-In program의 결과와 일치하는 것을 확인할 수 있습니다.\n\n#### SS_total\n\n```{r}\ntemp4=data%>%\n    na.omit%>%\n    mutate(total_ssq=sum((response-global_data$global_response_mean)^2))\ntemp4%>%paged_table\n```\n\n$SS_{total}$ = `r unique(temp4$total_ssq)`\n\nAnalysis-In program의 ANOVA 결과 table에 있는 SS들의 합과 일치하는 것을 확인할 수 있습니다.\n\n#### 상호 작용 분산\n\n```{r}\ntemp5=unique(temp4$total_ssq)-unique(temp3$residual_ssq)-unique(temp2$sum_noon_ssq)-unique(temp1$sum_day_ssq)\n\n```\n\n$SS_{interaction}=SS_{DayNoon}= SS_{total}-SS_{Day}-SS_{noon}-SS_{error}$   \n= `r unique(temp4$total_ssq)`-`r unique(temp3$residual_ssq)`-`r unique(temp2$sum_noon_ssq)`-`r unique(temp1$sum_day_ssq)` = `r temp5`\n\nAnalysis-In program의 ANOVA 결과 table과 일치하는 것을 확인할 수 있습니다.\n\n위의 결과들을 종합하면 아래와 같이 요약됩니다.\n\n```{r}\naov(response~Day*noon,data=data)%>%summary()\n```\n\n-   Repeatability SD = $\\sqrt{V_{error}}=\\sqrt{MS_{error}}$ = `r sqrt(unique(temp3$residual_ssq)/unique(temp3$df))`\n-   Repeatability CV = $\\frac{repeatability \\space SD}{global \\space mean \\space response}$ = `r sqrt(unique(temp3$residual_ssq)/unique(temp3$df)) /global_data$global_response_mean`\n\n위의 결과를 간단히 해석해 보면\n\n-   집단간 범주 변수인 Day는 p-value =0.29\\>0.05 이므로 5% 유의 수준에서, 유의하지 않습니다.\n    -   즉, 5% 유의 수준에서, 일별로 평균 response값이 같다는 가설을 기각하는데 실패했습니다.\n    -   다시 말하면, 5% 유의 수준에서, 일별로 평균 response값이 다르지 않습니다.\n-   집단간 범주 변수인 noon은 p-value =0.30\\>0.05 이므로 5% 유의 수준에서, 유의하지 않습니다.\n    -   즉, 5% 유의 수준에서, 오전/오후별 평균 response값이 같다는 가설을 기각하는데 실패했습니다.\n    -   다시 말하면, 5% 유의 수준에서, 오전/오후별 평균 response값이 다르지 않습니다.\n-   Day와 noon두 변수의 상호작용 변수는 p-value =0.16\\>0.05 이므로 5% 유의 수준에서, 유의하지 않습니다.\n    -   즉, 5% 유의 수준에서, Day별 Noon(오전/오후)별 평균 response값이 같다는 가설을 기각하는데 실패했습니다.\n    -   다시 말하면, 5% 유의 수준에서, Day별 Noon(오전/오후)별 평균 response값이 다르지 않습니다.\n\n최종 결론, 제품의 response값이 Day별 오전/오후별 안정적인 performance를 보인다고 조심스럽게 결론을 내릴 수 있습니다.\n\n이제 까지는 질문에 대한 답이 되는 ANOVA의 원리 및 통계량의 재현 및 해석법에 대하여 알아봤습니다. 하지만 직관적으로 어떤 의미가 있을 까요? 원래는 시각화를 통해 데이터의 패턴을 짐작하고 통계 검정 결과를 예상하는데 우리는 반대로 가고 있네요 ㅎㅎ 시각화를 통해 ANOVA 결과가 얼마나 직관적인지 알아보겠습니다.\n\n### Visualization\n\n#### One-way: Day\n\n```{r}\nplotmeans(response~Day,data=data,\n          barcol=\"orange\",\n          barwidth = 2,\n          col=\"blue\",lwd=2,\n          xlab=\"Day\",\n          ylab=\"response\",\n          main=\"response in Daily Average with 95% Confidence Interval\")\nggplot(data, aes(x=Day, y=response)) + \n  geom_boxplot(outlier.colour=\"red\", \n               outlier.shape=8,\n                outlier.size=4)\n```\n\n자세히 보면 일별로 시간의 경과에 따라 전체적으로 평균 response값이 약간 하향하는 것으로 보입니다. 하지만 좀 더 세부적으로 관찰하면 1일\\~8일 평균 response의 경향이 constant한 패턴을 보입니다. 9일\\~13일 평균 response가 진동 하향하는 패턴을 보입니다. 14일\\~20일 평균 response가 상향하는 패턴을 보입니다.\n\n```{r}\nmodel1<-aov(data=data,response~Day)\nmodel.tables(model1,type=\"mean\") # 전체 평균과 집단 평균을 볼수 있음\nmodel.tables(model1,type=\"effects\") # 각 집단 평균과 전체 평균의 차이를 볼 수 있음\n```\n\n위에 첫 번째표에서 Global Sample response Mean = 38.727 과 **각 집단의 평균** response를 확인할 수 있습니다. 위에 두 번째표에서 Global Sample response Mean = 37.322 과 **각 집단의 평균 response의 차이**를 확인할 수 있습니다.\n\n-   Day 9에서 차이가 가장 큰 것으로 보아 9일째 실험에서 performance가 가장 낮은 것이 관측됐습니다.\n-   반대로, 12일에 performance 가장 좋은 것으로 관측됐습니다.\n\n9일과 12일에 response값에 영향을 미쳤던 요인이 있었는지 복기 하는것도 도움이 되겠군요.\n\n```{r}\n# Anova: Day\n\nsummary(model1)\n```\n\nOne-way ANOVA의 결과값입니다. Day별 평균 response의 차이는 거의 없는 것으로 보입니다. 따라서 Day 별 평균 response의 경향이 일관되지 않고 One-way ANOVA에서 역시 통계적으로 유의하지 않아 Day 변수는 평균 response에 영향을 미치지 않는 것 같습니다.\n\n#### One-way: AM/PM\n\n```{r}\nplotmeans(response~noon,data=data,\n          barcol=\"orange\",\n          barwidth = 3,\n          col=\"blue\",lwd=2,\n          xlab=\"AM/PM\",\n          ylab=\"response\",\n          main=\"response in Before/After Noon Average with 95% Confidence Interval\")\n\nggplot(data, aes(x=noon, y=response)) + \n  geom_boxplot(outlier.colour=\"red\", \n               outlier.shape=8,\n                outlier.size=4)\n```\n\n오후에 시간의 경과에 따라 전체적으로 평균 response값이 약간 하향하는 것으로 보입니다.\n\n```{r}\nmodel2<-aov(data=data,response~noon)\n# 개별 집단 차이를 볼수 있음\nmodel.tables(model2,type=\"mean\") # 전체 평균과 집단 평균을 볼수 있음\nmodel.tables(model2,type=\"effects\") # 각 집단 평균과 전체 평균의 차이를 볼 수 있음\n\n```\n\n위 첫 번째 표에서 AM/PM 간의 평균 response차이는 0.15 (농도가 약 0.5배) 차이가 나는 것을 확인할 수 있습니다. 생물학적으로 의미가 있는 수치일까요? 위 두 번째 표에서 Global Sample Mean 37.322와 오전/오후 별 약 0.07씩(농도가 약 0.25배) 차이가 납니다.\n\n```{r}\n# Anova: Day\nsummary(model2)\n```\n\n오전 오후별 One way ANOVA를 실행한 결과가 오전/오부 평균 response값의 차이가 다르지 않다는 것을 시사하고 있습니다. 아무래도 위의 차이는 우연에 의해 발생한 현상인 것 같습니다.\n\n```{r}\n#| fig-height: 10\n\ntukey<-TukeyHSD(model1)\nplot(tukey,col=\"blue\", las=1)\n# 가로선은 95% 신뢰구간을 표현하고 0을 포함하지 않으면 통계적으로 유의하다고 할 수 있다.\n\n```\n\n일별로 평균 response값이 차이를 모든 경우의 수에서 차이가 나는지 확인한 결과 신뢰구간 모두가 0을 포함하고 있으므로 Day 변수는 유의하다고 볼 수 없습니다.\n\n```{r}\n\n\ntukey<-TukeyHSD(model2)\nplot(tukey,col=\"blue\", las=1)\n\n\n```\n\n오전/오후별로 평균 response값이 차이를 모든 경우의 수에서 차이가 나는지 확인한 결과 신뢰구간 모두가 0을 포함하고 있으므로 오전/오후 변수는 유의하다고 볼 수 없습니다.\n\n여기 까지 각 변수별 평균 response로의 영향도를 통계적으로 시각적으로 관찰했습니다. 하지만 Day별 오전/오후별 영향도가 있는지 확인하겠습니다. (이미 위에서 통계적으로 없다고 검정됐습니다.)\n\n### Two way Anova\n\n```{r}\n# data를 여러번 적을 필요가없음\nwith(data,tapply(response, list(Day,noon),function(x)mean(x,na.rm=TRUE)))\nwith(data,tapply(response, list(Day,noon),function(x)sd(x,na.rm=TRUE)))\n```\n\n```{r}\nmodel3<-aov(response~Day*noon,data=data)\nmodel3<-aov(response~Day+noon+Day:noon,data=data)\n\n\nmodel.tables(model3,type=\"means\")\nmodel.tables(model3,type=\"effect\")\n```\n\none way ANOVA와 같이 해석\n\n```{r}\nboxplot(response~Day*noon,data=data,col=c(\"darkred\",\"darkblue\"),\n        las=1,xlab=\"Interaction of Day and Noon\",main = \"Effects of Day and Noon on response Values\")\ninteraction.plot(x.factor=data$Day,trace.factor = data$noon,response=data$response,trace.label=\"noon\",las=1,type=\"b\",pch=c(1,19),\n                 xlab=\"Day\", ylab=\"response\",col=c(\"darkred\",\"darkblue\"),\n                 main=\"Interaction Plot for response\")\n#interaction(data$Day,data$noon,sep=\" \")\nplotmeans(response~interaction(Day,noon,sep=\" \"),\n          data=data,col=c(\"darkred\",\"darkblue\"),\n          xlab=\"Combination of Day and Noon\",ylab=\"response\", main=\"Means plot for response\")\nplotmeans(response~interaction(Day,noon,sep=\" \"),\n          data=data,col=c(\"darkred\",\"darkblue\"),\n          connect=list(seq(1,39,by=2),seq(2,40,by=2))\n          ,xlab=\"Combination of Day and Noon\",ylab=\"response\", main=\"Means plot for AM, PM\")\nsummary(model3)\n```\n\n위 그림을 보듯이 두 변수의 영향도가 없음, ANOVA 역시 유의하지 않음\n\n```{r}\n#| fig-height: 10\n\n## 조건부 도표: coplot 2개의 집단 변수 중 1개의 집단 변수가 나머지 집단 변수와 종속변수에 관한 관계를 산점저로 표현\ncoplot(response~noon|Day,data=data,col=\"darkred\",pch=19,panel=panel.smooth,lwd=2,col.smooth=\"darkblue\",xlab=\"AM/PM\", ylab=\"response\")\n## 오전 오후와 Ct값의 관계를 볼수 있다.\n\n##주효과와 상호 작용 효과를 각각의 별도의 패널에서 볼수 있음\nlibrary(HH)\ninteraction2wt(response~noon*Day,data=data)\n#(2,1),(1,2) -> main effect expression\n#(1,1),(2,2) -> interaction effect expression\n\n## 대립 가설이 참일때만 사후 검정 추가 실시 할 수 있음\n\nTukeyHSD(model3)\n\nTukeyHSD(model3,which=c(\"Day\"),conf.level=0.99)\n```\n\n유의한 패턴 없음 Tukey 검정 결과 (보통 유의할때 함) 테이블 도 유의한 수치가 없음\n:::\n\n::: {#English .tab-pane .fade role=\"tabpanel\" aria-labelledby=\"English-tab\"}\n\n## Terms\n\n-   pairwise comparison: A hypothesis test (e.g., of means) between two groups among multiple groups.\n-   obmnibus set: A single hypothesis test of the overall variance among multiple group means.\n-   decomposition of variance : Separation of components contributing to an individual value (e.g., from the overall average, from a treatment mean, and from a residual error).\n-   F-test\n-   F statistic: A standardized statistic that measures the extent to which differences among group means exceed what might be expected in a chance model.\n-   sum of squares: deviations from some average value\n\n## ANOVA\n\nA basic idea of the ANOVA is to partition variation. It is not concerend with analyzing variances but with analyzing variation in means. To be specific, it is a method of estimating the means of several populations that are often assumed to be normally distributed. \n\n### One Way ANOVA\n\n* we \n* Assumptions\n\n$$ Y_{ij}=\\mu_i + \\epsilon_{ij}, \\space \\space i=1, ..., k, \\space j=1, ...,n_i $$\n$$ EY_{ij}=\\mu_i, \\space \\space , i=1, ..., k, \\space j=1, ...,n_i $$\n\nwhere the $\\mu_i$ are unkown parameters and the $\\epsilon_{ij}$ are error random variables.\n\n1. $\\text{E}\\epsilon_{ij}=0$, $\\text{Var}\\epsilon_{ij}=0<\\infty$, for all $i, j$\n1. $\\text{Cov}(\\epsilon_{ij},\\epsilon_{i'j'})=0$, for all $i, i', j$, and $j'$ unless $i=i'$ and $j=j'$.\n1. The $\\epsilon_{ij}$ are independent and normally distributed (normal errors).\n1. $\\sigma^2_{i}=\\sigma^2$ for all $i$ (homoscedasticity)\n:::\n","srcMarkdownNoYaml":"\n\n(**draft**)\n\n## Statistical Methods Similar to ANOVA\n\n-   2023-01-27, [repeated measures ANOVA](../2023-01-27_rmANOVA/index.qmd)\n-   2023-01-27, [ANCOVA](../2023-01-27_ANCOVA/index.qmd)\n-   2023-01-28, [MANOVA](../2023-01-28_MANOVA/index.qmd)\n\n<ul class=\"nav nav-pills\" id=\"language-tab\" role=\"tablist\">\n\n<li class=\"nav-item\" role=\"presentation\">\n\n<button class=\"nav-link active\" id=\"Korean-tab\" data-bs-toggle=\"tab\" data-bs-target=\"#Korean\" type=\"button\" role=\"tab\" aria-controls=\"Korean\" aria-selected=\"true\">\n\nKorean\n\n</button>\n\n</li>\n\n<li class=\"nav-item\" role=\"presentation\">\n\n<button class=\"nav-link\" id=\"English-tab\" data-bs-toggle=\"tab\" data-bs-target=\"#English\" type=\"button\" role=\"tab\" aria-controls=\"knitr\" aria-selected=\"false\">\n\nEnglish\n\n</button>\n\n</li>\n\n<div class=\"tab-content\" id=\"language-tabcontent\">\n\n::: {#Korean .tab-pane .fade .show .active role=\"tabpanel\" aria-labelledby=\"Korean-tab\"}\n\n```{r}\n#| echo: false\n\nif(grepl('kkm',getwd())){\n    datapath=\"C:/Users/kkm/Desktop/projects/website/docs/data/anova_data.csv\"\n}else{\n    datapath=\"C:/Users/kmkim/Desktop/projects/website/docs/data/anova_data.csv\"\n}\n\n\n```\n\n\n### Description\n\nANOVA는 **3개 이상의 모집단** 사이의 **평균**의 동일성을 검정하는 통계 분석 방법이다.\n\n-   일원 분산 분석 (One-way ANOVA)\n    -   그룹을 구분하는 변수가 1개\n    -   Between-Groups one-way ANOVA(집단간 일원분산분석): 관측치를 grouping하는 범주형 변수가 **1개**이며 각 관측치는 범주형 변수에 의해 구분되는 그룹들 가운데 반드시 하나에만 할당되어야한다. 즉, 어떠한 경우에도 하나의 관측치 또는 샘플이 여러 groups에 동시에 들어가면 안된다. 이 때 이렇게 그룹을 나누는 범주형 변수를 집단간 요인이라고 한다.\n    -   Within-groups one-way ANOVA (집단 내 일원분산분석) or repeated measures ANOVA: 시간과 같은 하나의 범주형 변수로 샘플들을 측정한다. 시간의 경과에 따라 측정된 샘플들을 범주형 변수의 여러 기간에 걸쳐 모두 할당시킨다. 즉, 하나의 샘플이 여러 그룹에 다른 측정치로 관찰될 수 있다. 예를들어, sample A가 4주, 8주, 12주, 16주 그룹에 모두 측정 된다. 이때 기간변수는 집단 내 요인이라고 부른다.\n-   이원 분산 분석 (Two-way ANOVA)\n    -   집단을 구분하는 변수가 2개이며 각 집단 간 요인과 집단 내 요인을 나타낸다.\n    -   이원 분석 부터는 main effect와 interaction effect가 존재한다.\n    -   범주형 변수 A와 범주형 변수 B의 Main effect 계산\n    -   범주형 변수 A와 범주형 변수 B의 상호 작용 효과 or 교호 작용 효과 (Interaction effect) 계산\n    -   group을 구분하는 독립변수가 2개 일때 모집단 간 평균의 동일성 검정\\\n    -   2개의 주효과(main effect) 검정: 각 독립 변수에 의해 만들어지는 집단 간 평균의 차이에 대한 검정\n        -   먼저, 두 독립변수가 종속변수에 개별적으로 영향을 미치는지 검정\\\n    -   1개의 상호작용효과(interaction effect) 검정: 두 독립 변수의 조합에 의해 만들어지는 집단 간 평균의 차이에 대한 검정\n        -   두 독립변수의 조합이 종속변수와 유의한 영향관계를 갖는지 검정\\\n        -   만약에 유의하다면 2개의 독립변수가 합쳐져서 나온 파생효과이기 때문에 1개만 골라서 분석해서 해석 할 수 없음\n\n### How to conduct ANOVA?\n\n-   분산 분석은 F검정(F test)을 통해 수행한다.\n-   F 검정은 **집단 간 분산** (between-groups variability)과 **집단 내 분산** (within-groups variability)의 **ratio**로 계산된 F값 (F value or F statistic)을 토대로 가설검정을 수행한다. 이때 F value or F statistic을 통계 검정을 위한 검정통계량 (test statistic) 라고 부른다.\n-   F 검정 결과가 통계적으로 유의하면 집단 간 평균의 차이가 존재한다. (즉, 독립 변수가 종속변수에 영향을 미침)\n-   F 분포 2개의 자유도에 의해 분포의 모양이 결정되며 대체로 오른쪽으로 긴 꼬리를 갖는다\n    -   첫 번째 자유도: 집단 간(between-group)의 자유도\n    -   두 번째 자유도: 집단 내(within-group)의 자유도\n\n```{r}\nlibrary(tidyverse)\nlibrary(ggpubr)\nlibrary(gplots)\nlibrary(rmarkdown)\nknitr::opts_chunk$set(echo = FALSE, message = FALSE, warning = FALSE)\noptions(digits = 5)\nset.seed(20230109)\n```\n\n```{r}\n  # 나중에 제대로 그려야함 귀찮...\n  hist(rf(1000,df1=5,df=50),breaks=30, main=\"Histogram, Example of F Distribution\", xlab= \"F-values\", ylab=\"Frequency\")\n  #pf(9.59,df1=1,df2=8, lower.tail = FALSE)#특정 F값에 대응되는 확률값 산출,df1=집단간분산의 자유도, df2= 집단내 분산의 자유도도, 9.59 이상일 확률을 계산해야함\n  #qf(0.05, df=1,df2=8, lower.tail = FALSE) # 특정 확률에 대응되는 F값을 산출, 5.317<9.59 \n```\n\n종속 변수의 변동성은 다음과 같이 설명되기 때문에 아래의 식을 만족한다.\n\n$$SS_{total}=SS_A+SS_B+SS_{AB}+SS_{error}$$\n\n$SS_{total}$은 쉽게 구할 수 있고 $SS_A$, $SS_B$, $SS_{error}$를 계산하여 빼준다.\n\n[Two Way Anova SS 계산 공식 링크](http://atomic.phys.uni-sofia.bg/local/nist-e-handbook/e-handbook/prc/section4/prc437.htm)\n\n$SS_{AB}$ 즉,\n\n$$ SS_{AB}=SS_{total}-SS_A-SS_B-SS_{error} $$\n\n### Meaning\n\nANOVA는 집단 간 분산과 집단 내 분산의 비교하는 방식으로, 좀 더 구체적으로는 집단 간 분산과 집단 내 분산의 비를 계산하여, 집단 간 분산이 클수록 그리고 집단 분산이 작을 수록 집단 평균이 다를 가능성이 증가한다는 알고리즘에 기초한다.\n\n## Application to Example\n\n### Data Description\n\n#### Raw Data\n\n(...민감 정보 제거 및 데이터 변환 후 컨설팅 내용 일부 발췌...)\n\n```{r}\n#| echo: false\n\nraw_data=read.csv(datapath)%>%\n    mutate(response=((100-1)*(Ct-min(Ct,na.rm=TRUE))/(max(Ct,na.rm=TRUE)-min(Ct,na.rm=T))+1))%>%\n    dplyr::select(-sample,-Ct)\n```\n\nexample data는 `r names(raw_data)`의 변수들을 포함하고 있습니다. 공유해주신 정보에 따르면 아마도 Run은 오전과 오후를 나누는 변수인 것으로 생각 됩니다. 이 data만 보면 아마도 같은 샘플에 대해서 시약 제품이 시간에 따라 얼마나 안정적인 performance를 보여주는지 검사하는 실험으로 추측됩니다. 좀 더 분석하기 용이한 형태로 data structure를 바꾸겠습니다.\n\n#### Processed Data\n\n```{r data_load}\ndata=raw_data%>%\n    mutate(id=1:n())%>%\n    rename(noon=Run)%>%\n    group_by(Day,noon)%>%\n    mutate(Run=1:n(),\n           Day=factor(Day,levels=c(1:20)),\n           noon=ifelse(noon==1,\"AM\",\"PM\"),\n           noon=factor(noon,levels = c(\"AM\",\"PM\")))%>%\n    dplyr::select(id,Day,noon,Run,response)%>%\n    ungroup\npaged_table(data)\n```\n\n재가공된 data는 `r dim(data)[1]`개의 샘플과 `r dim(data)[2]`개의 변수를 갖고있습니다. 변수 목록은 다음과 같습니다.\n\n-   `r names(data)[1]`: 열번호, 총 20일간 하루 2회 구동(AM, PM) 구동, 오전 오후 각 각 3번씩 구동 총 120 $(=20 \\times 3 \\times 2)$ 샘플\\\n-   `r names(data)[2]`: Day1\\~20\\\n-   `r names(data)[3]`: `r pull(unique(data[3]))[1]`= before noon, `r pull(unique(data[3]))[2]`= after noon\n-   `r names(data)[4]`: 1회 구동당 3번 반복씩`r pull(unique(data[4]))`\\\n-   `r names(data)[5]`: response variable, 낮을 수록 좋음\n\nANOVA의 Assumption\n\n-   response variable should follow normal distribution.\\\n-   homoscedasticity, equality of variance: 각 집단의 분포는 모두 동일한 분산을 가짐\\\n    ANOVA의 가정들을 반드시 충족하지 않아도 되지만 충족하면 Power 가 올라감\n\n### EDA (Explorator Data Analysis)\n\n이 data는 아래 처럼 `r sum(is.na(data))`의 결측치를 갖고 있습니다.\n\n```{r}\ndata%>%filter(is.na(response))%>%knitr::kable()\n```\n\nCt에 대한 Global Statistics는 다음과 같습니다.\n\n```{r}\nglobal_data=data%>%na.omit()%>%\n    summarise(count=n(),\n              global_response_mean=mean(response,na.rm=T),\n              global_response_sd=sd(response,na.rm=T),\n              global_response_CV=paste(round(global_response_sd/global_response_mean*100,3),\"%\"))\nglobal_data%>%knitr::kable()\n\n```\n\nDay groups의 Statistics은 다음과 같습니다.\n\n```{r}\n# Day groups\nday_data=data%>%na.omit()%>%\n    group_by(Day)%>%\n    summarise(count=n(),\n              Day_group_response_mean=mean(response,na.rm=T),\n              Day_group_response_sd=sd(response,na.rm=T),\n              Day_group_response_CV=paste(round(Day_group_response_sd/Day_group_response_mean*100,3),\"%\"))\n#day_data%>%knitr::kable()\nday_data%>%paged_table\n```\n\nAM/PM groups의 Statistics은 다음과 같습니다.\n\n```{r}\n# noon groups\nnoon_data=data%>%na.omit()%>%\n    group_by(noon)%>%\n    summarise(count=n(),\n              noon_group_response_mean=mean(response,na.rm=T),\n              noon_group_response_sd=sd(response,na.rm=T),\n              noon_group_response_CV=paste(round(noon_group_response_sd/noon_group_response_mean*100,3),\"%\"))\nnoon_data%>%paged_table\n```\n\nDays와 AM/PM 조합 groups의 Statistics은 다음과 같습니다.\n\n```{r}\n# Days & noon groups\nday_noon_data=data%>%na.omit()%>%\n    group_by(Day,noon)%>%\n    summarise(count=n(),\n              combi_group_response_mean=mean(response,na.rm=T),\n            combi_group_response_sd=sd(response,na.rm=T),\n        combi_group_response_CV=paste(round(combi_group_response_sd/combi_group_response_mean*100,3),\"%\"))%>%\n    ungroup\n\nday_noon_data%>%paged_table\n```\n\n이제 ANOVA를 수행하기 위한 basic statistics는 모두 구했습니다. ANOVA를 수행하기 위해 집단 간 분산과 집단 내 분산을 계산하도록 하겠습니다.\n\n### 집단 간 분산\n\n앞에서 설명 드린바로 유추해보면 예시 data의 집단 간 분산의 범주형 변수는 Day로 설정하는 것이 합리적인 것으로 보입니다.\n\n-   $g=g$ Day의 sample size = 20, 자유도 = 20-1 = 19 입니다.\n-   $n_g=g$ group의 sample size, $\\overline{X}_g=g$ 의 sample mean은 다음과 같습니다.\n-   $\\overline{X}$ = global sample mean = `r global_data$global_response_mean`\n-   집단 간 분산: $\\frac{집단 간 제곱합}{자유도}=\\frac{\\sum_g[(\\overline{X}_g-\\overline{X})^2n_g]}{g-1}$\n\n#### SS_Day (집단간 분산 Day)\n\nDay sq = $[(\\overline{X}_g-\\overline{X})^2n_g]$ 집단(Day)간 분산 계산, 집단(Day)간 분산 = $\\frac{\\sum_g[(\\overline{X}_g-\\overline{X})^2n_g]}{g-1}$\n\n```{r}\ntemp1=day_data%>%\n    ungroup%>%\n    mutate(day_sq=(Day_group_response_mean-global_data$global_response_mean)^2*count)%>%\n    mutate(sum_day_ssq=sum(day_sq),\n              df=(dim(day_data)[1]-1),\n              day_mean_ssq=sum_day_ssq/df,\n              day_sd=sqrt(day_mean_ssq))\ntemp1%>%paged_table\n\n\n```\n\nAnalysis-In program의 ANOVA결과값과 일치하는 것을 볼 수 있습니다. \\$SS\\_{day} \\$= `r unique(temp1$sum_day_ssq)` with $df=19$.\n\n#### SS_noon (집단간 분산 noon)\n\nnoon sq = $[(\\overline{X}_g-\\overline{X})^2n_g]$ 집단(noon)간 분산 계산, 집단(noon)간 분산 = $\\frac{\\sum_g[(\\overline{X}_g-\\overline{X})^2n_g]}{g-1}$\n\n```{r}\ntemp2=noon_data%>%\n    mutate(noon_sq=(noon_group_response_mean-global_data$global_response_mean)^2*count)%>%\n    mutate(sum_noon_ssq=sum(noon_sq),\n              df=(dim(noon_data)[1]-1),\n              noon_mean_ssq=sum_noon_ssq/df,\n              noon_sd=sqrt(noon_mean_ssq))\ntemp2%>%paged_table\n\n```\n\nAnalysis-In program의 결과에서 찾아 볼 수 없죠? 이 결과는 숨어 있습니다. 상호 작용에 대한 분산값을 구하고 나면 정체를 알 수 있습니다.\n\n$SS_{noon}$ = `r unique(temp2$sum_noon_ssq)` with $df=1$.\n\n#### SS_error (집단내 분산)\n\n-   집단 내 분산 (within-groups variability)\n\n```{r}\n##group_by noon\n\ntemp3=data%>%\n    na.omit%>%\n    inner_join(.,day_noon_data,by=c(\"Day\",\"noon\"))%>%\n    dplyr::select(-id,-combi_group_response_sd ,-combi_group_response_CV)%>%\n    mutate(residual_sq=(response-combi_group_response_mean)^2,\n           df=nrow(data)-nrow(day_data)*nrow(noon_data)-1,\n           residual_ssq=sum(residual_sq),\n           mean_residual_ssq=residual_ssq/df)\n\ntemp3%>%paged_table\n\n```\n\n$SS_{error}$ = `r unique(temp3$residual_ssq)`\n\nAnalysis-In program의 결과와 일치하는 것을 확인할 수 있습니다.\n\n#### SS_total\n\n```{r}\ntemp4=data%>%\n    na.omit%>%\n    mutate(total_ssq=sum((response-global_data$global_response_mean)^2))\ntemp4%>%paged_table\n```\n\n$SS_{total}$ = `r unique(temp4$total_ssq)`\n\nAnalysis-In program의 ANOVA 결과 table에 있는 SS들의 합과 일치하는 것을 확인할 수 있습니다.\n\n#### 상호 작용 분산\n\n```{r}\ntemp5=unique(temp4$total_ssq)-unique(temp3$residual_ssq)-unique(temp2$sum_noon_ssq)-unique(temp1$sum_day_ssq)\n\n```\n\n$SS_{interaction}=SS_{DayNoon}= SS_{total}-SS_{Day}-SS_{noon}-SS_{error}$   \n= `r unique(temp4$total_ssq)`-`r unique(temp3$residual_ssq)`-`r unique(temp2$sum_noon_ssq)`-`r unique(temp1$sum_day_ssq)` = `r temp5`\n\nAnalysis-In program의 ANOVA 결과 table과 일치하는 것을 확인할 수 있습니다.\n\n위의 결과들을 종합하면 아래와 같이 요약됩니다.\n\n```{r}\naov(response~Day*noon,data=data)%>%summary()\n```\n\n-   Repeatability SD = $\\sqrt{V_{error}}=\\sqrt{MS_{error}}$ = `r sqrt(unique(temp3$residual_ssq)/unique(temp3$df))`\n-   Repeatability CV = $\\frac{repeatability \\space SD}{global \\space mean \\space response}$ = `r sqrt(unique(temp3$residual_ssq)/unique(temp3$df)) /global_data$global_response_mean`\n\n위의 결과를 간단히 해석해 보면\n\n-   집단간 범주 변수인 Day는 p-value =0.29\\>0.05 이므로 5% 유의 수준에서, 유의하지 않습니다.\n    -   즉, 5% 유의 수준에서, 일별로 평균 response값이 같다는 가설을 기각하는데 실패했습니다.\n    -   다시 말하면, 5% 유의 수준에서, 일별로 평균 response값이 다르지 않습니다.\n-   집단간 범주 변수인 noon은 p-value =0.30\\>0.05 이므로 5% 유의 수준에서, 유의하지 않습니다.\n    -   즉, 5% 유의 수준에서, 오전/오후별 평균 response값이 같다는 가설을 기각하는데 실패했습니다.\n    -   다시 말하면, 5% 유의 수준에서, 오전/오후별 평균 response값이 다르지 않습니다.\n-   Day와 noon두 변수의 상호작용 변수는 p-value =0.16\\>0.05 이므로 5% 유의 수준에서, 유의하지 않습니다.\n    -   즉, 5% 유의 수준에서, Day별 Noon(오전/오후)별 평균 response값이 같다는 가설을 기각하는데 실패했습니다.\n    -   다시 말하면, 5% 유의 수준에서, Day별 Noon(오전/오후)별 평균 response값이 다르지 않습니다.\n\n최종 결론, 제품의 response값이 Day별 오전/오후별 안정적인 performance를 보인다고 조심스럽게 결론을 내릴 수 있습니다.\n\n이제 까지는 질문에 대한 답이 되는 ANOVA의 원리 및 통계량의 재현 및 해석법에 대하여 알아봤습니다. 하지만 직관적으로 어떤 의미가 있을 까요? 원래는 시각화를 통해 데이터의 패턴을 짐작하고 통계 검정 결과를 예상하는데 우리는 반대로 가고 있네요 ㅎㅎ 시각화를 통해 ANOVA 결과가 얼마나 직관적인지 알아보겠습니다.\n\n### Visualization\n\n#### One-way: Day\n\n```{r}\nplotmeans(response~Day,data=data,\n          barcol=\"orange\",\n          barwidth = 2,\n          col=\"blue\",lwd=2,\n          xlab=\"Day\",\n          ylab=\"response\",\n          main=\"response in Daily Average with 95% Confidence Interval\")\nggplot(data, aes(x=Day, y=response)) + \n  geom_boxplot(outlier.colour=\"red\", \n               outlier.shape=8,\n                outlier.size=4)\n```\n\n자세히 보면 일별로 시간의 경과에 따라 전체적으로 평균 response값이 약간 하향하는 것으로 보입니다. 하지만 좀 더 세부적으로 관찰하면 1일\\~8일 평균 response의 경향이 constant한 패턴을 보입니다. 9일\\~13일 평균 response가 진동 하향하는 패턴을 보입니다. 14일\\~20일 평균 response가 상향하는 패턴을 보입니다.\n\n```{r}\nmodel1<-aov(data=data,response~Day)\nmodel.tables(model1,type=\"mean\") # 전체 평균과 집단 평균을 볼수 있음\nmodel.tables(model1,type=\"effects\") # 각 집단 평균과 전체 평균의 차이를 볼 수 있음\n```\n\n위에 첫 번째표에서 Global Sample response Mean = 38.727 과 **각 집단의 평균** response를 확인할 수 있습니다. 위에 두 번째표에서 Global Sample response Mean = 37.322 과 **각 집단의 평균 response의 차이**를 확인할 수 있습니다.\n\n-   Day 9에서 차이가 가장 큰 것으로 보아 9일째 실험에서 performance가 가장 낮은 것이 관측됐습니다.\n-   반대로, 12일에 performance 가장 좋은 것으로 관측됐습니다.\n\n9일과 12일에 response값에 영향을 미쳤던 요인이 있었는지 복기 하는것도 도움이 되겠군요.\n\n```{r}\n# Anova: Day\n\nsummary(model1)\n```\n\nOne-way ANOVA의 결과값입니다. Day별 평균 response의 차이는 거의 없는 것으로 보입니다. 따라서 Day 별 평균 response의 경향이 일관되지 않고 One-way ANOVA에서 역시 통계적으로 유의하지 않아 Day 변수는 평균 response에 영향을 미치지 않는 것 같습니다.\n\n#### One-way: AM/PM\n\n```{r}\nplotmeans(response~noon,data=data,\n          barcol=\"orange\",\n          barwidth = 3,\n          col=\"blue\",lwd=2,\n          xlab=\"AM/PM\",\n          ylab=\"response\",\n          main=\"response in Before/After Noon Average with 95% Confidence Interval\")\n\nggplot(data, aes(x=noon, y=response)) + \n  geom_boxplot(outlier.colour=\"red\", \n               outlier.shape=8,\n                outlier.size=4)\n```\n\n오후에 시간의 경과에 따라 전체적으로 평균 response값이 약간 하향하는 것으로 보입니다.\n\n```{r}\nmodel2<-aov(data=data,response~noon)\n# 개별 집단 차이를 볼수 있음\nmodel.tables(model2,type=\"mean\") # 전체 평균과 집단 평균을 볼수 있음\nmodel.tables(model2,type=\"effects\") # 각 집단 평균과 전체 평균의 차이를 볼 수 있음\n\n```\n\n위 첫 번째 표에서 AM/PM 간의 평균 response차이는 0.15 (농도가 약 0.5배) 차이가 나는 것을 확인할 수 있습니다. 생물학적으로 의미가 있는 수치일까요? 위 두 번째 표에서 Global Sample Mean 37.322와 오전/오후 별 약 0.07씩(농도가 약 0.25배) 차이가 납니다.\n\n```{r}\n# Anova: Day\nsummary(model2)\n```\n\n오전 오후별 One way ANOVA를 실행한 결과가 오전/오부 평균 response값의 차이가 다르지 않다는 것을 시사하고 있습니다. 아무래도 위의 차이는 우연에 의해 발생한 현상인 것 같습니다.\n\n```{r}\n#| fig-height: 10\n\ntukey<-TukeyHSD(model1)\nplot(tukey,col=\"blue\", las=1)\n# 가로선은 95% 신뢰구간을 표현하고 0을 포함하지 않으면 통계적으로 유의하다고 할 수 있다.\n\n```\n\n일별로 평균 response값이 차이를 모든 경우의 수에서 차이가 나는지 확인한 결과 신뢰구간 모두가 0을 포함하고 있으므로 Day 변수는 유의하다고 볼 수 없습니다.\n\n```{r}\n\n\ntukey<-TukeyHSD(model2)\nplot(tukey,col=\"blue\", las=1)\n\n\n```\n\n오전/오후별로 평균 response값이 차이를 모든 경우의 수에서 차이가 나는지 확인한 결과 신뢰구간 모두가 0을 포함하고 있으므로 오전/오후 변수는 유의하다고 볼 수 없습니다.\n\n여기 까지 각 변수별 평균 response로의 영향도를 통계적으로 시각적으로 관찰했습니다. 하지만 Day별 오전/오후별 영향도가 있는지 확인하겠습니다. (이미 위에서 통계적으로 없다고 검정됐습니다.)\n\n### Two way Anova\n\n```{r}\n# data를 여러번 적을 필요가없음\nwith(data,tapply(response, list(Day,noon),function(x)mean(x,na.rm=TRUE)))\nwith(data,tapply(response, list(Day,noon),function(x)sd(x,na.rm=TRUE)))\n```\n\n```{r}\nmodel3<-aov(response~Day*noon,data=data)\nmodel3<-aov(response~Day+noon+Day:noon,data=data)\n\n\nmodel.tables(model3,type=\"means\")\nmodel.tables(model3,type=\"effect\")\n```\n\none way ANOVA와 같이 해석\n\n```{r}\nboxplot(response~Day*noon,data=data,col=c(\"darkred\",\"darkblue\"),\n        las=1,xlab=\"Interaction of Day and Noon\",main = \"Effects of Day and Noon on response Values\")\ninteraction.plot(x.factor=data$Day,trace.factor = data$noon,response=data$response,trace.label=\"noon\",las=1,type=\"b\",pch=c(1,19),\n                 xlab=\"Day\", ylab=\"response\",col=c(\"darkred\",\"darkblue\"),\n                 main=\"Interaction Plot for response\")\n#interaction(data$Day,data$noon,sep=\" \")\nplotmeans(response~interaction(Day,noon,sep=\" \"),\n          data=data,col=c(\"darkred\",\"darkblue\"),\n          xlab=\"Combination of Day and Noon\",ylab=\"response\", main=\"Means plot for response\")\nplotmeans(response~interaction(Day,noon,sep=\" \"),\n          data=data,col=c(\"darkred\",\"darkblue\"),\n          connect=list(seq(1,39,by=2),seq(2,40,by=2))\n          ,xlab=\"Combination of Day and Noon\",ylab=\"response\", main=\"Means plot for AM, PM\")\nsummary(model3)\n```\n\n위 그림을 보듯이 두 변수의 영향도가 없음, ANOVA 역시 유의하지 않음\n\n```{r}\n#| fig-height: 10\n\n## 조건부 도표: coplot 2개의 집단 변수 중 1개의 집단 변수가 나머지 집단 변수와 종속변수에 관한 관계를 산점저로 표현\ncoplot(response~noon|Day,data=data,col=\"darkred\",pch=19,panel=panel.smooth,lwd=2,col.smooth=\"darkblue\",xlab=\"AM/PM\", ylab=\"response\")\n## 오전 오후와 Ct값의 관계를 볼수 있다.\n\n##주효과와 상호 작용 효과를 각각의 별도의 패널에서 볼수 있음\nlibrary(HH)\ninteraction2wt(response~noon*Day,data=data)\n#(2,1),(1,2) -> main effect expression\n#(1,1),(2,2) -> interaction effect expression\n\n## 대립 가설이 참일때만 사후 검정 추가 실시 할 수 있음\n\nTukeyHSD(model3)\n\nTukeyHSD(model3,which=c(\"Day\"),conf.level=0.99)\n```\n\n유의한 패턴 없음 Tukey 검정 결과 (보통 유의할때 함) 테이블 도 유의한 수치가 없음\n:::\n\n::: {#English .tab-pane .fade role=\"tabpanel\" aria-labelledby=\"English-tab\"}\n\n## Terms\n\n-   pairwise comparison: A hypothesis test (e.g., of means) between two groups among multiple groups.\n-   obmnibus set: A single hypothesis test of the overall variance among multiple group means.\n-   decomposition of variance : Separation of components contributing to an individual value (e.g., from the overall average, from a treatment mean, and from a residual error).\n-   F-test\n-   F statistic: A standardized statistic that measures the extent to which differences among group means exceed what might be expected in a chance model.\n-   sum of squares: deviations from some average value\n\n## ANOVA\n\nA basic idea of the ANOVA is to partition variation. It is not concerend with analyzing variances but with analyzing variation in means. To be specific, it is a method of estimating the means of several populations that are often assumed to be normally distributed. \n\n### One Way ANOVA\n\n* we \n* Assumptions\n\n$$ Y_{ij}=\\mu_i + \\epsilon_{ij}, \\space \\space i=1, ..., k, \\space j=1, ...,n_i $$\n$$ EY_{ij}=\\mu_i, \\space \\space , i=1, ..., k, \\space j=1, ...,n_i $$\n\nwhere the $\\mu_i$ are unkown parameters and the $\\epsilon_{ij}$ are error random variables.\n\n1. $\\text{E}\\epsilon_{ij}=0$, $\\text{Var}\\epsilon_{ij}=0<\\infty$, for all $i, j$\n1. $\\text{Cov}(\\epsilon_{ij},\\epsilon_{i'j'})=0$, for all $i, i', j$, and $j'$ unless $i=i'$ and $j=j'$.\n1. The $\\epsilon_{ij}$ are independent and normally distributed (normal errors).\n1. $\\sigma^2_{i}=\\sigma^2$ for all $i$ (homoscedasticity)\n:::\n"},"formats":{"html":{"identifier":{"display-name":"HTML","target-format":"html","base-format":"html"},"execute":{"fig-width":7,"fig-height":5,"fig-format":"retina","fig-dpi":96,"df-print":"default","error":false,"eval":true,"cache":null,"freeze":true,"echo":true,"output":true,"warning":false,"include":true,"keep-md":false,"keep-ipynb":false,"ipynb":null,"enabled":null,"daemon":null,"daemon-restart":false,"debug":false,"ipynb-filters":[],"ipynb-shell-interactivity":null,"plotly-connected":true,"message":false,"engine":"knitr"},"render":{"keep-tex":false,"keep-typ":false,"keep-source":false,"keep-hidden":false,"prefer-html":false,"output-divs":true,"output-ext":"html","fig-align":"default","fig-pos":null,"fig-env":null,"code-fold":true,"code-overflow":"wrap","code-link":false,"code-line-numbers":true,"code-tools":false,"tbl-colwidths":"auto","merge-includes":true,"inline-includes":false,"preserve-yaml":false,"latex-auto-mk":true,"latex-auto-install":true,"latex-clean":true,"latex-min-runs":1,"latex-max-runs":10,"latex-makeindex":"makeindex","latex-makeindex-opts":[],"latex-tlmgr-opts":[],"latex-input-paths":[],"latex-output-dir":null,"link-external-icon":false,"link-external-newwindow":false,"self-contained-math":false,"format-resources":[],"notebook-links":true},"pandoc":{"standalone":true,"wrap":"none","default-image-extension":"png","to":"html","highlight-style":"github","css":["../../../../styles.css"],"toc":true,"toc-depth":3,"number-sections":true,"include-in-header":[{"text":"<style>\n.custom-footer { \n  text-align: center; \n  font-size: 0.8em; \n  color: #666; \n  margin-top: 2rem; \n}\n</style>\n"}],"include-after-body":["../../../../js.html","../../signup.html"],"output-file":"2023-01-07-anova.html"},"language":{"toc-title-document":"목차","toc-title-website":"목차","related-formats-title":"기타 형식","related-notebooks-title":"Notebooks","source-notebooks-prefix":"원천","other-links-title":"기타 링크","code-links-title":"코드 링크","launch-dev-container-title":"Dev 컨테이너 실행","launch-binder-title":"랜치 Binder","article-notebook-label":"기사 노트북","notebook-preview-download":"노트북 다운로드","notebook-preview-download-src":"소스 다운로드","notebook-preview-back":"기사로 돌아가기","manuscript-meca-bundle":"MECA 아카이브","section-title-abstract":"초록","section-title-appendices":"부록","section-title-footnotes":"각주","section-title-references":"참고문헌","section-title-reuse":"라이센스","section-title-copyright":"저작권","section-title-citation":"인용","appendix-attribution-cite-as":"인용방법","appendix-attribution-bibtex":"BibTeX 인용:","title-block-author-single":"저자","title-block-author-plural":"저자","title-block-affiliation-single":"소속","title-block-affiliation-plural":"소속","title-block-published":"공개","title-block-modified":"Modified","title-block-keywords":"키워드","callout-tip-title":"힌트","callout-note-title":"노트","callout-warning-title":"경고","callout-important-title":"중요","callout-caution-title":"주의","code-summary":"코드","code-tools-menu-caption":"코드","code-tools-show-all-code":"전체 코드 표시","code-tools-hide-all-code":"전체 코드 숨기기","code-tools-view-source":"소스 코드 표시","code-tools-source-code":"소스 코드","tools-share":"Share","tools-download":"Download","code-line":"선","code-lines":"윤곽","copy-button-tooltip":"클립보드 복사","copy-button-tooltip-success":"복사완료!","repo-action-links-edit":"편집","repo-action-links-source":"소스코드 보기","repo-action-links-issue":"이슈 보고","back-to-top":"맨 위로","search-no-results-text":"일치 없음","search-matching-documents-text":"일치된 문서","search-copy-link-title":"검색 링크 복사","search-hide-matches-text":"추가 검색 결과 숨기기","search-more-match-text":"추가 검색결과","search-more-matches-text":"추가 검색결과","search-clear-button-title":"제거","search-text-placeholder":"","search-detached-cancel-button-title":"취소","search-submit-button-title":"검색","search-label":"검색","toggle-section":"토글 섹션","toggle-sidebar":"사이드바 전환","toggle-dark-mode":"다크 모드 전환","toggle-reader-mode":"리더 모드 전환","toggle-navigation":"탐색 전환","crossref-fig-title":"그림","crossref-tbl-title":"표","crossref-lst-title":"목록","crossref-thm-title":"정리","crossref-lem-title":"보조정리","crossref-cor-title":"따름정리","crossref-prp-title":"명제","crossref-cnj-title":"추측","crossref-def-title":"정의","crossref-exm-title":"보기","crossref-exr-title":"예제","crossref-ch-prefix":"장","crossref-apx-prefix":"부록","crossref-sec-prefix":"섹션","crossref-eq-prefix":"방정식","crossref-lof-title":"그림 목록","crossref-lot-title":"표 목록","crossref-lol-title":"코드 목록","environment-proof-title":"증명","environment-remark-title":"주석","environment-solution-title":"해답","listing-page-order-by":"정렬","listing-page-order-by-default":"디폴트","listing-page-order-by-date-asc":"날짜(오름차순)","listing-page-order-by-date-desc":"날짜(내림차순)","listing-page-order-by-number-desc":"페이지 번호(내림차순)","listing-page-order-by-number-asc":"페이지 번호(오름차순)","listing-page-field-date":"날짜","listing-page-field-title":"제목","listing-page-field-description":"설명","listing-page-field-author":"저자","listing-page-field-filename":"파일명","listing-page-field-filemodified":"갱신일","listing-page-field-subtitle":"부제목","listing-page-field-readingtime":"읽기 시간","listing-page-field-wordcount":"단어 수","listing-page-field-categories":"분류","listing-page-minutes-compact":"{0} 분","listing-page-category-all":"전체","listing-page-no-matches":"일치 없음","listing-page-words":"{0} 단어"},"metadata":{"lang":"ko","fig-responsive":true,"quarto-version":"1.4.543","theme":{"light":["cosmo","../../../../theme.scss"],"dark":["cosmo","../../../../theme-dark.scss"]},"code-copy":true,"grid":{"sidebar-width":"200px","body-width":"1200px","margin-width":"200px"},"comments":{"giscus":{"repo":"kmink3225/blog","category":"Blog"}},"title-block-banner":"#EDF3F9","title-block-banner-color":"black","toc-location":"right","open-graph":true,"twitter-card":true,"search":true,"date-format":"YYYY년 MM월 DD일","title":"ANOVA","subtitle":"ANOVA, one-way ANOVA, Two-way ANOVA, ANCOVA, repeated measures ANOVA, MANOVA","description":"The analysis of variance (ANOVA) is one of the most widely used statistical techniques. When we conduct a comparison testing of multiple groups such as A, B, and C on each with numeric data, the statistical test for a significant difference among the groups is called analysis of variance, or ANOVA.\n","categories":["Statistics"],"author":"Kwangmin Kim","date":"01/07/2023","draft":true,"page-layout":"full"},"extensions":{"book":{"multiFile":true}}}},"projectFormats":["html"]}