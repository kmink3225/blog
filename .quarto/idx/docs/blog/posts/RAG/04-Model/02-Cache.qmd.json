{"title":"LangChain을 활용한 LLM 캐싱 및 성능 최적화","markdown":{"yaml":{"title":"LangChain을 활용한 LLM 캐싱 및 성능 최적화","subtitle":"언어 모델","description":"다양한 LLM 제공자와 모델 활용법을 다룬다.\n","categories":["AI","RAG","LangChain"],"author":"Kwangmin Kim","date":"02/02/2025","format":{"html":{"page-layout":"full","code-fold":true,"toc":true,"number-sections":true}},"draft":false,"execute":{"eval":false}},"headingText":"캐싱(Caching)","containsRefs":false,"markdown":"\n\n\nLangChain은 LLM을 위한 선택적 캐싱 레이어를 제공합니다.\n\n이는 두 가지 이유로 유용합니다.\n\n- 동일한 완료를 여러 번 요청하는 경우 LLM 공급자에 대한 **API 호출 횟수를 줄여 비용을 절감**할 수 있습니다.\n- LLM 제공업체에 대한 **API 호출 횟수를 줄여 애플리케이션의 속도를 높일 수** 있습니다.\n\n\n```{python}\n\n# API KEY를 환경변수로 관리하기 위한 설정 파일\nfrom dotenv import load_dotenv\n\n# API KEY 정보로드\nload_dotenv()\n```\n\n```\nTrue\n```\n\n```{python}\n# LangSmith 추적을 설정합니다. https://smith.langchain.com\n# !pip install langchain-teddynote\nfrom langchain_teddynote import logging\n\n# 프로젝트 이름을 입력합니다.\nlogging.langsmith(\"CH04-Models\")\n```\n\n```\nLangSmith 추적을 시작합니다.\n[프로젝트명]\nCH04-Models\n```\n\n모델과 프롬프트를 생성합니다\n\n```{python}\n\n\nfrom langchain_openai import ChatOpenAI\nfrom langchain_core.prompts import PromptTemplate\n\n# 모델을 생성합니다.\nllm = ChatOpenAI(model_name=\"gpt-3.5-turbo\")\n\n# 프롬프트를 생성합니다.\nprompt = PromptTemplate.from_template(\"{country} 에 대해서 200자 내외로 요약해줘\")\n\n# 체인을 생성합니다.\nchain = prompt | llm\n\n%%time \nresponse = chain.invoke({\"country\": \"한국\"})\nprint(response.content)\n```\n\n```\n한국은 동아시아에 위치한 고도로 발전한 나라로, 역사적으로는 고조선, 삼국, 고려, 조선 등 다양한 왕조가 있었고, 현재는 대한민국으로 알려져 있다. 서울이 수도이며, 높은 경제력과 첨단 기술력을 보유하고 있다. 또한 한류와 K-pop을 통해 세계적으로 큰 인기를 얻고 있으며, 한국음식인 김치, 불고기, 라면 등도 세계적으로 유명하다. 한반도 북쪽에는 북한이 있으며, 남한과의 관계는 계속된 갈등과 논쟁이 있지만, 평화를 향한 노력도 계속되고 있다. 한국은 고대 역사와 현대 문화가 조화롭게 공존하는 매력적인 나라이다.\nCPU times: user 48.6 ms, sys: 17.1 ms, total: 65.7 ms\nWall time: 2.88 s\n\n```\n## InMemoryCache\n\n인메모리 캐시를 사용하여 동일 질문에 대한 답변을 저장하고, 캐시에 저장된 답변을 반환합니다.\n\n```{python}\nfrom langchain_community.cache import SQLiteCache\nfrom langchain_core.globals import set_llm_cache\nimport os\n\n# 캐시 디렉토리를 생성합니다.\nif not os.path.exists(\"cache\"):\n    os.makedirs(\"cache\")\n\n# SQLiteCache를 사용합니다.\nset_llm_cache(SQLiteCache(database_path=\"cache/llm_cache.db\"))\n```\n\n```\n한국은 동아시아에 위치한 고도로 발전한 현대화된 나라로, 경제적으로 선진국으로 분류되며 세계적으로 유명한 기업들을 많이 보유하고 있다. 또한 한류 열풍으로 한국의 문화와 엔터테인먼트 산업이 세계적으로 큰 인기를 끌고 있다. 한국은 높은 교육 수준과 혁신적인 기술력을 자랑하며, 고강도의 사회 경쟁과 열악한 교육 환경으로도 유명하다. 또한 한반도 분단 문제로 북한과의 관계가 여전히 긴장 상태에 있는 상황이며, 이러한 정치적인 문제와 함께 자연환경 보존과 과잉 소비 문제에도 집중적으로 대처하고 있는 나라이다.\nCPU times: user 92 ms, sys: 14.2 ms, total: 106 ms\nWall time: 3.97 s\n```\n\n```{python}\n%%time \n# 체인을 실행합니다.\nresponse = chain.invoke({\"country\": \"한국\"})\nprint(response.content)\n```\n\n```\n한국은 동아시아에 위치한 고도로 발전한 현대화된 나라로, 경제적으로 선진국으로 분류되며 세계적으로 유명한 기업들을 많이 보유하고 있다. 또한 한류 열풍으로 한국의 문화와 엔터테인먼트 산업이 세계적으로 큰 인기를 끌고 있다. 한국은 높은 교육 수준과 혁신적인 기술력을 자랑하며, 고강도의 사회 경쟁과 열악한 교육 환경으로도 유명하다. 또한 한반도 분단 문제로 북한과의 관계가 여전히 긴장 상태에 있는 상황이며, 이러한 정치적인 문제와 함께 자연환경 보존과 과잉 소비 문제에도 집중적으로 대처하고 있는 나라이다.\nCPU times: user 2.48 ms, sys: 1.21 ms, total: 3.69 ms\nWall time: 2.86 ms\n```\n\n## SQLite Cache\n\n```{python}\nfrom langchain_community.cache import SQLiteCache\nfrom langchain_core.globals import set_llm_cache\nimport os\n\n# 캐시 디렉토리를 생성합니다.\nif not os.path.exists(\"cache\"):\n    os.makedirs(\"cache\")\n\n# SQLiteCache를 사용합니다.\nset_llm_cache(SQLiteCache(database_path=\"cache/llm_cache.db\"))\n%%time \n# 체인을 실행합니다.\nresponse = chain.invoke({\"country\": \"한국\"})\nprint(response.content)\n```\n\n```\n한국은 동아시아에 위치한 고도 발전한 경제를 갖춘 선진국가이다. 수도는 서울이며, 인구는 약 5,100만 명으로 밀집된 도시들이 많이 있다. 한국은 고도로 발전한 IT 기술을 보유하고 있으며, 세계적으로 유명한 기업들이 많이 있다. 또한 K-pop, K-drama 등의 문화 콘텐츠로 인해 한류 열풍이 세계적으로 퍼지고 있다. 한국은 미세먼지와 같은 환경문제에 직면해 있지만, 정부와 시민들이 노력하여 지속가능한 발전을 추구하고 있다. 또한 한반도에 북한과의 관계가 긴장되어 있어 평화와 통일을 위한 노력도 계속되고 있다.\nCPU times: user 50.6 ms, sys: 27 ms, total: 77.7 ms\nWall time: 76.2 ms\n```","srcMarkdownNoYaml":"\n\n## 캐싱(Caching)\n\nLangChain은 LLM을 위한 선택적 캐싱 레이어를 제공합니다.\n\n이는 두 가지 이유로 유용합니다.\n\n- 동일한 완료를 여러 번 요청하는 경우 LLM 공급자에 대한 **API 호출 횟수를 줄여 비용을 절감**할 수 있습니다.\n- LLM 제공업체에 대한 **API 호출 횟수를 줄여 애플리케이션의 속도를 높일 수** 있습니다.\n\n\n```{python}\n\n# API KEY를 환경변수로 관리하기 위한 설정 파일\nfrom dotenv import load_dotenv\n\n# API KEY 정보로드\nload_dotenv()\n```\n\n```\nTrue\n```\n\n```{python}\n# LangSmith 추적을 설정합니다. https://smith.langchain.com\n# !pip install langchain-teddynote\nfrom langchain_teddynote import logging\n\n# 프로젝트 이름을 입력합니다.\nlogging.langsmith(\"CH04-Models\")\n```\n\n```\nLangSmith 추적을 시작합니다.\n[프로젝트명]\nCH04-Models\n```\n\n모델과 프롬프트를 생성합니다\n\n```{python}\n\n\nfrom langchain_openai import ChatOpenAI\nfrom langchain_core.prompts import PromptTemplate\n\n# 모델을 생성합니다.\nllm = ChatOpenAI(model_name=\"gpt-3.5-turbo\")\n\n# 프롬프트를 생성합니다.\nprompt = PromptTemplate.from_template(\"{country} 에 대해서 200자 내외로 요약해줘\")\n\n# 체인을 생성합니다.\nchain = prompt | llm\n\n%%time \nresponse = chain.invoke({\"country\": \"한국\"})\nprint(response.content)\n```\n\n```\n한국은 동아시아에 위치한 고도로 발전한 나라로, 역사적으로는 고조선, 삼국, 고려, 조선 등 다양한 왕조가 있었고, 현재는 대한민국으로 알려져 있다. 서울이 수도이며, 높은 경제력과 첨단 기술력을 보유하고 있다. 또한 한류와 K-pop을 통해 세계적으로 큰 인기를 얻고 있으며, 한국음식인 김치, 불고기, 라면 등도 세계적으로 유명하다. 한반도 북쪽에는 북한이 있으며, 남한과의 관계는 계속된 갈등과 논쟁이 있지만, 평화를 향한 노력도 계속되고 있다. 한국은 고대 역사와 현대 문화가 조화롭게 공존하는 매력적인 나라이다.\nCPU times: user 48.6 ms, sys: 17.1 ms, total: 65.7 ms\nWall time: 2.88 s\n\n```\n## InMemoryCache\n\n인메모리 캐시를 사용하여 동일 질문에 대한 답변을 저장하고, 캐시에 저장된 답변을 반환합니다.\n\n```{python}\nfrom langchain_community.cache import SQLiteCache\nfrom langchain_core.globals import set_llm_cache\nimport os\n\n# 캐시 디렉토리를 생성합니다.\nif not os.path.exists(\"cache\"):\n    os.makedirs(\"cache\")\n\n# SQLiteCache를 사용합니다.\nset_llm_cache(SQLiteCache(database_path=\"cache/llm_cache.db\"))\n```\n\n```\n한국은 동아시아에 위치한 고도로 발전한 현대화된 나라로, 경제적으로 선진국으로 분류되며 세계적으로 유명한 기업들을 많이 보유하고 있다. 또한 한류 열풍으로 한국의 문화와 엔터테인먼트 산업이 세계적으로 큰 인기를 끌고 있다. 한국은 높은 교육 수준과 혁신적인 기술력을 자랑하며, 고강도의 사회 경쟁과 열악한 교육 환경으로도 유명하다. 또한 한반도 분단 문제로 북한과의 관계가 여전히 긴장 상태에 있는 상황이며, 이러한 정치적인 문제와 함께 자연환경 보존과 과잉 소비 문제에도 집중적으로 대처하고 있는 나라이다.\nCPU times: user 92 ms, sys: 14.2 ms, total: 106 ms\nWall time: 3.97 s\n```\n\n```{python}\n%%time \n# 체인을 실행합니다.\nresponse = chain.invoke({\"country\": \"한국\"})\nprint(response.content)\n```\n\n```\n한국은 동아시아에 위치한 고도로 발전한 현대화된 나라로, 경제적으로 선진국으로 분류되며 세계적으로 유명한 기업들을 많이 보유하고 있다. 또한 한류 열풍으로 한국의 문화와 엔터테인먼트 산업이 세계적으로 큰 인기를 끌고 있다. 한국은 높은 교육 수준과 혁신적인 기술력을 자랑하며, 고강도의 사회 경쟁과 열악한 교육 환경으로도 유명하다. 또한 한반도 분단 문제로 북한과의 관계가 여전히 긴장 상태에 있는 상황이며, 이러한 정치적인 문제와 함께 자연환경 보존과 과잉 소비 문제에도 집중적으로 대처하고 있는 나라이다.\nCPU times: user 2.48 ms, sys: 1.21 ms, total: 3.69 ms\nWall time: 2.86 ms\n```\n\n## SQLite Cache\n\n```{python}\nfrom langchain_community.cache import SQLiteCache\nfrom langchain_core.globals import set_llm_cache\nimport os\n\n# 캐시 디렉토리를 생성합니다.\nif not os.path.exists(\"cache\"):\n    os.makedirs(\"cache\")\n\n# SQLiteCache를 사용합니다.\nset_llm_cache(SQLiteCache(database_path=\"cache/llm_cache.db\"))\n%%time \n# 체인을 실행합니다.\nresponse = chain.invoke({\"country\": \"한국\"})\nprint(response.content)\n```\n\n```\n한국은 동아시아에 위치한 고도 발전한 경제를 갖춘 선진국가이다. 수도는 서울이며, 인구는 약 5,100만 명으로 밀집된 도시들이 많이 있다. 한국은 고도로 발전한 IT 기술을 보유하고 있으며, 세계적으로 유명한 기업들이 많이 있다. 또한 K-pop, K-drama 등의 문화 콘텐츠로 인해 한류 열풍이 세계적으로 퍼지고 있다. 한국은 미세먼지와 같은 환경문제에 직면해 있지만, 정부와 시민들이 노력하여 지속가능한 발전을 추구하고 있다. 또한 한반도에 북한과의 관계가 긴장되어 있어 평화와 통일을 위한 노력도 계속되고 있다.\nCPU times: user 50.6 ms, sys: 27 ms, total: 77.7 ms\nWall time: 76.2 ms\n```"},"formats":{"html":{"identifier":{"display-name":"HTML","target-format":"html","base-format":"html"},"execute":{"fig-width":7,"fig-height":5,"fig-format":"retina","fig-dpi":96,"df-print":"default","error":false,"eval":false,"cache":true,"freeze":true,"echo":true,"output":true,"warning":true,"include":true,"keep-md":false,"keep-ipynb":false,"ipynb":null,"enabled":null,"daemon":true,"daemon-restart":false,"debug":false,"ipynb-filters":[],"ipynb-shell-interactivity":null,"plotly-connected":true,"engine":"jupyter"},"render":{"keep-tex":false,"keep-typ":false,"keep-source":false,"keep-hidden":false,"prefer-html":false,"output-divs":true,"output-ext":"html","fig-align":"default","fig-pos":null,"fig-env":null,"code-fold":true,"code-overflow":"wrap","code-link":false,"code-line-numbers":true,"code-tools":false,"tbl-colwidths":"auto","merge-includes":true,"inline-includes":false,"preserve-yaml":false,"latex-auto-mk":true,"latex-auto-install":true,"latex-clean":true,"latex-min-runs":1,"latex-max-runs":10,"latex-makeindex":"makeindex","latex-makeindex-opts":[],"latex-tlmgr-opts":[],"latex-input-paths":[],"latex-output-dir":null,"link-external-icon":false,"link-external-newwindow":false,"self-contained-math":false,"format-resources":[],"notebook-links":true},"pandoc":{"standalone":true,"wrap":"none","default-image-extension":"png","to":"html","highlight-style":"github","css":["../../../../../styles.css"],"toc":true,"toc-depth":3,"number-sections":true,"include-in-header":[{"text":"<style>\n.custom-footer { \n  text-align: center; \n  font-size: 0.8em; \n  color: #666; \n  margin-top: 2rem; \n}\n</style>\n"}],"include-after-body":["../../../../../js.html","../../../signup.html"],"output-file":"02-Cache.html"},"language":{"toc-title-document":"목차","toc-title-website":"목차","related-formats-title":"기타 형식","related-notebooks-title":"Notebooks","source-notebooks-prefix":"원천","other-links-title":"기타 링크","code-links-title":"코드 링크","launch-dev-container-title":"Dev 컨테이너 실행","launch-binder-title":"랜치 Binder","article-notebook-label":"기사 노트북","notebook-preview-download":"노트북 다운로드","notebook-preview-download-src":"소스 다운로드","notebook-preview-back":"기사로 돌아가기","manuscript-meca-bundle":"MECA 아카이브","section-title-abstract":"초록","section-title-appendices":"부록","section-title-footnotes":"각주","section-title-references":"참고문헌","section-title-reuse":"라이센스","section-title-copyright":"저작권","section-title-citation":"인용","appendix-attribution-cite-as":"인용방법","appendix-attribution-bibtex":"BibTeX 인용:","appendix-view-license":"라이센스 보기","title-block-author-single":"저자","title-block-author-plural":"저자","title-block-affiliation-single":"소속","title-block-affiliation-plural":"소속","title-block-published":"공개","title-block-modified":"Modified","title-block-keywords":"키워드","callout-tip-title":"힌트","callout-note-title":"노트","callout-warning-title":"경고","callout-important-title":"중요","callout-caution-title":"주의","code-summary":"코드","code-tools-menu-caption":"코드","code-tools-show-all-code":"전체 코드 표시","code-tools-hide-all-code":"전체 코드 숨기기","code-tools-view-source":"소스 코드 표시","code-tools-source-code":"소스 코드","tools-share":"Share","tools-download":"Download","code-line":"선","code-lines":"윤곽","copy-button-tooltip":"클립보드 복사","copy-button-tooltip-success":"복사완료!","repo-action-links-edit":"편집","repo-action-links-source":"소스코드 보기","repo-action-links-issue":"이슈 보고","back-to-top":"맨 위로","search-no-results-text":"일치 없음","search-matching-documents-text":"일치된 문서","search-copy-link-title":"검색 링크 복사","search-hide-matches-text":"추가 검색 결과 숨기기","search-more-match-text":"추가 검색결과","search-more-matches-text":"추가 검색결과","search-clear-button-title":"제거","search-text-placeholder":"","search-detached-cancel-button-title":"취소","search-submit-button-title":"검색","search-label":"검색","toggle-section":"토글 섹션","toggle-sidebar":"사이드바 전환","toggle-dark-mode":"다크 모드 전환","toggle-reader-mode":"리더 모드 전환","toggle-navigation":"탐색 전환","crossref-fig-title":"그림","crossref-tbl-title":"표","crossref-lst-title":"목록","crossref-thm-title":"정리","crossref-lem-title":"보조정리","crossref-cor-title":"따름정리","crossref-prp-title":"명제","crossref-cnj-title":"추측","crossref-def-title":"정의","crossref-exm-title":"보기","crossref-exr-title":"예제","crossref-ch-prefix":"장","crossref-apx-prefix":"부록","crossref-sec-prefix":"섹션","crossref-eq-prefix":"방정식","crossref-lof-title":"그림 목록","crossref-lot-title":"표 목록","crossref-lol-title":"코드 목록","environment-proof-title":"증명","environment-remark-title":"주석","environment-solution-title":"해답","listing-page-order-by":"정렬","listing-page-order-by-default":"디폴트","listing-page-order-by-date-asc":"날짜(오름차순)","listing-page-order-by-date-desc":"날짜(내림차순)","listing-page-order-by-number-desc":"페이지 번호(내림차순)","listing-page-order-by-number-asc":"페이지 번호(오름차순)","listing-page-field-date":"날짜","listing-page-field-title":"제목","listing-page-field-description":"설명","listing-page-field-author":"저자","listing-page-field-filename":"파일명","listing-page-field-filemodified":"갱신일","listing-page-field-subtitle":"부제목","listing-page-field-readingtime":"읽기 시간","listing-page-field-wordcount":"단어 수","listing-page-field-categories":"분류","listing-page-minutes-compact":"{0} 분","listing-page-category-all":"전체","listing-page-no-matches":"일치 없음","listing-page-words":"{0} 단어","listing-page-filter":"필터","draft":"초안"},"metadata":{"lang":"ko","fig-responsive":true,"quarto-version":"1.5.56","theme":{"light":["cosmo","../../../../../theme.scss"],"dark":["cosmo","../../../../../theme-dark.scss"]},"code-copy":true,"grid":{"sidebar-width":"200px","body-width":"1200px","margin-width":"200px"},"comments":{"giscus":{"repo":"kmink3225/blog","category":"Blog"}},"title-block-banner":"#EDF3F9","title-block-banner-color":"black","toc-location":"right","open-graph":true,"twitter-card":true,"search":true,"date-format":"YYYY년 MM월 DD일","title":"LangChain을 활용한 LLM 캐싱 및 성능 최적화","subtitle":"언어 모델","description":"다양한 LLM 제공자와 모델 활용법을 다룬다.\n","categories":["AI","RAG","LangChain"],"author":"Kwangmin Kim","date":"02/02/2025","draft":false,"page-layout":"full"},"extensions":{"book":{"multiFile":true}}}},"draft":false,"projectFormats":["html"]}