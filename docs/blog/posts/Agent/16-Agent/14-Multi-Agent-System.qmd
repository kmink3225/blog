---
title: "Multi-Agent ì‹œìŠ¤í…œ"
subtitle: ì—¬ëŸ¬ ì—ì´ì „íŠ¸ê°€ í˜‘ì—…í•˜ëŠ” ë³µì¡í•œ ì‹œìŠ¤í…œ êµ¬ì¶•
description: |
  ì—¬ëŸ¬ ê°œì˜ íŠ¹í™”ëœ ì—ì´ì „íŠ¸ê°€ í˜‘ì—…í•˜ì—¬ ë³µì¡í•œ ë¬¸ì œë¥¼ í•´ê²°í•˜ëŠ” Multi-Agent ì‹œìŠ¤í…œì˜ ì„¤ê³„ì™€ êµ¬í˜„ì„ ë‹¤ë£¬ë‹¤.
categories:
  - AI
  - RAG
  - LangChain
author: Kwangmin Kim
date: 11/18/2025
format: 
  html:
    page-layout: full
    code-fold: true
    toc: true
    number-sections: true
draft: False
execute:
    eval: false
---

## Multi-Agent ì‹œìŠ¤í…œì´ë€?

Multi-Agent ì‹œìŠ¤í…œì€ ì—¬ëŸ¬ ê°œì˜ íŠ¹í™”ëœ ì—ì´ì „íŠ¸ê°€ **í˜‘ì—…(Collaboration)**í•˜ì—¬ ë³µì¡í•œ ë¬¸ì œë¥¼ í•´ê²°í•˜ëŠ” ì•„í‚¤í…ì²˜ë‹¤.

### ë‹¨ì¼ vs ë©€í‹° ì—ì´ì „íŠ¸

**ë‹¨ì¼ ì—ì´ì „íŠ¸ì˜ í•œê³„:**
- ëª¨ë“  ì‘ì—…ì„ í•˜ë‚˜ì˜ ì—ì´ì „íŠ¸ê°€ ì²˜ë¦¬
- ì „ë¬¸ì„± ë¶€ì¡± (ì¼ë°˜í™”ëœ ë„êµ¬ë§Œ ì‚¬ìš©)
- ë³µì¡ë„ê°€ ì¦ê°€í•˜ë©´ ì„±ëŠ¥ ì €í•˜
- ì»¨í…ìŠ¤íŠ¸ ê¸¸ì´ ì œí•œ

**Multi-Agentì˜ ì¥ì :**
- **ì „ë¬¸í™”**: ê° ì—ì´ì „íŠ¸ê°€ íŠ¹ì • ë„ë©”ì¸ì— ì „ë¬¸í™”
- **ë³‘ë ¬ ì²˜ë¦¬**: ë…ë¦½ì ì¸ ì‘ì—…ì„ ë™ì‹œì— ìˆ˜í–‰
- **í™•ì¥ì„±**: ìƒˆë¡œìš´ ì—ì´ì „íŠ¸ ì¶”ê°€ ìš©ì´
- **ê²°í•©ë ¥**: ê° ì—ì´ì „íŠ¸ì˜ ê°•ì ì„ ê²°í•©
- **ì»¨í…ìŠ¤íŠ¸ ë¶„ë¦¬**: ê° ì—ì´ì „íŠ¸ê°€ ë…ë¦½ì ì¸ ì»¨í…ìŠ¤íŠ¸ ê´€ë¦¬

### Multi-Agent ì‹œìŠ¤í…œ ì•„í‚¤í…ì²˜ íŒ¨í„´

#### íŒ¨í„´ 1: Supervisor (ê°ë…ì)

```
           â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
           â”‚  Supervisor â”‚
           â”‚   (ì¡°ìœ¨ì)   â”‚
           â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”˜
                  â”‚
      â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
      â”‚           â”‚           â”‚
â”Œâ”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â” â”Œâ”€â”€â”€â–¼â”€â”€â”€â”€â” â”Œâ”€â”€â”€â–¼â”€â”€â”€â”€â”
â”‚ Agent 1  â”‚ â”‚Agent 2 â”‚ â”‚Agent 3 â”‚
â”‚(ê²€ìƒ‰ ì „ë¬¸)â”‚ â”‚(ë¶„ì„ ì „ë¬¸)â”‚ â”‚(ì‘ì„± ì „ë¬¸)â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â””â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â””â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

**íŠ¹ì§•:**
- ì¤‘ì•™ Supervisorê°€ ì‘ì—… ë¶„ë°°
- ê° AgentëŠ” ë…ë¦½ì ìœ¼ë¡œ ì‘ì—… ìˆ˜í–‰
- Supervisorê°€ ê²°ê³¼ í†µí•©

#### íŒ¨í„´ 2: Hierarchical (ê³„ì¸µì )

```
        â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
        â”‚ Manager Agentâ”‚
        â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”˜
               â”‚
    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
    â”‚          â”‚          â”‚
â”Œâ”€â”€â”€â–¼â”€â”€â”€â”  â”Œâ”€â”€â–¼â”€â”€â”€â”  â”Œâ”€â”€â–¼â”€â”€â”€â”
â”‚Team A â”‚  â”‚Team Bâ”‚  â”‚Team Câ”‚
â”‚Lead   â”‚  â”‚Lead  â”‚  â”‚Lead  â”‚
â””â”€â”€â”€â”¬â”€â”€â”€â”˜  â””â”€â”€â”¬â”€â”€â”€â”˜  â””â”€â”€â”¬â”€â”€â”€â”˜
    â”‚         â”‚         â”‚
â”Œâ”€â”€â”€â”´â”€â”€â”  â”Œâ”€â”€â”´â”€â”€â”  â”Œâ”€â”€â”´â”€â”€â”
â”‚Workerâ”‚  â”‚Workerâ”‚  â”‚Workerâ”‚
â””â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”˜
```

**íŠ¹ì§•:**
- ì—¬ëŸ¬ ê³„ì¸µì˜ ì—ì´ì „íŠ¸
- ê° ê³„ì¸µì´ í•˜ìœ„ ê³„ì¸µ ê´€ë¦¬
- ë³µì¡í•œ ì¡°ì§ êµ¬ì¡° ëª¨ë¸ë§

#### íŒ¨í„´ 3: Peer-to-Peer (ë™ë“±)

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”     â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ Agent 1 â”‚â—„â”€â”€â”€â–ºâ”‚ Agent 2 â”‚
â””â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”˜     â””â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”˜
     â”‚               â”‚
     â”‚    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”â”‚
     â””â”€â”€â”€â–ºâ”‚ Agent 3 â”‚â—„â”˜
          â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

**íŠ¹ì§•:**
- ì—ì´ì „íŠ¸ ê°„ ì§ì ‘ í†µì‹ 
- ì¤‘ì•™ ì¡°ìœ¨ì ì—†ìŒ
- ë¶„ì‚° ì˜ì‚¬ê²°ì •

```{python}
# API í‚¤ë¥¼ í™˜ê²½ë³€ìˆ˜ë¡œ ê´€ë¦¬í•˜ê¸° ìœ„í•œ ì„¤ì • íŒŒì¼
from dotenv import load_dotenv

# API í‚¤ ì •ë³´ ë¡œë“œ
load_dotenv()
```

```{python}
# LangSmith ì¶”ì ì„ ì„¤ì •í•œë‹¤. https://smith.langchain.com
# !pip install -qU langchain-teddynote
from langchain_teddynote import logging

# í”„ë¡œì íŠ¸ ì´ë¦„ì„ ì…ë ¥í•œë‹¤.
logging.langsmith("CH17-Multi-Agent-System")
```

## í™˜ê²½ ì„¤ì •

### ê¸°ë³¸ êµ¬ì„± ìš”ì†Œ

Multi-Agent ì‹œìŠ¤í…œì€ ë‹¤ìŒ ìš”ì†Œë¡œ êµ¬ì„±ëœë‹¤:

1. **íŠ¹í™”ëœ Agentë“¤**: ê°ì ì „ë¬¸ ë¶„ì•¼ê°€ ìˆëŠ” ì—ì´ì „íŠ¸
2. **Supervisor/Router**: ì‘ì—… ë¶„ë°° ë° ì¡°ìœ¨
3. **ê³µìœ  ë©”ëª¨ë¦¬**: ì—ì´ì „íŠ¸ ê°„ ì •ë³´ ê³µìœ 
4. **í†µì‹  í”„ë¡œí† ì½œ**: ì—ì´ì „íŠ¸ ê°„ ë©”ì‹œì§€ ì „ë‹¬

![Multi-Agent ì‹œìŠ¤í…œ ì•„í‚¤í…ì²˜](assets/multi_agent_system.png)

```{python}
from langchain_openai import ChatOpenAI
from langchain_teddynote.tools.tavily import TavilySearch
from langchain_core.messages import HumanMessage, SystemMessage
from langgraph.checkpoint.memory import MemorySaver
from langgraph.prebuilt import create_react_agent
from typing import Annotated, Literal
from pydantic import BaseModel

# ë©”ëª¨ë¦¬ ì„¤ì • (ê³µìœ  ë©”ëª¨ë¦¬)
memory = MemorySaver()

# ëª¨ë¸ ì„¤ì •
model = ChatOpenAI(model_name="gpt-4o-mini")
supervisor_model = ChatOpenAI(model_name="gpt-4o")
```

## íŠ¹í™” ì—ì´ì „íŠ¸ ì •ì˜

### ì—°êµ¬ ì—ì´ì „íŠ¸ (Researcher)

```{python}
from langchain_teddynote.tools.tavily import TavilySearch

# ì›¹ ê²€ìƒ‰ ë„êµ¬
web_search = TavilySearch(
    topic="general",
    max_results=5,
    include_answer=False,
)

# ì—°êµ¬ ì—ì´ì „íŠ¸ ì‹œìŠ¤í…œ í”„ë¡¬í”„íŠ¸
researcher_prompt = """ë‹¹ì‹ ì€ ì „ë¬¸ ì—°êµ¬ì›(Researcher)ì…ë‹ˆë‹¤.

**ì—­í• :**
- ì›¹ì—ì„œ ìµœì‹  ì •ë³´, í†µê³„, ë‰´ìŠ¤ë¥¼ ê²€ìƒ‰
- ë‹¤ì–‘í•œ ì†ŒìŠ¤ì—ì„œ ì •ë³´ ìˆ˜ì§‘
- íŒ©íŠ¸ ì²´í¬ ë° ê²€ì¦

**ì‘ì—… ì§€ì¹¨:**
1. ê²€ìƒ‰ í‚¤ì›Œë“œë¥¼ ì‹ ì¤‘í•˜ê²Œ ì„ íƒ
2. ì—¬ëŸ¬ ì†ŒìŠ¤ êµì°¨ ê²€ì¦
3. ì¶œì²˜ë¥¼ ëª…í™•íˆ ê¸°ë¡
4. ìš”ì•½ì€ ê°„ê²°í•˜ê³  ì •í™•í•˜ê²Œ

**ì¶œë ¥ í˜•ì‹:**
- ê²€ìƒ‰ ê²°ê³¼: [ì†ŒìŠ¤] ë‚´ìš©
- ì£¼ìš” ë°œê²¬: í•µì‹¬ ì •ë³´ ìš”ì•½
- ì¶œì²˜ ë§í¬: URL ëª©ë¡"""

# ì—°êµ¬ ì—ì´ì „íŠ¸ ìƒì„±
researcher = create_react_agent(
    model,
    [web_search],
    state_modifier=SystemMessage(content=researcher_prompt)
)
```

### ë¶„ì„ ì—ì´ì „íŠ¸ (Analyst)

```{python}
from langchain_community.agent_toolkits import FileManagementToolkit

# íŒŒì¼ ê´€ë¦¬ ë„êµ¬
file_tools = FileManagementToolkit(root_dir="tmp").get_tools()

# ë¶„ì„ ì—ì´ì „íŠ¸ ì‹œìŠ¤í…œ í”„ë¡¬í”„íŠ¸
analyst_prompt = """ë‹¹ì‹ ì€ ì „ë¬¸ ë°ì´í„° ë¶„ì„ê°€(Analyst)ì…ë‹ˆë‹¤.

**ì—­í• :**
- ìˆ˜ì§‘ëœ ë°ì´í„° ë¶„ì„ ë° í•´ì„
- íŠ¸ë Œë“œ, íŒ¨í„´, ì¸ì‚¬ì´íŠ¸ ë„ì¶œ
- í†µê³„ì  ë¶„ì„ ë° ì‹œê°í™”

**ì‘ì—… ì§€ì¹¨:**
1. ë°ì´í„°ì˜ ì‹ ë¢°ì„± í‰ê°€
2. ì •ëŸ‰ì /ì •ì„±ì  ë¶„ì„ ë³‘í–‰
3. ë¹„êµ ë¶„ì„ ë° ë²¤ì¹˜ë§ˆí‚¹
4. ì‹¤í–‰ ê°€ëŠ¥í•œ ì¸ì‚¬ì´íŠ¸ ë„ì¶œ

**ì¶œë ¥ í˜•ì‹:**
- ì£¼ìš” ë°œê²¬ì‚¬í•­
- ë°ì´í„° ê¸°ë°˜ ì¸ì‚¬ì´íŠ¸
- ì‹œì‚¬ì  ë° ê¶Œì¥ì‚¬í•­
- ë¶„ì„ ê·¼ê±°"""

# ë¶„ì„ ì—ì´ì „íŠ¸ ìƒì„±
analyst = create_react_agent(
    model,
    file_tools,
    state_modifier=SystemMessage(content=analyst_prompt)
)
```

### ì‘ì„± ì—ì´ì „íŠ¸ (Writer)

```{python}
# ì‘ì„± ì—ì´ì „íŠ¸ ì‹œìŠ¤í…œ í”„ë¡¬í”„íŠ¸
writer_prompt = """ë‹¹ì‹ ì€ ì „ë¬¸ ì‘ê°€(Writer)ì…ë‹ˆë‹¤.

**ì—­í• :**
- ì—°êµ¬ ë° ë¶„ì„ ê²°ê³¼ë¥¼ ë³´ê³ ì„œë¡œ ì‘ì„±
- ëª…í™•í•˜ê³  ì„¤ë“ë ¥ ìˆëŠ” ë¬¸ì„œ ì‘ì„±
- ëŒ€ìƒ ë…ìì— ë§ëŠ” í†¤ì•¤ë§¤ë„ˆ ì¡°ì ˆ

**ì‘ì—… ì§€ì¹¨:**
1. ë…¼ë¦¬ì  êµ¬ì¡°ë¡œ ë¬¸ì„œ êµ¬ì„±
2. ì „ë¬¸ ìš©ì–´ ì ì ˆíˆ ì‚¬ìš©
3. ì‹œê° ìë£Œ(í‘œ, ì°¨íŠ¸) í™œìš©
4. ìš”ì•½ ë° ê²°ë¡  ëª…í™•íˆ ì œì‹œ

**ì¶œë ¥ í˜•ì‹:**
- Markdown í˜•ì‹
- ì„¹ì…˜ë³„ í—¤ë”© êµ¬ì¡°
- ìš”ì  ì •ë¦¬ í…Œì´ë¸”
- ì°¸ê³  ìë£Œ ë§í¬"""

# ì‘ì„± ì—ì´ì „íŠ¸ ìƒì„±
writer = create_react_agent(
    model,
    file_tools,
    state_modifier=SystemMessage(content=writer_prompt)
)
```

### ì½”ë“œ ì—ì´ì „íŠ¸ (Coder)

```{python}
# ì½”ë“œ ì—ì´ì „íŠ¸ ì‹œìŠ¤í…œ í”„ë¡¬í”„íŠ¸
coder_prompt = """ë‹¹ì‹ ì€ ì „ë¬¸ ê°œë°œì(Coder)ì…ë‹ˆë‹¤.

**ì—­í• :**
- ë°ì´í„° ì²˜ë¦¬ ìŠ¤í¬ë¦½íŠ¸ ì‘ì„±
- ë¶„ì„ ì½”ë“œ êµ¬í˜„
- ìë™í™” ë„êµ¬ ê°œë°œ

**ì‘ì—… ì§€ì¹¨:**
1. ê¹¨ë—í•˜ê³  ìœ ì§€ë³´ìˆ˜ ê°€ëŠ¥í•œ ì½”ë“œ
2. ì ì ˆí•œ ì£¼ì„ ë° ë¬¸ì„œí™”
3. ì—ëŸ¬ ì²˜ë¦¬ ë° ê²€ì¦
4. ì¬ì‚¬ìš© ê°€ëŠ¥í•œ í•¨ìˆ˜ ì‘ì„±

**ì¶œë ¥ í˜•ì‹:**
- Python ì½”ë“œ ë¸”ë¡
- ì‹¤í–‰ ë°©ë²• ì„¤ëª…
- ì…ì¶œë ¥ ì˜ˆì‹œ
- ì˜ì¡´ì„± ëª©ë¡"""

# ì½”ë“œ ì—ì´ì „íŠ¸ ìƒì„±
coder = create_react_agent(
    model,
    file_tools,
    state_modifier=SystemMessage(content=coder_prompt)
)
```

## Supervisor êµ¬í˜„

### Supervisor ë¼ìš°íŒ… ë¡œì§

```{python}
from typing import Literal
from pydantic import BaseModel

class RouteDecision(BaseModel):
    """ì‘ì—… ë¼ìš°íŒ… ê²°ì •"""
    next_agent: Literal["researcher", "analyst", "writer", "coder", "FINISH"]
    reasoning: str

supervisor_prompt = """ë‹¹ì‹ ì€ í”„ë¡œì íŠ¸ ë§¤ë‹ˆì €(Supervisor)ì…ë‹ˆë‹¤.

íŒ€ì›:
- **researcher**: ì›¹ ê²€ìƒ‰ ë° ì •ë³´ ìˆ˜ì§‘ ì „ë¬¸
- **analyst**: ë°ì´í„° ë¶„ì„ ë° ì¸ì‚¬ì´íŠ¸ ë„ì¶œ ì „ë¬¸
- **writer**: ë¬¸ì„œ ì‘ì„± ë° ë³´ê³ ì„œ ì‘ì„± ì „ë¬¸
- **coder**: ì½”ë“œ ì‘ì„± ë° ìë™í™” ì „ë¬¸

**ì‘ì—… ë¶„ë°° ì›ì¹™:**
1. ìµœì‹  ì •ë³´ í•„ìš” â†’ researcher
2. ë°ì´í„° ë¶„ì„ í•„ìš” â†’ analyst
3. ë¬¸ì„œ ì‘ì„± í•„ìš” â†’ writer
4. ì½”ë“œ êµ¬í˜„ í•„ìš” â†’ coder
5. ëª¨ë“  ì‘ì—… ì™„ë£Œ â†’ FINISH

**í˜„ì¬ ìƒí™©:**
{context}

**ë‹¤ìŒ ì‘ì—…ì„ ë‹´ë‹¹í•  íŒ€ì›ì„ ì„ íƒí•˜ê³  ì´ìœ ë¥¼ ì„¤ëª…í•˜ì„¸ìš”.**"""

def create_supervisor_chain():
    """Supervisor ì²´ì¸ ìƒì„±"""
    from langchain_core.prompts import ChatPromptTemplate
    
    prompt = ChatPromptTemplate.from_messages([
        ("system", supervisor_prompt),
        ("human", "{input}"),
    ])
    
    return prompt | supervisor_model.with_structured_output(RouteDecision)
```

## Multi-Agent ê·¸ë˜í”„ êµ¬ì¶•

### ìƒíƒœ ì •ì˜

```{python}
from typing import Annotated, TypedDict
from langgraph.graph.message import add_messages

class MultiAgentState(TypedDict):
    """Multi-Agent ì‹œìŠ¤í…œ ìƒíƒœ"""
    messages: Annotated[list, add_messages]
    next_agent: str
    research_results: str
    analysis_results: str
    code_results: str
    final_report: str
```

### ì—ì´ì „íŠ¸ ë…¸ë“œ ì •ì˜

```{python}
def researcher_node(state: MultiAgentState) -> MultiAgentState:
    """ì—°êµ¬ ì—ì´ì „íŠ¸ ë…¸ë“œ"""
    result = researcher.invoke(state)
    
    return {
        **state,
        "messages": result["messages"],
        "research_results": result["messages"][-1].content,
    }

def analyst_node(state: MultiAgentState) -> MultiAgentState:
    """ë¶„ì„ ì—ì´ì „íŠ¸ ë…¸ë“œ"""
    # ì—°êµ¬ ê²°ê³¼ë¥¼ ì»¨í…ìŠ¤íŠ¸ë¡œ ì¶”ê°€
    context = f"ì—°êµ¬ ê²°ê³¼:\n{state.get('research_results', '')}"
    
    messages = state["messages"] + [
        HumanMessage(content=f"{context}\n\nìœ„ ì •ë³´ë¥¼ ë¶„ì„í•´ì£¼ì„¸ìš”.")
    ]
    
    result = analyst.invoke({"messages": messages})
    
    return {
        **state,
        "messages": result["messages"],
        "analysis_results": result["messages"][-1].content,
    }

def writer_node(state: MultiAgentState) -> MultiAgentState:
    """ì‘ì„± ì—ì´ì „íŠ¸ ë…¸ë“œ"""
    # ì—°êµ¬ ë° ë¶„ì„ ê²°ê³¼ë¥¼ ì»¨í…ìŠ¤íŠ¸ë¡œ ì¶”ê°€
    context = f"""
    ì—°êµ¬ ê²°ê³¼:
    {state.get('research_results', '')}
    
    ë¶„ì„ ê²°ê³¼:
    {state.get('analysis_results', '')}
    """
    
    messages = state["messages"] + [
        HumanMessage(content=f"{context}\n\nìœ„ ë‚´ìš©ì„ ë°”íƒ•ìœ¼ë¡œ ë³´ê³ ì„œë¥¼ ì‘ì„±í•´ì£¼ì„¸ìš”.")
    ]
    
    result = writer.invoke({"messages": messages})
    
    return {
        **state,
        "messages": result["messages"],
        "final_report": result["messages"][-1].content,
    }

def coder_node(state: MultiAgentState) -> MultiAgentState:
    """ì½”ë“œ ì—ì´ì „íŠ¸ ë…¸ë“œ"""
    result = coder.invoke(state)
    
    return {
        **state,
        "messages": result["messages"],
        "code_results": result["messages"][-1].content,
    }
```

### Supervisor ë…¸ë“œ

```{python}
def supervisor_node(state: MultiAgentState) -> MultiAgentState:
    """Supervisor ë…¸ë“œ - ë‹¤ìŒ ì—ì´ì „íŠ¸ ê²°ì •"""
    supervisor_chain = create_supervisor_chain()
    
    # í˜„ì¬ ìƒí™© ì»¨í…ìŠ¤íŠ¸
    context = f"""
    ì´ë¯¸ ì™„ë£Œëœ ì‘ì—…:
    - ì—°êµ¬: {'âœ…' if state.get('research_results') else 'âŒ'}
    - ë¶„ì„: {'âœ…' if state.get('analysis_results') else 'âŒ'}
    - ì½”ë“œ: {'âœ…' if state.get('code_results') else 'âŒ'}
    - ë³´ê³ ì„œ: {'âœ…' if state.get('final_report') else 'âŒ'}
    
    ìµœê·¼ ë©”ì‹œì§€:
    {state['messages'][-1].content if state['messages'] else 'ì—†ìŒ'}
    """
    
    decision = supervisor_chain.invoke({
        "context": context,
        "input": state["messages"][-1].content if state["messages"] else ""
    })
    
    return {
        **state,
        "next_agent": decision.next_agent,
    }
```

### ê·¸ë˜í”„ êµ¬ì„±

```{python}
from langgraph.graph import StateGraph, START, END

def route_to_agent(state: MultiAgentState) -> str:
    """ë‹¤ìŒ ì—ì´ì „íŠ¸ë¡œ ë¼ìš°íŒ…"""
    return state.get("next_agent", "FINISH")

# ê·¸ë˜í”„ ìƒì„±
workflow = StateGraph(MultiAgentState)

# ë…¸ë“œ ì¶”ê°€
workflow.add_node("supervisor", supervisor_node)
workflow.add_node("researcher", researcher_node)
workflow.add_node("analyst", analyst_node)
workflow.add_node("writer", writer_node)
workflow.add_node("coder", coder_node)

# ì—£ì§€ ì¶”ê°€
workflow.add_edge(START, "supervisor")
workflow.add_conditional_edges(
    "supervisor",
    route_to_agent,
    {
        "researcher": "researcher",
        "analyst": "analyst",
        "writer": "writer",
        "coder": "coder",
        "FINISH": END,
    }
)

# ê° ì—ì´ì „íŠ¸ì—ì„œ Supervisorë¡œ ëŒì•„ê°€ê¸°
workflow.add_edge("researcher", "supervisor")
workflow.add_edge("analyst", "supervisor")
workflow.add_edge("writer", "supervisor")
workflow.add_edge("coder", "supervisor")

# ì»´íŒŒì¼
multi_agent_system = workflow.compile(checkpointer=memory)
```

**ê·¸ë˜í”„ êµ¬ì¡°:**
- **supervisor**: ì‘ì—… ë¶„ë°° ë° ì¡°ìœ¨
- **researcher â†’ analyst â†’ writer**: ì¼ë°˜ì ì¸ íë¦„
- **coder**: í•„ìš” ì‹œ ë³‘ë ¬ ì‹¤í–‰
- **ìˆœí™˜ êµ¬ì¡°**: ê° ì—ì´ì „íŠ¸ â†’ supervisor â†’ ë‹¤ìŒ ì—ì´ì „íŠ¸

## ì‹¤í–‰ í•¨ìˆ˜ ì •ì˜

### ìŠ¤íŠ¸ë¦¬ë° ì¶œë ¥

```{python}
from langchain_teddynote.messages import stream_graph

def run_multi_agent_system(instruction: str, thread_id: str = "main"):
    """Multi-Agent ì‹œìŠ¤í…œ ì‹¤í–‰"""
    config = {"configurable": {"thread_id": thread_id}}
    inputs = {
        "messages": [HumanMessage(content=instruction)],
        "next_agent": "supervisor"
    }
    
    for step in multi_agent_system.stream(inputs, config):
        node_name = list(step.keys())[0]
        print(f"\n{'='*50}")
        print(f"ğŸ“ Current Agent: {node_name}")
        print(f"{'='*50}")
        
        if node_name == "supervisor":
            next_agent = step[node_name].get("next_agent", "")
            print(f"â¡ï¸ Next Agent: {next_agent}")
        else:
            messages = step[node_name].get("messages", [])
            if messages:
                print(messages[-1].content[:500])
```

## ì‚¬ìš© ì˜ˆì‹œ

### ì˜ˆì‹œ 1: ì¢…í•© ì‹œì¥ ì¡°ì‚¬

```{python}
instruction = """
AI ì—ì´ì „íŠ¸ ì‹œì¥ì— ëŒ€í•œ ì¢…í•© ì¡°ì‚¬ ë³´ê³ ì„œë¥¼ ì‘ì„±í•´ì£¼ì„¸ìš”.

ë‹¤ìŒ ë‹¨ê³„ë¥¼ ìˆ˜í–‰í•˜ì„¸ìš”:
1. ìµœì‹  ì‹œì¥ ë™í–¥ ë° í†µê³„ ì¡°ì‚¬ (ì›¹ ê²€ìƒ‰)
2. ìˆ˜ì§‘ëœ ë°ì´í„° ë¶„ì„ (íŠ¸ë Œë“œ, ê¸°íšŒ, ìœ„í˜‘)
3. Pythonìœ¼ë¡œ ê°„ë‹¨í•œ ì‹œê°í™” ì½”ë“œ ì‘ì„±
4. ìµœì¢… ë³´ê³ ì„œ ì‘ì„± (ë§ˆí¬ë‹¤ìš´ í˜•ì‹)

ë³´ê³ ì„œëŠ” executive summary, ì‹œì¥ ë¶„ì„, ê¸°ìˆ  íŠ¸ë Œë“œ, ê²°ë¡  ì„¹ì…˜ìœ¼ë¡œ êµ¬ì„±í•˜ì„¸ìš”.
"""

run_multi_agent_system(instruction)
```

**ì‹¤í–‰ íë¦„:**

```
1. Supervisor â†’ "ë¨¼ì € ìµœì‹  ì •ë³´ê°€ í•„ìš”í•˜ë¯€ë¡œ researcher"
2. Researcher â†’ ì›¹ ê²€ìƒ‰ ìˆ˜í–‰, ì‹œì¥ ë°ì´í„° ìˆ˜ì§‘
3. Supervisor â†’ "ë°ì´í„° ë¶„ì„ì´ í•„ìš”í•˜ë¯€ë¡œ analyst"
4. Analyst â†’ ì—°êµ¬ ê²°ê³¼ ë¶„ì„, ì¸ì‚¬ì´íŠ¸ ë„ì¶œ
5. Supervisor â†’ "ì‹œê°í™” ì½”ë“œê°€ í•„ìš”í•˜ë¯€ë¡œ coder"
6. Coder â†’ Python ì‹œê°í™” ì½”ë“œ ì‘ì„±
7. Supervisor â†’ "ë³´ê³ ì„œ ì‘ì„±ì´ í•„ìš”í•˜ë¯€ë¡œ writer"
8. Writer â†’ ìµœì¢… ë³´ê³ ì„œ ì‘ì„±
9. Supervisor â†’ "ëª¨ë“  ì‘ì—… ì™„ë£Œ" â†’ FINISH
```

### ì˜ˆì‹œ 2: ê²½ìŸì‚¬ ë¶„ì„ í”„ë¡œì íŠ¸

```{python}
instruction = """
ì£¼ìš” ê²½ìŸì‚¬ 3ê³³(OpenAI, Anthropic, Google)ì˜ AI ì—ì´ì „íŠ¸ ì œí’ˆì„ ë¹„êµ ë¶„ì„í•˜ëŠ” í”„ë¡œì íŠ¸ë¥¼ ì§„í–‰í•˜ì„¸ìš”.

ë‹¨ê³„:
1. ê° ê²½ìŸì‚¬ì˜ ìµœì‹  ì œí’ˆ ì •ë³´ ìˆ˜ì§‘
2. ê¸°ëŠ¥, ê°€ê²©, ì„±ëŠ¥ ë¹„êµ ë¶„ì„
3. ë¹„êµ í‘œ ìƒì„± Python ìŠ¤í¬ë¦½íŠ¸ ì‘ì„±
4. ê²½ìŸ ë¶„ì„ ë³´ê³ ì„œ ì‘ì„± (ê°•ì /ì•½ì /ê¸°íšŒ/ìœ„í˜‘)

ìµœì¢… ê²°ê³¼ë¬¼ì€ ë§ˆí¬ë‹¤ìš´ ë³´ê³ ì„œì™€ Python ìŠ¤í¬ë¦½íŠ¸ì…ë‹ˆë‹¤.
"""

run_multi_agent_system(instruction)
```

**ë³‘ë ¬ ì²˜ë¦¬ ì˜ˆì‹œ:**
- Researcher: 3ê°œ ê²½ìŸì‚¬ ì •ë³´ë¥¼ ë³‘ë ¬ë¡œ ìˆ˜ì§‘ ê°€ëŠ¥
- Coder: ë¶„ì„ê³¼ ë…ë¦½ì ìœ¼ë¡œ ìŠ¤í¬ë¦½íŠ¸ ì‘ì„±

### ì˜ˆì‹œ 3: ìë™í™”ëœ ë‰´ìŠ¤ë ˆí„° ìƒì„±

```{python}
instruction = """
ì£¼ê°„ AI ë‰´ìŠ¤ë ˆí„°ë¥¼ ìë™ìœ¼ë¡œ ìƒì„±í•˜ì„¸ìš”.

ìš”êµ¬ì‚¬í•­:
1. ì´ë²ˆ ì£¼ AI ê´€ë ¨ ì£¼ìš” ë‰´ìŠ¤ 5ê°œ ìˆ˜ì§‘
2. ê° ë‰´ìŠ¤ì˜ ìš”ì•½ ë° ì‹œì‚¬ì  ë¶„ì„
3. ë‰´ìŠ¤ë ˆí„° HTML í…œí”Œë¦¿ ìƒì„± ì½”ë“œ ì‘ì„±
4. ìµœì¢… ë‰´ìŠ¤ë ˆí„° ì‘ì„± (ì œëª©, ë³¸ë¬¸, ë§í¬)

ì¶œë ¥: newsletter.html íŒŒì¼
"""

run_multi_agent_system(instruction)
```

## ê³ ê¸‰ ê¸°ë²•

### ì—ì´ì „íŠ¸ ê°„ ì§ì ‘ í†µì‹ 

```{python}
class AgentMessage(BaseModel):
    """ì—ì´ì „íŠ¸ ê°„ ë©”ì‹œì§€"""
    from_agent: str
    to_agent: str
    content: str
    priority: int = 0

def send_message(from_agent: str, to_agent: str, content: str, state: MultiAgentState):
    """ì—ì´ì „íŠ¸ ê°„ ì§ì ‘ ë©”ì‹œì§€ ì „ì†¡"""
    message = AgentMessage(
        from_agent=from_agent,
        to_agent=to_agent,
        content=content
    )
    
    # ë©”ì‹œì§€ íì— ì¶”ê°€
    state.setdefault("message_queue", []).append(message)
    
    return state
```

### ë™ì  ì—ì´ì „íŠ¸ ìƒì„±

```{python}
def create_specialized_agent(domain: str, tools: list):
    """ë„ë©”ì¸ë³„ íŠ¹í™” ì—ì´ì „íŠ¸ ë™ì  ìƒì„±"""
    
    prompt = f"""ë‹¹ì‹ ì€ {domain} ì „ë¬¸ê°€ì…ë‹ˆë‹¤.
    
    ì „ë¬¸ ë¶„ì•¼ì— ëŒ€í•œ ê¹Šì€ ì§€ì‹ì„ í™œìš©í•˜ì—¬ ì‘ì—…ì„ ìˆ˜í–‰í•˜ì„¸ìš”.
    """
    
    return create_react_agent(
        model,
        tools,
        state_modifier=SystemMessage(content=prompt)
    )

# ì‹¤í–‰ ì¤‘ ìƒˆ ì—ì´ì „íŠ¸ ì¶”ê°€
if "ë²•ë¥  ìë¬¸ì´ í•„ìš”í•¨":
    legal_agent = create_specialized_agent("ë²•ë¥ ", legal_tools)
    workflow.add_node("legal_expert", legal_agent)
```

### ì—ì´ì „íŠ¸ ì„±ëŠ¥ ëª¨ë‹ˆí„°ë§

```{python}
from datetime import datetime

class AgentMetrics(BaseModel):
    """ì—ì´ì „íŠ¸ ì„±ëŠ¥ ë©”íŠ¸ë¦­"""
    agent_name: str
    task_count: int = 0
    success_count: int = 0
    avg_time: float = 0.0
    last_execution: datetime = None

def track_agent_performance(agent_name: str, execution_time: float, success: bool):
    """ì—ì´ì „íŠ¸ ì„±ëŠ¥ ì¶”ì """
    metrics = AgentMetrics(agent_name=agent_name)
    
    metrics.task_count += 1
    if success:
        metrics.success_count += 1
    
    # í‰ê·  ì‹œê°„ ì—…ë°ì´íŠ¸
    metrics.avg_time = (metrics.avg_time * (metrics.task_count - 1) + execution_time) / metrics.task_count
    metrics.last_execution = datetime.now()
    
    return metrics
```

### ì—ì´ì „íŠ¸ ìš°ì„ ìˆœìœ„ í

```{python}
import heapq

class TaskQueue:
    """ìš°ì„ ìˆœìœ„ ê¸°ë°˜ ì‘ì—… í"""
    
    def __init__(self):
        self.queue = []
    
    def add_task(self, priority: int, agent_name: str, task: dict):
        """ì‘ì—… ì¶”ê°€ (ìš°ì„ ìˆœìœ„ ë†’ì„ìˆ˜ë¡ ë¨¼ì € ì‹¤í–‰)"""
        heapq.heappush(self.queue, (-priority, agent_name, task))
    
    def get_next_task(self):
        """ë‹¤ìŒ ì‘ì—… ê°€ì ¸ì˜¤ê¸°"""
        if self.queue:
            priority, agent_name, task = heapq.heappop(self.queue)
            return agent_name, task
        return None, None
```

## Multi-Agent íŒ¨í„´ ë¹„êµ

| íŒ¨í„´ | ì¥ì  | ë‹¨ì  | ì‚¬ìš© ì¼€ì´ìŠ¤ |
|------|------|------|------------|
| **Supervisor** | ëª…í™•í•œ ì¡°ìœ¨, ì¶”ì  ìš©ì´ | ë³‘ëª© ê°€ëŠ¥, ì¤‘ì•™ ì˜ì¡´ì„± | ìˆœì°¨ì  ì‘ì—…, ë³µì¡í•œ ì›Œí¬í”Œë¡œìš° |
| **Hierarchical** | í™•ì¥ì„±, ëª…í™•í•œ ì—­í•  | êµ¬í˜„ ë³µì¡, ì˜¤ë²„í—¤ë“œ | ëŒ€ê·œëª¨ ì¡°ì§, ê³„ì¸µì  ì‘ì—… |
| **Peer-to-Peer** | ìœ ì—°ì„±, ë¶„ì‚° ì²˜ë¦¬ | ì¡°ìœ¨ ì–´ë ¤ì›€, ì¶©ëŒ ê°€ëŠ¥ | ë…ë¦½ì  ì‘ì—…, ë™ì  í˜‘ì—… |

## ë² ìŠ¤íŠ¸ í”„ë™í‹°ìŠ¤

### ì—ì´ì „íŠ¸ ì—­í•  ëª…í™•í™”

```python
# âŒ ë‚˜ìœ ì˜ˆ
agent = create_react_agent(model, all_tools)

# âœ… ì¢‹ì€ ì˜ˆ
researcher = create_react_agent(
    model,
    [web_search],  # íŠ¹í™”ëœ ë„êµ¬ë§Œ
    state_modifier=SystemMessage(content=researcher_prompt)  # ëª…í™•í•œ ì—­í• 
)
```

### ì—ì´ì „íŠ¸ ìˆ˜ ìµœì í™”

```python
# âŒ ë„ˆë¬´ ë§ì€ ì—ì´ì „íŠ¸
# 10ê°œ ì´ìƒ â†’ ì¡°ìœ¨ ë³µì¡ë„ ì¦ê°€

# âœ… ì ì ˆí•œ ìˆ˜
# 3-5ê°œ â†’ ëª…í™•í•œ í˜‘ì—… êµ¬ì¡°
```

### í†µì‹  í”„ë¡œí† ì½œ ì •ì˜

```python
# âœ… í‘œì¤€í™”ëœ ë©”ì‹œì§€ í˜•ì‹
class StandardMessage(BaseModel):
    sender: str
    receiver: str
    message_type: Literal["request", "response", "notification"]
    content: str
    metadata: dict = {}
```

## íŠ¸ëŸ¬ë¸”ìŠˆíŒ…

### ë¬¸ì œ 1: ì—ì´ì „íŠ¸ ê°„ ë¬´í•œ ë£¨í”„

```python
def detect_loop(state: MultiAgentState, max_iterations: int = 10):
    """ë¬´í•œ ë£¨í”„ ê°ì§€"""
    if len(state.get("messages", [])) > max_iterations:
        raise ValueError("ë¬´í•œ ë£¨í”„ ê°ì§€: ìµœëŒ€ ë°˜ë³µ íšŸìˆ˜ ì´ˆê³¼")
```

### ë¬¸ì œ 2: ì—ì´ì „íŠ¸ ì¶©ëŒ

```python
def resolve_conflict(agent1_result, agent2_result):
    """ì¶©ëŒ í•´ê²°: íˆ¬í‘œ ë˜ëŠ” Supervisor ê²°ì •"""
    # íˆ¬í‘œ ë°©ì‹
    votes = {
        "agent1": 0,
        "agent2": 0,
    }
    
    # Supervisorê°€ ìµœì¢… ê²°ì •
    supervisor_decision = supervisor_model.invoke(
        f"ë‹¤ìŒ ë‘ ê²°ê³¼ ì¤‘ ë” ì í•©í•œ ê²ƒì„ ì„ íƒí•˜ì„¸ìš”:\n1. {agent1_result}\n2. {agent2_result}"
    )
    
    return supervisor_decision
```

### ë¬¸ì œ 3: ë©”ëª¨ë¦¬ ì˜¤ë²„í”Œë¡œìš°

```python
def cleanup_memory(state: MultiAgentState, keep_last_n: int = 10):
    """ë©”ëª¨ë¦¬ ì •ë¦¬: ìµœê·¼ Nê°œ ë©”ì‹œì§€ë§Œ ìœ ì§€"""
    if len(state["messages"]) > keep_last_n:
        state["messages"] = state["messages"][-keep_last_n:]
    
    return state
```

## ì°¸ê³  ìë£Œ

- [Multi-Agent Systems ë…¼ë¬¸](https://arxiv.org/abs/2308.08155)
- [LangGraph Multi-Agent Tutorial](https://langchain-ai.github.io/langgraph/tutorials/multi_agent/)
- [Agent Communication Protocols](https://www.fipa.org/repository/aclspecs.html)

## ë‹¤ìŒ ë‹¨ê³„

Multi-Agent ì‹œìŠ¤í…œì˜ ê¸°ë³¸ì„ ìµí˜”ë‹¤ë©´, ë‹¤ìŒ ì£¼ì œë“¤ì„ ì‚´í´ë³´ì:

- **Agent Orchestration**: ë³µì¡í•œ ì›Œí¬í”Œë¡œìš° ì˜¤ì¼€ìŠ¤íŠ¸ë ˆì´ì…˜
- **Distributed Agent Systems**: ë¶„ì‚° í™˜ê²½ì—ì„œì˜ ì—ì´ì „íŠ¸ ì‹¤í–‰
- **Agent Learning**: ì—ì´ì „íŠ¸ê°€ í˜‘ì—…ì„ í†µí•´ í•™ìŠµí•˜ëŠ” ì‹œìŠ¤í…œ
- **Human-in-the-Loop Multi-Agent**: ì‚¬ëŒê³¼ ì—ì´ì „íŠ¸ì˜ í˜‘ì—…
