---
title: "Agentic RAG"
subtitle: ì—ì´ì „íŠ¸ë¥¼ í™œìš©í•œ ê²€ìƒ‰ ì¦ê°• ìƒì„±
description: |
  ë¬¸ì„œ ê²€ìƒ‰ ë„êµ¬ì™€ ì›¹ ê²€ìƒ‰ ë„êµ¬ë¥¼ í™œìš©í•˜ì—¬ ìµœì‹  ì •ë³´ë¥¼ ê²€ìƒ‰í•˜ê³  ë‹µë³€ì„ ìƒì„±í•˜ëŠ” Agentic RAGë¥¼ ë‹¤ë£¬ë‹¤.
categories:
  - AI
  - RAG
  - LangChain
author: Kwangmin Kim
date: 07/20/2025
format: 
  html:
    page-layout: full
    code-fold: true
    toc: true
    number-sections: true
draft: False
execute:
    eval: false
---

# Agentic RAG

* ìƒí™©ì— ë”°ë¼ ìœ ë™ì ìœ¼ë¡œ LLMì„ ë™ì‘ ì‹œí‚¤ëŠ” ë°©ë²•
* Agentë¥¼ í™œìš©í•œ RAGìœ¼ë¡œ ì ì ˆí•˜ê²Œ RAG, Agent, Agentic RAGì„ ì‚¬ìš©í•´ì•¼ í•¨. ë°˜ë“œì‹œ agentê°€ ì¢‹ì€ ê²ƒì€ ì•„ë‹˜.
    * Agentic RAGì˜ ì¥ì : LLMM ì— toolsì„ ê°œë°œí•´ì£¼ì–´ LLMì´ ì•Œì•„ì„œ íŒë‹¨í•´ì„œ ë¬¸ì œ í•´ê²°ì„ í•¨
    * Chaining RAG: íŠ¹ì • ë¬¸ì„œì—ì„œ ì •ë³´ë¥¼ ì¶”ì¶œí•˜ì—¬ ë‹µë³€í• ë•Œ ì¶©ë¶„í•œ ë°©ë²•
* LLMì—ê²Œ íŒŒì´ì¬ ì½”ë“œë¥¼ ì‹¤í–‰í•  ìˆ˜ ìˆëŠ” toolì„ êµ¬í˜„í•´ì£¼ê³  íŒŒì´ì¬ ì½”ë“œë¥¼ ì§€ì‹œì‚¬í•­ìœ¼ë¡œ ì£¼ê²Œë˜ë©´ íŒŒì´ì¬ ì½”ë“œë¥¼ ë§Œë“¤ì–´ì„œ ì‹¤í–‰ê²°ê³¼ë¥¼ ë°˜í™˜í•  ìˆ˜ ìˆë‹¤
* ë¬¸ì„œì—ì„œ ê²€ìƒ‰ì„ í•˜ê³  ê²€ìƒ‰ëœ ë‚´ìš©ì„ ê¸°ë°˜ìœ¼ë¡œ íŒŒì´ì¬ ì½”ë“œë¥¼ ë§Œë“¤ì–´ ì‹¤í–‰í•œ í›„ ê·¸ ê²°ê³¼ë¥¼ ë°˜í™˜í•˜ëŠ” ê²ƒë„ ê°€ëŠ¥
* ë¬¸ì„œ ê²€ìƒ‰ì„ í†µí•´ ìµœì‹  ì •ë³´ì— ì ‘ê·¼í•˜ì—¬ ê²€ìƒ‰ ê²°ê³¼ë¥¼ ê°€ì§€ê³  ë‹µë³€ì„ ìƒì„±í•˜ëŠ” ì—ì´ì „íŠ¸ë¥¼ ë§Œë“¤ì–´ ë³¸ë‹¤.
* ì§ˆë¬¸ì— ë”°ë¼ ë¬¸ì„œë¥¼ ê²€ìƒ‰í•˜ì—¬ ë‹µë³€í•˜ê±°ë‚˜, ì¸í„°ë„· ê²€ìƒ‰ ë„êµ¬ë¥¼ í™œìš©í•˜ì—¬ ë‹µë³€í•˜ëŠ” ì—ì´ì „íŠ¸ë¥¼ ë§Œë“¤ì–´ ë³¸ë‹¤.


**ì°¸ê³ **

- RAG ë¥¼ ìˆ˜í–‰í•˜ë˜, Agent ë¥¼ í™œìš©í•˜ì—¬ RAG ë¥¼ ìˆ˜í–‰í•œë‹¤ë©´ ì´ë¥¼ **Agentic RAG** ë¼ê³  ë¶€ë¦…ë‹ˆë‹¤.

## ë„êµ¬(Tools)

Agent ê°€ í™œìš©í•  ë„êµ¬ë¥¼ ì •ì˜í•˜ì—¬ Agent ê°€ ì¶”ë¡ (reasoning)ì„ ìˆ˜í–‰í•  ë•Œ í™œìš©í•˜ë„ë¡ ë§Œë“¤ ìˆ˜ ìˆë‹¤.

Tavily Search ëŠ” ê·¸ ì¤‘ ëŒ€í‘œì ì¸ **ê²€ìƒ‰ ë„êµ¬** ë‹¤. ê²€ìƒ‰ì„ í†µí•´ ìµœì‹  ì •ë³´ì— ì ‘ê·¼í•˜ì—¬ ê²€ìƒ‰ ê²°ê³¼ë¥¼ ê°€ì§€ê³  ë‹µë³€ì„ ìƒì„±í•  ìˆ˜ ìˆë‹¤. ë„êµ¬ëŠ” ì´ì²˜ëŸ¼ ê²€ìƒ‰ ë„êµ¬ ë¿ë§Œì•„ë‹ˆë¼ Python ì½”ë“œë¥¼ ì‹¤í–‰í•  ìˆ˜ ìˆëŠ” ë„êµ¬, ì§ì ‘ ì •ì˜í•œ í•¨ìˆ˜ë¥¼ ì‹¤í–‰í•˜ëŠ” ë„êµ¬ ë“± ë‹¤ì–‘í•œ ì¢…ë¥˜ì™€ ë°©ë²•ë¡ ì„ ì œê³µí•œë‹¤.


### ì›¹ ê²€ìƒ‰ë„êµ¬: Tavily Search

LangChainì—ëŠ” Tavily ê²€ìƒ‰ ì—”ì§„ì„ ë„êµ¬ë¡œ ì‰½ê²Œ ì‚¬ìš©í•  ìˆ˜ ìˆëŠ” ë‚´ì¥ ë„êµ¬ê°€ ìˆë‹¤.

Tavily Search ë¥¼ ì‚¬ìš©í•˜ê¸° ìœ„í•´ì„œëŠ” API KEYë¥¼ ë°œê¸‰ ë°›ì•„ì•¼ í•œë‹¤.

- [Tavily Search API ë°œê¸‰ë°›ê¸°](https://app.tavily.com/sign-in)

ë°œê¸‰ ë°›ì€ API KEY ë¥¼ ë‹¤ìŒê³¼ ê°™ì´ í™˜ê²½ë³€ìˆ˜ì— ë“±ë¡ í•œë‹¤.

`.env` íŒŒì¼ì— ë‹¤ìŒê³¼ ê°™ì´ ë“±ë¡í•œë‹¤.

- `TAVILY_API_KEY=ë°œê¸‰ ë°›ì€ Tavily API KEY ì…ë ¥`

```{python}
# API í‚¤ë¥¼ í™˜ê²½ë³€ìˆ˜ë¡œ ê´€ë¦¬í•˜ê¸° ìœ„í•œ ì„¤ì • íŒŒì¼
from dotenv import load_dotenv

# API í‚¤ ì •ë³´ ë¡œë“œ
load_dotenv()
```

```{python}
# LangSmith ì¶”ì ì„ ì„¤ì •í•œë‹¤. https://smith.langchain.com
# !pip install -qU langchain-teddynote
from langchain_teddynote import logging

# í”„ë¡œì íŠ¸ ì´ë¦„ì„ ì…ë ¥í•œë‹¤.
logging.langsmith("CH15-Agentic-RAG")
```

```{python}
# TavilySearchResults í´ë˜ìŠ¤ë¥¼ langchain_community.tools.tavily_search ëª¨ë“ˆì—ì„œ ê°€ì ¸ì˜¨ë‹¤.
from langchain_community.tools.tavily_search import TavilySearchResults

# TavilySearchResults í´ë˜ìŠ¤ì˜ ì¸ìŠ¤í„´ìŠ¤ë¥¼ ìƒì„±í•œë‹¤
# k=6ì€ ê²€ìƒ‰ ê²°ê³¼ë¥¼ 6ê°œê¹Œì§€ ê°€ì ¸ì˜¤ê² ë‹¤ëŠ” ì˜ë¯¸ë‹¤
search = TavilySearchResults(k=6)
```

`search.invoke` í•¨ìˆ˜ëŠ” ì£¼ì–´ì§„ ë¬¸ìì—´ì— ëŒ€í•œ ê²€ìƒ‰ì„ ì‹¤í–‰í•œë‹¤.

`invoke()` í•¨ìˆ˜ì— ê²€ìƒ‰í•˜ê³  ì‹¶ì€ ê²€ìƒ‰ì–´ë¥¼ ë„£ì–´ ê²€ìƒ‰ì„ ìˆ˜í–‰í•œë‹¤.

```{python}
# ê²€ìƒ‰ ê²°ê³¼ë¥¼ ê°€ì ¸ì˜µë‹ˆë‹¤.
search.invoke("íŒêµ ì¹´ì¹´ì˜¤ í”„ë Œì¦ˆìƒµ ì•„ì§€íŠ¸ì ì˜ ì „í™”ë²ˆí˜¸ëŠ” ë¬´ì—‡ì¸ê°€ìš”?")
#k=6 ì´ì§€ë§Œ ê²€ìƒ‰ ê²°ê³¼ê°€ ë” ì ìœ¼ë©´ ê·¸ ê²€ìƒ‰ëœ ìˆ˜ë§Œí¼ ë°˜í™˜ì´ ëœë‹¤. ì•„ë˜ì˜ ì˜ˆì—ì„  5ê°œê°€ ë°˜í™˜
```


```
[{'url': 'https://blog.naver.com/PostView.naver?blogId=amour1115&logNo=223386213560',  'content': 'ì¹´ì¹´ì˜¤ í”„ë Œì¦ˆ íŒêµ ì•„ì§€íŠ¸ì . . ì—°ì¤‘ë¬´íœ´ 12:00-21:00. í† , ì¼ 12:00-20:00. . ê²½ê¸° ì„±ë‚¨ì‹œ ë¶„ë‹¹êµ¬ íŒêµì—­ë¡œ 166. ì¹´ì¹´ì˜¤ íŒêµ ì•„ì§€íŠ¸ 1ì¸µ ì¹´ì¹´ì˜¤ í”„ë Œì¦ˆ. 031-301-7225. ì¡´ì¬í•˜ì§€ ì•ŠëŠ” ì´ë¯¸ì§€ì…ë‹ˆë‹¤.'}, {'url': 'https://kr.trip.com/moments/detail/seongnam-121856-121058702/',  'content': 'ì‚¬ì§„ì°ìœ¼ë©´ì„œ ì‹¤ë‚´ë°ì´íŠ¸ ì¦ê¸°ê³  ì‹¶ë‹¤ë©´ ì£¼ëª©ğŸ“¢ íŒêµì—­ì—ì„œ ê¼­ ê°€ë´ì•¼í•  ì•„ê¸°ìê¸° ê·€ì—¬ìš´ í•«í”Œë ˆì´ìŠ¤ ì¹´ì¹´ì˜¤ í”„ë Œì¦ˆ ìºë¦­í„°ë“¤ì˜ í¬í† ì¡´ì´
(...ì¤‘ëµ...)
ğŸ”–ì¸ìŠ¤íƒ€ì—ì„œ í•«í•˜ë‹¤ëŠ” ëª©ìš•í•˜ëŠ” ì¶˜ì‹ì´â—¡Ìˆ\nì§€ê¸ˆ ì¹´ì¹´ì˜¤ í”„ëœì¦ˆë“¤ì˜ ëŒ€ì„¸ëŠ” ì¶˜ì‹ì´ì¸ê°€ë´ìš”.\n ğŸ”–ì†Œì£¼ë””ìŠ¤íœì„œì£ ë¥´ë”” 39,000ì›\nğŸ”–ì „ë™ì™€ì¸ì˜¤í”„ë„ˆì¹˜ì–¼ìŠ¤ë¼ì´ì–¸\n23,000ì›\nğŸ”–ë¼ì´ì–¸í¬ë¦¬ë¯¸ë§¥ì£¼ê±°í’ˆê¸° 29,000ì›\nğŸ”–í„´í…Œì´ë¸” ìŠ¤í”¼ì»¤\n55,000ì›\nì—¬ê¸´ ìŠ¤í…ë“œë“¤ì˜ ì§‘í•©?ğŸ’¡\nìº¬ì•„ ì¶˜ì‹ì´ í”¼íì–´ì˜ˆìš”!!!\n'}]
```

### ë¬¸ì„œ ê¸°ë°˜ ë¬¸ì„œ ê²€ìƒ‰ ë„êµ¬: Retriever

* ë°ì´í„°ì— ëŒ€í•´ ì¡°íšŒë¥¼ ìˆ˜í–‰í•  retrieverë„ ìƒì„±í•œë‹¤.
* retrieverëŠ” ììœ ë¡­ê²Œ ì»¤ìŠ¤í…€ ê¸°ëŠ¥ì„ ì¶”ê°€/ì‚­ì œí•  ìˆ˜ ìˆì§€ë§Œ ë°˜ë“œì‹œ ë§ˆì§€ë§‰ ê°’ì€ retriever typeì´ì–´ì•¼í•œë‹¤

**ì‹¤ìŠµì— í™œìš©í•œ ë¬¸ì„œ**

ì†Œí”„íŠ¸ì›¨ì–´ì •ì±…ì—°êµ¬ì†Œ(SPRi) - 2023ë…„ 12ì›”í˜¸

- ì €ì: ìœ ì¬í¥(AIì •ì±…ì—°êµ¬ì‹¤ ì±…ì„ì—°êµ¬ì›), ì´ì§€ìˆ˜(AIì •ì±…ì—°êµ¬ì‹¤ ìœ„ì´‰ì—°êµ¬ì›)
- ë§í¬: https://spri.kr/posts/view/23669
- íŒŒì¼ëª…: `SPRI_AI_Brief_2023ë…„12ì›”í˜¸_F.pdf`

_ì‹¤ìŠµì„ ìœ„í•´ ë‹¤ìš´ë¡œë“œ ë°›ì€ íŒŒì¼ì„ `data` í´ë”ë¡œ ë³µì‚¬í•´ ì£¼ê¸° ë°”ë€ë‹¤_

ì´ ì½”ë“œëŠ” ì›¹ ê¸°ë°˜ ë¬¸ì„œ ë¡œë”, ë¬¸ì„œ ë¶„í• ê¸°, ë²¡í„° ì €ì¥ì†Œ, ê·¸ë¦¬ê³  OpenAI ì„ë² ë”©ì„ ì‚¬ìš©í•˜ì—¬ ë¬¸ì„œ ê²€ìƒ‰ ì‹œìŠ¤í…œì„ êµ¬ì¶•í•œë‹¤.

ì—¬ê¸°ì„œëŠ” PDF ë¬¸ì„œë¥¼ `FAISS` DB ì— ì €ì¥í•˜ê³  ì¡°íšŒí•˜ëŠ” retriever ë¥¼ ìƒì„±í•œë‹¤.

```{python}
from langchain.text_splitter import RecursiveCharacterTextSplitter
from langchain_community.vectorstores import FAISS
from langchain_openai import OpenAIEmbeddings
from langchain.document_loaders import PyPDFLoader

# PDF íŒŒì¼ ë¡œë“œ. íŒŒì¼ì˜ ê²½ë¡œ ì…ë ¥
loader = PyPDFLoader("data/SPRI_AI_Brief_2023ë…„12ì›”í˜¸_F.pdf")

# í…ìŠ¤íŠ¸ ë¶„í• ê¸°ë¥¼ ì‚¬ìš©í•˜ì—¬ ë¬¸ì„œë¥¼ ë¶„í• í•œë‹¤.
text_splitter = RecursiveCharacterTextSplitter(chunk_size=1000, chunk_overlap=100)

# ë¬¸ì„œë¥¼ ë¡œë“œí•˜ê³  ë¶„í• í•œë‹¤.
split_docs = loader.load_and_split(text_splitter)

# VectorStoreë¥¼ ìƒì„±í•œë‹¤.
vector = FAISS.from_documents(split_docs, OpenAIEmbeddings())

# Retrieverë¥¼ ìƒì„±í•œë‹¤. (ë°˜ë“œì‹œ ë§ˆì§€ë§‰ ê°’ì€ retriever typeì´ì–´ì•¼í•œë‹¤)
retriever = vector.as_retriever()
```

ì´ í•¨ìˆ˜ëŠ” `retriever` ê°ì²´ì˜ `invoke()` ë¥¼ ì‚¬ìš©í•˜ì—¬ ì‚¬ìš©ìì˜ ì§ˆë¬¸ì— ëŒ€í•œ ê°€ì¥ **ê´€ë ¨ì„± ë†’ì€ ë¬¸ì„œ** ë¥¼ ì°¾ëŠ” ë° ì‚¬ìš©ëœë‹¤.

```{python}
# ë¬¸ì„œì—ì„œ ê´€ë ¨ì„± ë†’ì€ ë¬¸ì„œë¥¼ ê°€ì ¸ì˜µë‹ˆë‹¤.
retriever.invoke("ì‚¼ì„±ì „ìê°€ ê°œë°œí•œ ìƒì„±í˜• AI ê´€ë ¨ ë‚´ìš©ì„ ë¬¸ì„œì—ì„œ ì°¾ì•„ì¤˜")
```


```
[Document(metadata={'source': 'data/SPRI_AI_Brief_2023ë…„12ì›”í˜¸_F.pdf', 'page': 12}, page_content='SPRi AI Brief |  \n2023-12 ì›”í˜¸\n10ì‚¼ì„±ì „ì , ìì²´ ê°œë°œ ìƒì„± AI â€˜ì‚¼ì„± ê°€ìš°ìŠ¤ â€™ ê³µê°œ\nnì‚¼ì„±ì „ìê°€ ì˜¨ë””ë°”ì´ìŠ¤ì—ì„œ ì‘ë™ ê°€ëŠ¥í•˜ë©° ì–¸ì–´, ì½”ë“œ, ì´ë¯¸ì§€ì˜ 3ê°œ ëª¨ë¸ë¡œ êµ¬ì„±ëœ ìì²´ ê°œë°œ ìƒì„± \nAI ëª¨ë¸ â€˜ì‚¼ì„± ê°€ìš°ìŠ¤ â€™ë¥¼ ê³µê°œ\nnì‚¼ì„±ì „ìëŠ” ì‚¼ì„± ê°€ìš°ìŠ¤ë¥¼ ë‹¤ì–‘í•œ ì œí’ˆì— ë‹¨ê³„ì ìœ¼ë¡œ íƒ‘ì¬í•  ê³„íšìœ¼ë¡œ , ì˜¨ë””ë°”ì´ìŠ¤ ì‘ë™ì´ ê°€ëŠ¥í•œ \nì‚¼ì„± ê°€ìš°ìŠ¤ëŠ” ì™¸ë¶€ë¡œ ì‚¬ìš©ì ì •ë³´ê°€ ìœ ì¶œë  ìœ„í—˜ì´ ì—†ë‹¤ëŠ” ì¥ì ì„ ë³´ìœ KEY Contents\nÂ£ì–¸ì–´, ì½”ë“œ, ì´ë¯¸ì§€ì˜ 3ê°œ ëª¨ë¸ë¡œ êµ¬ì„±ëœ ì‚¼ì„± ê°€ìš°ìŠ¤ ,
(...ì¤‘ëµ...)
í•˜ëŠ”ë° ë¨¸ë¬¸ë‹¤ë©´ , ì—ì´ì „íŠ¸ëŠ” ì‚¬ìš©ìì˜ ì—¬í–‰ \níŒ¨í„´ì„ ë¶„ì„í•´ ì—¬í–‰ì§€ë¥¼ ì œì•ˆí•˜ê³  ê´€ì‹¬ì‚¬ì— ë”°ë¥¸ í™œë™ì„ ì¶”ì²œí•˜ë©° ì„ í˜¸í•˜ëŠ” ìŠ¤íƒ€ì¼ì˜ ë ˆìŠ¤í† ë‘ ì˜ˆì•½ë„ ê°€ëŠ¥  \nÂ£AI ì—ì´ì „íŠ¸ê°€ ì˜ë£Œì™€ êµìœ¡, ìƒì‚°ì„± , ì—”í„°í…Œì¸ë¨¼íŠ¸ Â·ì‡¼í•‘ ì˜ì—­ì˜ ì„œë¹„ìŠ¤ ëŒ€ì¤‘í™”ë¥¼ ì£¼ë„í•  ê²ƒ\nnì—ì´ì „íŠ¸ë¡œ ì¸í•´ ì£¼ëª©í•  ë§Œí•œ ë³€í™”ëŠ” ê³ ë¹„ìš© ì„œë¹„ìŠ¤ì˜ ëŒ€ì¤‘í™”ë¡œ íŠ¹íˆ â–³ì˜ë£Œ â–³êµìœ¡ â–³ìƒì‚°ì„± â–³\nì—”í„°í…Œì¸ë¨¼íŠ¸ Â·ì‡¼í•‘ì˜ 4ê°œ ì˜ì—­ì—ì„œ ëŒ€ê·œëª¨ ë³€í™” ì˜ˆìƒ')]
```

ì´ì œ ê²€ìƒ‰ì„ ìˆ˜í–‰í•  ì¸ë±ìŠ¤ë¥¼ ì±„ì› ìœ¼ë¯€ë¡œ, ì´ë¥¼ ì—ì´ì „íŠ¸ê°€ ì œëŒ€ë¡œ ì‚¬ìš©í•  ìˆ˜ ìˆëŠ” ë„êµ¬ë¡œ ì‰½ê²Œ ë³€í™˜í•  ìˆ˜ ìˆë‹¤.

`create_retriever_tool` í•¨ìˆ˜ë¡œ `retriever` ë¥¼ ë„êµ¬ë¡œ ë³€í™˜í•œë‹¤.

```{python}
from langchain.tools.retriever import create_retriever_tool

retriever_tool = create_retriever_tool(
    retriever,
    name="pdf_search",  # ë„êµ¬ì˜ ì´ë¦„ì„ ì…ë ¥í•œë‹¤. ë„êµ¬ ì¸ì§€ê°€ ì˜ ë˜ë„ë¡ í•˜ëŠ” ì—­í• ì„ í•¨
    description="use this tool to search information from the PDF document",  # ë„êµ¬ì— ëŒ€í•œ ì„¤ëª…ì„ ìì„¸íˆ ê¸°ì…í•´ì•¼ í•œë‹¤!!
)
```

### Agent ê°€ ì‚¬ìš©í•  ë„êµ¬ ëª©ë¡ ì •ì˜

ì´ì œ ë‘ ê°€ì§€ë¥¼ ëª¨ë‘ ë§Œë“¤ì—ˆìœ¼ë¯€ë¡œ, Agent ê°€ ì‚¬ìš©í•  ë„êµ¬ ëª©ë¡ì„ ë§Œë“¤ ìˆ˜ ìˆë‹¤.

`tools` ë¦¬ìŠ¤íŠ¸ëŠ” `search`ì™€ `retriever_tool`ì„ í¬í•¨í•œë‹¤. 

```{python}
# tools ë¦¬ìŠ¤íŠ¸ì— searchì™€ retriever_toolì„ ì¶”ê°€í•œë‹¤.
tools = [search, retriever_tool]
```

## Agent ìƒì„±

ì´ì œ ë„êµ¬ë¥¼ ì •ì˜í–ˆìœ¼ë‹ˆ ì—ì´ì „íŠ¸ë¥¼ ìƒì„±í•  ìˆ˜ ìˆë‹¤. 

ë¨¼ì €, Agent ê°€ í™œìš©í•  LLMì„ ì •ì˜í•˜ê³ , Agent ê°€ ì°¸ê³ í•  Prompt ë¥¼ ì •ì˜í•œë‹¤.

**ì°¸ê³ **
- ë©€í‹°í„´ ëŒ€í™”ë¥¼ ì§€ì›í•˜ì§€ ì•ŠëŠ”ë‹¤ë©´ "chat_history" ë¥¼ ì œê±°í•´ë„ ì¢‹ë‹¤.

```{python}
from langchain_openai import ChatOpenAI
from langchain_core.prompts import ChatPromptTemplate

# LLM ì •ì˜
llm = ChatOpenAI(model="gpt-4o-mini", temperature=0)

# Prompt ì •ì˜
prompt = ChatPromptTemplate.from_messages(
    [
        (
            "system",
            "You are a helpful assistant. "
            "Make sure to use the `pdf_search` tool for searching information from the PDF document. "
            "If you can't find the information from the PDF document, use the `search` tool for searching information from the web.",
        ),
        ("placeholder", "{chat_history}"), # ì¶”í›„ì— ì¶”ê°€ë  multi-turn ê¸°ëŠ¥ì„ ìœ„í•´ ì±„íŒ… ê¸°ë¡ì´ ì €ì¥ë˜ì–´ì•¼í•¨.
        ("human", "{input}"),
        ("placeholder", "{agent_scratchpad}"),
    ]
)
```

ë‹¤ìŒìœ¼ë¡œëŠ” Tool Calling Agent ë¥¼ ìƒì„±í•œë‹¤.

```{python}
from langchain.agents import create_tool_calling_agent

# tool calling agent ìƒì„±
agent = create_tool_calling_agent(llm, tools, prompt)
```

ë§ˆì§€ë§‰ìœ¼ë¡œ, ìƒì„±í•œ `agent` ë¥¼ ì‹¤í–‰í•˜ëŠ” `AgentExecutor` ë¥¼ ìƒì„±í•œë‹¤.

**ì°¸ê³ **

- `verbose=False` ë¡œ ì„¤ì •í•˜ì—¬ ì¤‘ê°„ ë‹¨ê³„ ì¶œë ¥ì„ ìƒëµí•˜ì˜€ë‹¤.

```{python}
from langchain.agents import AgentExecutor

# AgentExecutor ìƒì„±
agent_executor = AgentExecutor(agent=agent, tools=tools, verbose=False) #  verbose=True: ì¤‘ê°„ë‹¨ê³„ ì¶œë ¥
```

## ì—ì´ì „íŠ¸ ì‹¤í–‰í•˜ê¸°

ì´ì œ ëª‡ ê°€ì§€ ì§ˆì˜ì— ëŒ€í•´ ì—ì´ì „íŠ¸ë¥¼ ì‹¤í–‰í•  ìˆ˜ ìˆë‹¤!

í˜„ì¬ ì´ëŸ¬í•œ ëª¨ë“  ì§ˆì˜ëŠ” **ìƒíƒœ(Stateless) ê°€ ì—†ëŠ”** ì§ˆì˜ë‹¤(ì´ì „ ìƒí˜¸ì‘ìš©ì„ ê¸°ì–µí•˜ì§€ ì•ŠëŠ”ë‹¤).

`agent_executor` ê°ì²´ì˜ `invoke` ë©”ì†Œë“œëŠ” ë”•ì…”ë„ˆë¦¬ í˜•íƒœì˜ ì¸ìë¥¼ ë°›ì•„ ì²˜ë¦¬í•œë‹¤. ì´ ì˜ˆì œì—ì„œëŠ” `input` í‚¤ì— `hi!` ê°’ì„ í• ë‹¹í•œ ë”•ì…”ë„ˆë¦¬ë¥¼ ì¸ìë¡œ ì „ë‹¬í•˜ê³  ìˆë‹¤. ì´ëŠ” ì¼ë°˜ì ìœ¼ë¡œ AI ì—ì´ì „íŠ¸, í•¨ìˆ˜ ì‹¤í–‰ê¸°, ë˜ëŠ” ëª…ë ¹ ì²˜ë¦¬ê¸° ë“±ì˜ ê°ì²´ì—ì„œ ì…ë ¥ì„ ì²˜ë¦¬í•˜ê¸° ìœ„í•´ ì‚¬ìš©ëœë‹¤.

```{python}
from langchain_teddynote.messages import AgentStreamParser

# ê° ë‹¨ê³„ë³„ ì¶œë ¥ì„ ìœ„í•œ íŒŒì„œ ìƒì„±
agent_stream_parser = AgentStreamParser()
```

```{python}
# ì§ˆì˜ì— ëŒ€í•œ ë‹µë³€ì„ ìŠ¤íŠ¸ë¦¬ë°ìœ¼ë¡œ ì¶œë ¥ ìš”ì²­
result = agent_executor.stream(
    {"input": "2024ë…„ í”„ë¡œì•¼êµ¬ í”Œë ˆì´ì˜¤í”„ ì§„ì¶œí•œ 5ê°œ íŒ€ì„ ê²€ìƒ‰í•˜ì—¬ ì•Œë ¤ì£¼ì„¸ìš”."}
)

for step in result:
    # ì¤‘ê°„ ë‹¨ê³„ë¥¼ parser ë¥¼ ì‚¬ìš©í•˜ì—¬ ë‹¨ê³„ë³„ë¡œ ì¶œë ¥
    agent_stream_parser.process_agent_steps(step)
```

```
[ë„êµ¬ í˜¸ì¶œ]
Tool: tavily_search_results_json
query: 2024ë…„ í”„ë¡œì•¼êµ¬ í”Œë ˆì´ì˜¤í”„ ì§„ì¶œ íŒ€
Log: 
Invoking: `tavily_search_results_json` with `{'query': '2024ë…„ í”„ë¡œì•¼êµ¬ í”Œë ˆì´ì˜¤í”„ ì§„ì¶œ íŒ€'}`



[ê´€ì°° ë‚´ìš©]
Observation: [{'url': 'https://www.yna.co.kr/view/GYH20241003000600044', 'content': '4 days ago Â· ... íŒ€ì˜ ë’¤ì§‘ê¸° ë§ˆë²•ì„ ì„ ì‚¬í•˜ê³  ì¤€í”Œë ˆì´ì˜¤í”„(ì¤€POÂ·5ì „ 3ìŠ¹ì œ)ì— ì§„ì¶œí–ˆë‹¤. ktëŠ” 3ì¼ ì„œìš¸ ì ì‹¤êµ¬ì¥ì—ì„œ ì—´ë¦° 2024 ì‹ í•œ SOLë±…í¬ KBO í¬ìŠ¤íŠ¸ì‹œì¦Œ ì™€ì¼ë“œ\xa0...'},
(...ì¤‘ëµ...)
{'url': 'https://namu.wiki/w/KBO%20%ED%94%8C%EB%A0%88%EC%9D%B4%EC%98%A4%ED%94%84/2024%EB%85%84', 'content': '2024 ì‹ í•œ SOL Bank KBO ë¦¬ê·¸ í˜ë„ŒíŠ¸ë ˆì´ìŠ¤ 2ìœ„ ì‚¼ì„± ë¼ì´ì˜¨ì¦ˆì™€ ì¤€í”Œë ˆì´ì˜¤í”„ ìŠ¹ë¦¬íŒ€ì´ ë§ë¶™ëŠ” ì‹œë¦¬ì¦ˆ.'}]

[ë„êµ¬ í˜¸ì¶œ]
Tool: tavily_search_results_json
query: 2024 KBO í¬ìŠ¤íŠ¸ì‹œì¦Œ ì§„ì¶œ íŒ€
Log: 
Invoking: `tavily_search_results_json` with `{'query': '2024 KBO í¬ìŠ¤íŠ¸ì‹œì¦Œ ì§„ì¶œ íŒ€'}`

[ê´€ì°° ë‚´ìš©]
Observation: [{'url': 'https://www.yna.co.kr/view/GYH20241003000600044', 'content': '4 days ago Â· ... íŒ€ì˜ ë’¤ì§‘ê¸° ë§ˆë²•ì„ ì„ ì‚¬í•˜ê³  ì¤€í”Œë ˆì´ì˜¤í”„(ì¤€POÂ·5ì „ 3ìŠ¹ì œ)ì— ì§„ì¶œí–ˆë‹¤. ktëŠ” 3ì¼ ì„œìš¸ ì ì‹¤êµ¬ì¥ì—ì„œ ì—´ë¦° 2024 ì‹ í•œ SOLë±…í¬ KBO í¬ìŠ¤íŠ¸ì‹œì¦Œ ì™€ì¼ë“œ\xa0...'}, 
(...ì¤‘ëµ...)
{'url': 'http://m.monthly.chosun.com/client/Mdaily/daily_view.asp?Idx=20426&Newsnumb=20241020426', 'content': '5 days ago Â· ì§„ì¶œíŒ€ì€ â–²KIA íƒ€ì´ê±°ì¦ˆ â–²ì‚¼ì„± ë¼ì´ì˜¨ì¦ˆ â–²LG íŠ¸ìœˆìŠ¤ â–²ë‘ì‚° ë² ì–´ìŠ¤ â–²kt wizë‹¤. 2ì¼ ë‘ì‚°ê³¼ KTëŠ” ì„œìš¸ ì ì‹¤êµ¬ì¥ì—ì„œ ì™€ì¼ë“œì¹´ë“œ ê²°ì •ì „ì„ ì¹˜ë¥¸ë‹¤.'}]

[ìµœì¢… ë‹µë³€]
2024ë…„ KBO í”„ë¡œì•¼êµ¬ í¬ìŠ¤íŠ¸ì‹œì¦Œì— ì§„ì¶œí•œ íŒ€ë“¤ì€ ë‹¤ìŒê³¼ ê°™ìŠµë‹ˆë‹¤:

1. KIA íƒ€ì´ê±°ì¦ˆ
2. ì‚¼ì„± ë¼ì´ì˜¨ì¦ˆ
3. LG íŠ¸ìœˆìŠ¤
4. ë‘ì‚° ë² ì–´ìŠ¤
5. KT ìœ„ì¦ˆ

ì´ íŒ€ë“¤ì€ í¬ìŠ¤íŠ¸ì‹œì¦Œì—ì„œ ê²½ìŸí•˜ê²Œ ë©ë‹ˆë‹¤.
```

`agent_executor` ê°ì²´ì˜ `invoke` ë©”ì†Œë“œë¥¼ ì‚¬ìš©í•˜ì—¬, ì§ˆë¬¸ì„ ì…ë ¥ìœ¼ë¡œ ì œê³µí•œë‹¤.

```{python}
# ì§ˆì˜ì— ëŒ€í•œ ë‹µë³€ì„ ìŠ¤íŠ¸ë¦¬ë°ìœ¼ë¡œ ì¶œë ¥ ìš”ì²­
result = agent_executor.stream(
    {"input": "ì‚¼ì„±ì „ìê°€ ìì²´ ê°œë°œí•œ ìƒì„±í˜• AI ê´€ë ¨ëœ ì •ë³´ë¥¼ ë¬¸ì„œì—ì„œ ì°¾ì•„ì£¼ì„¸ìš”."}
)

for step in result:
    # ì¤‘ê°„ ë‹¨ê³„ë¥¼ parser ë¥¼ ì‚¬ìš©í•˜ì—¬ ë‹¨ê³„ë³„ë¡œ ì¶œë ¥
    agent_stream_parser.process_agent_steps(step)
```

```
[ë„êµ¬ í˜¸ì¶œ]
Tool: pdf_search
query: ì‚¼ì„±ì „ì ìƒì„±í˜• AI
Log: 
Invoking: `pdf_search` with `{'query': 'ì‚¼ì„±ì „ì ìƒì„±í˜• AI'}`

[ê´€ì°° ë‚´ìš©]
Observation: SPRi AI Brief |  
2023-12 ì›”í˜¸
10ì‚¼ì„±ì „ì , ìì²´ ê°œë°œ ìƒì„± AI â€˜ì‚¼ì„± ê°€ìš°ìŠ¤ â€™ ê³µê°œ
nì‚¼ì„±ì „ìê°€ ì˜¨ë””ë°”ì´ìŠ¤ì—ì„œ ì‘ë™ ê°€ëŠ¥í•˜ë©° ì–¸ì–´, ì½”ë“œ, ì´ë¯¸ì§€ì˜ 3ê°œ ëª¨ë¸ë¡œ êµ¬ì„±ëœ ìì²´ ê°œë°œ ìƒì„± 
AI ëª¨ë¸ â€˜ì‚¼ì„± ê°€ìš°ìŠ¤ â€™ë¥¼ ê³µê°œ
(...ì¤‘ëµ...)
níŒê²°ë¬¸ì€ ë˜í•œ ìƒì„± AI ëª¨ë¸ í›ˆë ¨ì— ì‚¬ìš©ëœ ëª¨ë“  ì´ë¯¸ì§€ì— ì €ì‘ê¶Œì´ ìˆë‹¤ê±°ë‚˜ , ìƒì„± AIë¡œ ë§Œë“  
ì´ë¯¸ì§€ê°€ ì €ì‘ë¬¼ì„ ì´ìš©í•´ í›ˆë ¨ë˜ì—ˆìœ¼ë¯€ë¡œ ì €ì‘ë¬¼ì˜ íŒŒìƒ ì´ë¯¸ì§€ë¼ëŠ” ì£¼ì¥ì€ ê°œì—°ì„±ì´  ë¶€ì¡±í•˜ë‹¤ê³   
ì§€ì 

[ìµœì¢… ë‹µë³€]
ì‚¼ì„±ì „ìê°€ ìì²´ ê°œë°œí•œ ìƒì„±í˜• AI ëª¨ë¸ 'ì‚¼ì„± ê°€ìš°ìŠ¤'ì— ëŒ€í•œ ì •ë³´ëŠ” ë‹¤ìŒê³¼ ê°™ìŠµë‹ˆë‹¤:

1. **ëª¨ë¸ êµ¬ì„±**: ì‚¼ì„± ê°€ìš°ìŠ¤ëŠ” ì–¸ì–´, ì½”ë“œ, ì´ë¯¸ì§€ì˜ 3ê°œ ëª¨ë¸ë¡œ êµ¬ì„±ë˜ì–´ ìˆìŠµë‹ˆë‹¤. 
   - **ì–¸ì–´ ëª¨ë¸**: ë©”ì¼ ì‘ì„±, ë¬¸ì„œ ìš”ì•½, ë²ˆì—­ ì—…ë¬´ ë“±ì„ ì§€ì›í•©ë‹ˆë‹¤.
   - **ì½”ë“œ ëª¨ë¸**: AI ì½”ë”© ì–´ì‹œìŠ¤í„´íŠ¸ 'ì½”ë“œì•„ì´(code.i)'ë¥¼ í†µí•´ ëŒ€í™”í˜• ì¸í„°í˜ì´ìŠ¤ë¡œ ì„œë¹„ìŠ¤ë¥¼ ì œê³µí•˜ë©°, ì‚¬ë‚´ ì†Œí”„íŠ¸ì›¨ì–´ ê°œë°œì— ìµœì í™”ë˜ì–´ ìˆìŠµë‹ˆë‹¤.
   - **ì´ë¯¸ì§€ ëª¨ë¸**: ì°½ì˜ì ì¸ ì´ë¯¸ì§€ë¥¼ ìƒì„±í•˜ê³  ê¸°ì¡´ ì´ë¯¸ì§€ë¥¼ ìˆ˜ì •í•  ìˆ˜ ìˆìœ¼ë©°, ì €í•´ìƒë„ ì´ë¯¸ì§€ë¥¼ ê³ í•´ìƒë„ë¡œ ë³€í™˜í•˜ëŠ” ê¸°ëŠ¥ë„ ì§€ì›í•©ë‹ˆë‹¤.

2. **ì˜¨ë””ë°”ì´ìŠ¤ ì‘ë™**: ì‚¼ì„± ê°€ìš°ìŠ¤ëŠ” ì˜¨ë””ë°”ì´ìŠ¤ì—ì„œ ì‘ë™í•˜ë„ë¡ ì„¤ê³„ë˜ì–´ ìˆì–´, ì‚¬ìš©ì ì •ë³´ê°€ ì™¸ë¶€ë¡œ ìœ ì¶œë  ìœ„í—˜ì´ ì—†ìŠµë‹ˆë‹¤. ì´ëŠ” ê°œì¸ì •ë³´ ë³´í˜¸ ì¸¡ë©´ì—ì„œ í° ì¥ì ìœ¼ë¡œ ì‘ìš©í•©ë‹ˆë‹¤.

3. **ì¶œì‹œ ë° ê³„íš**: ì‚¼ì„±ì „ìëŠ” 2023ë…„ 11ì›” 8ì¼ 'ì‚¼ì„± AI í¬ëŸ¼ 2023'ì—ì„œ ì‚¼ì„± ê°€ìš°ìŠ¤ë¥¼ ìµœì´ˆ ê³µê°œí•˜ì˜€ìœ¼ë©°, ë‹¤ì–‘í•œ ì œí’ˆì— ë‹¨ê³„ì ìœ¼ë¡œ íƒ‘ì¬í•  ê³„íšì…ë‹ˆë‹¤.

4. **ê¸°ìˆ  íŠ¸ë Œë“œ**: IT ì „ë¬¸ì§€ í…Œí¬ë¦¬í¼ë¸”ë¦­ì— ë”°ë¥´ë©´, ì˜¨ë””ë°”ì´ìŠ¤ AIê°€ ì£¼ìš” ê¸°ìˆ  íŠ¸ë Œë“œë¡œ ë¶€ìƒí•˜ê³  ìˆìœ¼ë©°, 2024ë…„ë¶€í„° ì‚¼ì„± ê°€ìš°ìŠ¤ë¥¼ íƒ‘ì¬í•œ ìŠ¤ë§ˆíŠ¸í°ì´ ë©”íƒ€ì˜ ë¼ë§ˆ(Llama)2ë¥¼ íƒ‘ì¬í•œ í€„ì»´ ê¸°ê¸° ë° êµ¬ê¸€ ì–´ì‹œìŠ¤í„´íŠ¸ë¥¼ ì ìš©í•œ êµ¬ê¸€ í”½ì…€ê³¼ ê²½ìŸí•  ê²ƒìœ¼ë¡œ ì˜ˆìƒë©ë‹ˆë‹¤.

ì´ ì •ë³´ëŠ” ì‚¼ì„±ì „ìê°€ AI ê¸°ìˆ ì„ í†µí•´ ì‚¬ìš©ì ê²½í—˜ì„ í–¥ìƒì‹œí‚¤ê³ , ê°œì¸ì •ë³´ ë³´í˜¸ë¥¼ ê°•í™”í•˜ë ¤ëŠ” ë…¸ë ¥ì„ ë³´ì—¬ì¤ë‹ˆë‹¤.
```

## ì´ì „ ëŒ€í™”ë‚´ìš© ê¸°ì–µí•˜ëŠ” Agent

ì´ì „ì˜ ëŒ€í™”ë‚´ìš©ì„ ê¸°ì–µí•˜ê¸° ìœ„í•´ì„œëŠ” `RunnableWithMessageHistory` ë¥¼ ì‚¬ìš©í•˜ì—¬ `AgentExecutor` ë¥¼ ê°ì‹¼ë‹¤.

`RunnableWithMessageHistory` ì— ëŒ€í•œ ìì„¸í•œ ë‚´ìš©ì€ ì•„ë˜ ë§í¬ë¥¼ ì°¸ê³ í•œë‹¤.

**ì°¸ê³ **
- [RunnableWithMessageHistory](https://wikidocs.net/254682)

```{python}
from langchain_community.chat_message_histories import ChatMessageHistory
from langchain_core.runnables.history import RunnableWithMessageHistory

# session_id ë¥¼ ì €ì¥í•  ë”•ì…”ë„ˆë¦¬ ìƒì„±
store = {}


# session_id ë¥¼ ê¸°ë°˜ìœ¼ë¡œ ì„¸ì…˜ ê¸°ë¡ì„ ê°€ì ¸ì˜¤ëŠ” í•¨ìˆ˜
def get_session_history(session_ids):
    if session_ids not in store:  # session_id ê°€ storeì— ì—†ëŠ” ê²½ìš°
        # ìƒˆë¡œìš´ ChatMessageHistory ê°ì²´ë¥¼ ìƒì„±í•˜ì—¬ storeì— ì €ì¥
        store[session_ids] = ChatMessageHistory()
    return store[session_ids]  # í•´ë‹¹ ì„¸ì…˜ IDì— ëŒ€í•œ ì„¸ì…˜ ê¸°ë¡ ë°˜í™˜


# ì±„íŒ… ë©”ì‹œì§€ ê¸°ë¡ì´ ì¶”ê°€ëœ ì—ì´ì „íŠ¸ë¥¼ ìƒì„±í•œë‹¤.
agent_with_chat_history = RunnableWithMessageHistory(
    agent_executor,
    # ëŒ€í™” session_id
    get_session_history,
    # í”„ë¡¬í”„íŠ¸ì˜ ì§ˆë¬¸ì´ ì…ë ¥ë˜ëŠ” key: "input"
    input_messages_key="input",
    # í”„ë¡¬í”„íŠ¸ì˜ ë©”ì‹œì§€ê°€ ì…ë ¥ë˜ëŠ” key: "chat_history"
    history_messages_key="chat_history",
)
```

```{python}
# ì§ˆì˜ì— ëŒ€í•œ ë‹µë³€ì„ ìŠ¤íŠ¸ë¦¬ë°ìœ¼ë¡œ ì¶œë ¥ ìš”ì²­
response = agent_with_chat_history.stream(
    {"input": "ì‚¼ì„±ì „ìê°€ ê°œë°œí•œ ìƒì„±í˜• AI ê´€ë ¨ëœ ì •ë³´ë¥¼ ë¬¸ì„œì—ì„œ ì°¾ì•„ì£¼ì„¸ìš”."},
    # session_id ì„¤ì •
    config={"configurable": {"session_id": "abc123"}},
)

# ì¶œë ¥ í™•ì¸
for step in response:
    agent_stream_parser.process_agent_steps(step)
```

```
[ë„êµ¬ í˜¸ì¶œ]
Tool: pdf_search
query: ì‚¼ì„±ì „ì ìƒì„±í˜• AI
Log: 
Invoking: `pdf_search` with `{'query': 'ì‚¼ì„±ì „ì ìƒì„±í˜• AI'}`

[ê´€ì°° ë‚´ìš©]
Observation: SPRi AI Brief |  
2023-12 ì›”í˜¸
10ì‚¼ì„±ì „ì , ìì²´ ê°œë°œ ìƒì„± AI â€˜ì‚¼ì„± ê°€ìš°ìŠ¤ â€™ ê³µê°œ
nì‚¼ì„±ì „ìê°€ ì˜¨ë””ë°”ì´ìŠ¤ì—ì„œ ì‘ë™ ê°€ëŠ¥í•˜ë©° ì–¸ì–´, ì½”ë“œ, ì´ë¯¸ì§€ì˜ 3ê°œ ëª¨ë¸ë¡œ êµ¬ì„±ëœ ìì²´ ê°œë°œ ìƒì„± 
AI ëª¨ë¸ â€˜ì‚¼ì„± ê°€ìš°ìŠ¤ â€™ë¥¼ ê³µê°œ
(...ì¤‘ëµ...)
âˆ™íŒê²°ë¬¸ì€ ì†Œì†¡ì„ ì œê¸°í•œ ìº˜ë¦¬ ë§¥ì»¤ë„Œê³¼ ì¹¼ë¼ ì˜¤ë¥´í‹°ì¦ˆê°€ ë¯¸êµ­ ì €ì‘ê¶Œì²­ì— ì˜ˆìˆ  ì‘í’ˆì— ëŒ€í•œ ì €ì‘ê¶Œì„ 
ì œì¶œí•˜ì§€ ì•Šì•˜ë‹¤ëŠ” ì ì„ ì§€ì í–ˆìœ¼ë©° , ì‚¬ë¼ ì•¤ë”ìŠ¨ì€ ê³ ì†Œì¥ì— ì¸ìš©ëœ ìˆ˜ë°± ê°œì˜ ì‘í’ˆ ì¤‘ 16ê°œ ì‘í’ˆì— 
ëŒ€í•´ì„œë§Œ ì €ì‘ê¶Œì„ ë³´ìœ 
níŒê²°ë¬¸ì€ ë˜í•œ ìƒì„± AI ëª¨ë¸ í›ˆë ¨ì— ì‚¬ìš©ëœ ëª¨ë“  ì´ë¯¸ì§€ì— ì €ì‘ê¶Œì´ ìˆë‹¤ê±°ë‚˜ , ìƒì„± AIë¡œ ë§Œë“  
ì´ë¯¸ì§€ê°€ ì €ì‘ë¬¼ì„ ì´ìš©í•´ í›ˆë ¨ë˜ì—ˆìœ¼ë¯€ë¡œ ì €ì‘ë¬¼ì˜ íŒŒìƒ ì´ë¯¸ì§€ë¼ëŠ” ì£¼ì¥ì€ ê°œì—°ì„±ì´  ë¶€ì¡±í•˜ë‹¤ê³   
ì§€ì 

[ìµœì¢… ë‹µë³€]
ì‚¼ì„±ì „ìê°€ ê°œë°œí•œ ìƒì„±í˜• AIì— ëŒ€í•œ ì •ë³´ëŠ” ë‹¤ìŒê³¼ ê°™ìŠµë‹ˆë‹¤:

1. **ì‚¼ì„± ê°€ìš°ìŠ¤**: ì‚¼ì„±ì „ìëŠ” 2023ë…„ 11ì›” 8ì¼ 'ì‚¼ì„± AI í¬ëŸ¼ 2023'ì—ì„œ ìì²´ ê°œë°œí•œ ìƒì„±í˜• AI ëª¨ë¸ì¸ 'ì‚¼ì„± ê°€ìš°ìŠ¤'ë¥¼ ê³µê°œí–ˆìŠµë‹ˆë‹¤. ì´ ëª¨ë¸ì€ ì–¸ì–´, ì½”ë“œ, ì´ë¯¸ì§€ì˜ 3ê°œ ëª¨ë¸ë¡œ êµ¬ì„±ë˜ì–´ ìˆìœ¼ë©°, ì˜¨ë””ë°”ì´ìŠ¤ì—ì„œ ì‘ë™í•  ìˆ˜ ìˆë„ë¡ ì„¤ê³„ë˜ì—ˆìŠµë‹ˆë‹¤. ì´ëŠ” ì‚¬ìš©ì ì •ë³´ê°€ ì™¸ë¶€ë¡œ ìœ ì¶œë  ìœ„í—˜ì´ ì—†ë‹¤ëŠ” ì¥ì ì„ ê°€ì§€ê³  ìˆìŠµë‹ˆë‹¤.

2. **ëª¨ë¸ êµ¬ì„±**:
   - **ì–¸ì–´ ëª¨ë¸**: í´ë¼ìš°ë“œì™€ ì˜¨ë””ë°”ì´ìŠ¤ì—ì„œ ë‹¤ì–‘í•œ ëª¨ë¸ë¡œ êµ¬ì„±ë˜ì–´ ìˆìœ¼ë©°, ë©”ì¼ ì‘ì„±, ë¬¸ì„œ ìš”ì•½, ë²ˆì—­ ë“±ì˜ ì‘ì—…ì„ ì§€ì›í•©ë‹ˆë‹¤.
   - **ì½”ë“œ ëª¨ë¸**: AI ì½”ë”© ì–´ì‹œìŠ¤í„´íŠ¸ì¸ 'ì½”ë“œì•„ì´ (code.i)'ë¥¼ í†µí•´ ëŒ€í™”í˜• ì¸í„°í˜ì´ìŠ¤ë¡œ ì„œë¹„ìŠ¤ë¥¼ ì œê³µí•˜ë©°, ì‚¬ë‚´ ì†Œí”„íŠ¸ì›¨ì–´ ê°œë°œì— ìµœì í™”ë˜ì–´ ìˆìŠµë‹ˆë‹¤.
   - **ì´ë¯¸ì§€ ëª¨ë¸**: ì°½ì˜ì ì¸ ì´ë¯¸ì§€ë¥¼ ìƒì„±í•˜ê³  ê¸°ì¡´ ì´ë¯¸ì§€ë¥¼ ìˆ˜ì •í•  ìˆ˜ ìˆìœ¼ë©°, ì €í•´ìƒë„ ì´ë¯¸ì§€ë¥¼ ê³ í•´ìƒë„ë¡œ ë³€í™˜í•˜ëŠ” ê¸°ëŠ¥ë„ ì§€ì›í•©ë‹ˆë‹¤.

3. **í–¥í›„ ê³„íš**: ì‚¼ì„±ì „ìëŠ” ì‚¼ì„± ê°€ìš°ìŠ¤ë¥¼ ë‹¤ì–‘í•œ ì œí’ˆì— ë‹¨ê³„ì ìœ¼ë¡œ íƒ‘ì¬í•  ê³„íšì´ë©°, ì˜¨ë””ë°”ì´ìŠ¤ AI ê¸°ìˆ ì„ í™œìš©í•œ ì—¬ëŸ¬ ê¸°ëŠ¥ì„ ì†Œê°œí•˜ê³  ìˆìŠµë‹ˆë‹¤. ì´ ê¸°ìˆ ì€ 2024ë…„ë¶€í„° ì‚¼ì„± ìŠ¤ë§ˆíŠ¸í°ì— íƒ‘ì¬ë  ì˜ˆì •ì´ë©°, ë©”íƒ€ì˜ ë¼ë§ˆ(Llama)2ë¥¼ íƒ‘ì¬í•œ í€„ì»´ ê¸°ê¸° ë° êµ¬ê¸€ ì–´ì‹œìŠ¤í„´íŠ¸ë¥¼ ì ìš©í•œ êµ¬ê¸€ í”½ì…€(Pixel)ê³¼ ê²½ìŸí•  ê²ƒìœ¼ë¡œ ì˜ˆìƒë©ë‹ˆë‹¤.

ì´ ì •ë³´ëŠ” ì‚¼ì„±ì „ìê°€ AI ê¸°ìˆ ì„ í†µí•´ ì‚¬ìš©ì ê²½í—˜ì„ í–¥ìƒì‹œí‚¤ê³ , ë°ì´í„° ë³´ì•ˆì„ ê°•í™”í•˜ë ¤ëŠ” ë…¸ë ¥ì„ ë³´ì—¬ì¤ë‹ˆë‹¤.
```


```{python}
response = agent_with_chat_history.stream(
    {"input": "ì´ì „ì˜ ë‹µë³€ì„ ì˜ì–´ë¡œ ë²ˆì—­í•œë‹¤."},
    # session_id ì„¤ì •
    config={"configurable": {"session_id": "abc123"}},
)

# ì¶œë ¥ í™•ì¸
for step in response:
    agent_stream_parser.process_agent_steps(step)

# ì´ê²½ìš° ë„êµ¬ í˜¸ì¶œì´ í•„ìš”ì—†ê¸° ë•Œë¬¸ì— ë„êµ¬ í˜¸ì¶œ í•˜ì§€ ì•ŠìŒ
```

```
[ìµœì¢… ë‹µë³€]
Here is the translation of the previous response into English:

1. **Samsung Gauss**: On November 8, 2023, Samsung Electronics unveiled its generative AI model called 'Samsung Gauss' at the 'Samsung AI Forum 2023'. This model consists of three components: language, code, and image models, and is designed to operate on-device. This has the advantage of ensuring that user information is not at risk of being leaked externally.

2. **Model Composition**:
   - **Language Model**: Composed of various models for cloud and on-device use, it supports tasks such as email writing, document summarization, and translation.
   - **Code Model**: Through the AI coding assistant 'code.i', it provides services via an interactive interface, optimized for in-house software development.
   - **Image Model**: Capable of generating creative images and modifying existing ones, it also supports converting low-resolution images to high-resolution.

3. **Future Plans**: Samsung Electronics plans to gradually integrate Samsung Gauss into various products and introduce multiple features utilizing on-device AI technology. This technology is expected to be incorporated into Samsung smartphones starting in 2024 and is anticipated to compete with Qualcomm devices equipped with Meta's Llama 2 and Google Pixel devices using Google Assistant.

This information demonstrates Samsung's efforts to enhance user experience and strengthen data security through AI technology.
```

## Agent í…œí”Œë¦¿

ë‹¤ìŒì€ ì „ì²´ í…œí”Œë¦¿ ì½”ë“œì´ë‹¤.

```{python}
# í•„ìš”í•œ ëª¨ë“ˆ import
from langchain_core.prompts import ChatPromptTemplate
from langchain_community.tools.tavily_search import TavilySearchResults
from langchain_community.vectorstores import FAISS
from langchain_community.chat_message_histories import ChatMessageHistory
from langchain.text_splitter import RecursiveCharacterTextSplitter
from langchain_openai import OpenAIEmbeddings, ChatOpenAI
from langchain.document_loaders import PyMuPDFLoader
from langchain.tools.retriever import create_retriever_tool
from langchain.agents import create_tool_calling_agent, AgentExecutor
from langchain_core.runnables.history import RunnableWithMessageHistory
from langchain_teddynote.messages import AgentStreamParser

########## 1. ë„êµ¬ë¥¼ ì •ì˜í•©ë‹ˆë‹¤ ##########

### 1-1. Search ë„êµ¬ ###
# TavilySearchResults í´ë˜ìŠ¤ì˜ ì¸ìŠ¤í„´ìŠ¤ë¥¼ ìƒì„±í•©ë‹ˆë‹¤
# k=6ì€ ê²€ìƒ‰ ê²°ê³¼ë¥¼ 6ê°œê¹Œì§€ ê°€ì ¸ì˜¤ê² ë‹¤ëŠ” ì˜ë¯¸ì…ë‹ˆë‹¤
search = TavilySearchResults(k=6)

### 1-2. PDF ë¬¸ì„œ ê²€ìƒ‰ ë„êµ¬ (Retriever) ###
# PDF íŒŒì¼ ë¡œë“œ. íŒŒì¼ì˜ ê²½ë¡œ ì…ë ¥
loader = PyMuPDFLoader("data/SPRI_AI_Brief_2023ë…„12ì›”í˜¸_F.pdf")

# í…ìŠ¤íŠ¸ ë¶„í• ê¸°ë¥¼ ì‚¬ìš©í•˜ì—¬ ë¬¸ì„œë¥¼ ë¶„í• í•©ë‹ˆë‹¤.
text_splitter = RecursiveCharacterTextSplitter(chunk_size=1000, chunk_overlap=100)

# ë¬¸ì„œë¥¼ ë¡œë“œí•˜ê³  ë¶„í• í•©ë‹ˆë‹¤.
split_docs = loader.load_and_split(text_splitter)

# VectorStoreë¥¼ ìƒì„±í•©ë‹ˆë‹¤.
vector = FAISS.from_documents(split_docs, OpenAIEmbeddings())

# Retrieverë¥¼ ìƒì„±í•©ë‹ˆë‹¤.
retriever = vector.as_retriever()

retriever_tool = create_retriever_tool(
    retriever,
    name="pdf_search",  # ë„êµ¬ì˜ ì´ë¦„ì„ ì…ë ¥í•©ë‹ˆë‹¤.
    description="use this tool to search information from the PDF document",  # ë„êµ¬ì— ëŒ€í•œ ì„¤ëª…ì„ ìì„¸íˆ ê¸°ì…í•´ì•¼ í•©ë‹ˆë‹¤!!
)

### 1-3. tools ë¦¬ìŠ¤íŠ¸ì— ë„êµ¬ ëª©ë¡ì„ ì¶”ê°€í•©ë‹ˆë‹¤ ###
# tools ë¦¬ìŠ¤íŠ¸ì— searchì™€ retriever_toolì„ ì¶”ê°€í•©ë‹ˆë‹¤.
tools = [search, retriever_tool]

########## 2. LLM ì„ ì •ì˜í•©ë‹ˆë‹¤ ##########
# LLM ëª¨ë¸ì„ ìƒì„±í•©ë‹ˆë‹¤.
llm = ChatOpenAI(model="gpt-4o", temperature=0)

########## 3. Prompt ë¥¼ ì •ì˜í•©ë‹ˆë‹¤ ##########

# Prompt ë¥¼ ì •ì˜í•©ë‹ˆë‹¤ - ì´ ë¶€ë¶„ì„ ìˆ˜ì •í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤!
# Prompt ì •ì˜
prompt = ChatPromptTemplate.from_messages(
    [
        (
            "system",
            "You are a helpful assistant. "
            "Make sure to use the `pdf_search` tool for searching information from the PDF document. "
            "If you can't find the information from the PDF document, use the `search` tool for searching information from the web.",
        ),
        ("placeholder", "{chat_history}"),
        ("human", "{input}"),
        ("placeholder", "{agent_scratchpad}"),
    ]
)

########## 4. Agent ë¥¼ ì •ì˜í•©ë‹ˆë‹¤ ##########

# ì—ì´ì „íŠ¸ë¥¼ ìƒì„±í•©ë‹ˆë‹¤.
# llm, tools, promptë¥¼ ì¸ìë¡œ ì‚¬ìš©í•©ë‹ˆë‹¤.
agent = create_tool_calling_agent(llm, tools, prompt)

########## 5. AgentExecutor ë¥¼ ì •ì˜í•©ë‹ˆë‹¤ ##########

# AgentExecutor í´ë˜ìŠ¤ë¥¼ ì‚¬ìš©í•˜ì—¬ agentì™€ toolsë¥¼ ì„¤ì •í•˜ê³ , ìƒì„¸í•œ ë¡œê·¸ë¥¼ ì¶œë ¥í•˜ë„ë¡ verboseë¥¼ Trueë¡œ ì„¤ì •í•©ë‹ˆë‹¤.
agent_executor = AgentExecutor(agent=agent, tools=tools, verbose=False)

########## 6. ì±„íŒ… ê¸°ë¡ì„ ìˆ˜í–‰í•˜ëŠ” ë©”ëª¨ë¦¬ë¥¼ ì¶”ê°€í•©ë‹ˆë‹¤. ##########

# session_id ë¥¼ ì €ì¥í•  ë”•ì…”ë„ˆë¦¬ ìƒì„±
store = {}


# session_id ë¥¼ ê¸°ë°˜ìœ¼ë¡œ ì„¸ì…˜ ê¸°ë¡ì„ ê°€ì ¸ì˜¤ëŠ” í•¨ìˆ˜
def get_session_history(session_ids):
    if session_ids not in store:  # session_id ê°€ storeì— ì—†ëŠ” ê²½ìš°
        # ìƒˆë¡œìš´ ChatMessageHistory ê°ì²´ë¥¼ ìƒì„±í•˜ì—¬ storeì— ì €ì¥
        store[session_ids] = ChatMessageHistory()
    return store[session_ids]  # í•´ë‹¹ ì„¸ì…˜ IDì— ëŒ€í•œ ì„¸ì…˜ ê¸°ë¡ ë°˜í™˜


# ì±„íŒ… ë©”ì‹œì§€ ê¸°ë¡ì´ ì¶”ê°€ëœ ì—ì´ì „íŠ¸ë¥¼ ìƒì„±í•œë‹¤.
agent_with_chat_history = RunnableWithMessageHistory(
    agent_executor,
    # ëŒ€í™” session_id
    get_session_history,
    # í”„ë¡¬í”„íŠ¸ì˜ ì§ˆë¬¸ì´ ì…ë ¥ë˜ëŠ” key: "input"
    input_messages_key="input",
    # í”„ë¡¬í”„íŠ¸ì˜ ë©”ì‹œì§€ê°€ ì…ë ¥ë˜ëŠ” key: "chat_history"
    history_messages_key="chat_history",
)

########## 7. Agent íŒŒì„œë¥¼ ì •ì˜í•©ë‹ˆë‹¤. ##########
agent_stream_parser = AgentStreamParser()
```



```{python}
########## 8. ì—ì´ì „íŠ¸ë¥¼ ì‹¤í–‰í•˜ê³  ê²°ê³¼ë¥¼ í™•ì¸í•©ë‹ˆë‹¤. ##########

# ì§ˆì˜ì— ëŒ€í•œ ë‹µë³€ì„ ì¶œë ¥í•©ë‹ˆë‹¤.
response = agent_with_chat_history.stream(
    {"input": "êµ¬ê¸€ì´ ì•¤ìŠ¤ë¡œí”½ì— íˆ¬ìí•œ ê¸ˆì•¡ì„ ë¬¸ì„œì—ì„œ ì°¾ì•„ì¤˜"},
    # ì„¸ì…˜ IDë¥¼ ì„¤ì •í•©ë‹ˆë‹¤.
    # ì—¬ê¸°ì„œëŠ” ê°„ë‹¨í•œ ë©”ëª¨ë¦¬ ë‚´ ChatMessageHistoryë¥¼ ì‚¬ìš©í•˜ê¸° ë•Œë¬¸ì— ì‹¤ì œë¡œ ì‚¬ìš©ë˜ì§€ ì•ŠìŠµë‹ˆë‹¤
    config={"configurable": {"session_id": "abc123"}},
)

for step in response:
    agent_stream_parser.process_agent_steps(step)
```

```
[ë„êµ¬ í˜¸ì¶œ]
Tool: pdf_search
query: êµ¬ê¸€ ì•¤ìŠ¤ë¡œí”½ íˆ¬ì ê¸ˆì•¡
Log: 
Invoking: `pdf_search` with `{'query': 'êµ¬ê¸€ ì•¤ìŠ¤ë¡œí”½ íˆ¬ì ê¸ˆì•¡'}`

[ê´€ì°° ë‚´ìš©]
Observation: 1. ì •ì±…/ë²•ì œ  
2. ê¸°ì—…/ì‚°ì—… 
3. ê¸°ìˆ /ì—°êµ¬ 
 4. ì¸ë ¥/êµìœ¡
êµ¬ê¸€, ì•¤ìŠ¤ë¡œí”½ì— 20ì–µ ë‹¬ëŸ¬ íˆ¬ìë¡œ ìƒì„± AI í˜‘ë ¥ ê°•í™” 
n êµ¬ê¸€ì´ ì•¤ìŠ¤ë¡œí”½ì— ìµœëŒ€ 20ì–µ ë‹¬ëŸ¬ íˆ¬ìì— í•©ì˜í•˜ê³  5ì–µ ë‹¬ëŸ¬ë¥¼ ìš°ì„  íˆ¬ìí–ˆìœ¼ë©°, ì•¤ìŠ¤ë¡œí”½ì€ 
êµ¬ê¸€ê³¼ í´ë¼ìš°ë“œ ì„œë¹„ìŠ¤ ì‚¬ìš© ê³„ì•½ë„ ì²´ê²°
(...ì¤‘ëµ...) 
â…¡. ì£¼ìš” í–‰ì‚¬
   â–¹CES 2024 Â·Â·Â·Â·Â·Â·Â·Â·Â·Â·Â·Â·Â·Â·Â·Â·Â·Â·Â·Â·Â·Â·Â·Â·Â·Â·Â·Â·Â·Â·Â·Â·Â·Â·Â·Â·Â·Â·Â·Â·Â·Â·Â·Â·Â·Â·Â·Â·Â·Â·Â·Â·Â·Â·Â·Â·Â·Â·Â·Â·Â·Â·Â·Â·Â·Â·Â·Â·Â·Â·Â·Â·Â·Â·Â·Â·Â·Â·Â·Â·Â·Â·Â·Â·Â·Â·Â·Â·Â·Â·Â·Â·Â·Â·Â·Â·Â·Â·Â·Â·Â·Â·Â·Â·Â·Â·Â·Â·Â·Â·Â·Â·Â·Â·Â·Â·Â·Â·Â·Â·Â·Â·Â·Â·Â· 19

[ìµœì¢… ë‹µë³€]
êµ¬ê¸€ì€ ì•¤ìŠ¤ë¡œí”½ì— ìµœëŒ€ 20ì–µ ë‹¬ëŸ¬ë¥¼ íˆ¬ìí•˜ê¸°ë¡œ í•©ì˜í–ˆìœ¼ë©°, ì´ ì¤‘ 5ì–µ ë‹¬ëŸ¬ë¥¼ ìš°ì„  íˆ¬ìí–ˆìŠµë‹ˆë‹¤. í–¥í›„ 15ì–µ ë‹¬ëŸ¬ë¥¼ ì¶”ê°€ë¡œ íˆ¬ìí•  ê³„íšì…ë‹ˆë‹¤.
```


```{python}
########## 8. ì—ì´ì „íŠ¸ë¥¼ ì‹¤í–‰í•˜ê³  ê²°ê³¼ë¥¼ í™•ì¸í•©ë‹ˆë‹¤. ##########

# ì§ˆì˜ì— ëŒ€í•œ ë‹µë³€ì„ ì¶œë ¥í•©ë‹ˆë‹¤.
response = agent_with_chat_history.stream(
    {"input": "ì´ì „ì˜ ë‹µë³€ì„ ì˜ì–´ë¡œ ë²ˆì—­í•´ ì£¼ì„¸ìš”"},
    # ì„¸ì…˜ IDë¥¼ ì„¤ì •í•©ë‹ˆë‹¤.
    # ì—¬ê¸°ì„œëŠ” ê°„ë‹¨í•œ ë©”ëª¨ë¦¬ ë‚´ ChatMessageHistoryë¥¼ ì‚¬ìš©í•˜ê¸° ë•Œë¬¸ì— ì‹¤ì œë¡œ ì‚¬ìš©ë˜ì§€ ì•ŠìŠµë‹ˆë‹¤
    config={"configurable": {"session_id": "abc123"}},
)

for step in response:
    agent_stream_parser.process_agent_steps(step)
```

```
[ìµœì¢… ë‹µë³€]
Google has agreed to invest up to $2 billion in Anthropic, with an initial investment of $500 million. They plan to invest an additional $1.5 billion in the future.
```

```{python}
########## 8. ì—ì´ì „íŠ¸ë¥¼ ì‹¤í–‰í•˜ê³  ê²°ê³¼ë¥¼ í™•ì¸í•©ë‹ˆë‹¤. ##########

# ì§ˆì˜ì— ëŒ€í•œ ë‹µë³€ì„ ì¶œë ¥í•©ë‹ˆë‹¤.
response = agent_with_chat_history.stream(
    {
        "input": "2024ë…„ í”„ë¡œì•¼êµ¬ í”Œë ˆì´ì˜¤í”„ ì§„ì¶œ 5ê°œíŒ€ì„ ê²€ìƒ‰í•´ì„œ ì•Œë ¤ì£¼ì„¸ìš”. í•œê¸€ë¡œ ë‹µë³€í•˜ì„¸ìš”"
    },
    # ì„¸ì…˜ IDë¥¼ ì„¤ì •í•©ë‹ˆë‹¤.
    # ì—¬ê¸°ì„œëŠ” ê°„ë‹¨í•œ ë©”ëª¨ë¦¬ ë‚´ ChatMessageHistoryë¥¼ ì‚¬ìš©í•˜ê¸° ë•Œë¬¸ì— ì‹¤ì œë¡œ ì‚¬ìš©ë˜ì§€ ì•ŠìŠµë‹ˆë‹¤
    config={"configurable": {"session_id": "abc456"}},
)

for step in response:
    agent_stream_parser.process_agent_steps(step)
```

```
[ë„êµ¬ í˜¸ì¶œ]
Tool: tavily_search_results_json
query: 2024 KBO ë¦¬ê·¸ í”Œë ˆì´ì˜¤í”„ ì§„ì¶œíŒ€
Log: 
Invoking: `tavily_search_results_json` with `{'query': '2024 KBO ë¦¬ê·¸ í”Œë ˆì´ì˜¤í”„ ì§„ì¶œíŒ€'}`

[ê´€ì°° ë‚´ìš©]
Observation: [{'url': 'https://www.gosusports.com/news/baseball/kbo-news-2024-kbo-season-preview/196180/', 'content': "[ê³ ìˆ˜ìŠ¤í¬ì¸ ] 2024 kbo ë¦¬ê·¸ ì‹œì¦Œ í”„ë¦¬ë·° ... í”Œë ˆì´ì˜¤í”„ ì§„ì¶œì„ ì´ë¤„ëƒˆë‹¤. ncì˜ ì„ ì „ì—ëŠ” 'íŠ¹ê¸‰ ì™¸ì¸' í˜ë””ì˜ í™œì•½ì´ ì£¼íš¨í–ˆë‹¤. í˜ë””ëŠ” í‰ê· ìì±…ì (era 2.00)ë‹¤ìŠ¹(20ìŠ¹), íƒˆì‚¼ì§„(209ê°œ) ë“± 3ê°€ì§€ ë¶€ë¬¸ì—ì„œ ëª¨ë‘ 1ìœ„ë¥¼ ì°¨ì§€í•˜ë©° kboë¦¬ê·¸ë¥¼ í‰ì •í–ˆë‹¤."},
(...ì¤‘ëµ...)
kia íƒ€ì´ê±°ì¦ˆ, ì‚¼ì„± ë¼ì´ì˜¨ì¦ˆ, lg íŠ¸ìœˆìŠ¤, ë‘ì‚° ë² ì–´ìŠ¤, kt ìœ„ì¦ˆë‹¤.. kia íƒ€ì´ê±°ì¦ˆ; 2022ë…„ ì´í›„ 2ë…„ë§Œì— í¬ìŠ¤íŠ¸ì‹œì¦Œ ì§„ì¶œì— ì„±ê³µí–ˆë‹¤. 9ì›” 6ì¼ í¬ìŠ¤íŠ¸ì‹œì¦Œ ì§„ì¶œ í™•ì • ì´í›„ 9ì›” 17ì¼ ì •ê·œì‹œì¦Œ ìš°ìŠ¹ë„ í•¨ê»˜ ê¸°ë¡í•˜ë©´ì„œ í•œêµ­ì‹œë¦¬ì¦ˆ ì§í–‰ì— ì„±ê³µí–ˆë‹¤.'}]

[ìµœì¢… ë‹µë³€]
2024ë…„ KBO ë¦¬ê·¸ í”Œë ˆì´ì˜¤í”„ì— ì§„ì¶œí•œ 5ê°œ íŒ€ì€ ë‹¤ìŒê³¼ ê°™ìŠµë‹ˆë‹¤:

1. KIA íƒ€ì´ê±°ì¦ˆ
2. ì‚¼ì„± ë¼ì´ì˜¨ì¦ˆ
3. LG íŠ¸ìœˆìŠ¤
4. ë‘ì‚° ë² ì–´ìŠ¤
5. KT ìœ„ì¦ˆ

ì´ íŒ€ë“¤ì€ 2024ë…„ KBO í¬ìŠ¤íŠ¸ì‹œì¦Œì— ì§„ì¶œí•˜ì—¬ ê²½ê¸°ë¥¼ ì¹˜ë¥´ê²Œ ë©ë‹ˆë‹¤.
```

```{python}
########## 8. ì—ì´ì „íŠ¸ë¥¼ ì‹¤í–‰í•˜ê³  ê²°ê³¼ë¥¼ í™•ì¸í•©ë‹ˆë‹¤. ##########

# ì§ˆì˜ì— ëŒ€í•œ ë‹µë³€ì„ ì¶œë ¥í•©ë‹ˆë‹¤.
response = agent_with_chat_history.stream(
    {"input": "ì´ì „ì˜ ë‹µë³€ì„ SNS ê²Œì‹œê¸€ í˜•íƒœë¡œ 100ì ë‚´ì™¸ë¡œ ì‘ì„±í•˜ì„¸ìš”."},
    # ì„¸ì…˜ IDë¥¼ ì„¤ì •í•©ë‹ˆë‹¤.
    # ì—¬ê¸°ì„œëŠ” ê°„ë‹¨í•œ ë©”ëª¨ë¦¬ ë‚´ ChatMessageHistoryë¥¼ ì‚¬ìš©í•˜ê¸° ë•Œë¬¸ì— ì‹¤ì œë¡œ ì‚¬ìš©ë˜ì§€ ì•ŠìŠµë‹ˆë‹¤
    config={"configurable": {"session_id": "abc456"}},
)

for step in response:
    agent_stream_parser.process_agent_steps(step)
```

```
[ìµœì¢… ë‹µë³€]
2024 KBO ë¦¬ê·¸ í”Œë ˆì´ì˜¤í”„ ì§„ì¶œíŒ€: KIA íƒ€ì´ê±°ì¦ˆ, ì‚¼ì„± ë¼ì´ì˜¨ì¦ˆ, LG íŠ¸ìœˆìŠ¤, ë‘ì‚° ë² ì–´ìŠ¤, KT ìœ„ì¦ˆ! ì¹˜ì—´í•œ ê²½ê¸°ê°€ ê¸°ëŒ€ë©ë‹ˆë‹¤! #KBO #í”Œë ˆì´ì˜¤í”„
```

```{python}
########## 8. ì—ì´ì „íŠ¸ë¥¼ ì‹¤í–‰í•˜ê³  ê²°ê³¼ë¥¼ í™•ì¸í•©ë‹ˆë‹¤. ##########

# ì§ˆì˜ì— ëŒ€í•œ ë‹µë³€ì„ ì¶œë ¥í•©ë‹ˆë‹¤.
response = agent_with_chat_history.stream(
    {"input": "ì´ì „ì˜ ë‹µë³€ì— í•œêµ­ ì‹œë¦¬ì¦ˆ ì¼ì •ì„ ì¶”ê°€í•˜ì„¸ìš”."},
    # ì„¸ì…˜ IDë¥¼ ì„¤ì •í•©ë‹ˆë‹¤.
    # ì—¬ê¸°ì„œëŠ” ê°„ë‹¨í•œ ë©”ëª¨ë¦¬ ë‚´ ChatMessageHistoryë¥¼ ì‚¬ìš©í•˜ê¸° ë•Œë¬¸ì— ì‹¤ì œë¡œ ì‚¬ìš©ë˜ì§€ ì•ŠìŠµë‹ˆë‹¤
    config={"configurable": {"session_id": "abc456"}},
)

for step in response:
    agent_stream_parser.process_agent_steps(step)
```

```
[ë„êµ¬ í˜¸ì¶œ]
Tool: tavily_search_results_json
query: 2024 KBO í•œêµ­ ì‹œë¦¬ì¦ˆ ì¼ì •
Log: 
Invoking: `tavily_search_results_json` with `{'query': '2024 KBO í•œêµ­ ì‹œë¦¬ì¦ˆ ì¼ì •'}`

[ê´€ì°° ë‚´ìš©]
Observation: [{'url': 'https://ko.wikipedia.org/wiki/2024ë…„_í•œêµ­ì‹œë¦¬ì¦ˆ', 'content': '2024 ì‹ í•œ SOL Bank KBO í•œêµ­ì‹œë¦¬ì¦ˆëŠ” 2024ë…„ 10ì›” 21ì¼ë¶€í„° 10ì›” 29ì¼ê¹Œì§€ í¼ì³ì§ˆ ì˜ˆì •ì¸ 2024ë…„ KBO ë¦¬ê·¸ì˜ ì±”í”¼ì–¸ ê²°ì •ì „ì´ë‹¤. ëŒ€ì§„ì€ 2024ë…„ KBO ë¦¬ê·¸ ì •ê·œ ì‹œì¦Œ 1ìœ„ íŒ€ìœ¼ë¡œ 2017ë…„ í•œêµ­ì‹œë¦¬ì¦ˆ ì´í›„ 7ë…„ë§Œì— í•œêµ­ì‹œë¦¬ì¦ˆ ì§í–‰ì— ì„±ê³µí•˜ë©° í†µí•© ìš°ìŠ¹ì— ë„ì „í•˜ëŠ” KIA íƒ€ì´ê±°ì¦ˆ ì™€ ...'}, 
(...ì¤‘ëµ...)
ì¶œí•  ìˆ˜ ìˆë‹¤. ë°˜ë©´, 5ìœ„ íŒ€ì€ ë‘ ê²½ê¸°ë¥¼ ëª¨ë‘ ì´ê²¨ì•¼ë§Œ ì¤€í”Œë ˆì´ì˜¤í”„ì— ì˜¬ë¼ê°ˆ ìˆ˜ ìˆë‹¤. ë§Œì•½ ê²½ê¸°ê°€ ë¬´ìŠ¹ë¶€ë¡œ ëë‚˜ë©´, í•´ë‹¹ ê²½ê¸°ëŠ” ì‹œë¦¬ì¦ˆë³„ ìµœì¢…ì „ì´ ëë‚œ í›„ ë¬´ìŠ¹ë¶€ê°€ ë°œìƒí•œ êµ¬ì¥ì—ì„œ ì´ë™ì¼ ì—†ì´ ì—°ì „ìœ¼ë¡œ ì§„í–‰ëœë‹¤. WIKITREE WIKITREE NOW"}]

[ìµœì¢… ë‹µë³€]
2024 KBO ë¦¬ê·¸ í”Œë ˆì´ì˜¤í”„ ì§„ì¶œíŒ€: KIA íƒ€ì´ê±°ì¦ˆ, ì‚¼ì„± ë¼ì´ì˜¨ì¦ˆ, LG íŠ¸ìœˆìŠ¤, ë‘ì‚° ë² ì–´ìŠ¤, KT ìœ„ì¦ˆ! ê²½ê¸°ëŠ” 10ì›” 2ì¼ë¶€í„° ì‹œì‘ë˜ë©°, í•œêµ­ ì‹œë¦¬ì¦ˆëŠ” 10ì›” 21ì¼ë¶€í„° 10ì›” 29ì¼ê¹Œì§€ ì§„í–‰ë©ë‹ˆë‹¤. ì¹˜ì—´í•œ ê²½ê¸°ê°€ ê¸°ëŒ€ë©ë‹ˆë‹¤! #KBO #í”Œë ˆì´ì˜¤í”„ #í•œêµ­ì‹œë¦¬ì¦ˆ
```
