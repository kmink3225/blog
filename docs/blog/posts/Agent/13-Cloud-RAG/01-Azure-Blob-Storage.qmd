---
title: "Azure Blob Storage"
subtitle: ë¹„ì •í˜• ë¬¸ì„œ ì €ì¥ì†Œ
description: |
  Azure Blob Storageë¥¼ í™œìš©í•œ RAG ë¬¸ì„œ ì €ì¥ ë° ê´€ë¦¬ ë°©ë²•ì„ ë‹¤ë£¬ë‹¤.
categories:
  - AI
  - RAG
  - Azure
  - Cloud
author: Kwangmin Kim
date: 11/02/2025
format: 
  html:
    page-layout: full
    code-fold: true
    toc: true
    number-sections: true
draft: False
execute:
    eval: false
---


## Azure Blob Storageë€?  

Azure Blob StorageëŠ” Microsoft Azureì—ì„œ ì œê³µí•˜ëŠ” ê°ì²´ ìŠ¤í† ë¦¬ì§€ ì„œë¹„ìŠ¤ë¡œ, RAG ì‹œìŠ¤í…œì˜ ë¬¸ì„œ ì €ì¥ì†Œë¡œ ì‚¬ìš©ëœë‹¤. ë¹„ì •í˜• ë°ì´í„°(PDF, Word, ì´ë¯¸ì§€ ë“±)ë¥¼ ëŒ€ìš©ëŸ‰ìœ¼ë¡œ ì €ì¥í•˜ê³  ê´€ë¦¬í•  ìˆ˜ ìˆëŠ” í™•ì¥ ê°€ëŠ¥í•œ í´ë¼ìš°ë“œ ìŠ¤í† ë¦¬ì§€ë‹¤.  

**RAG íŒŒì´í”„ë¼ì¸ì—ì„œì˜ ì—­í• :**  
- ì›ë³¸ ë¬¸ì„œ ì €ì¥ (PDF, DOCX, PPTX, ì´ë¯¸ì§€ ë“±)  
- ì „ì²˜ë¦¬ëœ í…ìŠ¤íŠ¸ ì €ì¥  
- ë©”íƒ€ë°ì´í„° ë° ì¸ë±ìŠ¤ ë°±ì—…  
- ëŒ€ìš©ëŸ‰ ë°ì´í„°ì…‹ ê´€ë¦¬  

**ì£¼ìš” íŠ¹ì§•:**  
- **í™•ì¥ì„±**: EB(Exabyte) ê·œëª¨ê¹Œì§€ ìë™ í™•ì¥  
- **ë‚´êµ¬ì„±**: 99.999999999% (11 nine's) ë°ì´í„° ë‚´êµ¬ì„±  
- **ë¹„ìš© íš¨ìœ¨ì„±**: ê³„ì¸µí˜• ìŠ¤í† ë¦¬ì§€ë¡œ ë¹„ìš© ìµœì í™”  
- **ë³´ì•ˆ**: ì•”í˜¸í™”, RBAC, Private Endpoint ì§€ì›  

## Blob Storage ê³„ì¸µ  

Azure Blob StorageëŠ” ë°ì´í„° ì•¡ì„¸ìŠ¤ íŒ¨í„´ì— ë”°ë¼ 3ê°€ì§€ ê³„ì¸µì„ ì œê³µí•œë‹¤:  

| ê³„ì¸µ | ìš©ë„ | ê°€ê²© (GB/ì›”) | ì½ê¸° ë¹„ìš© | ì í•©í•œ ì‹œë‚˜ë¦¬ì˜¤ |  
|------|------|-------------|-----------|----------------|  
| **Hot** | ìì£¼ ì•¡ì„¸ìŠ¤ | $0.0184 | ë‚®ìŒ | RAG ìš´ì˜ ë¬¸ì„œ, í™œì„± ë°ì´í„°ì…‹ |  
| **Cool** | ê°€ë” ì•¡ì„¸ìŠ¤ | $0.01 | ì¤‘ê°„ | ì•„ì¹´ì´ë¸Œ ë¬¸ì„œ, ë°±ì—… |  
| **Archive** | ê±°ì˜ ì—†ìŒ | $0.002 | ë†’ìŒ | ì¥ê¸° ë³´ê´€, ê·œì • ì¤€ìˆ˜ ë°ì´í„° |  

**RAG ì‹œìŠ¤í…œ ê¶Œì¥ ì‚¬í•­:**  
- **Hot ê³„ì¸µ**: í˜„ì¬ RAGì—ì„œ ì‚¬ìš© ì¤‘ì¸ ë¬¸ì„œ  
- **Cool ê³„ì¸µ**: 3ê°œì›” ì´ìƒ ë¯¸ì‚¬ìš© ë¬¸ì„œ  
- **Archive ê³„ì¸µ**: ë²•ì  ë³´ê´€ ì˜ë¬´ë§Œ ìˆëŠ” ë¬¸ì„œ  

## Storage Account ìƒì„±  

### Azure Portalì—ì„œ ìƒì„±  

**1. Azure Portal ì ‘ì†:**  
- [portal.azure.com](https://portal.azure.com) â†’ "ë¦¬ì†ŒìŠ¤ ë§Œë“¤ê¸°"  
- "Storage Account" ê²€ìƒ‰ ë° ì„ íƒ  

**2. ê¸°ë³¸ ì„¤ì •:**  
- **êµ¬ë…**: ì‚¬ìš©í•  êµ¬ë… ì„ íƒ  
- **ë¦¬ì†ŒìŠ¤ ê·¸ë£¹**: ìƒˆë¡œ ë§Œë“¤ê¸° ë˜ëŠ” ê¸°ì¡´ ì„ íƒ (ì˜ˆ: `rg-rag-prod`)  
- **Storage Account ì´ë¦„**: ì „ì—­ì ìœ¼ë¡œ ê³ ìœ í•œ ì´ë¦„ (ì˜ˆ: `stragdocs2025`)  
- **ì§€ì—­**: Korea Central ë˜ëŠ” Korea South  
- **ì„±ëŠ¥**: Standard (ëŒ€ë¶€ë¶„ì˜ ê²½ìš° ì¶©ë¶„)  
- **ì¤‘ë³µì„±**:   
  - LRS (Locally Redundant Storage): ë‹¨ì¼ ë°ì´í„°ì„¼í„° ë‚´ 3ê°œ ë³µì œ  
  - GRS (Geo-Redundant Storage): ë‹¤ë¥¸ ë¦¬ì „ì— ìë™ ë³µì œ (ê¶Œì¥)  

**3. ê³ ê¸‰ ì„¤ì •:**  
- **ë³´ì•ˆ**:   
  - Require secure transfer (HTTPS ê°•ì œ)  
  - Enable blob public access (ë‚˜ì¤‘ì— ì œì–´ ê°€ëŠ¥)  
- **Data Lake Storage Gen2**: RAGì—ì„œëŠ” ë¶ˆí•„ìš”  
- **Blob soft delete**: 7ì¼ (ì‹¤ìˆ˜ë¡œ ì‚­ì œ ë°©ì§€)  

**4. ë„¤íŠ¸ì›Œí‚¹:**  
- **ì—°ê²° ë°©ë²•**:   
  - Public endpoint (ê°œë°œ): ëª¨ë“  ë„¤íŠ¸ì›Œí¬ì—ì„œ ì•¡ì„¸ìŠ¤  
  - Private endpoint (í”„ë¡œë•ì…˜): VNet ë‚´ì—ì„œë§Œ ì•¡ì„¸ìŠ¤  

**5. ê²€í†  + ë§Œë“¤ê¸°** â†’ ìƒì„± ì™„ë£Œ (ì•½ 1ë¶„ ì†Œìš”)  

### Azure CLIë¡œ ìƒì„±  

```bash  
# Azure CLI ë¡œê·¸ì¸  
az login  

# ë¦¬ì†ŒìŠ¤ ê·¸ë£¹ ìƒì„±  
az group create \  
    --name rg-rag-prod \  
    --location koreacentral  

# Storage Account ìƒì„±  
az storage account create \  
    --name stragdocs2025 \  
    --resource-group rg-rag-prod \  
    --location koreacentral \  
    --sku Standard_GRS \  
    --kind StorageV2 \  
    --https-only true \  
    --allow-blob-public-access false  

# ìƒì„± í™•ì¸  
az storage account show \  
    --name stragdocs2025 \  
    --resource-group rg-rag-prod \  
    --query "[name, location, sku.name]"  
```  

## ì»¨í…Œì´ë„ˆ ìƒì„±  

Blob Storageì—ì„œ **ì»¨í…Œì´ë„ˆ**ëŠ” íŒŒì¼ ì‹œìŠ¤í…œì˜ í´ë”ì™€ ìœ ì‚¬í•œ ê°œë…ì´ë‹¤.  

### Azure Portalì—ì„œ ìƒì„±  

1. Storage Account â†’ "ì»¨í…Œì´ë„ˆ" ë©”ë‰´  
2. "+ ì»¨í…Œì´ë„ˆ" í´ë¦­  
3. ì„¤ì •:  
   - **ì´ë¦„**: `rag-documents` (ì†Œë¬¸ì, í•˜ì´í”ˆë§Œ í—ˆìš©)  
   - **Public access level**: Private (ê¶Œì¥)  
4. "ë§Œë“¤ê¸°" í´ë¦­  

### Python SDKë¡œ ìƒì„±  

```{python}  
from azure.storage.blob import BlobServiceClient  
from dotenv import load_dotenv  
import os  

load_dotenv()  

# í™˜ê²½ ë³€ìˆ˜ì—ì„œ ì—°ê²° ë¬¸ìì—´ ê°€ì ¸ì˜¤ê¸°  
connection_string = os.getenv("AZURE_STORAGE_CONNECTION_STRING")  

# BlobServiceClient ìƒì„±  
blob_service_client = BlobServiceClient.from_connection_string(connection_string)  

# ì»¨í…Œì´ë„ˆ ìƒì„±  
container_name = "rag-documents"  
container_client = blob_service_client.create_container(container_name)  

print(f"ì»¨í…Œì´ë„ˆ '{container_name}' ìƒì„± ì™„ë£Œ")  
```  

**í™˜ê²½ ë³€ìˆ˜ ì„¤ì •** (`.env` íŒŒì¼):  
```  
AZURE_STORAGE_CONNECTION_STRING=DefaultEndpointsProtocol=https;AccountName=stragdocs2025;AccountKey=xxx;EndpointSuffix=core.windows.net  
```  

## ë¬¸ì„œ ì—…ë¡œë“œ  

### ë‹¨ì¼ íŒŒì¼ ì—…ë¡œë“œ  

```{python}  
from azure.storage.blob import BlobClient  

# Blob í´ë¼ì´ì–¸íŠ¸ ìƒì„±  
blob_client = blob_service_client.get_blob_client(  
    container="rag-documents",  
    blob="sample.pdf"  
)  

# íŒŒì¼ ì—…ë¡œë“œ  
with open("sample.pdf", "rb") as data:  
    blob_client.upload_blob(data, overwrite=True)  
    
print("íŒŒì¼ ì—…ë¡œë“œ ì™„ë£Œ")  
```  

### ì—¬ëŸ¬ íŒŒì¼ ì¼ê´„ ì—…ë¡œë“œ  

```{python}  
import os  
from pathlib import Path  

def upload_directory(container_name, local_directory):  
    """ë””ë ‰í† ë¦¬ ë‚´ ëª¨ë“  íŒŒì¼ì„ Blob Storageì— ì—…ë¡œë“œ"""  
    container_client = blob_service_client.get_container_client(container_name)  
    
    # ë¡œì»¬ ë””ë ‰í† ë¦¬ì˜ ëª¨ë“  íŒŒì¼ íƒìƒ‰  
    for root, dirs, files in os.walk(local_directory):  
        for file in files:  
            file_path = os.path.join(root, file)  
            
            # Blob ì´ë¦„ ìƒì„± (ë””ë ‰í† ë¦¬ êµ¬ì¡° ìœ ì§€)  
            blob_name = os.path.relpath(file_path, local_directory).replace("\\", "/")  
            
            # íŒŒì¼ ì—…ë¡œë“œ  
            with open(file_path, "rb") as data:  
                blob_client = container_client.get_blob_client(blob_name)  
                blob_client.upload_blob(data, overwrite=True)  
                print(f"ì—…ë¡œë“œ: {blob_name}")  

# ì‚¬ìš© ì˜ˆì‹œ  
upload_directory("rag-documents", "./documents")  
```  

### ë©”íƒ€ë°ì´í„°ì™€ í•¨ê»˜ ì—…ë¡œë“œ  

```{python}  
from datetime import datetime  

# ë©”íƒ€ë°ì´í„° ì •ì˜  
metadata = {  
    "author": "Kwangmin Kim",  
    "category": "AI",  
    "upload_date": datetime.now().isoformat(),  
    "version": "1.0"  
}  

# ë©”íƒ€ë°ì´í„°ì™€ í•¨ê»˜ ì—…ë¡œë“œ  
with open("report.pdf", "rb") as data:  
    blob_client = blob_service_client.get_blob_client(  
        container="rag-documents",  
        blob="report.pdf"  
    )  
    blob_client.upload_blob(  
        data,  
        metadata=metadata,  
        overwrite=True  
    )  

print("ë©”íƒ€ë°ì´í„°ì™€ í•¨ê»˜ ì—…ë¡œë“œ ì™„ë£Œ")  
```  

## ë¬¸ì„œ ë‹¤ìš´ë¡œë“œ  

### ë‹¨ì¼ íŒŒì¼ ë‹¤ìš´ë¡œë“œ  

```{python}  
# Blob ë‹¤ìš´ë¡œë“œ  
blob_client = blob_service_client.get_blob_client(  
    container="rag-documents",  
    blob="sample.pdf"  
)  

# ë¡œì»¬ì— ì €ì¥  
with open("downloaded_sample.pdf", "wb") as download_file:  
    download_file.write(blob_client.download_blob().readall())  

print("íŒŒì¼ ë‹¤ìš´ë¡œë“œ ì™„ë£Œ")  
```  

### ìŠ¤íŠ¸ë¦¬ë° ë‹¤ìš´ë¡œë“œ (ëŒ€ìš©ëŸ‰ íŒŒì¼)  

```{python}  
# ìŠ¤íŠ¸ë¦¬ë°ìœ¼ë¡œ ë‹¤ìš´ë¡œë“œ (ë©”ëª¨ë¦¬ íš¨ìœ¨ì )  
with open("large_file.pdf", "wb") as download_file:  
    blob_data = blob_client.download_blob()  
    
    # ì²­í¬ ë‹¨ìœ„ë¡œ ì½ê¸° (ê¸°ë³¸ 4MB)  
    for chunk in blob_data.chunks():  
        download_file.write(chunk)  

print("ëŒ€ìš©ëŸ‰ íŒŒì¼ ë‹¤ìš´ë¡œë“œ ì™„ë£Œ")  
```  

## ë¬¸ì„œ ëª©ë¡ ì¡°íšŒ  

### ì»¨í…Œì´ë„ˆ ë‚´ ëª¨ë“  Blob ë‚˜ì—´  

```{python}  
# ì»¨í…Œì´ë„ˆì˜ ëª¨ë“  Blob ê°€ì ¸ì˜¤ê¸°  
container_client = blob_service_client.get_container_client("rag-documents")  
blob_list = container_client.list_blobs()  

print("Blob ëª©ë¡:")  
for blob in blob_list:  
    print(f"- {blob.name}")  
    print(f"  í¬ê¸°: {blob.size / 1024:.2f} KB")  
    print(f"  ìˆ˜ì •ì¼: {blob.last_modified}")  
```  

### ë©”íƒ€ë°ì´í„° í¬í•¨ ì¡°íšŒ  

```{python}  
# ë©”íƒ€ë°ì´í„° í¬í•¨ ì¡°íšŒ  
blob_list = container_client.list_blobs(include=['metadata'])  

for blob in blob_list:  
    print(f"\níŒŒì¼: {blob.name}")  
    print(f"ë©”íƒ€ë°ì´í„°: {blob.metadata}")  
```  

### íŠ¹ì • ì ‘ë‘ì‚¬ë¡œ í•„í„°ë§  

```{python}  
# "reports/" í´ë”ì˜ íŒŒì¼ë§Œ ì¡°íšŒ  
blob_list = container_client.list_blobs(name_starts_with="reports/")  

for blob in blob_list:  
    print(f"- {blob.name}")  
```  

## ë¬¸ì„œ ì‚­ì œ  

### ë‹¨ì¼ íŒŒì¼ ì‚­ì œ  

```{python}  
# Blob ì‚­ì œ  
blob_client = blob_service_client.get_blob_client(  
    container="rag-documents",  
    blob="old_file.pdf"  
)  

blob_client.delete_blob()  
print("íŒŒì¼ ì‚­ì œ ì™„ë£Œ")  
```  

### ì¡°ê±´ë¶€ ì‚­ì œ (ì˜¤ë˜ëœ íŒŒì¼ë§Œ)  

```{python}  
from datetime import datetime, timedelta  

# 30ì¼ ì´ìƒ ëœ íŒŒì¼ ì‚­ì œ  
threshold_date = datetime.now() - timedelta(days=30)  

container_client = blob_service_client.get_container_client("rag-documents")  
blob_list = container_client.list_blobs()  

for blob in blob_list:  
    if blob.last_modified < threshold_date:  
        blob_client = container_client.get_blob_client(blob.name)  
        blob_client.delete_blob()  
        print(f"ì‚­ì œ: {blob.name} (ìˆ˜ì •ì¼: {blob.last_modified})")  
```  

## SAS (Shared Access Signature) í† í°  

SAS í† í°ì€ Storage Account í‚¤ë¥¼ ë…¸ì¶œí•˜ì§€ ì•Šê³  ì œí•œëœ ì•¡ì„¸ìŠ¤ë¥¼ ì œê³µí•œë‹¤.  

### SAS í† í° ìƒì„±  

```{python}  
from azure.storage.blob import generate_blob_sas, BlobSasPermissions  
from datetime import datetime, timedelta  

# SAS í† í° ìƒì„± (ì½ê¸° ì „ìš©, 1ì‹œê°„ ìœ íš¨)  
sas_token = generate_blob_sas(  
    account_name="stragdocs2025",  
    container_name="rag-documents",  
    blob_name="sample.pdf",  
    account_key=os.getenv("AZURE_STORAGE_KEY"),  
    permission=BlobSasPermissions(read=True),  
    expiry=datetime.utcnow() + timedelta(hours=1)  
)  

# SAS URL ìƒì„±  
sas_url = f"https://stragdocs2025.blob.core.windows.net/rag-documents/sample.pdf?{sas_token}"  
print(f"SAS URL: {sas_url}")  
```  

### SAS í† í°ìœ¼ë¡œ ë‹¤ìš´ë¡œë“œ  

```{python}  
import requests  

# SAS URLë¡œ íŒŒì¼ ë‹¤ìš´ë¡œë“œ  
response = requests.get(sas_url)  

if response.status_code == 200:  
    with open("downloaded_with_sas.pdf", "wb") as f:  
        f.write(response.content)  
    print("SAS í† í°ìœ¼ë¡œ ë‹¤ìš´ë¡œë“œ ì™„ë£Œ")  
else:  
    print(f"ë‹¤ìš´ë¡œë“œ ì‹¤íŒ¨: {response.status_code}")  
```  

## RAG íŒŒì´í”„ë¼ì¸ í†µí•©  

### ë¬¸ì„œ ë¡œë”© í•¨ìˆ˜  

```{python}  
from typing import List  
from langchain_core.documents import Document  

def load_documents_from_blob(  
    container_name: str,  
    prefix: str = ""  
) -> List[Document]:  
    """Azure Blob Storageì—ì„œ ë¬¸ì„œ ë¡œë”©"""  
    
    container_client = blob_service_client.get_container_client(container_name)  
    blob_list = container_client.list_blobs(  
        name_starts_with=prefix,  
        include=['metadata']  
    )  
    
    documents = []  
    for blob in blob_list:  
        # ì§€ì› íŒŒì¼ í˜•ì‹ë§Œ ì²˜ë¦¬  
        if blob.name.endswith(('.pdf', '.txt', '.docx')):  
            # Blob ë‹¤ìš´ë¡œë“œ  
            blob_client = container_client.get_blob_client(blob.name)  
            content = blob_client.download_blob().readall()  
            
            # Document ê°ì²´ ìƒì„±  
            doc = Document(  
                page_content=content.decode('utf-8', errors='ignore'),  
                metadata={  
                    "source": blob.name,  
                    "size": blob.size,  
                    "last_modified": blob.last_modified.isoformat(),  
                    **blob.metadata  # Blob ë©”íƒ€ë°ì´í„° ì¶”ê°€  
                }  
            )  
            documents.append(doc)  
    
    return documents  

# ì‚¬ìš© ì˜ˆì‹œ  
documents = load_documents_from_blob("rag-documents", prefix="reports/")  
print(f"ë¡œë”©ëœ ë¬¸ì„œ ìˆ˜: {len(documents)}")  
```  

### LangChain AzureBlobStorageLoader ì‚¬ìš©  

```{python}  
from langchain_community.document_loaders import AzureBlobStorageFileLoader  

# Azure Blob Storageì—ì„œ íŒŒì¼ ë¡œë”©  
loader = AzureBlobStorageFileLoader(  
    conn_str=os.getenv("AZURE_STORAGE_CONNECTION_STRING"),  
    container="rag-documents",  
    blob_name="sample.pdf"  
)  

documents = loader.load()  
print(f"ë¡œë”©ëœ ë¬¸ì„œ: {len(documents)}")  
print(f"ì²« ë²ˆì§¸ ë¬¸ì„œ ë‚´ìš© (ì• 200ì):\n{documents[0].page_content[:200]}")  
```  

## ë¹„ìš© ìµœì í™”  

### ìˆ˜ëª… ì£¼ê¸° ê´€ë¦¬ ì •ì±…  

Azure Portalì—ì„œ ì„¤ì •:  
1. Storage Account â†’ "ìˆ˜ëª… ì£¼ê¸° ê´€ë¦¬"  
2. "+ ê·œì¹™ ì¶”ê°€"  
3. ê·œì¹™ ì •ì˜:  

**ì˜ˆì‹œ: ìë™ ê³„ì¸µ ì „í™˜**  
```json  
{  
  "rules": [  
    {  
      "name": "move-to-cool",  
      "enabled": true,  
      "type": "Lifecycle",  
      "definition": {  
        "filters": {  
          "blobTypes": ["blockBlob"],  
          "prefixMatch": ["rag-documents/"]  
        },  
        "actions": {  
          "baseBlob": {  
            "tierToCool": {  
              "daysAfterModificationGreaterThan": 90  
            },  
            "tierToArchive": {  
              "daysAfterModificationGreaterThan": 365  
            },  
            "delete": {  
              "daysAfterModificationGreaterThan": 730  
            }  
          }  
        }  
      }  
    }  
  ]  
}  
```  

**ì˜ë¯¸:**  
- 90ì¼ ë¯¸ì‚¬ìš© â†’ Cool ê³„ì¸µ ì „í™˜  
- 365ì¼ ë¯¸ì‚¬ìš© â†’ Archive ê³„ì¸µ ì „í™˜  
- 730ì¼(2ë…„) í›„ â†’ ìë™ ì‚­ì œ  

### ì••ì¶• ì €ì¥  

```{python}  
import gzip  

# í…ìŠ¤íŠ¸ íŒŒì¼ ì••ì¶• í›„ ì—…ë¡œë“œ  
with open("large_document.txt", "rb") as f:  
    content = f.read()  
    compressed = gzip.compress(content)  

blob_client = blob_service_client.get_blob_client(  
    container="rag-documents",  
    blob="large_document.txt.gz"  
)  

blob_client.upload_blob(  
    compressed,  
    metadata={"compressed": "gzip"},  
    overwrite=True  
)  

print(f"ì›ë³¸ í¬ê¸°: {len(content)} bytes")  
print(f"ì••ì¶• í¬ê¸°: {len(compressed)} bytes ({len(compressed)/len(content)*100:.1f}%)")  
```  

## ë³´ì•ˆ ì„¤ì •  

### Managed Identityë¡œ ì¸ì¦  

```{python}  
from azure.identity import DefaultAzureCredential  

# Managed Identity ì‚¬ìš© (í‚¤ ë…¸ì¶œ ì—†ìŒ)  
credential = DefaultAzureCredential()  

blob_service_client = BlobServiceClient(  
    account_url="https://stragdocs2025.blob.core.windows.net",  
    credential=credential  
)  

# ì´í›„ ë™ì¼í•˜ê²Œ ì‚¬ìš©  
container_client = blob_service_client.get_container_client("rag-documents")  
```  

**Managed Identity ì„¤ì •:**  
1. Azure Function/Container App â†’ "ID" â†’ "ì‹œìŠ¤í…œ í• ë‹¹ ê´€ë¦¬ ID" í™œì„±í™”  
2. Storage Account â†’ "ì•¡ì„¸ìŠ¤ ì œì–´(IAM)" â†’ "ì—­í•  í• ë‹¹ ì¶”ê°€"  
3. ì—­í• : "Storage Blob Data Contributor"  
4. í• ë‹¹ ëŒ€ìƒ: ìƒì„±ëœ Managed Identity  

### Private Endpoint ì„¤ì •  

1. Storage Account â†’ "ë„¤íŠ¸ì›Œí‚¹" â†’ "í”„ë¼ì´ë¹— ì—”ë“œí¬ì¸íŠ¸ ì—°ê²°"  
2. "+ í”„ë¼ì´ë¹— ì—”ë“œí¬ì¸íŠ¸" í´ë¦­  
3. ì„¤ì •:  
   - ë¦¬ì†ŒìŠ¤ ê·¸ë£¹ ì„ íƒ  
   - ì´ë¦„: `pe-storage-rag`  
   - ëŒ€ìƒ í•˜ìœ„ ë¦¬ì†ŒìŠ¤: `blob`  
   - ê°€ìƒ ë„¤íŠ¸ì›Œí¬ ë° ì„œë¸Œë„· ì„ íƒ  
4. "ë§Œë“¤ê¸°" â†’ VNet ë‚´ì—ì„œë§Œ ì•¡ì„¸ìŠ¤ ê°€ëŠ¥  

## ëª¨ë‹ˆí„°ë§  

### Storage Analytics í™œì„±í™”  

```{python}  
from azure.storage.blob import BlobAnalyticsLogging, Metrics, RetentionPolicy  

# Analytics ì„¤ì •  
logging = BlobAnalyticsLogging(  
    version="1.0",  
    delete=True,  
    read=True,  
    write=True,  
    retention_policy=RetentionPolicy(enabled=True, days=7)  
)  

metrics = Metrics(  
    version="1.0",  
    enabled=True,  
    include_apis=True,  
    retention_policy=RetentionPolicy(enabled=True, days=7)  
)  

# ì„¤ì • ì ìš©  
blob_service_client.set_service_properties(  
    analytics_logging=logging,  
    hour_metrics=metrics,  
    minute_metrics=metrics  
)  

print("Storage Analytics í™œì„±í™” ì™„ë£Œ")  
```  

### ì£¼ìš” ë©”íŠ¸ë¦­  

Azure Portal â†’ Storage Account â†’ "ë©”íŠ¸ë¦­":  
- **Transactions**: ìš”ì²­ ìˆ˜ (GET, PUT, DELETE)  
- **Ingress/Egress**: ì—…ë¡œë“œ/ë‹¤ìš´ë¡œë“œ ë°ì´í„°ëŸ‰  
- **Availability**: ê°€ë™ë¥   
- **Success E2E Latency**: ì¢…ë‹¨ ê°„ ì‘ë‹µ ì‹œê°„  

## ë¬¸ì œ í•´ê²°  

### ì¼ë°˜ì ì¸ ì˜¤ë¥˜  

**1. AuthorizationPermissionMismatch**  
```  
ì˜¤ë¥˜: ê¶Œí•œ ì—†ìŒ  
í•´ê²°: Storage Account IAMì—ì„œ "Storage Blob Data Contributor" ì—­í•  ì¶”ê°€  
```  

**2. ContainerNotFound**  
```python  
# ì»¨í…Œì´ë„ˆ ì¡´ì¬ í™•ì¸ í›„ ìƒì„±  
try:  
    container_client = blob_service_client.get_container_client("rag-documents")  
    container_client.get_container_properties()  
except Exception:  
    container_client.create_container()  
```  

**3. BlobNotFound**  
```python  
# Blob ì¡´ì¬ í™•ì¸  
if blob_client.exists():  
    blob_client.download_blob()  
else:  
    print("íŒŒì¼ì´ ì¡´ì¬í•˜ì§€ ì•ŠìŠµë‹ˆë‹¤")  
```  

## ì°¸ê³  ìë£Œ  

### ê³µì‹ ë¬¸ì„œ  
- [Azure Blob Storage ê°œìš”](https://learn.microsoft.com/en-us/azure/storage/blobs/storage-blobs-overview)  
- [Python SDK ì°¸ì¡°](https://learn.microsoft.com/en-us/python/api/overview/azure/storage-blob-readme)  
- [ë³´ì•ˆ ê°€ì´ë“œ](https://learn.microsoft.com/en-us/azure/storage/blobs/security-recommendations)  

### ìƒ˜í”Œ ì½”ë“œ  
- [Azure Storage Python Samples](https://github.com/Azure-Samples/azure-storage-python-samples)  
- [LangChain Azure í†µí•©](https://python.langchain.com/docs/integrations/document_loaders/azure_blob_storage_file)  

## ë‹¤ìŒ ë‹¨ê³„  

ë¬¸ì„œ ì €ì¥ì´ ì™„ë£Œë˜ì—ˆë‹¤ë©´, ì´ì œ OCR ë° ë ˆì´ì•„ì›ƒ ë¶„ì„ ë‹¨ê³„ë¡œ ë„˜ì–´ê°€ì:  

ğŸ‘‰ [02-Document-Intelligence.qmd](./02-Document-Intelligence.qmd) - Azure Document Intelligenceë¥¼ í™œìš©í•œ ë¬¸ì„œ ë¶„ì„  