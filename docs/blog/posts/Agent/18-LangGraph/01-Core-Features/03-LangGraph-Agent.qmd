---
title: "LangGraph Agent"
subtitle: "ë„êµ¬ ë°”ì¸ë”©ê³¼ ì¡°ê±´ë¶€ ì—£ì§€ë¡œ êµ¬í˜„í•˜ëŠ” ì‹¤ë¬´ìš© ì—ì´ì „íŠ¸"
description: |
    LangGraphë¥¼ ì‚¬ìš©í•´ ì—ì´ì „íŠ¸ë¥¼ êµ¬ì„±í•˜ëŠ” ë°©ë²•ì„ ì„¤ëª…í•œë‹¤. LLMì— ë„êµ¬ë¥¼ ë°”ì¸ë”©í•˜ê³ 
    ë„êµ¬ í˜¸ì¶œì„ ì²˜ë¦¬í•˜ëŠ” Tool Node êµ¬í˜„, `add_conditional_edges`ë¥¼ í†µí•œ ë¼ìš°íŒ… íŒ¨í„´,
    ì‹¤ì œ ì›¹ ê²€ìƒ‰ ë„êµ¬(Tavily) ì—°ë™ ì˜ˆì‹œì™€ ë³´ì•ˆÂ·ê²€ì¦Â·ê´€ì°°ì„± ê³ ë ¤ì‚¬í•­ì„ í¬í•¨í•œë‹¤.
categories:
    - Agent
    - LangGraph
    - Tools
    - AI
    - Python
author: Kwangmin Kim
date: 07/15/2025
format:
    html:
        code-fold: true
        toc: true
        number-sections: true
draft: false
execute:
    eval: false
---

# LangGraphë¥¼ í™œìš©í•œ Agent êµ¬ì¶•

* LangGraphëŠ” agentì™€ í•¨ê»˜ ì‚¬ìš©í•  ë•Œ íŠ¹íˆ ê°•ë ¥í•œ ê¸°ëŠ¥ì„ ë°œíœ˜í•œë‹¤.   
* ì›¹ ê²€ìƒ‰ ë„êµ¬ë¥¼ í†µí•´ ì±—ë´‡ì— ì›¹ ê²€ìƒ‰ ê¸°ëŠ¥ìˆ˜í–‰í•˜ëŠ” Agent ì„ ì¶”ê°€í•œë‹¤.  
* LLM ì— ë„êµ¬ë¥¼ ë°”ì¸ë”©í•˜ì—¬ LLM ì— ì…ë ¥ëœ ìš”ì²­ì— ë”°ë¼ í•„ìš”ì‹œ ì›¹ ê²€ìƒ‰ ë„êµ¬(Tool)ë¥¼ í˜¸ì¶œí•˜ëŠ” Agent ì„ êµ¬ì¶•í•œë‹¤.
* ë¿ë§Œì•„ë‹ˆë¼, ì¡°ê±´ë¶€ ì—£ì§€ë¥¼ í†µí•´ ë„êµ¬ í˜¸ì¶œ ì—¬ë¶€ì— ë”°ë¼ ë‹¤ë¥¸ ë…¸ë“œë¡œ ë¼ìš°íŒ…í•˜ëŠ” ë°©ë²•ë„ í•¨ê»˜ ì•Œì•„ë³¸ë‹¤.
* AgentëŠ” ììœ¨ì ì¸ ì˜ì‚¬ê²°ì •ì„ ìˆ˜í–‰í•  ìˆ˜ ìˆì§€ë§Œ, ë‹¤ìŒê³¼ ê°™ì€ controllabilityì— ëŒ€í•œ ì´ìŠˆë„ ê°™ì´ ë°œìƒí•  ìˆ˜ ìˆë‹¤.
    * LLMì´ ë„êµ¬ë¥¼ í˜¸ì¶œí•  ë•Œë§ˆë‹¤ ë„êµ¬ ë…¸ë“œë¡œ ë¼ìš°íŒ…í•˜ëŠ” ê²ƒì´ ì•„ë‹ˆë¼, ë„êµ¬ í˜¸ì¶œì´ ìˆì„ ë•Œë§Œ ë„êµ¬ ë…¸ë“œë¡œ ë¼ìš°íŒ…í•˜ë„ë¡ ì¡°ê±´ë¶€ ì—£ì§€ë¥¼ ì¶”ê°€í•œë‹¤.
    * ì§ˆë¬¸ì— ë§ëŠ” ì ì ˆí•œ ë„êµ¬ë¥¼ ì°¾ì§€ëª»í•œë‹¤.
    * ë„êµ¬ê°€ í˜¸ì¶œëœ í›„ ì±—ë´‡ì´ ë„êµ¬ì˜ ê²°ê³¼ë¥¼ í™œìš©í•˜ì—¬ ë‹µë³€ì„ ìƒì„±í•˜ì§€ ëª»í•œë‹¤.
    * LLMì´ ê°œë°œìê°€ ì˜ë„í•˜ì§€ ì•ŠëŠ” actionì„ í•˜ëŠ” ê²½ìš° (ì˜ˆ: ë„êµ¬ë¥¼ í˜¸ì¶œí•˜ì§€ ë§ì•„ì•¼ í•  ë•Œ í˜¸ì¶œí•˜ëŠ” ê²½ìš°)
* LangGraphëŠ” controllabilityì— ëŒ€í•œ ì´ìŠˆë¥¼ íš¨ê³¼ì ìœ¼ë¡œ ê´€ë¦¬í•  ìˆ˜ ìˆë‹¤. 
    * Agentê°€ ë„êµ¬í˜¸ì¶œì„ í•  ë•Œ ê° ë…¸ë“œë“¤ì´ ì í•©ì„±ì„ íŒë‹¨ì„ í•  ìˆ˜ ìˆëŠ” êµ¬ì¡°ë¡œ ì„¤ê³„í•  ìˆ˜ ìˆë‹¤.
    * ë„êµ¬ í˜¸ì¶œì´ í•„ìš”í•œ ê²½ìš°ì—ë§Œ ë„êµ¬ ë…¸ë“œë¡œ ë¼ìš°íŒ…í•˜ë„ë¡ ì¡°ê±´ë¶€ ì—£ì§€ë¥¼ ì¶”ê°€í•  ìˆ˜ ìˆë‹¤.
    * ë„êµ¬ ë…¸ë“œ(Tool Node)ë¥¼ í†µí•´ ë„êµ¬ê°€ í˜¸ì¶œëœ í›„ ì±—ë´‡ì´ ë„êµ¬ì˜ ê²°ê³¼ë¥¼ í™œìš©í•˜ì—¬ ë‹µë³€ì„ ìƒì„±í•˜ë„ë¡ í•  ìˆ˜ ìˆë‹¤.
    * ê·¸ë˜í”„ì˜ êµ¬ì¡°ì™€ íë¦„ì„ ëª…í™•í•˜ê²Œ ì •ì˜í•˜ì—¬ LLMì´ ê°œë°œìê°€ ì˜ë„í•œ ëŒ€ë¡œ í–‰ë™í•˜ë„ë¡ ìœ ë„í•  ìˆ˜ ìˆë‹¤.
* ì´ë²ˆ ë¸”ë¡œê·¸ì—ì„œëŠ” Agentë¥¼ êµ¬ì¶•í•œë‹¤ê¸° ë³´ë‹¤ëŠ” Function Calling LLMê³¼ ë„êµ¬ë¥¼ í™œìš©í•˜ì—¬ ì±—ë´‡ì´ ë„êµ¬ë¥¼ í˜¸ì¶œí•˜ëŠ” ê°„ë‹¨í•œ ì˜ˆì‹œë¥¼ í†µí•´ LangGraphì˜ Agent ê¸°ëŠ¥ì„ êµ¬í˜„í•œë‹¤.

```python
# API í‚¤ë¥¼ í™˜ê²½ë³€ìˆ˜ë¡œ ê´€ë¦¬í•˜ê¸° ìœ„í•œ ì„¤ì • íŒŒì¼
from dotenv import load_dotenv

# API í‚¤ ì •ë³´ ë¡œë“œ
load_dotenv()
```

```python
# LangSmith ì¶”ì ì„ ì„¤ì •í•©ë‹ˆë‹¤. https://smith.langchain.com
# !pip install -qU langchain-teddynote
from langchain_teddynote import logging

# í”„ë¡œì íŠ¸ ì´ë¦„ì„ ì…ë ¥í•©ë‹ˆë‹¤.
logging.langsmith("CH17-LangGraph-Modules")
```

## ë„êµ¬(Tool) ì‚¬ìš©í•˜ê¸°

**ì°¸ê³ **

- [ë„êµ¬(Tools)](https://wikidocs.net/262582)  
- ì±—ë´‡ì´ "ê¸°ì–µ"ì—ì„œ ë‹µë³€í•  ìˆ˜ ì—†ëŠ” ì§ˆë¬¸ì„ ì²˜ë¦¬í•˜ê¸° ìœ„í•´ ì›¹ ê²€ìƒ‰ ë„êµ¬ë¥¼ í†µí•©í•  ê²ƒ  
* ì´ ë„êµ¬ë¥¼ ì‚¬ìš©í•˜ì—¬ ê´€ë ¨ ì •ë³´ë¥¼ ì°¾ì•„ ë” ë‚˜ì€ ì‘ë‹µì„ ì œê³µí•  ìˆ˜ ìˆë‹¤.  

### ê²€ìƒ‰ API ë„êµ¬

* Tavily ê²€ìƒ‰ APIë¥¼ í™œìš©í•˜ì—¬ ì›¹ ê²€ìƒ‰ ê¸°ëŠ¥ì„ êµ¬í˜„í•˜ëŠ” ë„êµ¬. 
* ì´ ë„êµ¬ëŠ” ë‘ ê°€ì§€ ì£¼ìš” í´ë˜ìŠ¤ë¥¼ ì œê³µ: `TavilySearchResults`ì™€ `TavilyAnswer`.
    * `TavilySearchResults`: LangChainì—ì„œ ì œê³µí•˜ëŠ” Toolë¡œ ê²€ìƒ‰ APIë¥¼ ì¿¼ë¦¬í•˜ê³  JSON í˜•ì‹ì˜ ê²°ê³¼ë¥¼ ë°˜í™˜í•˜ëŠ” ë„êµ¬ì´ë‹¤. í¬ê´„ì ì´ê³  ì •í™•í•˜ë©° ì‹ ë¢°í•  ìˆ˜ ìˆëŠ” ê²°ê³¼ì— ìµœì í™”ëœ ê²€ìƒ‰ ì—”ì§„ì´ë‹¤. í˜„ì¬ ì´ë²¤íŠ¸ì— ëŒ€í•œ ì§ˆë¬¸ì— ë‹µë³€í•  ë•Œ ìœ ìš©.  
    * í…Œë””ë…¸íŠ¸ì˜ `TavilySearch`: `TavilySearchResults`ì— ìœ ìš©í•œ ê¸°ëŠ¥ë“¤ì„ ì¶”ê°€í•˜ì—¬ ì„¸ë¶€ì ì¸ Controlê³¼ í•¨ê»˜ ì‚¬ìš©ì„±ì„ ë†’ì¸ Toolì´ë‹¤. (`langchain_teddynote.tools.tavily` ëª¨ë“ˆì—ì„œ ì œê³µ)  
* **API í‚¤ ë°œê¸‰ ì£¼ì†Œ**: https://app.tavily.com/
    *  ë°œê¸‰í•œ API í‚¤ë¥¼ í™˜ê²½ë³€ìˆ˜ì— ì„¤ì •  
    * `.env` íŒŒì¼ ì„¤ì •: `TAVILY_API_KEY=tvly-abcdefghijklmnopqrstuvwxyz`

### TavilySearchResults

```python
# ë¼ì´ë¸ŒëŸ¬ë¦¬ ì„¤ì¹˜
# !pip install -U langchain-teddynote
```

```python
from langchain_teddynote.tools.tavily import TavilySearch

# ê²€ìƒ‰ ë„êµ¬ ìƒì„±
tool = TavilySearch(max_results=3)

# ë„êµ¬ ëª©ë¡ì— ì¶”ê°€
tools = [tool]

# ë„êµ¬ ì‹¤í–‰
print(tool.invoke("í…Œë””ë…¸íŠ¸ ë­ì²´ì¸ íŠœí† ë¦¬ì–¼"))
```

```
'[{"url": "https://teddylee777.github.io/langchain/langchain-tutorial-04/", "content": "{\\"title\\": \\"ë­ì²´ì¸(langchain) + ì •í˜•ë°ì´í„°(CSV, Excel) - ChatGPT ê¸°ë°˜ ë°ì´í„°ë¶„ì„ (4) - í…Œë””ë…¸íŠ¸\\", \\"content\\": \\"ğŸ”¥ì•Œë¦¼ğŸ”¥ â‘  í…Œë””ë…¸íŠ¸ ìœ íŠœë¸Œ - êµ¬ê²½í•˜ëŸ¬ ê°€ê¸°! â‘¡ LangChain í•œêµ­ì–´ íŠœí† ë¦¬ì–¼ ë°”ë¡œê°€ê¸° ğŸ‘€ â‘¢ ë­ì²´ì¸ ë…¸íŠ¸ ë¬´ë£Œ ì „ìì±…(wikidocs) ë°”ë¡œê°€ê¸° ğŸ™Œ â‘£ RAG ë¹„ë²•ë…¸íŠ¸ LangChain ê°•ì˜ì˜¤í”ˆ ë°”ë¡œê°€ê¸° ğŸ™Œ â‘¤ ì„œìš¸ëŒ€ PyTorch ë”¥ëŸ¬ë‹ ê°•ì˜ ë°”ë¡œê°€ê¸° ğŸ™Œ. ë­ì²´ì¸(langchain) + ì •í˜•ë°ì´í„°(CSV, Excel) - ChatGPT ê¸°ë°˜ ë°ì´í„°ë¶„ì„ (4)\\", \\"raw\\": \\"ğŸ”¥ì•Œë¦¼ğŸ”¥\\\\nâ‘  í…Œë””ë…¸íŠ¸ ìœ íŠœë¸Œ -\\\\nêµ¬ê²½í•˜ëŸ¬ ê°€ê¸°!\\\\nâ‘¡ LangChain í•œêµ­ì–´ íŠœí† ë¦¬ì–¼\\\\në°”ë¡œê°€ê¸° ğŸ‘€\\\\nâ‘¢ ë­ì²´ì¸ ë…¸íŠ¸ ë¬´ë£Œ ì „ìì±…(wikidocs)\\\\në°”ë¡œê°€ê¸° ğŸ™Œ\\\\nâ‘£ RAG ë¹„ë²•ë…¸íŠ¸ LangChain ê°•ì˜ì˜¤í”ˆ\\\\në°”ë¡œê°€ê¸° ğŸ™Œ\\\\n\\\\\\"ì¶”ì²œ\\\\\\" í•œ ë²ˆì”©ë§Œ ë¶€íƒ ë“œë¦¬ê² ìŠµë‹ˆë‹¤ğŸ™ğŸ™. ë­ì²´ì¸ í•œêµ­ì–´ íŠœí† ë¦¬ì–¼ ê°•ì˜ íŒ¨ìŠ¤íŠ¸ìº í¼ìŠ¤ - RAG ë¹„ë²•ë…¸íŠ¸. ë­ì²´ì¸\\", \\"raw\\": null}"}]'
```

* ìœ„ì˜ ê²°ê³¼ì™€ ê°™ì´ XMLì´ë‚˜ HTML íƒœê·¸ê°€ ì œê±°ëœ ê¹”ë”í•œ í…ìŠ¤íŠ¸ í˜•íƒœë¡œ ê²€ìƒ‰ ê²°ê³¼ê°€ ë°˜í™˜ëœë‹¤.
* ì´ëŸ° í˜•íƒœëŠ” LLMì´ í™˜ê°ì„ ì¤„ì´ëŠ” ë° ë„ì›€ì´ ëœë‹¤.
* ê²°ê³¼ëŠ” ì±—ë´‡ì´ ì§ˆë¬¸ì— ë‹µí•  ìˆ˜ ìˆë„ë¡ ì‚¬ìš©í•  ìˆ˜ ìˆëŠ” í˜ì´ì§€ ìš”ì•½
* ì´ë²ˆì—ëŠ” LLMì— `bind_tools`ë¥¼ ì¶”ê°€í•˜ì—¬ **LLM + ë„êµ¬** ë¥¼ êµ¬ì„±í•œë‹¤.   

```python
from typing import Annotated
from typing_extensions import TypedDict
from langgraph.graph.message import add_messages


# State ì •ì˜
class State(TypedDict):
    # list íƒ€ì…ì— add_messages ì ìš©(list ì— message ì¶”ê°€)
    messages: Annotated[list, add_messages]
```

* LLM ì„ ì •ì˜í•˜ê³  ë„êµ¬ë¥¼ ë°”ì¸ë”©í•œë‹¤.

```python
from langchain_openai import ChatOpenAI

# LLM ì´ˆê¸°í™”
llm = ChatOpenAI(model="gpt-4o-mini")

# LLM ì— ë„êµ¬ ë°”ì¸ë”©
llm_with_tools = llm.bind_tools(tools)
```

* ë…¸ë“œë¥¼ ì •ì˜í•œë‹¤.

```python
# ë…¸ë“œ í•¨ìˆ˜ ì •ì˜
def chatbot(state: State):
    # LLMì´ Tool Callingì´ í•„ìš”í•˜ë‹¤ê³  íŒë‹¨ë˜ë©´ ìë™ìœ¼ë¡œ ë„êµ¬ê°€ í˜¸ì¶œë˜ê³ , ê·¸ ê²°ê³¼ê°€ LLMì˜ ì‘ë‹µì— ë°˜ì˜ëœë‹¤. 
    answer = llm_with_tools.invoke(state["messages"])
    # ë©”ì‹œì§€ ëª©ë¡ ë°˜í™˜
    return {"messages": [answer]}  # ìë™ìœ¼ë¡œ ì§ˆë¬¸ê³¼ Tool Calling í•„ìš” ë©”ì„¸ì§€ê°€ add_messagesì— ì˜í•´ ëˆ„ì ë˜ì–´ ì €ì¥ëœë‹¤.
```

* ê·¸ë˜í”„ ìƒì„± ë° ë…¸ë“œë¥¼ ì¶”ê°€í•œë‹¤.

```python
from langgraph.graph import StateGraph

# ìƒíƒœ ê·¸ë˜í”„ ì´ˆê¸°í™”
graph_builder = StateGraph(State)

# ë…¸ë“œ ì¶”ê°€
graph_builder.add_node("chatbot", chatbot)
```

## ë„êµ¬ ë…¸ë“œ(Tool Node)

* ë„êµ¬ê°€ í˜¸ì¶œë  ê²½ìš° ì‹¤ì œë¡œ ì‹¤í–‰í•  ìˆ˜ ìˆëŠ” í•¨ìˆ˜ë¥¼ ë§Œë“¤ì–´ì•¼ í•œë‹¤. 
* ì´ë¥¼ ìœ„í•´ ìƒˆë¡œìš´ ë…¸ë“œì— ë„êµ¬ë¥¼ ì¶”ê°€í•œë‹¤.
* ê°€ì¥ ìµœê·¼ì˜ ë©”ì‹œì§€ë¥¼ í™•ì¸í•˜ê³  ë©”ì‹œì§€ì— `tool_calls`ê°€ í¬í•¨ë˜ì–´ ìˆìœ¼ë©´ ë„êµ¬ë¥¼ í˜¸ì¶œí•˜ëŠ” `BasicToolNode`ë¥¼ êµ¬í˜„í•œë‹¤.   
* ì§€ê¸ˆì€ ì§ì ‘ êµ¬í˜„í•˜ì§€ë§Œ, ë‚˜ì¤‘ì—ëŠ” LangGraphì˜ pre-built ë˜ì–´ìˆëŠ” [ToolNode](https://langchain-ai.github.io/langgraph/reference/prebuilt/#langgraph.prebuilt.tool_node.ToolNode) ë¡œ ëŒ€ì²´í•  ìˆ˜ ìˆë‹¤.
* ì‹¤ë¬´ì—ì„œë„ ì‹­ì¤‘íŒ”êµ¬ëŠ” pre-built ToolNodeë¥¼ ì‚¬ìš©í•œë‹¤.
* ì§ì ‘ êµ¬í˜„í•˜ëŠ” ê±´ ì›ë¦¬ íŒŒì•… ëª©ì ì´ê³ , ì‹¤ë¬´ì—ì„œëŠ” ì§ì ‘ êµ¬í˜„í•´ì•¼ í•˜ëŠ” ê²½ìš°ëŠ” ToolNodeê°€ ì§€ì› ì•ˆ í•˜ëŠ” íŠ¹ìˆ˜í•œ ì»¤ìŠ¤í…€ ë¡œì§ì´ í•„ìš”í•  ë•Œ. ì˜ˆë¥¼ ë“¤ë©´ ë„êµ¬ ì‹¤í–‰ ì „í›„ì— ë¡œê¹…, ê¶Œí•œ ì²´í¬, ê²°ê³¼ í›„ì²˜ë¦¬ ê°™ì€ ê²Œ í•„ìš”í•  ë•Œ. ê·¼ë° ê·¸ê²ƒë„ ToolNodeë¥¼ ìƒì†ë°›ì•„ì„œ í™•ì¥í•˜ëŠ” ë°©ì‹ì´ ë” ê¹”ë”í•˜ë‹¤.  

```python
import json
from langchain_core.messages import ToolMessage


class BasicToolNode:
    """Run tools requested in the last AIMessage node"""

    def __init__(self, tools: list) -> None:
        # ë„êµ¬ ë¦¬ìŠ¤íŠ¸
        self.tools_list = {tool.name: tool for tool in tools}

    def __call__(self, inputs: dict): # overideí•´ì„œ ë„êµ¬ ë…¸ë“œì˜ ì‹¤í–‰ ë¡œì§ì„ ì •ì˜í•œë‹¤.
        # ë©”ì‹œì§€ê°€ ì¡´ì¬í•  ê²½ìš° ê°€ì¥ ìµœê·¼ ë©”ì‹œì§€ 1ê°œ ì¶”ì¶œ
        if messages := inputs.get("messages", []):
            message = messages[-1]
        else:
            raise ValueError("No message found in input")

        # ë„êµ¬ í˜¸ì¶œ ê²°ê³¼ (ì¤‘ìš”) 
        # - ë„êµ¬ í˜¸ì¶œì´ í•„ìš”í•œ ê²½ìš°, ë©”ì‹œì§€ì— í•„ìš”í•œ tool_callsê°€ í¬í•¨ë˜ì–´ ìˆë‹¤.
        # - ì½œì„ ë°›ì€ toolì˜ ê²°ê³¼ë¥¼ ë‹¤ì‹œ Chatbot ë…¸ë“œ(LLM)ì— ë°˜ì˜í•˜ê¸° ìœ„í•´ì„œ, ë„êµ¬ í˜¸ì¶œ ê²°ê³¼ë¥¼ ë©”ì‹œì§€ë¡œ ì €ì¥í•œë‹¤.

        outputs = []
        for tool_call in message.tool_calls:
            # ë„êµ¬ í˜¸ì¶œ í›„ ê²°ê³¼ ì €ì¥
            tool_result = self.tools_list[tool_call["name"]].invoke(tool_call["args"]) #tool_call["name"]: ë„êµ¬ ì´ë¦„, tool_call["args"]: ë„êµ¬ì— ì „ë‹¬í•  ì¸ì. ì˜ˆë¥¼ ë“¤ë©´, ë„êµ¬ê°€ ì›¹ ê²€ìƒ‰ë„êµ¬ë¼ë©´, tool_call["args"]ëŠ” ê²€ìƒ‰ ì¿¼ë¦¬ê°€ ë  ìˆ˜ ìˆë‹¤.
            outputs.append(
                # ë„êµ¬ í˜¸ì¶œ ê²°ê³¼ë¥¼ ë©”ì‹œì§€ë¡œ ì €ì¥
                ToolMessage(
                    content=json.dumps(
                        tool_result, ensure_ascii=False # ë§Œì•½ toolì´ ì›¹ê²€ìƒ‰ì´ë¼ë©´ ê²€ìƒ‰ê²°ê³¼ë¥¼ tool_resultë¡œ ë°›ì•„ì„œ JSON ë¬¸ìì—´ë¡œ ë³€í™˜í•˜ì—¬ contentì— ì €ì¥í•œë‹¤.
                    ),  # ë„êµ¬ í˜¸ì¶œ ê²°ê³¼ë¥¼ ë¬¸ìì—´ë¡œ ë³€í™˜
                    name=tool_call["name"],
                    tool_call_id=tool_call["id"],
                )
            )

        return {"messages": outputs}


# ë„êµ¬ ë…¸ë“œ ìƒì„±
tool_node = BasicToolNode(tools=[tool])

# ê·¸ë˜í”„ì— ë„êµ¬ ë…¸ë“œ ì¶”ê°€
graph_builder.add_node("tools", tool_node)
```

## ì¡°ê±´ë¶€ ì—£ì§€(Conditional Edge) - ë§¤ìš° ì¤‘ìš”

* ë„êµ¬ ë…¸ë“œê°€ ì¶”ê°€ë˜ë©´ `conditional_edges`ë¥¼ ì •ì˜í•  ìˆ˜ ìˆë‹¤.  
* **Edges**ëŠ” í•œ ë…¸ë“œì—ì„œ ë‹¤ìŒ ë…¸ë“œë¡œ ì œì–´ íë¦„ì„ ë¼ìš°íŒ…í•œë‹¤.   
* **Conditional edges**ëŠ” ì¼ë°˜ì ìœ¼ë¡œ "if" ë¬¸ì„ í¬í•¨í•˜ì—¬ í˜„ì¬ ê·¸ë˜í”„ ìƒíƒœì— ë”°ë¼ ë‹¤ë¥¸ ë…¸ë“œë¡œ ë¼ìš°íŒ…í•œë‹¤.   
* **Conditional edges** í•¨ìˆ˜ëŠ” í˜„ì¬ ê·¸ë˜í”„ `state`ë¥¼ ë°›ì•„ ë‹¤ìŒì— í˜¸ì¶œí•  Node ë¥¼ ë‚˜íƒ€ë‚´ëŠ” **ë¬¸ìì—´ ë˜ëŠ” ë¬¸ìì—´ ëª©ë¡** ì„   ë°˜í™˜í•œë‹¤.
* ì•„ë˜ì—ì„œëŠ” `route_tools`ë¼ëŠ” ë¼ìš°í„° í•¨ìˆ˜ë¥¼ ì •ì˜í•˜ì—¬ ì±—ë´‡ì˜ ì¶œë ¥ì—ì„œ `tool_calls`ë¥¼ í™•ì¸í•œë‹¤.   
* ì´ í•¨ìˆ˜ë¥¼ `add_conditional_edges`ë¥¼ í˜¸ì¶œí•˜ì—¬ ê·¸ë˜í”„ì— ì œê³µí•˜ë©´, `chatbot` ë…¸ë“œê°€ ì™„ë£Œë  ë•Œë§ˆë‹¤ ì´ í•¨ìˆ˜ë¥¼ í™•ì¸í•˜ì—¬ ë‹¤ìŒìœ¼ë¡œ   ì–´ë””ë¡œ ê°ˆì§€ ê²°ì •í•œë‹¤.
* ì¡°ê±´ì€ ë„êµ¬ í˜¸ì¶œì´ ìˆìœ¼ë©´ `tools`ë¡œ, ì—†ìœ¼ë©´ `END`ë¡œ ë¼ìš°íŒ…ëœë‹¤.  
  
**ì°¸ê³ **

- langgraph ì— pre-built ë˜ì–´ ìˆëŠ” [tools_condition](https://langchain-ai.github.io/langgraph/reference/prebuilt/#tools_condition) ìœ¼ë¡œ ëŒ€ì²´í•  ìˆ˜ ìˆë‹¤.

### `add_conditional_edges`

![add_conditional_edges](./image/langgraph-02.png)

`add_conditional_edges` ë©”ì„œë“œëŠ” ì‹œì‘ ë…¸ë“œì—ì„œ ì—¬ëŸ¬ ëŒ€ìƒ ë…¸ë“œë¡œì˜ ì¡°ê±´ë¶€ ì—£ì§€ë¥¼ ì¶”ê°€

**ë§¤ê°œë³€ìˆ˜**  
- `source` (str): **ì‹œì‘ ë…¸ë“œ**. ì´ ë…¸ë“œê°€ ëë‚œ í›„ ì¡°ê±´ë¶€ ì—£ì§€ê°€ ì‹¤í–‰ëœë‹¤.  
- `path` (Union[Callable, Runnable]): ë‹¤ìŒ ë…¸ë“œë¥¼ ê²°ì •í•˜ëŠ” í•¨ìˆ˜. source ë…¸ë“œì˜ stateë¥¼ ì…ë ¥ë°›ì•„ ë‹¤ìŒ ëª©ì ì§€ë¥¼ ë°˜í™˜í•œë‹¤. `END`ë¥¼ ë°˜í™˜í•˜ë©´ ê·¸ë˜í”„ ì‹¤í–‰ì´ ì¤‘ì§€ëœë‹¤.
    - `path_map` ì—†ëŠ” ê²½ìš°: path í•¨ìˆ˜ê°€ **ì‹¤ì œ ë…¸ë“œ ì´ë¦„**ì„ ì§ì ‘ ë°˜í™˜í•´ì•¼ í•œë‹¤.
    - `path_map` ìˆëŠ” ê²½ìš°: path í•¨ìˆ˜ê°€ **ì„ì˜ì˜ í‚¤**ë¥¼ ë°˜í™˜í•˜ê³ , path_mapì´ ê·¸ í‚¤ë¥¼ ì‹¤ì œ ë…¸ë“œ ì´ë¦„ìœ¼ë¡œ ë§¤í•‘í•œë‹¤. (ë…¸ë“œ ì´ë¦„ ë³€ê²½ ì‹œ path_mapë§Œ ìˆ˜ì •í•˜ë©´ ë˜ë¯€ë¡œ ìœ ì§€ë³´ìˆ˜ì— ìœ ë¦¬)
- `path_map` (Optional[Union[dict[Hashable, str], list[str]]]): path í•¨ìˆ˜ì˜ ë°˜í™˜ê°’ê³¼ ì‹¤ì œ ë…¸ë“œ ì´ë¦„ ê°„ì˜ ë§¤í•‘. ìƒëµí•˜ë©´ path í•¨ìˆ˜ê°€ ë…¸ë“œ ì´ë¦„ì„ ì§ì ‘ ë°˜í™˜í•´ì•¼ í•œë‹¤.
- `then` (Optional[str]): pathë¡œ ì„ íƒëœ ë…¸ë“œ ì‹¤í–‰ í›„ ê³µí†µìœ¼ë¡œ ì‹¤í–‰í•  ë…¸ë“œ ì´ë¦„.

* ë…¼ë¦¬ì  ì‹¤í–‰ íë¦„
    * ë¬¼ë¦¬ì ì¸ ìˆœì„œëŠ” chatbotì˜ ê²°ê³¼ë¥¼ add_conditional_edgesê°€ ë¨¼ì € ë°›ì•„ ê·¸ ê²°ê³¼ê°’ì„ routeì— ì „ë‹¬
    * `path_map`ì´ ìˆëŠ” ê²½ìš°, routeì˜ ë°˜í™˜ê°’ì´ `path_map`ì˜ í‚¤ ì¤‘ í•˜ë‚˜ì™€ ì¼ì¹˜í•˜ëŠ”ì§€ í™•ì¸
    * ì¼ì¹˜í•˜ë©´ í•´ë‹¹ í‚¤ì— ë§¤í•‘ëœ ë…¸ë“œë¡œ ë¼ìš°íŒ…, ì¼ì¹˜í•˜ì§€ ì•Šìœ¼ë©´ `END`ë¡œ ë¼ìš°íŒ…
    * `then`ì´ ì§€ì •ëœ ê²½ìš°, ë¼ìš°íŒ…ëœ ë…¸ë“œê°€ ì‹¤í–‰ëœ í›„ `then`ì— ì§€ì •ëœ ë…¸ë“œë¡œ ë¼ìš°íŒ…

```
chatbot ë…¸ë“œ ì‹¤í–‰
    â†“
route í•¨ìˆ˜ í˜¸ì¶œ (state ë°›ì•„ì„œ "use_tool" or "done" ë°˜í™˜)
    â†“
path_mapì´ ë§¤í•‘
    "use_tool" â†’ tools ë…¸ë“œë¡œ ì´ë™
    "done"     â†’ END (ê·¸ë˜í”„ ì¢…ë£Œ)
```

```python
# path_map ì—†ëŠ” ê²½ìš° â€” path í•¨ìˆ˜ê°€ ì§ì ‘ ë…¸ë“œ ì´ë¦„ì„ ë°˜í™˜
# ì‹¤í–‰ íë¦„
# tool_calls ìˆì„ ë•Œ: chatbot â†’ tools
# tool_calls ì—†ì„ ë•Œ: chatbot â†’ END
def route(state) -> str:
    if state["messages"][-1].tool_calls:
        return "tools"      # ë…¸ë“œ ì´ë¦„ ì§ì ‘ ë°˜í™˜
    return "END"

graph.add_conditional_edges("chatbot", route)

# path_map ìˆëŠ” ê²½ìš° â€” path í•¨ìˆ˜ê°€ ì„ì˜ì˜ ê°’ì„ ë°˜í™˜í•˜ê³ , path_mapì´ ê·¸ê±¸ ë…¸ë“œ ì´ë¦„ìœ¼ë¡œ ë§¤í•‘
# ì‹¤í–‰ íë¦„
# "use_tool" ë°˜í™˜ ì‹œ: chatbot â†’ tools  (path_mapì´ ë§¤í•‘)
# "done" ë°˜í™˜ ì‹œ:    chatbot â†’ END     (path_mapì´ ë§¤í•‘)

def route(state) -> str:
    if state["messages"][-1].tool_calls:
        return "use_tool"   # ë…¸ë“œ ì´ë¦„ì´ ì•„ë‹Œ ì„ì˜ì˜ í‚¤ ë°˜í™˜
    return "done"

graph.add_conditional_edges(
    "chatbot", 
    route, 
    path_map={"use_tool": "tools", "done": END}  # í‚¤ â†’ ì‹¤ì œ ë…¸ë“œ ì´ë¦„ ë§¤í•‘
)
```

**ë°˜í™˜ê°’**
- Self: ë©”ì„œë“œ ì²´ì´ë‹ì„ ìœ„í•´ ìê¸° ìì‹ ì„ ë°˜í™˜í•©ë‹ˆë‹¤.

**ì£¼ìš” ê¸°ëŠ¥**
1. ì¡°ê±´ë¶€ ì—£ì§€ë¥¼ ê·¸ë˜í”„ì— ì¶”ê°€í•©ë‹ˆë‹¤.
2. `path_map`ì„ ë”•ì…”ë„ˆë¦¬ë¡œ ë³€í™˜í•©ë‹ˆë‹¤.
3. `path` í•¨ìˆ˜ì˜ ë°˜í™˜ íƒ€ì…ì„ ë¶„ì„í•˜ì—¬ ìë™ìœ¼ë¡œ `path_map`ì„ ìƒì„±í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.
4. ì¡°ê±´ë¶€ ë¶„ê¸°ë¥¼ ê·¸ë˜í”„ì— ì €ì¥í•©ë‹ˆë‹¤.

**ì°¸ê³ **
- ì´ë¯¸ ì»´íŒŒì¼ëœ ê·¸ë˜í”„ì— ì—£ì§€ë¥¼ ì¶”ê°€í•˜ë©´ ê²½ê³  ë©”ì‹œì§€ê°€ ì¶œë ¥ë©ë‹ˆë‹¤.
- `path` í•¨ìˆ˜ì˜ ë°˜í™˜ ê°’ì— ëŒ€í•œ íƒ€ì… íŒíŠ¸ê°€ ì—†ê±°ë‚˜ `path_map`ì´ ì œê³µë˜ì§€ ì•Šìœ¼ë©´, ê·¸ë˜í”„ ì‹œê°í™” ì‹œ í•´ë‹¹ ì—£ì§€ê°€ ê·¸ë˜í”„ì˜ ëª¨ë“  ë…¸ë“œë¡œ ì „í™˜ë  ìˆ˜ ìˆë‹¤ê³  ê°€ì •í•©ë‹ˆë‹¤.
- ë™ì¼í•œ ì´ë¦„ì˜ ë¶„ê¸°ê°€ ì´ë¯¸ ì¡´ì¬í•˜ëŠ” ê²½ìš° `ValueError`ê°€ ë°œìƒí•©ë‹ˆë‹¤.

```python
from langgraph.graph import START, END


def route_tools(
    state: State,
):
    if messages := state.get("messages", []):
        # ê°€ì¥ ìµœê·¼ AI ë©”ì‹œì§€ ì¶”ì¶œ
        ai_message = messages[-1]
    else:
        # ì…ë ¥ ìƒíƒœì— ë©”ì‹œì§€ê°€ ì—†ëŠ” ê²½ìš° ì˜ˆì™¸ ë°œìƒ
        raise ValueError(f"No messages found in input state to tool_edge: {state}")

    # AI ë©”ì‹œì§€ì— ë„êµ¬ í˜¸ì¶œì´ ìˆëŠ” ê²½ìš° "tools" ë°˜í™˜
    if hasattr(ai_message, "tool_calls") and len(ai_message.tool_calls) > 0:
        # ë„êµ¬ í˜¸ì¶œì´ ìˆëŠ” ê²½ìš° "tools" ë°˜í™˜
        return "use_tools"
    # ë„êµ¬ í˜¸ì¶œì´ ì—†ëŠ” ê²½ìš° "END" ë°˜í™˜
    return "The END"


# `tools_condition` í•¨ìˆ˜ëŠ” ì±—ë´‡ì´ ë„êµ¬ ì‚¬ìš©ì„ ìš”ì²­í•˜ë©´ "tools"ë¥¼ ë°˜í™˜í•˜ê³ , ì§ì ‘ ì‘ë‹µì´ ê°€ëŠ¥í•œ ê²½ìš° "END"ë¥¼ ë°˜í™˜
graph_builder.add_conditional_edges(
    source="chatbot",
    path=route_tools,
    # route_tools ì˜ ë°˜í™˜ê°’ì´ "use_tools" ì¸ ê²½ìš° "tools" ë…¸ë“œë¡œ, ê·¸ë ‡ì§€ ì•Šìœ¼ë©´ END ë…¸ë“œë¡œ ë¼ìš°íŒ…
    path_map={"use_tools": "tools", "The END": END},
)

# tools > chatbot
graph_builder.add_edge("tools", "chatbot")

# START > chatbot
graph_builder.add_edge(START, "chatbot")

# ê·¸ë˜í”„ ì»´íŒŒì¼
graph = graph_builder.compile()
```

* **ì¡°ê±´ë¶€ ì—£ì§€**ê°€ ë‹¨ì¼ ë…¸ë“œì—ì„œ ì‹œì‘í•´ì•¼ í•œë‹¤.
* ì´ëŠ” ê·¸ë˜í”„ì— `chatbot` ë…¸ë“œê°€ ì‹¤í–‰ë  ë•Œë§ˆë‹¤ ë„êµ¬ë¥¼ í˜¸ì¶œí•˜ë©´ 'tools'ë¡œ ì´ë™í•˜ê³ , ì§ì ‘ ì‘ë‹µí•˜ë©´ ë£¨í”„ë¥¼ ì¢…ë£Œí•˜ë¼ëŠ” ì˜ë¯¸ 
* ì‚¬ì „ êµ¬ì¶•ëœ `tools_condition`ì²˜ëŸ¼, í•¨ìˆ˜ëŠ” ë„êµ¬ í˜¸ì¶œì´ ì—†ì„ ê²½ìš° `END` ë¬¸ìì—´ì„ ë°˜í™˜(ê·¸ë˜í”„ ì¢…ë£Œ). 
* ê·¸ë˜í”„ê°€ `END`ë¡œ ì „í™˜ë˜ë©´ ë” ì´ìƒ ì™„ë£Œí•  ì‘ì—…ì´ ì—†ìœ¼ë©° ì‹¤í–‰ì„ ì¤‘ì§€  

```python
from langchain_teddynote.graphs import visualize_graph

# ê·¸ë˜í”„ ì‹œê°í™”
visualize_graph(graph)
```

* ì´ì œ ë´‡ì—ê²Œ í›ˆë ¨ ë°ì´í„° ì™¸ì˜ ì§ˆë¬¸ì„ í•  ìˆ˜ ìˆë‹¤.

```python
inputs = {"messages": "í…Œë””ë…¸íŠ¸ YouTube ì±„ë„ì— ëŒ€í•´ì„œ ê²€ìƒ‰í•´ ì¤˜"}

for event in graph.stream(inputs, stream_mode="values"):
    for key, value in event.items():
        print(f"\n==============\nSTEP: {key}\n==============\n")
        # display_message_tree(value["messages"][-1])
        print(value[-1])
```

```
==============
STEP: chatbot
==============

content='' additional_kwargs={'tool_calls': [{'id': 'call_yFcDDsMxrcuqBkvkOM01i9Eg', 'function': {'arguments': '{"query":"í…Œë””ë…¸íŠ¸ YouTube"}', 'name': 'tavily_web_search'}, 'type': 'function'}], 'refusal': None} response_metadata={'token_usage': {'completion_tokens': 22, 'prompt_tokens': 84, 'total_tokens': 106, 'completion_tokens_details': {'audio_tokens': None, 'reasoning_tokens': 0}, 'prompt_tokens_details': {'audio_tokens': None, 'cached_tokens': 0}}, 'model_name': 'gpt-4o-mini-2024-07-18', 'system_fingerprint': 'fp_482c22a7bc', 'finish_reason': 'tool_calls', 'logprobs': None} id='run-6d5911f7-452b-4f65-8535-f08c198521fd-0' tool_calls=[{'name': 'tavily_web_search', 'args': {'query': 'í…Œë””ë…¸íŠ¸ YouTube'}, 'id': 'call_yFcDDsMxrcuqBkvkOM01i9Eg', 'type': 'tool_call'}] usage_metadata={'input_tokens': 84, 'output_tokens': 22, 'total_tokens': 106, 'input_token_details': {'cache_read': 0}, 'output_token_details': {'reasoning': 0}}

==============
STEP: tools
==============

content='"[{\\"url\\": \\"https://teddynote.com/\\", \\"content\\": \\"{\\\\\\"title\\\\\\": \\\\\\"TeddyNote\\\\\\", \\\\\\"content\\\\\\": \\\\\\"í…Œë””ë…¸íŠ¸.dev Teddy Lee (ì´ê²½ë¡) ğŸ‘‹. YouTube í…Œë””ë…¸íŠ¸; ë¸”ë¡œê·¸ í…Œë””ë…¸íŠ¸; LinkedIn; LangChain. LangChain í•œêµ­ì–´ íŠœí† ë¦¬ì–¼ Github; LangChain í•œêµ­ì–´ íŠœí† ë¦¬ì–¼ ìœ„í‚¤ë…ìŠ¤ ì „ìì±…\\\\\\", \\\\\\"raw\\\\\\": null}\\"}, {\\"url\\": \\"https://teddylee777.github.io/about/\\", \\"content\\": \\"{\\\\\\"title\\\\\\": \\\\\\"ì´ê²½ë¡ (Teddy Lee) - í…Œë””ë…¸íŠ¸\\\\\\", \\\\\\"content\\\\\\": \\\\\\"â‘  í…Œë””ë…¸íŠ¸ ìœ íŠœë¸Œ - êµ¬ê²½í•˜ëŸ¬ ê°€ê¸°! â‘¡ LangChain í•œêµ­ì–´ íŠœí† ë¦¬ì–¼ ë°”ë¡œê°€ê¸° ğŸ‘€ â‘¢ ë­ì²´ì¸ ë…¸íŠ¸ ë¬´ë£Œ ì „ìì±…(wikidocs) ë°”ë¡œê°€ê¸° ğŸ™Œ â‘£ RAG ë¹„ë²•ë…¸íŠ¸ LangChain ê°•ì˜ì˜¤í”ˆ ë°”ë¡œê°€ê¸° ğŸ™Œ â‘¤ ì„œìš¸ëŒ€ PyTorch ë”¥ëŸ¬ë‹ ê°•ì˜ ë°”ë¡œê°€ê¸° ğŸ™Œ. ì´ê²½ë¡ (Teddy Lee) ëª©ì°¨. Contact; Career; Lecture\\\\\\", \\\\\\"raw\\\\\\": \\\\\\"ğŸ”¥ì•Œë¦¼ğŸ”¥\\\\\\\\nâ‘  í…Œë””ë…¸íŠ¸ ìœ íŠœë¸Œ -\\\\\\\\nêµ¬ê²½í•˜ëŸ¬ ê°€ê¸°!\\\\\\\\nâ‘¡ LangChain í•œêµ­ì–´ íŠœí† ë¦¬ì–¼\\\\\\\\në°”ë¡œê°€ê¸° ğŸ‘€\\\\\\\\nâ‘¢ ë­ì²´ì¸ ë…¸íŠ¸ ë¬´ë£Œ ì „ìì±…(wikidocs)\\\\\\\\nì´í•´ê°€ ì™ì™ ë˜ëŠ” ê°•ì˜ì™€ ë¸”ë¡œê·¸ ì£¼ì†Œë“¤ì„ ë©”ëª¨í•´ ë‘ì—ˆë‹¤ê°€ ì •ë¦¬í•´ ë³¸ ë‚´ìš©ì´ì—ìš”.\\\\\\\\nê·¸ ë°–ì— ì‹¤ìŠµíŒŒì¼, ë¸”ë¡œê·¸, ë…¼ë¬¸ ë“±ë„ ì˜ ì •ë¦¬í•´ ë‘ì—ˆìœ¼ë‹ˆ, ì§€ë‚˜ê°€ë‹¤ ì“± ë“¤ëŸ¬ë³´ì„¸ìš”ğŸ˜Š\\\\\\\\nğŸ‘€ (ì£¼ì˜) ë‚´ìš©ì´ ë¬´ì²™ ë§ìœ¼ë‹ˆ, ë‹¤ ìŠµë“í•˜ë ¤ í•˜ì§€ ë§ˆì‹œê³ , ëª¨ë¥´ëŠ” ë‚´ìš©ë§Œ ë°œì·Œí•´ì„œ ë³´ì„¸ìš”\\\\\\\\nğŸ“Œ ì§€ê¸ˆ ë‹¹ì¥ í˜¼ê³µ í•˜ëŸ¬ê°€ê¸°\\\\\\"}\\"}]"' name='tavily_web_search' id='7aa1ee68-66a2-473a-bd4c-d9d45766a7e9' tool_call_id='call_yFcDDsMxrcuqBkvkOM01i9Eg'

==============
STEP: chatbot
==============

content='í…Œë””ë…¸íŠ¸(TeddyNote)ëŠ” ì´ê²½ë¡(Teddy Lee)ì´ë¼ëŠ” ì¸ë¬¼ì´ ìš´ì˜í•˜ëŠ” YouTube ì±„ë„ì…ë‹ˆë‹¤. ì´ ì±„ë„ì—ì„œëŠ” ë¨¸ì‹ ëŸ¬ë‹, ë°ì´í„° ë¶„ì„, ë”¥ëŸ¬ë‹ ë“± ë‹¤ì–‘í•œ ì£¼ì œë¡œ ê°•ì˜ ì˜ìƒì„ ì œê³µí•˜ê³  ìˆìŠµë‹ˆë‹¤. \n\n**í…Œë””ë…¸íŠ¸ ê´€ë ¨ ë§í¬:**\n- [í…Œë””ë…¸íŠ¸ ê³µì‹ ì›¹ì‚¬ì´íŠ¸](https://teddynote.com/)\n- [ì´ê²½ë¡ì˜ ê°•ì˜ ì •ë³´](https://teddylee777.github.io/lectures/)\n- [YouTube ì±„ë„ ë°”ë¡œê°€ê¸°](https://teddylee777.github.io/about/) - ìœ íŠœë¸Œ ì±„ë„ì—ì„œëŠ” ì£¼ì œë³„ë¡œ ê°•ì˜ ì˜ìƒì„ ì‹œë¦¬ì¦ˆë¡œ ëª¨ì•„ë†“ì•˜ìœ¼ë©°, êµ¬ë…ê³¼ ì¢‹ì•„ìš”ë¥¼ í†µí•´ ì§€ì›í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.\n\nê°•ì˜ëŠ” ì£¼ë¡œ ë°ì´í„° ë¶„ì„, ë¨¸ì‹ ëŸ¬ë‹, í…ì„œí”Œë¡œìš° ê´€ë ¨ ë‚´ìš©ìœ¼ë¡œ êµ¬ì„±ë˜ì–´ ìˆìœ¼ë©°, ìˆ˜ê°•ìƒë“¤ë¡œë¶€í„° ê¸ì •ì ì¸ í‰ê°€ë¥¼ ë°›ê³  ìˆìŠµë‹ˆë‹¤.' additional_kwargs={'refusal': None} response_metadata={'token_usage': {'completion_tokens': 201, 'prompt_tokens': 3085, 'total_tokens': 3286, 'completion_tokens_details': {'audio_tokens': None, 'reasoning_tokens': 0}, 'prompt_tokens_details': {'audio_tokens': None, 'cached_tokens': 0}}, 'model_name': 'gpt-4o-mini-2024-07-18', 'system_fingerprint': 'fp_7693ae462b', 'finish_reason': 'stop', 'logprobs': None} id='run-6a51c788-603d-4ada-95dc-4baadacecad3-0' usage_metadata={'input_tokens': 3085, 'output_tokens': 201, 'total_tokens': 3286, 'input_token_details': {'cache_read': 0}, 'output_token_details': {'reasoning': 0}}
```

* ì¶œë ¥ê°’ì˜ `STEP: chatbot`ì„ ë³´ë©´ contentëŠ” ì—†ì§€ë§Œ `tool_calls`ê°€ í¬í•¨ëœ ë©”ì‹œì§€ê°€ ì¶œë ¥ë˜ëŠ” ê²ƒì„ ë³¼ ìˆ˜ ìˆë‹¤.
* `STEP: tools`ì—ì„œëŠ” ë„êµ¬ ë…¸ë“œê°€ ì‹¤í–‰ë˜ì–´ `tool_calls`ì˜ ê²°ê³¼ê°€ ì¶œë ¥ë˜ëŠ” ê²ƒì„ ë³¼ ìˆ˜ ìˆë‹¤.
* `STEP: chatbot`ì—ì„œëŠ” ë„êµ¬ ë…¸ë“œì˜ ê²°ê³¼ê°€ ë°˜ì˜ëœ ìµœì¢… ë‹µë³€ì´ ì¶œë ¥ë˜ëŠ” ê²ƒì„ ë³¼ ìˆ˜ ìˆë‹¤. 


ë„êµ¬ í˜¸ì¶œ í›„ êµ¬ì¡°ì— ëŒ€í•œ ì´ë¯¸ì§€

![](./image/tool-message-01.png)

- [ì´ì „ ì‹¤í–‰ì— ëŒ€í•œ LangSmith ì¶”ì ](https://smith.langchain.com/public/4f82ddfa-a452-40f3-ab09-4eb088b812a4/r)

