---
title: "Gemini Video Analysis"
subtitle: ì–¸ì–´ ëª¨ë¸
description: |
  ë‹¤ì–‘í•œ LLM ì œê³µìì™€ ëª¨ë¸ í™œìš©ë²•ì„ ë‹¤ë£¬ë‹¤.
categories:
  - AI
  - RAG
  - LangChain
author: Kwangmin Kim
date: 02/11/2025
format: 
  html:
    page-layout: full
    code-fold: true
    toc: true
    number-sections: true
draft: False
execute:
    eval: false
---


**ì£¼ìš” íë¦„**

1. `File API`ë¥¼ ì‚¬ìš©í•˜ì—¬ ë¹„ë””ì˜¤ íŒŒì¼ì„ ì—…ë¡œë“œí•©ë‹ˆë‹¤.
2. `GenerateContent` ìš”ì²­ì„ í†µí•´ ë¹„ë””ì˜¤ì— ëŒ€í•œ ì§ˆë¬¸ì„ ìš”ì²­í•©ë‹ˆë‹¤.
3. ìƒì„±ëœ ì‘ë‹µì„ í™•ì¸í•©ë‹ˆë‹¤.
4. ì—…ë¡œë“œí•œ Video íŒŒì¼ì„ ì‚­ì œí•©ë‹ˆë‹¤.


**ì¤‘ìš”:** 

- ë³¸ íŠœí† ë¦¬ì–¼ì˜ `File API` ëŠ” ì¸ì¦ ë° ì ‘ê·¼ì„ ìœ„í•´ `API keys`ë¥¼ ì‚¬ìš©í•©ë‹ˆë‹¤. 

- ì—…ë¡œë“œëœ íŒŒì¼ì€ `API key`ì˜ í´ë¼ìš°ë“œ í”„ë¡œì íŠ¸ì™€ ì—°ê²°ë©ë‹ˆë‹¤. 

ë‹¤ë¥¸ `Gemini API` ì™€ ë‹¬ë¦¬, `API key`ëŠ” `File API`ì— ì—…ë¡œë“œí•œ ë°ì´í„°ì— ëŒ€í•œ ì ‘ê·¼ ê¶Œí•œë„ ë¶€ì—¬í•˜ë¯€ë¡œ `API key`ë¥¼ ì•ˆì „í•˜ê²Œ ë³´ê´€í•˜ëŠ” ë° íŠ¹ë³„íˆ ì£¼ì˜í•´ì•¼ í•©ë‹ˆë‹¤.

**Reference**

- [Gemini API(Cookbook) - Video](https://ai.google.dev/api/rest/v1/models/generateContent#media)

**API KEY ë°œê¸‰**

- [ë§í¬](https://makersuite.google.com/app/apikey?hl=ko) ì—ì„œ API KEYë¥¼ ë°œê¸‰ë°›ì•„ì£¼ì„¸ìš”.
- ì‚¬ìš©ìì˜ Google API í‚¤ë¥¼ í™˜ê²½ ë³€ìˆ˜ `GOOGLE_API_KEY`ë¡œ ì„¤ì •í•©ë‹ˆë‹¤.

`.env` íŒŒì¼ì— ì•„ë˜ì™€ ê°™ì´ ì…ë ¥í•©ë‹ˆë‹¤.

```
GOOGLE_API_KEY=<ì‚¬ìš©ìì˜ API KEY>
```


```{python}
# LangSmith ì¶”ì  ì„¤ì •
# !pip install langchain-teddynote
from langchain_teddynote import logging

# í”„ë¡œì íŠ¸ ì´ë¦„ ì…ë ¥
logging.langsmith("CH04-Models")
```

```{python}
# LangSmith ì¶”ì  ì„¤ì •
# !pip install langchain-teddynote
from langchain_teddynote import logging

# í”„ë¡œì íŠ¸ ì´ë¦„ ì…ë ¥
logging.langsmith("CH04-Gemini-Video")
```

## ë¹„ë””ì˜¤ ì—…ë¡œë“œ

`Gemini API` ëŠ” ë¹„ë””ì˜¤ íŒŒì¼ í˜•ì‹ì„ ì§ì ‘ ìˆ˜ìš©í•©ë‹ˆë‹¤. 

**ì œí•œì‚¬í•­**

- `File API`ëŠ” 2GB ì´í•˜ì˜ íŒŒì¼ì„ ìˆ˜ìš©í•˜ë©° í”„ë¡œì íŠ¸ë‹¹ ìµœëŒ€ 20GBì˜ íŒŒì¼ì„ ì €ì¥í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤. 
- íŒŒì¼ì€ 2ì¼ ë™ì•ˆ ìœ ì§€ë˜ë©° APIì—ì„œ **ë‹¤ìš´ë¡œë“œí•  ìˆ˜ ì—†ìŠµë‹ˆë‹¤**. 

ë³¸ ì˜ˆì œëŠ” í…Œë””ë…¸íŠ¸ YouTube ì±„ë„ì— ê²Œì‹œëœ ë¹„ë””ì˜¤ë¥¼ ì‚¬ìš©í•©ë‹ˆë‹¤. (ë‹¤ë¥¸ ë¹„ë””ì˜¤ë¡œ êµì²´í•˜ì—¬ ì§„í–‰í•´ë„ ì¢‹ìŠµë‹ˆë‹¤)

- [ğŸ§‘â€ğŸ’» #PDF ì „ì²˜ë¦¬ í•  ìˆ˜ ìˆëŠ” ê±´ ë‹¤ í•´ë´¤ìŒ.](https://youtu.be/O3qFWRObAXw)

```{python}
# íŒŒì¼ ë‹¤ìš´ë¡œë“œ í›„ teddynote-sample-video.mp4 íŒŒì¼ë¡œ ì €ì¥
!wget "https://www.dropbox.com/scl/fi/ugue14fyo010jgc7wuh4g/teddynote-sample-video.mp4?rlkey=wcsiktklt7jgoibsluft3m6z9&st=prv4p2uu&dl=1" -qO teddynote-sample-video.mp4
```

ì•„ë˜ ë¹„ë””ì˜¤ íŒŒì¼ì˜ ê²½ë¡œë¥¼ ì…ë ¥í•©ë‹ˆë‹¤.

```{python}
# ë¹„ë””ì˜¤ íŒŒì¼ ì´ë¦„ ì§€ì •
video_file_name = "teddynote-sample-video.mp4"
```

ë‹¤ìŒìœ¼ë¡œëŠ” `File API`ë¥¼ ì‚¬ìš©í•˜ì—¬ ë¹„ë””ì˜¤ íŒŒì¼ì„ ì—…ë¡œë“œí•©ë‹ˆë‹¤.

```{python}
import google.generativeai as genai

# íŒŒì¼ ì—…ë¡œë“œ ì§„í–‰ ë©”ì‹œì§€ ì¶œë ¥
print(f"íŒŒì¼ì„ ì—…ë¡œë“œ ì¤‘ì…ë‹ˆë‹¤...")

# íŒŒì¼ ì—…ë¡œë“œ ë° íŒŒì¼ ê°ì²´ ë°˜í™˜
video_file = genai.upload_file(path=video_file_name)

# ì—…ë¡œë“œ ì™„ë£Œ ë©”ì‹œì§€ ë° íŒŒì¼ URI ì¶œë ¥
print(f"ì—…ë¡œë“œ ì™„ë£Œ: {video_file.uri}")
```

íŒŒì¼ì„ ì—…ë¡œë“œí•œ í›„, `files.get` ì„ í˜¸ì¶œí•˜ì—¬ APIê°€ íŒŒì¼ì„ ì„±ê³µì ìœ¼ë¡œ ì™„ë£Œë˜ì—ˆëŠ”ì§€ í™•ì¸í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤. 

`files.get`ì€  API í‚¤ê°€ ì†í•œ í´ë¼ìš°ë“œ í”„ë¡œì íŠ¸ì™€ ì—°ê´€ëœ íŒŒì¼ APIì— ì—…ë¡œë“œëœ íŒŒì¼ì„ í™•ì¸í•  ìˆ˜ ìˆê²Œ í•´ì¤ë‹ˆë‹¤. 

```{python}
import time

# ë¹„ë””ì˜¤ íŒŒì¼ ì²˜ë¦¬ ìƒíƒœ í™•ì¸
while video_file.state.name == "PROCESSING":
    # ì²˜ë¦¬ ì™„ë£Œ ëŒ€ê¸° ë©”ì‹œì§€ ì¶œë ¥
    print("ë¹„ë””ì˜¤ ì—…ë¡œë“œ ë° ì „ì²˜ë¦¬ê°€ ì™„ë£Œë  ë•Œê¹Œì§€ ì ì‹œë§Œ ê¸°ë‹¤ë ¤ì£¼ì„¸ìš”...")
    # 10ì´ˆ ëŒ€ê¸°
    time.sleep(10)
    # ë¹„ë””ì˜¤ íŒŒì¼ ìƒíƒœ ê°±ì‹ 
    video_file = genai.get_file(video_file.name)

# ì²˜ë¦¬ ì‹¤íŒ¨ ì‹œ ì˜ˆì™¸ ë°œìƒ
if video_file.state.name == "FAILED":
    raise ValueError(video_file.state.name)

# ì²˜ë¦¬ ì™„ë£Œ ë©”ì‹œì§€ ì¶œë ¥
print(
    f"\në¹„ë””ì˜¤ ì²˜ë¦¬ê°€ ì™„ë£Œë˜ì—ˆìŠµë‹ˆë‹¤!\nì´ì œ ëŒ€í™”ë¥¼ ì‹œì‘í•  ìˆ˜ ìˆì–´ìš”: " + video_file.uri
)
```

ë¹„ë””ì˜¤ê°€ ì—…ë¡œë“œëœ í›„, `generate_content` í•¨ìˆ˜ë¥¼ ì‚¬ìš©í•˜ì—¬ Video ì— ëŒ€í•œ ì§ˆë¬¸ì„ ìš”ì²­í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.

```{python}
# í”„ë¡¬í”„íŠ¸
prompt = "ì´ ì˜ìƒì— ëŒ€í•´ì„œ ì§§ê²Œ ìš”ì•½í•´ ì¤„ ìˆ˜ ìˆë‚˜ìš”?"

# ëª¨ë¸ì„ Gemini 1.5 Flashë¡œ ì„¤ì •
model = genai.GenerativeModel(model_name="models/gemini-1.5-flash")

# LLM ë‹µë³€ ìš”ì²­
response = model.generate_content(
    [prompt, video_file], request_options={"timeout": 600}
)
# ê²°ê³¼ ì¶œë ¥
print(response.text)
```

ì•„ë˜ëŠ” ìŠ¤íŠ¸ë¦¼ ì¶œë ¥ ì˜ˆì œì…ë‹ˆë‹¤. (`stream=True` ì˜µì…˜ ì¶”ê°€)

```{python}
# í”„ë¡¬í”„íŠ¸ ìƒì„±
prompt = "ì´ ì˜ìƒì—ì„œ Gencon ê´€ë ¨ ì–¸ê¸‰í•œ ë¶€ë¶„ì˜ ì‹œê°„ì„ ì•Œë ¤ì£¼ê³ , ì–´ë–¤ ë‚´ìš©ì„ ë§í–ˆëŠ”ì§€ ì•Œë ¤ì£¼ì„¸ìš”."

# ëª¨ë¸ì„ Gemini 1.5 Flashë¡œ ì„¤ì •
model = genai.GenerativeModel(model_name="models/gemini-1.5-flash")

# LLM ìŠ¤íŠ¸ë¦¼ ë‹µë³€ ìš”ì²­
response = model.generate_content(
    [prompt, video_file], request_options={"timeout": 600}, stream=True
)

# ìƒì„±ëœ ì½˜í…ì¸  ì¶œë ¥
for chunk in response:
    print(chunk.text, end="", flush=True)
```

## íŒŒì¼ ì‚­ì œ

íŒŒì¼ì€ 2ì¼ í›„ ìë™ìœ¼ë¡œ ì‚­ì œë˜ê±°ë‚˜ `files.delete()`ë¥¼ ì‚¬ìš©í•˜ì—¬ ìˆ˜ë™ìœ¼ë¡œ ì‚­ì œí•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.

```{python}
# íŒŒì¼ ì‚­ì œ
genai.delete_file(video_file.name)

# ì‚­ì œ ì™„ë£Œ ë©”ì‹œì§€ ì¶œë ¥
print(f"ì˜ìƒì„ ì‚­ì œí–ˆìŠµë‹ˆë‹¤: {video_file.uri}")
```

