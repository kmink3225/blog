{
  "hash": "74f4680623a4709ebdb9ca4a30eef478",
  "result": {
    "engine": "jupyter",
    "markdown": "---\ntitle: \"Cohere reranker\"\nsubtitle: 재순위화\ndescription: |\n  검색 결과의 관련성을 개선하는 Reranker 모델을 다룬다.\ncategories:\n  - AI\n  - RAG\n  - LangChain\nauthor: Kwangmin Kim\ndate: 12/31/2024\nformat: \n  html:\n    page-layout: full\n    code-fold: true\n    toc: true\n    number-sections: true\ndraft: False\nexecute:\n    eval: false\n---\n\n>[Cohere](https://cohere.ai/about)는 기업이 인간-기계 상호작용을 개선할 수 있도록 돕는 자연어 처리 모델을 제공하는 캐나다의 스타트업입니다.\n\n이 노트북은 `retriever`에서 [Cohere의 rerank endpoint](https://docs.cohere.com/docs/reranking)를 사용하는 방법을 보여줍니다. \n\n::: {#dc681c6b .cell execution_count=1}\n``` {.python .cell-code}\n# 설치\n# !pip install -qU cohere\n```\n:::\n\n\n## Cohere API 키 설정\n\n- [API 키 발급](https://dashboard.cohere.com/api-keys)\n- `.env` 파일에 `COHERE_API_KEY` 키 값에 API 키를 넣어주세요.\n\n**참고**\n- [공식 도큐먼트](https://docs.cohere.com/docs/the-cohere-platform?_gl=1*st323v*_gcl_au*MTA2ODUyNDMyNy4xNzE4MDMzMjY2*_ga*NTYzNTI5NDYyLjE3MTgwMzMyNjc.*_ga_CRGS116RZS*MTcyMTk4NzMxMi4xMS4xLjE3MjE5ODczNjIuMTAuMC4w)\n- [Reranker Model 리스트](https://docs.cohere.com/docs/rerank-2)\n\n::: {#991cd37f .cell execution_count=2}\n``` {.python .cell-code}\n# API KEY를 환경변수로 관리하기 위한 설정 파일\nfrom dotenv import load_dotenv\n\n# API KEY 정보로드\nload_dotenv()\n```\n:::\n\n\n::: {#253626b7 .cell execution_count=3}\n``` {.python .cell-code}\n# LangSmith 추적을 설정합니다. https://smith.langchain.com\n# !pip install langchain-teddynote\nfrom langchain_teddynote import logging\n\n# 프로젝트 이름을 입력합니다.\nlogging.langsmith(\"Reranker\")\n```\n:::\n\n\n## 사용법\n\n::: {#29b81ae3 .cell execution_count=4}\n``` {.python .cell-code}\ndef pretty_print_docs(docs):\n    print(\n        f\"\\n{'-' * 100}\\n\".join(\n            [f\"Document {i+1}:\\n\\n\" + d.page_content for i, d in enumerate(docs)]\n        )\n    )\n```\n:::\n\n\n**Cohere 다국어 지원 모델**\n\n- Embedding: `embed-multilingual-v3.0`, `embed-multilingual-light-v3.0`, `embed-multilingual-v2.0`\n- Reranker: `rerank-multilingual-v3.0`, `rerank-multilingual-v2.0`\n\n::: {#5e10614e .cell execution_count=5}\n``` {.python .cell-code}\nfrom langchain_community.document_loaders import TextLoader\nfrom langchain_community.vectorstores import FAISS\nfrom langchain_text_splitters import RecursiveCharacterTextSplitter\nfrom langchain_cohere import CohereEmbeddings\n\n# 문서 로드\ndocuments = TextLoader(\"./data/appendix-keywords.txt\").load()\n\n# 텍스트 분할기 초기화\ntext_splitter = RecursiveCharacterTextSplitter(chunk_size=500, chunk_overlap=100)\n\n# 문서 분할\ntexts = text_splitter.split_documents(documents)\n\n# 검색기 초기화\nretriever = FAISS.from_documents(\n    texts, CohereEmbeddings(model=\"embed-multilingual-v3.0\")\n).as_retriever(search_kwargs={\"k\": 10})\n\n# 질의문\nquery = \"Word2Vec 에 대해서 알려줘!\"\n\n# 문서 검색\ndocs = retriever.invoke(query)\n\n# 문서 출력\npretty_print_docs(docs)\n```\n:::\n\n\n## CohereRerank을 사용한 재정렬\n이제 기본 `retriever`를 `ContextualCompressionRetriever`로 감싸보겠습니다. Cohere 재정렬 엔드포인트를 사용하여 반환된 결과를 재정렬하는 `CohereRerank`를 추가할 것입니다.\nCohereRerank에서 모델 이름을 지정하는 것이 필수임을 유의하십시오!\n\n::: {#4bad8674 .cell execution_count=6}\n``` {.python .cell-code}\nfrom langchain.retrievers.contextual_compression import ContextualCompressionRetriever\nfrom langchain_cohere import CohereRerank\n\n# 문서 재정렬 모델 설정\ncompressor = CohereRerank(model=\"rerank-multilingual-v3.0\")\n\n# 문맥 압축 검색기 설정\ncompression_retriever = ContextualCompressionRetriever(\n    base_compressor=compressor, base_retriever=retriever\n)\n\n# 압축된 문서 검색\ncompressed_docs = compression_retriever.invoke(\"Word2Vec 에 대해서 알려줘!\")\n\n# 압축된 문서 출력\npretty_print_docs(compressed_docs)\n```\n:::\n\n\n",
    "supporting": [
      "02-Cohere-Reranker_files"
    ],
    "filters": [],
    "includes": {}
  }
}