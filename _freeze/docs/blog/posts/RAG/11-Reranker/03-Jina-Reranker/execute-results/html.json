{
  "hash": "75f0c149a38f369f5f34465f596fc301",
  "result": {
    "engine": "jupyter",
    "markdown": "---\ntitle: \"Jina Reranker\"\nsubtitle: 재순위화\ndescription: |\n  검색 결과의 관련성을 개선하는 Reranker 모델을 다룬다.\ncategories:\n  - AI\n  - RAG\n  - LangChain\nauthor: Kwangmin Kim\ndate: 12/31/2024\nformat: \n  html:\n    page-layout: full\n    code-fold: true\n    toc: true\n    number-sections: true\ndraft: False\nexecute:\n    eval: false\n---\n\n이 노트북은 문서 압축 및 `retrieval`을 위해 **Jina Reranker**를 사용하는 방법을 보여줍니다.\n\n- [API 키 발급](https://jina.ai/reranker)\n\n`.env` 파일에 아래와 같이 추가합니다.\n\n```\nJINA_API_KEY=\"YOUR_JINA_API_KEY\"\n```\n\n::: {#51b77980 .cell execution_count=1}\n``` {.python .cell-code}\n# API KEY를 환경변수로 관리하기 위한 설정 파일\nfrom dotenv import load_dotenv\n\n# API KEY 정보로드\nload_dotenv()\n```\n:::\n\n\n::: {#5570d46f .cell execution_count=2}\n``` {.python .cell-code}\n# LangSmith 추적을 설정합니다. https://smith.langchain.com\n# !pip install langchain-teddynote\nfrom langchain_teddynote import logging\n\n# 프로젝트 이름을 입력합니다.\nlogging.langsmith(\"Reranker\")\n```\n:::\n\n\n## Jina Reranker\n\n간단한 예시를 위한 데이터를 로드하고 retriever 를 생성합니다.\n\n::: {#820e98f8 .cell execution_count=3}\n``` {.python .cell-code}\ndef pretty_print_docs(docs):\n    print(\n        f\"\\n{'-' * 100}\\n\".join(\n            [f\"Document {i+1}:\\n\\n\" + d.page_content for i, d in enumerate(docs)]\n        )\n    )\n```\n:::\n\n\n::: {#4686eb64 .cell execution_count=4}\n``` {.python .cell-code}\nfrom langchain_community.document_loaders import TextLoader\nfrom langchain_community.vectorstores import FAISS\nfrom langchain_text_splitters import RecursiveCharacterTextSplitter\nfrom langchain_openai import OpenAIEmbeddings\n\n# 문서 로드\ndocuments = TextLoader(\"./data/appendix-keywords.txt\").load()\n\n# 텍스트 분할기 초기화\ntext_splitter = RecursiveCharacterTextSplitter(chunk_size=500, chunk_overlap=100)\n\n# 문서 분할\ntexts = text_splitter.split_documents(documents)\n\n# 검색기 초기화\nretriever = FAISS.from_documents(texts, OpenAIEmbeddings()).as_retriever(\n    search_kwargs={\"k\": 10}\n)\n\n# 질의문\nquery = \"Word2Vec 에 대해서 설명해줘.\"\n\n# 문서 검색\ndocs = retriever.invoke(query)\n\n# 문서 출력\npretty_print_docs(docs)\n```\n:::\n\n\n## JinaRerank를 사용한 재정렬 수행\n\n이제 `Jina Reranker`를 압축기로 사용하여 기본 `retriever`를 `ContextualCompressionRetriever`로 감싸봅시다.\n\n::: {#b9ed7714 .cell execution_count=5}\n``` {.python .cell-code}\nfrom ast import mod\nfrom langchain.retrievers import ContextualCompressionRetriever\nfrom langchain_community.document_compressors import JinaRerank\n\n# JinaRerank 압축기 초기화\ncompressor = JinaRerank(model=\"jina-reranker-v2-base-multilingual\", top_n=3)\n\n# 문서 압축 검색기 초기화\ncompression_retriever = ContextualCompressionRetriever(\n    base_compressor=compressor, base_retriever=retriever\n)\n\n# 관련 문서 검색 및 압축\ncompressed_docs = compression_retriever.invoke(\"Word2Vec 에 대해서 설명해줘.\")\n```\n:::\n\n\n::: {#82661f32 .cell execution_count=6}\n``` {.python .cell-code}\n# 압축된 문서의 보기 좋게 출력\npretty_print_docs(compressed_docs)\n```\n:::\n\n\n",
    "supporting": [
      "03-Jina-Reranker_files"
    ],
    "filters": [],
    "includes": {}
  }
}