{
  "hash": "06727870a41c3af26d8e877ad61b9244",
  "result": {
    "engine": "jupyter",
    "markdown": "---\ntitle: \"Azure AI Search Integration\"\nsubtitle: ë²¡í„° ìŠ¤í† ì–´ í†µí•© ë° í•˜ì´ë¸Œë¦¬ë“œ ê²€ìƒ‰\ndescription: |\n  Azure AI Searchì™€ RAG ì‹œìŠ¤í…œ í†µí•©, ë²¡í„° ì¸ë±ìŠ¤ ìƒì„±, í•˜ì´ë¸Œë¦¬ë“œ ê²€ìƒ‰ êµ¬í˜„ ë°©ë²•ì„ ë‹¤ë£¬ë‹¤.\ncategories:\n  - AI\n  - RAG\n  - Azure\n  - Vector Store\nauthor: Kwangmin Kim\ndate: 11/05/2025\nformat: \n  html:\n    page-layout: full\n    code-fold: true\n    toc: true\n    number-sections: true\ndraft: False\nexecute:\n    eval: false\n---\n\n## Azure AI Searchë€?\n\nAzure AI SearchëŠ” Microsoftì˜ ê´€ë¦¬í˜• ê²€ìƒ‰ ì„œë¹„ìŠ¤ë¡œ, **ë²¡í„° ê²€ìƒ‰**ê³¼ **í•˜ì´ë¸Œë¦¬ë“œ ê²€ìƒ‰**ì„ ì§€ì›í•œë‹¤.\n\n**RAG ì‹œìŠ¤í…œì—ì„œì˜ ì—­í• :**\n- ì„ë² ë”© ë²¡í„° ì €ì¥ (Vector Store)\n- ì˜ë¯¸ ê¸°ë°˜ ê²€ìƒ‰ (Semantic Search)\n- í‚¤ì›Œë“œ + ë²¡í„° í•˜ì´ë¸Œë¦¬ë“œ ê²€ìƒ‰\n- ëŒ€ê·œëª¨ ë¬¸ì„œ ê²€ìƒ‰ (ìˆ˜ë°±ë§Œ ê°œ ë¬¸ì„œ)\n\n**ì™œ Azure AI Searchì¸ê°€?**\n- ì™„ì „ ê´€ë¦¬í˜• ì„œë¹„ìŠ¤ (ì„œë²„ ê´€ë¦¬ ë¶ˆí•„ìš”)\n- ë†’ì€ ê°€ìš©ì„± (99.9% SLA)\n- ìë™ ìŠ¤ì¼€ì¼ë§\n- ì—”í„°í”„ë¼ì´ì¦ˆ ë³´ì•ˆ (Private Endpoint, RBAC)\n\n## Azure AI Search ì£¼ìš” ê°œë…\n\n### ì¸ë±ìŠ¤ (Index)\nê²€ìƒ‰ ê°€ëŠ¥í•œ ë¬¸ì„œ ì»¬ë ‰ì…˜. RDBì˜ í…Œì´ë¸”ê³¼ ìœ ì‚¬í•˜ë‹¤.\n\n**êµ¬ì„± ìš”ì†Œ:**\n- **í•„ë“œ (Fields)**: ë¬¸ì„œì˜ ì†ì„± (ì œëª©, ë‚´ìš©, ë©”íƒ€ë°ì´í„° ë“±)\n- **ë²¡í„° í•„ë“œ (Vector Fields)**: ì„ë² ë”© ë²¡í„° ì €ì¥\n- **ê²€ìƒ‰ ê°€ëŠ¥ í•„ë“œ (Searchable)**: ì „ì²´ í…ìŠ¤íŠ¸ ê²€ìƒ‰ ëŒ€ìƒ\n- **í•„í„°ë§ ê°€ëŠ¥ í•„ë“œ (Filterable)**: ì¡°ê±´ í•„í„°ë§ ê°€ëŠ¥\n\n### ê²€ìƒ‰ ìœ í˜•\n\n| ê²€ìƒ‰ ìœ í˜• | ì„¤ëª… | ìš©ë„ |\n|----------|------|------|\n| **ì „ì²´ í…ìŠ¤íŠ¸ ê²€ìƒ‰** | í‚¤ì›Œë“œ ê¸°ë°˜ BM25 ì•Œê³ ë¦¬ì¦˜ | ì •í™•í•œ ìš©ì–´ ë§¤ì¹­ |\n| **ë²¡í„° ê²€ìƒ‰** | ì„ë² ë”© ê¸°ë°˜ ì˜ë¯¸ ê²€ìƒ‰ | ì˜ë¯¸ì  ìœ ì‚¬ì„± |\n| **í•˜ì´ë¸Œë¦¬ë“œ ê²€ìƒ‰** | í…ìŠ¤íŠ¸ + ë²¡í„° ê²°í•© | ìµœê³  ì •í™•ë„ |\n| **ì‹œë§¨í‹± ê²€ìƒ‰** | AI ê¸°ë°˜ ì¬ìˆœìœ„í™” | ìì—°ì–´ ì¿¼ë¦¬ ì´í•´ |\n\n### ë²¡í„° ì•Œê³ ë¦¬ì¦˜\n\n**HNSW (Hierarchical Navigable Small World)**\n- ê·¼ì‚¬ ìµœê·¼ì ‘ ì´ì›ƒ (Approximate Nearest Neighbor, ANN)\n- ë¹ ë¥¸ ê²€ìƒ‰ ì†ë„ (ms ë‹¨ìœ„)\n- ë†’ì€ ì •í™•ë„ (recall > 95%)\n\n## Azure AI Search ë¦¬ì†ŒìŠ¤ ìƒì„±\n\n### Azure Portalì—ì„œ ìƒì„±\n\n**1. Azure AI Search ë§Œë“¤ê¸°:**\n- [portal.azure.com](https://portal.azure.com) â†’ \"ë¦¬ì†ŒìŠ¤ ë§Œë“¤ê¸°\"\n- \"Azure AI Search\" ê²€ìƒ‰ ë° ì„ íƒ\n\n**2. ê¸°ë³¸ ì„¤ì •:**\n- **êµ¬ë…**: ì‚¬ìš©í•  êµ¬ë… ì„ íƒ\n- **ë¦¬ì†ŒìŠ¤ ê·¸ë£¹**: `rg-rag-prod`\n- **ì„œë¹„ìŠ¤ ì´ë¦„**: `search-rag-prod` (ì „ì—­ì ìœ¼ë¡œ ê³ ìœ í•´ì•¼ í•¨)\n- **ì§€ì—­**: Korea Central (ë˜ëŠ” East US)\n- **ê°€ê²© ì±…ì • ê³„ì¸µ**: \n  - Free: ë¬´ë£Œ (50MB, ì¸ë±ìŠ¤ 3ê°œ)\n  - Basic: $73.73/ì›” (2GB)\n  - Standard S1: $250.83/ì›” (25GB)\n\n**3. ê²€í†  + ë§Œë“¤ê¸°** â†’ ìƒì„± ì™„ë£Œ\n\n**4. í‚¤ ë° ì—”ë“œí¬ì¸íŠ¸ í™•ì¸:**\n- ìƒì„±ëœ ë¦¬ì†ŒìŠ¤ â†’ \"í‚¤\"\n- **ê´€ë¦¬ í‚¤ (Admin Key)** ë³µì‚¬\n- **URL** ë³µì‚¬ (ì˜ˆ: `https://search-rag-prod.search.windows.net`)\n\n### Azure CLIë¡œ ìƒì„±\n\n```bash\n# Azure AI Search ë¦¬ì†ŒìŠ¤ ìƒì„±\naz search service create \\\n    --name search-rag-prod \\\n    --resource-group rg-rag-prod \\\n    --sku basic \\\n    --location koreacentral\n\n# ê´€ë¦¬ í‚¤ ì¡°íšŒ\naz search admin-key show \\\n    --service-name search-rag-prod \\\n    --resource-group rg-rag-prod\n```\n\n## í™˜ê²½ ì„¤ì •\n\n### Python SDK ì„¤ì¹˜\n\n```bash\npip install azure-search-documents\npip install langchain-community\npip install azure-identity\n```\n\n### í™˜ê²½ ë³€ìˆ˜ ì„¤ì •\n\n`.env` íŒŒì¼:\n```\nAZURE_SEARCH_ENDPOINT=https://search-rag-prod.search.windows.net\nAZURE_SEARCH_API_KEY=your-admin-key-here\nAZURE_SEARCH_INDEX_NAME=rag-documents\n```\n\n## ê¸°ë³¸ ì‚¬ìš©ë²•\n\n### ì¸ë±ìŠ¤ ìƒì„±\n\n::: {#02fd512f .cell execution_count=1}\n``` {.python .cell-code}\nfrom azure.search.documents.indexes import SearchIndexClient\nfrom azure.search.documents.indexes.models import (\n    SearchIndex,\n    SearchField,\n    SearchFieldDataType,\n    VectorSearch,\n    HnswAlgorithmConfiguration,\n    VectorSearchProfile,\n    SemanticConfiguration,\n    SemanticField,\n    SemanticPrioritizedFields,\n    SemanticSearch\n)\nfrom azure.core.credentials import AzureKeyCredential\nfrom dotenv import load_dotenv\nimport os\n\nload_dotenv()\n\n# í´ë¼ì´ì–¸íŠ¸ ìƒì„±\nindex_client = SearchIndexClient(\n    endpoint=os.getenv(\"AZURE_SEARCH_ENDPOINT\"),\n    credential=AzureKeyCredential(os.getenv(\"AZURE_SEARCH_API_KEY\"))\n)\n\n# ì¸ë±ìŠ¤ ìŠ¤í‚¤ë§ˆ ì •ì˜\nfields = [\n    SearchField(\n        name=\"id\",\n        type=SearchFieldDataType.String,\n        key=True,  # ê¸°ë³¸ í‚¤\n        filterable=True\n    ),\n    SearchField(\n        name=\"content\",\n        type=SearchFieldDataType.String,\n        searchable=True,  # ì „ì²´ í…ìŠ¤íŠ¸ ê²€ìƒ‰ ê°€ëŠ¥\n        filterable=False\n    ),\n    SearchField(\n        name=\"content_vector\",\n        type=SearchFieldDataType.Collection(SearchFieldDataType.Single),\n        vector_search_dimensions=1536,  # text-embedding-3-small\n        vector_search_profile_name=\"vector-profile\"\n    ),\n    SearchField(\n        name=\"metadata\",\n        type=SearchFieldDataType.String,\n        searchable=False,\n        filterable=True\n    ),\n    SearchField(\n        name=\"source\",\n        type=SearchFieldDataType.String,\n        searchable=False,\n        filterable=True,\n        facetable=True\n    )\n]\n\n# ë²¡í„° ê²€ìƒ‰ ì„¤ì •\nvector_search = VectorSearch(\n    algorithms=[\n        HnswAlgorithmConfiguration(\n            name=\"hnsw-config\",\n            parameters={\n                \"m\": 4,  # ê·¸ë˜í”„ ì—°ê²° ìˆ˜\n                \"efConstruction\": 400,  # ì¸ë±ìŠ¤ êµ¬ì¶• í’ˆì§ˆ\n                \"efSearch\": 500,  # ê²€ìƒ‰ ì •í™•ë„\n                \"metric\": \"cosine\"  # ìœ ì‚¬ë„ ì¸¡ì • ë°©ì‹\n            }\n        )\n    ],\n    profiles=[\n        VectorSearchProfile(\n            name=\"vector-profile\",\n            algorithm_configuration_name=\"hnsw-config\"\n        )\n    ]\n)\n\n# ì‹œë§¨í‹± ê²€ìƒ‰ ì„¤ì • (ì„ íƒ ì‚¬í•­)\nsemantic_config = SemanticConfiguration(\n    name=\"semantic-config\",\n    prioritized_fields=SemanticPrioritizedFields(\n        title_field=None,\n        content_fields=[SemanticField(field_name=\"content\")]\n    )\n)\n\nsemantic_search = SemanticSearch(\n    configurations=[semantic_config]\n)\n\n# ì¸ë±ìŠ¤ ìƒì„±\nindex = SearchIndex(\n    name=os.getenv(\"AZURE_SEARCH_INDEX_NAME\"),\n    fields=fields,\n    vector_search=vector_search,\n    semantic_search=semantic_search\n)\n\n# ì¸ë±ìŠ¤ ì—…ë¡œë“œ\nresult = index_client.create_or_update_index(index)\nprint(f\"ì¸ë±ìŠ¤ ìƒì„± ì™„ë£Œ: {result.name}\")\n```\n:::\n\n\n### ë¬¸ì„œ ì—…ë¡œë“œ\n\n::: {#1506211b .cell execution_count=2}\n``` {.python .cell-code}\nfrom azure.search.documents import SearchClient\nfrom langchain_openai import AzureOpenAIEmbeddings\n\n# Embeddings í´ë¼ì´ì–¸íŠ¸\nembeddings = AzureOpenAIEmbeddings(\n    azure_deployment=os.getenv(\"AZURE_OPENAI_EMBEDDING_DEPLOYMENT\"),\n    openai_api_version=os.getenv(\"AZURE_OPENAI_API_VERSION\"),\n    azure_endpoint=os.getenv(\"AZURE_OPENAI_ENDPOINT\"),\n    api_key=os.getenv(\"AZURE_OPENAI_API_KEY\")\n)\n\n# Search í´ë¼ì´ì–¸íŠ¸\nsearch_client = SearchClient(\n    endpoint=os.getenv(\"AZURE_SEARCH_ENDPOINT\"),\n    index_name=os.getenv(\"AZURE_SEARCH_INDEX_NAME\"),\n    credential=AzureKeyCredential(os.getenv(\"AZURE_SEARCH_API_KEY\"))\n)\n\n# ë¬¸ì„œ ì¤€ë¹„\ndocuments = [\n    {\n        \"id\": \"1\",\n        \"content\": \"Azure AI SearchëŠ” Microsoftì˜ ê´€ë¦¬í˜• ê²€ìƒ‰ ì„œë¹„ìŠ¤ë‹¤.\",\n        \"source\": \"doc1.txt\",\n        \"metadata\": \"Azure\"\n    },\n    {\n        \"id\": \"2\",\n        \"content\": \"RAGëŠ” ê²€ìƒ‰ ì¦ê°• ìƒì„± ê¸°ìˆ ì´ë‹¤.\",\n        \"source\": \"doc2.txt\",\n        \"metadata\": \"RAG\"\n    },\n    {\n        \"id\": \"3\",\n        \"content\": \"ì„ë² ë”©ì€ í…ìŠ¤íŠ¸ë¥¼ ë²¡í„°ë¡œ ë³€í™˜í•œë‹¤.\",\n        \"source\": \"doc3.txt\",\n        \"metadata\": \"Embeddings\"\n    }\n]\n\n# ì„ë² ë”© ìƒì„± ë° ë¬¸ì„œ ì—…ë¡œë“œ\nfor doc in documents:\n    # ì„ë² ë”© ìƒì„±\n    doc[\"content_vector\"] = embeddings.embed_query(doc[\"content\"])\n\n# ë°°ì¹˜ ì—…ë¡œë“œ\nresult = search_client.upload_documents(documents=documents)\nprint(f\"ì—…ë¡œë“œ ì™„ë£Œ: {len(result)}ê°œ ë¬¸ì„œ\")\n\n# ê° ë¬¸ì„œ ê²°ê³¼ í™•ì¸\nfor item in result:\n    print(f\"ë¬¸ì„œ ID {item.key}: {item.succeeded}\")\n```\n:::\n\n\n## LangChain í†µí•©\n\n### AzureSearch VectorStore\n\n::: {#0af40db0 .cell execution_count=3}\n``` {.python .cell-code}\nfrom langchain_community.vectorstores.azuresearch import AzureSearch\n\n# Azure Search VectorStore ì´ˆê¸°í™”\nvector_store = AzureSearch(\n    azure_search_endpoint=os.getenv(\"AZURE_SEARCH_ENDPOINT\"),\n    azure_search_key=os.getenv(\"AZURE_SEARCH_API_KEY\"),\n    index_name=os.getenv(\"AZURE_SEARCH_INDEX_NAME\"),\n    embedding_function=embeddings.embed_query\n)\n\n# ë¬¸ì„œ ì¶”ê°€ (ìë™ ì„ë² ë”©)\nfrom langchain_core.documents import Document\n\ndocs = [\n    Document(\n        page_content=\"LangChainì€ LLM ì• í”Œë¦¬ì¼€ì´ì…˜ í”„ë ˆì„ì›Œí¬ë‹¤.\",\n        metadata={\"source\": \"langchain.txt\", \"category\": \"framework\"}\n    ),\n    Document(\n        page_content=\"Azure OpenAIëŠ” ì—”í„°í”„ë¼ì´ì¦ˆê¸‰ LLM ì„œë¹„ìŠ¤ë‹¤.\",\n        metadata={\"source\": \"azure_openai.txt\", \"category\": \"llm\"}\n    )\n]\n\n# ìë™ìœ¼ë¡œ ì„ë² ë”© ìƒì„± ë° ì—…ë¡œë“œ\nvector_store.add_documents(docs)\nprint(f\"{len(docs)}ê°œ ë¬¸ì„œ ì¶”ê°€ ì™„ë£Œ\")\n```\n:::\n\n\n### ë²¡í„° ê²€ìƒ‰\n\n::: {#87dced8b .cell execution_count=4}\n``` {.python .cell-code}\n# ìœ ì‚¬ë„ ê²€ìƒ‰\nquery = \"LLM í”„ë ˆì„ì›Œí¬ëŠ” ë¬´ì—‡ì¸ê°€?\"\nresults = vector_store.similarity_search(query, k=3)\n\nprint(f\"ê²€ìƒ‰ ê²°ê³¼ ({len(results)}ê°œ):\\n\")\nfor i, doc in enumerate(results, 1):\n    print(f\"{i}. {doc.page_content}\")\n    print(f\"   ë©”íƒ€ë°ì´í„°: {doc.metadata}\\n\")\n```\n:::\n\n\n### ìœ ì‚¬ë„ ì ìˆ˜ì™€ í•¨ê»˜ ê²€ìƒ‰\n\n::: {#8a9700ac .cell execution_count=5}\n``` {.python .cell-code}\n# ìœ ì‚¬ë„ ì ìˆ˜ í¬í•¨ ê²€ìƒ‰\nresults_with_scores = vector_store.similarity_search_with_relevance_scores(\n    query=\"Azure ê²€ìƒ‰ ì„œë¹„ìŠ¤\",\n    k=3\n)\n\nprint(\"ìœ ì‚¬ë„ ì ìˆ˜:\\n\")\nfor doc, score in results_with_scores:\n    print(f\"ì ìˆ˜: {score:.4f}\")\n    print(f\"ë‚´ìš©: {doc.page_content}\")\n    print(f\"ì¶œì²˜: {doc.metadata.get('source', 'N/A')}\\n\")\n```\n:::\n\n\n## í•˜ì´ë¸Œë¦¬ë“œ ê²€ìƒ‰\n\në²¡í„° ê²€ìƒ‰ + í‚¤ì›Œë“œ ê²€ìƒ‰ì„ ê²°í•©í•œë‹¤.\n\n### í•˜ì´ë¸Œë¦¬ë“œ ê²€ìƒ‰ êµ¬í˜„\n\n::: {#940c6b0a .cell execution_count=6}\n``` {.python .cell-code}\nfrom azure.search.documents.models import VectorizedQuery\n\n# ê²€ìƒ‰ í´ë¼ì´ì–¸íŠ¸\nsearch_client = SearchClient(\n    endpoint=os.getenv(\"AZURE_SEARCH_ENDPOINT\"),\n    index_name=os.getenv(\"AZURE_SEARCH_INDEX_NAME\"),\n    credential=AzureKeyCredential(os.getenv(\"AZURE_SEARCH_API_KEY\"))\n)\n\n# ì¿¼ë¦¬\nquery_text = \"Azure ê²€ìƒ‰ ì„œë¹„ìŠ¤\"\nquery_vector = embeddings.embed_query(query_text)\n\n# ë²¡í„° ì¿¼ë¦¬ ì •ì˜\nvector_query = VectorizedQuery(\n    vector=query_vector,\n    k_nearest_neighbors=50,  # ë²¡í„° ê²€ìƒ‰ ê²°ê³¼ ìˆ˜\n    fields=\"content_vector\"\n)\n\n# í•˜ì´ë¸Œë¦¬ë“œ ê²€ìƒ‰ ì‹¤í–‰\nresults = search_client.search(\n    search_text=query_text,  # í‚¤ì›Œë“œ ê²€ìƒ‰\n    vector_queries=[vector_query],  # ë²¡í„° ê²€ìƒ‰\n    select=[\"id\", \"content\", \"source\", \"metadata\"],\n    top=5\n)\n\nprint(\"í•˜ì´ë¸Œë¦¬ë“œ ê²€ìƒ‰ ê²°ê³¼:\\n\")\nfor result in results:\n    print(f\"ID: {result['id']}\")\n    print(f\"ì ìˆ˜: {result['@search.score']:.4f}\")\n    print(f\"ë‚´ìš©: {result['content']}\")\n    print(f\"ì¶œì²˜: {result['source']}\\n\")\n```\n:::\n\n\n### ì‹œë§¨í‹± ê²€ìƒ‰ (ê³ ê¸‰)\n\nAzure AI Searchì˜ AI ê¸°ë°˜ ì¬ìˆœìœ„í™” ê¸°ëŠ¥ì´ë‹¤.\n\n::: {#fccfe016 .cell execution_count=7}\n``` {.python .cell-code}\nfrom azure.search.documents.models import QueryType, QueryCaptionType, QueryAnswerType\n\n# ì‹œë§¨í‹± ê²€ìƒ‰\nresults = search_client.search(\n    search_text=\"Azureì—ì„œ ì œê³µí•˜ëŠ” ê²€ìƒ‰ ì„œë¹„ìŠ¤ëŠ” ë¬´ì—‡ì¸ê°€?\",\n    vector_queries=[vector_query],\n    query_type=QueryType.SEMANTIC,  # ì‹œë§¨í‹± ê²€ìƒ‰ í™œì„±í™”\n    semantic_configuration_name=\"semantic-config\",\n    query_caption=QueryCaptionType.EXTRACTIVE,\n    query_answer=QueryAnswerType.EXTRACTIVE,\n    top=3\n)\n\nprint(\"ì‹œë§¨í‹± ê²€ìƒ‰ ê²°ê³¼:\\n\")\nfor result in results:\n    print(f\"ë‚´ìš©: {result['content']}\")\n    \n    # ìº¡ì…˜ (ê´€ë ¨ ë¶€ë¶„ í•˜ì´ë¼ì´íŠ¸)\n    if '@search.captions' in result:\n        captions = result['@search.captions']\n        if captions:\n            print(f\"ìº¡ì…˜: {captions[0].text}\")\n    \n    print(f\"ì ìˆ˜: {result['@search.score']:.4f}\\n\")\n```\n:::\n\n\n## í•„í„°ë§\n\në©”íƒ€ë°ì´í„° ê¸°ë°˜ í•„í„°ë§ìœ¼ë¡œ ê²€ìƒ‰ ë²”ìœ„ë¥¼ ì œí•œí•œë‹¤.\n\n::: {#1f1cea7c .cell execution_count=8}\n``` {.python .cell-code}\n# ë©”íƒ€ë°ì´í„° í•„í„°ë§\nresults = vector_store.similarity_search(\n    query=\"Azure ì„œë¹„ìŠ¤\",\n    k=5,\n    filters=\"metadata eq 'Azure'\"  # OData í•„í„° êµ¬ë¬¸\n)\n\nprint(f\"í•„í„°ë§ëœ ê²°ê³¼ ({len(results)}ê°œ):\")\nfor doc in results:\n    print(f\"- {doc.page_content}\")\n    print(f\"  ë©”íƒ€ë°ì´í„°: {doc.metadata}\\n\")\n```\n:::\n\n\n### ë³µí•© í•„í„°\n\n::: {#2462959b .cell execution_count=9}\n``` {.python .cell-code}\n# AND/OR ì¡°ê±´\nfilter_expression = \"metadata eq 'Azure' and source eq 'doc1.txt'\"\n\nresults = search_client.search(\n    search_text=\"ê²€ìƒ‰\",\n    filter=filter_expression,\n    top=5\n)\n\nfor result in results:\n    print(f\"- {result['content']}\")\n```\n:::\n\n\n## Retrieverë¡œ í™œìš©\n\n### VectorStoreRetriever\n\n::: {#54fe1ade .cell execution_count=10}\n``` {.python .cell-code}\nfrom langchain_core.runnables import RunnablePassthrough\nfrom langchain_core.output_parsers import StrOutputParser\nfrom langchain_openai import AzureChatOpenAI\nfrom langchain_core.prompts import ChatPromptTemplate\n\n# Retriever ìƒì„±\nretriever = vector_store.as_retriever(\n    search_type=\"similarity\",\n    search_kwargs={\"k\": 3}\n)\n\n# LLM\nllm = AzureChatOpenAI(\n    azure_deployment=os.getenv(\"AZURE_OPENAI_DEPLOYMENT\"),\n    openai_api_version=os.getenv(\"AZURE_OPENAI_API_VERSION\"),\n    azure_endpoint=os.getenv(\"AZURE_OPENAI_ENDPOINT\"),\n    api_key=os.getenv(\"AZURE_OPENAI_API_KEY\"),\n    temperature=0\n)\n\n# í”„ë¡¬í”„íŠ¸\nprompt = ChatPromptTemplate.from_template(\n    \"\"\"ë‹¤ìŒ ì»¨í…ìŠ¤íŠ¸ë¥¼ ì°¸ê³ í•˜ì—¬ ì§ˆë¬¸ì— ë‹µë³€í•˜ì„¸ìš”.\n\nì»¨í…ìŠ¤íŠ¸:\n{context}\n\nì§ˆë¬¸: {question}\n\në‹µë³€:\"\"\"\n)\n\n# RAG ì²´ì¸\ndef format_docs(docs):\n    return \"\\n\\n\".join([doc.page_content for doc in docs])\n\nrag_chain = (\n    {\"context\": retriever | format_docs, \"question\": RunnablePassthrough()}\n    | prompt\n    | llm\n    | StrOutputParser()\n)\n\n# ì‹¤í–‰\nanswer = rag_chain.invoke(\"Azure AI SearchëŠ” ë¬´ì—‡ì¸ê°€?\")\nprint(f\"ë‹µë³€: {answer}\")\n```\n:::\n\n\n## ëŒ€ëŸ‰ ë¬¸ì„œ ì—…ë¡œë“œ\n\n### ë°°ì¹˜ ì—…ë¡œë“œ\n\n::: {#14cc979f .cell execution_count=11}\n``` {.python .cell-code}\ndef upload_documents_batch(documents, batch_size=1000):\n    \"\"\"ë°°ì¹˜ ë‹¨ìœ„ë¡œ ëŒ€ëŸ‰ ë¬¸ì„œ ì—…ë¡œë“œ\"\"\"\n    total_uploaded = 0\n    \n    for i in range(0, len(documents), batch_size):\n        batch = documents[i:i+batch_size]\n        \n        # ì„ë² ë”© ìƒì„±\n        for doc in batch:\n            if \"content_vector\" not in doc:\n                doc[\"content_vector\"] = embeddings.embed_query(doc[\"content\"])\n        \n        # ì—…ë¡œë“œ\n        result = search_client.upload_documents(documents=batch)\n        \n        uploaded = sum(1 for item in result if item.succeeded)\n        total_uploaded += uploaded\n        \n        print(f\"ë°°ì¹˜ {i//batch_size + 1}: {uploaded}/{len(batch)} ì—…ë¡œë“œ\")\n    \n    return total_uploaded\n\n# ì‚¬ìš© ì˜ˆì‹œ\n# large_docs = [{\"id\": str(i), \"content\": f\"ë¬¸ì„œ {i}\"} for i in range(5000)]\n# total = upload_documents_batch(large_docs, batch_size=1000)\n# print(f\"ì´ {total}ê°œ ë¬¸ì„œ ì—…ë¡œë“œ ì™„ë£Œ\")\n```\n:::\n\n\n## ì¸ë±ìŠ¤ ê´€ë¦¬\n\n### ì¸ë±ìŠ¤ ì‚­ì œ\n\n::: {#58608f76 .cell execution_count=12}\n``` {.python .cell-code}\n# ì¸ë±ìŠ¤ ì‚­ì œ\nindex_client.delete_index(os.getenv(\"AZURE_SEARCH_INDEX_NAME\"))\nprint(\"ì¸ë±ìŠ¤ ì‚­ì œ ì™„ë£Œ\")\n```\n:::\n\n\n### ì¸ë±ìŠ¤ ëª©ë¡ ì¡°íšŒ\n\n::: {#c23ee2d0 .cell execution_count=13}\n``` {.python .cell-code}\n# ëª¨ë“  ì¸ë±ìŠ¤ ì¡°íšŒ\nindexes = index_client.list_indexes()\n\nprint(\"ì¸ë±ìŠ¤ ëª©ë¡:\")\nfor index in indexes:\n    print(f\"- {index.name}\")\n```\n:::\n\n\n### ë¬¸ì„œ ì‚­ì œ\n\n::: {#3c081e63 .cell execution_count=14}\n``` {.python .cell-code}\n# íŠ¹ì • ë¬¸ì„œ ì‚­ì œ\nsearch_client.delete_documents(documents=[{\"id\": \"1\"}, {\"id\": \"2\"}])\nprint(\"ë¬¸ì„œ ì‚­ì œ ì™„ë£Œ\")\n```\n:::\n\n\n## ëª¨ë‹ˆí„°ë§\n\n### ì¸ë±ìŠ¤ í†µê³„\n\n::: {#20315038 .cell execution_count=15}\n``` {.python .cell-code}\n# ì¸ë±ìŠ¤ í†µê³„ ì¡°íšŒ\nstats = search_client.get_document_count()\nprint(f\"ì´ ë¬¸ì„œ ìˆ˜: {stats}\")\n```\n:::\n\n\n### ê²€ìƒ‰ ì¿¼ë¦¬ ì„±ëŠ¥\n\n::: {#f6f6b079 .cell execution_count=16}\n``` {.python .cell-code}\nimport time\n\n# ê²€ìƒ‰ ì„±ëŠ¥ ì¸¡ì •\nstart_time = time.time()\n\nresults = vector_store.similarity_search(\"í…ŒìŠ¤íŠ¸ ì¿¼ë¦¬\", k=10)\n\nduration = time.time() - start_time\nprint(f\"ê²€ìƒ‰ ì‹œê°„: {duration:.3f}ì´ˆ\")\nprint(f\"ê²€ìƒ‰ ê²°ê³¼: {len(results)}ê°œ\")\n```\n:::\n\n\n## ë¬¸ì œ í•´ê²°\n\n### ì¼ë°˜ì ì¸ ì˜¤ë¥˜\n\n**1. ì¸ë±ìŠ¤ê°€ ì¡´ì¬í•˜ì§€ ì•ŠìŒ**\n```python\n# í•´ê²°: ì¸ë±ìŠ¤ ì¡´ì¬ í™•ì¸\ntry:\n    index = index_client.get_index(os.getenv(\"AZURE_SEARCH_INDEX_NAME\"))\n    print(f\"ì¸ë±ìŠ¤ ì¡´ì¬: {index.name}\")\nexcept Exception as e:\n    print(f\"ì¸ë±ìŠ¤ ì—†ìŒ: {e}\")\n    # ì¸ë±ìŠ¤ ìƒì„±\n```\n\n**2. ë²¡í„° ì°¨ì› ë¶ˆì¼ì¹˜**\n```python\n# í•´ê²°: ì„ë² ë”© ëª¨ë¸ ì°¨ì› í™•ì¸\ntest_vector = embeddings.embed_query(\"í…ŒìŠ¤íŠ¸\")\nprint(f\"ì„ë² ë”© ì°¨ì›: {len(test_vector)}\")\n\n# ì¸ë±ìŠ¤ ìŠ¤í‚¤ë§ˆì˜ vector_search_dimensionsì™€ ì¼ì¹˜í•´ì•¼ í•¨\n```\n\n**3. ì—…ë¡œë“œ ì‹¤íŒ¨**\n```python\n# í•´ê²°: ì˜¤ë¥˜ í™•ì¸\nresult = search_client.upload_documents(documents=docs)\nfor item in result:\n    if not item.succeeded:\n        print(f\"ì‹¤íŒ¨: {item.key} - {item.error_message}\")\n```\n\n## ë¹„ìš© ìµœì í™”\n\n### ì¸ë±ìŠ¤ í¬ê¸° ì¤„ì´ê¸°\n\n```python\n# ë¶ˆí•„ìš”í•œ í•„ë“œ ì œê±°\n# searchable=Falseë¡œ ì„¤ì •í•˜ì—¬ ì „ì²´ í…ìŠ¤íŠ¸ ì¸ë±ìŠ¤ ë¹„í™œì„±í™”\nSearchField(\n    name=\"metadata\",\n    type=SearchFieldDataType.String,\n    searchable=False,  # ì €ì¥ë§Œ í•¨\n    filterable=True\n)\n```\n\n### ë²¡í„° ì°¨ì› ì¶•ì†Œ\n\n```python\n# text-embedding-3-small: 1536 â†’ 512\nfrom openai import AzureOpenAI\n\nclient = AzureOpenAI(...)\n\nresponse = client.embeddings.create(\n    input=\"í…ìŠ¤íŠ¸\",\n    model=\"text-embedding-3-small\",\n    dimensions=512  # 1/3 í¬ê¸°\n)\n```\n\n## ì°¸ê³  ìë£Œ\n\n### ê³µì‹ ë¬¸ì„œ\n- [Azure AI Search ê°œìš”](https://learn.microsoft.com/en-us/azure/search/search-what-is-azure-search)\n- [ë²¡í„° ê²€ìƒ‰](https://learn.microsoft.com/en-us/azure/search/vector-search-overview)\n- [í•˜ì´ë¸Œë¦¬ë“œ ê²€ìƒ‰](https://learn.microsoft.com/en-us/azure/search/hybrid-search-overview)\n- [Python SDK](https://learn.microsoft.com/en-us/python/api/overview/azure/search-documents-readme)\n\n### LangChain\n- [AzureSearch VectorStore](https://python.langchain.com/docs/integrations/vectorstores/azuresearch)\n\n## ë‹¤ìŒ ë‹¨ê³„\n\në²¡í„° ìŠ¤í† ì–´ êµ¬ì¶•ì´ ì™„ë£Œë˜ì—ˆë‹¤ë©´, ì´ì œ RAG ë¡œì§ì„ êµ¬í˜„í•˜ì:\n\nğŸ‘‰ [05-LangChain-to-LangGraph.qmd](./05-LangChain-to-LangGraph.qmd) - LangChainì—ì„œ LangGraphë¡œ ì „í™˜\n\n",
    "supporting": [
      "04-Azure-AI-Search-Integration_files"
    ],
    "filters": [],
    "includes": {}
  }
}