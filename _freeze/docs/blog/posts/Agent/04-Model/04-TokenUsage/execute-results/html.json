{
  "hash": "01a0351e8d8ed4d95444d009c95fdabb",
  "result": {
    "engine": "jupyter",
    "markdown": "---\ntitle: \"Token Usage Tracking\"\nsubtitle: LLM 토큰 사용량 추적 및 관리\ndescription: |\n  LangChain에서 LLM 호출 시 토큰 사용량을 추적하고 관리하는 방법을 다룬다.\n  비용 관리와 성능 최적화를 위한 토큰 사용량 모니터링 기법을 설명한다.\ncategories:\n  - AI\n  - RAG\n  - LangChain\nauthor: Kwangmin Kim\ndate: 02/04/2025\nformat: \n  html:\n    page-layout: full\n    code-fold: true\n    toc: true\n    number-sections: true\ndraft: False\nexecute:\n    eval: false\n---\n\n::: {#98c48621 .cell execution_count=1}\n``` {.python .cell-code}\n# API KEY를 환경변수로 관리하기 위한 설정 파일\nfrom dotenv import load_dotenv\n\n# API KEY 정보로드\nload_dotenv()\n```\n:::\n\n\n::: {#17c9ec27 .cell execution_count=2}\n``` {.python .cell-code}\n# LangSmith 추적을 설정합니다. https://smith.langchain.com\n# !pip install langchain-teddynote\nfrom langchain_teddynote import logging\n\n# 프로젝트 이름을 입력합니다.\nlogging.langsmith(\"CH04-Models\")\n```\n:::\n\n\n특정 호출에 대한 토큰 사용량을 추적하는 방법에 대해 설명합니다.\n\n이 기능은 현재 OpenAI API 에만 구현되어 있습니다.\n\n먼저 단일 Chat 모델 호출에 대한 토큰 사용량을 추적하는 매우 간단한 예를 살펴보겠습니다.\n\n::: {#190a1e1b .cell execution_count=3}\n``` {.python .cell-code}\nfrom langchain.callbacks import get_openai_callback\nfrom langchain_openai import ChatOpenAI\n\n# 모델을 불러옵니다.\nllm = ChatOpenAI(model_name=\"gpt-4.1-mini\")\n```\n:::\n\n\n`with get_openai_callback()` 구문안에서 실행되는 모든 토큰 사용량/요금이 추적됩니다.\n\n::: {#d6330b56 .cell execution_count=4}\n``` {.python .cell-code}\n# callback을 사용하여 추적합니다.\nwith get_openai_callback() as cb:\n    result = llm.invoke(\"대한민국의 수도는 어디야?\")\n    print(cb)\n```\n:::\n\n\n::: {#10912e60 .cell execution_count=5}\n``` {.python .cell-code}\n# callback을 사용하여 추적합니다.\nwith get_openai_callback() as cb:\n    result = llm.invoke(\"대한민국의 수도는 어디야?\")\n    result = llm.invoke(\"대한민국의 수도는 어디야?\")\n    print(f\"총 사용된 토큰수: \\t\\t{cb.total_tokens}\")\n    print(f\"프롬프트에 사용된 토큰수: \\t{cb.prompt_tokens}\")\n    print(f\"답변에 사용된 토큰수: \\t{cb.completion_tokens}\")\n    print(f\"호출에 청구된 금액(USD): \\t${cb.total_cost}\")\n```\n:::\n\n\n",
    "supporting": [
      "04-TokenUsage_files"
    ],
    "filters": [],
    "includes": {}
  }
}