{
  "hash": "56c93b75010d8fa18368df0691cbc06f",
  "result": {
    "engine": "jupyter",
    "markdown": "---\ntitle: \"Azure Blob Storage\"\nsubtitle: ë¹„ì •í˜• ë¬¸ì„œ ì €ì¥ì†Œ\ndescription: |\n  Azure Blob Storageë¥¼ í™œìš©í•œ RAG ë¬¸ì„œ ì €ì¥ ë° ê´€ë¦¬ ë°©ë²•ì„ ë‹¤ë£¬ë‹¤.\ncategories:\n  - AI\n  - RAG\n  - Azure\n  - Cloud\nauthor: Kwangmin Kim\ndate: 11/02/2025\nformat: \n  html:\n    page-layout: full\n    code-fold: true\n    toc: true\n    number-sections: true\ndraft: False\nexecute:\n    eval: false\n---\n\n## Azure Blob Storageë€?\n\nAzure Blob StorageëŠ” Microsoft Azureì—ì„œ ì œê³µí•˜ëŠ” ê°ì²´ ìŠ¤í† ë¦¬ì§€ ì„œë¹„ìŠ¤ë¡œ, RAG ì‹œìŠ¤í…œì˜ ë¬¸ì„œ ì €ì¥ì†Œë¡œ ì‚¬ìš©ëœë‹¤. ë¹„ì •í˜• ë°ì´í„°(PDF, Word, ì´ë¯¸ì§€ ë“±)ë¥¼ ëŒ€ìš©ëŸ‰ìœ¼ë¡œ ì €ì¥í•˜ê³  ê´€ë¦¬í•  ìˆ˜ ìˆëŠ” í™•ì¥ ê°€ëŠ¥í•œ í´ë¼ìš°ë“œ ìŠ¤í† ë¦¬ì§€ë‹¤.\n\n**RAG íŒŒì´í”„ë¼ì¸ì—ì„œì˜ ì—­í• :**\n- ì›ë³¸ ë¬¸ì„œ ì €ì¥ (PDF, DOCX, PPTX, ì´ë¯¸ì§€ ë“±)\n- ì „ì²˜ë¦¬ëœ í…ìŠ¤íŠ¸ ì €ì¥\n- ë©”íƒ€ë°ì´í„° ë° ì¸ë±ìŠ¤ ë°±ì—…\n- ëŒ€ìš©ëŸ‰ ë°ì´í„°ì…‹ ê´€ë¦¬\n\n**ì£¼ìš” íŠ¹ì§•:**\n- **í™•ì¥ì„±**: EB(Exabyte) ê·œëª¨ê¹Œì§€ ìë™ í™•ì¥\n- **ë‚´êµ¬ì„±**: 99.999999999% (11 nine's) ë°ì´í„° ë‚´êµ¬ì„±\n- **ë¹„ìš© íš¨ìœ¨ì„±**: ê³„ì¸µí˜• ìŠ¤í† ë¦¬ì§€ë¡œ ë¹„ìš© ìµœì í™”\n- **ë³´ì•ˆ**: ì•”í˜¸í™”, RBAC, Private Endpoint ì§€ì›\n\n## Blob Storage ê³„ì¸µ\n\nAzure Blob StorageëŠ” ë°ì´í„° ì•¡ì„¸ìŠ¤ íŒ¨í„´ì— ë”°ë¼ 3ê°€ì§€ ê³„ì¸µì„ ì œê³µí•œë‹¤:\n\n| ê³„ì¸µ | ìš©ë„ | ê°€ê²© (GB/ì›”) | ì½ê¸° ë¹„ìš© | ì í•©í•œ ì‹œë‚˜ë¦¬ì˜¤ |\n|------|------|-------------|-----------|----------------|\n| **Hot** | ìì£¼ ì•¡ì„¸ìŠ¤ | $0.0184 | ë‚®ìŒ | RAG ìš´ì˜ ë¬¸ì„œ, í™œì„± ë°ì´í„°ì…‹ |\n| **Cool** | ê°€ë” ì•¡ì„¸ìŠ¤ | $0.01 | ì¤‘ê°„ | ì•„ì¹´ì´ë¸Œ ë¬¸ì„œ, ë°±ì—… |\n| **Archive** | ê±°ì˜ ì—†ìŒ | $0.002 | ë†’ìŒ | ì¥ê¸° ë³´ê´€, ê·œì • ì¤€ìˆ˜ ë°ì´í„° |\n\n**RAG ì‹œìŠ¤í…œ ê¶Œì¥ ì‚¬í•­:**\n- **Hot ê³„ì¸µ**: í˜„ì¬ RAGì—ì„œ ì‚¬ìš© ì¤‘ì¸ ë¬¸ì„œ\n- **Cool ê³„ì¸µ**: 3ê°œì›” ì´ìƒ ë¯¸ì‚¬ìš© ë¬¸ì„œ\n- **Archive ê³„ì¸µ**: ë²•ì  ë³´ê´€ ì˜ë¬´ë§Œ ìˆëŠ” ë¬¸ì„œ\n\n## Storage Account ìƒì„±\n\n### Azure Portalì—ì„œ ìƒì„±\n\n**1. Azure Portal ì ‘ì†:**\n- [portal.azure.com](https://portal.azure.com) â†’ \"ë¦¬ì†ŒìŠ¤ ë§Œë“¤ê¸°\"\n- \"Storage Account\" ê²€ìƒ‰ ë° ì„ íƒ\n\n**2. ê¸°ë³¸ ì„¤ì •:**\n- **êµ¬ë…**: ì‚¬ìš©í•  êµ¬ë… ì„ íƒ\n- **ë¦¬ì†ŒìŠ¤ ê·¸ë£¹**: ìƒˆë¡œ ë§Œë“¤ê¸° ë˜ëŠ” ê¸°ì¡´ ì„ íƒ (ì˜ˆ: `rg-rag-prod`)\n- **Storage Account ì´ë¦„**: ì „ì—­ì ìœ¼ë¡œ ê³ ìœ í•œ ì´ë¦„ (ì˜ˆ: `stragdocs2025`)\n- **ì§€ì—­**: Korea Central ë˜ëŠ” Korea South\n- **ì„±ëŠ¥**: Standard (ëŒ€ë¶€ë¶„ì˜ ê²½ìš° ì¶©ë¶„)\n- **ì¤‘ë³µì„±**: \n  - LRS (Locally Redundant Storage): ë‹¨ì¼ ë°ì´í„°ì„¼í„° ë‚´ 3ê°œ ë³µì œ\n  - GRS (Geo-Redundant Storage): ë‹¤ë¥¸ ë¦¬ì „ì— ìë™ ë³µì œ (ê¶Œì¥)\n\n**3. ê³ ê¸‰ ì„¤ì •:**\n- **ë³´ì•ˆ**: \n  - Require secure transfer (HTTPS ê°•ì œ)\n  - Enable blob public access (ë‚˜ì¤‘ì— ì œì–´ ê°€ëŠ¥)\n- **Data Lake Storage Gen2**: RAGì—ì„œëŠ” ë¶ˆí•„ìš”\n- **Blob soft delete**: 7ì¼ (ì‹¤ìˆ˜ë¡œ ì‚­ì œ ë°©ì§€)\n\n**4. ë„¤íŠ¸ì›Œí‚¹:**\n- **ì—°ê²° ë°©ë²•**: \n  - Public endpoint (ê°œë°œ): ëª¨ë“  ë„¤íŠ¸ì›Œí¬ì—ì„œ ì•¡ì„¸ìŠ¤\n  - Private endpoint (í”„ë¡œë•ì…˜): VNet ë‚´ì—ì„œë§Œ ì•¡ì„¸ìŠ¤\n\n**5. ê²€í†  + ë§Œë“¤ê¸°** â†’ ìƒì„± ì™„ë£Œ (ì•½ 1ë¶„ ì†Œìš”)\n\n### Azure CLIë¡œ ìƒì„±\n\n```bash\n# Azure CLI ë¡œê·¸ì¸\naz login\n\n# ë¦¬ì†ŒìŠ¤ ê·¸ë£¹ ìƒì„±\naz group create \\\n    --name rg-rag-prod \\\n    --location koreacentral\n\n# Storage Account ìƒì„±\naz storage account create \\\n    --name stragdocs2025 \\\n    --resource-group rg-rag-prod \\\n    --location koreacentral \\\n    --sku Standard_GRS \\\n    --kind StorageV2 \\\n    --https-only true \\\n    --allow-blob-public-access false\n\n# ìƒì„± í™•ì¸\naz storage account show \\\n    --name stragdocs2025 \\\n    --resource-group rg-rag-prod \\\n    --query \"[name, location, sku.name]\"\n```\n\n## ì»¨í…Œì´ë„ˆ ìƒì„±\n\nBlob Storageì—ì„œ **ì»¨í…Œì´ë„ˆ**ëŠ” íŒŒì¼ ì‹œìŠ¤í…œì˜ í´ë”ì™€ ìœ ì‚¬í•œ ê°œë…ì´ë‹¤.\n\n### Azure Portalì—ì„œ ìƒì„±\n\n1. Storage Account â†’ \"ì»¨í…Œì´ë„ˆ\" ë©”ë‰´\n2. \"+ ì»¨í…Œì´ë„ˆ\" í´ë¦­\n3. ì„¤ì •:\n   - **ì´ë¦„**: `rag-documents` (ì†Œë¬¸ì, í•˜ì´í”ˆë§Œ í—ˆìš©)\n   - **Public access level**: Private (ê¶Œì¥)\n4. \"ë§Œë“¤ê¸°\" í´ë¦­\n\n### Python SDKë¡œ ìƒì„±\n\n::: {#1dd70648 .cell execution_count=1}\n``` {.python .cell-code}\nfrom azure.storage.blob import BlobServiceClient\nfrom dotenv import load_dotenv\nimport os\n\nload_dotenv()\n\n# í™˜ê²½ ë³€ìˆ˜ì—ì„œ ì—°ê²° ë¬¸ìì—´ ê°€ì ¸ì˜¤ê¸°\nconnection_string = os.getenv(\"AZURE_STORAGE_CONNECTION_STRING\")\n\n# BlobServiceClient ìƒì„±\nblob_service_client = BlobServiceClient.from_connection_string(connection_string)\n\n# ì»¨í…Œì´ë„ˆ ìƒì„±\ncontainer_name = \"rag-documents\"\ncontainer_client = blob_service_client.create_container(container_name)\n\nprint(f\"ì»¨í…Œì´ë„ˆ '{container_name}' ìƒì„± ì™„ë£Œ\")\n```\n:::\n\n\n**í™˜ê²½ ë³€ìˆ˜ ì„¤ì •** (`.env` íŒŒì¼):\n```\nAZURE_STORAGE_CONNECTION_STRING=DefaultEndpointsProtocol=https;AccountName=stragdocs2025;AccountKey=xxx;EndpointSuffix=core.windows.net\n```\n\n## ë¬¸ì„œ ì—…ë¡œë“œ\n\n### ë‹¨ì¼ íŒŒì¼ ì—…ë¡œë“œ\n\n::: {#78b1e004 .cell execution_count=2}\n``` {.python .cell-code}\nfrom azure.storage.blob import BlobClient\n\n# Blob í´ë¼ì´ì–¸íŠ¸ ìƒì„±\nblob_client = blob_service_client.get_blob_client(\n    container=\"rag-documents\",\n    blob=\"sample.pdf\"\n)\n\n# íŒŒì¼ ì—…ë¡œë“œ\nwith open(\"sample.pdf\", \"rb\") as data:\n    blob_client.upload_blob(data, overwrite=True)\n    \nprint(\"íŒŒì¼ ì—…ë¡œë“œ ì™„ë£Œ\")\n```\n:::\n\n\n### ì—¬ëŸ¬ íŒŒì¼ ì¼ê´„ ì—…ë¡œë“œ\n\n::: {#ae8c9030 .cell execution_count=3}\n``` {.python .cell-code}\nimport os\nfrom pathlib import Path\n\ndef upload_directory(container_name, local_directory):\n    \"\"\"ë””ë ‰í† ë¦¬ ë‚´ ëª¨ë“  íŒŒì¼ì„ Blob Storageì— ì—…ë¡œë“œ\"\"\"\n    container_client = blob_service_client.get_container_client(container_name)\n    \n    # ë¡œì»¬ ë””ë ‰í† ë¦¬ì˜ ëª¨ë“  íŒŒì¼ íƒìƒ‰\n    for root, dirs, files in os.walk(local_directory):\n        for file in files:\n            file_path = os.path.join(root, file)\n            \n            # Blob ì´ë¦„ ìƒì„± (ë””ë ‰í† ë¦¬ êµ¬ì¡° ìœ ì§€)\n            blob_name = os.path.relpath(file_path, local_directory).replace(\"\\\\\", \"/\")\n            \n            # íŒŒì¼ ì—…ë¡œë“œ\n            with open(file_path, \"rb\") as data:\n                blob_client = container_client.get_blob_client(blob_name)\n                blob_client.upload_blob(data, overwrite=True)\n                print(f\"ì—…ë¡œë“œ: {blob_name}\")\n\n# ì‚¬ìš© ì˜ˆì‹œ\nupload_directory(\"rag-documents\", \"./documents\")\n```\n:::\n\n\n### ë©”íƒ€ë°ì´í„°ì™€ í•¨ê»˜ ì—…ë¡œë“œ\n\n::: {#dc9fc8bc .cell execution_count=4}\n``` {.python .cell-code}\nfrom datetime import datetime\n\n# ë©”íƒ€ë°ì´í„° ì •ì˜\nmetadata = {\n    \"author\": \"Kwangmin Kim\",\n    \"category\": \"AI\",\n    \"upload_date\": datetime.now().isoformat(),\n    \"version\": \"1.0\"\n}\n\n# ë©”íƒ€ë°ì´í„°ì™€ í•¨ê»˜ ì—…ë¡œë“œ\nwith open(\"report.pdf\", \"rb\") as data:\n    blob_client = blob_service_client.get_blob_client(\n        container=\"rag-documents\",\n        blob=\"report.pdf\"\n    )\n    blob_client.upload_blob(\n        data,\n        metadata=metadata,\n        overwrite=True\n    )\n\nprint(\"ë©”íƒ€ë°ì´í„°ì™€ í•¨ê»˜ ì—…ë¡œë“œ ì™„ë£Œ\")\n```\n:::\n\n\n## ë¬¸ì„œ ë‹¤ìš´ë¡œë“œ\n\n### ë‹¨ì¼ íŒŒì¼ ë‹¤ìš´ë¡œë“œ\n\n::: {#4b39552a .cell execution_count=5}\n``` {.python .cell-code}\n# Blob ë‹¤ìš´ë¡œë“œ\nblob_client = blob_service_client.get_blob_client(\n    container=\"rag-documents\",\n    blob=\"sample.pdf\"\n)\n\n# ë¡œì»¬ì— ì €ì¥\nwith open(\"downloaded_sample.pdf\", \"wb\") as download_file:\n    download_file.write(blob_client.download_blob().readall())\n\nprint(\"íŒŒì¼ ë‹¤ìš´ë¡œë“œ ì™„ë£Œ\")\n```\n:::\n\n\n### ìŠ¤íŠ¸ë¦¬ë° ë‹¤ìš´ë¡œë“œ (ëŒ€ìš©ëŸ‰ íŒŒì¼)\n\n::: {#5868fe98 .cell execution_count=6}\n``` {.python .cell-code}\n# ìŠ¤íŠ¸ë¦¬ë°ìœ¼ë¡œ ë‹¤ìš´ë¡œë“œ (ë©”ëª¨ë¦¬ íš¨ìœ¨ì )\nwith open(\"large_file.pdf\", \"wb\") as download_file:\n    blob_data = blob_client.download_blob()\n    \n    # ì²­í¬ ë‹¨ìœ„ë¡œ ì½ê¸° (ê¸°ë³¸ 4MB)\n    for chunk in blob_data.chunks():\n        download_file.write(chunk)\n\nprint(\"ëŒ€ìš©ëŸ‰ íŒŒì¼ ë‹¤ìš´ë¡œë“œ ì™„ë£Œ\")\n```\n:::\n\n\n## ë¬¸ì„œ ëª©ë¡ ì¡°íšŒ\n\n### ì»¨í…Œì´ë„ˆ ë‚´ ëª¨ë“  Blob ë‚˜ì—´\n\n::: {#8ce3047b .cell execution_count=7}\n``` {.python .cell-code}\n# ì»¨í…Œì´ë„ˆì˜ ëª¨ë“  Blob ê°€ì ¸ì˜¤ê¸°\ncontainer_client = blob_service_client.get_container_client(\"rag-documents\")\nblob_list = container_client.list_blobs()\n\nprint(\"Blob ëª©ë¡:\")\nfor blob in blob_list:\n    print(f\"- {blob.name}\")\n    print(f\"  í¬ê¸°: {blob.size / 1024:.2f} KB\")\n    print(f\"  ìˆ˜ì •ì¼: {blob.last_modified}\")\n```\n:::\n\n\n### ë©”íƒ€ë°ì´í„° í¬í•¨ ì¡°íšŒ\n\n::: {#22172a46 .cell execution_count=8}\n``` {.python .cell-code}\n# ë©”íƒ€ë°ì´í„° í¬í•¨ ì¡°íšŒ\nblob_list = container_client.list_blobs(include=['metadata'])\n\nfor blob in blob_list:\n    print(f\"\\níŒŒì¼: {blob.name}\")\n    print(f\"ë©”íƒ€ë°ì´í„°: {blob.metadata}\")\n```\n:::\n\n\n### íŠ¹ì • ì ‘ë‘ì‚¬ë¡œ í•„í„°ë§\n\n::: {#2637c4cc .cell execution_count=9}\n``` {.python .cell-code}\n# \"reports/\" í´ë”ì˜ íŒŒì¼ë§Œ ì¡°íšŒ\nblob_list = container_client.list_blobs(name_starts_with=\"reports/\")\n\nfor blob in blob_list:\n    print(f\"- {blob.name}\")\n```\n:::\n\n\n## ë¬¸ì„œ ì‚­ì œ\n\n### ë‹¨ì¼ íŒŒì¼ ì‚­ì œ\n\n::: {#cb0855a9 .cell execution_count=10}\n``` {.python .cell-code}\n# Blob ì‚­ì œ\nblob_client = blob_service_client.get_blob_client(\n    container=\"rag-documents\",\n    blob=\"old_file.pdf\"\n)\n\nblob_client.delete_blob()\nprint(\"íŒŒì¼ ì‚­ì œ ì™„ë£Œ\")\n```\n:::\n\n\n### ì¡°ê±´ë¶€ ì‚­ì œ (ì˜¤ë˜ëœ íŒŒì¼ë§Œ)\n\n::: {#134feacb .cell execution_count=11}\n``` {.python .cell-code}\nfrom datetime import datetime, timedelta\n\n# 30ì¼ ì´ìƒ ëœ íŒŒì¼ ì‚­ì œ\nthreshold_date = datetime.now() - timedelta(days=30)\n\ncontainer_client = blob_service_client.get_container_client(\"rag-documents\")\nblob_list = container_client.list_blobs()\n\nfor blob in blob_list:\n    if blob.last_modified < threshold_date:\n        blob_client = container_client.get_blob_client(blob.name)\n        blob_client.delete_blob()\n        print(f\"ì‚­ì œ: {blob.name} (ìˆ˜ì •ì¼: {blob.last_modified})\")\n```\n:::\n\n\n## SAS (Shared Access Signature) í† í°\n\nSAS í† í°ì€ Storage Account í‚¤ë¥¼ ë…¸ì¶œí•˜ì§€ ì•Šê³  ì œí•œëœ ì•¡ì„¸ìŠ¤ë¥¼ ì œê³µí•œë‹¤.\n\n### SAS í† í° ìƒì„±\n\n::: {#93f4b4ba .cell execution_count=12}\n``` {.python .cell-code}\nfrom azure.storage.blob import generate_blob_sas, BlobSasPermissions\nfrom datetime import datetime, timedelta\n\n# SAS í† í° ìƒì„± (ì½ê¸° ì „ìš©, 1ì‹œê°„ ìœ íš¨)\nsas_token = generate_blob_sas(\n    account_name=\"stragdocs2025\",\n    container_name=\"rag-documents\",\n    blob_name=\"sample.pdf\",\n    account_key=os.getenv(\"AZURE_STORAGE_KEY\"),\n    permission=BlobSasPermissions(read=True),\n    expiry=datetime.utcnow() + timedelta(hours=1)\n)\n\n# SAS URL ìƒì„±\nsas_url = f\"https://stragdocs2025.blob.core.windows.net/rag-documents/sample.pdf?{sas_token}\"\nprint(f\"SAS URL: {sas_url}\")\n```\n:::\n\n\n### SAS í† í°ìœ¼ë¡œ ë‹¤ìš´ë¡œë“œ\n\n::: {#6e92e7d7 .cell execution_count=13}\n``` {.python .cell-code}\nimport requests\n\n# SAS URLë¡œ íŒŒì¼ ë‹¤ìš´ë¡œë“œ\nresponse = requests.get(sas_url)\n\nif response.status_code == 200:\n    with open(\"downloaded_with_sas.pdf\", \"wb\") as f:\n        f.write(response.content)\n    print(\"SAS í† í°ìœ¼ë¡œ ë‹¤ìš´ë¡œë“œ ì™„ë£Œ\")\nelse:\n    print(f\"ë‹¤ìš´ë¡œë“œ ì‹¤íŒ¨: {response.status_code}\")\n```\n:::\n\n\n## RAG íŒŒì´í”„ë¼ì¸ í†µí•©\n\n### ë¬¸ì„œ ë¡œë”© í•¨ìˆ˜\n\n::: {#a3fb22ff .cell execution_count=14}\n``` {.python .cell-code}\nfrom typing import List\nfrom langchain_core.documents import Document\n\ndef load_documents_from_blob(\n    container_name: str,\n    prefix: str = \"\"\n) -> List[Document]:\n    \"\"\"Azure Blob Storageì—ì„œ ë¬¸ì„œ ë¡œë”©\"\"\"\n    \n    container_client = blob_service_client.get_container_client(container_name)\n    blob_list = container_client.list_blobs(\n        name_starts_with=prefix,\n        include=['metadata']\n    )\n    \n    documents = []\n    for blob in blob_list:\n        # ì§€ì› íŒŒì¼ í˜•ì‹ë§Œ ì²˜ë¦¬\n        if blob.name.endswith(('.pdf', '.txt', '.docx')):\n            # Blob ë‹¤ìš´ë¡œë“œ\n            blob_client = container_client.get_blob_client(blob.name)\n            content = blob_client.download_blob().readall()\n            \n            # Document ê°ì²´ ìƒì„±\n            doc = Document(\n                page_content=content.decode('utf-8', errors='ignore'),\n                metadata={\n                    \"source\": blob.name,\n                    \"size\": blob.size,\n                    \"last_modified\": blob.last_modified.isoformat(),\n                    **blob.metadata  # Blob ë©”íƒ€ë°ì´í„° ì¶”ê°€\n                }\n            )\n            documents.append(doc)\n    \n    return documents\n\n# ì‚¬ìš© ì˜ˆì‹œ\ndocuments = load_documents_from_blob(\"rag-documents\", prefix=\"reports/\")\nprint(f\"ë¡œë”©ëœ ë¬¸ì„œ ìˆ˜: {len(documents)}\")\n```\n:::\n\n\n### LangChain AzureBlobStorageLoader ì‚¬ìš©\n\n::: {#59ffdd57 .cell execution_count=15}\n``` {.python .cell-code}\nfrom langchain_community.document_loaders import AzureBlobStorageFileLoader\n\n# Azure Blob Storageì—ì„œ íŒŒì¼ ë¡œë”©\nloader = AzureBlobStorageFileLoader(\n    conn_str=os.getenv(\"AZURE_STORAGE_CONNECTION_STRING\"),\n    container=\"rag-documents\",\n    blob_name=\"sample.pdf\"\n)\n\ndocuments = loader.load()\nprint(f\"ë¡œë”©ëœ ë¬¸ì„œ: {len(documents)}\")\nprint(f\"ì²« ë²ˆì§¸ ë¬¸ì„œ ë‚´ìš© (ì• 200ì):\\n{documents[0].page_content[:200]}\")\n```\n:::\n\n\n## ë¹„ìš© ìµœì í™”\n\n### ìˆ˜ëª… ì£¼ê¸° ê´€ë¦¬ ì •ì±…\n\nAzure Portalì—ì„œ ì„¤ì •:\n1. Storage Account â†’ \"ìˆ˜ëª… ì£¼ê¸° ê´€ë¦¬\"\n2. \"+ ê·œì¹™ ì¶”ê°€\"\n3. ê·œì¹™ ì •ì˜:\n\n**ì˜ˆì‹œ: ìë™ ê³„ì¸µ ì „í™˜**\n```json\n{\n  \"rules\": [\n    {\n      \"name\": \"move-to-cool\",\n      \"enabled\": true,\n      \"type\": \"Lifecycle\",\n      \"definition\": {\n        \"filters\": {\n          \"blobTypes\": [\"blockBlob\"],\n          \"prefixMatch\": [\"rag-documents/\"]\n        },\n        \"actions\": {\n          \"baseBlob\": {\n            \"tierToCool\": {\n              \"daysAfterModificationGreaterThan\": 90\n            },\n            \"tierToArchive\": {\n              \"daysAfterModificationGreaterThan\": 365\n            },\n            \"delete\": {\n              \"daysAfterModificationGreaterThan\": 730\n            }\n          }\n        }\n      }\n    }\n  ]\n}\n```\n\n**ì˜ë¯¸:**\n- 90ì¼ ë¯¸ì‚¬ìš© â†’ Cool ê³„ì¸µ ì „í™˜\n- 365ì¼ ë¯¸ì‚¬ìš© â†’ Archive ê³„ì¸µ ì „í™˜\n- 730ì¼(2ë…„) í›„ â†’ ìë™ ì‚­ì œ\n\n### ì••ì¶• ì €ì¥\n\n::: {#97c5a818 .cell execution_count=16}\n``` {.python .cell-code}\nimport gzip\n\n# í…ìŠ¤íŠ¸ íŒŒì¼ ì••ì¶• í›„ ì—…ë¡œë“œ\nwith open(\"large_document.txt\", \"rb\") as f:\n    content = f.read()\n    compressed = gzip.compress(content)\n\nblob_client = blob_service_client.get_blob_client(\n    container=\"rag-documents\",\n    blob=\"large_document.txt.gz\"\n)\n\nblob_client.upload_blob(\n    compressed,\n    metadata={\"compressed\": \"gzip\"},\n    overwrite=True\n)\n\nprint(f\"ì›ë³¸ í¬ê¸°: {len(content)} bytes\")\nprint(f\"ì••ì¶• í¬ê¸°: {len(compressed)} bytes ({len(compressed)/len(content)*100:.1f}%)\")\n```\n:::\n\n\n## ë³´ì•ˆ ì„¤ì •\n\n### Managed Identityë¡œ ì¸ì¦\n\n::: {#4dbd2873 .cell execution_count=17}\n``` {.python .cell-code}\nfrom azure.identity import DefaultAzureCredential\n\n# Managed Identity ì‚¬ìš© (í‚¤ ë…¸ì¶œ ì—†ìŒ)\ncredential = DefaultAzureCredential()\n\nblob_service_client = BlobServiceClient(\n    account_url=\"https://stragdocs2025.blob.core.windows.net\",\n    credential=credential\n)\n\n# ì´í›„ ë™ì¼í•˜ê²Œ ì‚¬ìš©\ncontainer_client = blob_service_client.get_container_client(\"rag-documents\")\n```\n:::\n\n\n**Managed Identity ì„¤ì •:**\n1. Azure Function/Container App â†’ \"ID\" â†’ \"ì‹œìŠ¤í…œ í• ë‹¹ ê´€ë¦¬ ID\" í™œì„±í™”\n2. Storage Account â†’ \"ì•¡ì„¸ìŠ¤ ì œì–´(IAM)\" â†’ \"ì—­í•  í• ë‹¹ ì¶”ê°€\"\n3. ì—­í• : \"Storage Blob Data Contributor\"\n4. í• ë‹¹ ëŒ€ìƒ: ìƒì„±ëœ Managed Identity\n\n### Private Endpoint ì„¤ì •\n\n1. Storage Account â†’ \"ë„¤íŠ¸ì›Œí‚¹\" â†’ \"í”„ë¼ì´ë¹— ì—”ë“œí¬ì¸íŠ¸ ì—°ê²°\"\n2. \"+ í”„ë¼ì´ë¹— ì—”ë“œí¬ì¸íŠ¸\" í´ë¦­\n3. ì„¤ì •:\n   - ë¦¬ì†ŒìŠ¤ ê·¸ë£¹ ì„ íƒ\n   - ì´ë¦„: `pe-storage-rag`\n   - ëŒ€ìƒ í•˜ìœ„ ë¦¬ì†ŒìŠ¤: `blob`\n   - ê°€ìƒ ë„¤íŠ¸ì›Œí¬ ë° ì„œë¸Œë„· ì„ íƒ\n4. \"ë§Œë“¤ê¸°\" â†’ VNet ë‚´ì—ì„œë§Œ ì•¡ì„¸ìŠ¤ ê°€ëŠ¥\n\n## ëª¨ë‹ˆí„°ë§\n\n### Storage Analytics í™œì„±í™”\n\n::: {#d4de4761 .cell execution_count=18}\n``` {.python .cell-code}\nfrom azure.storage.blob import BlobAnalyticsLogging, Metrics, RetentionPolicy\n\n# Analytics ì„¤ì •\nlogging = BlobAnalyticsLogging(\n    version=\"1.0\",\n    delete=True,\n    read=True,\n    write=True,\n    retention_policy=RetentionPolicy(enabled=True, days=7)\n)\n\nmetrics = Metrics(\n    version=\"1.0\",\n    enabled=True,\n    include_apis=True,\n    retention_policy=RetentionPolicy(enabled=True, days=7)\n)\n\n# ì„¤ì • ì ìš©\nblob_service_client.set_service_properties(\n    analytics_logging=logging,\n    hour_metrics=metrics,\n    minute_metrics=metrics\n)\n\nprint(\"Storage Analytics í™œì„±í™” ì™„ë£Œ\")\n```\n:::\n\n\n### ì£¼ìš” ë©”íŠ¸ë¦­\n\nAzure Portal â†’ Storage Account â†’ \"ë©”íŠ¸ë¦­\":\n- **Transactions**: ìš”ì²­ ìˆ˜ (GET, PUT, DELETE)\n- **Ingress/Egress**: ì—…ë¡œë“œ/ë‹¤ìš´ë¡œë“œ ë°ì´í„°ëŸ‰\n- **Availability**: ê°€ë™ë¥ \n- **Success E2E Latency**: ì¢…ë‹¨ ê°„ ì‘ë‹µ ì‹œê°„\n\n## ë¬¸ì œ í•´ê²°\n\n### ì¼ë°˜ì ì¸ ì˜¤ë¥˜\n\n**1. AuthorizationPermissionMismatch**\n```\nì˜¤ë¥˜: ê¶Œí•œ ì—†ìŒ\ní•´ê²°: Storage Account IAMì—ì„œ \"Storage Blob Data Contributor\" ì—­í•  ì¶”ê°€\n```\n\n**2. ContainerNotFound**\n```python\n# ì»¨í…Œì´ë„ˆ ì¡´ì¬ í™•ì¸ í›„ ìƒì„±\ntry:\n    container_client = blob_service_client.get_container_client(\"rag-documents\")\n    container_client.get_container_properties()\nexcept Exception:\n    container_client.create_container()\n```\n\n**3. BlobNotFound**\n```python\n# Blob ì¡´ì¬ í™•ì¸\nif blob_client.exists():\n    blob_client.download_blob()\nelse:\n    print(\"íŒŒì¼ì´ ì¡´ì¬í•˜ì§€ ì•ŠìŠµë‹ˆë‹¤\")\n```\n\n## ì°¸ê³  ìë£Œ\n\n### ê³µì‹ ë¬¸ì„œ\n- [Azure Blob Storage ê°œìš”](https://learn.microsoft.com/en-us/azure/storage/blobs/storage-blobs-overview)\n- [Python SDK ì°¸ì¡°](https://learn.microsoft.com/en-us/python/api/overview/azure/storage-blob-readme)\n- [ë³´ì•ˆ ê°€ì´ë“œ](https://learn.microsoft.com/en-us/azure/storage/blobs/security-recommendations)\n\n### ìƒ˜í”Œ ì½”ë“œ\n- [Azure Storage Python Samples](https://github.com/Azure-Samples/azure-storage-python-samples)\n- [LangChain Azure í†µí•©](https://python.langchain.com/docs/integrations/document_loaders/azure_blob_storage_file)\n\n## ë‹¤ìŒ ë‹¨ê³„\n\në¬¸ì„œ ì €ì¥ì´ ì™„ë£Œë˜ì—ˆë‹¤ë©´, ì´ì œ OCR ë° ë ˆì´ì•„ì›ƒ ë¶„ì„ ë‹¨ê³„ë¡œ ë„˜ì–´ê°€ì:\n\nğŸ‘‰ [02-Document-Intelligence.qmd](./02-Document-Intelligence.qmd) - Azure Document Intelligenceë¥¼ í™œìš©í•œ ë¬¸ì„œ ë¶„ì„\n\n",
    "supporting": [
      "01-Azure-Blob-Storage_files"
    ],
    "filters": [],
    "includes": {}
  }
}