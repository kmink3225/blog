{
  "hash": "e0b74809b4f951cc4a4bb996637d6b74",
  "result": {
    "engine": "jupyter",
    "markdown": "---\ntitle: \"CSV\"\nsubtitle: 문서 로더\ndescription: |\n  다양한 형식의 문서를 LangChain으로 로드하는 방법을 다룬다.\ncategories:\n  - AI\n  - RAG\n  - LangChain\nauthor: Kwangmin Kim\ndate: 12/31/2024\nformat: \n  html:\n    page-layout: full\n    code-fold: true\n    toc: true\n    number-sections: true\ndraft: False\nexecute:\n    eval: false\n---\n\n[Comma-Separated Values (CSV)](https://en.wikipedia.org/wiki/Comma-separated_values) 파일은 쉼표로 값을 구분하는 구분된 텍스트 파일입니다. 파일의 각 줄은 데이터 레코드입니다. \n\n각 레코드는 쉼표로 구분된 하나 이상의 필드로 구성됩니다.\n\n## CSVLoader\n\n- CSV 데이터를 문서당 한 행씩 로드합니다.\n\n::: {#afe4c752 .cell execution_count=1}\n``` {.python .cell-code}\nfrom langchain_community.document_loaders.csv_loader import CSVLoader\n\n# CSV 로더 생성\nloader = CSVLoader(file_path=\"./data/titanic.csv\")\n\n# 데이터 로드\ndocs = loader.load()\n\nprint(len(docs))\nprint(docs[0].metadata)\n```\n:::\n\n\n::: {#4a5677ad .cell execution_count=2}\n``` {.python .cell-code}\nprint(docs[1].page_content)\n```\n:::\n\n\n### CSV 파싱 및 로딩 커스터마이징\n\n[csv module](https://docs.python.org/3/library/csv.html) 문서를 참조하여 지원되는 **csv args**에 대한 자세한 정보를 확인하세요.\n\n::: {#58339164 .cell execution_count=3}\n``` {.python .cell-code}\n# 컬럼정보:\n# PassengerId,Survived,Pclass,Name,Sex,Age,SibSp,Parch,Ticket,Fare,Cabin,Embarked\n\n# CSV 파일 경로\nloader = CSVLoader(\n    file_path=\"./data/titanic.csv\",\n    csv_args={\n        \"delimiter\": \",\",  # 구분자\n        \"quotechar\": '\"',  # 인용 부호 문자\n        \"fieldnames\": [\n            \"Passenger ID\",\n            \"Survival (1: Survived, 0: Died)\",\n            \"Passenger Class\",\n            \"Name\",\n            \"Sex\",\n            \"Age\",\n            \"Number of Siblings/Spouses Aboard\",\n            \"Number of Parents/Children Aboard\",\n            \"Ticket Number\",\n            \"Fare\",\n            \"Cabin\",\n            \"Port of Embarkation\",\n        ],  # 필드 이름\n    },\n)\n\n# 데이터 로드\ndocs = loader.load()\n\n# 데이터 출력\nprint(docs[1].page_content)\n```\n:::\n\n\n문서 전체를 XML 문서 형식으로 처리하려는 경우\n- 참고: 0번째 문서는 헤더 정보이기 때문에 스킵합니다.\n\n::: {#9565f24e .cell execution_count=4}\n``` {.python .cell-code}\nrow = docs[1].page_content.split(\"\\n\")\nrow_str = \"<row>\"\nfor element in row:\n    splitted_element = element.split(\":\")\n    value = splitted_element[-1]\n    col = \":\".join(splitted_element[:-1])\n    row_str += f\"<{col}>{value.strip()}</{col}>\"\nrow_str += \"</row>\"\nprint(row_str)\n```\n:::\n\n\n::: {#401ed506 .cell execution_count=5}\n``` {.python .cell-code}\nfor doc in docs[1:]:\n    row = doc.page_content.split(\"\\n\")\n    row_str = \"<row>\"\n    for element in row:\n        splitted_element = element.split(\":\")\n        value = splitted_element[-1]\n        col = \":\".join(splitted_element[:-1])\n        row_str += f\"<{col}>{value.strip()}</{col}>\"\n    row_str += \"</row>\"\n    print(row_str)\n```\n:::\n\n\n`source_column` 인자를 사용하여 각 행에서 생성된 문서의 출처를 지정하세요. 그렇지 않으면 모든 문서의 출처로 `file_path`가 사용됩니다.\n\n이는 CSV 파일에서 로드된 문서를 출처를 사용하여 질문에 답하는 체인에 사용할 때 유용합니다.\n\n::: {#96b2383e .cell execution_count=6}\n``` {.python .cell-code}\nloader = CSVLoader(\n    file_path=\"./data/titanic.csv\", source_column=\"PassengerId\"\n)  # CSV 로더 설정, 파일 경로 및 소스 컬럼 지정\n\ndocs = loader.load()  # 데이터 로드\n\nprint(docs[1])  # 데이터 출력\n```\n:::\n\n\n## UnstructuredCSVLoader \n\n`UnstructuredCSVLoader`를 사용하여 테이블을 로드할 수도 있습니다. `UnstructuredCSVLoader`를 사용하는 한 가지 장점은 `\"elements\"` 모드에서 사용할 경우, 메타데이터에서 테이블의 HTML 표현이 제공된다는 것입니다.\n\n::: {#4594d971 .cell execution_count=7}\n``` {.python .cell-code}\nfrom langchain_community.document_loaders.csv_loader import UnstructuredCSVLoader\n\n# 비구조화 CSV 로더 인스턴스 생성\nloader = UnstructuredCSVLoader(file_path=\"./data/titanic.csv\", mode=\"elements\")\n\n# 문서 로드\ndocs = loader.load()\n\n# 첫 번째 문서의 HTML 텍스트 메타데이터 출력\nprint(docs[0].metadata[\"text_as_html\"][:1000])\n```\n:::\n\n\n## DataFrameLoader\n\n- Pandas는 Python 프로그래밍 언어를 위한 오픈 소스 데이터 분석 및 조작 도구입니다. 이 라이브러리는 데이터 과학, 머신러닝, 그리고 다양한 분야의 데이터 작업에 널리 사용되고 있습니다.\n\n::: {#9b582974 .cell execution_count=8}\n``` {.python .cell-code}\nimport pandas as pd\n\n# CSV 파일 읽기\ndf = pd.read_csv(\"./data/titanic.csv\")\n```\n:::\n\n\n첫 5개 행을 조회합니다.\n\n::: {#2758ad01 .cell execution_count=9}\n``` {.python .cell-code}\n# 데이터프레임의 처음 다섯 행 조회\ndf.head()\n```\n:::\n\n\n::: {#63da1d1c .cell execution_count=10}\n``` {.python .cell-code}\nfrom langchain_community.document_loaders import DataFrameLoader\n\n# 데이터 프레임 로더 설정, 페이지 내용 컬럼 지정\nloader = DataFrameLoader(df, page_content_column=\"Name\")\n\n# 문서 로드\ndocs = loader.load()\n\n# 데이터 출력\nprint(docs[0].page_content)\n\n# 메타데이터 출력\nprint(docs[0].metadata)\n```\n:::\n\n\n::: {#1cac5191 .cell execution_count=11}\n``` {.python .cell-code}\n# 큰 테이블에 대한 지연 로딩, 전체 테이블을 메모리에 로드하지 않음\nfor row in loader.lazy_load():\n    print(row)\n    break  # 첫 행만 출력\n```\n:::\n\n\n",
    "supporting": [
      "03-CSV-Loader_files"
    ],
    "filters": [],
    "includes": {}
  }
}