{
  "hash": "38bf38f0529653090a17246dd8dcfdb4",
  "result": {
    "engine": "jupyter",
    "markdown": "---\ntitle: \"데이터를 효과적으로 전달하는 방법\"\nsubtitle: LangChain 기초\ndescription: |\n  LangChain의 기본 개념과 OpenAI API 활용법을 다룬다.\ncategories:\n  - AI\n  - RAG\n  - LangChain\nauthor: Kwangmin Kim\ndate: 01/11/2025\nformat: \n  html:\n    page-layout: full\n    code-fold: true\n    toc: true\n    number-sections: true\ndraft: False\nexecute:\n    eval: false\n---\n\n::: {#6ec3d728 .cell execution_count=1}\n``` {.python .cell-code}\n# .env 파일을 읽어서 환경변수로 설정\nfrom dotenv import load_dotenv\n\n# 토큰 정보로드\nload_dotenv()\n```\n:::\n\n\n::: {#da17506e .cell execution_count=2}\n``` {.python .cell-code}\n# LangSmith 추적을 설정합니다. https://smith.langchain.com\n# !pip install -qU langchain-teddynote\nfrom langchain_teddynote import logging\n\n# 프로젝트 이름을 입력합니다.\nlogging.langsmith(\"CH01-Basic\")\n```\n:::\n\n\n- `RunnablePassthrough` 는 입력을 변경하지 않거나 추가 키를 더하여 전달할 수 있습니다. \n- `RunnablePassthrough()` 가 단독으로 호출되면, 단순히 입력을 받아 그대로 전달합니다.\n- `RunnablePassthrough.assign(...)` 방식으로 호출되면, 입력을 받아 assign 함수에 전달된 추가 인수를 추가합니다.\n\n\n### RunnablePassthrough\n\n::: {#1e5248b6 .cell execution_count=3}\n``` {.python .cell-code}\nfrom langchain_core.prompts import PromptTemplate\nfrom langchain_openai import ChatOpenAI\n\n\n# prompt 와 llm 을 생성합니다.\nprompt = PromptTemplate.from_template(\"{num} 의 10배는?\")\nllm = ChatOpenAI(temperature=0)\n\n# chain 을 생성합니다.\nchain = prompt | llm\n```\n:::\n\n\nchain 을 `invoke()` 하여 실행할 때는 입력 데이터의 타입이 딕셔너리여야 합니다.\n\n::: {#d36fa132 .cell execution_count=4}\n``` {.python .cell-code}\n# chain 을 실행합니다.\nchain.invoke({\"num\": 5})\n```\n:::\n\n\n하지만, langchain 라이브러리가 업데이트 되면서 1개의 변수만 템플릿에 포함하고 있다면, 값만 전달하는 것도 가능합니다.\n\n::: {#815c300e .cell execution_count=5}\n``` {.python .cell-code}\n# chain 을 실행합니다.\nchain.invoke(5)\n```\n:::\n\n\n아래는 `RunnablePassthrough` 를 사용한 예제입니다.\n\n`RunnablePassthrough` 는 `runnable` 객체이며, `runnable` 객체는 `invoke()` 메소드를 사용하여 별도 실행이 가능합니다.\n\n::: {#9fd5b2eb .cell execution_count=6}\n``` {.python .cell-code}\nfrom langchain_core.runnables import RunnablePassthrough\n\n# runnable\nRunnablePassthrough().invoke({\"num\": 10})\n```\n:::\n\n\n아래는 `RunnablePassthrough` 로 체인을 구성하는 예제입니다.\n\n::: {#afc785ad .cell execution_count=7}\n``` {.python .cell-code}\nrunnable_chain = {\"num\": RunnablePassthrough()} | prompt | ChatOpenAI()\n\n# dict 값이 RunnablePassthrough() 로 변경되었습니다.\nrunnable_chain.invoke(10)\n```\n:::\n\n\n다음은 `RunnablePassthrough.assign()` 을 사용하는 경우와 비교한 결과입니다.\n\n::: {#61b6b4ca .cell execution_count=8}\n``` {.python .cell-code}\nRunnablePassthrough().invoke({\"num\": 1})\n```\n:::\n\n\n`RunnablePassthrough.assign()`\n\n- 입력 값으로 들어온 값의 key/value 쌍과 새롭게 할당된 key/value 쌍을 합칩니다.\n\n::: {#aa07e1cd .cell execution_count=9}\n``` {.python .cell-code}\n# 입력 키: num, 할당(assign) 키: new_num\n(RunnablePassthrough.assign(new_num=lambda x: x[\"num\"] * 3)).invoke({\"num\": 1})\n```\n:::\n\n\n## RunnableParallel\n\n::: {#b18f8576 .cell execution_count=10}\n``` {.python .cell-code}\nfrom langchain_core.runnables import RunnableParallel\n\n# RunnableParallel 인스턴스를 생성합니다. 이 인스턴스는 여러 Runnable 인스턴스를 병렬로 실행할 수 있습니다.\nrunnable = RunnableParallel(\n    # RunnablePassthrough 인스턴스를 'passed' 키워드 인자로 전달합니다. 이는 입력된 데이터를 그대로 통과시키는 역할을 합니다.\n    passed=RunnablePassthrough(),\n    # 'extra' 키워드 인자로 RunnablePassthrough.assign을 사용하여, 'mult' 람다 함수를 할당합니다. 이 함수는 입력된 딕셔너리의 'num' 키에 해당하는 값을 3배로 증가시킵니다.\n    extra=RunnablePassthrough.assign(mult=lambda x: x[\"num\"] * 3),\n    # 'modified' 키워드 인자로 람다 함수를 전달합니다. 이 함수는 입력된 딕셔너리의 'num' 키에 해당하는 값에 1을 더합니다.\n    modified=lambda x: x[\"num\"] + 1,\n)\n\n# runnable 인스턴스에 {'num': 1} 딕셔너리를 입력으로 전달하여 invoke 메소드를 호출합니다.\nrunnable.invoke({\"num\": 1})\n```\n:::\n\n\nChain 도 RunnableParallel 적용할 수 있습니다.\n\n::: {#0cfd3a50 .cell execution_count=11}\n``` {.python .cell-code}\nchain1 = (\n    {\"country\": RunnablePassthrough()}\n    | PromptTemplate.from_template(\"{country} 의 수도는?\")\n    | ChatOpenAI()\n)\nchain2 = (\n    {\"country\": RunnablePassthrough()}\n    | PromptTemplate.from_template(\"{country} 의 면적은?\")\n    | ChatOpenAI()\n)\n```\n:::\n\n\n::: {#355926b3 .cell execution_count=12}\n``` {.python .cell-code}\ncombined_chain = RunnableParallel(capital=chain1, area=chain2)\ncombined_chain.invoke(\"대한민국\")\n```\n:::\n\n\n## RunnableLambda\n\nRunnableLambda 를 사용하여 사용자 정의 함수를 맵핑할 수 있습니다.\n\n::: {#3f964bbc .cell execution_count=13}\n``` {.python .cell-code}\nfrom langchain_core.output_parsers import StrOutputParser\nfrom langchain_core.prompts import PromptTemplate\nfrom langchain_openai import ChatOpenAI\nfrom datetime import datetime\n\n\ndef get_today(a):\n    # 오늘 날짜를 가져오기\n    return datetime.today().strftime(\"%b-%d\")\n\n\n# 오늘 날짜를 출력\nget_today(None)\n```\n:::\n\n\n::: {#629e167e .cell execution_count=14}\n``` {.python .cell-code}\nfrom langchain_core.runnables import RunnableLambda, RunnablePassthrough\n\n# prompt 와 llm 을 생성합니다.\nprompt = PromptTemplate.from_template(\n    \"{today} 가 생일인 유명인 {n} 명을 나열하세요. 생년월일을 표기해 주세요.\"\n)\nllm = ChatOpenAI(temperature=0, model_name=\"gpt-4.1-mini\")\n\n# chain 을 생성합니다.\nchain = (\n    {\"today\": RunnableLambda(get_today), \"n\": RunnablePassthrough()}\n    | prompt\n    | llm\n    | StrOutputParser()\n)\n```\n:::\n\n\n::: {#9f3b3683 .cell execution_count=15}\n``` {.python .cell-code}\n# 출력\nprint(chain.invoke(3))\n```\n:::\n\n\n`itemgetter` 를 사용하여 특정 키를 추출합니다.\n\n::: {#02e7bd7f .cell execution_count=16}\n``` {.python .cell-code}\nfrom operator import itemgetter\n\nfrom langchain_core.prompts import ChatPromptTemplate\nfrom langchain_core.runnables import RunnableLambda\nfrom langchain_openai import ChatOpenAI\n\n\n# 문장의 길이를 반환하는 함수입니다.\ndef length_function(text):\n    return len(text)\n\n\n# 두 문장의 길이를 곱한 값을 반환하는 함수입니다.\ndef _multiple_length_function(text1, text2):\n    return len(text1) * len(text2)\n\n\n# _multiple_length_function 함수를 사용하여 두 문장의 길이를 곱한 값을 반환하는 함수입니다.\ndef multiple_length_function(_dict):\n    return _multiple_length_function(_dict[\"text1\"], _dict[\"text2\"])\n\n\nprompt = ChatPromptTemplate.from_template(\"{a} + {b} 는 무엇인가요?\")\nmodel = ChatOpenAI()\n\nchain1 = prompt | model\n\nchain = (\n    {\n        \"a\": itemgetter(\"word1\") | RunnableLambda(length_function),\n        \"b\": {\"text1\": itemgetter(\"word1\"), \"text2\": itemgetter(\"word2\")}\n        | RunnableLambda(multiple_length_function),\n    }\n    | prompt\n    | model\n)\n```\n:::\n\n\n::: {#31d7d147 .cell execution_count=17}\n``` {.python .cell-code}\nchain.invoke({\"word1\": \"hello\", \"word2\": \"world\"})\n```\n:::\n\n\n",
    "supporting": [
      "05-Runnable_files"
    ],
    "filters": [],
    "includes": {}
  }
}